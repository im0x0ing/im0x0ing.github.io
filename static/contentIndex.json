{"index":{"slug":"index","filePath":"index.md","title":"ğŸ  é¦–é¡µ","links":["about"],"tags":[],"content":"æ¬¢è¿æ¥åˆ° ING wikiï¼\næœ¬è´¨è‡ªç”¨, æŒç»­å»ºè®¾ä¸­â€¦\nğŸ“‚ å¯¼èˆª\n\nå…³äºæˆ‘\n\nğŸ“ æœ€è¿‘æ›´æ–°\n\nè¿™é‡Œå¯ä»¥å†™ä¸€äº›æœ€è¿‘çš„æƒ³æ³•æˆ–è€…ç½®é¡¶çš„å†…å®¹ã€‚\n"},"å·¥å…·ä½¿ç”¨/Obsidianæ’ä»¶":{"slug":"å·¥å…·ä½¿ç”¨/Obsidianæ’ä»¶","filePath":"å·¥å…·ä½¿ç”¨/Obsidianæ’ä»¶.md","title":"Obsidianæ’ä»¶","links":[],"tags":[],"content":"templater\nå¯ä»¥æŠŠTemplatesæ–‡ä»¶å¤¹ä¸‹çš„ç¬”è®°ä½œä¸ºæ¨¡æ¿,å·¦ä¾§åŠŸèƒ½æ ç‚¹å‡»å³å¯å¥—ç”¨åˆ°å…¶ä»–ç¬”è®°ä¸Š.ä¸ä¼šå½±å“å·²å†™çš„å†…å®¹.\nConsistent Attachments and Links\nå³é”®æŸä¸ªæ–‡ä»¶å¤¹,å¯ä»¥ä»æ•´ä¸ªä»“åº“æ”¶é›†å±äºè¯¥æ–‡ä»¶å¤¹ä¸‹ç¬”è®°çš„å›¾ç‰‡,å¹¶æ”¾åˆ°è¯¥æ–‡ä»¶å¤¹ä¸‹çš„attachmentsæ–‡ä»¶å¤¹ä¸­.\n\né¦–å…ˆè¦åœ¨obsidianè®¾ç½®-æ–‡ä»¶ä¸é“¾æ¥-é™„ä»¶é»˜è®¤å­˜æ”¾è·¯å¾„,ç¡®å®šå¥½é™„ä»¶å­˜æ”¾æ–¹å¼æ˜¯åœ¨æ–‡ä»¶å¤¹ä¸‹çš„attachmentsæ–‡ä»¶å¤¹.\nä½¿ç”¨æ—¶,æ¯”å¦‚å…ˆç§»åŠ¨äº†ä¸€ä¸ªç¬”è®°,ç„¶åå³é”®ç¬”è®°æ‰€å±æ–‡ä»¶å¤¹å³å¯é€‰æ‹©collect attachments.[æ³¨æ„ä¸è¦å¯¹é™„ä»¶æ–‡ä»¶å¤¹åšä»»ä½•åˆ é™¤æ“ä½œ,è¿™ä¸ªç§»åŠ¨æ˜¯é™„ä»¶æœ¬ä½“è¿›è¡Œç§»åŠ¨,ä¸æ˜¯å‰¯æœ¬ç§»åŠ¨]\n\nclear unused images\nå°±æ˜¯åˆ é™¤æœªè¢«å¼•ç”¨çš„é™„ä»¶å›¾ç‰‡\nGit\nå¥½ç”¨,å¯ä»¥æŠŠæ•´ä¸ªobsidianä»“åº“æ‰˜ç®¡åˆ°gitç„¶åè®¾ç½®æ¯ä¸¤å°æ—¶æäº¤ä¸€æ¬¡(å¦‚æœæœ‰ä¿®æ”¹çš„è¯).æˆ‘ä¹‹å‰ç¢ç£¨é™„ä»¶æ’ä»¶çš„æ—¶å€™æŠŠé™„ä»¶åˆ æ²¡äº†å…¨é gitæ‰¾å›æ¥(å½“ç„¶ä¹Ÿå¯ä»¥å»å›æ”¶ç«™æ‰¾)\nShell Commands\nå¯ä»¥ç¼–å†™ç»ˆç«¯æŒ‡ä»¤.ä½¿ç”¨ä¾‹:\n\nç¼–å†™äº†ä¸€ä¸ªæŒ‡ä»¤,æ¯æ¬¡Obsidianæ‰“å¼€çš„æ—¶å€™ä¼šè‡ªåŠ¨è¿›å…¥æˆ‘çš„åšå®¢æœ¬åœ°ä»“åº“è¿›è¡Œä¸€æ¬¡å‘å¸ƒ.\n"},"å·¥å…·ä½¿ç”¨/åšå®¢æ­å»º":{"slug":"å·¥å…·ä½¿ç”¨/åšå®¢æ­å»º","filePath":"å·¥å…·ä½¿ç”¨/åšå®¢æ­å»º.md","title":"åšå®¢æ­å»º","links":[],"tags":[],"content":"åŸºäºObsidianå’ŒQuartz4.æµç¨‹:\n\nå°†quartz4ä»“åº“å…‹éš†åˆ°æœ¬åœ°.ç„¶åå°†contentæ–‡ä»¶å¤¹é‡å®šå‘åˆ°æœ¬åœ°obsidianä»“åº“çš„publicæ–‡ä»¶å¤¹.è¿™æ ·ä¸¤è¾¹çš„å†…å®¹ä¼šè¿›è¡Œä¸€ä¸ªåŒæ­¥.\nä¸ºæœ¬åœ°quartzä»“åº“é…ç½®ç§é’¥å’Œå…¬é’¥.ç§é’¥é“¾æ¥åˆ°githubç§æœ‰ä»“åº“.å…¬é’¥è¿æ¥åˆ°githubå…¬æœ‰ä»“åº“.è¿™æ ·åªæœ‰é™æ€äº§ç‰©ä¼šdeployåˆ°å…¬æœ‰ä»“åº“,å°†å…¬æœ‰ä»“åº“åå­—è®¾ç½®ä¸ºusername.github.ioå³å¯.\nåœ¨obsidianä¸­çš„Publicæ–‡ä»¶å¤¹ä¸‹ä¹¦å†™ç¬”è®°,ç„¶ååœ¨quartz4æœ¬åœ°ä»“åº“è¿›è¡Œæäº¤.è¿™æ ·ä¹‹åç§æœ‰ä»“åº“[åšå®¢æºç ]ä¼šæ›´æ–°.å…¬æœ‰ä»“åº“[é™æ€äº§ç‰©]ä¹Ÿä¼šæ›´æ–°,æœ€ç»ˆä½“ç°åœ¨åšå®¢ç½‘é¡µä¸Š.\n\nè¯„è®º\ngiscus åŸºäºgithubä»“åº“discussion\ntips\n\nquartz.config.ts-&gt;plugins -&gt; transformers\nåŠ ä¸Šä¸€è¡ŒPlugin.HardLineBreaks(),,å°±ä¼šè°ƒç”¨remark-breaks è¿™ä¸ªåº“,å°†æ‰€æœ‰æ¢è¡Œå¼ºåˆ¶æ¸²æŸ“æˆ&lt;br&gt;,å¦åˆ™ç¬”è®°é‡Œé¢çš„æœ¬æ¥çš„æ¢è¡Œé€‰ç„¶åä¼šå˜æˆç©ºæ ¼.[åªæœ‰ä¸¤æ¬¡å›è½¦/ä¸¤ä¸ªç©ºæ ¼ä¸€æ¬¡å›è½¦ä¼šè¢«æ¸²æŸ“æˆæ¢è¡Œä½†æ˜¯å¤ªéº»çƒ¦äº†æ‰€ä»¥]\n"},"å·¥å…·ä½¿ç”¨/æœªå‘½å":{"slug":"å·¥å…·ä½¿ç”¨/æœªå‘½å","filePath":"å·¥å…·ä½¿ç”¨/æœªå‘½å.md","title":"æœªå‘½å","links":[],"tags":[],"content":"gitingest.com/ å¯ä»¥å°†githubä»“åº“çš„å†…å®¹æ•´ç†æˆä¸€ä¸ªtxtæ–‡ä»¶."},"æŠ€æœ¯ç§¯ç´¯/3230106213_é‚“é™æ€¡_lab5":{"slug":"æŠ€æœ¯ç§¯ç´¯/3230106213_é‚“é™æ€¡_lab5","filePath":"æŠ€æœ¯ç§¯ç´¯/3230106213_é‚“é™æ€¡_lab5.md","title":"3230106213_é‚“é™æ€¡_lab5","links":[],"tags":[],"content":"äº”çº§æµæ°´çº¿cpuçš„æ­å»ºä¸é›†æˆ\nIFæ¨¡å—ä¸å¯„å­˜å™¨è®¾è®¡\næ ¹æ®åŸç†å›¾è¿›è¡Œå–æŒ‡æ¨¡å—çš„ç¼–å†™\nå–æŒ‡:\n\né¡ºåºæ‰§è¡Œ,è®¡ç®—ä¸‹ä¸€æŒ‡ä»¤pc\nå¤šè·¯é€‰æ‹©å™¨è¿›è¡Œåˆ†æ”¯è·³è½¬\nPCå¯„å­˜å™¨é”å­˜å½“å‰æŒ‡ä»¤åœ°å€\n\nmodule Pipeline_IF(\n    input clk_IF,\n    input rst_IF,\n    input en_IF,\n    input [31:0] PC_in_IF,\n    input PCSrc,\n    output reg [31:0] PC_out_IF\n);\n \n    wire [31:0] add_32_c;\n    wire [31:0] MUX2T1_32_0_o; \n    wire [31:0] REG32_Q;\n \n    MUX2T1_32 MUX2T1_32_0(\n        .I0(add_32_c),      \n        .I1(PC_in_IF),     \n        .s(PCSrc),\n        .o(MUX2T1_32_0_o)\n    );\n \n \n    PC PC_U(\n        .clk(clk_IF),\n        .rst(rst_IF),\n        .CE(en_IF),\n        .D(MUX2T1_32_0_o),\n        .Q(REG32_Q)\n    );\n \n    add_32 add_32_0(\n        .a(32&#039;d4),\n        .b(REG32_Q),\n        .c(add_32_c)\n    );\n \n    always @(*) begin\n        PC_out_IF = REG32_Q; \n    end\n \nendmodule\n\nåœ¨æ—¶é’Ÿä¸Šå‡æ²¿ï¼Œå°† IF é˜¶æ®µå–å¾—çš„PCå€¼å’ŒæŒ‡ä»¤å†…å®¹åŒæ­¥ä¼ é€’ç»™ ID é˜¶æ®µ\né€šè¿‡rst_IFIDæ¸…ç©ºå¯„å­˜å™¨ï¼ˆåˆ†æ”¯é¢„æµ‹å¤±è´¥æ—¶æ‰”æ‰é”™è¯¯çš„æŒ‡ä»¤ï¼‰\né€šè¿‡en_IFIDä¿æŒå½“å‰å€¼ä¸å˜ï¼ˆå‘ç”Ÿæ•°æ®å†’é™©éœ€æš‚åœæµæ°´çº¿æ—¶ï¼‰\n\n    always @(posedge clk_IFID or posedge rst_IFID) begin\n        if (rst_IFID == 1&#039;b1) begin\n            PC_out_IFID &lt;= 32&#039;b0;\n            inst_out_IFID &lt;= 32&#039;b0;\n        end\n        else if (en_IFID == 1&#039;b1) begin\n            PC_out_IFID &lt;= PC_in_IFID;\n            inst_out_IFID &lt;= inst_in_IFID;\n        end\n    end\nIDæ¨¡å—ä¸å¯„å­˜å™¨è®¾è®¡\n\nè¯»å¯„å­˜å™¨.æ ¹æ®rs1å’Œrs2ç´¢å¼•è¯»å–æ“ä½œæ•°,åŒæ—¶æ¥æ”¶æ¥è‡ªWBé˜¶æ®µçš„å†™å›ä¿¡å·\nç”Ÿæˆç«‹å³æ•°,æ ¹æ®æŒ‡ä»¤ç±»å‹å°†æŒ‡ä»¤ä¸­çš„ç«‹å³æ•°éƒ¨åˆ†æå–å¹¶æ‰©å±•ä¸º32ä½\nç”Ÿæˆæ§åˆ¶ä¿¡å·,æ ¹æ® OpCode å’Œ FunåŸŸï¼Œè§£ç å‡ºæ‰€æœ‰åç»­é˜¶æ®µéœ€è¦çš„æ§åˆ¶ä¿¡å·,\nå°†æ•°æ®\\æ§åˆ¶ä¿¡å·\\ç›®æ ‡å¯„å­˜å™¨åœ°å€ç­‰éƒ½æ‰“åŒ…è¾“é€åˆ°ä¸‹ä¸€çº§\n\n    // å®ä¾‹åŒ–å¯„å­˜å™¨å †\n    Register_new Regs_0(\n        .clk(clk_ID),\n        .rst(rst_ID),\n        .Rs1_addr(Inst_in_ID[19:15]),\n        .Rs2_addr(Inst_in_ID[24:20]),\n        .Wt_addr(Rd_addr_ID),\n        .Wt_data(Wt_data_ID),\n        .RegWrite(RegWrite_in_ID),\n        .Rs1_data(Regs_Rs1_data),\n        .Rs2_data(Regs_Rs2_data)\n    );\n \n    // å®ä¾‹åŒ–ç«‹å³æ•°ç”Ÿæˆå™¨\n    ImmGen ImmGen_0(\n        .ImmSel(SCPU_ctrl_ImmSel), \n        .inst_field(Inst_in_ID),\n        .Imm_out(ImmGen_out)\n    );\n \n    // å®ä¾‹åŒ–æ§åˆ¶å™¨\n    my_SCPU_ctrl SCPU_ctrl_0(\n        .OPcode(Inst_in_ID[6:2]),\n        .Fun3(Inst_in_ID[14:12]),\n        .Fun7(Inst_in_ID[30]),\n        .ImmSel(SCPU_ctrl_ImmSel),\n        .ALUSrc_B(SCPU_ctrl_ALUSrc_B),\n        .MemtoReg(SCPU_ctrl_MemtoReg),\n        .Jump(SCPU_ctrl_Jump),\n        .Branch(SCPU_ctrl_Branch),\n        .BranchN(SCPU_ctrl_BranchN),\n        .RegWrite(SCPU_ctrl_RegWrite),\n        .MemRW(SCPU_ctrl_MemRW),\n        .ALU_Control(SCPU_ctrl_ALU_Control)\n        //.CPU_MIO()\n    );\n \n    always @(*) begin\n        Rs1_out_ID = Regs_Rs1_data;\n        Rs2_out_ID = Regs_Rs2_data;\n        Imm_out_ID = ImmGen_out;\n        ALUSrc_B_ID = SCPU_ctrl_ALUSrc_B;\n        MemtoReg_ID = SCPU_ctrl_MemtoReg;\n        Jump_ID = SCPU_ctrl_Jump;\n        Branch_ID = SCPU_ctrl_Branch;\n        BranchN_ID = SCPU_ctrl_BranchN;\n        RegWrite_out_ID = SCPU_ctrl_RegWrite;\n        MemRW_ID = SCPU_ctrl_MemRW;\n        ALU_control_ID = SCPU_ctrl_ALU_Control;\n        Rd_addr_out_ID = Inst_in_ID[11:7];\n    end\n \nendmodule\n\nä¸Šä¸‹æ–‡ä¿å­˜,åœ¨æ—¶é’Ÿä¸Šå‡æ²¿é”å­˜æ‰€æœ‰æ§åˆ¶ä¿¡å·å’Œæ•°æ®ä¿¡æ¯\nåŒæ ·æœ‰å¤ä½å’Œæš‚åœçš„åŠŸèƒ½\n\n    always @(posedge clk_IDEX or posedge rst_IDEX) begin\n        if (rst_IDEX == 1&#039;b1) begin\n            PC_out_IDEX &lt;= 32&#039;b0;\n            Rd_addr_out_IDEX &lt;= 5&#039;b0;\n            Rs1_out_IDEX &lt;= 32&#039;b0;\n            Rs2_out_IDEX &lt;= 32&#039;b0;\n            Imm_out_IDEX &lt;= 32&#039;b0;\n            ALUSrc_B_out_IDEX &lt;= 1&#039;b0;\n            ALU_control_out_IDEX &lt;= 3&#039;b0;\n            Branch_out_IDEX &lt;= 1&#039;b0;\n            BranchN_out_IDEX &lt;= 1&#039;b0;\n            MemRW_out_IDEX &lt;= 1&#039;b0;\n            Jump_out_IDEX &lt;= 1&#039;b0;\n            MemtoReg_out_IDEX &lt;= 2&#039;b0;\n            RegWrite_out_IDEX &lt;= 1&#039;b0;\n        end\n        else if (en_IDEX == 1&#039;b1) begin\n            PC_out_IDEX &lt;= PC_in_IDEX;\n            Rd_addr_out_IDEX &lt;= Rd_addr_IDEX;\n            Rs1_out_IDEX &lt;= Rs1_in_IDEX;\n            Rs2_out_IDEX &lt;= Rs2_in_IDEX;\n            Imm_out_IDEX &lt;= Imm_in_IDEX;\n            ALUSrc_B_out_IDEX &lt;= ALUSrc_B_in_IDEX;\n            ALU_control_out_IDEX &lt;= ALU_control_in_IDEX;\n            Branch_out_IDEX &lt;= Branch_in_IDEX;\n            BranchN_out_IDEX &lt;= BranchN_in_IDEX;\n            MemRW_out_IDEX &lt;= MemRW_in_IDEX;\n            Jump_out_IDEX &lt;= Jump_in_IDEX;\n            MemtoReg_out_IDEX &lt;= MemtoReg_in_IDEX;\n            RegWrite_out_IDEX &lt;= RegWrite_in_IDEX;\n        end\n    end\n \nendmodule\n \nEXæ¨¡å—ä¸å¯„å­˜å™¨è®¾è®¡\n\nåŒè·¯åœ°å€è®¡ç®—\n\nè®¡ç®—PC+Imm\nè®¡ç®—PC+4\n\n\nè¿ç®—æ“ä½œALU\n\næ“ä½œæ•°é€‰æ‹©\næ‰§è¡Œè¿ç®—å¹¶ä¸”ç”Ÿæˆzeroæ ‡å¿—ä½\n\n\nå°†rs2çš„åŸå§‹æ•°æ®ç›´æ¥ä¼ é€’(ä¸ºäº†storeæŒ‡ä»¤)\n\n    // è®¡ç®— PC + 4\n    add_32 add_32_1(\n        .a(32&#039;d4),\n        .b(PC_in_EX),\n        .c(add_32_1_c)\n    );\n \n    // è®¡ç®— PC + Imm (ç”¨äºåˆ†æ”¯/è·³è½¬ç›®æ ‡åœ°å€)\n    add_32 add_32_0(\n        .a(PC_in_EX),\n        .b(Imm_in_EX),\n        .c(add_32_0_c)\n    );\n \n    // ALU è¾“å…¥ B é€‰æ‹© (å¯„å­˜å™¨æ•°æ® æˆ– ç«‹å³æ•°)\n    MUX2T1_32 MUX2T1_32_0(\n        .I0(Rs2_in_EX),\n        .I1(Imm_in_EX),\n        .s(ALUSrc_B_in_EX),\n        .o(MUX2T1_32_0_o)\n    );\n \n    // ALU è¿ç®—\n    ALU ALU(\n        .A(Rs1_in_EX),\n        .ALU_operation(ALU_control_in_EX),\n        .B(MUX2T1_32_0_o),\n        .res(ALU_res),\n        .zero(ALU_zero)\n    );\n \n    always @(*) begin\n        PC4_out_EX = add_32_1_c;\n        PC_out_EX = add_32_0_c;\n        ALU_out_EX = ALU_res;\n        zero_out_EX = ALU_zero;\n        Rs2_out_EX = Rs2_in_EX;\n    end\n\nåœ¨æ—¶é’Ÿä¸Šå‡æ²¿,é”å­˜ALUçš„è®¡ç®—ç»“æœ\\è·³è½¬åœ°å€\\zeroæ ‡å¿—\næ§åˆ¶ä¿¡å·ç­›é€‰\n\nexé˜¶æ®µç”¨è¿‡çš„ä¿¡å·ä¸å†ä¼ é€’\nä¿ç•™memçº§éœ€è¦ä½¿ç”¨çš„æ§åˆ¶ä¿¡å·\n\n\n\n    always @(posedge clk_EXMem or posedge rst_EXMem) begin\n        if (rst_EXMem == 1&#039;b1) begin\n            PC_out_EXMem &lt;= 32&#039;b0;\n            PC4_out_EXMem &lt;= 32&#039;b0;\n            Rd_addr_out_EXMem &lt;= 5&#039;b0;\n            zero_out_EXMem &lt;= 1&#039;b0;\n            ALU_out_EXMem &lt;= 32&#039;b0;\n            Rs2_out_EXMem &lt;= 32&#039;b0;\n            Branch_out_EXMem &lt;= 1&#039;b0;\n            BranchN_out_EXMem &lt;= 1&#039;b0;\n            MemRW_out_EXMem &lt;= 1&#039;b0;\n            Jump_out_EXMem &lt;= 1&#039;b0;\n            MemtoReg_out_EXMem &lt;= 2&#039;b0;\n            RegWrite_out_EXMem &lt;= 1&#039;b0;\n        end\n        else if (en_EXMem == 1&#039;b1) begin\n            PC_out_EXMem &lt;= PC_in_EXMem;\n            PC4_out_EXMem &lt;= PC4_in_EXMem;\n            Rd_addr_out_EXMem &lt;= Rd_addr_EXMem;\n            zero_out_EXMem &lt;= zero_in_EXMem;\n            ALU_out_EXMem &lt;= ALU_in_EXMem;\n            Rs2_out_EXMem &lt;= Rs2_in_EXMem;\n            Branch_out_EXMem &lt;= Branch_in_EXMem;\n            BranchN_out_EXMem &lt;= BranchN_in_EXMem;\n            MemRW_out_EXMem &lt;= MemRW_in_EXMem;\n            Jump_out_EXMem &lt;= Jump_in_EXMem;\n            MemtoReg_out_EXMem &lt;= MemtoReg_in_EXMem;\n            RegWrite_out_EXMem &lt;= RegWrite_in_EXMem;\n        end\n    end\nMEMæ¨¡å—ä¸å¯„å­˜å™¨è®¾è®¡\n\nç”ŸæˆPCsrc,ä¼ é€’ç»™IFé˜¶æ®µçš„MUXä¸‹ä¸€æ¡æŒ‡ä»¤æ˜¯ç»§ç»­æŒ‰é¡ºåºå–è¿˜æ˜¯è·³è½¬åˆ°exé˜¶æ®µç”Ÿæˆçš„ç›®æ ‡åœ°å€\n\nmodule Pipeline_Mem(\n    input zero_in_Mem,       // zero ä¿¡å·\n    input Branch_in_Mem,     // beq ä¿¡å·\n    input BranchN_in_Mem,    // bne ä¿¡å·\n    input Jump_in_Mem,       // jal ä¿¡å·\n    output PCSrc             // PC é€‰æ‹©æ§åˆ¶è¾“å‡º\n);\n \n    assign PCSrc = Jump_in_Mem | (Branch_in_Mem &amp; zero_in_Mem) | (BranchN_in_Mem &amp; ~zero_in_Mem);\n \nendmodule\n\né”å­˜ALUè®¡ç®—ç»“æœå’Œæ•°æ®å­˜å‚¨å™¨çš„è¯»å‡ºæ•°æ®\nå°†æœ€ç»ˆçš„ç›®æ ‡å¯„å­˜å™¨åœ°å€å’Œå†™å›æ§åˆ¶ä¿¡å·ä¼ é€’ç»™wb\n\n    always @(posedge clk_MemWB or posedge rst_MemWB) begin\n        if (rst_MemWB == 1&#039;b1) begin\n            PC4_out_MemWB &lt;= 32&#039;b0;\n            Rd_addr_out_MemWB &lt;= 5&#039;b0;\n            ALU_out_MemWB &lt;= 32&#039;b0;\n            DMem_data_out_MemWB &lt;= 32&#039;b0;\n            MemtoReg_out_MemWB &lt;= 2&#039;b0;\n            RegWrite_out_MemWB &lt;= 1&#039;b0;\n        end\n        else if (en_MemWB == 1&#039;b1) begin\n            PC4_out_MemWB &lt;= PC4_in_MemWB;\n            Rd_addr_out_MemWB &lt;= Rd_addr_MemWB;\n            ALU_out_MemWB &lt;= ALU_in_MemWB;\n            DMem_data_out_MemWB &lt;= DMem_data_MemWB;\n            MemtoReg_out_MemWB &lt;= MemtoReg_in_MemWB;\n            RegWrite_out_MemWB &lt;= RegWrite_in_MemWB;\n        end\n    end\nWBæ¨¡å—è®¾è®¡\n\nå¤šæºæ•°æ®é€‰æ‹©,å†³å®šå“ªä¸ªæ•°æ®èƒ½è¢«å†™å…¥ç›®æ ‡å¯„å­˜å™¨\n\nALUè®¡ç®—ç»“æœ\nå†…å­˜è¯»å–æ•°æ®\nè¿”å›åœ°å€PC+4\n\n\nè¾“å‡ºçš„dataoutä¿¡å·ä¼šè¿æ¥åˆ°IDé˜¶æ®µå¯„å­˜å™¨å †å†™å…¥ç«¯å£\n\nmodule Pipeline_WB(\n    input [31:0] PC4_in_WB,\n    input [31:0] ALU_in_WB,\n    input [31:0] DMem_data_WB,\n    input [1:0] MemtoReg_in_WB,\n    output [31:0] Data_out_WB\n);\n \n    MUX4T1_32 MUX4T1_32_0(\n        .s(MemtoReg_in_WB),\n        .I0(ALU_in_WB),       \n        .I1(DMem_data_WB),    \n        .I2(PC4_in_WB),       \n        .I3(PC4_in_WB),        \n        .o(Data_out_WB)\n    );\n \nendmodule\n \né‡‡ç”¨stallæœºåˆ¶å¤„ç†æµæ°´çº¿å†’é™©\nstall.v\n\næ•°æ®å†’é™©:å…¨åœé¡¿\n\nåªè¦åé¢æµæ°´çº¿çº§åˆ«æœ‰æŒ‡ä»¤è¦å†™å¯„å­˜å™¨,ä¸”å½“å‰IDæŒ‡ä»¤æ­£å¥½è¯»åŒä¸€ä¸ªå¯„å­˜å™¨,å°±è§†ä¸ºå†²çª.\n\nen_IFå’Œen_IFIDç½®0\nNOP_IDEXç½®1,æ’å…¥æ°”æ³¡\n\n\n\n\næ§åˆ¶å†’é™©:å…¨å†²åˆ·\n\nmemé˜¶æ®µåˆ¤æ–­åˆ†æ”¯è·³è½¬æˆåŠŸ,åç»­æ‰€æœ‰æŒ‡ä»¤éƒ½éœ€è¦è¢«flush\nPCsrcä¸º1,é‚£ä¹ˆnopå…¨éƒ½è®¾ä¸º1\n\n\n\n \nmodule stall(\n    input rst_stall,\n \n    input RegWrite_out_IDEX,\n    input [4:0] Rd_addr_out_IDEX,\n    input RegWrite_out_EXMem,\n    input [4:0] Rd_addr_out_EXMem,\n    input RegWrite_out_MemWB,      \n    input [4:0] Rd_addr_out_MemWB,\n    input [4:0] Rs1_addr_ID,\n    input [4:0] Rs2_addr_ID,\n    input Rs1_used,\n    input Rs2_used,\n    \n    input PCSrc, \n    \n    output NOP_EXMem, \n    output en_IF,\n    output en_IFID,\n    output NOP_IFID,\n    output NOP_IDEX\n);\n    reg Data_stall;\n \n    always @(*) begin\n        Data_stall = 0;\n        if (RegWrite_out_IDEX &amp;&amp; Rs1_used &amp;&amp; Rs1_addr_ID != 0 &amp;&amp; Rd_addr_out_IDEX == Rs1_addr_ID) Data_stall = 1;\n        else if (RegWrite_out_IDEX &amp;&amp; Rs2_used &amp;&amp; Rs2_addr_ID != 0 &amp;&amp; Rd_addr_out_IDEX == Rs2_addr_ID) Data_stall = 1;\n        else if (RegWrite_out_EXMem &amp;&amp; Rs1_used &amp;&amp; Rs1_addr_ID != 0 &amp;&amp; Rd_addr_out_EXMem == Rs1_addr_ID) Data_stall = 1;\n        else if (RegWrite_out_EXMem &amp;&amp; Rs2_used &amp;&amp; Rs2_addr_ID != 0 &amp;&amp; Rd_addr_out_EXMem == Rs2_addr_ID) Data_stall = 1;\n        else if (RegWrite_out_MemWB &amp;&amp; Rs1_used &amp;&amp; Rs1_addr_ID != 0 &amp;&amp; Rd_addr_out_MemWB == Rs1_addr_ID) Data_stall = 1;\n        else if (RegWrite_out_MemWB &amp;&amp; Rs2_used &amp;&amp; Rs2_addr_ID != 0 &amp;&amp; Rd_addr_out_MemWB == Rs2_addr_ID) Data_stall = 1;\n    end\n \n    \n    assign en_IF    = ~Data_stall;  // æ•°æ®å†’é™©æ—¶åœé¡¿ PC\n    assign en_IFID  = ~Data_stall;  // æ•°æ®å†’é™©æ—¶åœé¡¿ IF/ID\n    \n    assign NOP_IDEX = Data_stall || PCSrc; \n \n    assign NOP_IFID = PCSrc;  \n    \n    assign NOP_EXMem = PCSrc;      \n \nendmodule\nè¯‘ç æ¨¡å—ã€æµæ°´çº¿å¯„å­˜å™¨é‡æ–°è®¾è®¡é›†æˆ\nIF\nen_IFä¸º0æ—¶,PCå¯„å­˜å™¨ä¿æŒä¸å˜\nä¼˜å…ˆçº§:\n\nreset\nå½“å‘ç”Ÿ Load-Use å†’é™©æ—¶ï¼Œen ä¸º 0ï¼Œalways å—ä¸­çš„ else if ä¸æ‰§è¡Œï¼Œå¯„å­˜å™¨ä¿æŒåŸå€¼,é…åˆ IF é˜¶æ®µçš„ Stallï¼Œå®ç°äº†æµæ°´çº¿æš‚åœ\nå½“ en ä¸º 1 æ—¶ï¼ˆå³æ²¡æœ‰æš‚åœï¼‰å¦‚æœæ£€æµ‹åˆ°æ§åˆ¶å†’é™©(å¦‚åˆ†æ”¯è·³è½¬æˆåŠŸï¼‰NOP ä¿¡å·ç”Ÿæ•ˆï¼Œå°†è¾“å‡ºå¼ºåˆ¶æ¸…é›¶ï¼ˆå˜æˆ NOP 32â€™b0ï¼‰ç›¸å½“äºä¸¢å¼ƒäº†å½“å‰å–åˆ°çš„é”™è¯¯æŒ‡ä»¤ã€‚\n\n   always @(posedge clk_IFID or posedge rst_IFID) begin\n        if (rst_IFID == 1&#039;b1) begin\n            PC_out_IFID &lt;= 32&#039;b0;\n            inst_out_IFID &lt;= 32&#039;b0;\n        end\n        else if (en_IFID == 1&#039;b1) begin\n            if (NOP_IFID == 1&#039;b1) begin\n                PC_out_IFID &lt;= 32&#039;b0;\n                inst_out_IFID &lt;= 32&#039;b0; // æ’å…¥ NOP (0x00000000 è§†ä¸º nop)\n            end\n            else begin\n                PC_out_IFID &lt;= PC_in_IFID;\n                inst_out_IFID &lt;= inst_in_IFID;\n            end\n        end\n    end\nID\nå¢åŠ äº†Rs1_usedå’ŒRs2_usedè¿™ä¸¤ä¸ªè¾“å‡ºä¿¡å·,ä»¥ä¾¿äºå†’é™©æ£€æµ‹å•å…ƒä½¿ç”¨\n    // åˆ¤æ–­å¯„å­˜å™¨æ˜¯å¦è¢«ä½¿ç”¨ (æ ¹æ® Opcode åˆ¤æ–­)\n    // R-type (0110011), I-type (0010011, 0000011, 1100111 jalr), S-type (0100011), B-type (1100011) ä½¿ç”¨ Rs1\n    // U-type (0110111, 0010111), J-type (1101111) ä¸ä½¿ç”¨ Rs1\n    assign Rs1_used = (Inst_in_ID[6:0] != 7&#039;b0110111) &amp;&amp; (Inst_in_ID[6:0] != 7&#039;b0010111) &amp;&amp; (Inst_in_ID[6:0] != 7&#039;b1101111);\n \nå®ç°æ’å…¥æ°”æ³¡:å½“å‘ç”ŸLoad_Useå†’é™©æ—¶,å†’é™©æ£€æµ‹å•å…ƒ:\n\nen_IF=0\nen_IFID = 0\nNOP_IDEX = 1å†²åˆ·ID/EX\nå¹¶ä¸”ID_reg_Exå°†è¾“å‡ºçš„æ§åˆ¶ä¿¡å·å…¨éƒ¨ç½®ä¸º0\n\n    always @(posedge clk_IDEX or posedge rst_IDEX) begin\n        if (rst_IDEX == 1&#039;b1) begin\n            PC_out_IDEX &lt;= 32&#039;b0;\n            Rd_addr_out_IDEX &lt;= 5&#039;b0;\n            Rs1_out_IDEX &lt;= 32&#039;b0;\n            Rs2_out_IDEX &lt;= 32&#039;b0;\n            Imm_out_IDEX &lt;= 32&#039;b0;\n            ALUSrc_B_out_IDEX &lt;= 1&#039;b0;\n            ALU_control_out_IDEX &lt;= 4&#039;b0;\n            Branch_out_IDEX &lt;= 1&#039;b0;\n            BranchN_out_IDEX &lt;= 1&#039;b0;\n            MemRW_out_IDEX &lt;= 1&#039;b0;\n            Jump_out_IDEX &lt;= 1&#039;b0;\n            MemtoReg_out_IDEX &lt;= 2&#039;b0;\n            RegWrite_out_IDEX &lt;= 1&#039;b0;\n        end\n        else if (en_IDEX == 1&#039;b1) begin\n            if (NOP_IDEX == 1&#039;b1) begin\n                // æ’å…¥æ°”æ³¡ï¼šæŠŠå†™ä½¿èƒ½å’Œåˆ†æ”¯ä¿¡å·æ¸…é›¶ (æ ¸å¿ƒæ§åˆ¶ä¿¡å·)\n                RegWrite_out_IDEX &lt;= 1&#039;b0;     // ç¦æ­¢å†™å›å¯„å­˜å™¨\n                MemRW_out_IDEX &lt;= 1&#039;b0;        // ç¦æ­¢å†™å†…å­˜\n                Branch_out_IDEX &lt;= 1&#039;b0;       // ç¦æ­¢åˆ†æ”¯\n                BranchN_out_IDEX &lt;= 1&#039;b0;      // ç¦æ­¢åˆ†æ”¯\n                Jump_out_IDEX &lt;= 1&#039;b0;         // ç¦æ­¢è·³è½¬\n                \n                // å…¶ä»–æ§åˆ¶ä¿¡å·æ¸…é›¶\n                MemtoReg_out_IDEX &lt;= 2&#039;b0;\n                ALUSrc_B_out_IDEX &lt;= 1&#039;b0;\n                ALU_control_out_IDEX &lt;= 4&#039;b0;\n \n                PC_out_IDEX &lt;= 32&#039;b0;\n                Rd_addr_out_IDEX &lt;= 5&#039;b0;      // ç›®æ ‡å¯„å­˜å™¨åœ°å€è®¾ä¸º0\n                Rs1_out_IDEX &lt;= 32&#039;b0;\n                Rs2_out_IDEX &lt;= 32&#039;b0;\n                Imm_out_IDEX &lt;= 32&#039;b0;\n            end\n            else begin\n                // æ­£å¸¸ä¼ é€’ä¿¡å·\n                PC_out_IDEX &lt;= PC_in_IDEX;\n                Rd_addr_out_IDEX &lt;= Rd_addr_IDEX;\n                Rs1_out_IDEX &lt;= Rs1_in_IDEX;\n                Rs2_out_IDEX &lt;= Rs2_in_IDEX;\n                Imm_out_IDEX &lt;= Imm_in_IDEX;\n                ALUSrc_B_out_IDEX &lt;= ALUSrc_B_in_IDEX;\n                ALU_control_out_IDEX &lt;= ALU_control_in_IDEX;\n                Branch_out_IDEX &lt;= Branch_in_IDEX;\n                BranchN_out_IDEX &lt;= BranchN_in_IDEX;\n                MemRW_out_IDEX &lt;= MemRW_in_IDEX;\n                Jump_out_IDEX &lt;= Jump_in_IDEX;\n                MemtoReg_out_IDEX &lt;= MemtoReg_in_IDEX;\n                RegWrite_out_IDEX &lt;= RegWrite_in_IDEX;\n            end\n        end\n    end\nEX\n\næ·»åŠ äº†NOP_EXMem\n\nå½“åˆ†æ”¯è·³è½¬æˆåŠŸæ—¶,memä¼šæ£€æµ‹åˆ°éœ€è¦è·³è½¬,é‚£ä¹ˆå†²åˆ·æ‰ex/memæµæ°´çº¿å¯„å­˜å™¨ä¸­çš„æŒ‡ä»¤:å°†regwrite\\memRW\\branchç­‰å…³é”®æ§åˆ¶ä¿¡å·ç½®0\n\n\n\n    always @(posedge clk_EXMem or posedge rst_EXMem) begin\n        if (rst_EXMem == 1&#039;b1) begin\n            PC_out_EXMem &lt;= 32&#039;b0;\n            PC4_out_EXMem &lt;= 32&#039;b0;\n            Rd_addr_out_EXMem &lt;= 5&#039;b0;\n            zero_out_EXMem &lt;= 1&#039;b0;\n            ALU_out_EXMem &lt;= 32&#039;b0;\n            Rs2_out_EXMem &lt;= 32&#039;b0;\n            Branch_out_EXMem &lt;= 1&#039;b0;\n            BranchN_out_EXMem &lt;= 1&#039;b0;\n            MemRW_out_EXMem &lt;= 1&#039;b0;\n            Jump_out_EXMem &lt;= 1&#039;b0;\n            MemtoReg_out_EXMem &lt;= 2&#039;b0;\n            RegWrite_out_EXMem &lt;= 1&#039;b0;\n        end\n        else if (en_EXMem == 1&#039;b1) begin\n            if (NOP_EXMem == 1&#039;b1) begin\n                RegWrite_out_EXMem &lt;= 1&#039;b0; // ç¦æ­¢å†™å¯„å­˜å™¨\n                MemRW_out_EXMem &lt;= 1&#039;b0;    // ç¦æ­¢å†™å†…å­˜\n                Branch_out_EXMem &lt;= 1&#039;b0;   // ç¦æ­¢åˆ†æ”¯\n                BranchN_out_EXMem &lt;= 1&#039;b0;\n                Jump_out_EXMem &lt;= 1&#039;b0;     // ç¦æ­¢è·³è½¬\n                \n                PC_out_EXMem &lt;= 32&#039;b0;\n                \n                PC4_out_EXMem &lt;= 32&#039;b0;\n                Rd_addr_out_EXMem &lt;= 5&#039;b0;\n                zero_out_EXMem &lt;= 1&#039;b0;\n                ALU_out_EXMem &lt;= 32&#039;b0;\n                Rs2_out_EXMem &lt;= 32&#039;b0;\n                MemtoReg_out_EXMem &lt;= 2&#039;b0;\n            end\n            else begin\n                PC_out_EXMem &lt;= PC_in_EXMem;\n                PC4_out_EXMem &lt;= PC4_in_EXMem;\n                Rd_addr_out_EXMem &lt;= Rd_addr_EXMem;\n                zero_out_EXMem &lt;= zero_in_EXMem;\n                ALU_out_EXMem &lt;= ALU_in_EXMem;\n                Rs2_out_EXMem &lt;= Rs2_in_EXMem;\n                Branch_out_EXMem &lt;= Branch_in_EXMem;\n                BranchN_out_EXMem &lt;= BranchN_in_EXMem;\n                MemRW_out_EXMem &lt;= MemRW_in_EXMem;\n                Jump_out_EXMem &lt;= Jump_in_EXMem;\n                MemtoReg_out_EXMem &lt;= MemtoReg_in_EXMem;\n                RegWrite_out_EXMem &lt;= RegWrite_in_EXMem;\n            end\n        end\n    end\nMEM\nä¸éœ€è¦ä¿®æ”¹\nWB\nä¸éœ€è¦ä¿®æ”¹"},"æŠ€æœ¯ç§¯ç´¯/Golang/åº“/ACMæ¨¡å¼":{"slug":"æŠ€æœ¯ç§¯ç´¯/Golang/åº“/ACMæ¨¡å¼","filePath":"æŠ€æœ¯ç§¯ç´¯/Golang/åº“/ACMæ¨¡å¼.md","title":"ACMæ¨¡å¼","links":[],"tags":[],"content":"package main // å¿…é¡»æ˜¯ main åŒ…\n \nimport (\n    &quot;fmt&quot;\n    // &quot;bufio&quot; // å¤„ç†å¤§é‡/å¤æ‚è¾“å…¥æ—¶ç”¨\n    // &quot;os&quot;\n    // &quot;strconv&quot; // å­—ç¬¦ä¸²è½¬æ•°å­—\n    // &quot;strings&quot; // å­—ç¬¦ä¸²å¤„ç†\n)\n \nfunc main() {\n    // 1. è¯»å–è¾“å…¥\n    // 2. é€»è¾‘å¤„ç†\n    // 3. æ‰“å°è¾“å‡º\n}\nè¾“å…¥å¤„ç†\næ•°æ®é‡å°/æ ¼å¼ç®€å•\nfmt.Scan\n\nfmt.Scan(&amp;a): è¯»å–ä¸‹ä¸€ä¸ª tokenï¼ˆä»¥ç©ºæ ¼æˆ–æ¢è¡Œåˆ†éš”ï¼‰\nfmt.Scanln(&amp;a): è¯»å–ç›´åˆ°æ¢è¡Œï¼ˆä½†åœ¨å¤„ç†å¤æ‚è¾“å…¥æ—¶å®¹æ˜“å› ä¸ºæ¢è¡Œç¬¦å‡ºé—®é¢˜ï¼Œå»ºè®®ä¸»è¦ç”¨ Scanï¼‰\n\n// è¯»å–ä¸¤ä¸ªæ•´æ•° a å’Œ b\nvar a, b int\nfmt.Scan(&amp;a, &amp;b) // è‡ªåŠ¨è·³è¿‡ç©ºç™½ç¬¦\næ•°æ®é‡å¤§/ä¸€è¡Œä¸€è¡Œè¯»å–\næ¯”å¦‚10çš„5æ¬¡æ–¹çº§åˆ«\nbufio.Scanner\ninput := bufio.NewScanner(os.Stdin)\ninput.Scan() // è¯»å–ä¸‹ä¸€è¡Œ\nline := input.Text() // è·å–è¯¥è¡Œå­—ç¬¦ä¸²\nç¤ºä¾‹\nå›ºå®šè¡Œæ•°è¾“å…¥\npackage main\n \nimport &quot;fmt&quot;\n \nfunc main() {\n    var n int\n    fmt.Scan(&amp;n) // è¯»å–æ•°ç»„é•¿åº¦\n \n    arr := make([]int, n)\n    for i := 0; i &lt; n; i++ {\n        fmt.Scan(&amp;arr[i]) // å¾ªç¯è¯»å–æ¯ä¸ªå…ƒç´ \n    }\n    \n    // å¤„ç†é€»è¾‘...\n    fmt.Println(arr)\n}\nå¤šè¡Œè¾“å…¥ç›´åˆ°EOF\nå¾ªç¯è¯»å–ç›´åˆ°æ— æ³•è¯»å–ä¸ºæ­¢\npackage main\n \nimport (\n    &quot;fmt&quot;\n    &quot;io&quot;\n)\n \nfunc main() {\n    var a, b int\n    // Scan è¿”å›æˆåŠŸè¯»å–çš„å‚æ•°ä¸ªæ•°å’Œé”™è¯¯\n    for {\n        _, err := fmt.Scan(&amp;a, &amp;b)\n        if err == io.EOF {\n            break // è¯»å®Œäº†\n        }\n        // å¤„ç†é€»è¾‘\n        fmt.Println(a + b)\n    }\n}\nè¯»å–ä¸€æ•´è¡Œå­—ç¬¦ä¸²åŒ…æ‹¬ç©ºæ ¼\npackage main\n \nimport (\n    &quot;bufio&quot;\n    &quot;fmt&quot;\n    &quot;os&quot;\n    &quot;strings&quot;\n)\n \nfunc main() {\n    // åˆ›å»ºä¸€ä¸ªä»æ ‡å‡†è¾“å…¥è¯»å–çš„ Scanner\n    scanner := bufio.NewScanner(os.Stdin)\n    \n    // å¾ªç¯è¯»å–æ¯ä¸€è¡Œ\n    // å¦‚æœè¯»åˆ°äº†ï¼Œè¿”å› trueï¼›å¦‚æœè¯»å®Œäº†(EOF)æˆ–å‡ºé”™äº†ï¼Œè¿”å› falseï¼Œå¾ªç¯å°±ä¼šåœæ­¢ã€‚\n    for scanner.Scan() {\n        line := scanner.Text() // è¯»å–åˆ°çš„è¿™ä¸€è¡Œå­—ç¬¦ä¸²\n        if line == &quot;&quot; {\n            break\n        }\n        \n        // ç»å¸¸éœ€è¦æŒ‰ç©ºæ ¼åˆ‡å‰²è¿™ä¸€è¡Œ\n        //line := &quot;10 20 30&quot;\n        \n        parts := strings.Split(line, &quot; &quot;)//çœ‹åˆ°ç©ºæ ¼å°±åˆ‡å¼€\n        fmt.Println(parts) //parts := []string{&quot;10&quot;, &quot;20&quot;, &quot;30&quot;}\n        \n    }\n}\né«˜æ€§èƒ½è¯»å–\npackage main\n \nimport (\n    &quot;bufio&quot;\n    &quot;fmt&quot;\n    &quot;os&quot;\n    &quot;strconv&quot;\n    &quot;strings&quot;\n)\n \nfunc main() {\n    // å‡†å¤‡\n    scanner := bufio.NewScanner(os.Stdin)\n    // è®¾ç½®ç¼“å†²åŒºå¤§å°ï¼Œé˜²æ­¢å•è¡Œæ•°æ®è¿‡å¤§æŠ¥é”™ï¼ˆå¯é€‰ï¼Œè§†é¢˜ç›®è€Œå®šï¼‰\n    buf := make([]byte, 2048*1024)\n    scanner.Buffer(buf, len(buf))\n    \n    for scanner.Scan() {\n        // è¯»å–åŸå§‹å­—ç¬¦ä¸²è¡Œ\n        line := strings.TrimSpace(scanner.Text())//è¿™ä¸ªå¯ä»¥å»æ‰é¦–å°¾çš„ç©ºæ ¼å’Œæ¢è¡Œç¬¦\n        if line == &quot;&quot; {\n            continue\n        }\n        \n        // æ‰‹åŠ¨è½¬æ•°å­—\n        // æ³¨æ„ï¼šè¿™é‡Œéœ€è¦å¤„ç† errorï¼Œä½†åœ¨ç®—æ³•é¢˜ä¸­é€šå¸¸å‡è®¾è¾“å…¥åˆæ³•\n        //è¾“å…¥è¿›æ¥çš„æ°¸è¿œæ˜¯å­—ç¬¦ä¸²ç±»å‹,æ¯”å¦‚100 å¦‚æœè¦åšåŠ æ³•å¿…é¡»è¦å˜æˆæ•´æ•°\n        //è¿”å›è½¬æ¢åçš„æ•°å­—ä»¥åŠæ˜¯å¦å‡ºé”™\n        num, _ := strconv.Atoi(line) \n        fmt.Println(num)\n    }\n}\nè¾“å‡ºå¤„ç†\næ™®é€šè¾“å‡º: fmt.Println(ans) //è‡ªåŠ¨æ¢è¡Œ\næ ¼å¼åŒ–è¾“å‡º: fmt.Printf(&quot;%.2f\\n&quot;, floatVal) (ä¿ç•™å°æ•°ç­‰)\næ•°ç»„è¾“å‡º: ç©ºæ ¼éš”å¼€ æœ€åä¸€ä¸ªæ²¡ç©ºæ ¼\nres := []int{1, 2, 3}\nfor i, v := range res {\n//ç¬¬ä¸€è½®ä¸æ‰“å°ç©ºæ ¼\n    if i &gt; 0 {\n        fmt.Print(&quot; &quot;)\n    }\n    fmt.Print(v)\n}\nfmt.Println() // è®°å¾—æœ€åæ¢è¡Œ ä¸ç„¶çš„è¯ä¸‹ä¸€ç»„ç­”æ¡ˆä¼šç²˜åœ¨ä¸Šä¸€è¡Œçš„è¡Œå°¾"},"æŠ€æœ¯ç§¯ç´¯/Golang/åº“/Golangæ ‡å‡†åº“":{"slug":"æŠ€æœ¯ç§¯ç´¯/Golang/åº“/Golangæ ‡å‡†åº“","filePath":"æŠ€æœ¯ç§¯ç´¯/Golang/åº“/Golangæ ‡å‡†åº“.md","title":"Golangæ ‡å‡†åº“","links":[],"tags":[],"content":"j := sort.SearchInts(g, x) goæ ‡å‡†åº“çš„äºŒåˆ†æŸ¥æ‰¾,åœ¨gä¸­æŸ¥æ‰¾ç¬¬ä¸€ä¸ª&gt;=xçš„ä½ç½®,å¦‚æœgä¸­æ‰€æœ‰æ•°éƒ½&lt;x,å°±ä¼šè¿”å›len(g)//è¿™é‡Œæ˜¯æ¯”æœ€å¤§ä¸‹æ ‡è¿˜å¤§1"},"æŠ€æœ¯ç§¯ç´¯/Golang/åº“/fmt":{"slug":"æŠ€æœ¯ç§¯ç´¯/Golang/åº“/fmt","filePath":"æŠ€æœ¯ç§¯ç´¯/Golang/åº“/fmt.md","title":"fmt","links":[],"tags":[],"content":"fmt.Print(&quot;Hello&quot;)//ä¸æ¢è¡ŒåŸæ ·è¾“å‡º\nfmt.Println(&quot;a&quot;,&quot;b&quot;)//è‡ªåŠ¨æ¢è¡Œä¸”å‚æ•°ä¹‹é—´è‡ªåŠ¨åŠ ç©ºæ ¼\nfmt.Printf(&quot;æˆ‘æ˜¯%s,%då²&quot;, name, age )//æ ¼å¼åŒ–è¾“å‡º,ä¸æ¢è¡Œ\n \nfmt.Scanln(&amp;n)//è¯»å–åˆ°çš„æ•°æ®æ”¾å…¥åˆ°è¿™ä¸ªåœ°å€ä¸­"},"æŠ€æœ¯ç§¯ç´¯/Golang/åº“/slices":{"slug":"æŠ€æœ¯ç§¯ç´¯/Golang/åº“/slices","filePath":"æŠ€æœ¯ç§¯ç´¯/Golang/åº“/slices.md","title":"slices","links":[],"tags":[],"content":"slices.Sort(x):é’ˆå¯¹æœ‰åºç±»å‹,é»˜è®¤å‡åºæ’åº,ä½¿ç”¨é»˜è®¤æ¯”è¾ƒ.å¯ä»¥å¯¹æ•´æ•°\\æµ®ç‚¹æ•°å’Œå­—ç¬¦ä¸²è¿›è¡Œæ’åº\nnums := []int{3, 1, 2}\nslices.Sort(nums) // nums å˜ä¸º [1, 2, 3]\nslices.SortFunc(x, cmp):é’ˆå¯¹ä»»ä½•ç±»å‹,é€‚ç”¨äºç»“æ„ä½“\\äºŒç»´æ•°ç»„\\è‡ªå®šä¹‰ç±»å‹\næ’åºä½¿ç”¨è‡ªå®šä¹‰æ’åº,å¿…é¡»æä¾›func(a,b,E)int\n// æ¯”è¾ƒå‡½æ•°ï¼šå¦‚æœ p &lt; q è¿”å›è´Ÿæ•°ï¼Œå¦‚æœ p &gt; q è¿”å›æ­£æ•°ï¼Œç›¸ç­‰è¿”å› 0ã€‚\ncmp := func(p, q []int) int { return p[0] - q[0] }\nslices.SortFunc(intervals, cmp)\nåªè¦func(p, q T) intè¿”å›å€¼&gt;0 å°±è®¤ä¸ºp&gt;q,påº”è¯¥æ’åœ¨qçš„åé¢.ä»¥æ­¤ç±»æ¨.\nleftSize := slices.Index(inorder, preorder[0]) è¿”å›åœ¨ç¬¬ä¸€ä¸ªæ•°ç»„ä¸­å¯¹åº”æ•°æ®ç¬¬ä¸€æ¬¡å‡ºç°çš„ä¸‹æ ‡ä½ç½®"},"æŠ€æœ¯ç§¯ç´¯/Golang/åº“/strings":{"slug":"æŠ€æœ¯ç§¯ç´¯/Golang/åº“/strings","filePath":"æŠ€æœ¯ç§¯ç´¯/Golang/åº“/strings.md","title":"strings","links":[],"tags":[],"content":"strings.Builder\nå¸¸ç”¨äºåœ¨å¾ªç¯ä¸­å¯¹å­—ç¬¦ä¸²è¿›è¡Œå¢åŠ çš„æ“ä½œ.builderå°±ç›¸å½“äºä¸€ä¸ªç¼“å†²åŒº,åœ¨æœ€åæ‰ç”Ÿæˆæœ€ç»ˆçš„å­—ç¬¦ä¸².\nimport &quot;strings&quot;\n \nvar sb strings.Builder\nsb.Grow(100)//é¢„åˆ†é…å†…å­˜,å¯ä»¥é¿å…ä¸­é€”å¤šæ¬¡æ‰©å®¹,æé«˜æ€§èƒ½\n \nsb.WriteString(&quot;Hello&quot;) // å†™å…¥å­—ç¬¦ä¸²\nsb.WriteByte(&#039; &#039;) // å†™å…¥å•ä¸ªå­—èŠ‚ (æ¯”å¦‚ç©ºæ ¼)\n \nresult := sb.String()//æœ€ç»ˆç”Ÿæˆç»“æœå­—ç¬¦ä¸²"},"æŠ€æœ¯ç§¯ç´¯/Golang/åº“/è½®å­":{"slug":"æŠ€æœ¯ç§¯ç´¯/Golang/åº“/è½®å­","filePath":"æŠ€æœ¯ç§¯ç´¯/Golang/åº“/è½®å­.md","title":"è½®å­","links":[],"tags":[],"content":"github.com/go-ini/ini\nè¯»å–iniæ–‡ä»¶\næ ‡å‡†åº“\nâ€path/filepathâ€\nJoin æŠŠå¤šä¸ªå­—ç¬¦ä¸²æ‹¼æ¥èµ·æ¥,ç»„æˆä¸€ä¸ªåˆæ³•çš„è·¯å¾„.æœ€é‡è¦çš„æ˜¯å¯ä»¥è‡ªåŠ¨è¯†åˆ«æ“ä½œç³»ç»Ÿ,é€‰ç”¨ä¸åŒçš„è·¯å¾„åˆ†éš”ç¬¦.è€Œä¸æ˜¯ç¡¬ç¼–ç è¿æ¥,æ›´åŠ å¥å£®"},"æŠ€æœ¯ç§¯ç´¯/Golang/æ•°æ®åº“":{"slug":"æŠ€æœ¯ç§¯ç´¯/Golang/æ•°æ®åº“","filePath":"æŠ€æœ¯ç§¯ç´¯/Golang/æ•°æ®åº“.md","title":"æ•°æ®åº“","links":[],"tags":[],"content":"èšç°‡ç´¢å¼•: å¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯å®Œæ•´çš„è¡Œæ•°æ®\nä¸€å¼ è¡¨åªèƒ½æœ‰ä¸€ä¸ª é€šå¸¸æ˜¯ä¸»é”®\néèšç°‡ç´¢å¼• å¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯ç´¢å¼•åˆ—çš„å€¼+ä¸»é”®id"},"æŠ€æœ¯ç§¯ç´¯/Golang/æ ¸å¿ƒçŸ¥è¯†/01-sliceåˆ‡ç‰‡åŠ¨æ€æ•°ç»„ç±»å‹":{"slug":"æŠ€æœ¯ç§¯ç´¯/Golang/æ ¸å¿ƒçŸ¥è¯†/01-sliceåˆ‡ç‰‡åŠ¨æ€æ•°ç»„ç±»å‹","filePath":"æŠ€æœ¯ç§¯ç´¯/Golang/æ ¸å¿ƒçŸ¥è¯†/01 sliceåˆ‡ç‰‡åŠ¨æ€æ•°ç»„ç±»å‹.md","title":"04 sliceåˆ‡ç‰‡åŠ¨æ€æ•°ç»„ç±»å‹","links":[],"tags":[],"content":"tips\n\n\nvar s []byte å¾—åˆ°çš„æ˜¯nilåˆ‡ç‰‡,ä½†æ˜¯å¯ä»¥ç…§å¸¸append goè‡ªå·±ä¼šå¤„ç†.é€‚ç”¨äºä¸çŸ¥é“é•¿åº¦çš„æƒ…å†µä¸‹\n\n\ns:=make([]int,0,k) çŸ¥é“é•¿åº¦çš„æƒ…å†µä¸‹,è¿™ç§åšæ³•æ›´ä¼˜.\n\n\næ³¨æ„åˆ‡ç‰‡æ˜¯å·¦é—­å³å¼€,\n\n\nå›ºå®šé•¿åº¦æ•°ç»„array\nä½†æ˜¯åœ¨goä¸­ä¸ç­‰åŒäºå…¶ä»–è¯­è¨€æ•°ç»„çš„åœ°ä½,å¯ä»¥è¯´sliceæ‰æ˜¯goè¯­è¨€çš„æ•°ç»„.\n\næ ¹æ®ç´¢å¼•åˆå§‹åŒ– æ³¨æ„é»˜è®¤å€¼æ˜¯0\næŸ¥çœ‹æ•°ç»„çš„æ•°æ®ç±»å‹ï¼šé•¿åº¦å˜æˆäº†ç±»å‹çš„ä¸€éƒ¨åˆ†,å› æ­¤å­˜åœ¨ä¸¤ä¸ªé—®é¢˜\n\nå› æ­¤ä¼ å‚çš„æ—¶å€™ä¹Ÿè¦åŒºåˆ†ä¸åŒé•¿åº¦çš„æ•°ç»„äº†\nè€Œä¸”ä»ç„¶æ˜¯ä¸€ä¸ªå€¼ä¼ é€’ï¼ˆæŠŠæœ¬æ¥çš„æ•°ç»„æ‹·è´ç»™å½¢å‚ï¼Œæ‰€ä»¥è¿˜æ˜¯ä¼šæœ‰ä¹‹å‰é‚£ä¸ªå†…å­˜å’Œåœ°å€çš„é—®é¢˜ï¼Œæ‰€ä»¥ä¸èƒ½è¿›è¡Œæ”¹åŠ¨ï¼‰\n\n\næ‰€ä»¥è¯´è¦ä¼ å‚çš„è¯æœ€å¥½è¿˜æ˜¯å†™åŠ¨æ€æ•°ç»„,ä¹Ÿå¯ä»¥ä½¿ç”¨åˆ‡ç‰‡æ“ä½œç¬¦ [:] ä½ å¯ä»¥æŠŠæ•°ç»„â€œåˆ‡â€ä¸€ä¸‹,è¿™é‡Œæ˜¯åˆ›å»ºä¸€ä¸ªå¼•ç”¨ ä¸æ˜¯copy,ç›¸å½“äºä¼ äº†åœ°å€\n\nrangeå…³é”®å­—\næ ¹æ®éå†ä¸åŒé›†åˆè¿”å›ä¸åŒå€¼ã€‚\n\næ•°ç»„æˆ–åˆ‡ç‰‡\n\nè¿”å›ä¸¤ä¸ªå€¼  å½“å‰å…ƒç´ æ‰€åœ¨ç´¢å¼•å’Œå½“å‰å…ƒç´ å€¼æœ¬èº«å¦‚æœä¸å…³å¿ƒæŸä¸ªè¿”å›å€¼çš„è¯å¯ä»¥æŠŠå®ƒè®¾ç½®æˆåŒ¿å\n\n\n\nåŠ¨æ€æ•°ç»„:åˆ‡ç‰‡ slice\næ•°æ®ç»“æ„\nè¿ç»­çš„å†…å­˜,æœ¬èº«åªåŒ…å«ä¸‰ä¸ªä¿¡æ¯(å¯ä»¥åœ¨runtimeåŒ…ä¸‹æŸ¥è¯¢)\ntype slice struct {\n    // æŒ‡å‘èµ·ç‚¹çš„åœ°å€\n    array unsafe.Pointer\n    // åˆ‡ç‰‡é•¿åº¦\n    len   int\n    // åˆ‡ç‰‡å®¹é‡\n    cap   int\n}\n\næŒ‡é’ˆ ç¬¬ä¸€ä¸ªå…ƒç´ çš„å†…å­˜åœ°å€\né•¿åº¦ å½“å‰å­˜æ”¾çš„å…ƒç´ ä¸ªæ•°  è®¿é—®åˆ‡ç‰‡æ˜¯å¦åˆæ³•\nå®¹é‡ æ€»å…±èƒ½è£…å¤šå°‘ä¸ªå…ƒç´ (æå‰åˆ†é…çš„ç©ºé—´å…ƒç´ ä¸ªæ•°),capæ°¸è¿œå¤§äºç­‰äºlen è€ƒè™‘æ€§èƒ½ä¼˜åŒ–\n\n\nç´¢å¼•æ—¶åªéœ€è¦è®¡ç®—ç›®æ ‡åœ°å€ = èµ·å§‹åœ°å€ + ( ç´¢å¼• x æ¯ä¸ªå…ƒç´ çš„å¤§å° ),å› æ­¤æ—¶é—´å¤æ‚åº¦æ˜¯O(1)\n\nç‰¹å¾\n\nä¼ é€’æ—¶è¡¨é¢ä¸Šæ˜¯è¿›è¡Œslice headerçš„å€¼ä¼ é€’,ä½†å› ä¸ºå†…éƒ¨å­˜æ”¾çš„æ˜¯unsafe.Pointeråœ°å€,å› æ­¤å®é™…ä¸Šç›¸å½“äºå¼•ç”¨ä¼ é€’,å¯ä»¥ç›´æ¥è¿›è¡Œä¼ é€’å¹¶åœ¨å‡½æ•°ä¸­è¿›è¡Œå€¼ä¿®æ”¹.[goè¯­è¨€ä¸­æ²¡æœ‰çœŸæ­£çš„å¼•ç”¨ä¼ é€’,åŸºæœ¬éƒ½æ˜¯è¿™æ ·çš„ä¼ªå¼•ç”¨ä¼ é€’].\n\nå› æ­¤lenå’Œcapåœ¨å‡½æ•°ä¸­è¢«ä¿®æ”¹æ˜¯ä¸ä¼šåæ˜ åˆ°åº•å±‚æ•°æ®ç»“æ„çš„\n\n\næ‹¬å·é‡Œé¢æ˜¯ç©ºçš„ï¼Œè¡¨ç¤ºåŠ¨æ€ã€‚å¯ä»¥çœ‹åˆ°ç±»å‹ä¹Ÿæ˜¯åŠ¨æ€æ•°ç»„ç±»å‹\n\nsliceåˆ‡ç‰‡çš„å››ç§å£°æ˜æ–¹å¼/åˆå§‹åŒ–\n\nå£°æ˜ä½†ä¸è¿›è¡Œåˆå§‹åŒ–\n\nåˆ¤æ–­ä¸€ä¸ªsliceæ˜¯å¦ä¸ºç©ºnil [æ²¡æœ‰ç©ºé—´,è€Œå…¨0ä¸ç®—ç©º]\nç©ºsliceä¸èƒ½å¤Ÿè¿›è¡Œèµ‹å€¼,ä½†æ˜¯å¯ä»¥è¿›è¡Œappend(ç›¸å½“äºä¸€ä¸ªä¸€ä¸ªå¼€è¾Ÿç©ºé—´)\n\n\n\nvar s []init\n \n//åˆ¤æ–­ä¸€ä¸ªsliceæ˜¯å¦ä¸º0\nif  slice1 == nil{\n\tfmt.println(&quot;æ˜¯ä¸€ä¸ªç©ºåˆ‡ç‰‡&quot;)\n\t}else{\n\tfmt.println(&quot;ä¸æ˜¯ä¸€ä¸ªç©ºåˆ‡ç‰‡&quot;)}\nelseå’Œå‰åä¸¤ä¸ªæ‹¬å·éœ€è¦åœ¨åŒä¸€è¡Œå¦åˆ™ä¼šæŠ¥è¯­æ³•é”™\n\nåŸºäºmakeè¿›è¡Œåˆå§‹åŒ–\n\nåªåˆå§‹åŒ–lenè€Œä¸åˆå§‹åŒ–cap.\n\næ­¤æ—¶ä¼šå°†lenå’ŒcapåŒæ—¶é»˜è®¤è®¾ç½®ä¸ºlençš„å€¼.å› ä¸ºå¦‚æœlen&gt;capä¼šåˆå§‹åŒ–å¤±è´¥.\nåˆ‡ç‰‡çš„é•¿åº¦ä¸€æ—¦è¢«æŒ‡å®šäº†ï¼Œå°±ä»£è¡¨å¯¹åº”ä½ç½®å·²ç»è¢«åˆ†é…äº†å…ƒç´ ï¼Œè®¾ç½®çš„ä¼šæ˜¯å¯¹åº”å…ƒç´ ç±»å‹ä¸‹çš„é›¶å€¼.\n\n\nåˆ†åˆ«æŒ‡å®šlenå’Œcap\n\nåœ¨indexã€len,cap)çš„åŒºåŸŸæ— æ³•è¢«è®¿é—®,å› ä¸ºé€»è¾‘ä¸Šä¸å­˜åœ¨å…ƒç´ ,è®¿é—®ä¼šè¢«æŠ¥é”™.\n\n\n\n\n\ns := make([]int,8)\ns := make([]int,8,16)\n\n%v å¯ä»¥æ‰“å°æ•°ç»„å†…è¯¦ç»†æ•°æ®\n\n\nåˆå§‹åŒ–è¿å¸¦èµ‹å€¼\n\nä¼šå°†lenå’ŒcapåŒæ—¶è®¾ä¸º3å¹¶ä¸”å®Œæˆèµ‹å€¼\n\n\n\nÂ Â sÂ :=Â []int{2,3,4}\nåˆå§‹åŒ–æºç \nfunc makeslice(et *_type, len, cap int) unsafe.Pointer {\n    // æ ¹æ® cap ç»“åˆæ¯ä¸ªå…ƒç´ çš„å¤§å°ï¼Œè®¡ç®—å‡ºæ¶ˆè€—çš„æ€»å®¹é‡\n    mem, overflow := math.MulUintptr(et.size, uintptr(cap))\n    if overflow || mem &gt; maxAlloc || len &lt; 0 || len &gt; cap {\n        // å€˜è‹¥å®¹é‡è¶…é™ï¼Œlen å–è´Ÿå€¼æˆ–è€… len è¶…è¿‡ capï¼Œç›´æ¥ panic\n        mem, overflow := math.MulUintptr(et.size, uintptr(len))\n        if overflow || mem &gt; maxAlloc || len &lt; 0 {\n            panicmakeslicelen()\n        }\n        panicmakeslicecap()\n    }\n    // èµ° mallocgc è¿›è¡Œå†…å­˜åˆ†é…ä»¥åŠåˆ‡ç‰‡åˆå§‹åŒ–,ä»¥åŠå›æ”¶\n    return mallocgc(mem, et, true)\n}\nè¿½åŠ ä¸æˆªå–\nåˆ‡ç‰‡çš„è¿½åŠ \né€šè¿‡ append æ“ä½œï¼Œå¯ä»¥åœ¨ slice çš„æœ«å°¾ï¼Œé¢å¤–æ–°å¢ä¸€ä¸ªå…ƒç´ .\n\nè¿™é‡Œçš„æœ«å°¾æŒ‡çš„æ˜¯é’ˆå¯¹ slice çš„é•¿åº¦ len è€Œè¨€.å®é™…ä¸Šæˆªå–çš„è¯,ä»èµ·ç‚¹å¼€å§‹çš„å®¹é‡ä¼šä¿ç•™,è¯¦è§è¾¨æ5\nè¿™ä¸ªè¿‡ç¨‹ä¸­å€˜è‹¥å‘ç° slice çš„å‰©ä½™capå·²ç»ä¸è¶³äº†ï¼Œåˆ™ä¼šå¯¹ slice è¿›è¡Œæ‰©å®¹.åŠ¨æ€å¼€è¾Ÿç›¸å½“äºæœ¬æ¥capçš„å®¹é‡\n\n\nåœ¨åˆ›å»º slice æ—¶ï¼Œå¦‚æœèƒ½å¤Ÿé¢„ä¼°åˆ°å…¶æœªæ¥æ‰€éœ€çš„å®¹é‡ç©ºé—´,åº”è¯¥æå‰åˆ†é…å¥½å¯¹åº”å®¹é‡ï¼Œé¿å…åœ¨è¿è¡Œè¿‡ç¨‹ä¸­é¢‘ç¹è§¦å‘æ‰©å®¹æ“ä½œï¼Œè¿™æ ·ä¼šå¯¹æ€§èƒ½äº§ç”Ÿä¸åˆ©çš„å½±å“.\n\n\nå®ä¾‹1\nå€˜è‹¥å¸Œæœ›ä½¿ç”¨ append æ“ä½œå®Œæˆ slice èµ‹å€¼ï¼Œåˆ™åº”è¯¥åœ¨åˆå§‹åŒ– slice æ—¶ï¼Œç»™å…¶è®¾ç½®ä¸åŒçš„é•¿åº¦ len å’Œå®¹é‡ cap å€¼ï¼Œcap å’Œ len ä¹‹é—´çš„å·®å€¼å°±æ˜¯é¢„ç•™å‡ºæ¥ç”¨äº append æ“ä½œçš„ç©ºé—´. å…·ä½“ä»£ç å¦‚ä¸‹ï¼š\nfunc Test_slice(t *testing.T){\n    s := make([]int,0,5)\n    for i := 0; i &lt; 5; i++{\n       s = append(s, i)//è¿½åŠ çš„å¯¹è±¡æ•°ç»„,ä»¥åŠè¿½åŠ çš„æ•°æ®\n    }\n    // ç»“æœä¸ºï¼š\n    // s: [0,1,2,3,4]\n}\nå®ä¾‹2\næˆ‘ä»¬å°† slice çš„é•¿åº¦å’Œå®¹é‡éƒ½è®¾ç½®ä¸º 5,ç„¶åé€šè¿‡éå† slice çš„æ–¹å¼è¿›è¡Œæ‰§è¡Œä½ç½®å…ƒç´ çš„èµ‹å€¼ï¼ˆä¸ä½¿ç”¨ append æ“ä½œï¼‰ï¼š\nfunc Test_slice(t *testing.T){\n    s := make([]int,5)\n    for i := 0; i &lt; 5; i++{\n       s[i] = i\n    }\n    // ç»“æœä¸ºï¼š\n    // s: [0,1,2,3,4]\n}\næ‰©å®¹\nå½“lenä¸capç›¸ç­‰æ—¶,ä¸‹ä¸€æ¬¡appendæ“ä½œå°±ä¼šè¿›è¡Œä¸€æ¬¡æ‰©å®¹\n    // len:4, cap: 4\n    s := []int{2,3,4,5}\n    // len:5, cap: 8    len=åŸæ¥çš„é•¿åº¦+1,cap=åŸæ¥çš„cap*2\n    s = append(s,6)\n\n\n\né¢„æœŸå®¹é‡:\n\nå¦‚æœåªè¿½åŠ ä¸€ä¸ªå…ƒç´ ,é¢„æœŸå®¹é‡å°±æ˜¯åŸæœ¬çš„å®¹é‡+1,\nå¦‚æœé¢„æœŸå…ƒç´ æ˜¯æ¯”å¦‚ä¸€ä¸ªåˆ‡ç‰‡,é‚£ä¹ˆé¢„æœŸå®¹é‡å°±å¯èƒ½ä¼šè¶…å‡ºåŸå®¹é‡çš„ä¸¤å€.\n\n\n\nå¦‚æœé¢„æœŸå®¹é‡å°äºåŸåˆ‡ç‰‡å®¹é‡,panic\n\n\nå€˜è‹¥åˆ‡ç‰‡å…ƒç´ å¤§å°ä¸º 0ï¼ˆå…ƒç´ ç±»å‹ä¸º struct{}ï¼‰ï¼Œåˆ™ç›´æ¥å¤ç”¨ä¸€ä¸ªå…¨å±€çš„ zerobase å®ä¾‹ï¼Œç›´æ¥è¿”å›\n\n\nå€˜è‹¥é¢„æœŸçš„æ–°å®¹é‡è¶…è¿‡è€å®¹é‡çš„ä¸¤å€ï¼Œåˆ™ç›´æ¥é‡‡ç”¨é¢„æœŸçš„æ–°å®¹é‡\n\n\nå€˜è‹¥è€å®¹é‡å°äº 256ï¼Œåˆ™ç›´æ¥é‡‡ç”¨è€å®¹é‡çš„2å€ä½œä¸ºæ–°å®¹é‡\n\n\nå€˜è‹¥è€å®¹é‡å·²ç»å¤§äºç­‰äº 256ï¼Œåˆ™åœ¨è€å®¹é‡çš„åŸºç¡€ä¸Šæ‰©å®¹ 1/4 çš„æ¯”ä¾‹å¹¶ä¸”ç´¯åŠ ä¸Š 192 çš„æ•°å€¼ï¼ŒæŒç»­è¿™æ ·å¤„ç†ï¼Œç›´åˆ°å¾—åˆ°çš„æ–°å®¹é‡å·²ç»å¤§äºç­‰äºé¢„æœŸçš„æ–°å®¹é‡ä¸ºæ­¢..å¦‚æœåœ¨è¿™ä¸ªå¾ªç¯ä¸­æ•°å€¼å¤ªå¤§äº†ä»¥è‡³äºè¶Šç•Œ,é‚£ä¹ˆå°±ç›´æ¥å–é¢„æœŸæ–°å®¹é‡ä¸ºæœ€ç»ˆå€¼\n\nè¿™æ ·åš,å¯ä»¥ä½¿å¾—éšç€å®¹é‡å¢é•¿,å¢é•¿å› å­ä»2.0å¹³æ»‘è¿‡åº¦åˆ°1.25\n1.18ä¹‹å‰æ˜¯ç›´æ¥*1.25,å†…å­˜åˆ†é…è¡Œä¸ºå‘ç”Ÿå‰§çƒˆå˜åŒ–ä¸å¤Ÿä¼˜é›…\nnewcap += (newcap + 3*threshold) / 4ã€‚\n\n\n\næ ¹æ®æ•°æ®ç±»å‹æ¨ç®—å‡ºå®é™…éœ€è¦çš„å†…å­˜å¤§å°,ç„¶åmallocgcä¸­è¿˜è¦å¯¹å†…å­˜åˆ†é…å•å…ƒmspançš„ç­‰çº§åˆ¶åº¦,æ¨ç®—å¾—åˆ°å®é™…éœ€è¦ç”³è¯·çš„å†…å­˜ç©ºé—´å¤§å°(å‘ä¸Šå–æ•´)\n\nmheapæ˜¯goç®¡ç†çš„æ‰€æœ‰å†…å­˜ä¹‹å’Œ\nmspanå°±æ˜¯æ ‡å‡†å¤§å°åœ°å—,æœ‰ä¸åŒå¤§å°ç­‰çº§å…±ç¨‹åºç”³è¯·ä½¿ç”¨.\n\n\n\nè°ƒç”¨ mallocgcï¼Œå¯¹æ–°åˆ‡ç‰‡è¿›è¡Œå†…å­˜åˆå§‹åŒ–\n\n\nè°ƒç”¨ memmove æ–¹æ³•ï¼Œå°†è€åˆ‡ç‰‡ä¸­çš„å†…å®¹æ‹·è´åˆ°æ–°åˆ‡ç‰‡ä¸­\n\n\nè¿”å›æ‰©å®¹åçš„æ–°åˆ‡ç‰‡ã€æ‰©å®¹åä¼šå˜æˆæ–°çš„åœ°å€ã€‘\næºç :\n\n\nfunc growslice(et *_type, old slice, cap int) slice {\n    //... \n    if cap &lt; old.cap {\n        panic(errorString(&quot;growslice: cap out of range&quot;))\n    }\n \n \n    if et.size == 0 {\n        // å€˜è‹¥å…ƒç´ å¤§å°ä¸º 0ï¼Œåˆ™æ— éœ€åˆ†é…ç©ºé—´ç›´æ¥è¿”å›\n        return slice{unsafe.Pointer(&amp;zerobase), old.len, cap}\n    }\n \n \n    // è®¡ç®—æ‰©å®¹åæ•°ç»„çš„å®¹é‡\n    newcap := old.cap\n    // å–åŸå®¹é‡ä¸¤å€çš„å®¹é‡æ•°å€¼\n    doublecap := newcap + newcap\n    // å€˜è‹¥æ–°çš„å®¹é‡å¤§äºåŸå®¹é‡çš„ä¸¤å€ï¼Œç›´æ¥å–æ–°å®¹é‡ä½œä¸ºæ•°ç»„æ‰©å®¹åçš„å®¹é‡\n    if cap &gt; doublecap {\n        newcap = cap\n    } else {\n        const threshold = 256\n        // å€˜è‹¥åŸå®¹é‡å°äº 256ï¼Œåˆ™æ‰©å®¹åæ–°å®¹é‡ä¸ºåŸå®¹é‡çš„ä¸¤å€\n        if old.cap &lt; threshold {\n            newcap = doublecap\n        } else {\n            // åœ¨åŸå®¹é‡çš„åŸºç¡€ä¸Šï¼Œå¯¹åŸå®¹é‡ * 5/4 å¹¶ä¸”åŠ ä¸Š 192\n            // å¾ªç¯æ‰§è¡Œä¸Šè¿°æ“ä½œï¼Œç›´åˆ°æ‰©å®¹åçš„å®¹é‡å·²ç»å¤§äºç­‰äºé¢„æœŸçš„æ–°å®¹é‡ä¸ºæ­¢\n            for 0 &lt; newcap &amp;&amp; newcap &lt; cap {             \n                newcap += (newcap + 3*threshold) / 4\n            }\n            // å€˜è‹¥æ•°å€¼è¶Šç•Œäº†ï¼Œåˆ™å–é¢„æœŸçš„æ–°å®¹é‡ cap å°é¡¶\n            if newcap &lt;= 0 {\n                newcap = cap\n            }\n        }\n    }\n \n \n    var overflow bool\n    var lenmem, newlenmem, capmem uintptr\n    // åŸºäºå®¹é‡ï¼Œç¡®å®šæ–°æ•°ç»„å®¹å™¨æ‰€éœ€è¦çš„å†…å­˜ç©ºé—´å¤§å° capmem\n    switch {\n    // å€˜è‹¥æ•°ç»„å…ƒç´ çš„å¤§å°ä¸º 1ï¼Œåˆ™æ–°å®¹é‡å¤§å°ä¸º 1 * newcap.\n    // åŒæ—¶ä¼šé’ˆå¯¹ span class è¿›è¡Œå–æ•´\n    case et.size == 1:\n        lenmem = uintptr(old.len)\n        newlenmem = uintptr(cap)\n        capmem = roundupsize(uintptr(newcap))\n        overflow = uintptr(newcap) &gt; maxAlloc\n        newcap = int(capmem)\n    // å€˜è‹¥æ•°ç»„å…ƒç´ ä¸ºæŒ‡é’ˆç±»å‹ï¼Œåˆ™æ ¹æ®æŒ‡é’ˆå ç”¨ç©ºé—´ç»“åˆå…ƒç´ ä¸ªæ•°è®¡ç®—ç©ºé—´å¤§å°\n    // å¹¶ä¼šé’ˆå¯¹ span class è¿›è¡Œå–æ•´\n    case et.size == goarch.PtrSize:\n        lenmem = uintptr(old.len) * goarch.PtrSize\n        newlenmem = uintptr(cap) * goarch.PtrSize\n        capmem = roundupsize(uintptr(newcap) * goarch.PtrSize)\n        overflow = uintptr(newcap) &gt; maxAlloc/goarch.PtrSize\n        newcap = int(capmem / goarch.PtrSize)\n    // å€˜è‹¥å…ƒç´ å¤§å°ä¸º 2 çš„æŒ‡æ•°ï¼Œåˆ™ç›´æ¥é€šè¿‡ä½è¿ç®—è¿›è¡Œç©ºé—´å¤§å°çš„è®¡ç®—   \n    case isPowerOfTwo(et.size):\n        var shift uintptr\n        if goarch.PtrSize == 8 {\n            // Mask shift for better code generation.\n            shift = uintptr(sys.Ctz64(uint64(et.size))) &amp; 63\n        } else {\n            shift = uintptr(sys.Ctz32(uint32(et.size))) &amp; 31\n        }\n        lenmem = uintptr(old.len) &lt;&lt; shift\n        newlenmem = uintptr(cap) &lt;&lt; shift\n        capmem = roundupsize(uintptr(newcap) &lt;&lt; shift)\n        overflow = uintptr(newcap) &gt; (maxAlloc &gt;&gt; shift)\n        newcap = int(capmem &gt;&gt; shift)\n    // å…œåº•åˆ†æ”¯ï¼šæ ¹æ®å…ƒç´ å¤§å°ä¹˜ä»¥å…ƒç´ ä¸ªæ•°\n    // å†é’ˆå¯¹ span class è¿›è¡Œå–æ•´     \n    default:\n        lenmem = uintptr(old.len) * et.size\n        newlenmem = uintptr(cap) * et.size\n        capmem, overflow = math.MulUintptr(et.size, uintptr(newcap))\n        capmem = roundupsize(capmem)\n        newcap = int(capmem / et.size)\n    }\n \n \n \n \n    // è¿›è¡Œå®é™…çš„åˆ‡ç‰‡åˆå§‹åŒ–æ“ä½œ\n    var p unsafe.Pointer\n    // éæŒ‡é’ˆç±»å‹\n    if et.ptrdata == 0 {\n        p = mallocgc(capmem, nil, false)\n        // ...\n    } else {\n        // æŒ‡é’ˆç±»å‹\n        p = mallocgc(capmem, et, true)\n        // ...\n    }\n    // å°†åˆ‡ç‰‡çš„å†…å®¹æ‹·è´åˆ°æ‰©å®¹åçš„ä½ç½® p \n    memmove(p, old.array, lenmem)\n    return slice{p, old.len, newcap}\n}\nåˆ‡ç‰‡çš„æˆªå–\n\nè¦æ³¨æ„è¿™é‡Œæ˜¯å·¦é—­å³å¼€,å› æ­¤[0:2]å–çš„æ˜¯ç¬¬0.1ä½,2å¹¶æ²¡æœ‰ç®—è¿›æ¥\n\n\n[:]=[0:len(s)]\n\n\n[:3]=[0:3]\n\n\n[4:]=[4:len(s)]\n\n\næœ¬è´¨ä¸Šæ˜¯å¼•ç”¨ä¼ é€’æ“ä½œ,å› æ­¤æ— è®ºæˆªå–å¤šå°‘æ¬¡,åº•å±‚éƒ½æ˜¯åŒä¸€å—å†…å­˜ç©ºé—´æ•°æ®.ä¸è¿‡æˆªå–ä¼šåˆ›å»ºå‡ºæ–°çš„slice headerå®ä¾‹\n\n\nå› ä¸ºå®é™…ä¸ŠæŒ‡å‘çš„æ˜¯åŒä¸€ä¸ªåœ°å€åŒºé—´,å› æ­¤ä¿®æ”¹å…¶ä¸­ä¸€ä¸ªå…ƒç´ ä¼šå½±å“åˆ°å¦å¤–ä¸€ä¸ªæ•°ç»„çš„\n\n\nå¦‚æœè¦åˆ†å¼€æˆªå–çš„è¯å°±ä½¿ç”¨copyå‡½æ•°,ç›¸å½“äºæ‹·è´ä¸€ä¸ªå‰¯æœ¬,è¿™æ ·ä¿®æ”¹çš„è¯ä¸ä¼šå½±å“åˆ°æœ¬æ¥çš„slice\n\n\n\nå…ƒç´ åˆ é™¤\nä»åˆ‡ç‰‡ä¸­åˆ é™¤å…ƒç´ (åªå¯¹lenåšä¿®æ”¹)çš„å®ç°æ€è·¯ï¼Œæœ¬è´¨ä¸Šå’Œåˆ‡ç‰‡å†…å®¹æˆªå–çš„æ€è·¯æ˜¯ä¸€è‡´çš„.\n\nåˆ é™¤ slice ä¸­çš„é¦–ä¸ªå…ƒç´ ï¼Œåœ¨æ“ä½œä¸Šç­‰åŒäºä»åˆ‡ç‰‡ index = 1 å¼€å§‹å‘åè¿›è¡Œå†…å®¹æˆªå–\nåˆ é™¤ slice çš„å°¾éƒ¨å…ƒç´ ï¼Œåˆ™æ“ä½œç­‰ä»·äºæˆªå–åˆ‡ç‰‡å†…å®¹ï¼Œå¹¶å°†ç»ˆç‚¹è®¾ç½®åœ¨ len(s) - 1 çš„ä½ç½®\nåˆ é™¤ slice ä¸­é—´çš„æŸä¸ªå…ƒç´ ï¼Œæ“ä½œæ€è·¯åˆ™æ˜¯é‡‡ç”¨å†…å®¹æˆªå–åŠ ä¸Šå…ƒç´ è¿½åŠ çš„å¤åˆæ“ä½œï¼Œå¯ä»¥å…ˆæˆªå–å¾…åˆ é™¤å…ƒç´ çš„å·¦ä¾§éƒ¨åˆ†å†…å®¹ï¼Œç„¶ååœ¨æ­¤åŸºç¡€ä¸Šè¿½åŠ ä¸Šå¾…åˆ é™¤å…ƒç´ åä¾§éƒ¨åˆ†çš„å†…å®¹\næœ€åï¼Œå½“æˆ‘ä»¬éœ€è¦åˆ é™¤ slice ä¸­çš„æ‰€æœ‰å…ƒç´ æ—¶ï¼Œä¹Ÿå¯ä»¥é‡‡ç”¨åˆ‡ç‰‡å†…å®¹æˆªå–çš„æ“ä½œæ–¹å¼ï¼šs[:0]. è¿™æ ·æ“ä½œåï¼Œslice header ä¸­çš„æŒ‡é’ˆ array ä»æŒ‡å‘åŸå¤„ï¼Œä½†æ˜¯é€»è¾‘æ„ä¹‰ä¸Šå…¶é•¿åº¦ len å·²ç»ç­‰äº 0ï¼Œè€Œå®¹é‡ cap åˆ™ä»ä¿ç•™ä¸ºåŸå€¼.\n\nfunc Test_slice(t *testing.T){\n    s := []int{0,1,2,3,4}\n    // [1,2,3,4]\n    s = s[1:]\n}\n \nfunc Test_slice(t *testing.T){\n    s := []int{0,1,2,3,4}\n    // [0,1,2,3]\n    s = s[0:len(s)-1]\n}\n \nfunc Test_slice(t *testing.T){\n    s := []int{0,1,2,3,4}\n    // åˆ é™¤ index = 2 çš„å…ƒç´ \n    s = append(s[:2],s[3:]...)//\n    // s: [0,1,3,4], len: 4, cap: 5\n    t.Logf(&quot;s: %v, len: %d, cap: %d&quot;, s, len(s), cap(s))\n}\n \nfunc Test_slice(t *testing.T){\n    s := []int{0,1,2,3,4}\n    s = s[:0]\n    // s: [], len: 0, cap: 5\n    t.Logf(&quot;s: %v, len: %d, cap: %d&quot;, s, len(s), cap(s))\n}\nâ€¦:\n\nåœ¨å‡½æ•°å®šä¹‰ä¸­,func myFunc(args ...int)ï¼Œè¿™é‡Œ ... æ„å‘³ç€ myFunc æ˜¯ä¸€ä¸ªå¯å˜å‚æ•°å‡½æ•°ã€‚å®ƒå¯ä»¥æ¥å—ä»»æ„æ•°é‡çš„ int ä½œä¸ºå‚æ•°ï¼ˆ0ä¸ªã€1ä¸ªæˆ–å¤šä¸ªï¼‰ã€‚\nåœ¨å‡½æ•°è°ƒç”¨ä¸­ ï¼šappend(s1, s2...)ï¼Œè¿™é‡Œçš„ ... æ„æ€æ˜¯â€œå°†è¿™ä¸ªåˆ‡ç‰‡ (slice) æ‹†åŒ…/è§£å¼€ (unpack/expand)â€ã€‚\n\nå› ä¸ºappendå¹¶ä¸æ¥å—ä¸€ä¸ªsliceä½œä¸ºç¬¬äºŒä¸ªå‚æ•°,äºæ˜¯æˆ‘ä»¬ç”¨â€¦å°†sliceæ‹†åˆ†ä¸ºå•ç‹¬å…ƒç´ \n\n\n\nåˆ‡ç‰‡æ‹·è´\nåŒ…æ‹¬ç®€å•æ‹·è´å’Œå®Œæ•´æ‹·è´ä¸¤ç§\n\nç®€å•æ‹·è´\n\nåªè¦å¯¹åˆ‡ç‰‡çš„å­—é¢é‡è¿›è¡Œèµ‹å€¼ä¼ é€’.è¿™æ ·ç›¸å½“äºåˆ›å»ºå‡ºäº†ä¸€ä¸ªæ–°çš„ slice header å®ä¾‹ï¼Œä½†æ˜¯å…¶ä¸­çš„æŒ‡é’ˆ arrayã€å®¹é‡ cap å’Œé•¿åº¦ len ä»å’Œè€çš„ slice header å®ä¾‹ç›¸åŒ..\nå¯¹åˆ‡ç‰‡è¿›è¡Œ%pæ‰“å°åœ°å€,æ‰“å°å‡ºæ¥çš„ä¸æ˜¯slice headerçš„åœ°å€,è€Œæ˜¯å†…éƒ¨arrayå­—æ®µæŒ‡å‘çš„æ•°ç»„åœ°å€\nåˆ‡ç‰‡çš„æˆªå–æ“ä½œä¹Ÿå±äºæ˜¯ç®€å•æ‹·è´ï¼Œs å’Œ s1 ä¼šä½¿ç”¨åŒä¸€ç‰‡å†…å­˜ç©ºé—´ï¼Œåªä¸è¿‡åœ°å€èµ·ç‚¹ä½ç½®åç§»äº†ä¸€ä¸ªå…ƒç´ çš„é•¿åº¦. s1 å’Œ s çš„åœ°å€ï¼Œåˆšå¥½ç›¸å·® 8 ä¸ª byte.\n\n\nå®Œæ•´æ‹·è´\n\næŒ‡çš„æ˜¯ä¼šåˆ›å»ºå‡ºä¸€ä¸ªå’Œ slice å®¹é‡å¤§å°ç›¸ç­‰çš„ç‹¬ç«‹çš„å†…å­˜åŒºåŸŸï¼Œå¹¶å°†åŸ slice ä¸­çš„å…ƒç´ ä¸€ä¸€æ‹·è´åˆ°æ–°ç©ºé—´ä¸­.åœ¨å®ç°ä¸Šï¼Œslice çš„å®Œæ•´å¤åˆ¶å¯ä»¥è°ƒç”¨ç³»ç»Ÿæ–¹æ³• copyï¼Œé€šè¿‡æ—¥å¿—æ‰“å°çš„æ–¹å¼å¯ä»¥çœ‹åˆ°ï¼Œs å’Œ s1 çš„åœ°å€æ˜¯ç›¸äº’ç‹¬ç«‹çš„.å› æ­¤å¯¹åº”çš„æ•°ç»„åœ°å€ä¹Ÿæ˜¯å…¨æ–°çš„\n\n\n\né—®é¢˜è¾¨æ\nfunc Test_slice(t *testing.T){\n    s := make([]int,10)  \n    s = append(s,10)\n    t.Logf(&quot;s: %v, len of s: %d, cap of s: %d&quot;,s,len(s),cap(s))\n}\n//ç»“æœ:s: [0 0 0 0 0 0 0 0 0 0 10], len of s: 11, cap of s: 20\n \n \nfunc Test_slice(t *testing.T){\n    s := make([]int,0,10)  \n    s = append(s,10)\n    t.Logf(&quot;s: %v, len of s: %d, cap of s: %d&quot;,s,len(s),cap(s))\n}\n//ç»“æœ:s: [10], len of s: 1, cap of s: 10\n \n \nfunc Test_slice(t *testing.T){\n    s := make([]int,10,11)  \n    s = append(s,10)\n    t.Logf(&quot;s: %v, len of s: %d, cap of s: %d&quot;,s,len(s),cap(s))\n}\n//ç»“æœ:s: [0 0 0 0 0 0 0 0 0 0 10], len of s: 11, cap of s: 11\n \n \nfunc Test_slice(t *testing.T){\n    s := make([]int,10,12)  \n    s1 := s[8:]\n    t.Logf(&quot;s1: %v, len of s1: %d, cap of s1: %d&quot;,s1,len(s1),cap(s1))\n}\n//ç»“æœ:s1=[0 0] len=2 cap=4\n \n \nfunc Test_slice(t *testing.T){\n    s := make([]int,10,12)  \n    s1 := s[8:9]\n    t.Logf(&quot;s1: %v, len of s1: %d, cap of s1: %d&quot;,s1,len(s1),cap(s1))\n}\n//ç»“æœ:s1=[0] len:1 cap:4\n \n \nfunc Test_slice(t *testing.T){\n    s := make([]int,10,12)  \n    s1 := s[8:]\n    s1[0] = -1\n    t.Logf(&quot;s: %v&quot;,s)\n}\n//ç»“æœ:s: [0 0 0 0 0 0 0 0 -1 0]\n \n \nfunc Test_slice(t *testing.T){\n    s := make([]int,10,12)  \n    v := s[10]\n    // æ±‚é—®ï¼Œæ­¤æ—¶æ•°ç»„è®¿é—®æ˜¯å¦ä¼šè¶Šç•Œ\n}\n//ä¼šè¶Šç•Œ,å› ä¸ºlen=10 æ˜¯0-9çš„ç´¢å¼•ä¸Šæœ‰å€¼\n \n \nfunc Test_slice(t *testing.T){\n    s := make([]int,10,12)  \n    s1 := s[8:]\n    s1 = append(s1,[]int{10,11,12}...)\n    v := s[10]\n    // ...\n    // æ±‚é—®ï¼Œæ­¤æ—¶æ•°ç»„è®¿é—®æ˜¯å¦ä¼šè¶Šç•Œ\n}\n//ç”±äº s é¢„ç•™çš„ç©ºé—´ä¸è¶³ï¼Œs1 ä¼šå‘ç”Ÿæ‰©å®¹,æ‰©å®¹åä¼šè¿”å›æ‹·è´åçš„æ–°åˆ‡ç‰‡,è¿™é‡Œçš„æ‹·è´æ˜¯å®Œæ•´æ‹·è´,æ„å‘³ç€ä¿®æ”¹ s1 ä¸å†ä¼šå½±å“åˆ° s\n//Â s ç»§ç»­ç»´æŒåŸæœ¬çš„é•¿åº¦å€¼ 10 å’Œå®¹é‡å€¼ 12ï¼Œå› æ­¤è®¿é—® s[10] ä¼španic\n \n \nfunc Test_slice(t *testing.T){\n    s := make([]int,10,12)  \n    s1 := s[8:]\n    changeSlice(s1)\n    t.Logf(&quot;s: %v&quot;,s)\n}\n \n \nfunc changeSlice(s1 []int){\n  s1[0] = -1\n}\n//ç»“æœ:s=[00000000-10  ]s1=[-10  ]\n \n \nfunc Test_slice(t *testing.T){\n    s := make([]int,10,12)  \n    s1 := s[8:]\n    changeSlice(s1)\n    t.Logf(&quot;s: %v, len of s: %d, cap of s: %d&quot;,s, len(s), cap(s))\n    t.Logf(&quot;s1: %v, len of s1: %d, cap of s1: %d&quot;,s1, len(s1), cap(s1))\n}\n \n \nfunc changeSlice(s1 []int){\n  s1 = append(s1, 10)\n}\n//ç»“æœ:s=[0000000000  ]ä¸å˜ s1ä¹Ÿä¸å˜\n//åœ¨å±€éƒ¨æ–¹æ³• changeSlice ä¸­ï¼Œè™½ç„¶å¯¹ s1 è¿›è¡Œäº† append æ“ä½œï¼Œä½†è¿™è¿™ä¼šåœ¨å±€éƒ¨æ–¹æ³•ä¸­è¿™ä¸ªç‹¬ç«‹çš„ slice header ä¸­ç”Ÿæ•ˆï¼Œä¸ä¼šå½±å“åˆ°åŸæ–¹æ³• Test_slice å½“ä¸­çš„ s å’Œ s1 çš„**é•¿åº¦å’Œå®¹é‡**.    \n \n \nfunc Test_slice(t *testing.T){\n    s := []int{0,1,2,3,4}\n    s = append(s[:2],s[3:]...)\n    t.Logf(&quot;s: %v, len: %d, cap: %d&quot;, s, len(s), cap(s))\n    v := s[4] \n    // æ˜¯å¦ä¼šæ•°ç»„è®¿é—®è¶Šç•Œ\n}\n//[0,1,3,4] ä¼š.\n \n \nfunc Test_slice(t *testing.T){\n    s := make([]int,512)  \n    s = append(s,1)\n    t.Logf(&quot;len of s: %d, cap of s: %d&quot;,len(s),cap(s))\n}\n//ç»“æœ:len=513 cap: æ ¹æ®ä¸åˆ°ä¸¤å€ä¸”&gt;256çš„è®¡ç®—æ–¹å¼(n += (n+3*256)/4) å¯ä»¥è®¡ç®—åˆ°832, ç„¶åæ ¹æ®mspanå‘ä¸Šè¡¥é½çš„æ³•åˆ™,å¾—åˆ°848\nå…¶ä»–\nslice ä¸æ˜¯å¹¶å‘å®‰å…¨çš„æ•°æ®ç»“æ„,æ²¡æœ‰å¯¹å¹¶å‘è¯»å†™çš„ä¿æŠ¤æœºåˆ¶.\nå‚è€ƒèµ„æ–™\nä½ çœŸçš„äº†è§£goè¯­è¨€ä¸­çš„åˆ‡ç‰‡å—ï¼Ÿâ€”å°å¾å…ˆç”Ÿçš„ç¼–ç¨‹ä¸–ç•Œ"},"æŠ€æœ¯ç§¯ç´¯/Golang/æ ¸å¿ƒçŸ¥è¯†/02-map-å®ç°åŸç†":{"slug":"æŠ€æœ¯ç§¯ç´¯/Golang/æ ¸å¿ƒçŸ¥è¯†/02-map-å®ç°åŸç†","filePath":"æŠ€æœ¯ç§¯ç´¯/Golang/æ ¸å¿ƒçŸ¥è¯†/02 map å®ç°åŸç†.md","title":"02 map å®ç°åŸç†","links":["tags/å¾…è§£å†³"],"tags":["å¾…è§£å†³"],"content":"ï¼ˆ1ï¼‰å­˜å‚¨åŸºäº key-value å¯¹æ˜ å°„çš„æ¨¡å¼ï¼›\nï¼ˆ2ï¼‰åŸºäº key ç»´åº¦å®ç°å­˜å‚¨æ•°æ®çš„å»é‡ï¼›\nï¼ˆ3ï¼‰è¯»ã€å†™ã€åˆ æ“ä½œæ§åˆ¶ï¼Œæ—¶é—´å¤æ‚åº¦ O(1).\nå®šä¹‰\nå£°æ˜\n\n\n\n\nå¦‚æœæ»¡äº†çš„è¯å†æ·»åŠ å°±ä¼šå†åŠ ä¸€ä¸ª10(å½“å‰å®¹é‡)\nmapé‡Œé¢æ„Ÿè§‰é•¿åº¦å’Œå®¹é‡å˜æˆä¸€ä¸ªä¸œè¥¿äº†\nç„¶åå®é™…ä¸Šå­˜å…¥çš„å†…å®¹å¹¶éæŒ‰å­˜å…¥é¡ºåº,è€Œæ˜¯é‡‡ç”¨åŸºæœ¬çš„å“ˆå¸Œæ–¹å¼æ¥å­˜çš„,å¯ä»¥è®¤ä¸ºæ˜¯éšæœºçš„.å¹¶ä¸”goä¼šéšæœºåŒ–èµ·å§‹ç‚¹,æ‰€ä»¥å“ªæ€•ä¸¤æ¬¡éå†ä¸€ä¸ªæ•°ç»„,å¾—åˆ°çš„ç»“æœæ˜¯ä¸åŒçš„.å› æ­¤å¦‚æœè¦æŒ‰ç…§keyçš„å­—æ¯é¡ºåºæ¥å¤„ç†mapæ•°æ®,éœ€è¦æœ‰ä¸€ä¸ªæœ‰åºç´¢å¼•sliceç„¶åç”¨è¿™ä¸ªsliceå»mapé‡Œé¢ä¸€ä¸ªä¸ªæŸ¥è¯¢\n\n\n\nmakeæ˜¯å¿…é¡»çš„,è¦æœ‰ä¸€ä¸ªå¼€è¾Ÿç©ºé—´çš„è¿™ä¹ˆä¸€ä¸ªå£°æ˜,æ‰ä¼šæœ‰ç©ºé—´(è™½ç„¶ä¸è®¾å®šå®¹é‡çš„è¯ç©ºé—´ä¸º0)\n\næ²¡æœ‰ç©ºé—´æ—¶èµ‹å€¼:è¶Šç•ŒæŠ¥é”™\næœ‰ç©ºé—´ä¸º0,èµ‹å€¼:ä¼šä¸€ä¸ªä¸€ä¸ªå¼€è¾Ÿçš„æ‰€ä»¥æ²¡äº‹\n\n\n\n\nå°±æ˜¯åœ¨å£°æ˜çš„æ—¶å€™ç›´æ¥åˆå§‹åŒ–,ä¸€èˆ¬ç”¨è¿™ä¸ª\n\n\nkeyçš„ç±»å‹è¦æ±‚\nå¿…é¡»ä¸ºå¯æ¯”è¾ƒçš„ç±»å‹ï¼Œsliceã€mapã€funcä¸å¯æ¯”è¾ƒ\nä½¿ç”¨æ–¹å¼\nè¯»\nv1 :=myMap[10]\n//å€˜è‹¥keyå­˜åœ¨,åˆ™è·å–åˆ°å¯¹åº”çš„val\n//å€˜è‹¥keyä¸å­˜åœ¨æˆ–è€…mapæœªåˆå§‹åŒ–,åˆ™ä¼šè¿”å›valç±»å‹çš„é›¶å€¼\n \nv2,ok := myMap[10]\n//æ·»åŠ ä¸€ä¸ªboolç±»å‹çš„flagæ ‡è¯†,è¯»å–æˆåŠŸåˆ™ä¸ºtrue,è¯»å–å¤±è´¥ä¸ºfalse[è¯»å–å¤±è´¥,keyä¸å­˜åœ¨/mapæœªåˆå§‹åŒ–]\nåŒä¸€ç§è¯­æ³•èƒ½å¤Ÿå®ç°ä¸åŒè¿”å›å€¼ç±»å‹çš„é€‚é…ï¼Œæ˜¯ç”±äºä»£ç åœ¨æ±‡ç¼–æ—¶ï¼Œä¼šæ ¹æ®è¿”å›å‚æ•°ç±»å‹çš„åŒºåˆ«ï¼Œæ˜ å°„åˆ°ä¸åŒçš„å®ç°æ–¹æ³•\nå†™\nmyMap[5] = 6\n//å¦‚æœmapæœªåˆå§‹åŒ–,ç›´æ¥æ‰§è¡Œå†™æ“ä½œä¼šå¯¼è‡´panicæŠ¥é”™\nåˆ \ndelete(myMap,5)\n//keyå­˜åœ¨:åˆ é™¤å¯¹åº”æ•´ä¸ªé”®å€¼å¯¹\n//keyä¸å­˜åœ¨æˆ–mapæœªåˆå§‹åŒ–,æ–¹æ³•ä¼šç›´æ¥ç»“æŸ,ä¸ä¼šäº§ç”Ÿæ˜¾å¼æç¤º\néå†\nfor k,v := range myMap{\n  // ...\n}\n \nfor k := range myMap{\n  // ...\n}\n//è·å–key,ä¸å…³æ³¨valçš„å–å€¼\nä¸¤æ¬¡éå†ä¸€ä¸ªæ•°ç»„,å¾—åˆ°çš„ç»“æœæ˜¯ä¸åŒçš„.å› æ­¤å¦‚æœè¦æŒ‰ç…§keyçš„å­—æ¯é¡ºåºæ¥å¤„ç†mapæ•°æ®,éœ€è¦æœ‰ä¸€ä¸ªæœ‰åºç´¢å¼•sliceç„¶åç”¨è¿™ä¸ªsliceå»mapé‡Œé¢ä¸€ä¸ªä¸ªæŸ¥è¯¢\nå¹¶å‘å†²çª\nmap ä¸æ˜¯å¹¶å‘å®‰å…¨çš„æ•°æ®ç»“æ„ï¼Œå€˜è‹¥å­˜åœ¨å¹¶å‘è¯»å†™è¡Œä¸ºï¼Œä¼šæŠ›å‡º fatal error.\nå…·ä½“è§„åˆ™æ˜¯ï¼š\nï¼ˆ1ï¼‰å¹¶å‘è¯»æ²¡æœ‰é—®é¢˜ï¼›\nï¼ˆ2ï¼‰å¹¶å‘è¯»å†™ä¸­çš„â€œå†™â€æ˜¯å¹¿ä¹‰ä¸Šçš„ï¼ŒåŒ…å«å†™å…¥ã€æ›´æ–°ã€åˆ é™¤ç­‰æ“ä½œï¼›\nï¼ˆ3ï¼‰è¯»çš„æ—¶å€™å‘ç°å…¶ä»– goroutine åœ¨å¹¶å‘å†™ï¼ŒæŠ›å‡º fatal errorï¼›\nï¼ˆ4ï¼‰å†™çš„æ—¶å€™å‘ç°å…¶ä»– goroutine åœ¨å¹¶å‘å†™ï¼ŒæŠ›å‡º fatal error.\néœ€è¦å…³æ³¨ï¼Œæ­¤å¤„å¹¶å‘è¯»å†™ä¼šå¼•å‘ fatal errorï¼Œæ˜¯ä¸€ç§æ¯” panic æ›´ä¸¥é‡çš„é”™è¯¯ï¼Œæ— æ³•ä½¿ç”¨ recover æ“ä½œæ•è·. å¾…è§£å†³\næ ¸å¿ƒåŸç†\nmap åˆç§°ä¸º hash mapï¼Œåœ¨ç®—æ³•ä¸ŠåŸºäº hash å®ç° key çš„æ˜ å°„å’Œå¯»å€ï¼›åœ¨æ•°æ®ç»“æ„ä¸ŠåŸºäºæ¡¶æ•°ç»„å®ç° key-value å¯¹çš„å­˜å‚¨.\nä»¥ä¸€ç»„ key-value å¯¹å†™å…¥ map çš„æµç¨‹ä¸ºä¾‹è¿›è¡Œç®€è¿°ï¼š\nï¼ˆ1ï¼‰é€šè¿‡å“ˆå¸Œæ–¹æ³•å–å¾— key çš„ hash å€¼ï¼›\nï¼ˆ2ï¼‰hash å€¼å¯¹æ¡¶æ•°ç»„é•¿åº¦å–æ¨¡ï¼Œç¡®å®šå…¶æ‰€å±çš„æ¡¶ï¼›\nï¼ˆ3ï¼‰åœ¨æ¡¶ä¸­æ’å…¥ key-value å¯¹.\n\nhash çš„æ€§è´¨ï¼Œä¿è¯äº†ç›¸åŒçš„ key å¿…ç„¶äº§ç”Ÿç›¸åŒçš„ hash å€¼ï¼Œå› æ­¤èƒ½æ˜ å°„åˆ°ç›¸åŒçš„æ¡¶ä¸­ï¼Œé€šè¿‡æ¡¶å†…éå†çš„æ–¹å¼é”å®šå¯¹åº”çš„ key-value å¯¹.\nå› æ­¤ï¼Œåªè¦åœ¨å®è§‚æµç¨‹ä¸Šï¼Œæ§åˆ¶æ¯ä¸ªæ¡¶ä¸­ key-value å¯¹çš„æ•°é‡ï¼Œå°±èƒ½ä¿è¯ map çš„å‡ é¡¹æ“ä½œéƒ½é™åˆ¶ä¸ºå¸¸æ•°çº§åˆ«çš„æ—¶é—´å¤æ‚åº¦.\n\nhash\nhash è¯‘ä½œæ•£åˆ—ï¼Œæ˜¯ä¸€ç§å°†ä»»æ„é•¿åº¦çš„è¾“å…¥å‹ç¼©åˆ°æŸä¸€å›ºå®šé•¿åº¦çš„è¾“å‡ºæ‘˜è¦çš„è¿‡ç¨‹ï¼Œç”±äºè¿™ç§è½¬æ¢å±äºå‹ç¼©æ˜ å°„ï¼Œè¾“å…¥ç©ºé—´è¿œå¤§äºè¾“å‡ºç©ºé—´ï¼Œå› æ­¤ä¸åŒè¾“å…¥å¯èƒ½ä¼šæ˜ å°„æˆç›¸åŒçš„è¾“å‡ºç»“æœ. æ­¤å¤–ï¼Œhashåœ¨å‹ç¼©è¿‡ç¨‹ä¸­ä¼šå­˜åœ¨éƒ¨åˆ†ä¿¡æ¯çš„é—å¤±ï¼Œå› æ­¤è¿™ç§æ˜ å°„å…³ç³»å…·æœ‰ä¸å¯é€†çš„ç‰¹è´¨.\nï¼ˆ1ï¼‰hash çš„å¯é‡å…¥æ€§ï¼šç›¸åŒçš„ keyï¼Œå¿…ç„¶äº§ç”Ÿç›¸åŒçš„ hash å€¼ï¼›\nï¼ˆ2ï¼‰hash çš„ç¦»æ•£æ€§ï¼šåªè¦ä¸¤ä¸ª key ä¸ç›¸åŒï¼Œä¸è®ºå…¶ç›¸ä¼¼åº¦çš„é«˜ä½ï¼Œäº§ç”Ÿçš„ hash å€¼ä¼šåœ¨æ•´ä¸ªè¾“å‡ºåŸŸå†…å‡åŒ€åœ°ç¦»æ•£åŒ–ï¼›\nï¼ˆ3ï¼‰hash çš„å•å‘æ€§ï¼šä¼å›¾é€šè¿‡ hash å€¼åå‘æ˜ å°„å› key æ˜¯æ— è¿¹å¯å¯»çš„.\nï¼ˆ4ï¼‰hash å†²çªï¼šç”±äºè¾“å…¥åŸŸï¼ˆkeyï¼‰æ— ç©·å¤§ï¼Œè¾“å‡ºåŸŸï¼ˆhash å€¼ï¼‰æœ‰é™ï¼Œå› æ­¤å¿…ç„¶å­˜åœ¨ä¸åŒ key æ˜ å°„åˆ°ç›¸åŒ hash å€¼çš„æƒ…å†µï¼Œç§°ä¹‹ä¸º hash å†²çª.\nbucket\nmap ä¸­ï¼Œä¼šé€šè¿‡é•¿åº¦ä¸º 2 çš„æ•´æ•°æ¬¡å¹‚çš„æ¡¶æ•°ç»„è¿›è¡Œ key-value å¯¹çš„å­˜å‚¨ï¼š\nï¼ˆ1ï¼‰æ¯ä¸ªæ¡¶å›ºå®šå¯ä»¥å­˜æ”¾ 8 ä¸ª key-value å¯¹ï¼›\nï¼ˆ2ï¼‰å€˜è‹¥è¶…è¿‡ 8 ä¸ª key-value å¯¹æ‰“åˆ°æ¡¶æ•°ç»„çš„åŒä¸€ä¸ªç´¢å¼•å½“ä¸­ï¼Œæ­¤æ—¶ä¼šé€šè¿‡åˆ›å»ºæ¡¶é“¾è¡¨çš„æ–¹å¼æ¥åŒ–è§£è¿™ä¸€é—®é¢˜.\nhashå†²çª\n\né¦–å…ˆï¼Œç”±äº hash å†²çªçš„å­˜åœ¨ï¼Œä¸åŒ key å¯èƒ½å­˜åœ¨ç›¸åŒçš„ hash å€¼ï¼›\nå†è€…ï¼Œhash å€¼ä¼šå¯¹æ¡¶æ•°ç»„é•¿åº¦å–æ¨¡ï¼Œå› æ­¤ä¸åŒ hash å€¼å¯èƒ½è¢«æ‰“åˆ°åŒä¸€ä¸ªæ¡¶ä¸­.\nç»¼ä¸Šï¼Œä¸åŒçš„ key-value å¯èƒ½è¢«æ˜ å°„åˆ° map çš„åŒä¸€ä¸ªæ¡¶å½“ä¸­.\n\næ­¤æ—¶æœ€ç»å…¸çš„è§£å†³æ‰‹æ®µåˆ†ä¸ºä¸¤ç§ï¼šæ‹‰é“¾æ³•å’Œå¼€æ”¾å¯»å€æ³•.\n\næ‹‰é“¾æ³•ï¼Œå°†å‘½ä¸­åŒä¸€ä¸ªæ¡¶çš„å…ƒç´ é€šè¿‡é“¾è¡¨çš„å½¢å¼è¿›è¡Œé“¾æ¥ï¼Œå› æ­¤å¾ˆä¾¿äºåŠ¨æ€æ‰©å±•\nå¼€æ”¾å¯»å€æ³•, åœ¨æ’å…¥æ–°æ¡ç›®æ—¶ï¼Œä¼šåŸºäºä¸€å®šçš„æ¢æµ‹ç­–ç•¥æŒç»­å¯»æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªå¯ç”¨äºå­˜æ”¾æ•°æ®çš„ç©ºä½ä¸ºæ­¢.\n\n\nmapçš„è§£å†³\nåœ¨ map è§£å†³ hash /åˆ†æ¡¶ å†²çªé—®é¢˜æ—¶ï¼Œå®é™…ä¸Šç»“åˆäº†æ‹‰é“¾æ³•å’Œå¼€æ”¾å¯»å€æ³•ä¸¤ç§æ€è·¯. ä»¥ map çš„æ’å…¥å†™æµç¨‹ä¸ºä¾‹ï¼Œè¿›è¡Œæ€è·¯é˜è¿°ï¼š\nï¼ˆ1ï¼‰æ¡¶æ•°ç»„ä¸­çš„æ¯ä¸ªæ¡¶ï¼Œä¸¥æ ¼æ„ä¹‰ä¸Šæ˜¯ä¸€ä¸ªå•å‘æ¡¶é“¾è¡¨ï¼Œä»¥æ¡¶ä¸ºèŠ‚ç‚¹è¿›è¡Œä¸²è”ï¼›\nï¼ˆ2ï¼‰æ¯ä¸ªæ¡¶å›ºå®šå¯ä»¥å­˜æ”¾ 8 ä¸ª key-value å¯¹ï¼›\nï¼ˆ3ï¼‰å½“ key å‘½ä¸­ä¸€ä¸ªæ¡¶æ—¶ï¼Œé¦–å…ˆæ ¹æ®å¼€æ”¾å¯»å€æ³•ï¼Œåœ¨æ¡¶çš„ 8 ä¸ªä½ç½®ä¸­å¯»æ‰¾ç©ºä½è¿›è¡Œæ’å…¥ï¼›\nï¼ˆ4ï¼‰å€˜è‹¥æ¡¶çš„ 8 ä¸ªä½ç½®éƒ½å·²è¢«å æ»¡ï¼Œåˆ™åŸºäºæ¡¶çš„æº¢å‡ºæ¡¶æŒ‡é’ˆï¼Œæ‰¾åˆ°ä¸‹ä¸€ä¸ªæ¡¶ï¼Œé‡å¤ç¬¬ï¼ˆ3ï¼‰æ­¥ï¼›\nï¼ˆ5ï¼‰å€˜è‹¥éå†åˆ°é“¾è¡¨å°¾éƒ¨ï¼Œä»æœªæ‰¾åˆ°ç©ºä½ï¼Œåˆ™åŸºäºæ‹‰é“¾æ³•ï¼Œåœ¨æ¡¶é“¾è¡¨å°¾éƒ¨ç»­æ¥æ–°æ¡¶ï¼Œå¹¶æ’å…¥ key-value å¯¹.\nå°±æ˜¯å…ˆç”¨å¼€æ”¾å¯»å€,åç”¨æ‹‰é“¾æ³•,å¯¹æ¯ä¸ªæ¡¶é€šè¿‡å¼€æ”¾å¯»å€ä¿è¯å¡«æ»¡\næ‰©å®¹ä¼˜åŒ–æ€§èƒ½\nmap çš„æ¡¶æ•°ç»„é•¿åº¦å›ºå®šä¸å˜ï¼Œé‚£ä¹ˆéšç€ key-value å¯¹æ•°é‡çš„å¢é•¿ï¼Œå½“ä¸€ä¸ªæ¡¶ä¸‹æŒ‚è½½çš„ key-value è¾¾åˆ°ä¸€å®šçš„é‡çº§ï¼Œæ­¤æ—¶æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä¼šè¶‹äºçº¿æ€§ï¼Œæ— æ³•æ»¡è¶³è¯‰æ±‚.\n\nå› æ­¤åœ¨å®ç°ä¸Šï¼Œmap æ¡¶æ•°ç»„çš„é•¿åº¦ä¼šéšç€ key-value å¯¹æ•°é‡çš„å˜åŒ–è€Œå®æ—¶è°ƒæ•´ï¼Œä»¥ä¿è¯æ¯ä¸ªæ¡¶å†…çš„ key-value å¯¹æ•°é‡å§‹ç»ˆæ§åˆ¶åœ¨å¸¸é‡çº§åˆ«ï¼Œæ»¡è¶³å„é¡¹æ“ä½œä¸º O(1) æ—¶é—´å¤æ‚åº¦çš„è¦æ±‚.\nmap æ‰©å®¹æœºåˆ¶çš„æ ¸å¿ƒç‚¹åŒ…æ‹¬ï¼š\nï¼ˆ1ï¼‰æ‰©å®¹åˆ†ä¸ºå¢é‡æ‰©å®¹å’Œç­‰é‡æ‰©å®¹ï¼›\nï¼ˆ2ï¼‰å½“æ¡¶å†… key-value æ€»æ•°/æ¡¶æ•°ç»„é•¿åº¦ &gt; 6.5 æ—¶å‘ç”Ÿå¢é‡æ‰©å®¹ï¼Œæ¡¶æ•°ç»„é•¿åº¦å¢é•¿ä¸ºåŸå€¼çš„ä¸¤å€ï¼›\nï¼ˆ3ï¼‰å½“æ¡¶å†…æº¢å‡ºæ¡¶(ä»ç¬¬äºŒä¸ªå¼€å§‹åˆ°ç»“æŸ)æ•°é‡å¤§äºç­‰äº 2^B æ—¶( B ä¸ºæ¡¶æ•°ç»„é•¿åº¦çš„æŒ‡æ•°ï¼ŒB æœ€å¤§å– 15)ï¼Œå‘ç”Ÿç­‰é‡æ‰©å®¹ï¼Œæ¡¶æ•°ç»„çš„é•¿åº¦ä¿æŒä¸ºåŸå€¼ï¼›[è€ƒè™‘åˆ°kvå¯¹ä¸å¤š,ä½†æ˜¯æº¢å‡ºæ¡¶å¾ˆå¤šçš„æƒ…å†µ(å¯èƒ½æœ¬æ¥å¾ˆå¤šåæ¥æ…¢æ…¢åˆ æ‰äº†,ä¼šæœ‰å¾ˆå¤šç©ºæ´)]\nï¼ˆ4ï¼‰é‡‡ç”¨æ¸è¿›æ‰©å®¹çš„æ–¹å¼ï¼Œå½“æ¡¶è¢«å®é™…æ“ä½œåˆ°æ—¶ï¼Œç”±ä½¿ç”¨è€…è´Ÿè´£å®Œæˆæ•°æ®è¿ç§»ï¼Œé¿å…å› ä¸ºä¸€æ¬¡æ€§çš„å…¨é‡æ•°æ®è¿ç§»å¼•å‘æ€§èƒ½æŠ–åŠ¨.å°±æ˜¯è¯´åˆ†æ‘Šåˆ°åç»­çš„æ¯ä¸€ç¬”å†™æ“ä½œä¸­å»è¿™æ ·,æ¯”è¾ƒæ¸©å’Œ.\n\nkeyå±äºå“ªä¸ªæ¡¶æ˜¯æœ‰æ˜ å°„å…³ç³»çš„,å“ˆå¸Œä¸å˜,ä½†æ˜¯å¯¹æ¡¶æ•°ç»„å–æ¨¡æœ‰å½±å“,å°±æ˜¯åŠ ä¸Šä¸€å€è€æ•°ç»„ä¸ªæ•°.\n\nå¯¹4å–æ¨¡,å¾—åˆ°çš„ç»“æœæ˜¯0 é‚£ä¹ˆæ¡¶0é‡Œé¢çš„kvå¯¹ keyå–å“ˆå¸Œåå¾—åˆ°æœ€ä½ä¸¤ä½éƒ½æ˜¯00(å¯¹4å–æ¨¡ç­‰ä»·äºå¯¹3æŒ‰ä½ä¸)æ¡¶1 æœ€ä½ä½01.\né‚£æ‰©å®¹åå¯¹8å–æ¨¡,ç­‰ä»·äºå¯¹7æŒ‰ä½ä¸.é‚£ä¹ˆæœ€ç¬¬ä¸‰ä½éƒ½è¦æ˜¯0 æŒ‰ä½ä¸å‡ºæ¥=0çš„æ‰èƒ½æ”¾åœ¨8æ¡¶æ•°ç»„çš„0å·ä½.æœ€ä½ä½æ˜¯100çš„ä¼šæ”¾åœ¨4å·ä½,å’Œæœ¬æ¥çš„0å·ä½å·®4\næ‰€ä»¥è¯´0å·æ¡¶é‡Œçš„æ•°,åœ¨æ‰©å®¹å,è¦ä¹ˆåœ¨0è¦ä¹ˆåœ¨4,å·®çš„å°±æ˜¯ä¸€å€çš„è€æ•°ç»„ä¸ªæ•°.å°±æ˜¯å¤§è‡´è¢«æ‹†æˆä¸¤ä»½,å› æ­¤æ¯ä¸ªæ¡¶ä¸­çš„æ•°æ®è§„æ¨¡ä¹Ÿå¤§è‡´å˜æˆåŸæ¥çš„ä¸€åŠ.\n\næ•°æ®ç»“æ„\næºç ä½ç½®åœ¨runtime/map.go\nhmap =map\n\ncount æ€»kvå¯¹æ•°é‡\nB unit8 æ ‡æ³¨å‡ºæ¡¶æ•°ç»„çš„é•¿åº¦æ˜¯2çš„Bæ¬¡æ–¹(1&lt;&lt;B)\nbuckets unsafe.pointer æŒ‡å‘æ¡¶æ•°ç»„èµ·ç‚¹ä½ç½®\nextra é¢„å…ˆç”³è¯·å¥½çš„æº¢å‡ºæ¡¶èŠ‚ç‚¹\nå¯¹æ¯ä¸ªkv è¿˜ä¼šå­˜ä¸€ä¸ªtopå€¼å¯¹åº”keyçš„å“ˆå¸Œå€¼é«˜å…«ä½æ¥æ ‡è¯†ä¸€äº›é¢å¤–å«ä¹‰\n\n\ntype hmap struct {\n    count     int \n    flags     uint8//mapçŠ¶æ€æ ‡è¯†,æ ‡è¯†mapæ˜¯å¦è¢«goroutineå¹¶å‘è¯»å†™\n    B         uint8  \n    noverflow uint16 //æº¢å‡ºæ¡¶çš„æ•°é‡\n    hash0     uint32 //hashéšæœºå› å­,ç”Ÿæˆkeyçš„hashå€¼å¾—æ—¶å€™ä¼šç”¨åˆ°\n    buckets    unsafe.Pointer //æ¡¶æ•°ç»„\n    oldbuckets unsafe.Pointer //æ‰©å®¹è¿‡ç¨‹ä¸­è€å¾—åŒæ•°ç»„\n    nevacuate  uintptr//æ‰©å®¹è¿›åº¦æ ‡è¯†,å› ä¸ºæ‰©å®¹æ˜¯æ¸è¿›çš„       \n    extra *mapextra \n}\nmapextra æº¢å‡ºæ¡¶\n\ntype mapextra struct {\n    overflow    *[]*bmap//ä¾›æ¡¶æ•°ç»„bucketsä½¿ç”¨çš„æº¢å‡ºæ¡¶\n    oldoverflow *[]*bmap//æ‰©å®¹æµç¨‹ä¸­,è€æ¡¶æ•°ç»„ä½¿ç”¨çš„æº¢å‡ºæ¡¶\n \n \n    nextOverflow *bmap//ä¸‹ä¸€ä¸ªå¯ç”¨çš„æº¢å‡ºæ¡¶\n}\nåœ¨ map åˆå§‹åŒ–æ—¶ï¼Œå€˜è‹¥å®¹é‡è¿‡å¤§ï¼Œä¼šæå‰ç”³è¯·å¥½ä¸€æ‰¹æº¢å‡ºæ¡¶ï¼Œä»¥ä¾›åç»­ä½¿ç”¨ï¼Œè¿™éƒ¨åˆ†æº¢å‡ºæ¡¶å­˜æ”¾åœ¨ hmap.mapextra å½“ä¸­ï¼š\nbmap =mapä¸­çš„æ¡¶\n\nå¯ä»¥å­˜å‚¨8ç»„kvå¯¹,ä»¥åŠä¸€ä¸ªæŒ‡å‘ä¸‹ä¸€ä¸ªæ¡¶çš„æŒ‡é’ˆ\næ¯ç»„kvå¯¹åŒ…æ‹¬ keyçš„é«˜å…«ä½å“ˆå¸Œå€¼tophash,key,val ä¸‰ä¸ªéƒ¨åˆ†.æ¯ç»„kvå¯¹å¯ä»¥ç›´æ¥é€šè¿‡å†…å­˜åœ°å€åç§»çš„æ–¹å¼å»æ‰¾.æ‰€ä»¥ä¸‹é¢ä¸‰ä¸ªå€¼éƒ½ä¸æ˜¯å¤ªæœ‰ç”¨\nconstÂ bucketCntÂ =Â 8\ntypeÂ bmapÂ structÂ {\nÂ Â Â Â tophashÂ [bucketCnt]uint8\nÂ Â Â Â //keys [bucketCnt]T\n    //values [bucketCnt]T\n    //overflow uint8\n}\nè¿™é‡Œkeyå’Œvalueåˆ†å¼€å­˜,æ˜¯ä¸ºäº†å†…å­˜å¯¹é½.å› ä¸ºkä¸€èˆ¬æ˜¯int8(ä¸€å­—èŠ‚),væ˜¯int64(8å­—èŠ‚),9å­—èŠ‚ä¸€ç»„ä¸å¥½å­˜,kkkkvvvvæ¯”è¾ƒå¥½å­˜.\næ„é€ æ–¹æ³•/åˆå§‹åŒ–"},"æŠ€æœ¯ç§¯ç´¯/Golang/æ ¸å¿ƒçŸ¥è¯†/03-GMP-åŸç†":{"slug":"æŠ€æœ¯ç§¯ç´¯/Golang/æ ¸å¿ƒçŸ¥è¯†/03-GMP-åŸç†","filePath":"æŠ€æœ¯ç§¯ç´¯/Golang/æ ¸å¿ƒçŸ¥è¯†/03 GMP åŸç†.md","title":"03 GMP åŸç†","links":[],"tags":[],"content":"æ¦‚å¿µæ¢³ç†\n\n\n                  \n                  tips \n                  \n                \n\nä¸ºä»€ä¹ˆè¦å¼•å…¥P: åŠ å…¥äº†ä¸€ä¸ªæœ¬åœ°é˜Ÿåˆ—,åŸºæœ¬å®ç°äº†æ— é”åŒ–.å¹¶ä¸”å°½é‡è®©ç›¸å…³çš„gåœ¨åŒä¸€ä¸ªmä¸Šè·‘,åˆ©ç”¨äº†cpuå¤šçº§ç¼“å­˜æ€§è´¨.\n\n\nå†…æ ¸çº§\nè¿›ç¨‹\nè¿›ç¨‹ (Process)ï¼šæ˜¯æ“ä½œç³»ç»Ÿèµ„æºåˆ†é…çš„åŸºæœ¬å•ä½ã€‚(å†…å­˜,æ–‡ä»¶å¥æŸ„)\nè¿›ç¨‹åˆ‡æ¢å¼€é”€æœ€å¤§ï¼Œå› ä¸ºæ¶‰åŠè™šæ‹Ÿå†…å­˜ã€æ–‡ä»¶æè¿°ç¬¦ç­‰èµ„æºçš„åˆ‡æ¢ï¼Œç»å¯¹éœ€è¦ CPU å‚ä¸ä¸”å¼€é”€å¾ˆé«˜ã€‚\nçº¿ç¨‹\né€šå¸¸è¯­ä¹‰ä¸­çš„çº¿ç¨‹ï¼ŒæŒ‡çš„æ˜¯å†…æ ¸çº§çº¿ç¨‹ï¼Œæ ¸å¿ƒç‚¹å¦‚ä¸‹ï¼š\nï¼ˆ1ï¼‰æ˜¯æ“ä½œç³»ç»Ÿæœ€å°è°ƒåº¦å•å…ƒï¼›(cpuæ—¶é—´ç‰‡)\nï¼ˆ2ï¼‰åˆ›å»ºã€é”€æ¯ã€è°ƒåº¦äº¤ç”±å†…æ ¸å®Œæˆï¼Œcpu éœ€å®Œæˆç”¨æˆ·æ€ä¸å†…æ ¸æ€é—´çš„åˆ‡æ¢ï¼›\nï¼ˆ3ï¼‰å¯å……åˆ†åˆ©ç”¨å¤šæ ¸ï¼Œå®ç°å¹¶è¡Œ.\nå…³ç³»:ä¸€ä¸ªè¿›ç¨‹å¯ä»¥åŒ…å«å¤šä¸ªçº¿ç¨‹,è¿™äº›çº¿ç¨‹å…±äº«è¿›ç¨‹çš„å †å†…å­˜\\ä»£ç æ®µ\\æ•°æ®æ®µ,ä½†æ¯ä¸ªè¿›ç¨‹æœ‰è‡ªå·±ç‹¬ç«‹çš„æ ˆç©ºé—´å’Œç¨‹åºè®¡æ•°å™¨.\nè¿›ç¨‹åˆ‡æ¢: å¼€é”€æœ€å¤§,æ¶‰åŠé¡µè¡¨åˆ‡æ¢\\æ–‡ä»¶æè¿°ç¬¦åˆ·æ–°.CPUç¼“å­˜TLBä¼šå¤±æ•ˆ\nçº¿ç¨‹åˆ‡æ¢:å¼€é”€å°,åªéœ€è¦ä¿å­˜æ¢å¤å¯„å­˜å™¨å’Œæ ˆä¿¡æ¯(å°±æ˜¯ä¸Šä¸‹æ–‡),ä¸æ”¹å˜è™šæ‹Ÿå†…å­˜ç©ºé—´,cpuç¼“å­˜åˆ©ç”¨ç‡è¾ƒé«˜.\nå¤šè¿›ç¨‹çš„è¯ä¸€ä¸ªè¿›ç¨‹å´©æºƒäº†ä¸ä¼šå½±å“å…¶ä»–è¿›ç¨‹.\nGMP æ¨¡å‹ä¸­çš„æ‰€æœ‰ Mï¼ˆMachineï¼Œå³å†…æ ¸çº¿ç¨‹ï¼‰ï¼Œéƒ½å±äºåŒä¸€ä¸ªè¿›ç¨‹ã€‚\nè¿›ç¨‹é—´é€šä¿¡\nè¿›ç¨‹é—´å†…å­˜æ˜¯éš”ç¦»çš„,é€šä¿¡éº»çƒ¦\n\nç®¡é“: åŒ¿åç®¡é“è´Ÿè´£çˆ¶å­è¿›ç¨‹é€šä¿¡,å‘½åç®¡é“è´Ÿè´£ä»»æ„è¿›ç¨‹é—´é€šä¿¡\næ¶ˆæ¯é˜Ÿåˆ—: å†…æ ¸ä¸­çš„é“¾è¡¨,æŒ‰ç…§æ¶ˆæ¯ç±»å‹è¯»å–\nå…±äº«å†…å­˜: æœ€å¿«é€Ÿ.æ˜ å°„ä¸€æ®µç‰©ç†å†…å­˜åˆ°å¤šä¸ªè¿›ç¨‹çš„è™šæ‹Ÿåœ°å€,è¯»å†™ä¸éœ€è¦æ‹·è´.ä½†æ˜¯éœ€è¦é…åˆä¿¡å·é‡å®ç°åŒæ­¥,é˜²æ­¢å¹¶å‘å†²çª.\nä¿¡å·é‡: ä¸»è¦ç”¨äºåŒæ­¥,ç›¸å½“äºè®¡æ•°å™¨æ¥æ§åˆ¶å¯¹å…±äº«èµ„æºçš„è®¿é—®\nä¿¡å·: ç”¨äºé€šçŸ¥:æ¯”å¦‚kill -9å‘å‡ºçš„ä¿¡å·\nå¥—æ¥å­—: socket æœ€é€šç”¨,ä¸ä»…å¯ä»¥æœ¬æœºé€šä¿¡,è¿˜å¯ä»¥è·¨ç½‘ç»œé€šä¿¡\n\n\nçº¿ç¨‹é—´é€šä¿¡\nçº¿ç¨‹å…±äº«è¿›ç¨‹çš„å†…å­˜,æ‰€ä»¥é€šä¿¡å¾ˆå®¹æ˜“.ä¸»è¦æ˜¯åŒæ­¥\n\nå…±äº«å˜é‡+é”\næ¡ä»¶å˜é‡\nä¿¡å·é‡\nchannelç®¡é“(go)ä¸è¦é€šè¿‡å…±äº«å†…å­˜æ¥é€šä¿¡,è€Œæ˜¯è¦é€šè¿‡é€šä¿¡æ¥å…±äº«å†…å­˜\n\nç”¨æˆ·çº§\nåç¨‹\nåç¨‹ï¼Œåˆç§°ä¸ºç”¨æˆ·çº§çº¿ç¨‹ï¼Œæ ¸å¿ƒç‚¹å¦‚ä¸‹ï¼š\nï¼ˆ1ï¼‰ä¸çº¿ç¨‹å­˜åœ¨æ˜ å°„å…³ç³»ï¼Œä¸º Mï¼š1ï¼›\nï¼ˆ2ï¼‰åˆ›å»ºã€é”€æ¯ã€è°ƒåº¦åœ¨ç”¨æˆ·æ€å®Œæˆ.å®é™…ä¸Šæ˜¯Goä»£ç æŒ‡é’ˆçš„ä¿®æ”¹,åˆ‡æ¢ä¸åŒåç¨‹ç»“æ„ä½“è€Œå·²,å¯¹CPUæ¥è¯´ä¸€ç›´æ˜¯åœ¨è·‘åŒä¸€ä¸ªçº¿ç¨‹\nï¼ˆ3ï¼‰ä»å±åŒä¸€ä¸ªå†…æ ¸çº§çº¿ç¨‹ï¼Œæ— æ³•å¹¶è¡Œï¼›ä¸€ä¸ªåç¨‹é˜»å¡ä¼šå¯¼è‡´ä»å±åŒä¸€çº¿ç¨‹çš„æ‰€æœ‰åç¨‹æ— æ³•æ‰§è¡Œ.\nGoroutine\nGoroutineï¼Œç» Golang ä¼˜åŒ–åçš„ç‰¹æ®Šâ€œåç¨‹â€ï¼Œæ ¸å¿ƒç‚¹å¦‚ä¸‹ï¼š\nï¼ˆ1ï¼‰ä¸çº¿ç¨‹å­˜åœ¨æ˜ å°„å…³ç³»ï¼Œä¸º Mï¼šNï¼›\nï¼ˆ2ï¼‰åˆ›å»ºã€é”€æ¯ã€è°ƒåº¦åœ¨ç”¨æˆ·æ€å®Œæˆï¼Œå¯¹å†…æ ¸é€æ˜ï¼Œè¶³å¤Ÿè½»ä¾¿ï¼›\nï¼ˆ3ï¼‰å¯åˆ©ç”¨å¤šä¸ªçº¿ç¨‹ï¼Œå®ç°å¹¶è¡Œï¼›\nï¼ˆ4ï¼‰é€šè¿‡è°ƒåº¦å™¨çš„æ–¡æ—‹ï¼Œå®ç°å’Œçº¿ç¨‹é—´çš„åŠ¨æ€ç»‘å®šå’Œçµæ´»è°ƒåº¦ï¼›\nï¼ˆ5ï¼‰æ ˆç©ºé—´å¤§å°å¯åŠ¨æ€æ‰©ç¼©ï¼Œå› åœ°åˆ¶å®œ.\nGMPæ¨¡å‹\ngmp = goroutine + machine + processor ï¼ˆ+ ä¸€å¥—æœ‰æœºç»„åˆçš„æœºåˆ¶ï¼‰ï¼Œä¸‹é¢å…ˆå•ç‹¬æ‹†å‡ºæ¯ä¸ªç»„ä»¶è¿›è¡Œä»‹ç»ï¼Œæœ€åå†æ€»è§ˆå…¨å±€ï¼Œå¯¹ gmp è¿›è¡Œæ€»è¿°\ng\nï¼ˆ1ï¼‰g å³goroutineï¼Œæ˜¯ golang ä¸­å¯¹åç¨‹çš„æŠ½è±¡ï¼›\nï¼ˆ2ï¼‰g æœ‰è‡ªå·±çš„è¿è¡Œæ ˆã€çŠ¶æ€ã€ä»¥åŠæ‰§è¡Œçš„ä»»åŠ¡å‡½æ•°ï¼ˆç”¨æˆ·é€šè¿‡ go func æŒ‡å®šï¼‰ï¼›\nï¼ˆ3ï¼‰g éœ€è¦ç»‘å®šåˆ° p æ‰èƒ½æ‰§è¡Œï¼Œåœ¨ g çš„è§†è§’ä¸­ï¼Œp å°±æ˜¯å®ƒçš„ cpu.\np\nï¼ˆ1ï¼‰p å³ processorï¼Œæ˜¯ golang ä¸­çš„è°ƒåº¦å™¨ï¼›\nï¼ˆ2ï¼‰p æ˜¯ gmp çš„ä¸­æ¢ï¼Œå€Ÿç”± p æ‰¿ä¸Šå¯ä¸‹ï¼Œå®ç° g å’Œ m ä¹‹é—´çš„åŠ¨æ€æœ‰æœºç»“åˆï¼›\nï¼ˆ3ï¼‰å¯¹ g è€Œè¨€ï¼Œp æ˜¯å…¶ cpuï¼Œg åªæœ‰è¢« p è°ƒåº¦ï¼Œæ‰å¾—ä»¥æ‰§è¡Œï¼›\nï¼ˆ4ï¼‰å¯¹ m è€Œè¨€ï¼Œp æ˜¯å…¶æ‰§è¡Œä»£ç†ï¼Œä¸ºå…¶æä¾›å¿…è¦ä¿¡æ¯çš„åŒæ—¶ï¼ˆå¯æ‰§è¡Œçš„ gã€å†…å­˜åˆ†é…æƒ…å†µç­‰ï¼‰ï¼Œå¹¶éšè—äº†ç¹æ‚çš„è°ƒåº¦ç»†èŠ‚ï¼›\nï¼ˆ5ï¼‰p çš„æ•°é‡å†³å®šäº† g æœ€å¤§å¹¶è¡Œæ•°é‡ï¼Œå¯ç”±ç”¨æˆ·é€šè¿‡ GOMAXPROCS è¿›è¡Œè®¾å®šï¼ˆè¶…è¿‡ CPU æ ¸æ•°æ—¶æ— æ„ä¹‰ï¼‰.\nm\nï¼ˆ1ï¼‰m å³ machineï¼Œæ˜¯ golang ä¸­å¯¹çº¿ç¨‹çš„æŠ½è±¡ï¼›\nï¼ˆ2ï¼‰m ä¸ç›´æ¥æ‰§è¡Œ gï¼Œè€Œæ˜¯å…ˆå’Œ p ç»‘å®šï¼Œç”±å…¶å®ç°ä»£ç†ï¼›\nï¼ˆ3ï¼‰å€Ÿç”± p çš„å­˜åœ¨ï¼Œm æ— éœ€å’Œ g ç»‘æ­»ï¼Œä¹Ÿæ— éœ€è®°å½• g çš„çŠ¶æ€ä¿¡æ¯ï¼Œå› æ­¤ g åœ¨å…¨ç”Ÿå‘½å‘¨æœŸä¸­å¯ä»¥å®ç°è·¨ m æ‰§è¡Œ.\ngmp\n\nGMP å®è§‚æ¨¡å‹å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œä¸‹é¢å¯¹å…¶è¦ç‚¹å’Œç»†èŠ‚è¿›è¡Œé€ä¸€ä»‹ç»ï¼š\nï¼ˆ1ï¼‰M æ˜¯çº¿ç¨‹çš„æŠ½è±¡ï¼›G æ˜¯ goroutineï¼›P æ˜¯æ‰¿ä¸Šå¯ä¸‹çš„è°ƒåº¦å™¨ï¼›\nï¼ˆ2ï¼‰Mè°ƒåº¦Gå‰ï¼Œéœ€è¦å’ŒPç»‘å®šï¼›ä¸€ä¸ªmç»‘å®šä¸€ä¸ªg\nï¼ˆ3ï¼‰å…¨å±€æœ‰å¤šä¸ªMå’Œå¤šä¸ªPï¼Œä½†åŒæ—¶å¹¶è¡Œçš„Gçš„æœ€å¤§æ•°é‡ç­‰äºPçš„æ•°é‡ï¼›\nï¼ˆ4ï¼‰Gçš„å­˜æ”¾é˜Ÿåˆ—æœ‰ä¸‰ç±»\n\nPçš„æœ¬åœ°é˜Ÿåˆ—\nå…¨å±€é˜Ÿåˆ—\nwaité˜Ÿåˆ—ï¼ˆå›¾ä¸­æœªå±•ç¤ºï¼Œä¸ºioé˜»å¡å°±ç»ªæ€goroutineé˜Ÿåˆ—ï¼‰\n\nï¼ˆ5ï¼‰Mè°ƒåº¦Gæ—¶ï¼Œä¼˜å…ˆå–Pæœ¬åœ°é˜Ÿåˆ—ï¼Œå…¶æ¬¡å–å…¨å±€é˜Ÿåˆ—ï¼Œæœ€åå–waité˜Ÿåˆ—ï¼›è¿™æ ·çš„å¥½å¤„æ˜¯ï¼Œå–æœ¬åœ°é˜Ÿåˆ—æ—¶ï¼Œå¯ä»¥æ¥è¿‘äºæ— é”åŒ–ï¼Œå‡å°‘å…¨å±€é”ç«äº‰ï¼›\nï¼ˆ6ï¼‰ä¸ºé˜²æ­¢ä¸åŒPçš„é—²å¿™å·®å¼‚è¿‡å¤§ï¼Œè®¾ç«‹work-stealingæœºåˆ¶ï¼Œæœ¬åœ°é˜Ÿåˆ—ä¸ºç©ºçš„På¯ä»¥å°è¯•ä»å…¶ä»–Pæœ¬åœ°é˜Ÿåˆ—å·å–ä¸€åŠçš„Gè¡¥å……åˆ°è‡ªèº«é˜Ÿåˆ—.\nå…¨å±€é˜Ÿåˆ—:ä¸èƒ½æ»¡,å¿…é¡»è¦èƒ½å¤Ÿæ‰©å®¹,ä½†æ˜¯æ‰©å®¹ä¼šé”æ­»æ‰€æœ‰p,æ‰€ä»¥ç”¨é“¾è¡¨å¯ä»¥ç›´æ¥æŒ‚åˆ°æœ«å°¾.å¹¶ä¸”å¦‚æœæœ‰ç§»åŠ¨çš„è¯ä¸éœ€è¦å†…å­˜æ‹·è´,åªéœ€è¦æŒ‡é’ˆæ“ä½œ.\næœ¬åœ°é˜Ÿåˆ—:å›ºå®šé•¿åº¦æ•°ç»„256,å› ä¸ºpè®¿é—®æœ¬åœ°é˜Ÿåˆ—éå¸¸é¢‘ç¹,ä¸€å£æ°”åŠ è½½è¿ç»­å†…å­˜çš„ç©ºé—´å±€éƒ¨æ€§æ¯”è¾ƒå‹å¥½,ä¹Ÿæ²¡æœ‰gcå¼€é”€\næ ¸å¿ƒæ•°æ®ç»“æ„\ng\ntype g struct {\n    // ...\n    m         *m    //è´Ÿè´£æ‰§è¡Œå½“å‰gçš„m\n    // ...\n    sched     gobuf//gobuffer å­˜æ¡£\n    // ...\n}\n \n \ntype gobuf struct {\n    sp   uintptr //ä¿å­˜ CPU çš„ rsp å¯„å­˜å™¨çš„å€¼ï¼ŒæŒ‡å‘å‡½æ•°è°ƒç”¨æ ˆæ ˆé¡¶\n    pc   uintptr //ä¿å­˜ CPU çš„ rip å¯„å­˜å™¨çš„å€¼ï¼ŒæŒ‡å‘ç¨‹åºä¸‹ä¸€æ¡æ‰§è¡ŒæŒ‡ä»¤çš„åœ°å€\n    ret  uintptr //ä¿å­˜ç³»ç»Ÿè°ƒç”¨çš„è¿”å›å€¼\n    bp   uintptr // ä¿å­˜ CPU çš„ rbp å¯„å­˜å™¨çš„å€¼ï¼Œå­˜å‚¨å‡½æ•°æ ˆå¸§çš„èµ·å§‹ä½ç½®.\n}\n \n \nconst(\n  _Gidle = itoa // 0 ä¸ºåç¨‹å¼€å§‹åˆ›å»ºæ—¶çš„çŠ¶æ€ï¼Œæ­¤æ—¶å°šæœªåˆå§‹åŒ–å®Œæˆ\n  _Grunnable // 1 åç¨‹åœ¨å¾…æ‰§è¡Œé˜Ÿåˆ—ä¸­ï¼Œç­‰å¾…è¢«æ‰§è¡Œ\n  _Grunning // 2 åç¨‹åœ¨å¾…æ‰§è¡Œé˜Ÿåˆ—ä¸­ï¼Œç­‰å¾…è¢«æ‰§è¡Œ\n  _Gsyscall // 3 åç¨‹æ­£åœ¨æ‰§è¡Œç³»ç»Ÿè°ƒç”¨\n  _Gwaiting // 4 åç¨‹å¤„äºæŒ‚èµ·æ€ï¼Œéœ€è¦ç­‰å¾…è¢«å”¤é†’. gcã€channel é€šä¿¡æˆ–è€…é”æ“ä½œæ—¶ç»å¸¸ä¼šè¿›å…¥è¿™ç§çŠ¶æ€\n  _Gdead // 6 åç¨‹åˆšåˆå§‹åŒ–å®Œæˆæˆ–è€…å·²ç»è¢«é”€æ¯ï¼Œä¼šå¤„äºæ­¤çŠ¶æ€\n  _Gcopystack // 8 åç¨‹æ­£åœ¨æ ˆæ‰©å®¹æµç¨‹ä¸­\n  _Gpreempted // 9 åç¨‹è¢«æŠ¢å åçš„çŠ¶æ€\n)\nm\ntype m struct {\n    g0      *g     // goroutine with scheduling stackä¸€ç±»ç‰¹æ®Šçš„è°ƒåº¦åç¨‹,ä¸ç”¨äºæ‰§è¡Œç”¨æˆ·å‡½æ•°,è´Ÿè´£æ‰§è¡Œgä¹‹é—´çš„åˆ‡æ¢è°ƒåº¦,ä¸mçš„å…³ç³»ä¸º1:1,ä¹Ÿä¸éœ€è¦æ’é˜Ÿ,å°±æ˜¯mçš„ä¸€éƒ¨åˆ†\n    // ...\n    tls           [tlsSlots]uintptr // thread-local storage (for x86 extern register)çº¿ç¨‹æœ¬åœ°å­˜å‚¨,å­˜å‚¨å†…å®¹åªå¯¹å½“å‰çº¿ç¨‹å¯è§,çº¿ç¨‹æœ¬åœ°å­˜å‚¨çš„æ˜¯m.tls çš„åœ°å€ï¼Œm.tls[0] å­˜å‚¨çš„æ˜¯å½“å‰è¿è¡Œçš„ gï¼Œå› æ­¤çº¿ç¨‹å¯ä»¥é€šè¿‡ g æ‰¾åˆ°å½“å‰çš„ mã€pã€g0 ç­‰ä¿¡æ¯.\n    //å…¶å®ä»£ç æ‰§è¡Œçš„æ—¶å€™,cpuä¹Ÿä¸çŸ¥é“è‡ªå·±åœ¨å“ªä¸ªmé‡Œé¢,æ‰€ä»¥è¦ç”¨m.tls[0].må»æ‰¾,è¿™ä¹ˆåšä¸»è¦æ˜¯å› ä¸ºéœ€è¦æ›´å¿«é€Ÿçš„è®¿é—®gæ‰€ä»¥ç‰ºç‰²äº†è®¿é—®mçš„æ‰€éœ€æ—¶é—´\n    // ...\n}\np\ntype p struct {\n    // ...\n    runqhead uint32  //é˜Ÿåˆ—å¤´\n    runqtail uint32   //é˜Ÿåˆ—å°¾\n    runq     [256]guintptr   //æœ¬åœ°gé˜Ÿåˆ—,æœ€å¤§é•¿åº¦256\n    \n    runnext guintptr  //ä¸‹ä¸€ä¸ªå¯ä»¥æ‰§è¡Œçš„g  æ¯”å¦‚ä¸€äº›æ’é˜Ÿçš„,æ¯”å¦‚ä¸¤ä¸ªåç¨‹ä¹‹é—´æœ‰ä¸€äº›äº²ç¼˜å…³ç³»,é‚£ä¹ˆå¤§æ¦‚ç‡ä¼šå…±äº«æ•°æ®,è¿™æ ·å°±ä¼˜å…ˆè¿è¡Œäº²ç¼˜è¿‘çš„,å¯ä»¥æ›´å¥½çš„åˆ©ç”¨cpuç¼“å­˜ä¸ç”¨æ´—æ‰æœ¬æ¥çš„æ•°æ®\n    // ...\n}\nschedt\nå…¨å±€gé˜Ÿåˆ—çš„å°è£…\ntype schedt struct {\n    // ...\n    lock mutex   //å…¨å±€gé˜Ÿåˆ—çš„é”\n    // ...\n    runq     gQueue   //å…¨å±€gé˜Ÿåˆ—\n    runqsize int32 //å…¨å±€gé˜Ÿåˆ—çš„å®¹é‡\n    // ...\n}\nè°ƒåº¦æµç¨‹\nä¸¤ç§gçš„è½¬æ¢\ngå¯ä»¥åˆ†ä¸ºä¸¤ç±»\n\næ™®é€šg\nè°ƒåº¦æ™®é€šgçš„g0 æ‰§è¡Œå›ºå®šçš„è°ƒåº¦æµç¨‹,ä¸mçš„å…³ç³»æ˜¯1: 1\n\nm é€šè¿‡ p è°ƒåº¦æ‰§è¡Œçš„ goroutine æ°¸è¿œåœ¨æ™®é€š g å’Œ g0 ä¹‹é—´è¿›è¡Œåˆ‡æ¢\n\nå½“ g0 æ‰¾åˆ°å¯æ‰§è¡Œçš„ g æ—¶ï¼Œä¼šè°ƒç”¨ gogo æ–¹æ³•ï¼Œè°ƒåº¦ g æ‰§è¡Œç”¨æˆ·å®šä¹‰çš„ä»»åŠ¡\nå½“ g éœ€è¦ä¸»åŠ¨è®©æ¸¡æˆ–è¢«åŠ¨è°ƒåº¦æ—¶ï¼Œä¼šè§¦å‘ mcall æ–¹æ³•ï¼Œå°†æ‰§è¡Œæƒé‡æ–°äº¤è¿˜ç»™ g0.\n\nfunc gogo(buf *gobuf)//æ ¹æ®ç¼“å­˜å†…å®¹æ¢å¤æ™®é€šg\n// ...\nfunc mcall(fn func(*g)) //fnæ˜¯ä¸€ä¸ªå¤„ç†å‡½æ•°,åœ¨å½»åº•åˆ‡æ¢åˆ°g0ä¹‹åä¼šè¢«æ‰§è¡Œ,ä¸€èˆ¬æ˜¯ä¸€äº›è°ƒåº¦å™¨é€»è¾‘,æŠŠæ”¾å¼ƒäº†cpuçš„è¿™ä¸ªgæ”¾åˆ°é˜Ÿåˆ—å°¾ä¹‹ç±»çš„\nè°ƒåº¦ç±»å‹\nä¸»åŠ¨è°ƒåº¦\n\nä¸€ç§ç”¨æˆ·ä¸»åŠ¨æ‰§è¡Œè®©æ¸¡çš„æ–¹å¼ï¼Œä¸»è¦æ–¹å¼æ˜¯ï¼Œç”¨æˆ·åœ¨æ‰§è¡Œä»£ç ä¸­è°ƒç”¨äº†runtime.Gosched æ–¹æ³•ï¼Œæ­¤æ—¶å½“å‰ g ä¼šå½“è®©å‡ºæ‰§è¡Œæƒï¼Œä¸»åŠ¨å›åˆ°å…¨å±€é˜Ÿåˆ—, ç­‰å¾…ä¸‹æ¬¡è¢«è°ƒåº¦æ‰§è¡Œ.\nä¿è¯äº†å½“å‰ P çš„æœ¬åœ°ä»»åŠ¡èƒ½å¾—åˆ°æ‰§è¡Œï¼Œä¹Ÿè®©å…¶ä»– P æœ‰æœºä¼šåˆ†æ‹…è¿™ä¸ª G\n\nfuncÂ Gosched()Â {\nÂ Â Â Â checkTimeouts()\nÂ Â Â Â mcall(gosched_m)//è®©g0æŠŠgæ”¾åˆ°å…¨å±€é˜Ÿåˆ—\nÂ Â Â Â }\nè¢«åŠ¨è°ƒåº¦\nå¸¸è§çš„è¢«åŠ¨è°ƒåº¦è§¦å‘æ–¹å¼\n\nå›  channel æ“ä½œæˆ–äº’æ–¥é”æ“ä½œé™·å…¥é˜»å¡ç­‰æ“ä½œï¼Œgä¼šè°ƒç”¨ gopark æ–¹æ³•.è¿™é‡Œçš„é˜»å¡æ˜¯ç”¨æˆ·æ€é˜»å¡,ä¸éœ€è¦å ç”¨m,gè¿›è¡Œmcall,è®©g0æŠŠè‡ªå·±æ”¾è¿›ç­‰å¾…é˜Ÿåˆ—.\n\nfunc gopark(unlockf func(*g, unsafe.Pointer) bool, lock unsafe.Pointer, reason waitReason, traceEv byte, traceskip int) {\n    // ...\n    mcall(park_m)\n}\n\ngoready æ–¹æ³•é€šå¸¸ä¸ gopark æ–¹æ³•æˆå¯¹å‡ºç°ï¼Œå½“æ»¡è¶³å”¤é†’æ¡ä»¶åå°±ä¼šè¢«è°ƒç”¨.èƒ½å¤Ÿå°† g ä»é˜»å¡æ€ä¸­æ¢å¤ï¼Œé‡æ–°è¿›å…¥ç­‰å¾…æ‰§è¡Œçš„çŠ¶æ€.ä¼˜å…ˆè¿›å…¥æœ¬åœ°é˜Ÿåˆ—,å¦‚æœæœ¬åœ°é˜Ÿåˆ—æ»¡äº†,å°±ä¼šè¿›å…¥å…¨å±€é˜Ÿåˆ—\n\nfunc goready(gp *g, traceskip int) {\n    systemstack(func() {\n        ready(gp, traceskip, true)\n    })\n}\n\n\n                  \n                  ç”¨æˆ·æ€é˜»å¡ä¸çº¿ç¨‹æ€é˜»å¡ \n                  \n                \n\nç”¨æˆ·æ€é˜»å¡:åªéœ€è¦è¿›è¡Œé€»è¾‘ç­‰å¾…,åªè¦ä¿¡å·æ¥äº†ç«‹é©¬å°±èƒ½æ¢å¤ï¼Œå¹¶ä¸å ç”¨m\n\nchannel,ç­‰å¾…æœ‰äººå¾€é‡Œé¢å¡æ•°æ®\nmutex,ç­‰å¾…é”è¢«é‡Šæ”¾çš„ä¿¡å·\nsleep,ç­‰å¾…é—¹é’Ÿå“äº†çš„ä¿¡å·\n\nçº¿ç¨‹é˜»å¡(mé˜»å¡),æ€»ä¹‹ä¼šè®©å†…æ ¸å¡ä½å¹²ä¸äº†åˆ«çš„äº‹æƒ…\n\nç£ç›˜io\nç³»ç»Ÿè°ƒç”¨\n\n\n\næ­£å¸¸è°ƒåº¦\ng ä¸­çš„æ‰§è¡Œä»»åŠ¡å·²å®Œæˆï¼Œg0 ä¼šå°†å½“å‰ g ç½®ä¸ºæ­»äº¡çŠ¶æ€ï¼Œå‘èµ·æ–°ä¸€è½®è°ƒåº¦.\næŠ¢å è°ƒåº¦\n\n\nå€˜è‹¥ g æ‰§è¡Œç³»ç»Ÿè°ƒç”¨[mé˜»å¡]è¶…è¿‡æŒ‡å®šçš„æ—¶é•¿ï¼Œä¸”å…¨å±€çš„ p èµ„æºæ¯”è¾ƒç´§ç¼ºï¼Œæ­¤æ—¶å°† p å’Œ g è§£ç»‘ï¼ŒæŠŠpæŠ¢å å‡ºæ¥ç”¨äºå…¶ä»– g çš„è°ƒåº¦.\n\n\nç­‰ g å®Œæˆç³»ç»Ÿè°ƒç”¨åï¼Œä¼šé‡æ–°è¿›å…¥å…¨å±€é˜Ÿåˆ—ä¸­ç­‰å¾…è¢«è°ƒåº¦.[è¿™æ—¶å€™må·²ç»æ²¡æœ‰päº†,æ‰€ä»¥ä¹Ÿå°±æ„å‘³ç€æ²¡æœ‰æœ¬åœ°é˜Ÿåˆ—,gå°±å›åˆ°å…¨å±€é˜Ÿåˆ—,è€Œmä¼šè¯•ç€å»å¯»æ‰¾ç©ºé—²çš„p]\n\n\nå€¼å¾—ä¸€æçš„æ˜¯ï¼Œå‰ 3 ç§è°ƒåº¦æ–¹å¼éƒ½ç”± m ä¸‹çš„ g0 å®Œæˆï¼Œå”¯ç‹¬æŠ¢å è°ƒåº¦ä¸åŒ.\n\n\nå› ä¸ºå‘èµ·ç³»ç»Ÿè°ƒç”¨æ—¶éœ€è¦æ‰“ç ´ç”¨æˆ·æ€çš„è¾¹ç•Œè¿›å…¥å†…æ ¸æ€ï¼Œæ­¤æ—¶ m ä¹Ÿä¼šå› ç³»ç»Ÿè°ƒç”¨è€Œé™·å…¥åƒµç›´ï¼Œæ— æ³•ä¸»åŠ¨å®ŒæˆæŠ¢å è°ƒåº¦çš„è¡Œä¸º.\n\n\nå› æ­¤ï¼Œåœ¨ Golang è¿›ç¨‹ä¼šæœ‰ä¸€ä¸ªå…¨å±€ç›‘æ§åç¨‹ monitor g çš„å­˜åœ¨ï¼Œè¿™ä¸ª g ä¼šè¶Šè¿‡ p ç›´æ¥ä¸ä¸€ä¸ª m [ä¸“ç”¨çš„,ç‹¬ç«‹çš„m]è¿›è¡Œç»‘å®šï¼Œä¸æ–­è½®è¯¢å¯¹æ‰€æœ‰ p çš„æ‰§è¡ŒçŠ¶å†µè¿›è¡Œç›‘æ§. å€˜è‹¥å‘ç°æ»¡è¶³æŠ¢å è°ƒåº¦çš„æ¡ä»¶ï¼Œåˆ™ä¼šä»ç¬¬ä¸‰æ–¹çš„è§’åº¦å‡ºæ‰‹å¹²é¢„ï¼Œä¸»åŠ¨å‘èµ·è¯¥åŠ¨ä½œ.\n\nåœ¨ Go çš„å†…å­˜é‡Œï¼Œæœ‰ä¸€ä¸ªå…¨å±€æ•°ç»„å« allpï¼Œé‡Œé¢è®°å½•äº†æ‰€æœ‰ Pï¼ˆç‹¬è½®è½¦ï¼‰ çš„å®æ—¶çŠ¶æ€ã€‚\n\n\n\n\n\n                  \n                  æŠ¢å  \n                  \n                \n\n1.14ä¹‹å‰,åä½œå¼å¼ºå .ç¼–è¯‘å™¨ä¼šåœ¨å‡½æ•°è°ƒç”¨å…¥å£æ’å…¥æ£€æŸ¥ä»£ç ,å¦‚æœå†™äº†æ­»å¾ªç¯ä¸”æ²¡æœ‰å‡½æ•°è°ƒç”¨,å°±æ°¸è¿œä¸ä¼šè¢«æŠ¢å ,mç›´æ¥è¢«å æ­».\n1.14ä¹‹å,å˜æˆäº†åŸºäºä¿¡å·çš„æŠ¢å /å¼‚æ­¥æŠ¢å ,sysmon(å°±æ˜¯å…¨å±€g)ä¼šç»™må‘é€ä¸€ä¸ªæ“ä½œç³»ç»Ÿä¿¡å·,ä¸ç®¡gåœ¨å¹²å˜›,æ“ä½œç³»ç»Ÿä¼šä¸­æ–­ä»–å¹¶å¼ºåˆ¶æ’å…¥è°ƒåº¦é€»è¾‘,æ‰€ä»¥ç°åœ¨æ­»å¾ªç¯ä¹Ÿèƒ½è¢«æŠ¢ä¸‹æ¥äº†\n\n\nå®è§‚è°ƒåº¦æµç¨‹\nï¼ˆ1ï¼‰ä»¥ g0 â†’ g â†’ g0 çš„ä¸€è½®å¾ªç¯ä¸ºä¾‹è¿›è¡Œä¸²è”ï¼›\nï¼ˆ2ï¼‰g0 æ‰§è¡Œ schedule() å‡½æ•°ï¼Œå¯»æ‰¾åˆ°ç”¨äºæ‰§è¡Œçš„ gï¼›\nï¼ˆ3ï¼‰g0 æ‰§è¡Œ execute() æ–¹æ³•ï¼Œæ›´æ–°å½“å‰ gã€p çš„çŠ¶æ€ä¿¡æ¯ï¼Œå¹¶è°ƒç”¨ gogo() æ–¹æ³•ï¼Œå°†æ‰§è¡Œæƒäº¤ç»™ gï¼›\nï¼ˆ4ï¼‰g å› ä¸»åŠ¨è®©æ¸¡( gosche_m() )ã€è¢«åŠ¨è°ƒåº¦( park_m() )ã€æ­£å¸¸ç»“æŸ( goexit0() )ç­‰åŸå› ï¼Œè°ƒç”¨ m_call å‡½æ•°ï¼Œæ‰§è¡Œæƒé‡æ–°å›åˆ° g0 æ‰‹ä¸­ï¼›\nï¼ˆ5ï¼‰g0 æ‰§è¡Œ schedule() å‡½æ•°ï¼Œå¼€å¯æ–°ä¸€è½®å¾ªç¯.\nfunc schedule() {\n    // ...\n    gp, inheritTime, tryWakeP := findRunnable() // blocks until work is available//å¯»æ‰¾åˆ°ä¸‹ä¸€ä¸ªæ‰§è¡Œçš„goroutine\n \n \n    // ...\n    execute(gp, inheritTime)//æ‰§è¡Œè¯¥goroutine:æ›´æ–°çŠ¶æ€ä¿¡æ¯,å¹¶ä¸”è°ƒç”¨gogoæ–¹æ³•åŠ è½½gobuf\n}\nfindRunnable\nå¦‚ä½•æ‰¾åˆ°ä¸‹ä¸€ä¸ªè¦æ‰§è¡Œçš„g.\næ˜¯ Mï¼ˆåœ¨ g0 æ ˆä¸Šï¼‰è¿è¡Œè°ƒåº¦ç¨‹åºï¼Œæ“ä½œ P çš„æœ¬åœ°é˜Ÿåˆ—æˆ–å…¨å±€é˜Ÿåˆ—æ¥è·å– G\nfunc findRunnable() (gp *g, inheritTime, tryWakeP bool) {\n    _g_ := getg()\n \n \ntop:\n    _p_ := _g_.m.p.ptr()\n    // ...\n    // 1. pæ¯æ‰§è¡Œ61æ¬¡è°ƒåº¦,ä¼šä»å…¨å±€é˜Ÿåˆ—ä¸­è·å–ä¸€ä¸ª goroutine è¿›è¡Œæ‰§è¡Œ\n    if _p_.schedtick%61 == 0 &amp;&amp; sched.runqsize &gt; 0 {\n        lock(&amp;sched.lock)\n        gp = globrunqget(_p_, 1)\n        unlock(&amp;sched.lock)\n        if gp != nil {\n            return gp, false, false\n        }\n    }\n    \n    // ...\n    //2. å°è¯•ä»pæœ¬åœ°é˜Ÿåˆ—ä¸­è·å–ä¸€ä¸ªå¯æ‰§è¡Œçš„goroutine:runqgetæ–¹æ³•\n    if gp, inheritTime := runqget(_p_); gp != nil {\n        return gp, inheritTime, false\n    }\n    \n    // ...\n    //3. å€˜è‹¥æœ¬åœ°é˜Ÿåˆ—æ²¡æœ‰å¯æ‰§è¡Œçš„g,ä¼šä»å…¨å±€é˜Ÿåˆ—ä¸­è·å–\n    if sched.runqsize != 0 {\n        lock(&amp;sched.lock)//åŠ é”\n        gp := globrunqget(_p_, 0)\n        unlock(&amp;sched.lock)\n        if gp != nil {\n            return gp, false, false\n        }\n    }\n    \n\t//4. å€˜è‹¥æœ¬åœ°é˜Ÿåˆ—å’Œå…¨å±€é˜Ÿåˆ—éƒ½æ²¡æœ‰g,åˆ™ä¼šè·å–å‡†å¤‡å°±ç»ªçš„ç½‘ç»œåç¨‹\n    if netpollinited() &amp;&amp; atomic.Load(&amp;netpollWaiters) &gt; 0 &amp;&amp; atomic.Load64(&amp;sched.lastpoll) != 0 {\n        if list := netpoll(0); !list.empty() { // non-blocking\n            gp := list.pop()\n            injectglist(&amp;list)\n            casgstatus(gp, _Gwaiting, _Grunnable)//åˆšè·å–ç½‘ç»œåç¨‹æ—¶ï¼Œg çš„çŠ¶æ€æ˜¯å¤„äº waiting çš„ï¼Œå› æ­¤éœ€è¦å…ˆæ›´æ–°ä¸º runnable çŠ¶æ€.\n            return gp, false, false\n        }\n    }\n \n    // ...\n    //5. work-stealing:ä»å…¶ä»– p ä¸­å·å– g\n    procs := uint32(gomaxprocs)\n    if _g_.m.spinning || 2*atomic.Load(&amp;sched.nmspinning) &lt; procs-atomic.Load(&amp;sched.npidle) {\n        if !_g_.m.spinning {\n            _g_.m.spinning = true\n            atomic.Xadd(&amp;sched.nmspinning, 1)\n        }\n \n        gp, inheritTime, tnow, w, newWork := stealWork(now)\n        now = tnow\n        if gp != nil {\n            // Successfully stole.\n            return gp, inheritTime, false\n        }\n        if newWork {\n            // There may be new timer or GC work; restart to\n            // discover.\n            goto top\n        }\n        if w != 0 &amp;&amp; (pollUntil == 0 || w &lt; pollUntil) {\n            // Earlier timer to wait for.\n            pollUntil = w\n        }\n    }\nå…·ä½“å‡½æ•°\n1. é˜²é¥¿æ­»\n\npæ¯æ‰§è¡Œ61æ¬¡è°ƒåº¦,ä¼šä»å…¨å±€é˜Ÿåˆ—ä¸­è·å–ä¸€ä¸ª goroutine è¿›è¡Œæ‰§è¡Œ\n\né€šè¿‡globrunqget,ä¼ å…¥max=1(æœ€å¤šåªæ‹¿ä¸€ä¸ª)\n\n\n\nfunc globrunqget(_p_ *p, max int32) *g {\n//å…¨å±€é˜Ÿåˆ—ä¸ºç©º\n    if sched.runqsize == 0 {\n        return nil\n    }\n//è¦è·å–çš„goroutineæ•°ä¸º,å…¨å±€gæ€»æ•°/pæ€»æ•°+1 æ¯”å¦‚11ä¸ªg2ä¸ªp,æ¯ä¸ªpåˆ†åˆ°6ä¸ª\n    n := sched.runqsize/gomaxprocs + 1\n    if n &gt; sched.runqsize {\n        n = sched.runqsize\n    }//ä¸è¶…è¿‡å…¨å±€gæ•°\n    //å¦‚æœæ˜¯é˜²é¥¿æ­»æœºåˆ¶,max=1,è¿™æ˜¯è°ƒç”¨è€…æŒ‡å®šçš„\n    if max &gt; 0 &amp;&amp; n &gt; max {\n        n = max\n    }\n    //ä¸è¶…è¿‡æœ¬åœ°é˜Ÿåˆ—å®¹é‡çš„ä¸€åŠ(åˆ«å¡å¤ªæ»¡)\n    if n &gt; int32(len(_p_.runq))/2 {\n        n = int32(len(_p_.runq)) / 2\n    }\n\t//å¼€å§‹æ¬è¿\n    sched.runqsize -= n\n    gp := sched.runq.pop()//å¼¹å‡ºä¸€ä¸ªæ˜¯é©¬ä¸Šè¦æ‰§è¡Œçš„g\n    n--\n    //å‰©ä¸‹çš„g, å¾ªç¯å¡è¿›pçš„æœ¬åœ°é˜Ÿåˆ—\n    for ; n &gt; 0; n-- {\n        gp1 := sched.runq.pop()\n        runqput(_p_, gp1, false)\n    }\n    return gp//è¿”å›è¦è·‘çš„é‚£ä¸ªg\n}\nå°†ä¸€ä¸ª g ç”±å…¨å±€é˜Ÿåˆ—è½¬ç§»åˆ° p æœ¬åœ°é˜Ÿåˆ—çš„æ‰§è¡Œé€»è¾‘:\nfunc runqput(_p_ *p, gp *g, next bool) {\n    // ...\n \nretry:\n    h := atomic.LoadAcq(&amp;_p_.runqhead) // åŸå­åŠ è½½å¤´èŠ‚ç‚¹ç´¢å¼•\n    t := _p_.runqtail//åŠ è½½å°¾èŠ‚ç‚¹ç´¢å¼•\n    //ç¯å½¢é˜Ÿåˆ—è¿˜æ²¡æ»¡çš„æ—¶å€™ //goè¯­è¨€ä¸­ç¯å½¢é˜Ÿåˆ—çš„tå’Œhä¸ä¼šå½’é›¶ä¼šä¸€ç›´å‘ä¸Šå¢é•¿,è®¡ç®—å½“å‰ç¯å½¢é˜Ÿåˆ—ä¸­å…ƒç´ ä¸ªæ•°åªéœ€è¦ç›¸å‡å°±å¥½äº†\n    if t-h &lt; uint32(len(_p_.runq)) {\n        _p_.runq[t%uint32(len(_p_.runq))].set(gp)//è®¡ç®—æ”¾å…¥çš„ä½ç½®:ç¯å½¢é˜Ÿåˆ—éœ€è¦å¯¹é•¿åº¦å–æ¨¡,å¹¶æ”¾å…¥æ•°æ®\n        atomic.StoreRel(&amp;_p_.runqtail, t+1) //æ›´æ–°å°¾æŒ‡é’ˆå¹¶è§£é”,StoreRelå«åšé‡Šæ”¾å†™\n        return\n    }\n    //é˜Ÿåˆ—æ»¡äº†å°±æ‰§è¡ŒrunqputslowæŠŠä¸€åŠgæ”¾åˆ°å…¨å±€é˜Ÿåˆ—\n    if runqputslow(_p_, gp, h, t) {\n        return\n    }\n    // å¦‚æœslowè¿‡ç¨‹å¤±è´¥äº†,æ¯”å¦‚è¢«åˆ«äººå·äº†å¯¼è‡´ head å˜äº†,å°±retryé‡è¯•\n    goto retry\nåŸå­æ“ä½œ:\nå¯¹äºpçš„æœ¬åœ°é˜Ÿåˆ—æ¥è¯´,ç”Ÿäº§è€…åªæœ‰ä¸€ä¸ªå°±æ˜¯pè‡ªå·±,åªæœ‰pèƒ½å¾€è‡ªå·±çš„æœ¬åœ°é˜Ÿåˆ—é‡Œé¢åŠ ä¸œè¥¿.è€Œæ¶ˆè´¹è€…åŒ…æ‹¬pè‡ªå·±ä»æœ¬åœ°é˜Ÿåˆ—æ‹¿gå»æ‰§è¡Œ,ä¹ŸåŒ…æ‹¬å…¶ä»–pé€šè¿‡work stealingæœºåˆ¶æ¥å·å–p.\n\nå› ä¸ºå·å–éƒ½æ˜¯ä»é˜Ÿå¤´å·å–,æ”¾ä¸œè¥¿ä»é˜Ÿå°¾æ”¾.å› æ­¤é˜Ÿå¤´æŒ‡é’ˆéœ€è¦ç”¨åŸå­æ“ä½œ,ä¸ºäº†è·å–åˆ°ç¡®å®šæ˜¯æœ€æ–°çš„head.\nå› ä¸ºæ˜¯å…ˆå†™å…¥æ•°æ®,åç§»åŠ¨å°¾æŒ‡é’ˆ.ç§»åŠ¨å°¾æŒ‡é’ˆä¹‹å‰,è¿™å—æ•°æ®å¯¹å…¶ä»–äººæ¥è¯´å¹¶ä¸å¯è§,å› æ­¤ä¹Ÿä¸ç”¨æ‹…å¿ƒç«äº‰,æ‰€ä»¥ä¸ç”¨åŸå­å†™å…¥æ“ä½œ.è€Œç§»åŠ¨å°¾æŒ‡é’ˆéœ€è¦æ˜¯åŸå­æ“ä½œStoreRel,è¿™ä¸ªå‡½æ•°å¯ä»¥ç¡®ä¿å¿…é¡»è¦å…ˆå†™å…¥æ•°æ®,å†æ›´æ–°å°¾æŒ‡é’ˆ,é˜²æ­¢cpuè¿›è¡ŒæŒ‡ä»¤é‡æ’.\nLoadAcq:ç¡®ä¿è·å–åˆ°æœ€æ–°çš„\nStoreRel:ç¡®ä¿å‰é¢çš„ä¿®æ”¹å·²å®Œæˆå¹¶å†™å…¥å†…å­˜\nCasRel:ä¼šæ£€æŸ¥å½“å‰å€¼æ˜¯å¦è¿˜æ˜¯åˆšæ‰è¯»åˆ°çš„å€¼\n\n\n\n                  \n                  Title \n                  \n                \n\næœ¬åœ°é˜Ÿåˆ—é‡‡ç”¨äº†å•ç”Ÿäº§è€…-å¤šæ¶ˆè´¹è€…çš„æ— é”ç¯å½¢é˜Ÿåˆ—è®¾è®¡.\nä¸ºäº†æ€§èƒ½,åˆ©ç”¨äº†åŸå­æ“ä½œçš„å†…å­˜å±éšœè¯­ä¹‰æ¥æ›¿ä»£äº’æ–¥é”\n\nç§»åŠ¨tailæŒ‡é’ˆ,ä½¿ç”¨store-releaseè¯­ä¹‰.\nè¯»å–headæŒ‡é’ˆ,ä½¿ç”¨load-acquireè¯­ä¹‰.\n\n\n\n\n\n                  \n                  äº’æ–¥é”ä¸åŸå­æ“ä½œ \n                  \n                \n\nå…¨å±€é˜Ÿåˆ—é‡‡ç”¨äº’æ–¥é”,å› ä¸ºé€»è¾‘å¤ªå¤æ‚,åŸå­æ“ä½œæä¸å®š.è€Œä¸”å¹³æ‘Šæˆæœ¬,è™½ç„¶é”æ¯”è¾ƒæ…¢,ä½†æ˜¯è¦æ“ä½œå…¨å±€é˜Ÿåˆ—çš„æƒ…å†µä¹Ÿæ¯”è¾ƒå°‘.\næœ¬åœ°é˜Ÿåˆ—ä¸€èˆ¬ç”¨åŸå­æ“ä½œ,ä¸»è¦æ˜¯é”å¤ªæ…¢äº†,è€Œè®¿é—®æœ¬åœ°é˜Ÿåˆ—å¾ˆé¢‘ç¹,ç”±äºçªƒå–åŠ¨ä½œå‘ç”Ÿçš„é¢‘ç‡ä¸ä¼šå¤ªé«˜ï¼Œå› æ­¤å½“å‰ p æ‹¿åˆ°æ•°æ®çš„æˆåŠŸç‡æ˜¯å¾ˆé«˜çš„ï¼Œå› æ­¤å¯ä»¥è¯´p çš„æœ¬åœ°é˜Ÿåˆ—æ˜¯æ¥è¿‘äºæ— é”åŒ–ï¼Œä½†æ²¡æœ‰è¾¾åˆ°çœŸæ­£æ„ä¹‰çš„æ— é”.\n\n\nå€˜è‹¥å‘ç°æœ¬åœ°é˜Ÿåˆ— runq å·²ç»æ»¡äº†ï¼Œåˆ™ä¼šè¿”å›æ¥å°†æœ¬åœ°é˜Ÿåˆ—ä¸­ä¸€åŠçš„ g æ”¾å›å…¨å±€é˜Ÿåˆ—ä¸­ï¼Œå¸®åŠ©å½“å‰ p ç¼“è§£æ‰§è¡Œå‹åŠ›.\nfunc runqputslow(_p_ *p, gp *g, h, t uint32) bool {\n    var batch [len(_p_.runq)/2 + 1]*g //å¤§å°æ˜¯é˜Ÿåˆ—å®¹é‡çš„ä¸€åŠ+æ–°æ¥çš„é‚£ä¸ª\n    n := t - h\n    n = n / 2\n    \n    // ...\n    //ä»é˜Ÿå¤´å¼€å§‹å¤åˆ¶åˆ°å…¨å±€é˜Ÿåˆ—\n    for i := uint32(0); i &lt; n; i++ {\n        batch[i] = _p_.runq[(h+i)%uint32(len(_p_.runq))].ptr()\n    }\n    if !atomic.CasRel(&amp;_p_.runqhead, h, h+n) { // cas-release, commits consume\n        return false\n    }//æ›´æ–°é˜Ÿå¤´æŒ‡é’ˆ\n    \n    batch[n] = gp//æŠŠæ–°æ¥çš„è¿™ä¸ªæ”¾åˆ°æœ€å\n \n \n    // Link the goroutines.æœ¬åœ°é˜Ÿåˆ—æ˜¯æ•°ç»„ç»“æ„,å…¨å±€é˜Ÿåˆ—æ˜¯é“¾è¡¨ç»“æ„,å› æ­¤éœ€è¦è½¬æ¢æˆé“¾è¡¨\n    for i := uint32(0); i &lt; n; i++ {\n        batch[i].schedlink.set(batch[i+1])\n    }\n    //ç»„è£…æˆä¸€ä¸ªä¸´æ—¶çš„é˜Ÿåˆ—å¯¹è±¡q\n    var q gQueue\n    q.head.set(batch[0])\n    q.tail.set(batch[n])\n \n \n    // Now put the batch on global queue.\n    //æ“ä½œå…¨å±€é˜Ÿåˆ—,å¿…é¡»åŠ é”\n    lock(&amp;sched.lock)\n    globrunqputbatch(&amp;q, int32(n+1))\n    unlock(&amp;sched.lock)\n    return true\nä¸ºä»€ä¹ˆä»é˜Ÿå¤´å¼€å§‹æ¬:\n\nç­‰äº†å¾ˆä¹…äº†,å¦‚æœæ˜¯é˜»å¡çš„è¯å¯èƒ½è¿˜è¦æ¥ç€ç­‰,ä¸å¦‚æ”¾åˆ°å…¨å±€è®©å…¶ä»–çš„pæ¥èµ°.\né˜Ÿå°¾çš„gå¾ˆå¯èƒ½è·Ÿå½“å‰çš„gæœ‰äº²ç¼˜å…³ç³»\n\n2. ä»æœ¬åœ°é˜Ÿåˆ—è·å–\nå°è¯•ä» p æœ¬åœ°é˜Ÿåˆ—ä¸­è·å–ä¸€ä¸ªå¯æ‰§è¡Œçš„ goroutine\n if gp, inheritTime := runqget(_p_); gp != nil {\n        return gp, inheritTime, false\n    }\n    \nfunc runqget(_p_ *p) (gp *g, inheritTime bool) {\n//è¿™æ˜¯é‚£ä¸ªvipé€šé“\n    if next != 0 &amp;&amp; _p_.runnext.cas(next, 0) {\n        return next.ptr(), true\n    }//è¿™é‡Œçš„trueæŒ‡çš„æ˜¯æ˜¯å¦ç»§æ‰¿æ—§çš„gçš„æ—¶é—´ç‰‡.å› ä¸ºä¸€èˆ¬vipé€šé“çš„gå’Œæ—§gæœ‰äº²ç¼˜å…³ç³»,ä¸ºäº†é¿å…æ— é™ç»§æ‰¿æ‰€ä»¥å…±ç”¨åŒä¸€ä¸ªæ—¶é—´ç‰‡.\n \n//åˆ°256æ ¼å­ç¯å½¢é˜Ÿåˆ—é‡Œé¢æ‹¿\n    for {\n        h := atomic.LoadAcq(&amp;_p_.runqhead) // load-acquire, synchronize with other consumers\n        t := _p_.runqtail\n        //æœ¬åœ°é˜Ÿåˆ—ä¸ºç©º\n        if t == h {\n            return nil, false\n        }\n        //ä¸ä¸ºç©º,è·å–é˜Ÿé¦–çš„gè§£é”å¹¶è¿”å›.\n        gp := _p_.runq[h%uint32(len(_p_.runq))].ptr()\n        if atomic.CasRel(&amp;_p_.runqhead, h, h+1) { // cas-release, commits consume\n            return gp, false\n        }\n    }\n3. ä»å…¨å±€é˜Ÿåˆ—è·å–\nå€˜è‹¥æœ¬åœ°é˜Ÿåˆ—æ²¡æœ‰å¯æ‰§è¡Œçš„g,ä¼šä»å…¨å±€é˜Ÿåˆ—ä¸­è·å–\n   if sched.runqsize != 0 {\n        lock(&amp;sched.lock)\n        gp := globrunqget(_p_, 0)//è¿™é‡Œçš„0å°±æ˜¯æ— é™åˆ¶\n        unlock(&amp;sched.lock)\n        if gp != nil {\n            return gp, false, false\n        }\n    }\n4. è·å–å‡†å¤‡å°±ç»ªçš„ç½‘ç»œåç¨‹\nå€˜è‹¥æœ¬åœ°é˜Ÿåˆ—å’Œå…¨å±€é˜Ÿåˆ—éƒ½æ²¡æœ‰g,åˆ™ä¼šè·å–å‡†å¤‡å°±ç»ªçš„ç½‘ç»œåç¨‹[å› ä¸ºå‘èµ·ç½‘ç»œ I/O è¯·æ±‚ï¼ˆæ¯”å¦‚è¯»å†™ TCP/UDP è¿æ¥ï¼‰è€Œè¢«é˜»å¡ã€æš‚æ—¶æŒ‚èµ·çš„æ™®é€š Goroutine]\nif netpollinited() &amp;&amp; atomic.Load(&amp;netpollWaiters) &gt; 0 &amp;&amp; atomic.Load64(&amp;sched.lastpoll) != 0 {\n        if list := netpoll(0); !list.empty() { // non-blocking\n            gp := list.pop()//å‡†å¤‡è‡ªå·±è·‘\n            injectglist(&amp;list)//å…¶ä»–å·²ç»å‡†å¤‡å°±ç»ªçš„ç½‘ç»œåç¨‹æ”¾åˆ°å…¨å±€é˜Ÿåˆ—\n            casgstatus(gp, _Gwaiting, _Grunnable)//æ”¹è‡ªå·±è¦è·‘çš„è¿™ä¸ªgçš„çŠ¶æ€\n            return gp, false, false\n        }\n  }\n5.work-stealingå·å–æœºåˆ¶\nä»å…¶ä»– p ä¸­å·å– g. æœ‰æ—¶å€™ä¹Ÿä¼šå·å…¨å±€é˜Ÿåˆ—å’Œç½‘ç»œåç¨‹\næˆ˜ç•¥éƒ¨åˆ†:\nfunc stealWork(now int64) (gp *g, inheritTime bool, rnow, pollUntil int64, newWork bool) {\n    pp := getg().m.p.ptr()\n    ranTimer := false\n \n    const stealTries = 4  //è‡³å¤šéå†æ‰€æœ‰på››æ¬¡\n    for i := 0; i &lt; stealTries; i++ {\n        stealTimersOrRunNextG :=  i == stealTries-1 \n        //çœ‹iæ˜¯ä¸æ˜¯=3,å¦‚æœæ˜¯æœ€åä¸€æ¬¡éå†çš„è¯æ‰å…è®¸å·vip g(runnext)\n\t\t\n\t\t//stealOrder éšæœºæ‰¾ä¸€ä¸ªpé˜Ÿåˆ—å¼€å§‹éå†,é¿å…å¤šä¸ªpå»å·åŒä¸€ä¸ªpçš„é˜Ÿåˆ—\n        for enum := stealOrder.start(fastrand()); !enum.done(); enum.next() {\n            // ...åœ¨è¿™é‡Œè°ƒç”¨runqgrab\n        }\n    }\n \n    return nil, false, now, pollUntil, ranTime\nfunc runqgrab(_p_ *p, batch *[256]guintptr, batchHead uint32, stealRunNextG bool) uint32 {\n    for {\n        h := atomic.LoadAcq(&amp;_p_.runqhead) // load-acquire, synchronize with other consumers\n        t := atomic.LoadAcq(&amp;_p_.runqtail) // load-acquire, synchronize with the producer è¿™é‡Œå°±éœ€è¦åŸå­è¯»äº†\n        \n        //å·ä¸€åŠ\n        n := t - h\n        n = n - n/2\n        if n == 0 {\n\t        //æ²¡æœ‰èƒ½å·çš„,é‚£å°±çœ‹çœ‹æ˜¯ä¸æ˜¯èƒ½å·vip gçš„è½®æ¬¡(æœ€åä¸€æ¬¡éå†æ‰è¢«å…è®¸)\n            if stealRunNextG {\n                // Try to steal from _p_.runnext.\n                if next := _p_.runnext; next != 0 {\n                //å¦‚æœå—å®³è€…pæ­£åœ¨è¿è¡Œ,é‚£æˆ‘å°±ç­‰ä¸€ç­‰é¿å…æ¿€çƒˆç«äº‰\n                    if _p_.status == _Prunning {\n                        \n                        if GOOS != &quot;windows&quot; &amp;&amp; GOOS != &quot;openbsd&quot; &amp;&amp; GOOS != &quot;netbsd&quot; {\n                            usleep(3)\n                        } else {\n                            osyield()\n                        }\n                    }\n                    //å·å–\n                    if !_p_.runnext.cas(next, 0) {\n                        continue\n                    }\n                    batch[batchHead%uint32(len(batch))] = next\n                    return 1\n                }\n            }\n            return 0\n        }\n        \n        \n        //å¦‚æœæ™®é€šé˜Ÿåˆ—æœ‰g,é‚£å°±å…ˆå·æ™®é€šé˜Ÿåˆ—çš„\n        //ä¸€è‡´æ€§æ£€æŸ¥\n        if n &gt; uint32(len(_p_.runq)/2) { // read inconsistent h and t\n            continue\n        }\n        //æ¬è¿ä¸€åŠå¤åˆ¶åˆ°è‡ªå·±çš„batchæ•°ç»„é‡Œ\n        for i := uint32(0); i &lt; n; i++ {\n            g := _p_.runq[(h+i)%uint32(len(_p_.runq))]\n            batch[(batchHead+i)%uint32(len(batch))] = g\n        }\n        \n        //ä¿®æ”¹å—å®³è€…çš„é˜Ÿåˆ—å¤´\n        if atomic.CasRel(&amp;_p_.runqhead, h, h+n) { // cas-release, commits consume\n            return n//è¿”å›å®é™…å·å–çš„æ•°é‡\n        }\n    }\n}\nexecute\nå½“ g0 ä¸º m å¯»æ‰¾åˆ°å¯æ‰§è¡Œçš„ g ä¹‹å. æ¥ä¸‹æ¥å°±å¼€å§‹æ‰§è¡Œ g\nfunc execute(gp *g, inheritTime bool) {\n    _g_ := getg() //ç°åœ¨åº”è¯¥æ˜¯g0\n \n\t//ç»‘å®š\n    _g_.m.curg = gp //m ç°åœ¨è·‘çš„æ˜¯åˆšæ‰è·å–çš„g\n    gp.m = _g_.m  //åˆšæ‰è·å–çš„gçš„mä¹Ÿè®¾ç½®ä¸ºå½“å‰m\n    \n    casgstatus(gp, _Grunnable, _Grunning)//ä¿®æ”¹çŠ¶æ€,æŠŠrunnable,çœŸæ­£çš„æ”¹ä¸ºrunning\n    //æ¸…ç†ä¸å‡†å¤‡ ç­‰å¾…è®¡æ—¶å™¨ä¸º0\n    gp.waitsince = 0\n    gp.preempt = false  //æ¸…é™¤å¼ºå æ ‡è®°\n    gp.stackguard0 = gp.stack.lo + _StackGuard  //æ ˆæº¢å‡ºæ£€æµ‹çº¿\n    if !inheritTime {\n        _g_.m.p.ptr().schedtick++ //è°ƒåº¦è®¡æ•°å™¨åŠ ä¸€\n    }\n \n \n    gogo(&amp;gp.sched)\ngosched_m\ngæ‰§è¡Œä¸»åŠ¨è®©æ¸¡æ—¶,ä¼šè°ƒç”¨mcallæ–¹æ³•å°†æ‰§è¡Œæƒå½’è¿˜ç»™g0,å¹¶ç”±g0è°ƒç”¨gosched_mæ–¹æ³•\nmcallæ–¹æ³•:å°†å½“å‰ç”¨æˆ·gçš„pcå’Œspä¿å­˜åˆ°g.schedé‡Œé¢,ç„¶åä»ç”¨æˆ·æ ˆåˆ‡æ¢åˆ°ç³»ç»Ÿæ ˆ,åœ¨g0æ ˆä¸Šæ‰§è¡Œgosched_må‡½æ•°.\nfunc Gosched() {\n    // ...\n    mcall(gosched_m)\n}\n \nfunc gosched_m(gp *g) {\n    goschedImpl(gp)\n}\n \nfunc goschedImpl(gp *g) {\n    status := readgstatus(gp)\n    if status&amp;^_Gscan != _Grunning {\n        dumpgstatus(gp)\n        throw(&quot;bad g status&quot;)\n    }\n    casgstatus(gp, _Grunning, _Grunnable)//åˆ‡æ¢çŠ¶æ€.å°±ç»ªçŠ¶æ€:éšæ—¶å¯ä»¥è·‘,ä½†æ˜¯ä¸æƒ³ç°åœ¨è·‘.\n    dropg()//è§£é™¤ç»‘å®š\n    lock(&amp;sched.lock)\n    globrunqput(gp)//æ‰”è¿›å…¨å±€é˜Ÿåˆ—,è®©å‡ºå½“å‰cpuç»™åˆ«äºº\n    unlock(&amp;sched.lock)\n \n \n    schedule()//é‡æ–°è¿›è¡Œè°ƒåº¦\n    \nfunc dropg() {\n    _g_ := getg()\n \n \n    setMNoWB(&amp;_g_.m.curg.m, nil)\n    setGNoWB(&amp;_g_.m.curg, nil)\n}\npark_m ä¸ ready\ng éœ€è¦è¢«åŠ¨è°ƒåº¦æ—¶ï¼Œä¼šè°ƒç”¨ mcall æ–¹æ³•åˆ‡æ¢è‡³ g0ï¼Œå¹¶è°ƒç”¨ park_m æ–¹æ³•å°† g ç½®ä¸ºé˜»å¡æ€\nfunc gopark(unlockf func(*g, unsafe.Pointer) bool, lock unsafe.Pointer, reason waitReason, traceEv byte, traceskip int) {\n    // ...\n    mcall(park_m)\n}\n \nfunc park_m(gp *g) {\n    _g_ := getg()\n \n    casgstatus(gp, _Grunning, _Gwaiting)\n    dropg()\n \n    // ...\n    schedule()\nå½“å› è¢«åŠ¨è°ƒåº¦é™·å…¥é˜»å¡æ€çš„ g éœ€è¦è¢«å”¤é†’æ—¶ï¼Œä¼šç”±å…¶ä»–åç¨‹æ‰§è¡Œ goready æ–¹æ³•å°† g é‡æ–°ç½®ä¸ºå¯æ‰§è¡Œçš„çŠ¶æ€. ç„¶åä¼šå°†å…¶æ·»åŠ åˆ°å”¤é†’è€…çš„ p çš„æœ¬åœ°é˜Ÿåˆ—ä¸­ï¼š\nfunc goready(gp *g, traceskip int) {\n    systemstack(func() {\n        ready(gp, traceskip, true)\n    })\n}\n \nfunc ready(gp *g, traceskip int, next bool) {\n    // ...\n    _g_ := getg()\n    // ...\n    casgstatus(gp, _Gwaiting, _Grunnable)\n    runqput(_g_.m.p.ptr(), gp, next)//è°ƒç”¨ runqput å°†å½“å‰ g æ·»åŠ åˆ°å”¤é†’è€… p çš„æœ¬åœ°é˜Ÿåˆ—ä¸­ï¼Œå¦‚æœé˜Ÿåˆ—æ»¡äº†ï¼Œä¼šè¿å¸¦ g ä¸€èµ·å°†ä¸€åŠçš„å…ƒç´ è½¬ç§»åˆ°å…¨å±€é˜Ÿåˆ—.(runqputå†…éƒ¨é€»è¾‘)\n    // ...\n}\ngoexit0\nå½“ g æ‰§è¡Œå®Œæˆæ—¶ï¼Œä¼šå…ˆæ‰§è¡Œ mcall æ–¹æ³•åˆ‡æ¢è‡³ g0ï¼Œç„¶åè°ƒç”¨ goexit0 æ–¹æ³•\n// Finishes execution of the current goroutine.\nfunc goexit1() {\n    // ...\n    mcall(goexit0)\n} \n \n//g0è°ƒç”¨è¿™ä¸ªå‡½æ•°,gæ˜¯å°†æ­»çš„é‚£ä¸ªåç¨‹\nfunc goexit0(gp *g) {\n    _g_ := getg()//è¿™é‡Œè·å–äº†g0\n    _p_ := _g_.m.p.ptr()\n \n    casgstatus(gp, _Grunning, _Gdead)//gçŠ¶æ€ç½®ä¸ºdead\n    // ...\n    gp.m = nil//æ¸…ç†gpçš„çŠ¶æ€\n    // ...\n \n    dropg()//å®é™…ä¸Šæ˜¯æ¸…ç†mçš„çŠ¶æ€\n \n    // ...\n    schedule()\nretakeå¤ºå›\næŠ¢å è°ƒåº¦çš„æ‰§è¡Œè€…ä¸æ˜¯ g0ï¼Œè€Œæ˜¯ä¸€ä¸ªå…¨å±€çš„ monitor g.è¿™ä¸ªgä¼šè½®è¯¢æ‰€æœ‰çš„p,çœ‹å“ªä¸ªpå¯¹åº”çš„mé™·åœ¨ç³»ç»Ÿè°ƒç”¨é‡Œé¢å¤ªä¹…äº†,å°±æŠŠè¿™ä¸ªpæŠ¢è¿‡æ¥åˆ†ç»™åˆ«çš„mç”¨.\nfunc retake(now int64) uint32 {\n    n := 0\n    \n    lock(&amp;allpLock)//åŠ é”\n    //éå†å…¨å±€pé˜Ÿåˆ—,å¯»æ‰¾éœ€è¦è¢«å¼ºå çš„ç›®æ ‡\n    for i := 0; i &lt; len(allp); i++ {\n        _p_ := allp[i]\n        if _p_ == nil {\n            // This can happen if procresize has grown\n            // allp but not yet created new Ps.\n            continue\n        }\n        pd := &amp;_p_.sysmontick\n        // ...\n        //å½“å‰å¤„åœ¨ç³»ç»Ÿè°ƒç”¨çŠ¶æ€çš„p\n        if s == _Psyscall {            \n            // ...\n            //ä»¥ä¸‹ä¸‰ç§æƒ…å†µä¼šcontinue(ä¸æŠ¢å )\n            //æœ¬åœ°é˜Ÿåˆ—ä¸ºç©º,é‚£mé˜»å¡ä¹Ÿæ²¡äº‹\n            //ç³»ç»Ÿé‡Œè¿˜æœ‰åˆ«çš„ç©ºé—²pé‚£æ²¡å¿…è¦éå¾—æŠ¢è¿™ä¸ª\n            //è¿›å…¥ç³»ç»Ÿè°ƒç”¨çš„æ—¶é—´æ¯”è¾ƒçŸ­(å°äº10ms)\n            if runqempty(_p_) &amp;&amp; atomic.Load(&amp;sched.nmspinning)+atomic.Load(&amp;sched.npidle) &gt; 0 &amp;&amp; pd.syscallwhen+10*1000*1000 &gt; now {\n                continue\n            }\n            unlock(&amp;allpLock)\n            \n            //åŠ¨æ‰‹æŠ¢,æŠŠpè®¾ç½®ä¸ºé—²ç½®,å¦‚æœcsæˆåŠŸå°±å½»åº•è§£é™¤ç»‘å®šäº†\n            if atomic.Cas(&amp;_p_.status, s, _Pidle) {\n                n++\n                _p_.syscalltick++//è®°å½•ä¸€ä¸‹pçš„çŠ¶æ€å˜åŒ–\n                handoffp(_p_)//æŠŠè¿™ä¸ªpåˆ†é…ç»™åˆ«äºº!\n            }\n            incidlelocked(1)\n            lock(&amp;allpLock)\n        }\n    }\n    unlock(&amp;allpLock)\n    return uint32(n)\n}\néœ€è¦ä¸ºpè·å–æ–°çš„mçš„æƒ…å†µå¦‚ä¸‹: ä¸æ»¡è¶³åˆ™æŠŠpä¸¢è¿›ç©ºé—²é˜Ÿåˆ—.\nfunc handoffp(_p_ *p) {\n//å¦‚æœpçš„æœ¬åœ°é˜Ÿåˆ—é‡Œé¢è¿˜æœ‰å¾…æ‰§è¡Œçš„gæˆ–è€…å…¨å±€åˆ—è¡¨é‡Œé¢æœ‰g,åˆ™éœ€è¦æ‰¾ä¸€ä¸ªmæ¥æ‰§è¡Œ.\n    if !runqempty(_p_) || sched.runqsize != 0 {\n        startm(_p_, false)\n        return\n    }\n \n//goå¸Œæœ›æœ‰ä¸€å®šçš„må¤„äºspinningè‡ªæ—‹çŠ¶æ€,å°±æ˜¯è®©ä»–ç©ºè½¬,è€Œä¸æ˜¯ç›´æ¥æ²‰ç¡ç­‰å¾…åˆ«äººå”¤é†’.å¦‚æœæ²¡æœ‰è‡ªæ—‹çš„mä¹Ÿæ²¡æœ‰ç©ºé—²çš„p,è¯´æ˜å¤§å®¶éƒ½å¾ˆå¿™,å°±å¯åŠ¨ä¸€ä¸ªm\nå»ç»‘å®šè¿™ä¸ªp,ä½†æ˜¯ä¸ä¸€å®šä¸ºäº†è·‘å…·ä½“çš„g,åªæ˜¯ä¸ºäº†ç»´æŒè‡ªæ—‹.\n    if atomic.Load(&amp;sched.nmspinning)+atomic.Load(&amp;sched.npidle) == 0 &amp;&amp; atomic.Cas(&amp;sched.nmspinning, 0, 1) {\n        startm(_p_, true)\n        return\n    }\n    \n    lock(&amp;sched.lock)\n    // ...\n    if sched.runqsize != 0 {\n        unlock(&amp;sched.lock)\n        startm(_p_, false)\n        return\n    }\n    // If this is the last running P and nobody is polling network,\n    // need to wakeup another M to poll network.\n    //å¦‚æœè¿™æ˜¯æœ€åä¸€ä¸ªæ­£åœ¨è·‘çš„p,å¦‚æœç¡äº†é‚£å°±æ²¡äººå»é—®ç½‘ç»œåç¨‹äº†,æ‰€ä»¥ç»™è¿™ä¸ªpé…ä¸ªmå»è·‘ç½‘ç»œè½®è¯¢.\n    if sched.npidle == uint32(gomaxprocs-1) &amp;&amp; atomic.Load64(&amp;sched.lastpoll) != 0 {\n        unlock(&amp;sched.lock)\n        startm(_p_, false)\n        return\n    }\n \n//å¦‚æœçœŸçš„å•¥éƒ½æ²¡å¾—å¹²,æ—§ä¸¢è¿›ç©ºé—²åˆ—è¡¨.\n    // ...\nè·å–mæ—¶ä¼šå°è¯•è·å–å·²æœ‰çš„ç©ºé—²m,å¦åˆ™åˆ›å»ºæ–°çš„m\nfunc startm(_p_ *p, spinning bool) {\n    \n    mp := acquirem()\n    lock(&amp;sched.lock)\n    // ...\n    \n    nmp := mget()\n    if nmp == nil {\n        id := mReserveID()\n        unlock(&amp;sched.lock)\n \n \n        var fn func()\n        // ...\n        newm(fn, _p_, id)\n        // ...\n        return\n    }\n    unlock(&amp;sched.lock)\n    // ...\n}\nreentersyscall å’Œ exitsyscall\nå‘ç”Ÿç³»ç»Ÿè°ƒç”¨å‰ï¼Œä¸ g ç»‘å®šçš„åŸ m å½“ä¸­.åœ¨ m éœ€è¦æ‰§è¡Œç³»ç»Ÿè°ƒç”¨å‰,ä¼šå…ˆæ‰§è¡Œä¸‹è¿°æ–¹æ³•.[Mï¼ˆçº¿ç¨‹ï¼‰å¸¦ç€ Gï¼ˆåç¨‹ï¼‰å»å†…æ ¸åŠäº‹ï¼ˆSyscallï¼‰ä¹‹å‰æ€ä¹ˆè¯·å‡ï¼ŒåŠå®Œå›æ¥æ€ä¹ˆé”€å‡]\nfunc reentersyscall(pc, sp uintptr) {\n    _g_ := getg()//å½“å‰åœ¨è·‘çš„g\n \n \n    // ...\n    //ä¿å­˜è¿›åº¦\n    save(pc, sp)\n    _g_.syscallsp = sp\n    _g_.syscallpc = pc\n    casgstatus(_g_, _Grunning, _Gsyscall)//å˜æ›´çŠ¶æ€\n    // ...\n \n\t//è…¾å‡ºå·¥ä½:æ‰¾åˆ°æˆ‘çš„p,è§£é™¤ç»‘å®š:pè§£é™¤m\n    pp := _g_.m.p.ptr()\n    pp.m = 0\n    _g_.m.oldp.set(pp)//mè®°ä½æ—§çš„p,åç»­ m æ¢å¤åï¼Œä¼šä¼˜å…ˆå¯»æ‰¾æ—§çš„ p é‡æ–°å»ºç«‹ç»‘å®šå…³ç³».\n    _g_.m.p = 0//è§£é™¤å¯¹pçš„ç»‘å®š,å¸¦ç€gå»å†…æ ¸æµæµªäº†\n    atomic.Store(&amp;pp.status, _Psyscall)//ç»™påŠ ä¸€ä¸ªçŠ¶æ€ è¯´må»ç³»ç»Ÿè°ƒç”¨äº†\n    // ...\nfunc exitsyscall() {\n    _g_ := getg()//æ™®é€šg\n    \n    // ...å°è¯•å’Œæ—§çš„pè¿›è¡Œç»‘å®š\n    if exitsyscallfast(oldp) {\n        // ...\n        casgstatus(_g_, _Gsyscall, _Grunning)\n        // ...\n        return\n    }\n \n \n    // ...//å’Œæ—§çš„pç»‘å®šå¤±è´¥,åˆ™ç”¨mcallæ–¹æ³•åˆ‡æ¢åˆ°mçš„g0 æ‰§è¡Œexitsyscall0æ–¹æ³•\n    mcall(exitsyscall0)\n    // ...\n}\n \n \nfunc exitsyscall0(gp *g) {\n    casgstatus(gp, _Gsyscall, _Grunnable)//åˆ‡æ¢ä¸ºå¯æ‰§è¡ŒçŠ¶æ€\n    dropg()//mè§£ç»‘g,å› ä¸ºè¿™é‡Œæ˜¯må»æ‰¾p å¦‚æœæ‰¾åˆ°äº†æ‰è¿è¡Œg,å¦‚æœæ‰¾ä¸åˆ°çš„è¯,mæ˜¯ä¼šä¼‘æ¯çš„,æ‰€ä»¥è¦æå‰è§£ç»‘.\n    \n    //ä»å…¨å±€pé˜Ÿåˆ—è·å–å¯ç”¨çš„p\n    lock(&amp;sched.lock)\n    var _p_ *p\n    if schedEnabled(gp) {\n        _p_, _ = pidleget(0)\n    }\n    \n    //æ²¡æœ‰på¯ä»¥ç”¨,å°±æŠŠgæ·»åŠ åˆ°å…¨å±€é˜Ÿåˆ—\n    var locked bool\n    if _p_ == nil {\n        globrunqput(gp)\n    } \n    \n    //å¦‚æœè·å–åˆ°på°±æ‰§è¡Œg\n    unlock(&amp;sched.lock)\n    if _p_ != nil {\n        acquirep(_p_)\n        execute(gp, false) // ä¸è¿”å›...ä¸€æ—¦æ‰§è¡Œï¼Œç¨‹åºè®¡æ•°å™¨ï¼ˆPCï¼‰å°±è¢«æ”¹å†™äº†ï¼ŒCPU ç›´æ¥å»è·‘åˆ«çš„æŒ‡ä»¤äº†ï¼Œä¹‹å‰çš„å‡½æ•°æ ˆå¸§å¯¹å®ƒæ¥è¯´å·²ç»æ˜¯â€œè¿‡å»å¼â€äº†ã€‚\n    }\n    \n    // ...\n    //åœ¨æ²¡æ‰¾åˆ°pçš„åˆ†æ”¯çš„æœ«å°¾.mé™·å…¥æ²‰ç¡\n    stopm()\n    schedule() // Never returns.\n}\nå…³äºé˜»å¡\n\n\nç”±äºåŸå­ã€äº’æ–¥é‡æˆ–é€šé“æ“ä½œè°ƒç”¨å¯¼è‡´ Goroutine é˜»å¡ï¼Œè°ƒåº¦å™¨å°†æŠŠå½“å‰é˜»å¡çš„ Goroutine åˆ‡æ¢å‡ºå»ï¼Œé‡æ–°è°ƒåº¦ LRQ ä¸Šçš„å…¶ä»– Goroutineï¼›\n\n\nç”±äºç½‘ç»œè¯·æ±‚å’Œ IO æ“ä½œå¯¼è‡´ Goroutine é˜»å¡ã€‚Go ç¨‹åºæä¾›äº†ç½‘ç»œè½®è¯¢å™¨ï¼ˆNetPollerï¼‰æ¥å¤„ç†ç½‘ç»œè¯·æ±‚å’Œ IO æ“ä½œçš„é—®é¢˜ï¼Œå…¶åå°é€šè¿‡ kqueueï¼ˆMacOSï¼‰ï¼Œepollï¼ˆLinuxï¼‰æˆ– iocpï¼ˆWindowsï¼‰æ¥å®ç° IO å¤šè·¯å¤ç”¨ã€‚é€šè¿‡ä½¿ç”¨ NetPoller è¿›è¡Œç½‘ç»œç³»ç»Ÿè°ƒç”¨ï¼Œè°ƒåº¦å™¨å¯ä»¥é˜²æ­¢ Goroutine åœ¨è¿›è¡Œè¿™äº›ç³»ç»Ÿè°ƒç”¨æ—¶é˜»å¡ Mã€‚è¿™å¯ä»¥è®© M æ‰§è¡Œ P çš„ LRQ ä¸­å…¶ä»–çš„ Goroutinesï¼Œè€Œä¸éœ€è¦åˆ›å»ºæ–°çš„ Mã€‚æ‰§è¡Œç½‘ç»œç³»ç»Ÿè°ƒç”¨ä¸éœ€è¦é¢å¤–çš„ Mï¼Œç½‘ç»œè½®è¯¢å™¨ä½¿ç”¨ç³»ç»Ÿçº¿ç¨‹ï¼Œå®ƒæ—¶åˆ»å¤„ç†ä¸€ä¸ªæœ‰æ•ˆçš„äº‹ä»¶å¾ªç¯ï¼Œæœ‰åŠ©äºå‡å°‘æ“ä½œç³»ç»Ÿä¸Šçš„è°ƒåº¦è´Ÿè½½ã€‚ç”¨æˆ·å±‚çœ¼ä¸­çœ‹åˆ°çš„ Goroutine ä¸­çš„â€œblock socketâ€ï¼Œå®ç°äº† goroutine-per-connection ç®€å•çš„ç½‘ç»œç¼–ç¨‹æ¨¡å¼ã€‚å®é™…ä¸Šæ˜¯é€šè¿‡ Go runtime ä¸­çš„ netpoller é€šè¿‡ Non-block socket + I/O å¤šè·¯å¤ç”¨æœºåˆ¶â€œæ¨¡æ‹Ÿâ€å‡ºæ¥çš„ã€‚\n\n\nå½“è°ƒç”¨ä¸€äº›ç³»ç»Ÿæ–¹æ³•çš„æ—¶å€™ï¼ˆå¦‚æ–‡ä»¶ I/Oï¼‰ï¼Œå¦‚æœç³»ç»Ÿæ–¹æ³•è°ƒç”¨çš„æ—¶å€™å‘ç”Ÿé˜»å¡ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œç½‘ç»œè½®è¯¢å™¨ï¼ˆNetPollerï¼‰æ— æ³•ä½¿ç”¨ï¼Œè€Œè¿›è¡Œç³»ç»Ÿè°ƒç”¨çš„ G1 å°†é˜»å¡å½“å‰ M1ã€‚è°ƒåº¦å™¨å¼•å…¥ å…¶å®ƒM æ¥æœåŠ¡ M1 çš„Pã€‚\n\n\nå¦‚æœåœ¨ Goroutine å»æ‰§è¡Œä¸€ä¸ª sleep æ“ä½œï¼Œå¯¼è‡´ M è¢«é˜»å¡äº†ã€‚Go ç¨‹åºåå°æœ‰ä¸€ä¸ªç›‘æ§çº¿ç¨‹ sysmonï¼Œå®ƒç›‘æ§é‚£äº›é•¿æ—¶é—´è¿è¡Œçš„ G ä»»åŠ¡ç„¶åè®¾ç½®å¯ä»¥å¼ºå çš„æ ‡è¯†ç¬¦ï¼Œåˆ«çš„ Goroutine å°±å¯ä»¥æŠ¢å…ˆè¿›æ¥æ‰§è¡Œã€‚\n\n"},"æŠ€æœ¯ç§¯ç´¯/Golang/æ ¸å¿ƒçŸ¥è¯†/04-å†…å­˜æ¨¡å‹ä¸åˆ†é…æœºåˆ¶":{"slug":"æŠ€æœ¯ç§¯ç´¯/Golang/æ ¸å¿ƒçŸ¥è¯†/04-å†…å­˜æ¨¡å‹ä¸åˆ†é…æœºåˆ¶","filePath":"æŠ€æœ¯ç§¯ç´¯/Golang/æ ¸å¿ƒçŸ¥è¯†/04 å†…å­˜æ¨¡å‹ä¸åˆ†é…æœºåˆ¶.md","title":"04 å†…å­˜æ¨¡å‹ä¸åˆ†é…æœºåˆ¶","links":[],"tags":[],"content":"\nmcache: æ¯ä¸ªpè‡ªå·±çš„ç¼“å­˜,å„ç§è§„æ ¼çš„mspanéƒ½ç¼“å­˜ä¸€ä»½.ä¸éœ€è¦é”\nmcentral: æŸç§ç‰¹å®šè§„æ ¼çš„mspançš„é›†åˆ,å¦‚æœpè‡ªå·±çš„ç¼“å­˜ä½¿ç”¨å®Œäº†,å°±åˆ°mcentralé‡Œè·å–.éœ€è¦é”.\nmheap: å¦‚æœmcentralä¹Ÿæ²¡æœ‰äº†,å°±è¦åˆ°mheapç”³è¯·,è¿™é‡Œå¿…é¡»ä¸¥æ ¼åŠ é”,æ€§èƒ½æœ€æ…¢.ç®¡ç†çš„æ˜¯å †å’Œé¡µ,è€Œä¸æ˜¯mspan.\nå¦‚æœmheapä¹Ÿæ²¡æœ‰äº†,å°±å¾—å‘æ“ä½œç³»ç»Ÿç”³è¯·è™šæ‹Ÿå†…å­˜\n\nå†…å­˜æ¨¡å‹\nå›é¡¾æ“ä½œç³»ç»Ÿ\n\næ“ä½œç³»ç»Ÿä¸­ç»å…¸çš„å¤šçº§å­˜å‚¨æ¨¡å‹è®¾è®¡.\n\nå¤šçº§æ¨¡å‹:æ ¹æ®è¯»å–é€Ÿåº¦\\ç©ºé—´å¤§å°\\ä»·æ ¼çš„ä¸åŒ\n\nå¯„å­˜å™¨\né«˜é€Ÿç¼“å­˜\nå†…å­˜\nç£ç›˜\n\n\nåŠ¨æ€åˆ‡æ¢\n\n\nè™šæ‹Ÿå†…å­˜ä¸ç‰©ç†å†…å­˜:\n\nåœ¨ç”¨æˆ·ä¸ç¡¬ä»¶é—´æ·»åŠ ä¸­é—´ä»£ç†å±‚ï¼ˆæ²¡æœ‰ä»€ä¹ˆæ˜¯åŠ ä¸€ä¸ªä¸­é—´å±‚è§£å†³ä¸äº†çš„ï¼‰\nä¼˜åŒ–ç”¨æˆ·ä½“éªŒï¼ˆè¿›ç¨‹æ„ŸçŸ¥åˆ°è·å¾—çš„å†…å­˜ç©ºé—´æ˜¯â€œè¿ç»­â€çš„ï¼‰\nâ€œæ”¾å¤§â€å¯ç”¨å†…å­˜ï¼ˆè™šæ‹Ÿå†…å­˜å¯ä»¥ç”±ç‰©ç†å†…å­˜+ç£ç›˜è¡¥è¶³ï¼Œå¹¶æ ¹æ®å†·çƒ­åŠ¨æ€ç½®æ¢ï¼Œç”¨æˆ·æ— æ„ŸçŸ¥ï¼‰\n\n\nåˆ†é¡µç®¡ç†:\n\næ“ä½œç³»ç»Ÿä¸­é€šå¸¸ä¼šå°†è™šæ‹Ÿå†…å­˜å’Œç‰©ç†å†…å­˜åˆ‡å‰²æˆå›ºå®šçš„å°ºå¯¸ï¼Œäºè™šæ‹Ÿå†…å­˜è€Œè¨€å«ä½œâ€œé¡µâ€ï¼Œäºç‰©ç†å†…å­˜è€Œè¨€å«ä½œâ€œå¸§â€ï¼ŒåŸå› åŠè¦ç‚¹å¦‚ä¸‹ï¼š\n\næé«˜å†…å­˜ç©ºé—´åˆ©ç”¨ï¼ˆä»¥é¡µä¸ºç²’åº¦åï¼Œæ¶ˆç­äº†ä¸ç¨³å®šçš„å¤–éƒ¨ç¢ç‰‡ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯ç›¸å¯¹å¯æ§çš„å†…éƒ¨ç¢ç‰‡ï¼‰\næé«˜å†…å¤–å­˜äº¤æ¢æ•ˆç‡ï¼ˆæ›´ç»†çš„ç²’åº¦å¸¦æ¥äº†æ›´é«˜çš„çµæ´»åº¦ï¼‰\nä¸è™šæ‹Ÿå†…å­˜æœºåˆ¶å‘¼åº”ï¼Œä¾¿äºå»ºç«‹è™šæ‹Ÿåœ°å€â†’ç‰©ç†åœ°å€çš„æ˜ å°„å…³ç³»ï¼ˆèšåˆæ˜ å°„å…³ç³»çš„æ•°æ®ç»“æ„ï¼Œç§°ä¸ºé¡µè¡¨ï¼‰\nlinux é¡µ/å¸§çš„å¤§å°å›ºå®šï¼Œä¸º 4KBï¼ˆè¿™å®é™…æ˜¯ç”±å®è·µæ¨åŠ¨çš„ç»éªŒå€¼ï¼Œå¤ªç²—ä¼šå¢åŠ ç¢ç‰‡ç‡ï¼Œå¤ªç»†ä¼šå¢åŠ åˆ†é…é¢‘ç‡å½±å“æ•ˆç‡ï¼‰\n\n\n\n\n\ngoå†…å­˜æ¨¡å‹\næ ¸å¿ƒè¦ç‚¹:\n\nç©ºé—´æ¢æ—¶é—´,ä¸€æ¬¡ç¼“å­˜,å¤šæ¬¡å¤ç”¨.\nå› ä¸ºç”³è¯·å†…å­˜çš„æ“ä½œå¾ˆé‡,é‚£ä¹ˆä¸€æ¬¡å¤šç”³è¯·ä¸€äº›.\nGolangä¸­çš„å †mheap:\n\n\nå¯¹æ“ä½œç³»ç»Ÿè€Œè¨€,è¿™æ˜¯ç”¨æˆ·è¿›ç¨‹ä¸­ç¼“å­˜çš„å†…å­˜\nå¯¹äºgoè¿›ç¨‹å†…éƒ¨,å †æ˜¯æ‰€æœ‰å¯¹è±¡çš„å†…å­˜èµ·æº\n\n\nå¤šçº§ç¼“å­˜,å®ç°æ— /ç»†é”åŒ–\nå †æ˜¯Goè¿è¡Œæ—¶æœ€å¤§çš„ä¸´ç•Œå…±äº«èµ„æº,è¿™æ„å‘³ç€æ¯æ¬¡å­˜å–éƒ½è¦åŠ é”.\nGolangåœ¨å †ä¹‹ä¸Šä¾æ¬¡ç»†åŒ–åŠ›åº¦:\n\n\nmheap:å…¨å±€å†…å­˜èµ·æº,è®¿é—®è¦åŠ å…¨å±€é”\nmcentral:æ¯ç§å¯¹è±¡å¤§å°è§„æ ¼(å…¨å±€å…±åˆ’åˆ†ä¸º68ç§)å¯¹åº”çš„ç¼“å­˜,é”çš„ç²’åº¦ä¹Ÿä»…é™äºåŒä¸€ç§è§„æ ¼ä»¥å†….mcentralæ˜¯åŒç§è§„æ ¼çš„mspanè¿æ¥è€Œæˆçš„ä¸€ä¸ªé“¾è¡¨\nmcache:æ¯ä¸ªPæŒæœ‰ä¸€ä»½çš„å†…å­˜ç¼“å­˜,è®¿é—®æ—¶æ— é”.\n\n\nå¤šçº§è§„æ ¼,æé«˜åˆ©ç”¨ç‡\n\n\npage æœ€å°çš„å­˜å‚¨å•å…ƒ.ç±»ä¼¼äºæ“ä½œç³»ç»Ÿçš„åˆ†é¡µ,ä½†æ˜¯å¤§å°æ˜¯8kb\nmspan æœ€å°çš„ç®¡ç†å•å…ƒ å¤§å°ä¸ºpageçš„æ•´æ•°å€,è¢«åˆ’åˆ†ä¸ºä»8båˆ°80kb67ç§ä¸åŒçš„è§„æ ¼[ä¸€ä¸ªmspanlé‡Œé¢åªæœ‰ä¸€ç§è§„æ ¼].[æ˜¯å†åˆ’åˆ†,å’Œé¡µçš„å¤§å°æ— å…³äº†.åˆ’åˆ†åçš„å°å—å«åšobject,objectçš„æ•°é‡å«nelems] åˆ†é…å¯¹è±¡æ—¶ï¼Œä¼šæ ¹æ®å¤§å°æ˜ å°„åˆ°ä¸åŒè§„æ ¼çš„ mspanï¼Œä»ä¸­è·å–ç©ºé—´.\n\nå¤šè§„æ ¼ mspan ä¸‹äº§ç”Ÿçš„ç‰¹ç‚¹ï¼š\n\næ ¹æ®è§„æ ¼å¤§å°ï¼Œäº§ç”Ÿäº†ç­‰çº§çš„åˆ¶åº¦\næ¶ˆé™¤äº†å¤–éƒ¨ç¢ç‰‡ï¼Œä½†ä¸å¯é¿å…ä¼šæœ‰å†…éƒ¨ç¢ç‰‡.å®è§‚ä¸Šèƒ½æé«˜æ•´ä½“ç©ºé—´åˆ©ç”¨ç‡\næ­£æ˜¯å› ä¸ºæœ‰äº†è§„æ ¼ç­‰çº§çš„æ¦‚å¿µï¼Œæ‰æ”¯æŒ mcentral å®ç°ç»†é”åŒ–,å› ä¸ºç”³è¯·çš„æ˜¯ä¸åŒè§„æ ¼çš„mspan,ä¸éœ€è¦å»å…¨å±€äº‰å¤ºé”.\n\n\n\n\n\næ ¸å¿ƒæ¦‚å¿µæ¢³ç†\nå†…å­˜å•å…ƒmspan\n\nmspan æ˜¯ Golang å†…å­˜ç®¡ç†çš„æœ€å°å•å…ƒ\nmspan å¤§å°æ˜¯ page çš„æ•´æ•°å€ï¼ˆGo ä¸­çš„ page å¤§å°ä¸º 8KBï¼‰ï¼Œä¸”å†…éƒ¨çš„é¡µæ˜¯è¿ç»­çš„ï¼ˆè‡³å°‘åœ¨è™šæ‹Ÿå†…å­˜çš„è§†è§’ä¸­æ˜¯è¿™æ ·ï¼‰\næ¯ä¸ª mspan æ ¹æ®ç©ºé—´å¤§å°ä»¥åŠé¢å‘åˆ†é…å¯¹è±¡çš„å¤§å°ï¼Œä¼šè¢«åˆ’åˆ†ä¸ºä¸åŒçš„ç­‰çº§\nåŒç­‰çº§çš„ mspan ä¼šä»å±åŒä¸€ä¸ª mcentralï¼Œæœ€ç»ˆä¼šè¢«ç»„ç»‡æˆé“¾è¡¨ï¼Œå› æ­¤å¸¦æœ‰å‰åæŒ‡é’ˆï¼ˆprevã€nextï¼‰\nç”±äºåŒç­‰çº§çš„ mspan å†…èšäºåŒä¸€ä¸ª mcentralï¼Œæ‰€ä»¥ä¼šåŸºäºåŒä¸€æŠŠäº’æ–¥é”ç®¡ç†\nmspan ä¼šåŸºäº bitMap è¾…åŠ©å¿«é€Ÿæ‰¾åˆ°ç©ºé—²å†…å­˜å—ï¼ˆå—å¤§å°ä¸ºå¯¹åº”ç­‰çº§ä¸‹çš„ object å¤§å°ï¼‰æ­¤æ—¶éœ€è¦ä½¿ç”¨åˆ° Ctz64 ç®—æ³•.\n\n\ntype mspan struct {\n    // æ ‡è¯†å‰åèŠ‚ç‚¹çš„æŒ‡é’ˆ \n    next *mspan     \n    prev *mspan    \n    // ...\n    // èµ·å§‹åœ°å€\n    startAddr uintptr \n    // åŒ…å«å‡ é¡µï¼Œé¡µæ˜¯è¿ç»­çš„\n    npages    uintptr \n \n \n    // æ ‡è¯†æ­¤å‰çš„ä½ç½®éƒ½å·²è¢«å ç”¨ \n    freeindex uintptr\n    // æœ€å¤šå¯ä»¥å­˜æ”¾å¤šå°‘ä¸ª object\n    nelems uintptr // number of object in the span.\n \n    // bitmap æ¯ä¸ª bit å¯¹åº”ä¸€ä¸ª object å—ï¼Œæ ‡è¯†è¯¥å—æ˜¯å¦å·²è¢«å ç”¨\n    allocCache uint64//64ä½,æ¯ä¸€ä½ä»£è¡¨ä¸€ä¸ªæ ¼å­çš„çŠ¶æ€0ä¸ºå ç”¨1ä¸ºç©º.cpuæœ‰ä¸€æ¡ç‰¹æ®ŠæŒ‡ä»¤å¯ä»¥å¯¹äºŒè¿›åˆ¶è¿›è¡ŒO(1)çš„æŸ¥è¯¢æ‰¾åˆ°äºŒè¿›åˆ¶ä¸­çš„1çš„ä½ç½®\n    //å¦‚æœè¿™ 64 ä½éƒ½ç”¨å®Œäº†ï¼ˆå…¨æ˜¯ 0ï¼‰ï¼Œå†ä»å¤§ä½å›¾ä¸­åŠ è½½ä¸‹ 64 ä½è¿›æ¥è¡¥å……\n    \n    \n    // ...\n    // æ ‡è¯† mspan ç­‰çº§ï¼ŒåŒ…å« class å’Œ noscan ä¸¤éƒ¨åˆ†ä¿¡æ¯\n    //size class å‰7ä½ å¯ä»¥æŸ¥è¯¢è¿™é‡Œé¢åˆ’åˆ†çš„objectå¤§å°\n    //noscan æœ€åä¸€ä½ æ˜¯å…æ‰«ææ ‡è®°,gcçœ‹åˆ°è¿™ä¸ªæ ‡è®°,å°±çŸ¥é“é‡Œé¢å­˜çš„å¯¹è±¡ä¸åŒ…å«æŒ‡é’ˆ,ä¸éœ€è¦æ²¿ç€æŒ‡é’ˆæ‰“å¼€å¾€ä¸‹æ‰«æ.\n    spanclass    spanClass    \n    // ...\n}\nå†…å­˜å•å…ƒç­‰çº§spanClass\nmspan æ ¹æ®ç©ºé—´å¤§å°å’Œé¢å‘åˆ†é…å¯¹è±¡çš„å¤§å°ï¼Œè¢«åˆ’åˆ†ä¸º 67 ç§ç­‰çº§ï¼ˆ1-67ï¼Œå®é™…ä¸Šè¿˜æœ‰ä¸€ç§éšè—çš„ 0 çº§ï¼Œç”¨äºå¤„ç†æ›´å¤§çš„å¯¹è±¡ï¼Œä¸Šä¸å°é¡¶ï¼‰\n\n\nclass: mspanç­‰çº§æ ‡è¯†\nbytes/objï¼šè¯¥å¤§å°è§„æ ¼çš„å¯¹è±¡ä¼šä»è¿™ä¸€ mspan ä¸­è·å–ç©ºé—´. åˆ›å»ºå¯¹è±¡è¿‡ç¨‹ä¸­ï¼Œå¤§å°ä¼šå‘ä¸Šå–æ•´ä¸º 8B çš„æ•´æ•°å€ï¼Œå› æ­¤è¯¥è¡¨å¯ä»¥ç›´æ¥å®ç° object åˆ° mspan ç­‰çº§ çš„æ˜ å°„\nbytes/spanï¼šè¯¥ç­‰çº§çš„ mspan çš„æ€»ç©ºé—´å¤§å°\nobjectï¼šè¯¥ç­‰çº§çš„ mspan æœ€å¤šå¯ä»¥ new å¤šå°‘ä¸ªå¯¹è±¡ï¼Œç»“æœç­‰äº ï¼ˆ3ï¼‰/ï¼ˆ2ï¼‰\ntail wasteï¼šï¼ˆ 3ï¼‰/ï¼ˆ2ï¼‰å¯èƒ½é™¤ä¸å°½ï¼Œäºæ˜¯è¯¥é¡¹å€¼ä¸ºï¼ˆ3ï¼‰%ï¼ˆ2ï¼‰\nmax wasteï¼šé€šè¿‡ä¸‹é¢ç¤ºä¾‹è§£é‡Šï¼š\n\n\nä»¥ class 3 çš„ mspan ä¸ºä¾‹ï¼Œclass åˆ†é…çš„ object å¤§å°ç»Ÿä¸€ä¸º 24Bï¼Œç”±äº object å¤§å° â‡ 16B çš„ä¼šè¢«åˆ†é…åˆ° class 2 åŠä¹‹å‰çš„ class ä¸­ï¼Œå› æ­¤åªæœ‰ 17B-24B å¤§å°çš„ object ä¼šè¢«åˆ†é…åˆ° class 3.\n\næœ€ä¸åˆ©çš„æƒ…å†µæ˜¯ï¼Œå½“ object å¤§å°ä¸º 17Bï¼Œä¼šäº§ç”Ÿæµªè´¹ç©ºé—´æ¯”ä¾‹å¦‚ä¸‹ï¼š\nÂ ((24-17)*341Â +Â 8)/8192Â =Â 0.292358Â â‰ˆÂ 29.24%\n\né™¤äº†ä¸Šé¢è°ˆåŠçš„æ ¹æ®å¤§å°ç¡®å®šçš„ mspan ç­‰çº§å¤–ï¼Œæ¯ä¸ª object è¿˜æœ‰ä¸€ä¸ªé‡è¦çš„å±æ€§å«åš nocanï¼Œæ ‡è¯†äº† object æ˜¯å¦åŒ…å«æŒ‡é’ˆï¼Œåœ¨ gc æ—¶æ˜¯å¦éœ€è¦å±•å¼€æ ‡è®°.\nåœ¨ Golang ä¸­ï¼Œä¼šå°† span class + nocan ä¸¤éƒ¨åˆ†ä¿¡æ¯ç»„è£…æˆä¸€ä¸ª uint8ï¼Œå½¢æˆå®Œæ•´çš„ spanClass æ ‡è¯†. 8 ä¸ª bit ä¸­ï¼Œé«˜ 7 ä½è¡¨ç¤ºäº†ä¸Šè¡¨çš„ span ç­‰çº§ï¼ˆæ€»å…± 67 + 1 ä¸ªç­‰çº§ï¼Œ8 ä¸ª bit è¶³å¤Ÿç”¨äº†ï¼‰ï¼Œæœ€ä½ä½è¡¨ç¤º nocan ä¿¡æ¯.\nçº¿ç¨‹ç¼“å­˜mcache\nï¼ˆ1ï¼‰mcache æ˜¯æ¯ä¸ª P ç‹¬æœ‰çš„ç¼“å­˜ï¼Œå› æ­¤äº¤äº’æ— é”\nï¼ˆ2ï¼‰mcache å°†æ¯ç§ spanClass ç­‰çº§(æ˜¯å¦scanç®—ä½œåŒä¸€ä¸ªç­‰çº§çš„ä¸¤ç§mspan)çš„ mspan å„ç¼“å­˜äº†ä¸€ä¸ªï¼Œæ€»æ•°ä¸º 2ï¼ˆnocan ç»´åº¦ï¼‰ * 68ï¼ˆå¤§å°ç»´åº¦ï¼‰= 136\nï¼ˆ3ï¼‰mcache ä¸­è¿˜æœ‰ä¸€ä¸ªä¸ºå¯¹è±¡åˆ†é…å™¨ tiny allocatorï¼Œç”¨äºå¤„ç†å°äº 16B å¯¹è±¡çš„å†…å­˜åˆ†é…\nconst numSpanClasses = 136\ntype mcache struct {\n    // å¾®å¯¹è±¡åˆ†é…å™¨ç›¸å…³\n    tiny       uintptr\n    tinyoffset uintptr\n    tinyAllocs uintptr\n    \n    // mcache ä¸­ç¼“å­˜çš„ mspanï¼Œæ¯ç§ spanClass å„ä¸€ä¸ª\n    alloc [numSpanClasses]*mspan \n    // ...\n}\nä¸­å¿ƒç¼“å­˜mcentral\nï¼ˆ1ï¼‰æ¯ä¸ª mcentral å¯¹åº”ä¸€ç§ spanClass\nï¼ˆ2ï¼‰æ¯ä¸ª mcentral ä¸‹èšåˆäº†è¯¥ spanClass ä¸‹çš„ mspan\nï¼ˆ3ï¼‰mcentral ä¸‹çš„ mspan åˆ†ä¸ºä¸¤ä¸ªé“¾è¡¨ï¼Œåˆ†åˆ«ä¸ºæœ‰ç©ºé—´ mspan é“¾è¡¨ partial å’Œæ»¡ç©ºé—´ mspan é“¾è¡¨ full\nï¼ˆ4ï¼‰æ¯ä¸ª mcentral ä¸€æŠŠé”\ntype mcentral struct {\n    // å¯¹åº”çš„ spanClass\n    spanclass spanClass\n    // æœ‰ç©ºä½çš„ mspan é›†åˆï¼Œæ•°ç»„é•¿åº¦ä¸º 2 æ˜¯ç”¨äºæŠ—ä¸€è½® GC\n    partial [2]spanSet \n    // æ— ç©ºä½çš„ mspan é›†åˆ\n    full    [2]spanSet \n}\nå…¨å±€å †ç¼“å­˜mheap\nâ€¢ å¯¹äº Golang ä¸Šå±‚åº”ç”¨è€Œè¨€ï¼Œå †æ˜¯æ“ä½œç³»ç»Ÿè™šæ‹Ÿå†…å­˜çš„æŠ½è±¡\nâ€¢ ä»¥é¡µï¼ˆ8KBï¼‰ä¸ºå•ä½ï¼Œä½œä¸ºæœ€å°å†…å­˜å­˜å‚¨å•å…ƒ\nâ€¢ è´Ÿè´£å°†è¿ç»­é¡µç»„è£…æˆ mspan\nâ€¢ å…¨å±€å†…å­˜åŸºäº bitMap æ ‡è¯†å…¶ä½¿ç”¨æƒ…å†µï¼Œæ¯ä¸ª bit å¯¹åº”ä¸€é¡µï¼Œä¸º 0 åˆ™è‡ªç”±ï¼Œä¸º 1 åˆ™å·²è¢« mspan ç»„è£…\nâ€¢ é€šè¿‡ heapArena èšåˆé¡µï¼Œè®°å½•äº†é¡µåˆ° mspan çš„æ˜ å°„ä¿¡æ¯ï¼ˆ2.7å°èŠ‚å±•å¼€ï¼‰\nâ€¢ å»ºç«‹ç©ºé—²é¡µåŸºæ•°æ ‘ç´¢å¼• radix tree indexï¼Œè¾…åŠ©å¿«é€Ÿå¯»æ‰¾ç©ºé—²é¡µï¼ˆ2.6å°èŠ‚å±•å¼€ï¼‰\nâ€¢ æ˜¯ mcentral çš„æŒæœ‰è€…ï¼ŒæŒæœ‰æ‰€æœ‰ spanClass ä¸‹çš„ mcentralï¼Œä½œä¸ºè‡ªèº«çš„ç¼“å­˜\nâ€¢ å†…å­˜ä¸å¤Ÿæ—¶ï¼Œå‘æ“ä½œç³»ç»Ÿç”³è¯·ï¼Œç”³è¯·å•ä½ä¸º heapArenaï¼ˆ64Mï¼‰\ntype mheap struct {\n    // å †çš„å…¨å±€é”\n    lock mutex\n \n \n    // ç©ºé—²é¡µåˆ†é…å™¨ï¼Œåº•å±‚æ˜¯å¤šæ£µåŸºæ•°æ ‘ç»„æˆçš„ç´¢å¼•ï¼Œæ¯æ£µæ ‘å¯¹åº” 16 GB å†…å­˜ç©ºé—´\n    pages pageAlloc \n \n \n    // è®°å½•äº†æ‰€æœ‰çš„ mspan. éœ€è¦çŸ¥é“ï¼Œæ‰€æœ‰ mspan éƒ½æ˜¯ç»ç”± mheapï¼Œä½¿ç”¨è¿ç»­ç©ºé—²é¡µç»„è£…ç”Ÿæˆçš„\n    allspans []*mspan\n \n \n    // heapAreana æ•°ç»„ï¼Œ64 ä½ç³»ç»Ÿä¸‹ï¼ŒäºŒç»´æ•°ç»„å®¹é‡ä¸º [1][2^22]\n    // æ¯ä¸ª heapArena å¤§å° 64Mï¼Œå› æ­¤ç†è®ºä¸Šï¼ŒGolang å †ä¸Šé™ä¸º 2^22*64M = 256T\n    arenas [1 &lt;&lt; arenaL1Bits]*[1 &lt;&lt; arenaL2Bits]*heapArena\n \n \n    // ...\n    // å¤šä¸ª mcentralï¼Œæ€»ä¸ªæ•°ä¸º spanClass çš„ä¸ªæ•°\n    central [numSpanClasses]struct {\n        mcentral mcentral\n        // ç”¨äºå†…å­˜åœ°å€å¯¹é½\n        pad      [cpu.CacheLinePadSize - unsafe.Sizeof(mcentral{})%cpu.CacheLinePadSize]byte\n    }\n \n \n    // ...\n}\nç©ºé—²é¡µç´¢å¼• pageAlloc\n\næ•°æ®ç»“æ„èƒŒåçš„å«ä¹‰\n\nmheapä¼šåŸºäºbitMapæ ‡è¯†å†…å­˜ä¸­å„é¡µçš„ä½¿ç”¨æƒ…å†µ,bitä½ä¸º0ä»£è¡¨è¯¥é¡µç©ºé—²,ä¸º1ä»£è¡¨è¯¥é¡µå·²è¢«mspanå ç”¨\næ¯æ£µåŸºæ•°æ ‘èšåˆäº†16GBå†…å­˜ç©ºé—´ä¸­å„é¡µä½¿ç”¨æƒ…å†µçš„ç´¢å¼•ä¿¡æ¯,ç”¨äºå¸®åŠ©mheapå¿«é€Ÿæ‰¾åˆ°æŒ‡å®šé•¿åº¦çš„è¿ç»­ç©ºé—²é¡µçš„æ‰€åœ¨ä½ç½®\nmheapæŒæœ‰2çš„14æ¬¡æ–¹æ£µåŸºæ•°æ ‘,å› æ­¤ç´¢å¼•å…¨é¢è¦†ç›–åˆ°2çš„114æ¬¡æ–¹*16gb=256Tçš„å†…å­˜ç©ºé—´\n\n\nåŸºæ•°æ ‘è®¾å®š\n\n\nåŸºæ•°æ ‘ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹ç§°ä¹‹ä¸º PallocSumï¼Œæ˜¯ä¸€ä¸ª uint64 ç±»å‹ï¼Œä½“ç°äº†ç´¢å¼•çš„èšåˆä¿¡æ¯ï¼ŒåŒ…å«ä»¥ä¸‹å››éƒ¨åˆ†ï¼š\n\nstartï¼šæœ€å³ä¾§ 21 ä¸ª bitï¼Œæ ‡è¯†äº†å½“å‰èŠ‚ç‚¹æ˜ å°„çš„ bitMap èŒƒå›´ä¸­é¦–ç«¯æœ‰å¤šå°‘ä¸ªè¿ç»­çš„ 0 bitï¼ˆç©ºé—²é¡µï¼‰ç§°ä¹‹ä¸º startï¼›\n-Â maxï¼šä¸­é—´ 21 ä¸ª bitï¼Œæ ‡è¯†äº†å½“å‰èŠ‚ç‚¹æ˜ å°„çš„ bitMap èŒƒå›´ä¸­æœ€å¤šæœ‰å¤šå°‘ä¸ªè¿ç»­çš„ 0 bitï¼ˆç©ºé—²é¡µï¼‰ç§°ä¹‹ä¸º maxï¼›\nendï¼šå·¦ä¾§ 21 ä¸ª bitï¼Œæ ‡è¯†äº†å½“å‰èŠ‚ç‚¹æ˜ å°„çš„ bitMap èŒƒå›´ä¸­æœ€æœ«ç«¯æœ‰å¤šå°‘ä¸ªè¿ç»­çš„ 0 bitï¼ˆç©ºé—²é¡µï¼‰ç§°ä¹‹ä¸º end.\næœ€å·¦ä¾§ä¸€ä¸ª bitï¼Œå¼ƒç½®ä¸ç”¨\næ€»ä¹‹å°±æ˜¯åˆ©ç”¨åŸºæ•°æ ‘å¿«é€ŸæŸ¥æ‰¾ç©ºé—²é¡µ\n\n\n\nheapArena\n\næ¯ä¸ª heapArena åŒ…å« 8192 ä¸ªé¡µï¼Œå¤§å°ä¸º 8192 * 8KB = 64 MB\nheapArena è®°å½•äº†é¡µåˆ° mspan çš„æ˜ å°„. å› ä¸º GC æ—¶ï¼Œé€šè¿‡åœ°å€åç§»æ‰¾åˆ°é¡µå¾ˆæ–¹ä¾¿ï¼Œä½†æ‰¾åˆ°å…¶æ‰€å±çš„ mspan ä¸å®¹æ˜“. å› æ­¤éœ€è¦é€šè¿‡è¿™ä¸ªæ˜ å°„ä¿¡æ¯è¿›è¡Œè¾…åŠ©.\nheapArena æ˜¯ mheap å‘æ“ä½œç³»ç»Ÿç”³è¯·å†…å­˜çš„å•ä½ï¼ˆ64MBï¼‰\n\nå¯¹è±¡åˆ†é…æµç¨‹\nä¸‹é¢æ¥ä¸²è” Golang ä¸­åˆ†é…å¯¹è±¡çš„æµç¨‹ï¼Œä¸è®ºæ˜¯ä»¥ä¸‹å“ªç§æ–¹å¼ï¼Œæœ€ç»ˆéƒ½ä¼šæ®Šé€”åŒå½’æ­¥å…¥ mallocgc æ–¹æ³•ä¸­ï¼Œå¹¶ä¸”æ ¹æ® 3.1 å°èŠ‚ä¸­çš„ç­–ç•¥æ‰§è¡Œåˆ†é…æµç¨‹ï¼š\n\nnew(T)\n-Â &amp;T{}\nmake(xxxx)\n\næµç¨‹æ€»è§ˆ\nåœ¨golangä¸­,ä¾æ®objectçš„å¤§å°,å°†å…¶åˆ†ä¸ºä¸‰ç±»\n\ntiny å¾®å¯¹è±¡(0,16B)\nsmall å°å¯¹è±¡[16B,32KB]\nlarge å¤§å¯¹è±¡(32KB,âˆ)\n\nä¸åŒç±»å‹çš„å¯¹è±¡ï¼Œä¼šæœ‰ç€ä¸åŒçš„åˆ†é…ç­–ç•¥ï¼Œè¿™äº›å†…å®¹åœ¨ mallocgc æ–¹æ³•ä¸­éƒ½æœ‰ä½“ç°.\næ ¸å¿ƒæµç¨‹ç±»ä¼¼äºè¯»å¤šçº§ç¼“å­˜çš„è¿‡ç¨‹ï¼Œç”±ä¸Šè€Œä¸‹ï¼Œæ¯ä¸€æ­¥åªè¦æˆåŠŸåˆ™ç›´æ¥è¿”å›. è‹¥å¤±è´¥ï¼Œåˆ™ç”±ä¸‹å±‚æ–¹æ³•å…œåº•.\n\n\nå¯¹äºå¾®å¯¹è±¡çš„åˆ†é…æµç¨‹ï¼š\nï¼ˆ1ï¼‰ä» P ä¸“å± mcache çš„ tiny åˆ†é…å™¨å–å†…å­˜ï¼ˆæ— é”ï¼‰\nï¼ˆ2ï¼‰æ ¹æ®æ‰€å±çš„ spanClassï¼Œä» P ä¸“å± mcache ç¼“å­˜çš„ mspan ä¸­å–å†…å­˜ï¼ˆæ— é”ï¼‰\nï¼ˆ3ï¼‰æ ¹æ®æ‰€å±çš„ spanClass ä»å¯¹åº”çš„ mcentral ä¸­å– mspan å¡«å……åˆ° mcacheï¼Œç„¶åä» mspan ä¸­å–å†…å­˜ï¼ˆspanClass ç²’åº¦é”ï¼‰\nï¼ˆ4ï¼‰æ ¹æ®æ‰€å±çš„ spanClassï¼Œä» mheap çš„é¡µåˆ†é…å™¨ pageAlloc å–å¾—è¶³å¤Ÿæ•°é‡ç©ºé—²é¡µç»„è£…æˆ mspan å¡«å……åˆ° mcacheï¼Œç„¶åä» mspan ä¸­å–å†…å­˜ï¼ˆå…¨å±€é”ï¼‰\nï¼ˆ5ï¼‰mheap å‘æ“ä½œç³»ç»Ÿç”³è¯·å†…å­˜ï¼Œæ›´æ–°é¡µåˆ†é…å™¨çš„ç´¢å¼•ä¿¡æ¯ï¼Œç„¶åé‡å¤ï¼ˆ4ï¼‰.\n\n\nå¯¹äºå°å¯¹è±¡çš„åˆ†é…æµç¨‹æ˜¯è·³è¿‡ï¼ˆ1ï¼‰æ­¥ï¼Œæ‰§è¡Œä¸Šè¿°æµç¨‹çš„ï¼ˆ2ï¼‰-ï¼ˆ5ï¼‰æ­¥ï¼›\n\n\nå¯¹äºå¤§å¯¹è±¡çš„åˆ†é…æµç¨‹æ˜¯è·³è¿‡ï¼ˆ1ï¼‰-ï¼ˆ3ï¼‰æ­¥ï¼Œæ‰§è¡Œä¸Šè¿°æµç¨‹çš„ï¼ˆ4ï¼‰-ï¼ˆ5ï¼‰æ­¥.[mspanæœ€å¤§çš„è§„æ ¼åªæœ‰32KB]\n\n\nä¸»å¹²æ–¹æ³•mallocgc\nfunc mallocgc(size uintptr, typ *_type, needzero bool) unsafe.Pointer {\n    // ...    \n    // è·å– m\n    mp := acquirem()\n    // è·å–å½“å‰ p å¯¹åº”çš„ mcache\n    c := getMCache(mp)\n    var span *mspan\n    var x unsafe.Pointer\n    // æ ¹æ®å½“å‰å¯¹è±¡æ˜¯å¦åŒ…å«æŒ‡é’ˆï¼Œæ ‡è¯† gc æ—¶æ˜¯å¦éœ€è¦å±•å¼€æ‰«æ\n    noscan := typ == nil || typ.ptrdata == 0\n    // æ˜¯å¦æ˜¯å°äº 32KB çš„å¾®ã€å°å¯¹è±¡\n    if size &lt;= maxSmallSize {\n    // å°äº 16 B ä¸”æ— æŒ‡é’ˆï¼Œåˆ™è§†ä¸ºå¾®å¯¹è±¡\n        if noscan &amp;&amp; size &lt; maxTinySize {\n        // tiny å†…å­˜å—ä¸­ï¼Œä» offset å¾€åæœ‰ç©ºé—²ä½ç½®\n          off := c.tinyoffset\n          // å¦‚æœå¤§å°ä¸º 5 ~ 8 Bï¼Œsize ä¼šè¢«è°ƒæ•´ä¸º 8 Bï¼Œæ­¤æ—¶ 8 &amp; 7 == 0ï¼Œä¼šèµ°è¿›æ­¤åˆ†æ”¯\n          if size&amp;7 == 0 {\n                // å°† offset è¡¥é½åˆ° 8 B å€æ•°çš„ä½ç½®\n                off = alignUp(off, 8)\n                // å¦‚æœå¤§å°ä¸º 3 ~ 4 Bï¼Œsize ä¼šè¢«è°ƒæ•´ä¸º 4 Bï¼Œæ­¤æ—¶ 4 &amp; 3 == 0ï¼Œä¼šèµ°è¿›æ­¤åˆ†æ”¯  \n           } else if size&amp;3 == 0 {\n           // å°† offset è¡¥é½åˆ° 4 B å€æ•°çš„ä½ç½®\n                off = alignUp(off, 4)\n                // å¦‚æœå¤§å°ä¸º 1 ~ 2 Bï¼Œsize ä¼šè¢«è°ƒæ•´ä¸º 2 Bï¼Œæ­¤æ—¶ 2 &amp; 1 == 0ï¼Œä¼šèµ°è¿›æ­¤åˆ†æ”¯  \n           } else if size&amp;1 == 0 {\n            // å°† offset è¡¥é½åˆ° 2 B å€æ•°çš„ä½ç½®\n                off = alignUp(off, 2)\n           }\n// å¦‚æœå½“å‰ tiny å†…å­˜å—ç©ºé—´è¿˜å¤Ÿç”¨ï¼Œåˆ™ç›´æ¥åˆ†é…å¹¶è¿”å›\n            if off+size &lt;= maxTinySize &amp;&amp; c.tiny != 0 {\n            // åˆ†é…ç©ºé—´\n                x = unsafe.Pointer(c.tiny + off)\n                c.tinyoffset = off + size\n                c.tinyAllocs++\n                mp.mallocing = 0\n                releasem(mp)  \n                return x\n            } \n            // åˆ†é…ä¸€ä¸ªæ–°çš„ tiny å†…å­˜å—\n            span = c.alloc[tinySpanClass]    \n            // ä» mCache ä¸­è·å–\n            v := nextFreeFast(span)        \n            if v == 0 {\n            // ä» mCache ä¸­è·å–å¤±è´¥ï¼Œåˆ™ä» mCentral æˆ–è€… mHeap ä¸­è·å–è¿›è¡Œå…œåº•\n                v, span, shouldhelpgc = c.nextFree(tinySpanClass)\n            }   \n// åˆ†é…ç©ºé—´      \n            x = unsafe.Pointer(v)\n           (*[2]uint64)(x)[0] = 0\n           (*[2]uint64)(x)[1] = 0\n           size = maxTinySize\n        } else {\n          // æ ¹æ®å¯¹è±¡å¤§å°ï¼Œæ˜ å°„åˆ°å…¶æ‰€å±çš„ span çš„ç­‰çº§(0~66ï¼‰\n          var sizeclass uint8\n          if size &lt;= smallSizeMax-8 {\n              sizeclass = size_to_class8[divRoundUp(size, smallSizeDiv)]\n          } else {\n              sizeclass = size_to_class128[divRoundUp(size-smallSizeMax, largeSizeDiv)]\n          }        \n          // å¯¹åº” span ç­‰çº§ä¸‹ï¼Œåˆ†é…ç»™æ¯ä¸ªå¯¹è±¡çš„ç©ºé—´å¤§å°(0~32KB)\n          size = uintptr(class_to_size[sizeclass])\n          // åˆ›å»º spanClass æ ‡è¯†ï¼Œå…¶ä¸­å‰ 7 ä½å¯¹åº”ä¸º span çš„ç­‰çº§(0~66)ï¼Œæœ€åæ ‡è¯†è¡¨ç¤ºäº†è¿™ä¸ªå¯¹è±¡ gc æ—¶æ˜¯å¦éœ€è¦æ‰«æ\n          spc := makeSpanClass(sizeclass, noscan) \n          // è·å– mcache ä¸­çš„ span\n          span = c.alloc[spc]  \n          // ä» mcache çš„ span ä¸­å°è¯•è·å–ç©ºé—´        \n          v := nextFreeFast(span)\n          if v == 0 {\n          // mcache åˆ†é…ç©ºé—´å¤±è´¥ï¼Œåˆ™é€šè¿‡ mcentralã€mheap å…œåº•            \n             v, span, shouldhelpgc = c.nextFree(spc)\n          }     \n          // åˆ†é…ç©ºé—´  \n          x = unsafe.Pointer(v)\n          // ...\n       }      \n       // å¤§äº 32KB çš„å¤§å¯¹è±¡      \n   } else {\n       // ä» mheap ä¸­è·å– 0 å· span\n       span = c.allocLarge(size, noscan)\n       span.freeindex = 1\n       span.allocCount = 1\n       size = span.elemsize         \n       // åˆ†é…ç©ºé—´   \n        x = unsafe.Pointer(span.base())\n   }  \n   // ...\n   return x\n}                               \ntinyåˆ†é…\næ¯ä¸ª P ç‹¬æœ‰çš„ mache ä¼šæœ‰ä¸ªå¾®å¯¹è±¡åˆ†é…å™¨ï¼ŒåŸºäº offset çº¿æ€§ç§»åŠ¨çš„æ–¹å¼å¯¹å¾®å¯¹è±¡è¿›è¡Œåˆ†é…ï¼Œæ¯ 16B æˆå—ï¼Œå¯¹è±¡ä¾æ®å…¶å¤§å°ï¼Œä¼šå‘ä¸Šå–æ•´ä¸º 2 çš„æ•´æ•°æ¬¡å¹‚è¿›è¡Œç©ºé—´è¡¥é½ï¼Œç„¶åè¿›å…¥åˆ†é…æµç¨‹.\n\n\n                  \n                  Title \n                  \n                \n\nå†…å­˜åˆ†é…ä¸­,æœ€å°çš„åˆ†é…å•ä½æ˜¯å…«å­—èŠ‚,å°±ç®—åªå­˜ä¸€ä¸ªbool,ä¹Ÿä¼šç»™ä¸€ä¸ªå…«å­—èŠ‚çš„æ ¼å­.æ˜¯ mcache å…ˆå»ç”³è¯·ä¸€ä¸ªæ™®é€šçš„ mspanï¼ˆæ¯”å¦‚ class 2ï¼‰ç„¶åä»é‡Œé¢æ‹¿å‡ºä¸€ä¸ª 16B çš„å—ï¼Œä¸“é—¨æ ‡è®°ä¸ºâ€œç°åœ¨çš„ tiny blockâ€ï¼Œç„¶åå¼€å§‹å¾€é‡Œé¢å¡ä¸œè¥¿.   é¿å…å†…éƒ¨ç¢ç‰‡\n\n\n\n\n                  \n                  Title \n                  \n                \n\nç¼–è¯‘æœŸç»“æŸå,å°±å·²ç»çŸ¥é“è¦ä¸ºä»€ä¹ˆå˜é‡ç”³è¯·ä»€ä¹ˆå†…å­˜.åªæ˜¯æŠŠäº§ç”Ÿçš„tinyobjectå˜é‡æŒ‰ç…§ä¸€å®šçš„è§„åˆ™å¡è¿›mcacheçš„tiny blocké‡Œé¢\n\n\n\n    noscan := typ == nil || typ.ptrdata == 0\n    // ...\n    //åªæ”¶ä¸å«æŒ‡é’ˆä¸”å¤§å°å°äº 16Bçš„å¯¹è±¡\n        if noscan &amp;&amp; size &lt; maxTinySize {\n        // tiny å†…å­˜å—ä¸­ï¼Œä» offset å¾€åæœ‰ç©ºé—²ä½ç½®\n          off := c.tinyoffset\n          // off æ­¤æ—¶æ˜¯ç»è¿‡â€œå¯¹é½ç®—æ³•â€è°ƒæ•´åçš„æ–°åç§»é‡\n          // ...\n          // `c.tiny` æŒ‡å‘å½“å‰é‚£ä¸ª 16B çš„å†…å­˜å—çš„**èµ·å§‹åœ°å€**ã€‚`c.tinyoffset` æ˜¯ä¸€ä¸ªæ¸¸æ ‡ï¼Œè®°å½•å½“å‰ç”¨åˆ°å“ªé‡Œäº†ã€‚\n            // å¦‚æœå½“å‰ tiny å†…å­˜å—ç©ºé—´è¿˜å¤Ÿç”¨ï¼Œåˆ™ç›´æ¥åˆ†é…å¹¶è¿”å›\n            if off+size &lt;= maxTinySize &amp;&amp; c.tiny != 0 {\n            // åˆ†é…ç©ºé—´\n                x = unsafe.Pointer(c.tiny + off)//è®¡ç®—å†…å­˜åœ°å€\n                c.tinyoffset = off + size//æ›´æ–°æ¸¸æ ‡\n                c.tinyAllocs++//ç»Ÿè®¡æ•°æ®\n                mp.mallocing = 0//æ¢å¤çŠ¶æ€\n                releasem(mp)\n                return x\n            }\n        //éƒ½æ˜¯çº³ç§’çº§æ“ä½œ,åŸºæœ¬ç­‰åŒäºCPUçš„åŠ æ³•æŒ‡ä»¤\n           // ...\n        }\nmcacheåˆ†é…\nå®è§‚æµç¨‹\n          // æ ¹æ®å¯¹è±¡å¤§å°ï¼Œæ˜ å°„åˆ°å…¶æ‰€å±çš„ span çš„ç­‰çº§(0~66ï¼‰\n          //æ¯”å¦‚ç”³è¯· 20å­—èŠ‚ï¼ŒGo ä¼šåŒ¹é…åˆ° 32å­—èŠ‚ çš„è§„æ ¼,è¿™ä¸ªsizeclassæ˜¯ä¸€ä¸ªç¼–å·id.æ¯”å¦‚32Bå¯¹åº”ç¼–å·æ˜¯3\n          var sizeclass uint8\n          // get size class ....     \n          // å¯¹åº” span ç­‰çº§ä¸‹ï¼Œåˆ†é…ç»™æ¯ä¸ªå¯¹è±¡çš„ç©ºé—´å¤§å°(0~32KB)\n          \n          // ä½†æ˜¯åŒä¸€ä¸ªsize  è¿˜æœ‰ä¸¤ç§span .spanclasså°±æ˜¯,sizeclaasså·¦ç§»ä¸€ä½,æœ€åä¸€ä½æ ‡è®°æ˜¯å¦noscan\n          //get span class\n          spc := makeSpanClass(sizeclass, noscan) \n          \n          //c æ˜¯ mcacheï¼Œalloc æ˜¯ä¸€ä¸ªæ•°ç»„ [134]*mspanã€‚è¿™å°±æ˜¯ç”¨spanclassæŠŠspanæ‹¿å‡ºæ¥\n          //è¿™é‡Œæ‹¿å‡ºæ¥å®Œå…¨ä¸éœ€è¦åŠ é”,å› ä¸ºmcacheæ˜¯ç»‘å®šåœ¨pä¸Šçš„\n          span = c.alloc[spc]  \n          // ä» mcache çš„ span ä¸­å°è¯•è·å–ç©ºé—´.è¿™é‡Œçš„nextFreeFastæ˜¯æé€Ÿåœ°æŒ‡ä¸€ä¸ªç©ºåº§ä½.spanç»“æ„ä½“é‡Œé¢æœ‰ä¸€ä¸ªallocCache,æœ‰64ä¸ªbit,ç¼“å­˜äº†å½“å‰çš„åº§ä½ä¸­æ¥ä¸‹æ¥64ä¸ªåº§ä½çš„ç©ºé—²çŠ¶æ€\n          //è¿™ä¸ª allocCache è¢«åŠ è½½åˆ°äº† CPU çš„å¯„å­˜å™¨ ä¸­ã€‚ CPU æœ‰ä¸€æ¡ç‰¹æ®Šçš„æŒ‡ä»¤ï¼ˆTZCNT æˆ– BSFï¼ŒGo é‡Œçš„ sys.Ctz64ï¼‰ï¼Œå®ƒèƒ½åœ¨ä¸€ä¸ª CPU å‘¨æœŸå†…ï¼Œç›´æ¥ç®—å‡ºè¿™ä¸ª 64 ä½çš„æ•°å­—é‡Œï¼Œå€’æ•°ç¬¬å‡ ä½æ˜¯ 1ã€‚\n          v := nextFreeFast(span)\n          if v == 0 {\n          // mcache åˆ†é…ç©ºé—´å¤±è´¥ï¼Œåˆ™é€šè¿‡ mcentralã€mheap å…œåº• \n          // è¿™é‡Œçš„nextfree.è¿™ä¸ªæ–¹æ³•å¯èƒ½ä¼š1. åˆ·æ–°ä½å›¾:åŠ è½½ä¸‹64ä¸ªæ§½ä½çš„çŠ¶æ€.2.å¦‚æœmspanå½»åº•æ»¡äº†,å°±å‘mcentralç”³è¯·æ–°çš„span[Refill]\n             v, span, shouldhelpgc = c.nextFree(spc)\n          }     \n          // åˆ†é…ç©ºé—´  \n          x = unsafe.Pointer(v)\nå¾®è§‚ç®—æ³•\nfunc nextFreeFast(s *mspan) gclinkptr {\n    // é€šè¿‡ ctz64 ç®—æ³•ï¼Œåœ¨ bit map ä¸Šå¯»æ‰¾åˆ°é¦–ä¸ª object ç©ºä½\n    theBit := sys.Ctz64(s.allocCache) \n    \n    if theBit &lt; 64 {//å¦‚æœè¿”å›64çš„è¯è¯´æ˜æ²¡æœ‰æ‰¾åˆ°.è¿”å›&lt;64çš„æ•°å­—å°±æ˜¯è¿™é0bitçš„ä½ç½®\n\t    //è®¡ç®—å…¨å±€ç´¢å¼•,è¦åŠ ä¸Šfreeindex:ä¹Ÿå°±æ˜¯alloccacheå¯¹åº”çš„èµ·å§‹æ¸¸æ ‡\n        result := s.freeindex + uintptr(theBit)\n        \n        //è¾¹ç•Œæ£€æŸ¥\n        if result &lt; s.nelems {//è¿™ä¸ªnelemsæ˜¯å½“å‰spanæ€»å…±èƒ½å®¹çº³çš„å¯¹è±¡æ•°\n            freeidx := result + 1\n            if freeidx%64 == 0 &amp;&amp; freeidx != s.nelems {\n                return 0\n            }//å¦‚æœåˆšå¥½ç”¨å®Œäº†å½“å‰çš„64ä½,ä¸”spanè¿˜æœ‰å‰©ä½™çš„å¯¹è±¡,é‚£ä¹ˆå¯ä»¥é€€å‡ºå»æ…¢åˆ†é….\n            \n            //æ›´æ–°ä½å›¾,å‘å³ç§»åŠ¨å¤šå°‘å¤šå°‘ä½,å˜æˆtheBitçš„æ¥ä¸‹æ¥64ä½\n            s.allocCache &gt;&gt;= uint(theBit + 1)\n            // æ›´æ–° freeindex \n            s.freeindex = freeidx\n            s.allocCount++\n            // è¿”å›è·å– object ç©ºä½çš„å†…å­˜åœ°å€ \n            return gclinkptr(result*s.elemsize + s.base())//æ¯”å¦‚åˆ†é…åˆ°äº†ç¬¬äºŒä¸ªå¯¹è±¡,é‚£ä¹ˆè®¡ç®—å®é™…çš„åœ°å€\n        }\n    }\n    return 0\n}\nmcentralåˆ†é…\ntinyåˆ†é…å’Œmcacheåˆ†é…éƒ½å¤±è´¥ä¹‹å,å°±ä¼šè¿›å…¥è¿™ä¸ªæ…¢åˆ†é…è·¯å¾„\nfunc (c *mcache) nextFree(spc spanClass) (v gclinkptr, s *mspan, shouldhelpgc bool) {\n    s = c.alloc[spc]//ä»mcacheé‡Œé¢æŠŠç‰¹å®šspanclassçš„spanæ‹¿å‡ºæ¥\n    // ...\n    // ä» mcache çš„ span ä¸­è·å– object ç©ºä½çš„åç§»é‡\n    freeIndex := s.nextFreeIndex()\n    if freeIndex == s.nelems {\n        // ...\n        // å€˜è‹¥ mcache ä¸­ span å·²ç»æ²¡æœ‰ç©ºä½ï¼Œåˆ™è°ƒç”¨ refill æ–¹æ³•ä» mcentral æˆ–è€… mheap ä¸­è·å–æ–°çš„ span    \n        c.refill(spc)\n        // ...\n        // å†æ¬¡ä»æ›¿æ¢åçš„ span ä¸­è·å– object ç©ºä½çš„åç§»é‡\n        s = c.alloc[spc]\n        freeIndex = s.nextFreeIndex()\n    }\n    // ...\n    v = gclinkptr(freeIndex*s.elemsize + s.base())\n    s.allocCount++\n    // ...\n    return\n}    \nfunc (c *mcache) refill(spc spanClass) {  \n    s := c.alloc[spc]\n    // ...\n    // mheap_.central[spc]ï¼šæ ¹æ®è§„æ ¼ (spanClass)ï¼Œæ‰¾åˆ°ç®¡ç†è¿™ç§è§„æ ¼çš„ä¸­å¿ƒä»“åº“ã€‚\n    // è°ƒç”¨ .cacheSpan() æ–¹æ³•ï¼Œè®© mcentral ç»™ä¸€ä¸ªå¯ç”¨çš„ spanã€‚\n    s = mheap_.central[spc].mcentral.cacheSpan()\n    // ...\n    // å°†æ–°çš„ span æ·»åŠ åˆ° mcahe å½“ä¸­\n    c.alloc[spc] = s\n}\nmcentralç®¡ç†ç€ä¸¤ä¸ªé“¾è¡¨\n\npartial:æœ‰ç©ºé—²ç©ºé—´çš„span\nfull:è¢«è®¤ä¸ºæ˜¯æ»¡çš„span\n\n\nGCï¼ˆæœåŠ¡å‘˜ï¼‰çš„å·¥ä½œ - æ ‡è®°ï¼š æœåŠ¡å‘˜ï¼ˆGCï¼‰æ¯éš”ä¸€å°æ—¶å·¡è§†ä¸€åœˆã€‚ä»–ä¸æ”¶ç›˜å­ï¼Œåªæ˜¯çœ‹å“ªå¼ æ¡Œå­çš„å®¢äººéƒ½èµ°å…‰äº†ï¼Œå°±åœ¨æ¡Œå­ä¸Šè´´ä¸ªâ€œå¯å›æ”¶â€çš„æ ‡ç­¾ï¼ˆMarkingï¼‰ã€‚ç»ç†æŒ‡ç€è´¦æœ¬ B ä¸Šçš„ä¸€å¼ æ¡Œå­è¯´ï¼šâ€œè¿™ä¸€æ¡Œï¼Œä½ è¿‡å»çœ‹çœ‹ã€‚â€ é¢†ä½å‘˜èµ°è¿‡å»ï¼ˆAcquire é”å®šï¼‰ï¼Œå‘ç°æ¡Œå­ä¸Šè´´ç€â€œå¯å›æ”¶â€ï¼Œäºæ˜¯é¡ºæ‰‹æŠŠç›˜å­æ”¶äº†ï¼ˆSweepï¼‰ã€‚ ç¬é—´ï¼Œä¸€å¼ â€œæ»¡æ¡Œâ€å˜æˆäº†â€œç©ºæ¡Œâ€ã€‚é¢†ä½å‘˜å°±å¯ä»¥å®‰æ’æ–°å®¢äººå…¥åº§äº†ã€‚æŠŠæ¸…ç†åƒåœ¾çš„å¼€é”€ï¼Œå¹³æ‘Šï¼ˆAmortizeï¼‰ åˆ°äº†æ¯ä¸€æ¬¡å†…å­˜åˆ†é…ä¸­ã€‚\n\nfunc (c *mcentral) cacheSpan() *mspan {\n    // ...\n    var sl sweepLocker //ç‰¹æ®Šçš„é”,ç”¨äºå¹¶å‘æ¸…æ‰« \n    // ...\n    sl = sweep.active.begin()\n    if sl.valid {\n    \n    //å°è¯•ä»partialéƒ¨åˆ†æ‰¾\n        for ; spanBudget &gt;= 0; spanBudget-- {\n            s = c.partialUnswept(sg).pop()//partialUnswepté‡Œé¢å­˜çš„æ˜¯ä¸Šæ¬¡çœ‹è¿˜æœ‰ç©ºä½,ä½†æ˜¯è¿˜æ²¡æ¸…æ‰«è¿‡çš„span,å…ˆæ‹¿å‡ºæ¥ä¸€ä¸ª\n            // ...\n            //å°è¯•è·å–tryAcquire,è¿™ä¸ªåŠ¨ä½œä¼šè§¦å‘sweepæ¸…æ‰«,å¦‚æœæœ‰åƒåœ¾è¢«å›æ”¶,è¿™é‡Œå°±ä¼šæˆåŠŸ\n            if s, ok := sl.tryAcquire(s); ok {\n                // ...\n                sweep.active.end(sl)\n                goto havespan//æˆåŠŸäº†é‚£ä¹ˆè·³è½¬ç»“å°¾\n            }\n            /-\n        // é€šè¿‡ sweepLockï¼ŒåŠ é”å°è¯•ä» mcentral çš„éç©ºé“¾è¡¨ full ä¸­è·å– mspan\n        for ; spanBudget &gt;= 0; spanBudget-- {\n            s = c.fullUnswept(sg).pop()//æ‹¿å‡ºä¸€ä¸ªåŸæœ¬æ»¡çš„\n           // ...\n           //å°è¯•æ¸…æ‰«\n            if s, ok := sl.tryAcquire(s); ok {\n                // ...\n                sweep.active.end(sl)\n                goto havespan//å¦‚æœè…¾å‡ºäº†ç©ºé—´é‚£ä¹ˆè·³è½¬ç»“å°¾\n                } \n                // ...\n            }\n        }\n        // ...\n    }//è¿™é‡Œå¦‚æœpartialå’Œfulléƒ½æ²¡è´§,ä¼šè°ƒç”¨c.growå‘mheapç”³è¯·æ–°çš„å†…å­˜é¡µ\n    // ...\n \n \n    // æ‰§è¡Œåˆ°æ­¤å¤„æ—¶ï¼Œs å·²ç»æŒ‡å‘ä¸€ä¸ªå­˜åœ¨ object ç©ºä½çš„ m0span äº†\nhavespan:\n    // ...\n    return\n}0\nsweeplocker\n\næ ¸å¿ƒ,cas(compare and swap) \nåŒé‡èº«ä»½éªŒè¯sweep.active\nä¸é˜»å¡\nè¿™ä¸ªbeginå’Œend,æ˜¯å¯¹å½“å‰pçš„æ¸…æ‰«çŠ¶æ€çš„æ³¨å†Œå’Œæ³¨é”€,ä¾¿äºæ›´æ–°å…¨å±€gcç»Ÿè®¡ä¿¡æ¯.\n\nmheapåˆ†é…\nå¦‚ä½•åœ¨ä¸€ä¸ªç¢ç‰‡åŒ–çš„å†…å­˜ç©ºé—´é‡Œ,å¿«é€Ÿæ‰¾åˆ°è¿ç»­çš„nä¸ªç©ºé—²é¡µ?\nfunc (c *mcentral) cacheSpan() *mspan {\n    // ...\n    // mcentral ä¸­ä¹Ÿæ²¡æœ‰å¯ç”¨çš„ mspan äº†ï¼Œåˆ™éœ€è¦ä» mheap ä¸­è·å–ï¼Œæœ€ç»ˆä¼šè°ƒç”¨ mheap_.alloc æ–¹æ³•\n    s = c.grow()\n   // ...\n \n \n    // æ‰§è¡Œåˆ°æ­¤å¤„æ—¶ï¼Œs å·²ç»æŒ‡å‘ä¸€ä¸ªå­˜åœ¨ object ç©ºä½çš„ mspan äº†\nhavespan:\n    // ...\n    return\n}\nfunc (c *mcentral) grow() *mspan {\n//è®¡ç®—è¿›è´§é‡\n// class_to_allocnpages æ˜¯ä¸€ä¸ªé¢„å®šä¹‰çš„æ•°ç»„ã€‚ \n// æ¯”å¦‚ï¼šä½ è¦ç”³è¯· sizeclass=3 çš„å¯¹è±¡ï¼ŒGo è§„å®šè¿™ç§è§„æ ¼çš„ Span ä¸€æ¬¡å¿…é¡»ç”³è¯· 1 é¡µã€‚ \n// å¦‚æœæ˜¯ sizeclass=40ï¼Œå¯èƒ½è§„å®šä¸€æ¬¡å¿…é¡»ç”³è¯· 5 é¡µã€‚\n//æ‰€ä»¥è¿™é‡Œå®é™…ä¸Šæ˜¯,æŠŠè§„æ ¼idæ¢ç®—æˆäº†å…·ä½“éœ€è¦å¤šå°‘ç‰©ç†é¡µæ•°.\n    npages := uintptr(class_to_allocnpages[c.spanclass.sizeclass()])\n    //è®¡ç®—æ€»å­—èŠ‚æ•°\n    size := uintptr(class_to_size[c.spanclass.sizeclass()])\n \n\t//å‘mheapä¸‹å•.è°ƒç”¨alloc,ä¼ å…¥éœ€è¦çš„ é¡µæ•°å’Œè§„æ ¼\n    s := mheap_.alloc(npages, c.spanclass)\n    // ...\n \n \n    // ...\n    return s\n}\nfunc (h *mheap) alloc(npages uintptr, spanclass spanClass) *mspan {\n    var s *mspan\n    //goä¼šå¼ºåˆ¶åˆ‡æ¢åˆ°g0ç³»ç»Ÿæ ˆæ¥å®è¡Œè¿™æ®µä»£ç ,æ˜¯mä¸“ç”¨çš„,ç©ºé—´å¤§å¹¶ä¸”å®‰å…¨\n    systemstack(func() {\n        // ...\n        //åœ¨ç³»ç»Ÿæ ˆä¸Šå®‰å…¨ğŸ‰è¿›è¡Œåˆ†é…é€»è¾‘\n        s = h.allocSpan(npages, spanAllocHeap, spanclass)\n    })\n    return s\n}\nfunc (h *mheap) allocSpan(npages uintptr, typ spanAllocType, spanclass spanClass) (s *mspan) {\n    gp := getg()\n    base, scav := uintptr(0), uintptr(0)\n    \n    // ...æ­¤å¤„å®é™…ä¸Šè¿˜æœ‰ä¸€é˜¶ç¼“å­˜ï¼Œæ˜¯ä»æ¯ä¸ª P çš„é¡µç¼“å­˜ pageCache ä¸­è·å–ç©ºé—²é¡µç»„è£… mspanï¼Œæ­¤å¤„å…ˆç•¥å»äº†...\n    \n    // åŠ ä¸Šå †å…¨å±€é”å› ä¸ºmheapæ˜¯å…¨å±€å”¯ä¸€çš„,æ‰€æœ‰péƒ½åœ¨æŠ¢å¤º.æ˜¯æ•´ä¸ªå†…å­˜åˆ†é…è·¯å¾„ä¸­é”ç«äº‰æœ€æ¿€çƒˆçš„åœ°æ–¹\n    lock(&amp;h.lock)\n    if base == 0 {\n        // é€šè¿‡åŸºæ•°æ ‘ç´¢å¼•å¿«é€Ÿå¯»æ‰¾æ»¡è¶³æ¡ä»¶çš„è¿ç»­ç©ºé—²é¡µ\n        //h.pageså°±æ˜¯åŸºæ•°æ ‘,åœ¨åŸºæ•°æ ‘ä¸Šè°ƒç”¨allocæ‰¾åˆ°è¿ç»­çš„npagesä¸ªç©ºé—²é¡µ\n        base, scav = h.pages.alloc(npages)\n        //å¦‚æœåŸºæ•°æ ‘ä¹Ÿæ‰¾ä¸åˆ°å†…å­˜äº†,è¿™é‡Œä¼šè§¦å‘growå»æ“ä½œç³»ç»Ÿçš„mmapè¦å†…å­˜\n        // ...\n    }\n    \n    // ...\n    unlock(&amp;h.lock)\n \n \nHaveSpan:\n    // æŠŠç©ºé—²é¡µç»„è£…æˆ mspan\n    //æ¯”å¦‚è®¾ç½®base npages nelemsç­‰ç­‰\n    s.init(base, npages)\n    \n    // å°†è¿™æ‰¹é¡µæ·»åŠ åˆ° heapArena ä¸­ï¼Œå»ºç«‹ç”±é¡µæŒ‡å‘ mspan çš„æ˜ å°„\n    //ä»¥å GC æ‰«æåˆ°ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘è¿™å—å†…å­˜æ—¶ï¼ŒæŸ¥ä¸€ä¸‹ heapArenaï¼Œå°±èƒ½ç«‹é©¬çŸ¥é“å®ƒå±äºå“ªä¸ª span\n    h.setSpans(s.base(), npages, s)\n    // ...\n    return s\n}```\n \n#### å‘æ“ä½œç³»ç»Ÿç”³è¯·\n//å› ä¸ºç³»ç»Ÿè°ƒç”¨å¾ˆè´µæ‰€ä»¥æ¯æ¬¡éƒ½é¢„è·å–å¤šä¸€ç‚¹\n```go\nfunc (h *mheap) grow(npage uintptr) (uintptr, bool) {\n// ask æ˜¯ç»è¿‡å¯¹é½è®¡ç®—åçš„å­—èŠ‚æ•°ã€‚\n    av, asize := h.sysAlloc(ask)\n}\n \n//**å«ä¹‰**ï¼šè¿™æ˜¯ä¸­é—´å±‚ï¼Œä¸»è¦è´Ÿè´£ç»´æŠ¤ä¸€äº›ç»Ÿè®¡ä¿¡æ¯ï¼ˆä»£ç ä¸­çœç•¥äº†ï¼‰ï¼Œå¹¶æŠŠå…·ä½“çš„â€œä¿ç•™å†…å­˜â€å·¥ä½œäº¤ç»™ `sysReserve`ã€‚\nfunc (h *mheap) sysAlloc(n uintptr) (v unsafe.Pointer, size uintptr) {\n       v = sysReserve(unsafe.Pointer(p), n)\n}\n \n//`sysReserve` æ˜¯ä¸€ä¸ªé€šç”¨æ¥å£ã€‚åœ¨ Linux ä¸‹å®ƒä¼šè°ƒç”¨ä¸‹é¢çš„ `sysReserveOS`ï¼Œåœ¨ Windows ä¸‹å®ƒä¼šè°ƒç”¨ `VirtualAlloc`ã€‚å®ƒå±è”½äº†åº•å±‚æ“ä½œç³»ç»Ÿçš„å·®å¼‚ã€‚\nfunc sysReserve(v unsafe.Pointer, n uintptr) unsafe.Pointer {\n    return sysReserveOS(v, n)\n}\n \nfunc sysReserveOS(v unsafe.Pointer, n uintptr) unsafe.Pointer {\n// mmap æ˜¯ Unix/Linux ç³»ç»Ÿä¸­æœ€å¸¸ç”¨çš„å†…å­˜æ˜ å°„ç³»ç»Ÿè°ƒç”¨ã€‚\n // å®ƒé€šå¸¸ç”¨äºæ–‡ä»¶æ˜ å°„ï¼Œä½†åŠ ä¸Šç‰¹å®šçš„å‚æ•°ï¼Œå°±å˜æˆäº†â€œç”³è¯·å †å†…å­˜â€ã€‚\n    p, err := mmap(v, n, _PROT_NONE, _MAP_ANON|_MAP_PRIVATE, -1, 0)\n    //v æœŸæœ›åœ°å€.å¦‚æœä¼ nil,å°±ä¼šéšä¾¿æ‰¾ä¸€å—ç©ºåœ°,å¦‚æœä¼ äº†å…·ä½“åœ°å€,å°±ä¼šå°½é‡æ»¡è¶³\n    //n ç”³è¯·å¤§å°\n    //PROT NONE æ²¡æœ‰ä»»ä½•æƒé™.è¿™å—å†…å­˜ç”³è¯·ä¸‹æ¥ä¹‹åæ²¡æœ‰ä»»ä½•æƒé™,è¿™æ˜¯ä¿ç•™,Go åœ¨è¿™é‡Œåªæ˜¯åœ¨æ“ä½œç³»ç»Ÿçš„â€œè´¦æœ¬â€ä¸ŠæŠŠè¿™å—è™šæ‹Ÿåœ°å€èŒƒå›´å ä½äº†ï¼Œé˜²æ­¢è¢«åˆ«äººç”¨äº†ã€‚ä½†æ­¤æ—¶ï¼Œè¿™å—å†…å­˜å®Œå…¨ä¸å ç”¨ç‰©ç† RAM.\n    //ç­‰åˆ°goçœŸçš„éœ€è¦ä½¿ç”¨è¿™å—åœ°å€çš„æ—¶å€™,å†è°ƒç”¨sysMapå‡½æ•°ä¿®æ”¹æƒé™,è¿™æ˜¯ä¸ºäº†èŠ‚çœç‰©ç†å†…å­˜\n    //_MAP_ANON|_MAP_PRIVATE åŒ¿åæ˜ å°„\\ç§æœ‰æ˜ å°„,è¯´æ˜è¿™å—å†…å­˜ä¸å¯¹åº”ç£ç›˜ä¸Šçš„ä»»ä½•æ–‡ä»¶,å°±æ˜¯çº¯ç²¹çš„RAMå †å†…å­˜.ç§æœ‰æ˜ å°„è¡¨ç¤ºè¿™å—å†…å­˜æ˜¯å½“å‰è¿›ç¨‹ç‹¬äº«çš„,ä¸ä¼šè·Ÿå…¶ä»–è¿›ç¨‹å…±äº«\n    //-1 æ–‡ä»¶æè¿°ç¬¦,å› ä¸ºåŒ¿åæ˜ å°„ä¸éœ€è¦æ–‡ä»¶,æ‰€ä»¥å†™1\n    //0 åŒ¿åæ˜ å°„æ— åç§»é‡,0\n    if err != 0 {\n        return nil\n    }\n    return p\n}\nåŸºæ•°æ ‘å¯»é¡µ\n//åœ¨ä¸€ä¸ªå·¨å¤§çš„å†…å­˜ç©ºé—´ä¸­ï¼Œé«˜æ•ˆåœ°æ‰¾åˆ° N ä¸ªè¿ç»­çš„ç©ºé—²é¡µã€‚\nsummaryæ˜¯ä¸€ä¸ªäº”å±‚é‡‘å­—å¡”ç»“æ„,L0æ¯ä¸ªåº—è¡¨ç¤ºå¾ˆå¤§çš„åŒºåŸŸ,L5ç›´æ¥å¯¹åº”å…·ä½“çš„å†…å­˜é¡µ.æ¯ä¸ªèŠ‚ç‚¹sumé‡Œé¢éƒ½ä¿å­˜äº†ä¸‰ä¸ªä¿¡æ¯,åœ¨è¿™ä¸€å¤§å—åŒºåŸŸé‡Œé¢\n\nstart å¼€å¤´æœ‰å¤šå°‘è¿ç»­ç©ºä½\nmax å†…éƒ¨æœ€å¤§æœ‰å¤šå°‘è¿ç»­ç©ºä½\nend ç»“å°¾æœ‰å¤šå°‘è¿ç»­ç©ºä½\n\nfunc (p *pageAlloc) find(npages uintptr) (uintptr, offAddr) {\n    // å¿…é¡»æŒæœ‰å †é”\n    assertLockHeld(p.mheapLock)\n \n \n    // current level.\n    i := 0\n \n \n    // ...\n    lastSum := packPallocSum(0, 0, 0)\n    lastSumIdx := -1\n \n \nnextLevel:\n    // 1 ~ 5 å±‚ä¾æ¬¡éå†\n    for l := 0; l &lt; len(p.summary); l++ {\n        // ...\n        // æ ¹æ®ä¸Šä¸€å±‚çš„ indexï¼Œæ˜ å°„åˆ°ä¸‹ä¸€å±‚çš„ index.\n        // æ˜ å°„å…³ç³»ç¤ºä¾‹ï¼šä¸Šå±‚ 0 -&gt; ä¸‹å±‚ [0~7]\n        //             ä¸Šå±‚ 1 -&gt; ä¸‹å±‚ [8~15]\n        //             ä»¥æ­¤ç±»æ¨\n        i &lt;&lt;= levelBits[l]//ç®—å‡ºæˆ‘çš„ä¸‹å±åœ¨ä¸‹ä¸€å¼ è¡¨é‡Œçš„èµ·å§‹è¡Œå·,å¦‚æœä¸€ä¸ªä¸Šå¸ç®¡ç†8ä¸ªä¸‹å±,é‚£ä¹ˆä¸Šå¸è¦å·¦ç§»3ä½,å¯ä»¥å¾—åˆ°ä¸‹å±çš„èµ·å§‹å·ç \n        entries := p.summary[l][i : i+entriesPerBlock]//æ‹¿å‡ºæ‰€æœ‰çš„ä¸‹å±æ”¾åˆ°entriesé‡Œé¢\n        // ...\n        // var levelBits = [summaryLevels]uint{\n        //   14,3,3,3,3\n        // }\n        // é™¤ç¬¬ä¸€å±‚æœ‰ 2^14 ä¸ªèŠ‚ç‚¹å¤–ï¼Œæ¥ä¸‹æ¥æ¯å±‚éƒ½åªè¦å…³å¿ƒ 8 ä¸ª èŠ‚ç‚¹.\n        // ç”±äºç¬¬ä¸€å±‚æœ‰ 2^14 ä¸ªèŠ‚ç‚¹ï¼Œæ‰€ä»¥ heap å†…å­˜ä¸Šé™ä¸º 2^14 * 16G = 256T\n        //ä¸€ä¸ªä¸€ä¸ªçœ‹è¿™äº›ä¸‹å±\n        var base, size uint\n        for j := j0; j &lt; len(entries); j++ {\n        \n            sum := entries[j]\n            // ...\n            // å€˜è‹¥å½“å‰èŠ‚ç‚¹å¯¹åº”å†…å­˜ç©ºé—´å¼€å¤´å³æ»¡è¶³ï¼Œç›´æ¥è¿”å›ç»“æœ\n            s := sum.start()\n            if size+s &gt;= uint(npages) {   //size:ç›´åˆ°è¿™ä¸€åˆ»ï¼Œæˆ‘æ‰‹é‡Œå·²ç»æ”’ç€çš„ã€ç´§æŒ¨ç€å½“å‰åŒºåŸŸå·¦è¾¹çš„ã€è¿ç»­ç©ºä½æ•°\n                if size == 0 {//ä¸éœ€è¦æ‹¼ä¸Šä¸€ä¸ªåŒºåŸŸçš„æ—¶å€™,èµ·ç‚¹å°±æ˜¯å½“å‰åŒºåŸŸçš„å¼€å¤´\n                    base = uint(j) &lt;&lt; logMaxPages//jæ˜¯å½“å‰æ‰«æåˆ°çš„å­åŒºåŸŸç´¢å¼•,æ¯”å¦‚ç¬¬ä¸‰ä¸ªå°åŒº.ç„¶ålogMaxPagesæ˜¯ä¸€ä¸ªå€ç‡è¡¨ç¤ºè¿™ä¸ªå°åŒºé‡Œé¢æœ‰å¤šå°‘é¡µ,æ‰€ä»¥base=j*å°åŒºå®¹é‡,\n                }             \n                size += s//è¿™å°±æ˜¯è®¡ç®—ä¸€ä¸‹æ€»å…±æ”’äº†å¤šå°‘,åæ­£åé¢breaké€€å‡ºå¾ªç¯äº†.\n                break\n            }\n            // å€˜è‹¥å½“å‰èŠ‚ç‚¹å¯¹åº”å†…å­˜ç©ºé—´é¦–éƒ¨ä¸æ»¡è¶³ï¼Œä½†æ˜¯å†…éƒ¨æœ€é•¿è¿ç»­é¡µæ»¡è¶³ï¼Œåˆ™åˆ°ä¸‹ä¸€å±‚èŠ‚ç‚¹å±•å¼€æœç´¢\n            if sum.max() &gt;= uint(npages) {               \n                i += j//æ›´æ–°ç´¢å¼•,å®šä½åˆ°è¿™ä¸ªå­åŒºåŸŸ i+j\n                lastSumIdx = i//\n                lastSum = sum\n                continue nextLevel //ç›´æ¥è·³åˆ°ä¸‹ä¸€å±‚å»æ‰¾.å› ä¸ºçŸ¥é“äº†æœ€å¤§çš„è¿ç»­ç©ºä½å°±æ˜¯æˆ‘ä»¬è¦çš„ æ‰€ä»¥æˆ‘ä»¬ç»§ç»­å¾€ä¸‹æ‰¾.\n            }\n            // å³ä¾¿å†…éƒ¨æœ€é•¿è¿ç»­é¡µä¸æ»¡è¶³ï¼Œè¿˜å¯ä»¥å°è¯•å°†å°¾éƒ¨ä¸ä¸‹ä¸ªèŠ‚ç‚¹çš„é¦–éƒ¨å åŠ ï¼Œçœ‹æ˜¯å¦æ»¡è¶³\n            if size == 0 || s &lt; 1&lt;&lt;logMaxPages {\n                                size = sum.end()\n                base = uint(j+1)&lt;&lt;logMaxPages - size //è®¡ç®—base\n                continue\n            }\n            // The entry is completely free, so continue the run.\n            size += 1 &lt;&lt; logMaxPages\n        }\n    \n    //**Go çš„å†…å­˜ç®¡ç†æ¶æ„**ï¼š Go çš„å †å†…å­˜ä¸æ˜¯å®Œå…¨è¿ç»­çš„ä¸€æ•´å—ï¼Œè€Œæ˜¯åˆ‡åˆ†æˆå¾ˆå¤šå·¨å¤§çš„å—ï¼Œå« **Chunk**ï¼ˆé€šå¸¸æ˜¯ 512MB ä¸€ä¸ªï¼‰ã€‚\n    \n    // æ ¹æ® i å’Œ j å¯ä»¥æ¨å¯¼å¾—åˆ°å¯¹åº”çš„å†…å­˜åœ°å€ï¼Œè¿›è¡Œè¿”å›\n    //æ ¹æ®æˆ‘ä»¬åœ¨æ ‘é‡Œçš„ç´¢å¼• `i`ï¼Œç®—å‡ºè¿™å—åœ°çš®å±äº**ç¬¬å‡ ä¸ª Chunk**\n    ci := chunkIdx(i)\n    //å»æŸ¥è¡¨ï¼Œé—®ç¬¬ 5 å· Chunk åœ¨å†…å­˜é‡Œçš„**çœŸå®é¦–åœ°å€**æ˜¯å¤šå°‘ï¼Ÿå†åŠ ä¸ŠçœŸå®çš„é¡µåç§»\n    addr := chunkBase(ci) + uintptr(j)*pageSize\n    // ...\n    return addr, p.findMappedAddr(firstFree.base)\n}"},"æŠ€æœ¯ç§¯ç´¯/Golang/æ ¸å¿ƒçŸ¥è¯†/05-GCåƒåœ¾å›æ”¶åŸç†":{"slug":"æŠ€æœ¯ç§¯ç´¯/Golang/æ ¸å¿ƒçŸ¥è¯†/05-GCåƒåœ¾å›æ”¶åŸç†","filePath":"æŠ€æœ¯ç§¯ç´¯/Golang/æ ¸å¿ƒçŸ¥è¯†/05 GCåƒåœ¾å›æ”¶åŸç†.md","title":"05 GCåƒåœ¾å›æ”¶åŸç†","links":["æŠ€æœ¯ç§¯ç´¯/Golang/æ ¸å¿ƒçŸ¥è¯†/05-GCåƒåœ¾å›æ”¶åŸç†"],"tags":[],"content":"åƒåœ¾å›æ”¶ç®—æ³•\nèƒŒæ™¯ä»‹ç»\nåƒåœ¾å›æ”¶ï¼ˆGarbage Collectionï¼Œç®€ç§° GCï¼‰æ˜¯ä¸€ç§å†…å­˜ç®¡ç†ç­–ç•¥ï¼Œç”±åƒåœ¾æ”¶é›†å™¨ä»¥ç±»ä¼¼å®ˆæŠ¤åç¨‹çš„æ–¹å¼åœ¨åå°è¿ä½œï¼ŒæŒ‰ç…§æ—¢å®šçš„ç­–ç•¥ä¸ºç”¨æˆ·å›æ”¶é‚£äº›ä¸å†è¢«ä½¿ç”¨çš„å¯¹è±¡ï¼Œé‡Šæ”¾å¯¹åº”çš„å†…å­˜ç©ºé—´.\n\nGC å¸¦æ¥çš„ä¼˜åŠ¿åŒ…æ‹¬ï¼š\n\nå±è”½å†…å­˜å›æ”¶çš„ç»†èŠ‚\n\næ‹¥æœ‰ GC èƒ½åŠ›çš„è¯­è¨€èƒ½å¤Ÿä¸ºç”¨æˆ·å±è”½å¤æ‚çš„å†…å­˜ç®¡ç†å·¥ä½œï¼Œä½¿ç”¨æˆ·æ›´å¥½åœ°èšç„¦äºæ ¸å¿ƒçš„ä¸šåŠ¡é€»è¾‘.\n\n\nä»¥å…¨å±€è§†é‡æ‰§è¡Œä»»åŠ¡\n\nç°ä»£è½¯ä»¶å·¥ç¨‹é¡¹ç›®ä½“é‡ä¸æ—¥å‰§å¢ï¼Œä¸€ä¸ªé¡¹ç›®é€šå¸¸ç”±å›¢ä½“åä½œå®Œæˆï¼Œç ”å‘äººå‘˜è´Ÿè´£å„è‡ªæ¨¡å—çš„åŒæ—¶ï¼Œä¸å¯é¿å…ä¼šæ¶‰åŠåˆ°ä¸´ç•Œèµ„æºçš„ä½¿ç”¨. æ­¤æ—¶ç”±äºç¼ºä¹å…¨å±€çš„è§†é‡ï¼Œæ‰‹åŠ¨å¯¹å†…å­˜è¿›è¡Œç®¡ç†æ— ç–‘ä¼šå¢åŠ å¼€å‘è€…çš„å¿ƒæ™ºè´Ÿæ‹…. å› æ­¤ï¼Œå°†è¿™éƒ¨åˆ†å·¥ä½œå§”æ‰˜ç»™æ‹¥æœ‰å…¨å±€è§†é‡çš„åƒåœ¾å›æ”¶æ¨¡å—æ¥å®Œæˆï¼Œæ–¹ä¸ºä¸Šä¸Šä¹‹ç­–.\n\n\n\n\nGC å¸¦æ¥çš„åŠ£åŠ¿ï¼š\n\næé«˜äº†ä¸‹é™ä½†é™ä½äº†ä¸Šé™\n\nå°†é‡Šæ”¾å†…å­˜çš„å·¥ä½œå§”æ‰˜ç»™åƒåœ¾å›æ”¶æ¨¡å—ï¼Œç ”å‘äººå‘˜å¾—åˆ°äº†å‡è´Ÿï¼Œä½†åŒæ—¶ä¹Ÿå¤±å»äº†æ§åˆ¶ä¸»æƒ. é™¤äº†è¿ç”¨æœ‰é™çš„GCè°ƒä¼˜å‚æ•°å¤–ï¼Œæ›´å¤šçš„è‡ªç”±åº¦éƒ½è¢«é˜‰å‰²ï¼Œéœ€è¦å‘ç³»ç»Ÿçœ‹é½ï¼Œæœä»è®¾å®š.\n\n\nå¢åŠ äº†é¢å¤–çš„æˆæœ¬\n\nå…¨å±€çš„åƒåœ¾å›æ”¶æ¨¡å—åŒ–é›¶ä¸ºæ•´ï¼Œä¼šéœ€è¦é¢å¤–çš„çŠ¶æ€ä¿¡æ¯ç”¨ä»¥å­˜å‚¨å…¨å±€çš„å†…å­˜ä½¿ç”¨æƒ…å†µ. ä¸”éƒ¨åˆ†æ—¶é—´éœ€è¦ä¸­æ–­æ•´ä¸ªç¨‹åºç”¨ä»¥æ”¯æŒåƒåœ¾å›æ”¶å·¥ä½œçš„æ‰§è¡Œï¼Œè¿™äº›éƒ½æ˜¯GCé¢å¤–äº§ç”Ÿçš„æˆæœ¬.\n\n\n\n\nGC çš„æ€»ä½“è¯„ä»·\n\né™¤å¼€å°‘é‡è¿½æ±‚æè‡´é€Ÿåº¦çš„ç‰¹æ®Šå°è§„æ¨¡é¡¹ç›®ä¹‹å¤–ï¼Œåœ¨ç»å¤§å¤šæ•°é«˜å¹¶å‘é¡¹ç›®ä¸­ï¼ŒGCæ¨¡å—éƒ½ä¸ºæˆ‘ä»¬å¸¦æ¥äº†æå¤§çš„è£¨ç›Šï¼Œå·²ç»æˆä¸ºä¸€é¡¹ä¸å¯æˆ–ç¼ºçš„èƒ½åŠ›.\n\n\n\nä¸‹é¢å¯¹å‡ ç±»ç»å…¸çš„åƒåœ¾å›æ”¶ç®—æ³•è¿›è¡Œä»‹ç»\næ ‡è®°æ¸…æ‰«Mark-Sweepç®—æ³•\n\n\nè“è‰² æ˜¯è¿˜éœ€è¦ä½¿ç”¨çš„å˜é‡\næ©™è‰² æ˜¯å·²ç»ä¸ä½¿ç”¨äº†ä½†æ˜¯æˆ¿é—´è¿˜æ²¡æ‰“æ‰«\nç™½è‰² æ˜¯æ‰“æ‰«å¹²å‡€çš„ç©ºæˆ¿é—´\n\n\næ ‡è®°å‡ºè“è‰²å¯¹è±¡\næ¸…æ‰«æ‰æœªè¢«æ ‡è®°åˆ°çš„åƒåœ¾å¯¹è±¡:æ©™è‰²å˜ç™½äº†\n\nç¼ºç‚¹:ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡. ç»è¿‡å‡ è½®æ ‡è®°æ¸…æ‰«ä¹‹åï¼Œç©ºé—²çš„å†…å­˜å—å¯èƒ½é›¶æ˜Ÿç¢ç‰‡åŒ–åˆ†å¸ƒï¼Œæ­¤æ—¶å€˜è‹¥æœ‰å¤§å¯¹è±¡éœ€è¦åˆ†é…å†…å­˜ï¼Œå¯èƒ½ä¼šå› ä¸ºå†…å­˜ç©ºé—´æ— æ³•åŒ–é›¶ä¸ºæ•´ä»è€Œå¯¼è‡´åˆ†é…å¤±è´¥.\næ ‡è®°å‹ç¼©Mark-Compactç®—æ³•\n\nåœ¨ç¬¬äºŒæ­¥â€æ¸…æ‰«â€œçš„åŒæ—¶è¿˜ä¼šå¯¹å­˜æ´»å¯¹è±¡è¿›è¡Œå‹ç¼©æ•´åˆï¼Œä½¿å¾—æ•´ä½“ç©ºé—´æ›´ä¸ºç´§å‡‘ï¼Œä»è€Œè§£å†³å†…å­˜ç¢ç‰‡é—®é¢˜\næ ‡è®°å‹ç¼©ç®—æ³•åœ¨åŠŸèƒ½æ€§ä¸Šå‘ˆç°å¾—å¾ˆå‡ºè‰²ï¼Œè€Œå…¶å­˜åœ¨çš„ç¼ºé™·ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯å®ç°æ—¶ä¼šæœ‰å¾ˆé«˜çš„å¤æ‚åº¦.\nåŠç©ºé—´å¤åˆ¶Semispace Copy\n\n\nåˆ†é…ä¸¤ç‰‡ç›¸ç­‰å¤§å°çš„ç©ºé—´ï¼Œç§°ä¸º fromspace å’Œ tospace\næ¯è½®åªä½¿ç”¨ fromspace ç©ºé—´ï¼Œä»¥GCä½œä¸ºåˆ†æ°´å²­åˆ’åˆ†è½®æ¬¡\nGCæ—¶ï¼Œå°†fromspaceå­˜æ´»å¯¹è±¡è½¬ç§»åˆ°tospaceä¸­.é‚£ä¹ˆfromspaceé‡Œé¢åªå‰©ä¸‹åƒåœ¾äº†,å¯ä»¥ä¸€å£æ°”æ¸…ç©º.\nGCåï¼Œäº¤æ¢fromspaceå’Œtospaceï¼Œå¼€å¯æ–°çš„è½®æ¬¡\n\næ˜¾ç„¶ï¼ŒåŠç©ºé—´å¤åˆ¶ç®—æ³•åº”ç”¨äº†ä»¥ç©ºé—´æ¢å–æ—¶é—´çš„ä¼˜åŒ–ç­–ç•¥ï¼Œè§£å†³äº†å†…å­˜ç¢ç‰‡çš„é—®é¢˜ï¼Œä¹Ÿåœ¨ä¸€å®šç¨‹åº¦ä¸Šé™ä½äº†å‹ç¼©ç©ºé—´çš„å¤æ‚åº¦. ä½†å…¶ç¼ºç‚¹ä¹ŸåŒæ ·å¾ˆæ˜æ˜¾â€”â€”æ¯”è¾ƒæµªè´¹ç©ºé—´.\nå¼•ç”¨è®¡æ•°Reference Counting\n\nå¯¹è±¡æ¯è¢«å¼•ç”¨ä¸€æ¬¡ï¼Œè®¡æ•°å™¨åŠ 1\nå¯¹è±¡æ¯è¢«åˆ é™¤å¼•ç”¨ä¸€æ¬¡ï¼Œè®¡æ•°å™¨å‡1\nGCæ—¶ï¼ŒæŠŠè®¡æ•°å™¨ç­‰äº 0 çš„å¯¹è±¡åˆ é™¤\nç„¶è€Œï¼Œè¿™ä¸ªæœ´ç´ çš„ç®—æ³•å­˜åœ¨ä¸€ä¸ªè‡´å‘½çš„ç¼ºé™·ï¼šæ— æ³•è§£å†³å¾ªç¯å¼•ç”¨(åªæœ‰ä¸¤ä¸ªå¯¹è±¡åœ¨äº’ç›¸å¼•ç”¨,ä½†æ˜¯å®é™…ä¸Šä¸¤ä¸ªäººéƒ½ä¸è¢«å¤§éƒ¨é˜Ÿéœ€è¦äº†)æˆ–è€…è‡ªå¼•ç”¨(æ²¡æœ‰åˆ«äººéœ€è¦äº†,ä½†æ˜¯ä¸€ç›´æ— æ³•è¢«å›æ”¶)é—®é¢˜.\n\ngolangä¸­çš„åƒåœ¾å›æ”¶\nGolang åœ¨ 1.8ç‰ˆæœ¬ä¹‹åï¼ŒGCç­–ç•¥æ¡†æ¶å·²ç»å¥ å®šï¼Œå°±æ˜¯å¹¶å‘ä¸‰è‰²æ ‡è®°æ³•+æ··åˆå†™å±éšœæœºåˆ¶\nä¸‰è‰²æ ‡è®°æ³•\n\nGolang GC ä¸­ç”¨åˆ°çš„ä¸‰è‰²æ ‡è®°æ³•å±äºæ ‡è®°æ¸…æ‰«-ç®—æ³•ä¸‹çš„ä¸€ç§å®ç°ï¼Œç”±è·å…°çš„è®¡ç®—æœºç§‘å­¦å®¶ Dijkstra æå‡ºï¼Œä¸‹é¢é˜è¿°è¦ç‚¹ï¼š\n\n\n                  \n                  åŸºæœ¬æ¦‚å¿µ \n                  \n                \n\nå­˜æ´»: GCå¼€å§‹æ—¶,æœ‰ä¸€ç»„æ ¹å¯¹è±¡roots,æ¯”å¦‚å…¨å±€å˜é‡,å½“å‰æ­£åœ¨è¿è¡Œçš„å‡½æ•°æ ˆé‡Œçš„å˜é‡ç­‰.åªè¦èƒ½é¡ºç€ç®­å¤´,ä»rootä¸€è·¯é¡ºè—¤æ‘¸ç“œæ‰¾åˆ°çš„,å°±ç®—æ˜¯å­˜æ´»\næŒ‡å‘:å°±æ˜¯æŒ‡é’ˆå¼•ç”¨.è€Œä¸”æ˜¯è¡¨å±‚çš„æŒ‡é’ˆå¼•ç”¨,ä¸ä¼šä¸€ç›´dfsä¸‹å»\n\n\n\nå¯¹è±¡åˆ†ä¸ºä¸‰ç§é¢œè‰²æ ‡è®°ï¼šé»‘ã€ç°ã€ç™½\né»‘å¯¹è±¡ä»£è¡¨ï¼Œå¯¹è±¡è‡ªèº«å­˜æ´»ï¼Œä¸”å…¶æŒ‡å‘å¯¹è±¡éƒ½å·²æ ‡è®°å®Œæˆ\nç°å¯¹è±¡ä»£è¡¨ï¼Œå¯¹è±¡è‡ªèº«å­˜æ´»ï¼Œä½†å…¶æŒ‡å‘å¯¹è±¡è¿˜æœªæ ‡è®°å®Œæˆ\nç™½å¯¹è±¡ä»£è¡¨ï¼Œå¯¹è±¡å°™æœªè¢«æ ‡è®°åˆ°ï¼Œå¯èƒ½æ˜¯åƒåœ¾å¯¹è±¡\næ ‡è®°å¼€å§‹å‰ï¼Œå°†æ ¹å¯¹è±¡ï¼ˆå…¨å±€å¯¹è±¡ã€æ ˆä¸Šå±€éƒ¨å˜é‡ç­‰ï¼‰ç½®é»‘ï¼Œå°†å…¶æ‰€æŒ‡å‘çš„å¯¹è±¡ç½®ç°\næ ‡è®°è§„åˆ™æ˜¯ï¼Œä»ç°å¯¹è±¡å‡ºå‘ï¼Œå°†å…¶æ‰€æŒ‡å‘çš„å¯¹è±¡éƒ½ç½®ç°. æ‰€æœ‰æŒ‡å‘å¯¹è±¡éƒ½ç½®ç°åï¼Œå½“å‰ç°å¯¹è±¡ç½®é»‘\næ ‡è®°ç»“æŸåï¼Œç™½è‰²å¯¹è±¡å°±æ˜¯ä¸å¯è¾¾çš„åƒåœ¾å¯¹è±¡ï¼Œéœ€è¦è¿›è¡Œæ¸…æ‰«.\n\nå¹¶å‘åƒåœ¾å›æ”¶\n\nGolang 1.5 ç‰ˆæœ¬æ˜¯ä¸ªåˆ†æ°´å²­ï¼Œåœ¨æ­¤ä¹‹å‰ï¼ŒGCæ—¶éœ€è¦åœæ­¢å…¨å±€çš„ç”¨æˆ·åç¨‹ï¼Œä¸“æ³¨å®ŒæˆGCå·¥ä½œåï¼Œå†æ¢å¤ç”¨æˆ·åç¨‹ï¼Œè¿™æ ·åšåœ¨å®ç°ä¸Šç®€å•ç›´è§‚ï¼Œä½†æ˜¯ä¼šå¯¹ç”¨æˆ·é€ æˆä¸å¥½çš„ä½“éªŒ.\n\nè‡ª1.5ç‰ˆæœ¬ä»¥æ¥ï¼ŒGolangå¼•å…¥äº†å¹¶å‘åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œå…è®¸ç”¨æˆ·åç¨‹å’Œåå°çš„GCåç¨‹å¹¶å‘è¿è¡Œï¼Œå¤§å¤§åœ°æé«˜äº†ç”¨æˆ·ä½“éªŒ. ä½†â€œå¹¶å‘â€æ˜¯ä¸€ä¸ªå€¼å¾—å¤§å®¶è­¦æƒ•çš„å­—çœ¼. ç”¨æˆ·åç¨‹è¿è¡Œæ—¶å¯èƒ½å¯¹å¯¹è±¡é—´çš„å¼•ç”¨å…³ç³»è¿›è¡Œè°ƒæ•´ï¼Œè¿™ä¼šä¸¥é‡æ‰“ä¹±GCä¸‰è‰²æ ‡è®°æ—¶çš„æ ‡è®°ç§©åº.\nå‡ ä¸ªé—®é¢˜\ngolangå¹¶å‘åƒåœ¾å›æ”¶å¯èƒ½å­˜åœ¨æ¼æ ‡é—®é¢˜\nåœ¨ç”¨æˆ·åç¨‹ä¸GCåç¨‹å¹¶å‘æ‰§è¡Œçš„åœºæ™¯ä¸‹ï¼Œéƒ¨åˆ†å­˜æ´»å¯¹è±¡æœªè¢«æ ‡è®°ä»è€Œè¢«è¯¯åˆ çš„æƒ…å†µ\n\n\næ¡ä»¶ï¼šåˆå§‹æ—¶åˆ»ï¼Œå¯¹è±¡BæŒæœ‰å¯¹è±¡Cçš„å¼•ç”¨\n\n\nmoment1ï¼šGCåç¨‹ä¸‹ï¼Œå¯¹è±¡Aè¢«æ‰«æå®Œæˆï¼Œç½®é»‘ï¼›æ­¤æ—¶å¯¹è±¡Bæ˜¯ç°è‰²ï¼Œè¿˜æœªå®Œæˆæ‰«æ\n\n\nmomen2ï¼šç”¨æˆ·åç¨‹ä¸‹ï¼Œå¯¹è±¡Aå»ºç«‹æŒ‡å‘å¯¹è±¡Cçš„å¼•ç”¨\n\n\nmoment3ï¼šç”¨æˆ·åç¨‹ä¸‹ï¼Œå¯¹è±¡Båˆ é™¤æŒ‡å‘å¯¹è±¡Cçš„å¼•ç”¨\n\n\nmoment4ï¼šGCåç¨‹ä¸‹ï¼Œå¼€å§‹æ‰§è¡Œå¯¹å¯¹è±¡Bçš„æ‰«æ\n\n\nç”±äºGCåç¨‹åœ¨Båˆ é™¤Cçš„å¼•ç”¨åæ‰å¼€å§‹æ‰«æBï¼Œå› æ­¤æ— æ³•åˆ°è¾¾C. åˆå› ä¸ºAå·²ç»è¢«ç½®é»‘ï¼Œä¸ä¼šå†é‡å¤æ‰«æï¼Œå› æ­¤ä»æ‰«æç»“æœä¸Šçœ‹ï¼ŒCæ˜¯ä¸å¯è¾¾çš„.\n\n\nç„¶è€Œäº‹å®ä¸Šï¼ŒCåº”è¯¥æ˜¯å­˜æ´»çš„ï¼ˆè¢«Aå¼•ç”¨ï¼‰ï¼Œè€ŒGCç»“æŸåä¼šå› ä¸ºCä»ä¸ºç™½è‰²ï¼Œå› æ­¤è¢«GCè¯¯åˆ .\n\n\né’ˆå¯¹è¿™ä¸ªé—®é¢˜ å±éšœæœºåˆ¶å¯ä»¥è§£å†³ã€‚\ngolangå¹¶å‘åƒåœ¾å›æ”¶å¯èƒ½å­˜åœ¨å¤šæ ‡é—®é¢˜\nåœ¨ç”¨æˆ·åç¨‹ä¸GCåç¨‹å¹¶å‘æ‰§è¡Œçš„åœºæ™¯ä¸‹ï¼Œéƒ¨åˆ†åƒåœ¾å¯¹è±¡è¢«è¯¯æ ‡è®°ä»è€Œå¯¼è‡´GCæœªæŒ‰æ—¶å°†å…¶å›æ”¶çš„é—®é¢˜\n\næ¡ä»¶ï¼šåˆå§‹æ—¶åˆ»ï¼Œå¯¹è±¡AæŒæœ‰å¯¹è±¡Bçš„å¼•ç”¨\nmoment1ï¼šGCåç¨‹ä¸‹ï¼Œå¯¹è±¡Aè¢«æ‰«æå®Œæˆï¼Œç½®é»‘ï¼›å¯¹è±¡Bè¢«å¯¹è±¡Aå¼•ç”¨ï¼Œå› æ­¤è¢«ç½®ç°\nmomen2ï¼šç”¨æˆ·åç¨‹ä¸‹ï¼Œå¯¹è±¡Aåˆ é™¤æŒ‡å‘å¯¹è±¡Bçš„å¼•ç”¨\n\nä¸Šè¿°åœºæ™¯å¼•å‘çš„é—®é¢˜æ˜¯ï¼Œåœ¨äº‹å®ä¸Šï¼ŒBåœ¨è¢«Aåˆ é™¤å¼•ç”¨åï¼Œå·²æˆä¸ºåƒåœ¾å¯¹è±¡ï¼Œä½†ç”±äºå…¶äº‹å…ˆå·²è¢«ç½®ç°ï¼Œå› æ­¤æœ€ç»ˆä¼šæ›´æ–°ä¸ºé»‘è‰²ï¼Œä¸ä¼šè¢«GCåˆ é™¤.\né”™æ ‡é—®é¢˜å¯¹æ¯”äºæ¼æ ‡é—®é¢˜è€Œè¨€ï¼Œæ˜¯ç›¸å¯¹å¯ä»¥æ¥å—çš„. å…¶å¯¼è‡´æœ¬è¯¥è¢«åˆ ä½†ä»ä¾¥å¹¸å­˜æ´»çš„å¯¹è±¡è¢«ç§°ä¸ºâ€œæµ®åŠ¨åƒåœ¾â€ï¼Œè‡³å¤šåˆ°ä¸‹ä¸€è½®GCï¼Œè¿™éƒ¨åˆ†å¯¹è±¡å°±ä¼šè¢«GCå›æ”¶ï¼Œå› æ­¤é”™è¯¯å¯ä»¥å¾—åˆ°å¼¥è¡¥.\nGolang åƒåœ¾å›æ”¶å¦‚ä½•è§£å†³å†…å­˜ç¢ç‰‡é—®é¢˜\næ ‡è®°æ¸…æ‰«ç®—æ³•ä¼šå­˜åœ¨äº§ç”Ÿâ€œå†…å­˜ç¢ç‰‡â€çš„ç¼ºé™·\nGolangé‡‡ç”¨ TCMalloc æœºåˆ¶ï¼Œä¾æ®å¯¹è±¡çš„å¤§å°å°†å…¶å½’å±ä¸ºåˆ°äº‹å…ˆåˆ’åˆ†å¥½çš„spanClasså½“ä¸­ï¼Œè¿™æ ·èƒ½å¤Ÿæ¶ˆè§£å¤–éƒ¨ç¢ç‰‡çš„é—®é¢˜ï¼Œå°†é—®é¢˜é™åˆ¶åœ¨ç›¸å¯¹å¯æ§çš„å†…éƒ¨ç¢ç‰‡å½“ä¸­\nåŸºäºæ­¤ï¼ŒGolangé€‰æ‹©é‡‡ç”¨å®ç°ä¸Šæ›´ä¸ºç®€å•çš„æ ‡è®°æ¸…æ‰«ç®—æ³•ï¼Œé¿å…ä½¿ç”¨å¤æ‚åº¦æ›´é«˜çš„æ ‡è®°å‹ç¼©ç®—æ³•ï¼Œå› ä¸ºåœ¨ TCMalloc æ¡†æ¶ä¸‹ï¼Œåè€…å¸¦æ¥çš„ä¼˜åŠ¿å·²ç»ä¸å†æ˜æ˜¾.\nGolangä¸ºä»€ä¹ˆä¸é€‰æ‹©åˆ†ä»£åƒåœ¾å›æ”¶æœºåˆ¶\nåˆ†ä»£ç®—æ³•æŒ‡çš„æ˜¯ï¼Œå°†å¯¹è±¡åˆ†ä¸ºå¹´è½»ä»£å’Œè€å¹´ä»£ä¸¤éƒ¨åˆ†ï¼ˆæˆ–è€…æ›´å¤šï¼‰é‡‡ç”¨ä¸åŒçš„GCç­–ç•¥è¿›è¡Œåˆ†ç±»ç®¡ç†. åˆ†ä»£GCç®—æ³•æœ‰æ•ˆçš„å‰ææ˜¯ï¼Œç»å¤§å¤šæ•°å¹´è½»ä»£å¯¹è±¡éƒ½æ˜¯æœç”Ÿå¤•æ­»ï¼Œæ‹¥æœ‰æ›´é«˜çš„GCå›æ”¶ç‡ï¼Œå› æ­¤é€‚åˆé‡‡ç”¨ç‰¹åˆ«çš„ç­–ç•¥è¿›è¡Œå¤„ç†.\nç„¶è€ŒGolangä¸­å­˜åœ¨å†…å­˜é€ƒé€¸æœºåˆ¶ï¼Œä¼šåœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­å°†ç”Ÿå‘½å‘¨æœŸæ›´é•¿çš„å¯¹è±¡è½¬ç§»åˆ°å †ä¸­ï¼Œå°†ç”Ÿå‘½å‘¨æœŸçŸ­çš„å¯¹è±¡åˆ†é…åœ¨æ ˆä¸Šï¼Œå¹¶ä»¥æ ˆä¸ºå•ä½å¯¹è¿™éƒ¨åˆ†å¯¹è±¡è¿›è¡Œå›æ”¶.\nç»¼ä¸Šï¼Œå†…å­˜é€ƒé€¸æœºåˆ¶å‡å¼±äº†åˆ†ä»£ç®—æ³•å¯¹Golang GCæ‰€å¸¦æ¥çš„ä¼˜åŠ¿ï¼Œè€ƒè™‘åˆ†ä»£ç®—æ³•éœ€è¦äº§ç”Ÿé¢å¤–çš„æˆæœ¬ï¼ˆå¦‚ä¸åŒå¹´ä»£çš„è§„åˆ™æ˜ å°„ã€çŠ¶æ€ç®¡ç†ä»¥åŠé¢å¤–çš„å†™å±éšœï¼‰Golang é€‰æ‹©ä¸é‡‡ç”¨åˆ†ä»£GCç®—æ³•.\nå±éšœæœºåˆ¶\nä¸»è¦å°±æ˜¯ä¸ºäº†è§£å†³æ¼æ ‡é—®é¢˜\nå¼ºå¼±ä¸‰è‰²ä¸å˜å¼\næ¼æ ‡é—®é¢˜çš„æœ¬è´¨å°±æ˜¯ï¼Œä¸€ä¸ªå·²ç»æ‰«æå®Œæˆçš„é»‘å¯¹è±¡æŒ‡å‘äº†ä¸€ä¸ªè¢«ç°\\ç™½å¯¹è±¡åˆ é™¤å¼•ç”¨çš„ç™½è‰²å¯¹è±¡. æ„æˆè¿™ä¸€åœºæ™¯çš„è¦ç´ æ‹†åˆ†å¦‚ä¸‹ï¼š\nï¼ˆ1ï¼‰é»‘è‰²å¯¹è±¡æŒ‡å‘äº†ç™½è‰²å¯¹è±¡\nï¼ˆ2ï¼‰ç°ã€ç™½å¯¹è±¡åˆ é™¤äº†ç™½è‰²å¯¹è±¡\nï¼ˆ3ï¼‰12æ­¥ä¸­è°ˆåŠçš„ç™½è‰²å¯¹è±¡æ˜¯åŒä¸€ä¸ªå¯¹è±¡\nï¼ˆ4ï¼‰1å‘ç”Ÿåœ¨2ä¹‹å‰\nä¸€å¥—ç”¨äºè§£å†³æ¼æ ‡é—®é¢˜çš„æ–¹æ³•è®ºç§°ä¹‹ä¸ºå¼ºå¼±ä¸‰è‰²ä¸å˜å¼ï¼š\n\nå¼ºä¸‰è‰²ä¸å˜å¼ï¼šç™½è‰²å¯¹è±¡ä¸èƒ½è¢«é»‘è‰²å¯¹è±¡ç›´æ¥å¼•ç”¨ï¼ˆç›´æ¥ç ´å1ï¼‰\n\nå½“ä½ çš„ä»£ç è¯•å›¾æ‰§è¡Œ A.next = Cï¼ˆAé»‘ï¼ŒCç™½ï¼‰æ—¶ï¼Œå¼ºåˆ¶æŠŠ C æ¶‚æˆç°è‰²\n\n\nå¼±ä¸‰è‰²ä¸å˜å¼ï¼šç™½è‰²å¯¹è±¡å¯ä»¥è¢«é»‘è‰²å¯¹è±¡å¼•ç”¨ï¼Œä½†è¦ä»æŸä¸ªç°å¯¹è±¡å‡ºå‘ä»ç„¶å¯è¾¾è¯¥ç™½å¯¹è±¡ï¼ˆé—´æ¥ç ´åäº†1ã€2çš„è”åŠ¨ï¼‰\n\nè¯•å›¾æ‰§è¡Œ B.next = nilï¼ˆåˆ‡æ–­ç° B å¯¹ç™½ C çš„å¼•ç”¨ï¼‰æ—¶ï¼Œæˆ‘å¼ºåˆ¶æŠŠ C æ¶‚æˆç°è‰²\n\n\n\næ’å…¥å†™å±éšœ\nå±éšœæœºåˆ¶ç±»ä¼¼äºä¸€ä¸ªå›è°ƒä¿æŠ¤æœºåˆ¶ï¼ŒæŒ‡çš„æ˜¯åœ¨å®ŒæˆæŸä¸ªç‰¹å®šåŠ¨ä½œå‰ï¼Œä¼šå…ˆå®Œæˆå±éšœæˆè®¾ç½®çš„å†…å®¹.\næ’å…¥å†™å±éšœï¼ˆDijkstraï¼‰çš„ç›®æ ‡æ˜¯å®ç°å¼ºä¸‰è‰²ä¸å˜å¼ï¼Œä¿è¯å½“ä¸€ä¸ªé»‘è‰²å¯¹è±¡æŒ‡å‘ä¸€ä¸ªç™½è‰²å¯¹è±¡å‰ï¼Œä¼šå…ˆè§¦å‘å±éšœå°†ç™½è‰²å¯¹è±¡ç½®ä¸ºç°è‰²ï¼Œå†å»ºç«‹å¼•ç”¨.\nå¦‚æœæ‰€æœ‰æµç¨‹éƒ½èƒ½ä¿è¯åšåˆ°è¿™ä¸€ç‚¹ï¼Œé‚£ä¹ˆ 3.1 å°èŠ‚ä¸­çš„ï¼ˆ1ï¼‰å°±ä¼šè¢«ç ´åï¼Œæ¼æ ‡é—®é¢˜å¾—ä»¥è§£å†³.\nåˆ é™¤å†™å±éšœ\nåˆ é™¤å†™å±éšœï¼ˆYuasa barrierï¼‰çš„ç›®æ ‡æ˜¯å®ç°å¼±ä¸‰è‰²ä¸å˜å¼ï¼Œä¿è¯å½“ä¸€ä¸ªç™½è‰²å¯¹è±¡å³å°†è¢«ä¸Šæ¸¸åˆ é™¤å¼•ç”¨å‰ï¼Œä¼šè§¦å‘å±éšœå°†å…¶ç½®ç°ï¼Œä¹‹åå†åˆ é™¤ä¸Šæ¸¸æŒ‡å‘å…¶çš„å¼•ç”¨.\nè¿™ä¸€æµç¨‹ä¸­ï¼Œ3.1å°èŠ‚çš„æ­¥éª¤ï¼ˆ2ï¼‰ä¼šè¢«ç ´åï¼Œæ¼æ ‡é—®é¢˜å¾—ä»¥è§£å†³.\næ··åˆå†™å±éšœ\næ’å…¥å†™å±éšœã€åˆ é™¤å†™å±éšœäºŒè€…æ‹©å…¶ä¸€ï¼Œå³å¯è§£å†³å¹¶å‘GCçš„æ¼æ ‡é—®é¢˜ï¼Œè‡³äºé”™æ ‡é—®é¢˜ï¼Œåˆ™é‡‡ç”¨å®¹å¿æ€åº¦ï¼Œæ”¾åˆ°ä¸‹ä¸€è½®GCä¸­è¿›è¡Œå»¶åå¤„ç†å³å¯.\nç„¶è€ŒçœŸå®åœºæ™¯ä¸­ï¼Œéœ€è¦è¡¥å……ä¸€ä¸ªæ–°çš„è®¾å®šâ€”â€”å±éšœæœºåˆ¶æ— æ³•ä½œç”¨äºæ ˆå¯¹è±¡.\n\nè¿™æ˜¯å› ä¸ºæ ˆå¯¹è±¡å¯èƒ½æ¶‰åŠé¢‘ç¹çš„è½»é‡æ“ä½œï¼Œå€˜è‹¥è¿™äº›é«˜é¢‘åº¦æ“ä½œéƒ½éœ€è¦ä¸€ä¸€è§¦å‘å±éšœæœºåˆ¶ï¼Œé‚£ä¹ˆæ‰€å¸¦æ¥çš„æˆæœ¬å°†æ˜¯æ— æ³•æ¥å—çš„.\næ ˆï¼ˆStackï¼‰å†…å­˜æ˜¯ç»å¯¹ç§æœ‰çš„ï¼Œä¸èƒ½è¢«è·¨æ ˆå¼•ç”¨ã€‚å¦‚æœè¢«è·¨ç«™å¼•ç”¨äº†ï¼Œè¿™ä¸ªå¯¹è±¡ä¼šè¢«å‡çº§æˆå †å¯¹è±¡\nåœ¨è¿™ä¸€èƒŒæ™¯ä¸‹ï¼Œå•ç‹¬çœ‹æ’å…¥å†™å±éšœæˆ–åˆ é™¤å†™å±éšœï¼Œéƒ½æ— æ³•çœŸæ­£è§£å†³æ¼æ ‡é—®é¢˜ï¼Œé™¤éæˆ‘ä»¬å¼•å…¥é¢å¤–çš„Stop the worldï¼ˆSTWï¼‰é˜¶æ®µ[æš‚åœå…¶ä»–çº¿ç¨‹]ï¼Œå¯¹æ ˆå¯¹è±¡çš„å¤„ç†è¿›è¡Œå…œåº•ã€‚\nä¸ºäº†æ¶ˆé™¤è¿™ä¸ªé¢å¤–çš„ STW æˆæœ¬ï¼ŒGolang 1.8 å¼•å…¥äº†æ··åˆå†™å±éšœæœºåˆ¶ï¼Œè¦ç‚¹å¦‚ä¸‹ï¼š\n\nã€æ ˆå¯¹è±¡è¿˜æ˜¯ç¬¦åˆä¸‰è‰²æ ‡è®°æ³•çš„ï¼Œå¼•ç”¨å¯¹è±¡è¿˜æ˜¯ä¼šå˜æˆç°è‰²ã€‘\n\nGC å¼€å§‹å‰ï¼Œä»¥æ ˆä¸ºå•ä½åˆ†æ‰¹æ‰«æï¼Œå°†æ ˆä¸­æ‰€æœ‰å¯¹è±¡ç½®é»‘\nGC æœŸé—´ï¼Œæ ˆä¸Šæ–°åˆ›å»ºå¯¹è±¡ç›´æ¥ç½®é»‘\nå †å¯¹è±¡æ­£å¸¸å¯ç”¨æ’å…¥å†™å±éšœ\nå †å¯¹è±¡æ­£å¸¸å¯ç”¨åˆ é™¤å†™å±éšœ\n\nä¸‹é¢æˆ‘ä»¬é€šè¿‡å‡ ä¸ª show caseï¼Œæ¥è®ºè¯æ··åˆå†™å±éšœæœºåˆ¶æ˜¯å¦çœŸçš„èƒ½è§£å†³å¹¶å‘GCä¸‹çš„å„ç§æç«¯åœºæ™¯é—®é¢˜.\nshow case\nå †å¯¹è±¡åˆ é™¤å¼•ç”¨ï¼Œæ ˆå¯¹è±¡å»ºç«‹å¼•ç”¨\n\n\nèƒŒæ™¯ï¼šå­˜åœ¨æ ˆä¸Šå¯¹è±¡Aï¼Œé»‘è‰²ï¼ˆæ‰«æå®Œï¼‰\nå­˜åœ¨å †ä¸Šå¯¹è±¡Bï¼Œç™½è‰²ï¼ˆæœªè¢«æ‰«æï¼‰\nå­˜åœ¨å †ä¸Šå¯¹è±¡Cï¼Œè¢«å †ä¸Šå¯¹è±¡Bå¼•ç”¨ï¼Œç™½è‰²ï¼ˆæœªè¢«æ‰«æï¼‰\nmoment1ï¼šAå»ºç«‹å¯¹Cçš„å¼•ç”¨ï¼Œç”±äºæ ˆæ— å±éšœæœºåˆ¶ï¼Œå› æ­¤æ­£å¸¸å»ºç«‹å¼•ç”¨ï¼Œæ— é¢å¤–æ“ä½œ\nmoment2ï¼šBå°è¯•åˆ é™¤å¯¹Cçš„å¼•ç”¨ï¼Œåˆ é™¤å†™å±éšœè¢«è§¦å‘ï¼ŒCè¢«ç½®ç°ï¼Œå› æ­¤ä¸ä¼šæ¼æ ‡\n\nä¸€ä¸ªå †å¯¹è±¡åˆ é™¤å¼•ç”¨ï¼Œæˆä¸ºå¦ä¸€ä¸ªå †å¯¹è±¡ä¸‹æ¸¸\n\nå­˜åœ¨å †ä¸Šå¯¹è±¡Aï¼Œç™½è‰²ï¼ˆæœªè¢«æ‰«æï¼‰\nå­˜åœ¨å †ä¸Šå¯¹è±¡Bï¼Œé»‘è‰²ï¼ˆå·²å®Œæˆæ‰«æï¼‰\nå­˜åœ¨å †ä¸Šå¯¹è±¡Cï¼Œè¢«Aå¼•ç”¨ï¼Œç™½è‰²ï¼ˆæœªè¢«æ‰«æï¼‰\n\nmoment1ï¼šBå°è¯•å»ºç«‹å¯¹Cçš„å¼•ç”¨ï¼Œæ’å…¥å†™å±éšœè¢«è§¦å‘ï¼ŒCè¢«ç½®ç°\nmoment2ï¼šAåˆ é™¤å¯¹Cçš„å¼•ç”¨ï¼Œæ­¤æ—¶Cå·²ç½®ç°ï¼Œå› æ­¤ä¸ä¼šæ¼æ ‡\n\næ ˆå¯¹è±¡åˆ é™¤å¼•ç”¨ï¼Œæˆä¸ºå †å¯¹è±¡ä¸‹æ¸¸\n\n\nèƒŒæ™¯ï¼šå­˜åœ¨æ ˆä¸Šå¯¹è±¡Aï¼Œç™½è‰²ï¼ˆæœªå®Œæˆæ‰«æï¼Œè¯´æ˜å¯¹åº”çš„æ ˆæœªæ‰«æï¼‰\nå­˜åœ¨å †ä¸Šå¯¹è±¡Bï¼Œé»‘è‰²ï¼ˆå·²å®Œæˆæ‰«æï¼‰\nå­˜åœ¨å †ä¸Šå¯¹è±¡Cï¼Œè¢«æ ˆä¸Šå¯¹è±¡Aå¼•ç”¨ï¼Œç™½è‰²ï¼ˆæœªè¢«æ‰«æï¼‰\nmoment1ï¼šBå°è¯•å»ºç«‹å¯¹Cçš„å¼•ç”¨ï¼Œæ’å…¥å†™å±éšœè¢«è§¦å‘ï¼ŒCè¢«ç½®ç°\nmoment2ï¼šAåˆ é™¤å¯¹Cçš„å¼•ç”¨ï¼Œæ­¤æ—¶Cå·²ç½®ç°ï¼Œå› æ­¤ä¸ä¼šæ¼æ ‡\n\nä¸€ä¸ªæ ˆä¸­å¯¹è±¡åˆ é™¤å¼•ç”¨ï¼Œå¦ä¸€ä¸ªæ ˆä¸­å¯¹è±¡å»ºç«‹å¼•ç”¨\n\n\nèƒŒæ™¯ï¼šå­˜åœ¨æ ˆä¸Šå¯¹è±¡Aï¼Œç™½è‰²ï¼ˆæœªæ‰«æï¼Œè¿™æ˜¯å› ä¸ºå¯¹åº”çš„æ ˆè¿˜æœªå¼€å§‹æ‰«æï¼‰\nå­˜åœ¨æ ˆä¸Šå¯¹è±¡Bï¼Œé»‘è‰²ï¼ˆå·²å®Œæˆæ‰«æï¼Œè¯´æ˜å¯¹åº”çš„æ ˆå‡å·²å®Œæˆæ‰«æï¼‰\nå­˜åœ¨å †ä¸Šå¯¹è±¡Cï¼Œè¢«æ ˆä¸Šå¯¹è±¡Aå¼•ç”¨ï¼Œç™½è‰²ï¼ˆæœªè¢«æ‰«æï¼‰\nmoment1ï¼šBå»ºç«‹å¯¹Cçš„å¼•ç”¨ï¼›\nmoment2ï¼šAåˆ é™¤å¯¹Cçš„å¼•ç”¨.\nç»“è®ºï¼šè¿™ç§åœºæ™¯ä¸‹ï¼ŒCè¦ä¹ˆå·²ç„¶è¢«ç½®ç°ï¼Œè¦ä¹ˆä»æŸä¸ªç°å¯¹è±¡è§¦å‘ä»ç„¶å¯è¾¾C.\nåŸå› åœ¨äºï¼Œå¯¹è±¡çš„å¼•ç”¨ä¸æ˜¯ä»å¤©è€Œé™ï¼Œä¸€å®šè¦æœ‰ä¸ªæ¥å¤„. å½“å‰ case ä¸­ï¼Œå¯¹è±¡Bèƒ½å»ºç«‹æŒ‡å‘Cçš„å¼•ç”¨ï¼Œè‡³å°‘éœ€è¦æ»¡è¶³å¦‚ä¸‹ä¸‰ä¸ªæ¡ä»¶ä¹‹ä¸€ï¼š\nI æ ˆå¯¹è±¡BåŸå…ˆå°±æŒæœ‰Cçš„å¼•ç”¨ï¼Œå¦‚è‹¥å¦‚æ­¤ï¼ŒCå°±å¿…ç„¶å·²å¤„äºç½®ç°çŠ¶æ€ï¼ˆå› ä¸ºBå·²æ˜¯é»‘è‰²ï¼‰\nII æ ˆå¯¹è±¡BæŒæœ‰Açš„å¼•ç”¨ï¼Œé€šè¿‡Aé—´æ¥æ‰¾åˆ°C. ç„¶è€Œè¿™ä¹Ÿæ˜¯ä¸å¯èƒ½çš„ï¼Œå› ä¸ºå€˜è‹¥Aèƒ½åŒæ—¶è¢«å¦ä¸€ä¸ªæ ˆä¸Šçš„Bå¼•ç”¨åˆ°ï¼Œé‚£æ ·Aå¿…ç„¶ä¼šå‡çº§åˆ°å †ä¸­ï¼Œä¸å†æ»¡è¶³ä½œä¸ºä¸€ä¸ªæ ˆå¯¹è±¡çš„å‰æï¼›\nIII BåŒæ ˆå†…å­˜åœ¨å…¶ä»–å¯¹è±¡Xå¯è¾¾Cï¼Œæ­¤æ—¶ä»Xå‡ºå‘ï¼Œå¿…ç„¶å­˜åœ¨ä¸€ä¸ªç°è‰²å¯¹è±¡ï¼Œä»å…¶å‡ºå‘å­˜åœ¨å¯è¾¾Cçš„è·¯çº¿.\n\nç»¼ä¸Šï¼Œæˆ‘ä»¬å¾—ä»¥è¯æ˜æ··åˆå†™å±éšœæ˜¯èƒ½å¤Ÿèƒœä»»å¹¶å‘GCåœºæ™¯çš„è§£å†³æ–¹æ¡ˆï¼Œå¹¶ä¸”æ»¡è¶³æ ˆæ— é¡»æ·»åŠ å±éšœçš„å‰æ."},"æŠ€æœ¯ç§¯ç´¯/Golang/æ ¸å¿ƒçŸ¥è¯†/05.1-GCæºç ":{"slug":"æŠ€æœ¯ç§¯ç´¯/Golang/æ ¸å¿ƒçŸ¥è¯†/05.1-GCæºç ","filePath":"æŠ€æœ¯ç§¯ç´¯/Golang/æ ¸å¿ƒçŸ¥è¯†/05.1 GCæºç .md","title":"05.1 GCæºç ","links":[],"tags":[],"content":"è§¦å‘GC\nè§¦å‘GCç±»å‹\nè§¦å‘GCçš„äº‹ä»¶ç±»å‹å¯ä»¥åˆ†ä¸ºå¦‚ä¸‹ä¸‰ç§\n\ngcTriggerHeap åˆ†é…å¯¹è±¡æ—¶è§¦å‘\n\næ ¡éªŒæ¡ä»¶æ˜¯ å †å·²åˆ†é…å†…å­˜è¾¾åˆ°é˜ˆå€¼\n\n\ngcTriggerTime ç”±forcechelperå®ˆæŠ¤åç¨‹å®šæ—¶è§¦å‘\n\næ¯ä¸¤åˆ†é’Ÿè§¦å‘ä¸€æ¬¡\n\n\ngcTriggerCycle ç”¨æˆ·è°ƒç”¨runtime.GCæ–¹æ³•\n\nä¸Šä¸€è½®GCå·²ç»“æŸ\n\n\n\nåœ¨è§¦å‘GCæ—¶ï¼Œä¼šé€šè¿‡ gcTrigger.test æ–¹æ³•ï¼Œç»“åˆå…·ä½“çš„è§¦å‘äº‹ä»¶ç±»å‹è¿›è¡Œè§¦å‘æ¡ä»¶çš„æ ¡éªŒï¼Œå¯¹åº”çš„æºç å¦‚ä¸‹ï¼š\ntype gcTriggerKind int\n \n \nconst (\n    // æ ¹æ®å †åˆ†é…å†…å­˜æƒ…å†µï¼Œåˆ¤æ–­æ˜¯å¦è§¦å‘GC\n    gcTriggerHeap gcTriggerKind = iota\n    // å®šæ—¶è§¦å‘GC\n    gcTriggerTime\n    // æ‰‹åŠ¨è§¦å‘GC\n    gcTriggerCycle\n}\n \n \nfunc (t gcTrigger) test() bool {//å¦‚æœtrue è¯´æ˜åº”å½“å¯åŠ¨GC\n    // ...\n    switch t.kind {//æ ¹æ®gcTriggerçš„ä¸åŒç±»å‹,é€‰å–ä¸åŒçš„æ ¡éªŒæ¡ä»¶\n    case gcTriggerHeap:\n        // ...\n        //è¿™ä¸ªtriggerå€¼æ˜¯æ ¹æ®gogcç¯å¢ƒå˜é‡åŠ¨æ€è®¡ç®—å‡ºæ¥çš„.\n        trigger, _ := gcController.trigger()\n        //åˆ¤æ–­å½“å‰æ´»è·ƒçš„å †å†…å­˜æ˜¯å¦&gt;=è§¦å‘é˜ˆå€¼?å¦‚æœå·²åˆ†é…å†…å­˜å¤§äºé˜ˆå€¼,è¯´æ˜éœ€è¦å¯åŠ¨GCåˆ†é…\n        return atomic.Load64(&amp;gcController.heapLive) &gt;= trigger\n    case gcTriggerTime:\n    //å¦‚æœgcPercent&lt;0,å³ç¯å¢ƒå˜é‡gogc=off,åˆ™å½»åº•å…³é—­gc,æ°¸è¿œä¸è§¦å‘\n        if gcController.gcPercent.Load() &lt; 0 {\n            return false\n        }\n        //è·å–ä¸Šä¸€æ¬¡gcç»“æŸçš„æ—¶é—´\n        lastgc := int64(atomic.Load64(&amp;memstats.last_gc_nanotime))\n        //å¦‚æœlastgc!=0,ç¡®ä¿ä¹‹å‰è‡³å°‘å‘ç”Ÿè¿‡ä¸€æ¬¡gc,å¹¶ä¸”è·ç¦»ä¸Šæ¬¡gcçš„æ—¶é—´é—´éš”è¶…è¿‡äº†å¼ºåˆ¶å‘¨æœŸ,è¿™é‡Œçš„å¼ºåˆ¶å‘¨æœŸä¸€èˆ¬æ˜¯2åˆ†é’Ÿ\n        return lastgc != 0 &amp;&amp; t.now-lastgc &gt; forcegcperiod\n    case gcTriggerCycle:\n        // ...\n        //è¿™é‡Œçš„t.næ˜¯è°ƒç”¨è€…æœŸæœ›è¾¾åˆ°çš„gcå‘¨æœŸç¼–å·,work.cyclesæ˜¯å½“å‰å·²å®Œæˆçš„gcå‘¨æœŸç¼–å·  æ¯”å¦‚è¯´æˆ‘éœ€è¦gc5ä¸ªå‘¨æœŸ,è€Œå½“å‰åªgcäº†å››ä¸ªå‘¨æœŸ,é‚£ä¹ˆå°±è¦å‘èµ·gc\n        //å¦‚æœæœŸæœ›çš„å¤§äºå·²å®Œæˆçš„,è¯´æ˜ç›®æ ‡gcè¿˜æ²¡æœ‰å¯åŠ¨ é‚£ä¹ˆä¹…è¿”å›trueå»å¯åŠ¨.\n        return int32(t.n-work.cycles) &gt; 0\n    }\n    return true\n}\nå¯¹è±¡åˆ†é…è§¦å‘GC\nå®šæ—¶è§¦å‘GC\nå¯åŠ¨å®šæ—¶è§¦å‘åç¨‹å¹¶é˜»å¡ç­‰å¾…\n\nruntime åŒ…åˆå§‹åŒ–çš„æ—¶å€™ï¼Œå³ä¼šå¼‚æ­¥å¼€å¯ä¸€ä¸ªå®ˆæŠ¤åç¨‹ï¼Œé€šè¿‡ for å¾ªç¯ + park çš„æ–¹å¼ï¼Œå¾ªç¯é˜»å¡ç­‰å¾…è¢«å”¤é†’.\nå½“è¢«å”¤é†’åï¼Œåˆ™ä¼šè°ƒç”¨ gcStart æ–¹æ³•è¿›å…¥æ ‡è®°å‡†å¤‡é˜¶æ®µï¼Œå°è¯•å¼€å¯æ–°ä¸€è½® GCï¼Œæ­¤æ—¶è§¦å‘ GC çš„äº‹ä»¶ç±»å‹æ­£æ˜¯ gcTriggerTimeï¼ˆå®šæ—¶è§¦å‘ï¼‰.\nåœ¨ gcStart æ–¹æ³•å†…éƒ¨ï¼Œè¿˜ä¼šé€šè¿‡ gcTrigger.test æ–¹æ³•è¿›ä¸€æ­¥æ ¡éªŒè§¦å‘GCçš„æ¡ä»¶æ˜¯å¦æ»¡è¶³\n\nå¯¹è±¡åˆ†é…è§¦å‘GC\næ‰‹åŠ¨è§¦å‘GC\næ ‡è®°å‡†å¤‡\nä¸»æµç¨‹\nå¯åŠ¨æ ‡è®°åç¨‹\nstop the world\næ§åˆ¶æ ‡è®°åç¨‹é¢‘ç‡\nè®¾ç½®å†™å±éšœ\ntinyå¯¹è±¡æ ‡è®°\nstart the world\nå¹¶å‘æ ‡è®°\nè°ƒåº¦æ ‡è®°åç¨‹\nå¹¶å‘æ ‡è®°å¯åŠ¨\næ ‡è®°ä¸»æµç¨‹\nç°å¯¹è±¡ç¼“å­˜é˜Ÿåˆ—\nä¸‰è‰²æ ‡è®°å®ç°\nä¸­æ­¢æ ‡è®°åç¨‹\næ‰«ææ ¹å¯¹è±¡\næ‰«ææ™®é€šå¯¹è±¡\nå¯¹è±¡ç½®ç°\næ–°åˆ†é…å¯¹è±¡ç½®é»‘\nè¾…åŠ©æ ‡è®°\nè¾…åŠ©æ ‡è®°ç­–ç•¥\nè¾…åŠ©æ ‡è®°æ‰§è¡Œ\næ ‡è®°ç»ˆæ­¢\næ ‡è®°å®Œæˆ\næ ‡è®°ç»ˆæ­¢\næ ‡è®°æ¸…æ‰«\nè®¾ç½®ä¸‹è½®GCé˜ˆå€¼\nç³»ç»Ÿé©»ç•™å†…å­˜æ¸…ç†\nå›æ”¶åç¨‹å¯åŠ¨\næ‰§è¡Œé¢‘ç‡æ§åˆ¶\nå›æ”¶ç©ºé—²å†…å­˜"},"æŠ€æœ¯ç§¯ç´¯/Golang/æ ¸å¿ƒçŸ¥è¯†/06-Channel-å®ç°åŸç†":{"slug":"æŠ€æœ¯ç§¯ç´¯/Golang/æ ¸å¿ƒçŸ¥è¯†/06-Channel-å®ç°åŸç†","filePath":"æŠ€æœ¯ç§¯ç´¯/Golang/æ ¸å¿ƒçŸ¥è¯†/06 Channel å®ç°åŸç†.md","title":"06 Channel å®ç°åŸç†","links":[],"tags":[],"content":""},"æŠ€æœ¯ç§¯ç´¯/Golang/æ ¸å¿ƒçŸ¥è¯†/channelé€šé“":{"slug":"æŠ€æœ¯ç§¯ç´¯/Golang/æ ¸å¿ƒçŸ¥è¯†/channelé€šé“","filePath":"æŠ€æœ¯ç§¯ç´¯/Golang/æ ¸å¿ƒçŸ¥è¯†/channelé€šé“.md","title":"channelé€šé“","links":[],"tags":[],"content":"ä¸è¦é€šè¿‡å…±äº«å†…å­˜æ¥é€šä¿¡,è€Œæ˜¯é€šè¿‡é€šä¿¡æ¥å…±äº«å†…å­˜\nchannelåœ¨è¿è¡Œæ—¶æ˜¯ä¸€ä¸ªå«hchançš„ç»“æ„ä½“,æ ¸å¿ƒæ˜¯\n\nç¯å½¢é˜Ÿåˆ—,ä¸€ä¸ªæ•°ç»„,ç”¨æ¥å­˜æ•°æ®(ä»…é™æœ‰ç¼“å†²channel)é¦–å°¾ç›¸æ¥å¤ç”¨å†…å­˜,é¿å…é¢‘ç¹åˆ†é…\né”:å“ªæ€•æ˜¯channel,å†…éƒ¨ä¿æŠ¤æ•°æ®ä¹Ÿæ˜¯é é”\nç­‰å¾…é˜Ÿåˆ—:\n\nrecvq:å¦‚æœæœ‰gæƒ³è¯»æ•°æ®ä½†æ˜¯channelæ˜¯ç©ºçš„,è¿™ä¸ªgå°±ä¼šè¢«æ‰“åŒ…æˆä¸€ä¸ªå¯¹è±¡ sudogæŒ‚åœ¨åˆ—è¡¨é‡Œ,ç„¶ågopark\nsendq æƒ³å†™æ•°æ®ä½†æ˜¯é€šé“æ»¡äº†,åŒç†æŒ‚åœ¨é˜Ÿåˆ—é‡Œç­‰å¾…\n\n\n\næœ‰ç¼“å†²vsæ— ç¼“å†²\næ— ç¼“å†²:åŒæ­¥é€šä¿¡.\n\nè¡Œä¸ºï¼š è¿™ä¸€å¤´é€’ä¸œè¥¿ï¼Œé‚£ä¸€å¤´å¿…é¡»åŒæ—¶æœ‰äººæ¥ã€‚æ²¡äººæ¥ï¼Œå‘çš„äººå°±é˜»å¡ï¼›æ²¡äººå‘ï¼Œæ¥çš„äººå°±é˜»å¡ã€‚\næ•°æ®æµå‘ï¼š æ•°æ®ç›´æ¥ä» Sender çš„æ ˆæ‹·è´åˆ° Receiver çš„æ ˆï¼ˆç›´æ¥ä¼ é€’ï¼Œä¸ç»è¿‡ä¸­é—´ç¼“å­˜ï¼‰ï¼Œæ•ˆç‡æé«˜ã€‚\n\næœ‰ç¼“å†²:å¼‚æ­¥é€šä¿¡\næ”¾è¿›å»å°±èµ°äº†,åªæœ‰æ»¡äº†æˆ–è€…ç©ºäº†æ‰ä¼šåœä¸‹.\ncloseæ“ä½œ æ­£å¸¸å…³é—­.å·²å…³é—­å’Œnilçš„channelçš„å°±ä¼španic\nwrite å†™å…¥æ•°æ®.å¦‚æœä»¥å…³é—­å°±ä¼španic,nilä¼šæ°¸ä¹…é˜»å¡\nreadè¯»æ•°æ® ä»¥å…³é—­çš„ä¸é˜»å¡,ä¼šè¿”å›0/false nilä¼šæ°¸ä¹…é˜»å¡"},"æŠ€æœ¯ç§¯ç´¯/Golang/æ ¸å¿ƒçŸ¥è¯†/sync.Map":{"slug":"æŠ€æœ¯ç§¯ç´¯/Golang/æ ¸å¿ƒçŸ¥è¯†/sync.Map","filePath":"æŠ€æœ¯ç§¯ç´¯/Golang/æ ¸å¿ƒçŸ¥è¯†/sync.Map.md","title":"sync.Map","links":[],"tags":[],"content":"å¹¶å‘å®‰å…¨çš„map\n\ngoåŸç”Ÿçš„mapæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„,å¹¶å‘è¯»å†™ä¼španic.\n\nç»“æ„\n\nreadmap åªè¯».è®¿é—®ä¸éœ€è¦åŠ é”,é€Ÿåº¦å¿«,\ndirtymap è¿™æ˜¯å¤‡ä»½ è®¿é—®éœ€è¦åŠ é”.æ–°å†™å…¥çš„æ•°æ®éƒ½å…ˆå­˜å‚¨åœ¨è¿™é‡Œ.\n\næŸ¥æ‰¾çš„æ—¶å€™.\n\nå…ˆå»readmapæ‰¾,æ‰¾åˆ°äº†ç›´æ¥è¿”å›,\nmissäº†å°±åŠ é”å»dirtymapæ‰¾.\næ•°æ®æ¬è¿:å†…éƒ¨æœ‰ä¸€ä¸ªè®¡æ•°å™¨misses,å¦‚æœmissçš„é¢‘ç‡å¤ªé«˜äº†,ç³»ç»Ÿä¼šè§‰å¾—readmapå¤ªæ—§äº†,å°±å°†dirtymapå‡çº§å˜æˆæ–°çš„readmap ç„¶åæ¸…ç©ºdirtymap\n"},"æŠ€æœ¯ç§¯ç´¯/Golang/æ ¸å¿ƒçŸ¥è¯†/sync.Mutexäº’æ–¥é”":{"slug":"æŠ€æœ¯ç§¯ç´¯/Golang/æ ¸å¿ƒçŸ¥è¯†/sync.Mutexäº’æ–¥é”","filePath":"æŠ€æœ¯ç§¯ç´¯/Golang/æ ¸å¿ƒçŸ¥è¯†/sync.Mutexäº’æ–¥é”.md","title":"sync.Mutexäº’æ–¥é”","links":[],"tags":[],"content":"mutexæ˜¯ä¸€ä¸ªå¤æ‚çš„çŠ¶æ€æœº,ç»“æ„ä½“é‡Œé¢ä¸»è¦æœ‰ä¸¤ä¸ªå­—æ®µ\n\nstate,è®°å½•äº†é”æ˜¯å¦è¢«æŒæœ‰,å¤šå°‘äººåœ¨æ’é˜Ÿ,æ˜¯å¦å¤„äºé¥¥é¥¿æ¨¡å¼ç­‰\nsemaä¿¡å·é‡,ç”¨æ¥å”¤é†’æ²‰ç¡çš„çº¿ç¨‹\n\næ­£å¸¸æ¨¡å¼: æ–°çš„gæ¥æŠ¢é”,ä¼šå°è¯•ç›´æ¥å»çª—å£æŠ¢,å› ä¸ºç¼“å­˜å‹å¥½,åˆšæ¥çš„gè¿˜åœ¨cpuä¸Šè·‘ç€.ä½†æ˜¯å°±å¯èƒ½å³é¥¥é¥¿é—®é¢˜,æ’åœ¨é˜Ÿåˆ—é‡Œçš„gæ°¸è¿œæŠ¢ä¸è¿‡\né¥¥é¥¿æ¨¡å¼ å¦‚æœä¸€ä¸ªgç­‰å¾…é”è¿‡ä¹…äº†,é‚£ä¹ˆæŠŠmutexåˆ‡æ¢æˆé¥¥é¥¿æ¨¡å¼.è¡Œä¸ºå°±æ˜¯ä¸¥æ ¼çš„fifo,æ–°æ¥çš„gå¿…é¡»è¦å»é˜Ÿå°¾æ’é˜Ÿ,é”çš„æ‰€æœ‰æƒç›´æ¥ç”±é‡Šæ”¾è€…äº¤ç»™ç­‰å¾…é˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªg.\né˜Ÿåˆ—ç©ºäº†æˆ–è€…ç­‰å¾…æ—¶é—´å°äº1msäº†,å°±ä¼šåˆ‡å›æ­£å¸¸æ¨¡å¼"},"æŠ€æœ¯ç§¯ç´¯/Golang/æ ¸å¿ƒçŸ¥è¯†/æ•°æ®ç»“æ„çš„å®ç°":{"slug":"æŠ€æœ¯ç§¯ç´¯/Golang/æ ¸å¿ƒçŸ¥è¯†/æ•°æ®ç»“æ„çš„å®ç°","filePath":"æŠ€æœ¯ç§¯ç´¯/Golang/æ ¸å¿ƒçŸ¥è¯†/æ•°æ®ç»“æ„çš„å®ç°.md","title":"æ•°æ®ç»“æ„çš„å®ç°","links":[],"tags":[],"content":"map: å¸¦æœ‰æº¢å‡ºæ¡¶æœºåˆ¶çš„å“ˆå¸Œè¡¨\nå­—ç¬¦ä¸²: åªè¯»çš„å­—èŠ‚åˆ‡ç‰‡\nåˆ‡ç‰‡: åŠ¨æ€æ•°ç»„æè¿°ç¬¦\næ¥å£: å¸¦ç€ç±»å‹ä¿¡æ¯çš„èƒ–æŒ‡é’ˆ\né€šé“channel: å¸¦é”çš„ç¯å½¢é˜Ÿåˆ—"},"æŠ€æœ¯ç§¯ç´¯/Golang/æ ¸å¿ƒçŸ¥è¯†/æ­»é”":{"slug":"æŠ€æœ¯ç§¯ç´¯/Golang/æ ¸å¿ƒçŸ¥è¯†/æ­»é”","filePath":"æŠ€æœ¯ç§¯ç´¯/Golang/æ ¸å¿ƒçŸ¥è¯†/æ­»é”.md","title":"æ­»é”","links":[],"tags":[],"content":""},"æŠ€æœ¯ç§¯ç´¯/Golang/è¯­æ³•ç‰¹æ€§/å€¼ä¼ é€’ä¸å¼•ç”¨ä¼ é€’":{"slug":"æŠ€æœ¯ç§¯ç´¯/Golang/è¯­æ³•ç‰¹æ€§/å€¼ä¼ é€’ä¸å¼•ç”¨ä¼ é€’","filePath":"æŠ€æœ¯ç§¯ç´¯/Golang/è¯­æ³•ç‰¹æ€§/å€¼ä¼ é€’ä¸å¼•ç”¨ä¼ é€’.md","title":"å€¼ä¼ é€’ä¸å¼•ç”¨ä¼ é€’","links":[],"tags":[],"content":"goçš„é»˜è®¤ä¼ å‚æ–¹å¼æ˜¯copy,å¦‚æœä¼ é€’çš„ä¸æ˜¯åœ°å€çš„è¯,å¯¹å‚æ•°çš„ä¿®æ”¹æ— æ³•ç”Ÿæ•ˆ.\nä¸€èˆ¬æ¥è¯´æˆ‘ä»¬è®¤ä¸º,ä¼ æŒ‡é’ˆæ¯”ä¼ å€¼æ›´å¿«.ä½†æ˜¯å®é™…ä¸Š,ä¼ é€’æŒ‡é’ˆåœ¨goä¸­å­˜åœ¨éšæ€§æˆæœ¬\nåƒåœ¾å›æ”¶ (GC) å‹åŠ›\nå¦‚æœä½ è¿”å›ä¸€ä¸ªæŒ‡é’ˆ *MysqlConfigï¼š\n\nGo ç¼–è¯‘å™¨ä¼šå‘ç°ï¼šâ€œå“å‘€ï¼Œè¿™ä¸ªå˜é‡çš„åœ°å€è¢«ä¸¢åˆ°å‡½æ•°å¤–é¢å»äº†\nä¸ºäº†é˜²æ­¢å‡½æ•°ç»“æŸæ—¶å˜é‡è¢«é”€æ¯ï¼ŒGo å¿…é¡»æŠŠè¿™ä¸ªå˜é‡åˆ†é…åˆ° å †å†…å­˜ (Heap) ä¸Šã€‚\nåæœï¼š åƒåœ¾å›æ”¶å™¨ (GC) éœ€è¦ç›¯ç€è¿™å—å†…å­˜ï¼Œä»¥åè¿˜è¦èŠ±æ—¶é—´å»å›æ”¶å®ƒã€‚è¿™ä¼šå¢åŠ  GC çš„è´Ÿæ‹…ã€‚\n\nå¦‚æœä½ è¿”å›ä¸€ä¸ªå€¼ MysqlConfig\n\nGo ç¼–è¯‘å™¨ä¼šå‘ç°ï¼šâ€œè¿™ä¸ªå˜é‡åªæ˜¯å¤å°äº†ä¸€ä»½å‡ºå»\nå®ƒé€šå¸¸ä¼šæŠŠå˜é‡ç•™åœ¨ æ ˆå†…å­˜ (Stack) ä¸Šã€‚\nå¥½å¤„ï¼š æ ˆå†…å­˜æ˜¯ç”¨å®Œå³æ‰”çš„ï¼Œå®Œå…¨ä¸éœ€è¦ GC ä»‹å…¥ï¼Œé€Ÿåº¦æå¿«ï¼\n\nåŸåˆ™\nâœ… è¿™ç§æƒ…å†µç”¨ä¼ å€¼ (Pass by Value)\n\nå¯¹è±¡å¾ˆå°ï¼šæ¯”å¦‚ä½ çš„ Configï¼Œæˆ–è€… Timeï¼Œæˆ–è€…åæ ‡ Point{x, y}ã€‚\nä¸ºäº†å®‰å…¨ï¼ˆåªè¯»ï¼‰ï¼šä½ ä¸å¸Œæœ›è°ƒç”¨è€…ä¿®æ”¹åŸæœ¬çš„æ•°æ®ã€‚\nä¸ºäº†å¹¶å‘å®‰å…¨ï¼šå¦‚æœä¸è®©æ”¹ï¼Œé‚£å¤šçº¿ç¨‹è¯»çš„æ—¶å€™å°±ä¸ç”¨åŠ é”ï¼Œçœäº‹ï¼\n\nâœ… è¿™ç§æƒ…å†µç”¨æŒ‡é’ˆ (Pass by Pointer)\n\n\nå¯¹è±¡è¶…çº§å¤§ï¼šæ¯”å¦‚ä½ æœ‰ä¸€ä¸ªç»“æ„ä½“é‡Œå­˜äº† [10000]intï¼ˆå‡ ä¸‡ä¸ªæ•°å­—ï¼‰æˆ–è€…ä¸€ä¸ªå·¨å¤§çš„ç¼“å­˜å¯¹è±¡ã€‚è¿™æ—¶å€™å¤åˆ¶ä¸€æ¬¡å¤ªæ…¢äº†ï¼Œå¿…é¡»ç»™é’¥åŒ™ï¼ˆæŒ‡é’ˆï¼‰ã€‚\n\n\néœ€è¦ä¿®æ”¹åŸä»¶ï¼šæ¯”å¦‚ func (u *User) ChangeName(newName string)ï¼Œä½ å¿…é¡»æ”¹åŸæ•°æ®ï¼Œä¸ä¼ æŒ‡é’ˆæ”¹ä¸äº†ã€‚\n\n"},"æŠ€æœ¯ç§¯ç´¯/Golang/è¯­æ³•ç‰¹æ€§/å¤šæ€-æ¥å£interface":{"slug":"æŠ€æœ¯ç§¯ç´¯/Golang/è¯­æ³•ç‰¹æ€§/å¤šæ€-æ¥å£interface","filePath":"æŠ€æœ¯ç§¯ç´¯/Golang/è¯­æ³•ç‰¹æ€§/å¤šæ€-æ¥å£interface.md","title":"æ¥å£","links":[],"tags":[],"content":"å¤šæ€\néœ€è¦æœ‰æ¥å£æ¦‚å¿µinterface\nåªè¦ç¬¦åˆæ¥å£å®šä¹‰çš„å‡½æ•°,å°±è¢«è®¤ä¸ºæ˜¯è¿™ä¸ªæ¥å£çš„ä¸€åˆ†å­.ç„¶åå¯ä»¥ä½œä¸ºæ¥å£æˆå‘˜,è°ƒç”¨ç›¸åº”åŒ…å‡½æ•°..\næ³¨æ„: ç¬¦åˆæ¥å£å®šä¹‰çš„å‡½æ•°: ä¼ å…¥çš„å‚æ•°ç±»å‹çš„å®šä¹‰ä¹Ÿå¿…é¡»ä¸¥æ ¼ä¸€è‡´.\n// src/container/heap/heap.go\n \ntype Interface interface {\n    sort.Interface\n    Push(x any)    // ğŸ‘ˆ å®˜æ–¹è§„å®šï¼šè¿™é‡Œå¿…é¡»æ¥æ”¶interface{}\n    Pop() any      // ğŸ‘ˆ å®˜æ–¹è§„å®šï¼šè¿™é‡Œå¿…é¡»è¿”å›interface{}\n}\n \n \n// é‚£ä¹ˆå¦‚æœç…§ç€è¿™æ ·å†™ç¼–è¯‘å™¨å°±ä¼šæŠ¥é”™\nfunc (h *IHeap) Push(x [2]int) { // ç›´æ¥æ¥æ”¶ [2]int\n    *h = append(*h, x)\n}\n \ninterfaceç±»å‹:\n\nç±»ä¼¼äºslice,ç»“æ„å†…éƒ¨æœ‰æŒ‡é’ˆ*type å’Œ *data\nä¸€ä¸ªå˜é‡èƒ½ä¸èƒ½èµ‹ç»™ä¸€ä¸ªæ¥å£ï¼Œå”¯ä¸€æ ‡å‡†æ˜¯ï¼šè¿™ä¸ªå˜é‡çš„â€œç±»å‹â€æ˜¯å¦å®ç°äº†è¯¥æ¥å£è¦æ±‚çš„ã€æ‰€æœ‰æ–¹æ³•ã€‘ã€‚è¦çœ‹æ–¹æ³•åˆ°åº•æ˜¯å®šä¹‰åœ¨äº†å€¼ä¸Š,è¿˜æ˜¯å®šä¹‰åœ¨äº†æŒ‡é’ˆä¸Š.\n\nç±»ç»§æ‰¿æ¥å£çš„è¯ä¸éœ€è¦å†™è¿›ç»“æ„ä½“å®šä¹‰,åªéœ€è¦è‡ªå·±å®ç°æ¥å£ä¸­çš„æ–¹æ³•,å°±ç›¸å½“äºç»§æ‰¿äº†.é‚£ä¹ˆæ¥å£çš„æŒ‡é’ˆå°±å¯ä»¥æŒ‡å‘è¿™ä¸ªå­ç±».å¦‚æœæ²¡æœ‰å®ç°å®Œå…¨,ä¹Ÿæ˜¯æ— æ³•ç»§æ‰¿çš„.\nè®©æ¥å£å¯¹åˆ°è°,å°±è°ƒç”¨è°çš„æ–¹æ³•\n\n\nç›¸å½“äºæŠŠæœ‰åŒæ ·æ–¹æ³•çš„ç±»è¿›è¡Œå½’ç±»ç„¶åç”¨ä¸€ä¸ªæ¥å£å¯ä»¥ç»Ÿä¸€è¿›è¡Œç®¡ç†\nç†è§£\næ¯”å¦‚: è°ƒç”¨æ–¹è¯´æƒ³è¦ä¸€ä¸ªèƒ½æ’USBå£çš„ä¸œè¥¿,é‚£ä¹ˆåªè¦è¿™ä¸ªä¸œè¥¿å®ç°äº†USBè§„å®šçš„æ–¹æ³•(è§¦ç”µ\\æ•°æ®ä¼ è¾“ç­‰),å°±å¿…é¡»è¦èƒ½æ’è¿›USBæ¥å£.\nä¸C++ä¸åŒçš„æ˜¯,Goä¸­é‡‡ç”¨éšå¼ç»“æ„.åªéœ€è¦æ–¹æ³•åç›¸åŒå³å¯.\næœ‰ä¸€ä¸ªæ¥å£å« Payerï¼ˆæ”¯ä»˜æ–¹å¼ï¼‰ï¼Œè¦æ±‚æœ‰ä¸€ä¸ª Pay() æ–¹æ³•ã€‚\n\nä½ å†™äº†ä¸€ä¸ª Alipay ç»“æ„ä½“ï¼Œé‡Œé¢å†™äº†ä¸ª Pay() æ–¹æ³•ã€‚\nä½ åˆå†™äº†ä¸€ä¸ª WeChat ç»“æ„ä½“ï¼Œé‡Œé¢ä¹Ÿå†™äº†ä¸ª Pay() æ–¹æ³•ã€‚\né‚£ä¹ˆç¼–è¯‘å™¨å°±ä¼šè®¤ä¸ºè¿™ä¸¤ä¸ªç»“æ„ä½“éƒ½å±äºPayeræ¥å£.\n\nä¸»è¦çš„ç›®çš„æ˜¯è¿›è¡Œè§£è€¦,æ¯”å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­\n//ä¸ä½¿ç”¨æ¥å£\nfunc ç»“è´¦(ç”¨æˆ·é€‰æ‹© string) {\n    if ç”¨æˆ·é€‰æ‹© == &quot;æ”¯ä»˜å®&quot; {\n        è°ƒç”¨æ”¯ä»˜å®API()\n    } else if ç”¨æˆ·é€‰æ‹© == &quot;å¾®ä¿¡&quot; {\n        è°ƒç”¨å¾®ä¿¡API()\n    } else if ç”¨æˆ·é€‰æ‹© == &quot;é“¶è¡Œå¡&quot; {\n        è°ƒç”¨é“¶è¡Œå¡API()\n    }\n    // æ˜å¹´å¦‚æœå‡ºäº†ä¸ªâ€œæŠ–éŸ³æ”¯ä»˜â€ï¼Œä½ è¿˜å¾—å›æ¥æ”¹è¿™è¡Œä»£ç ï¼Œçƒ¦æ­»ã€‚\n}\n \n//ä½¿ç”¨æ¥å£\n//åªè¦æ˜¯å®ç°äº† Payer çš„ä¸œè¥¿ï¼Œéƒ½èƒ½ä¼ è¿›æ¥\nfunc ç»“è´¦(p Payer) {\n    p.Pay() \n}\nä½¿ç”¨\n//å®šä¹‰\ntype Payer interface {\n\tPay(amount int) // åªè¦èƒ½ä»å…œé‡Œæé’±ï¼Œå°±æ˜¯ Payer\n}\n \n//ç±»å‹1\ntype Alipay struct {\n\tAccountName string\n}\nfunc (a Alipay) Pay(amount int) {\n\tfmt.Printf(&quot;ã€æ”¯ä»˜å®ã€‘%s æ‰«ç æ”¯ä»˜äº† %d å…ƒ\\n&quot;, a.AccountName, amount)\n}\n \n//ç±»å‹2\ntype Cash struct {\n\tBalance int // ä½™é¢\n}\n// å®ç° Pay æ–¹æ³•\n// æ³¨æ„ï¼šè¿™é‡Œä½¿ç”¨çš„æ˜¯ã€æŒ‡é’ˆæ¥æ”¶è€…ã€‘ (c *Cash)\n// æ„æ€ï¼šç°é‡‘æ”¯ä»˜ä¼šå‡å°‘æˆ‘çš„ä½™é¢ï¼Œå¿…é¡»ä¿®æ”¹å†…éƒ¨æ•°æ®ï¼\nfunc (c *Cash) Pay(amount int) {\n\tif c.Balance &gt;= amount {\n\t\tc.Balance -= amount // ä¿®æ”¹äº†ç»“æ„ä½“å†…éƒ¨çš„å€¼\n\t\tfmt.Printf(&quot;ã€ç°é‡‘ã€‘ä»é’±åŒ…æ‰£æ¬¾ %d å…ƒï¼Œå‰©ä½™ %d å…ƒ\\n&quot;, amount, c.Balance)\n\t} else {\n\t\tfmt.Println(&quot;ã€ç°é‡‘ã€‘ä½™é¢ä¸è¶³ï¼&quot;)\n\t}\n}\n \n//å¤šæ€å‡½æ•°\nfunc Checkout(p Payer, price int) {\n\tfmt.Println(&quot;&gt;&gt;&gt; å¼€å§‹ç»“è´¦...&quot;)\n\tp.Pay(price) // å¤šæ€è°ƒç”¨\n\tfmt.Println(&quot;&gt;&gt;&gt; ç»“è´¦å®Œæˆ\\n&quot;)\n}\n \n \n//mainå‡½æ•°\nfunc main() {\n\t// åœºæ™¯ 1ï¼šä½¿ç”¨æ”¯ä»˜å® (å€¼æ¥æ”¶è€…)\n\tmyAlipay := Alipay{AccountName: &quot;Deng&#039;s Phone&quot;}\n\tCheckout(myAlipay, 100) \n\t// ä¼ å…¥å€¼ myAlipay æ²¡é—®é¢˜ï¼Œå› ä¸ºå®ƒçš„æ–¹æ³•æ˜¯å€¼æ¥æ”¶è€…\n \n\t// åœºæ™¯ 2ï¼šä½¿ç”¨ç°é‡‘ (æŒ‡é’ˆæ¥æ”¶è€…)\n\tmyWallet := Cash{Balance: 500}\n\tCheckout(myWallet, 200) //âŒ\n\tCheckout(&amp;myWallet, 200) \n\t// âœ… å¿…é¡»ä¼ å…¥åœ°å€ (&amp;myWallet)\n\t// å› ä¸º Cash çš„ Pay æ–¹æ³•æ˜¯æŒ‚åœ¨æŒ‡é’ˆä¸Šçš„,æ‰€ä»¥ä¼šè®¤ä¸ºæŒ‡é’ˆæ‰æ˜¯å®é™…çš„payer\n}\nä½¿ç”¨2\nIHeapå®šä¹‰çš„Popå‡½æ•°,ä¼šè¢«ä½œä¸ºheap.Popçš„ä¸€éƒ¨åˆ†è¢«è°ƒç”¨.\nheap.Popä¼šå…ˆæŠŠæŸä¸ªå…ƒç´ æ¢åˆ°æœ€åé¢,ç„¶åæˆ‘ç”¨è‡ªå·±çš„Popæ–¹æ³•å»æŠŠæœ€åä¸€ä¸ªå…ƒç´ åˆ‡æ‰.\nç©ºæ¥å£\n\nä½œä¸ºé€šç”¨ä¸‡èƒ½ç±»å‹:ç©ºæ¥å£interface{}\nå¯ä»¥ç”¨interface{}ç±»å‹å¼•ç”¨ä»»æ„çš„æ•°æ®ç±»å‹   [goä¸­æ•°æ®ç±»å‹åŸºæœ¬éƒ½å®ç°äº†è¿™ä¸ªç©ºæ¥å£]\n\næ–­è¨€\nå¦‚æœæ–­è¨€æˆåŠŸäº†,è¿™ä¸ªç±»å‹å°±ä»ä¸€ä¸ªç©ºæ¥å£å˜æˆäº†ä¸€ä¸ªå…·ä½“çš„ç±»å‹,å¯ä»¥è®¤ä¸ºæ˜¯åšäº†ä¸€ä¸ªç±»å‹è½¬æ¢äº†\n// è¯­æ³•ï¼š value, ok := æ¥å£å˜é‡.(ç›®æ ‡ç±»å‹)\nrealValue, ok := x.([2]int)\n \nif ok {\n    // æˆåŠŸï¼\n    // realValue ç°åœ¨æ˜¯ [2]int ç±»å‹ï¼Œå¯ä»¥æ”¾å¿ƒç”¨\n    fmt.Println(&quot;æˆåŠŸæ‹¿åˆ°æ•°ç»„ï¼š&quot;, realValue)\n} else {\n    // å¤±è´¥ï¼\n    // x é‡Œè£…çš„æ ¹æœ¬ä¸æ˜¯ [2]intï¼Œå¯èƒ½æ˜¯åˆ«çš„ï¼Œæˆ–è€… x æ˜¯ nil\n    // æ­¤æ—¶ç¨‹åºä¸ä¼šå´©ï¼ŒrealValue ä¼šæ˜¯é›¶å€¼\n    fmt.Println(&quot;ç±»å‹ä¸å¯¹ï¼Œä¸æ˜¯æ•°ç»„&quot;)\n}\n \n \n// è¯­æ³•ï¼š value := æ¥å£å˜é‡.(ç›®æ ‡ç±»å‹) \nrealValue := x.([2]int) // åªæœ‰è¿™ä¸€è¡Œï¼Œæ²¡æœ‰ ok\n \n \n \n\nå…³äºæŒ‡é’ˆ\nå¦‚æœæ–¹æ³•å®šä¹‰åœ¨å€¼ä¸Š,å°±ç®—æŠŠæŒ‡é’ˆæ‹¿å»è°ƒç”¨æ¥å£,ä¹Ÿæ˜¯æˆç«‹çš„.\nå› ä¸ºç¼–è¯‘å™¨å…è®¸ä½ ç”¨ *Cat ç±»å‹çš„æŒ‡é’ˆå»è°ƒç”¨ Cat ç±»å‹ï¼ˆå€¼ï¼‰çš„æ–¹æ³•ï¼Œæ‰€ä»¥ Go è®¤ä¸º *Catï¼ˆæŒ‡é’ˆï¼‰å’Œ Catï¼ˆå€¼ï¼‰éƒ½å®ç°äº†è¿™ä¸ªæ¥å£\nä½†æ˜¯å¦‚æœæ–¹æ³•å®šä¹‰åœ¨æŒ‡é’ˆä¸Š,ç”¨å€¼å»è°ƒç”¨æ¥å£æ˜¯ä¸è¡Œçš„."},"æŠ€æœ¯ç§¯ç´¯/Golang/è¯­æ³•ç‰¹æ€§/å¤§å°å†™ä¸ä½œç”¨åŸŸ":{"slug":"æŠ€æœ¯ç§¯ç´¯/Golang/è¯­æ³•ç‰¹æ€§/å¤§å°å†™ä¸ä½œç”¨åŸŸ","filePath":"æŠ€æœ¯ç§¯ç´¯/Golang/è¯­æ³•ç‰¹æ€§/å¤§å°å†™ä¸ä½œç”¨åŸŸ.md","title":"å¤§å°å†™ä¸ä½œç”¨åŸŸ","links":[],"tags":[],"content":"\nç»“æ„ä½“é¦–å­—æ¯å¤§å†™: åˆ«çš„åŒ…éœ€è¦æ ¹æ®è¿™ä¸ªå›¾çº¸æ¥å®šä¹‰å˜é‡.\nå…·ä½“çš„å¯¹è±¡é¦–å­—æ¯å°å†™: å¦‚æœè¦ç”¨åˆ°çš„è¯ å°±è°ƒç”¨ä¸€ä¸ªé¦–å­—æ¯å¤§å†™çš„Getå‡½æ•°,ç„¶åå¤åˆ¶ä¸€ä¸ªå¯¹è±¡çš„å€¼å‡ºæ¥.\nå…·ä½“å¯¹è±¡å†…éƒ¨å­—æ®µçš„é¦–å­—æ¯å¤§å†™: è¿™æ ·å¯ä»¥åœ¨å¤åˆ¶å‡ºå¯¹è±¡ä¹‹å,è·å–ä»–å†…éƒ¨çš„å€¼.\n"},"æŠ€æœ¯ç§¯ç´¯/Golang/è¯­æ³•ç‰¹æ€§/æœªå‘½å":{"slug":"æŠ€æœ¯ç§¯ç´¯/Golang/è¯­æ³•ç‰¹æ€§/æœªå‘½å","filePath":"æŠ€æœ¯ç§¯ç´¯/Golang/è¯­æ³•ç‰¹æ€§/æœªå‘½å.md","title":"æœªå‘½å","links":[],"tags":[],"content":""},"æŠ€æœ¯ç§¯ç´¯/Golang/è¯­æ³•ç‰¹æ€§/è¯­æ³•ç»†èŠ‚":{"slug":"æŠ€æœ¯ç§¯ç´¯/Golang/è¯­æ³•ç‰¹æ€§/è¯­æ³•ç»†èŠ‚","filePath":"æŠ€æœ¯ç§¯ç´¯/Golang/è¯­æ³•ç‰¹æ€§/è¯­æ³•ç»†èŠ‚.md","title":"è¯­æ³•ç»†èŠ‚","links":[],"tags":[],"content":"å˜é‡å£°æ˜ä¸è¿ç®—é€»è¾‘\n\nå·¦å¤§æ‹¬å·ä¸èƒ½å•ç‹¬ä¸€è¡Œã€‚\nä¸å…è®¸æœ‰æœªä½¿ç”¨çš„å˜é‡å’Œimportï¼Œå¿…é¡»ç”¨â€”â€”åˆ«åæ¥å¿½ç•¥\nåœ¨ifæˆ–è€…ä»£ç å—å†…ä½¿ç”¨:=å¯èƒ½ä¼šæ„å¤–è¦†ç›–åŒåå˜é‡ï¼Œå¯¼è‡´å¤–éƒ¨å˜é‡æ²¡æœ‰è¢«ä¿®æ”¹\n:=åªèƒ½åœ¨å‡½æ•°å†…éƒ¨ä½¿ç”¨,ä¸”ä¸èƒ½ç”¨äºè®¾ç½®ç»“æ„ä½“å­—æ®µ\nä¸è¦ç”¨nilåˆå§‹åŒ–æœªæŒ‡å®šç±»å‹çš„å˜é‡\nè‡ªå¢è‡ªå‡åªæœ‰åç½®,æ²¡æœ‰å‰ç½®\n\nå…¶ä»–\n\næ¥å£çš„åº•å±‚æ˜¯(Type,Value),åªæœ‰(nil,nil)æ‰æ˜¯nil.\n\n"},"æŠ€æœ¯ç§¯ç´¯/å…´è¶£é©±åŠ¨çš„å¾…å­¦æ¸…å•":{"slug":"æŠ€æœ¯ç§¯ç´¯/å…´è¶£é©±åŠ¨çš„å¾…å­¦æ¸…å•","filePath":"æŠ€æœ¯ç§¯ç´¯/å…´è¶£é©±åŠ¨çš„å¾…å­¦æ¸…å•.md","title":"å…´è¶£é©±åŠ¨çš„å¾…å­¦æ¸…å•","links":[],"tags":[],"content":"\nPythonçˆ¬è™«\nJSé€†å‘\n"},"æŠ€æœ¯ç§¯ç´¯/æ‚é¡¹/JSON":{"slug":"æŠ€æœ¯ç§¯ç´¯/æ‚é¡¹/JSON","filePath":"æŠ€æœ¯ç§¯ç´¯/æ‚é¡¹/JSON.md","title":"JSON","links":[],"tags":[],"content":"ä¸ºäº†ä¸€ä¸ªé¡¹ç›®ä¸åŒè¯­è¨€é—´çš„äº¤æµ,è®¾è®¡çš„æ ‡å‡†æ ¼å¼.\nJSON(JavaScript Object Notation)æœ¬è´¨ä¸Šå°±æ˜¯ä¸€æ®µ çº¯æ–‡æœ¬ï¼ˆStringï¼‰ï¼Œé•¿å¾—éå¸¸æœ‰è§„å¾‹ã€‚ä¸ç®¡æ˜¯ C++ã€Goã€Java è¿˜æ˜¯ Pythonï¼Œéƒ½èƒ½è¯»å†™ã€‚\n{\n    &quot;stackIn&quot;: &quot;å¯¹è±¡1&quot;,\n    &quot;stackOut&quot;: &quot;å¯¹è±¡2&quot;\n}"},"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/1143.-æœ€é•¿å…¬å…±å­åºåˆ—":{"slug":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/1143.-æœ€é•¿å…¬å…±å­åºåˆ—","filePath":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/1143. æœ€é•¿å…¬å…±å­åºåˆ—.md","title":"1143. æœ€é•¿å…¬å…±å­åºåˆ—","links":[],"tags":[],"content":"ç»™å®šä¸¤ä¸ªå­—ç¬¦ä¸²Â text1Â å’ŒÂ text2ï¼Œè¿”å›è¿™ä¸¤ä¸ªå­—ç¬¦ä¸²çš„æœ€é•¿Â å…¬å…±å­åºåˆ—Â çš„é•¿åº¦ã€‚å¦‚æœä¸å­˜åœ¨Â å…¬å…±å­åºåˆ—Â ï¼Œè¿”å›Â 0Â ã€‚\nä¸€ä¸ªå­—ç¬¦ä¸²çš„Â å­åºåˆ—Â æ˜¯æŒ‡è¿™æ ·ä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²ï¼šå®ƒæ˜¯ç”±åŸå­—ç¬¦ä¸²åœ¨ä¸æ”¹å˜å­—ç¬¦çš„ç›¸å¯¹é¡ºåºçš„æƒ…å†µä¸‹åˆ é™¤æŸäº›å­—ç¬¦ï¼ˆä¹Ÿå¯ä»¥ä¸åˆ é™¤ä»»ä½•å­—ç¬¦ï¼‰åç»„æˆçš„æ–°å­—ç¬¦ä¸²ã€‚\n\nä¾‹å¦‚ï¼Œ&quot;ace&quot;Â æ˜¯Â &quot;abcde&quot;Â çš„å­åºåˆ—ï¼Œä½†Â &quot;aec&quot;Â ä¸æ˜¯Â &quot;abcde&quot;Â çš„å­åºåˆ—ã€‚\nä¸¤ä¸ªå­—ç¬¦ä¸²çš„Â å…¬å…±å­åºåˆ—Â æ˜¯è¿™ä¸¤ä¸ªå­—ç¬¦ä¸²æ‰€å…±åŒæ‹¥æœ‰çš„å­åºåˆ—ã€‚\n\nå°è®°\næ„Ÿè§‰å­—ç¬¦ä¸²åºåˆ—çš„é—®é¢˜å¾ˆå¤šéƒ½æ˜¯å€’ç€æƒ³çš„å¹¶ä¸”ä¸»è¦æ˜¯é€‰å’Œä¸é€‰çš„è¿™ä¹ˆä¸€ä¸ªæ€æƒ³,éœ€è¦ç‰¹åˆ«æ³¨æ„.\næ€ä¹ˆæƒ³å‡ºæ¥çš„?\n\nä»è¿™ä¸¤ä¸ªå­—ç¬¦ä¸²çš„æœ€åä¸€ä¸ªå­—ç¬¦å¼€å§‹çœ‹.å¦‚æœæœ«å°¾ä¸€æ ·,è¯´æ˜è¿™ä¸ªå­—ç¬¦ä¸€å®šåœ¨æœ€é•¿å…¬å…±å­åºåˆ—é‡Œé¢\nå¦‚æœæœ«å°¾ä¸ä¸€æ ·,æ„å‘³ç€è¿™ä¸¤ä¸ªå­—ç¬¦ä¸å¯èƒ½åŒæ—¶æ˜¯lcsçš„ç»“å°¾,ä½†æ˜¯å…¶ä¸­ä¸€ä¸ªæ˜¯æœ‰å¯èƒ½çš„,äºæ˜¯è¿›è¡Œä¸‹ä¸€æ­¥å°è¯•(ä¸¤ä¸ªåˆ†æ”¯).ç„¶åç»“æœå°±åº”è¯¥æ˜¯max(å°è¯•1,å°è¯•2)çš„é•¿åº¦.\ndpå°±æ˜¯å¸¦å¤‡å¿˜å½•çš„é€’å½’.å› ä¸ºä¸åŒçš„åˆ†æ”¯æœ€åå¯èƒ½å˜æˆä¸€ä¸ªå¾ˆå¤§çš„æ ‘,ä½†æ˜¯æ¯”å¦‚dfs44å°±å¯èƒ½è¢«å¾ˆå¤šæ¬¡ä½¿ç”¨,æ‰€ä»¥å­˜ä¸‹æ¥æ¯”è¾ƒå¥½.æ²¡è¿›è¡Œè®¡ç®—è¿‡çš„ä¼šæ˜¯åˆå§‹å€¼-1,æ£€æµ‹åˆ°-1å°±è¦è®¡ç®—.å¦‚æœæ£€æµ‹åˆ°ä¸æ˜¯-1è¯´æ˜å·²ç»æœ‰è®¡ç®—è¿‡çš„ç»“æœäº† å¯ä»¥ç›´æ¥æ‹¿æ¥ç”¨.\n\nä¸€ç»´æ•°ç»„å†™æ³•è¦æ³¨æ„,è¿™é‡Œå› ä¸ºéœ€è¦ä¸Šä¸€è¡Œçš„å·¦ä¸Šè§’,æ‰€ä»¥éœ€è¦é¢å¤–çš„å¤„ç†\nä»£ç \nfunc longestCommonSubsequence(s, t string) int {\n    n, m := len(s), len(t)\n    f := make([][]int, n+1)\n    for i := range f {\n        f[i] = make([]int, m+1)\n    }\n    for i, x := range s {\n        for j, y := range t {\n            if x == y {\n                f[i+1][j+1] = f[i][j] + 1\n            } else {\n                f[i+1][j+1] = max(f[i][j+1], f[i+1][j])\n            }\n        }\n    }\n    return f[n][m]\n}\n \n \nfunc longestCommonSubsequence(text1 string, text2 string) int {\n     m := len(text2)\n     f:=make([]int,m+1)\n     for _,x:=range text1{\n        pre:=0\n        for j,y:=range text2{\n            if x==y{\n                f[j+1],pre=pre+1,f[j+1]\n            }else{\n                pre = f[j+1]\n                f[j+1]=max(f[j+1],f[j])\n            }\n        }\n     }\n     return f[m]\n}"},"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/128.-æœ€é•¿è¿ç»­åºåˆ—":{"slug":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/128.-æœ€é•¿è¿ç»­åºåˆ—","filePath":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/128. æœ€é•¿è¿ç»­åºåˆ—.md","title":"128. æœ€é•¿è¿ç»­åºåˆ—","links":[],"tags":[],"content":"ç»™å®šä¸€ä¸ªæœªæ’åºçš„æ•´æ•°æ•°ç»„Â numsÂ ï¼Œæ‰¾å‡ºæ•°å­—è¿ç»­çš„æœ€é•¿åºåˆ—ï¼ˆä¸è¦æ±‚åºåˆ—å…ƒç´ åœ¨åŸæ•°ç»„ä¸­è¿ç»­ï¼‰çš„é•¿åº¦ã€‚\nè¯·ä½ è®¾è®¡å¹¶å®ç°æ—¶é—´å¤æ‚åº¦ä¸ºÂ O(n)Â çš„ç®—æ³•è§£å†³æ­¤é—®é¢˜ã€‚\næ’åºç‰ˆO(N \\log N)\nfunc longestConsecutive(nums []int) int {\n    //ç›´è§‰ä¸Š:æŒ‰é¡ºåºåŒ¹é…å‡ºæ¥æ”¾åˆ°æ–°æ•°ç»„é‡Œé¢,ä½†æ˜¯å¯æƒ³è€ŒçŸ¥æ—¶é—´å¤æ‚åº¦åº”è¯¥å¾ˆçˆ†ç‚¸çš„\n    //å…ˆæ’åº.ç„¶åå¿«æ…¢æŒ‡é’ˆéå†?æ…¢æŒ‡é’ˆæŒ‡å‘ç¬¬ä¸€ä¸ªè¿ç»­,å¿«æŒ‡é’ˆä¸€ç›´éå†.å¦‚æœé‡åˆ°ä¸è¿ç»­çš„å°±æŠŠæ…¢æŒ‡é’ˆæ¢è¿‡å»ä»å¤´å¼€å§‹è®¡ç®—.\n    slices.Sort(nums)\n    slow:=0\n    res:=0\n    cnt:=0\n    for fast,c:=range nums{\n        if fast&gt;0&amp;&amp;c!=nums[fast-1]&amp;&amp;c!=nums[fast-1]+1{\n            slow=fast\n        }\n        cnt=nums[fast]-nums[slow]+1\n        res=max(res,cnt)\n    }\n    return res\n}\nO(n)ç‰ˆ\nå°è®°\n\nç”¨å“ˆå¸Œè¡¨,å¯ä»¥è‡ªåŠ¨å»é‡\nä»å°¾å¾€å‰è®¡ç®—,å¦‚æœå¯¹äºx, x-1åœ¨å“ˆå¸Œè¡¨ä¸­,é‚£ä¹ˆè¯´æ˜xå¹¶ä¸æ˜¯è¿ç»­åºåˆ—çš„èµ·ç‚¹.\nå°ä¼˜åŒ–: å¦‚æœç›®å‰å·²æœ‰çš„è¿ç»­åºåˆ—å·²ç»å¤§äºå‰©ä¸‹çš„ä¸é‡å¤æ•°å­—çš„ä¸ªæ•°äº†,é‚£ä¹ˆè¯´æ˜æ²¡å¿…è¦å†å¾€ä¸‹æ‰¾äº†\n\nä»£ç \nfunc longestConsecutive(nums []int) (ans int) {\n    has := map[int]bool{}\n    for _, num := range nums {\n        has[num] = true // æŠŠ nums è½¬æˆå“ˆå¸Œé›†åˆ\n    }\n \n    for x := range has { // éå†å“ˆå¸Œé›†åˆ\n        if has[x-1] { // å¦‚æœ x ä¸æ˜¯åºåˆ—çš„èµ·ç‚¹ï¼Œç›´æ¥è·³è¿‡\n            continue\n        }\n        // x æ˜¯åºåˆ—çš„èµ·ç‚¹\n        y := x + 1\n        for has[y] { // ä¸æ–­æŸ¥æ‰¾ä¸‹ä¸€ä¸ªæ•°æ˜¯å¦åœ¨å“ˆå¸Œé›†åˆä¸­\n            y++\n        }\n        // å¾ªç¯ç»“æŸåï¼Œy-1 æ˜¯æœ€åä¸€ä¸ªåœ¨å“ˆå¸Œé›†åˆä¸­çš„æ•°\n        ans = max(ans, y-x) // ä» x åˆ° y-1 ä¸€å…± y-x ä¸ªæ•°\n    }\n    return\n}\n "},"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/146.-LRUç¼“å­˜":{"slug":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/146.-LRUç¼“å­˜","filePath":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/146. LRUç¼“å­˜.md","title":"146. LRUç¼“å­˜","links":[],"tags":[],"content":"è¯·ä½ è®¾è®¡å¹¶å®ç°ä¸€ä¸ªæ»¡è¶³LRU (æœ€è¿‘æœ€å°‘ä½¿ç”¨) ç¼“å­˜çº¦æŸçš„æ•°æ®ç»“æ„ã€‚\nå®ç°Â LRUCacheÂ ç±»ï¼š\n\nLRUCache(int capacity)Â ä»¥Â æ­£æ•´æ•°Â ä½œä¸ºå®¹é‡Â capacityÂ åˆå§‹åŒ– LRU ç¼“å­˜\nint get(int key)Â å¦‚æœå…³é”®å­—Â keyÂ å­˜åœ¨äºç¼“å­˜ä¸­ï¼Œåˆ™è¿”å›å…³é”®å­—çš„å€¼ï¼Œå¦åˆ™è¿”å›Â -1Â ã€‚\nvoid put(int key, int value)Â å¦‚æœå…³é”®å­—Â keyÂ å·²ç»å­˜åœ¨ï¼Œåˆ™å˜æ›´å…¶æ•°æ®å€¼Â valueÂ ï¼›å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™å‘ç¼“å­˜ä¸­æ’å…¥è¯¥ç»„Â key-valueÂ ã€‚å¦‚æœæ’å…¥æ“ä½œå¯¼è‡´å…³é”®å­—æ•°é‡è¶…è¿‡Â capacityÂ ï¼Œåˆ™åº”è¯¥Â é€å‡ºÂ æœ€ä¹…æœªä½¿ç”¨çš„å…³é”®å­—ã€‚\n\nå‡½æ•°Â getÂ å’ŒÂ putÂ å¿…é¡»ä»¥Â O(1)Â çš„å¹³å‡æ—¶é—´å¤æ‚åº¦è¿è¡Œã€‚\nå°è®°\nä»£ç \ntype Node struct {\n    key, value int\n    prev, next *Node\n}\n \ntype LRUCache struct {\n    capacity  int\n    dummy     *Node // å“¨å…µèŠ‚ç‚¹\n    keyToNode map[int]*Node\n}\n \nfunc Constructor(capacity int) LRUCache {\n    dummy := &amp;Node{}\n    dummy.prev = dummy\n    dummy.next = dummy\n    return LRUCache{\n        capacity:  capacity,\n        dummy:     dummy,\n        keyToNode: map[int]*Node{},\n    }\n}\n \n// åˆ é™¤ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆæŠ½å‡ºä¸€æœ¬ä¹¦ï¼‰\nfunc (c *LRUCache) remove(x *Node) {\n    x.prev.next = x.next\n    x.next.prev = x.prev\n}\n \n// åœ¨é“¾è¡¨å¤´æ·»åŠ ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆæŠŠä¸€æœ¬ä¹¦æ”¾åˆ°æœ€ä¸Šé¢ï¼‰\nfunc (c *LRUCache) pushFront(x *Node) {\n    x.prev = c.dummy\n    x.next = c.dummy.next\n    x.prev.next = x\n    x.next.prev = x\n}\n \n// è·å– key å¯¹åº”çš„èŠ‚ç‚¹ï¼ŒåŒæ—¶æŠŠè¯¥èŠ‚ç‚¹ç§»åˆ°é“¾è¡¨å¤´éƒ¨\nfunc (c *LRUCache) getNode(key int) *Node {\n    node := c.keyToNode[key]\n    if node == nil { // æ²¡æœ‰è¿™æœ¬ä¹¦\n        return nil\n    }\n    c.remove(node)    // æŠŠè¿™æœ¬ä¹¦æŠ½å‡ºæ¥\n    c.pushFront(node) // æ”¾åˆ°æœ€ä¸Šé¢\n    return node\n}\n \nfunc (c *LRUCache) Get(key int) int {\n    node := c.getNode(key) // getNode ä¼šæŠŠå¯¹åº”èŠ‚ç‚¹ç§»åˆ°é“¾è¡¨å¤´éƒ¨\n    if node == nil {\n        return -1\n    }\n    return node.value\n}\n \nfunc (c *LRUCache) Put(key, value int) {\n    node := c.getNode(key) // getNode ä¼šæŠŠå¯¹åº”èŠ‚ç‚¹ç§»åˆ°é“¾è¡¨å¤´éƒ¨\n    if node != nil {       // æœ‰è¿™æœ¬ä¹¦\n        node.value = value // æ›´æ–° value\n        return\n    }\n    node = &amp;Node{key: key, value: value} // æ–°ä¹¦\n    c.keyToNode[key] = node\n    c.pushFront(node) // æ”¾åˆ°æœ€ä¸Šé¢\n    if len(c.keyToNode) &gt; c.capacity { // ä¹¦å¤ªå¤šäº†\n        backNode := c.dummy.prev\n        delete(c.keyToNode, backNode.key)\n        c.remove(backNode) // å»æ‰æœ€åä¸€æœ¬ä¹¦\n    }\n}\n \n "},"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/199.-äºŒå‰æ ‘çš„å³è§†å›¾":{"slug":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/199.-äºŒå‰æ ‘çš„å³è§†å›¾","filePath":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/199. äºŒå‰æ ‘çš„å³è§†å›¾.md","title":"199. äºŒå‰æ ‘çš„å³è§†å›¾","links":[],"tags":[],"content":"å°è®°\nå°±æ˜¯æŒ‰ç…§æ ¹å³å·¦çš„æ–¹å¼æ·±åº¦éå†,å½“depth==len(ans)[ä¹Ÿå°±æ˜¯ç¬¬ä¸€æ¬¡åˆ°è¾¾è¿™ä¸ªæ·±åº¦,ä¹Ÿå°±æ˜¯å³è¾¹ç¬¬ä¸€ä¸ªèŠ‚ç‚¹]çš„æ—¶å€™å°†å½“å‰èŠ‚ç‚¹çš„å€¼åŠ å…¥ansæ•°ç»„.\nä»£ç \n "},"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/20.-æœ‰æ•ˆçš„æ‹¬å·":{"slug":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/20.-æœ‰æ•ˆçš„æ‹¬å·","filePath":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/20. æœ‰æ•ˆçš„æ‹¬å·.md","title":"20. æœ‰æ•ˆçš„æ‹¬å·","links":["tags/flashcard"],"tags":["flashcard"],"content":"\næœ‰æ•ˆçš„æ‹¬å·\nç»™å®šä¸€ä¸ªåªåŒ…æ‹¬Â &#039;(&#039;ï¼Œ&#039;)&#039;ï¼Œ&#039;{&#039;ï¼Œ&#039;}&#039;ï¼Œ&#039;[&#039;ï¼Œ&#039;]&#039;Â çš„å­—ç¬¦ä¸²Â sÂ ï¼Œåˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦æœ‰æ•ˆã€‚\næœ‰æ•ˆå­—ç¬¦ä¸²éœ€æ»¡è¶³ï¼š\n\n\nå·¦æ‹¬å·å¿…é¡»ç”¨ç›¸åŒç±»å‹çš„å³æ‹¬å·é—­åˆã€‚\nå·¦æ‹¬å·å¿…é¡»ä»¥æ­£ç¡®çš„é¡ºåºé—­åˆã€‚\næ¯ä¸ªå³æ‹¬å·éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„ç›¸åŒç±»å‹çš„å·¦æ‹¬å·ã€‚ flashcard\n\nå°è®°\n\nå¯ä»¥é‡åˆ°å·¦æ‹¬å·çš„æ—¶å€™,ç›´æ¥æŠŠå¯¹åº”å³æ‹¬å·å…¥æ ˆ.ç„¶åæ¶ˆé™¤çš„æ—¶å€™é€»è¾‘å°±ä¼šå˜å¾—ç®€å•,è¿˜å¯ä»¥ç»Ÿä¸€å¤„ç†.\nè¿˜å¯ä»¥åšå‰ªæ,å¦‚æœæ€»é•¿åº¦ä¸æ˜¯å¶æ•°å¯ä»¥ç›´æ¥return false\n\nä»£ç \nfunc isValid(s string) bool {\n    // 1. é€»è¾‘å‰ªæï¼šå¥‡æ•°é•¿åº¦ç»å¯¹ä¸å¯èƒ½æœ‰æ•ˆ\n    if len(s)%2 != 0 {\n        return false\n    }\n    // å‘½åä¼˜åŒ–ï¼šcnt -&gt; stackï¼Œæ˜ç¡®è¿™æ˜¯ä¸ªæ ˆ\n    stack := []rune{}\n    for _, c := range s {\n        // 2. è½¬æ¢æ€ç»´ï¼šé‡åˆ°å·¦æ‹¬å·ï¼ŒæŠŠ&quot;æœªæ¥æœŸå¾…çš„å³æ‹¬å·&quot;å…¥æ ˆ\n        // è¿™æ ·å°±æŠŠå¤æ‚åº¦åˆ†æ‘Šåˆ°äº† switch ä¸­ï¼Œè€Œä¸æ˜¯å †ç§¯åœ¨åé¢çš„ if åˆ¤æ–­é‡Œ\n        switch c {\n        case &#039;(&#039;:\n            stack = append(stack, &#039;)&#039;)\n        case &#039;[&#039;:\n            stack = append(stack, &#039;]&#039;)\n        case &#039;{&#039;:\n            stack = append(stack, &#039;}&#039;)\n        default:\n            // 3. ç»Ÿä¸€é€»è¾‘ï¼šå¤„ç†å³æ‹¬å·\n            // åªè¦æ ˆç©ºäº†ï¼Œæˆ–è€…æ ˆé¡¶ä¸æ˜¯æˆ‘æœŸå¾…çš„é‚£ä¸ªå­—ç¬¦ï¼Œç›´æ¥æŒ‚æ‰\n            if len(stack) == 0 || stack[len(stack)-1] != c {\n                return false\n            }\n            // åŒ¹é…æˆåŠŸï¼Œæ¶ˆé™¤å¾…åŠäº‹é¡¹\n            stack = stack[:len(stack)-1]\n        }\n    }\n    // 4. æœ€ç»ˆçŠ¶æ€æ£€æŸ¥ï¼šæ‰€æœ‰æœŸå¾…éƒ½æ»¡è¶³äº†å—ï¼Ÿ\n    return len(stack) == 0 //è¿™ä¸ªä¹Ÿæ˜æ˜¾æ¯”æˆ‘è‡ªå·±å†™çš„æ›´ç²¾ç®€!å­¦ä¹ å­¦ä¹ \n}"},"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/287.-å¯»æ‰¾é‡å¤æ•°":{"slug":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/287.-å¯»æ‰¾é‡å¤æ•°","filePath":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/287. å¯»æ‰¾é‡å¤æ•°.md","title":"287. å¯»æ‰¾é‡å¤æ•°","links":[],"tags":[],"content":"ç»™å®šä¸€ä¸ªåŒ…å«Â n + 1Â ä¸ªæ•´æ•°çš„æ•°ç»„Â numsÂ ï¼Œå…¶æ•°å­—éƒ½åœ¨Â [1, n]Â èŒƒå›´å†…ï¼ˆåŒ…æ‹¬Â 1Â å’ŒÂ nï¼‰ï¼Œå¯çŸ¥è‡³å°‘å­˜åœ¨ä¸€ä¸ªé‡å¤çš„æ•´æ•°ã€‚\nå‡è®¾Â numsÂ åªæœ‰Â ä¸€ä¸ªé‡å¤çš„æ•´æ•°Â ï¼Œè¿”å›Â è¿™ä¸ªé‡å¤çš„æ•°Â ã€‚\nä½ è®¾è®¡çš„è§£å†³æ–¹æ¡ˆå¿…é¡»Â ä¸ä¿®æ”¹Â æ•°ç»„Â numsÂ ä¸”åªç”¨å¸¸é‡çº§Â O(1)Â çš„é¢å¤–ç©ºé—´ã€‚\nå°è®°\næ•°ç»„é•¿åº¦æ˜¯ n+1ã€‚æ•°å€¼èŒƒå›´æ˜¯ 1 åˆ° nã€‚è¿™æ„å‘³ç€ï¼šæ•°ç»„é‡Œçš„ä»»ä½•ä¸€ä¸ªå€¼ï¼Œéƒ½ä¸€å®šæ˜¯ä¸€ä¸ªåˆæ³•çš„ã€é 0 çš„ä¸‹æ ‡ç´¢å¼•\n\nç¡®å®šç¯å†…çš„æŸä¸ªç›¸é‡ç‚¹\nç„¶åæ ¹æ®æ¨å¯¼å¯ä»¥å‘ç°,ä»èµ·ç‚¹èµ°åˆ°ç¯å…¥å£çš„è·ç¦»,æ°å¥½ç­‰äºä»ç›¸é‡ç‚¹ç»§ç»­å¾€å‰èµ°åˆ°ç¯å…¥å£çš„è·ç¦».æ‰€ä»¥è¦å†æ‰¾ä¸€ä¸ªhead,å’Œslowä¸€èµ·å‘å‰èµ°ç›´åˆ°ç›¸é‡(ä¸‹æ ‡æŒ‡å‘åŒä¸€ä¸ªèŠ‚ç‚¹ å°±è¯´æ˜ç›¸é‡ ç›¸é‡å°±è¯´æ˜ä¸€å®šæ˜¯å…¥å£ è¿™æ˜¯ç»è¿‡æ•°å­¦æ¨å¯¼çš„)\n\nä»£ç \nfunc findDuplicate(nums []int) int {\n    //åªèƒ½ç”¨o(1)å°±æ˜¯ä¸èƒ½ç”¨map ä¸ä¿®æ”¹æ•°ç»„å°±æ˜¯ä¸èƒ½æ’åº.\n    //é‚£å°±è¦ç‰ºç‰²æ—¶é—´å¤æ‚åº¦äº† èµ°ä¸¤ä¸ªå¾ªç¯è¿˜æ˜¯å¯ä»¥è§£å‡ºæ¥çš„,ä½†æ˜¯æœ‰æ²¡æœ‰æ›´å¥½çš„åŠæ³•å‘¢.. è¿˜æœ‰ç‰¹ç‚¹æ˜¯ éƒ½æ˜¯æ­£æ•° ä½†æ˜¯æ„Ÿè§‰ä¹Ÿç”¨ä¸ä¸Š \n    slow,fast:=0,0\n    for {\n        slow=nums[slow]\n        fast=nums[nums[fast]]\n        if slow==fast{\n            break\n        }\n    }\n    head:=0\n    for slow!=head{\n        slow=nums[slow]\n        head=nums[head]\n    }\n    return slow\n}"},"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/347.-å‰-K-ä¸ªé«˜é¢‘å…ƒç´ ":{"slug":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/347.-å‰-K-ä¸ªé«˜é¢‘å…ƒç´ ","filePath":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/347. å‰ K ä¸ªé«˜é¢‘å…ƒç´ .md","title":"347. å‰ K ä¸ªé«˜é¢‘å…ƒç´ ","links":["tags/flashcard"],"tags":["flashcard"],"content":"\nå‰ K ä¸ªé«˜é¢‘å…ƒç´ \nç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„Â numsÂ å’Œä¸€ä¸ªæ•´æ•°Â kÂ ï¼Œè¯·ä½ è¿”å›å…¶ä¸­å‡ºç°é¢‘ç‡å‰Â kÂ é«˜çš„å…ƒç´ ã€‚ä½ å¯ä»¥æŒ‰Â ä»»æ„é¡ºåºÂ è¿”å›ç­”æ¡ˆã€‚ flashcard\n\nå°è®°\n\nå…ˆç”¨å“ˆå¸Œè¡¨ä¹±åºç»Ÿè®¡æ¬¡æ•°ã€‚\nå†æŠŠæ•°æ®â€œå€’è…¾â€åˆ°ä¸€ä¸ªæ•°ç»„é‡Œï¼Œè®©æ¬¡æ•°æˆä¸ºæ•°ç»„ä¸‹æ ‡ã€‚\næœ€ååˆ©ç”¨æ•°ç»„ä¸‹æ ‡å¤©ç„¶æœ‰åºçš„ç‰¹æ€§ï¼Œä»åå¾€å‰æ‹¿æ•°æ®ï¼Œè‡ªç„¶å°±æ˜¯ Top K äº†ã€‚\n\nä»£ç \nfunc topKFrequent(nums []int, k int) []int {\n    // ç¬¬ä¸€æ­¥ï¼šç»Ÿè®¡æ¯ä¸ªå…ƒç´ çš„å‡ºç°æ¬¡æ•°\n    cnt := map[int]int{}\n    maxCnt := 0\n    for _, x := range nums {\n        cnt[x]++\n        maxCnt = max(maxCnt, cnt[x])\n    }\n    // ç¬¬äºŒæ­¥ï¼šæŠŠå‡ºç°æ¬¡æ•°ç›¸åŒçš„å…ƒç´ ï¼Œæ”¾åˆ°åŒä¸€ä¸ªæ¡¶ä¸­\n    buckets := make([][]int, maxCnt+1)\n    for x, c := range cnt {\n        buckets[c] = append(buckets[c], x)\n    }\n    // ç¬¬ä¸‰æ­¥ï¼šå€’åºéå† bucketsï¼ŒæŠŠå‡ºç°æ¬¡æ•°å‰ k å¤§çš„å…ƒç´ åŠ å…¥ç­”æ¡ˆ\n    ans := make([]int, 0, k) // é¢„åˆ†é…ç©ºé—´\n    // æ³¨æ„é¢˜ç›®ä¿è¯ç­”æ¡ˆå”¯ä¸€ï¼Œä¸€å®šä¼šå‡ºç°æŸæ¬¡ append å len(ans) æ°å¥½ç­‰äº k çš„æƒ…å†µ\n    for i := maxCnt; i &gt;= 0 &amp;&amp; len(ans) &lt; k; i-- {\n        ans = append(ans, buckets[i]...)\n    }\n    return ans\n}\nè¿˜æœ‰æœ´ç´ çš„è§£æ³•å¦‚ä¸‹\nfunc topKFrequent(nums []int, k int) []int {\n    //é¦–å…ˆå“ˆå¸Œç»Ÿè®¡é¢‘ç‡\n    f:=map[int]int{}\n    for _,c:=range nums{\n        f[c]++\n    }\n    //åˆå§‹åŒ–å †.å°†æ¯ä¸ªå…ƒç´ åŠ å…¥å †\n    h:=&amp;Iheap{}\n    heap.Init(h)//å…¶å®è¿™é‡Œä¸initä¹Ÿå¯ä»¥å•Š,åæ­£è°ƒç”¨heapçš„æ—¶å€™å°±æ˜¯ä¼šè‡ªåŠ¨å½“ä½œå †çš„\n    for key,v:=range f{\n        heap.Push(h,[2]int{key,v})\n        if h.Len()&gt;k{\n            heap.Pop(h)\n        }\n    }\n    //å€’åºpopå †å¾—åˆ°ans\n    ans:=make([]int,k)\n    for i:=0;i&lt;k;i++{\n        ans[k-i-1]=heap.Pop(h).([2]int)[0]\n    }\n    return ans\n}\n&lt;!--ID: 1767668518795--&gt;\n \n \ntype Iheap [][2]int\n \nfunc (h Iheap) Len()int{\n    return len(h)\n}\n \nfunc (h Iheap) Swap(i,j int){\n    h[i],h[j]=h[j],h[i]\n}\n \nfunc (h Iheap) Less(i,j int)bool{\n    return h[i][1]&lt;h[j][1]\n}\n \nfunc (h *Iheap) Push(v any){\n    *h=append(*h,v.([2]int))\n}\n \nfunc (h *Iheap) Pop()any{\n    a:=*h\n    n:=len(a)\n    old:=a[n-1]\n    *h=a[:n-1]\n    return old\n}"},"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/39.-ç»„åˆæ€»å’Œ":{"slug":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/39.-ç»„åˆæ€»å’Œ","filePath":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/39. ç»„åˆæ€»å’Œ.md","title":"39. ç»„åˆæ€»å’Œ","links":["tags/flashcard"],"tags":["flashcard"],"content":"\nç»„åˆæ€»å’Œ\nç»™ä½ ä¸€ä¸ªÂ æ— é‡å¤å…ƒç´ Â çš„æ•´æ•°æ•°ç»„Â candidatesÂ å’Œä¸€ä¸ªç›®æ ‡æ•´æ•°Â targetÂ ï¼Œæ‰¾å‡ºÂ candidatesÂ ä¸­å¯ä»¥ä½¿æ•°å­—å’Œä¸ºç›®æ ‡æ•°Â targetÂ çš„ æ‰€æœ‰Â ä¸åŒç»„åˆÂ ï¼Œå¹¶ä»¥åˆ—è¡¨å½¢å¼è¿”å›ã€‚ä½ å¯ä»¥æŒ‰Â ä»»æ„é¡ºåºÂ è¿”å›è¿™äº›ç»„åˆã€‚\ncandidatesÂ ä¸­çš„Â åŒä¸€ä¸ªÂ æ•°å­—å¯ä»¥Â æ— é™åˆ¶é‡å¤è¢«é€‰å–Â ã€‚å¦‚æœè‡³å°‘ä¸€ä¸ªæ•°å­—çš„è¢«é€‰æ•°é‡ä¸åŒï¼Œåˆ™ä¸¤ç§ç»„åˆæ˜¯ä¸åŒçš„ã€‚Â \nå¯¹äºç»™å®šçš„è¾“å…¥ï¼Œä¿è¯å’Œä¸ºÂ targetÂ çš„ä¸åŒç»„åˆæ•°å°‘äºÂ 150Â ä¸ª flashcard\n\nå°è®°\n\nä»£ç \nfunc combinationSum(candidates []int, target int) [][]int {\n    slices.Sort(candidates)\n    path:=[]int{}\n    ans:=[][]int{}\n    var dfs func(i,left int)//å½“å‰candidatesçš„ä¸‹æ ‡\n    dfs=func(i ,left int){\n        if left==0{\n            ans=append(ans,slices.Clone(path))\n            return \n        }\n        for j:=i;j&lt;len(candidates)&amp;&amp;candidates[j]&lt;=left;j++{//å› ä¸ºç°åœ¨candidatesæ˜¯é€’å¢ æ‰€ä»¥å¦‚æœcandidateså·²ç»å¤Ÿäº†çš„è¯å°±ä¸å¾€ä¸‹äº†\n            path=append(path,candidates[j])\n            dfs(j,left-candidates[j])\n            path=path[:len(path)-1]\n        }\n    }\n    dfs(0,target)\n    return ans\n}\n"},"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/437.-è·¯å¾„æ€»å’Œ-III":{"slug":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/437.-è·¯å¾„æ€»å’Œ-III","filePath":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/437. è·¯å¾„æ€»å’Œ III.md","title":"437. è·¯å¾„æ€»å’Œ III","links":[],"tags":[],"content":"ç»™å®šä¸€ä¸ªäºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹Â rootÂ ï¼Œå’Œä¸€ä¸ªæ•´æ•°Â targetSumÂ ï¼Œæ±‚è¯¥äºŒå‰æ ‘é‡ŒèŠ‚ç‚¹å€¼ä¹‹å’Œç­‰äºÂ targetSumÂ çš„Â è·¯å¾„Â çš„æ•°ç›®ã€‚\nè·¯å¾„Â ä¸éœ€è¦ä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œä¹Ÿä¸éœ€è¦åœ¨å¶å­èŠ‚ç‚¹ç»“æŸï¼Œä½†æ˜¯è·¯å¾„æ–¹å‘å¿…é¡»æ˜¯å‘ä¸‹çš„ï¼ˆåªèƒ½ä»çˆ¶èŠ‚ç‚¹åˆ°å­èŠ‚ç‚¹ï¼‰\nå°è®°\n\nå°±æ˜¯æŠŠå½“å‰è·¯å¾„è®°å½•æˆå‰ç¼€å’Œæ•°ç»„.ç„¶åå›åˆ°åˆ†å²”å£å‡†å¤‡èµ°ä¸‹ä¸€æ¡è·¯çš„æ—¶å€™,è®°å¾—æŠŠé”™è¯¯çš„å‰ç¼€å’Œåˆ æ‰\nä»£ç \n/**\n * Definition for a binary tree node.\n * type TreeNode struct {\n *     Val int\n *     Left *TreeNode\n *     Right *TreeNode\n * }\n */\nfunc pathSum(root *TreeNode, targetSum int) int {\n    //æ„Ÿè§‰å¾ˆç†Ÿæ‚‰,åº”è¯¥æ˜¯åŠ¨æ€è§„åˆ’..ä½†æ˜¯æ²¡åšè¿‡äºŒå‰æ ‘çš„åŠ¨æ€è§„åˆ’! æ„Ÿè§‰å¯ä»¥å›æº¯\n    //ä½†æ˜¯ä¸éœ€è¦ä»æ ¹èŠ‚ç‚¹å¼€å§‹ä¹Ÿä¸éœ€è¦åœ¨å­èŠ‚ç‚¹ç»“æŸ æ„Ÿè§‰å¾ˆéš¾å›æº¯\n    ans:=0\n    pre:=map[int]int{0:1}//ç¡®ä¿å‰ç¼€å’Œä¸º0æ˜¯ä¸€ç›´å­˜åœ¨çš„\n    var dfs func(node *TreeNode,s int)\n    dfs=func(node *TreeNode ,s int){\n        if node==nil{\n            return \n        }\n        s+=node.Val\n        ans+=pre[s-targetSum]//ä¹‹å‰æœ‰å¤šå°‘ä¸ªå‰ç¼€å’Œæ˜¯æ»¡è¶³çš„\n        pre[s]++//è¿™ä¸ªè¦çœ‹ è‡ªå·±åˆ°è‡ªå·±çš„ç®—ä¸ç®—åœ¨å†…\n        dfs(node.Left,s)\n        dfs(node.Right,s)\n        pre[s]--\n    }\n    dfs(root,0)\n    return ans\n}"},"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/5.-æœ€é•¿å›æ–‡å­ä¸²":{"slug":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/5.-æœ€é•¿å›æ–‡å­ä¸²","filePath":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/5. æœ€é•¿å›æ–‡å­ä¸².md","title":"5. æœ€é•¿å›æ–‡å­ä¸²","links":["tags/flashcard"],"tags":["flashcard"],"content":"ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸²Â sï¼Œæ‰¾åˆ°Â sÂ ä¸­æœ€é•¿çš„å›æ–‡å­ä¸²ã€‚ flashcard\nå°è®°\n\nå…³é”®æ˜¯æšä¸¾å›æ–‡å­ä¸²çš„ä¸­å¿ƒã€‚\n\nç„¶åä»è¯¥ä¸­å¿ƒè§¦å‘,åˆ†å¥‡æ•°å’Œå¶æ•°ä¸¤ç§æƒ…å†µè®¨è®ºå³å¯\nåœ¨å·¦å³ç›¸ç­‰æ—¶,æŒç»­æ‰©æ•£,ç›´åˆ°æ•°ç»„è¾¹ç•Œ\nä»Šå¤©åˆåšäº†ä¸€éæ²¡æœ‰åšå‡ºæ¥,æ„Ÿè§‰è‡ªå·±è¿˜æ²¡æœ‰ç†è§£åˆ°æ ¸å¿ƒ..\n\n\n\nä»£ç \nfunc longestPalindrome(s string) string {\n    n:=len(s)\n    ans:=0\n    resl:=-1\n    resr:=n\n    for i,_:=range s{\n        l,r:=i,i\n        for l&gt;=0&amp;&amp;r&lt;n&amp;&amp;s[l]==s[r]{\n            ans=max(ans,r-l+1)\n            if ans==r-l+1{\n                resl=l\n                resr=r\n            }\n            l--\n            r++\n        }\n        l,r=i,i+1\n        for l&gt;=0&amp;&amp;r&lt;n&amp;&amp;s[l]==s[r]{\n            ans=max(ans,r-l+1)\n            if ans==r-l+1{\n                resl=l\n                resr=r\n            }\n            l--\n            r++\n        }\n    }\n    return s[resl:resr+1]\n}\n\næ‹“å±•:manacherç®—æ³•\n\nåœ¨ç©ºéš™æ’å…¥ç¬¦å·,ç»Ÿä¸€å¥‡æ•°å¶æ•°çš„æƒ…å†µ\nè®°å½•ç›®å‰å‘ç°çš„å³è¾¹æœ€è¿œçš„å›æ–‡ä¸²çš„ä¸­å¿ƒç‚¹,ä»¥åŠä»–çš„å³è¾¹ç•Œ.\nè¿™ä¸ªä¸­å¿ƒç‚¹è§†ä½œé•œå­,é‚£ä¹ˆå·¦å³ä¸¤è¾¹çš„å›æ–‡ä¸²å¯ä»¥åªç®—ä¸€æ¬¡\n"},"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/75.-é¢œè‰²åˆ†ç±»":{"slug":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/75.-é¢œè‰²åˆ†ç±»","filePath":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/75. é¢œè‰²åˆ†ç±».md","title":"75. é¢œè‰²åˆ†ç±»","links":[],"tags":[],"content":"ç»™å®šä¸€ä¸ªåŒ…å«çº¢è‰²ã€ç™½è‰²å’Œè“è‰²ã€å…± n ä¸ªå…ƒç´ çš„æ•°ç»„ nums ï¼ŒåŸåœ° å¯¹å®ƒä»¬è¿›è¡Œæ’åºï¼Œä½¿å¾—ç›¸åŒé¢œè‰²çš„å…ƒç´ ç›¸é‚»ï¼Œå¹¶æŒ‰ç…§çº¢è‰²ã€ç™½è‰²ã€è“è‰²é¡ºåºæ’åˆ—ã€‚\næˆ‘ä»¬ä½¿ç”¨æ•´æ•° 0ã€ 1 å’Œ 2 åˆ†åˆ«è¡¨ç¤ºçº¢è‰²ã€ç™½è‰²å’Œè“è‰²ã€‚\nå¿…é¡»åœ¨ä¸ä½¿ç”¨åº“å†…ç½®çš„ sort å‡½æ•°çš„æƒ…å†µä¸‹è§£å†³è¿™ä¸ªé—®é¢˜ã€‚\nå°è®°\nä¸¤è¶Ÿå¾ˆå®¹æ˜“æƒ³åˆ°.\nä¸€è¶Ÿç®—æ³•:\nä»£ç \n "},"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/76.-æœ€å°è¦†ç›–å­ä¸²":{"slug":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/76.-æœ€å°è¦†ç›–å­ä¸²","filePath":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/76. æœ€å°è¦†ç›–å­ä¸².md","title":"76. æœ€å°è¦†ç›–å­ä¸²","links":["tags/flashcard"],"tags":["flashcard"],"content":"\næœ€å°è¦†ç›–å­ä¸² ç»™å®šä¸¤ä¸ªå­—ç¬¦ä¸²Â sÂ å’ŒÂ tï¼Œé•¿åº¦åˆ†åˆ«æ˜¯Â mÂ å’ŒÂ nï¼Œè¿”å› s ä¸­çš„Â æœ€çŸ­çª—å£Â å­ä¸²ï¼Œä½¿å¾—è¯¥å­ä¸²åŒ…å«Â tä¸­çš„æ¯ä¸€ä¸ªå­—ç¬¦ï¼ˆåŒ…æ‹¬é‡å¤å­—ç¬¦ï¼‰ã€‚å¦‚æœæ²¡æœ‰è¿™æ ·çš„å­ä¸²ï¼Œè¿”å›ç©ºå­—ç¬¦ä¸²Â &quot;&quot; flashcard\n\nå°è®°\næ»‘åŠ¨çª—å£çš„ç§»åŠ¨é€»è¾‘ï¼š\n\nå³æŒ‡é’ˆ (æ‰©å¼ ): åº”è¯¥æ— æ¡ä»¶å‘å³ç§»åŠ¨ã€‚æ¯ç§»åŠ¨ä¸€æ­¥ï¼Œæ›´æ–° s ä¸­æ–°è¿›å…¥å­—ç¬¦çš„è®¡æ•°ã€‚\nå·¦æŒ‡é’ˆ (æ”¶ç¼©): åªæœ‰åœ¨çª—å£å·²ç» å®Œå…¨è¦†ç›– t çš„æ—¶å€™ï¼Œæ‰éœ€è¦æ”¶ç¼©å·¦æŒ‡é’ˆã€‚å·¦æŒ‡é’ˆæ”¶ç¼©æ˜¯ä¸ºäº†å¯»æ‰¾æœ€çŸ­å­ä¸²ã€‚[è¿™ä¸ªæ˜¯æœ€é‡è¦çš„]\nå¼•å…¥ä¸¤ä¸ªæ•°æ®ç»“æ„\nneedå“ˆå¸Œè¡¨:å­˜å‚¨tä¸­æ‰€æœ‰å­—ç¬¦ä»¥åŠå…¶æ‰€éœ€çš„æ•°é‡\nwindowå“ˆå¸Œè¡¨:å­˜å‚¨å½“å‰æ»‘åŠ¨çª—å£ä¸­æ‰€æœ‰å­—ç¬¦åŠå…¶æ•°é‡\nè¿™ä¸¤ä¸ªæ•°æ®ç»“æ„å¯ä»¥åˆå¹¶\nneedå“ˆå¸Œè¡¨\nmatch(int):è®°å½•å½“å‰çª—å£ä¸­å·²ç»æ»¡è¶³\næ‰€éœ€æ•°é‡çš„å­—ç¬¦ç§ç±»çš„æ•°é‡\nè¿˜æœ‰å¾ˆå¤šç»†èŠ‚ä¸Šçš„ä¸œè¥¿ è¦ä»”ç»†çœ‹ä¸€ä¸‹ä»£ç \n\nä»£ç \nfunc minWindow(s string, t string) string {\n    cnt := [128]int{}\n    requiredKinds := 0\n    for i := 0; i &lt; len(t); i++ {\n        if cnt[t[i]] == 0 { requiredKinds++ }\n        cnt[t[i]]++\n    }\n    left, match := 0, 0\n    start, minLen := -1, len(s) + 1\n    for right := 0; right &lt; len(s); right++ {\n        // 1. å…¥çª—ï¼šè´¦æœ¬å‡ 1\n        cnt[s[right]]--\n        // å¦‚æœå‡å®Œåˆšå¥½å˜ 0ï¼Œè¯´æ˜è¿™ä¸ªå­—ç¬¦çš„æ•°é‡åˆšå¥½è¾¾åˆ°äº† t çš„è¦\n        if cnt[s[right]] == 0 {\n            match++\n        }\n        // 2. æ»¡è¶³æ¡ä»¶ï¼Œå°è¯•æ”¶ç¼©\n        for match == requiredKinds {\n            // æ›´æ–°ç»“æœ\n            if right - left + 1 &lt; minLen {\n                minLen = right - left + 1\n                start = left\n            }\n            // 3. å‡ºçª—ï¼šè´¦æœ¬åŠ  1\n            // å¦‚æœå‡ºçª—å‰æ˜¯ 0ï¼Œè¯´æ˜ç§»èµ°å®ƒåï¼Œè¯¥å­—ç¬¦å°±ä¸å†è¾¾æ ‡äº†\n            if cnt[s[left]] == 0 {\n                match--\n            }\n            cnt[s[left]]++\n            left++\n        }\n    }\n    if start == -1 { return &quot;&quot; }\n    return s[start : start + minLen]\n}"},"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/äºŒå‰æ ‘/102.-äºŒå‰æ ‘çš„å±‚åºéå†":{"slug":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/äºŒå‰æ ‘/102.-äºŒå‰æ ‘çš„å±‚åºéå†","filePath":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/äºŒå‰æ ‘/102. äºŒå‰æ ‘çš„å±‚åºéå†.md","title":"102. äºŒå‰æ ‘çš„å±‚åºéå†","links":[],"tags":[],"content":"ç»™ä½ äºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹Â rootÂ ï¼Œè¿”å›å…¶èŠ‚ç‚¹å€¼çš„Â å±‚åºéå†Â ï¼ˆå³é€å±‚åœ°ï¼Œä»å·¦åˆ°å³è®¿é—®æ‰€æœ‰èŠ‚ç‚¹ï¼‰ã€‚\nå°è®°\nåŒæ•°ç»„å†™æ³•\næŠŠæ ‘çœ‹ä½œä¸€å±‚ä¸€å±‚çš„åˆ‡ç‰‡ï¼ˆSliceï¼‰\n\ncurÂ (Current)ï¼šä»£è¡¨Â å½“å‰å±‚Â çš„æ‰€æœ‰èŠ‚ç‚¹ã€‚\nnxtÂ (Next)ï¼šä»£è¡¨Â ä¸‹ä¸€å±‚Â çš„æ‰€æœ‰èŠ‚ç‚¹ã€‚\næ¯æ¬¡å¾ªç¯ï¼Œéå†Â curï¼Œæ”¶é›†æ‰€æœ‰çš„å­©å­æ”¾åˆ°Â nxtï¼Œç„¶åæŠŠÂ nxtÂ å˜æˆæ–°çš„Â curã€‚\n\nå•é˜Ÿåˆ—å†™æ³•\nå®é™…ä¸Šå°±æ˜¯æŠŠä¹‹å‰çš„curå’Œnxtåˆèµ·æ¥å˜æˆäº†ä¸€ä¸ªé˜Ÿåˆ—ï¼Œå…ˆè¿›å…ˆå‡ºè€Œå·²ã€‚ä½†æ˜¯è¦æ³¨æ„çš„æ˜¯é˜Ÿåˆ—ä¸­ï¼Œä¸Šä¸€å±‚å’Œä¸‹ä¸€å±‚éœ€è¦æœ‰åˆ†ç•Œçº¿ï¼Œå› ä¸ºè¾“å‡ºç­”æ¡ˆæ˜¯æ ¹æ®å±‚åºæ‰“åŒ…æˆä¸€ä¸ªä¸€ä¸ªå°åˆ‡ç‰‡ã€‚è€Œå…·ä½“å®ç°ä¸­ï¼Œæ˜¯å…ˆå°†æœ¬æ¬¡å¾ªç¯çš„len(q)ä½œä¸ºå¤§å°,ä¸åˆ†é…å¥½ä¸€ä¸ªvalæ•°ç»„å­˜æ”¾æœ¬æ¬¡å±‚åºçš„ç­”æ¡ˆ,è€Œvalæ•°ç»„éå†å®Œä¹‹åæ‰“åŒ…å¥½ç­”æ¡ˆ,å¯ä»¥è‡ªç„¶è€Œç„¶è¿›å…¥ä¸‹ä¸€è¡Œ.\nä»£ç \nfunc levelOrder(root *TreeNode) [][]int {\n    if root==nil{\n        return nil\n    }//å¦‚æœæ ‘ä¸ºç©º é‚£ä¹ˆå±‚åºéå†å½“ç„¶ä¹Ÿæ˜¯ç©º\n    //curæ˜¯å½“å‰å±‚èŠ‚ç‚¹çš„é›†åˆåˆ‡ç‰‡\n    //nxtæ˜¯ä¸‹ä¸€å±‚èŠ‚ç‚¹çš„é›†åˆåˆ‡ç‰‡\n    //valæ˜¯å½“å‰å±‚èŠ‚ç‚¹çš„å€¼æå‡ºæ¥å¾—åˆ°çš„åˆ‡ç‰‡\n    //ansæ˜¯å±‚åºéå†,æ˜¯valçš„é›†åˆ\n    ans:=[][]int{}\n    cur:=[]*TreeNode{root}\n    for len(cur)&gt;0{\n        nxt:=[]*TreeNode{}\n        val:=make([]int,len(cur))\n        for i,c:=range cur{\n            val[i]=c.Val\n            if c.Left!=nil{\n                nxt=append(nxt,c.Left)\n            }\n            if c.Right!=nil{\n                nxt=append(nxt,c.Right)\n            }\n        }\n        cur=nxt        \n        ans=append(ans,val)\n    }\n    return ans\n}\nfunc levelOrder(root *TreeNode) [][]int {\n\tif root == nil {\n\t\treturn nil\n\t} //ç©ºæ ‘å½“ç„¶å±‚åºéå†æ˜¯nil\n\tq := []*TreeNode{root} //åˆå§‹åŒ–ä¸ºç¬¬ä¸€å±‚\n\tans := [][]int{}\n\tfor len(q) &gt; 0 {\n\t\tval := make([]int, len(q)) //è¿™é‡Œç¡®å®šå½“å‰å±‚æœ‰å¤šå°‘èŠ‚ç‚¹äº†,é‚£ä¹ˆåªè¦è¿™ä¹ˆå¤šä¸ªèŠ‚ç‚¹çš„ç­”æ¡ˆæ‰“åŒ…èµ·æ¥å°±æ˜¯æœ€ç»ˆäºŒç»´åˆ‡ç‰‡ä¸­çš„ä¸€ä¸ª.\n\t\tfor i, _ := range val {\n\t\t\tnode := q[0]\n\t\t\tq = q[1:]\n\t\t\tval[i] = node.Val\n\t\t\tif node.Left != nil {\n\t\t\t\tq = append(q, node.Left)\n\t\t\t}\n\t\t\tif node.Right != nil {\n\t\t\t\tq = append(q, node.Right)\n\t\t\t}\n\t\t}\n\t\tans = append(ans, val)\n\t}\n\treturn ans\n}\n "},"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/äºŒå‰æ ‘/105.-ä»å‰åºä¸ä¸­åºéå†åºåˆ—æ„é€ äºŒå‰æ ‘":{"slug":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/äºŒå‰æ ‘/105.-ä»å‰åºä¸ä¸­åºéå†åºåˆ—æ„é€ äºŒå‰æ ‘","filePath":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/äºŒå‰æ ‘/105. ä»å‰åºä¸ä¸­åºéå†åºåˆ—æ„é€ äºŒå‰æ ‘.md","title":"105. ä»å‰åºä¸ä¸­åºéå†åºåˆ—æ„é€ äºŒå‰æ ‘","links":[],"tags":[],"content":"ç»™å®šä¸¤ä¸ªæ•´æ•°æ•°ç»„Â preorderÂ å’ŒÂ inorderÂ ï¼Œå…¶ä¸­Â preorderÂ æ˜¯äºŒå‰æ ‘çš„å…ˆåºéå†ï¼ŒÂ inorderÂ æ˜¯åŒä¸€æ£µæ ‘çš„ä¸­åºéå†ï¼Œè¯·æ„é€ äºŒå‰æ ‘å¹¶è¿”å›å…¶æ ¹èŠ‚ç‚¹ã€‚\nå°è®°\n\nå‰åºçš„ç¬¬ä¸€ä¸ªæ•°å°±æ˜¯æ ¹ é‚£ä¹ˆåœ¨ä¸­åºé‡Œé¢,æ ¹å‰é¢çš„èŠ‚ç‚¹éƒ½æ˜¯å·¦å­æ ‘,åé¢éƒ½æ˜¯å³å­æ ‘\næ€ä¹ˆæŠŠâ€œä¸­åºâ€é‡Œçœ‹åˆ°çš„å·¦å­æ ‘çš„é•¿åº¦ï¼Œæ˜ å°„å›â€œå‰åºâ€æ•°ç»„é‡Œå»åˆ‡åˆ†ï¼Ÿ å·¦å­æ ‘åœ¨ä¸¤ä¸ªæ•°ç»„é‡Œçš„ã€Œé•¿åº¦ï¼ˆèŠ‚ç‚¹ä¸ªæ•° ï¼‰ã€æ˜¯ä¸€æ¨¡ä¸€æ ·çš„\n\nä»£ç \n//æ–¹æ³•ä¸€\nfunc buildTree(preorder, inorder []int) *TreeNode {\n    n := len(preorder)\n    if n == 0 { // ç©ºèŠ‚ç‚¹\n        return nil\n    }\n    leftSize := slices.Index(inorder, preorder[0]) // å·¦å­æ ‘çš„å¤§å°\n    left := buildTree(preorder[1:1+leftSize], inorder[:leftSize])\n    right := buildTree(preorder[1+leftSize:], inorder[1+leftSize:])\n    return &amp;TreeNode{preorder[0], left, right}//ç»„è£…å¾—åˆ°è¿”å›å€¼!\n}\n \n \n//ç”¨å“ˆå¸Œè¡¨,æŠŠå‰åºä¸­æ•°å€¼å’Œä¸‹æ ‡éƒ½è®°å½•ä¸‹æ¥,è¿™æ ·ä¸ç”¨æ¯æ¬¡éƒ½ç”¨Indexå»æ‰¾.ä»¥åæƒ³çŸ¥é“â€œæ ¹åœ¨å“ªé‡Œâ€ï¼ŒæŸ¥ä¸€ä¸‹ Map å°±è¡Œäº†ï¼Œè€—æ—¶ç¬é—´å˜æˆ $O(1)$\n//ä¼ å‚ç”¨çš„æ˜¯å­æ•°ç»„ä¸‹æ ‡åŒºé—´çš„å·¦å³ç«¯ç‚¹,ä¸ç”¨å¤åˆ¶æ•°ç»„\nfunc buildTree(preorder, inorder []int) *TreeNode {\n    n := len(preorder)\n    index := make(map[int]int, n)\n    for i, x := range inorder {\n        index[x] = i\n    }\n \n    var dfs func(int, int, int, int) *TreeNode\n    dfs = func(preL, preR, inL, inR int) *TreeNode {\n        if preL == preR { // ç©ºèŠ‚ç‚¹\n            return nil\n        }\n        leftSize := index[preorder[preL]] - inL // å·¦å­æ ‘çš„å¤§å°\n        left := dfs(preL+1, preL+1+leftSize, inL, inL+leftSize)\n        right := dfs(preL+1+leftSize, preR, inL+1+leftSize, inR)\n        return &amp;TreeNode{preorder[preL], left, right}\n    }\n    return dfs(0, n, 0, n) // å·¦é—­å³å¼€åŒºé—´\n}\n \n// preL, preR: å½“å‰è¦åœ¨ preorder æ•°ç»„é‡Œå¤„ç†çš„èŒƒå›´ [å¼€å§‹, ç»“æŸ)\n// inL, inR: å½“å‰è¦åœ¨ inorder æ•°ç»„é‡Œå¤„ç†çš„èŒƒå›´ [å¼€å§‹, ç»“æŸ)"},"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/äºŒå‰æ ‘/22.-æ‹¬å·ç”Ÿæˆ":{"slug":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/äºŒå‰æ ‘/22.-æ‹¬å·ç”Ÿæˆ","filePath":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/äºŒå‰æ ‘/22. æ‹¬å·ç”Ÿæˆ.md","title":"22. æ‹¬å·ç”Ÿæˆ","links":[],"tags":[],"content":"å°è®°\næ¯”å¦‚n=3 é‚£ä¹ˆå°±æ˜¯6ä¸ªä½ç½®,ä½ å¯ä»¥é€‰æ‹©æ”¾å·¦æ‹¬å·è¿˜æ˜¯å³æ‹¬å·,åªéœ€è¦éµå¾ªä¸¤ä¸ªåŸåˆ™\n\nå·¦æ‹¬å·å’Œå³æ‹¬å·ä¸ªæ•°ç›¸ç­‰\nå½“å‰å·²æ”¾ç½®çš„å³æ‹¬å·çš„ä¸ªæ•°å¿…é¡»å°äºç­‰äºå·¦æ‹¬å·çš„ä¸ªæ•°\n\n\nå†³ç­–æ ‘æ ¹èŠ‚ç‚¹æ˜¯ç©ºå­—ç¬¦ä¸²,å‘å·¦çš„åˆ†æ”¯æ˜¯å·¦æ‹¬å·,å‘å³çš„åˆ†æ”¯æ˜¯å³æ‹¬å·,æ ‘çš„å¶å­èŠ‚ç‚¹æ˜¯æœ€ç»ˆç”Ÿæˆçš„å­—ç¬¦ä¸²\ndfs: ä¸€æ¡è·¯èµ°åˆ°é»‘\nå›æº¯: 1. åŠæ—¶æ­¢æŸ,å‰ªæ 2. å­˜æ¡£å›åˆ°ä¸Šä¸€æ­¥ç»§ç»­,è¿™æ ·å¯ä»¥éå†æ‰€æœ‰çš„æƒ…å†µ\n\nä»£ç \nfunc generateParenthesis(n int) (ans []string) {\n    path := make([]byte, n*2) // æ‰€æœ‰æ‹¬å·é•¿åº¦éƒ½æ˜¯ä¸€æ ·çš„ 2n\n \n    // ç›®å‰å¡«äº† left ä¸ªå·¦æ‹¬å·ï¼Œright ä¸ªå³æ‹¬å·\n    var dfs func(int, int)\n    dfs = func(left, right int) {\n        if right == n { // å¡«å®Œ 2n ä¸ªæ‹¬å·\n            ans = append(ans, string(path)) // åŠ å…¥ç­”æ¡ˆ\n            return\n        }\n        if left &lt; n { // å¯ä»¥å¡«å·¦æ‹¬å·\n            path[left+right] = &#039;(&#039; // ç›´æ¥è¦†ç›–\n            dfs(left+1, right)\n        }\n        if right &lt; left { // å¯ä»¥å¡«å³æ‹¬å·\n            path[left+right] = &#039;)&#039; // ç›´æ¥è¦†ç›–\n            dfs(left, right+1)\n        }\n    }\n \n    dfs(0, 0) // ä¸€å¼€å§‹æ²¡æœ‰å¡«æ‹¬å·\n    return\n}"},"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/äºŒå‰æ ‘/236.-äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ":{"slug":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/äºŒå‰æ ‘/236.-äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ","filePath":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/äºŒå‰æ ‘/236. äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ.md","title":"236. äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ","links":["æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/æ ˆä¸é˜Ÿåˆ—/é€’å½’"],"tags":[],"content":"ç»™å®šä¸€ä¸ªäºŒå‰æ ‘, æ‰¾åˆ°è¯¥æ ‘ä¸­ä¸¤ä¸ªæŒ‡å®šèŠ‚ç‚¹çš„æœ€è¿‘å…¬å…±ç¥–å…ˆã€‚\næœ€è¿‘å…¬å…±ç¥–å…ˆçš„å®šä¹‰ä¸ºï¼šâ€œå¯¹äºæœ‰æ ¹æ ‘ T çš„ä¸¤ä¸ªèŠ‚ç‚¹ pã€qï¼Œæœ€è¿‘å…¬å…±ç¥–å…ˆè¡¨ç¤ºä¸ºä¸€ä¸ªèŠ‚ç‚¹ xï¼Œæ»¡è¶³ x æ˜¯ pã€q çš„ç¥–å…ˆä¸” x çš„æ·±åº¦å°½å¯èƒ½å¤§ï¼ˆä¸€ä¸ªèŠ‚ç‚¹ä¹Ÿå¯ä»¥æ˜¯å®ƒè‡ªå·±çš„ç¥–å…ˆï¼‰ã€‚â€\nå°è®°\nTransclude of é€’å½’#é€’å½’ç®—æ³•ä¸‰è¦ç´ \nä»£ç \n/**\n * Definition for a binary tree node.\n * type TreeNode struct {\n *     Val int\n *     Left *TreeNode\n *     Right *TreeNode\n * }\n */\nfunc lowestCommonAncestor(root, p, q *TreeNode) *TreeNode {\n    //è¾¹ç•Œæ¡ä»¶\n  if root==nil||root==p||root==q{\n    return root\n  }\n  //é€’å½’å¾—åˆ°è¿”å›å€¼\n  left:=lowestCommonAncestor(root.Left,p,q)\n  right:=lowestCommonAncestor(root.Right,p,q)\n  //å¦‚ä½•è·å–å…¶ä»–é€’å½’è¿”å›å€¼\n  if left!=nil&amp;&amp;right!=nil{\n    return root\n  }\n  if left!=nil{\n    return left\n  }\n  return right\n}"},"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/äºŒå‰æ ‘/46.-å…¨æ’åˆ—":{"slug":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/äºŒå‰æ ‘/46.-å…¨æ’åˆ—","filePath":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/äºŒå‰æ ‘/46. å…¨æ’åˆ—.md","title":"46. å…¨æ’åˆ—","links":[],"tags":[],"content":"ç»™å®šä¸€ä¸ªä¸å«é‡å¤æ•°å­—çš„æ•°ç»„Â numsÂ ï¼Œè¿”å›å…¶Â æ‰€æœ‰å¯èƒ½çš„å…¨æ’åˆ—Â ã€‚ä½ å¯ä»¥Â æŒ‰ä»»æ„é¡ºåºÂ è¿”å›ç­”æ¡ˆã€‚\nå°è®°\n\nä¸€å±‚ä¸€å±‚åœ°è¿›è¡Œé€’å½’\n\npathå°±æ˜¯å½“å‰å…¨æ’åˆ—çš„æƒ…å†µ.\nonpathæ˜¯ä¸€ä¸ªå¸ƒå°”æ•°ç»„,æ ‡è®°å…ƒç´ åœ¨ä¹‹å‰çš„ç›’å­é‡Œç”¨è¿‡äº†,å› ä¸ºå…¨æ’åˆ—ä¸èƒ½æœ‰é‡å¤å…ƒç´ \n\n\né€’å½’ç»ˆæ­¢æ¡ä»¶: å½“ç›’å­é‡Œçš„å…ƒç´ éƒ½æ”¾æ»¡äº†ä¹‹å,ans = append(ans, copy_of_path).æ³¨æ„è¿™é‡Œæ˜¯copyofpath,å› ä¸ºpathåˆ‡ç‰‡æ˜¯å€¼å¼•ç”¨,å¦‚æœåªæ˜¯appendpathè¿™ä¸ªåˆ‡ç‰‡çš„è¯,ä¼šæ˜ å°„åˆ°åŒä¸€å—åœ°å€,æœ€åå…¨éƒ½æ˜¯æœ€åä¸€æ¬¡å›æº¯çš„å†…å®¹.\ndfs(i),iè¡¨ç¤ºç¬¬å‡ å±‚é€’å½’\nå› ä¸ºå·²ç»çŸ¥é“äº†ä¸é‡å¤,æ‰€ä»¥å°±åªéœ€è¦å…³å¿ƒä¸‹æ ‡å°±å¯ä»¥äº†,ä¸éœ€è¦å…³å¿ƒå®é™…çš„æ•°å­—å€¼\n\nä»£ç \nfunc permute(nums []int) (ans [][]int) {\n    n := len(nums)\n    path := make([]int, n)\n    onPath := make([]bool, n)\n    var dfs func(int)\n    dfs = func(i int) {\n        if i == n {\n            ans = append(ans, append([]int(nil), path...))\n            return\n        }\n        for j, on := range onPath {\n            if !on {\n                path[i] = nums[j]\n                onPath[j] = true\n                dfs(i + 1)\n                onPath[j] = false\n            }\n        }\n    }\n    dfs(0)\n    return\n}\n "},"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/äºŒå‰æ ‘/94.-äºŒå‰æ ‘çš„ä¸­åºéå†":{"slug":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/äºŒå‰æ ‘/94.-äºŒå‰æ ‘çš„ä¸­åºéå†","filePath":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/äºŒå‰æ ‘/94. äºŒå‰æ ‘çš„ä¸­åºéå†.md","title":"94. äºŒå‰æ ‘çš„ä¸­åºéå†","links":[],"tags":[],"content":"ç»™å®šä¸€ä¸ªäºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹Â rootÂ ï¼Œè¿”å›Â å®ƒçš„Â ä¸­åºÂ éå†Â ã€‚\nå°è®°\né€’å½’ç®—æ³•\nè¿­ä»£ç®—æ³•:Morris\n\nå¦‚æœç”¨é€’å½’æˆ–è€…æ ˆè¿­ä»£,ç©ºé—´å¤æ‚åº¦æ˜¯O(h),é‚£ä¹ˆå°±è€ƒè™‘åˆ° æˆ‘ä»¬å¯ä»¥åˆ©ç”¨æ ‘ä¸­å¤§é‡çš„ç©ºæŒ‡é’ˆnil,æš‚æ—¶æŒ‡å‘å®ƒçš„åç»­èŠ‚ç‚¹,æ­å»ºä¸€æ¡ä¸´æ—¶é€šé“æ¥è¿›è¡Œå›æº¯.\nMorriséå†çš„ç²¾é«“:çº¿ç´¢åŒ–\n\nÂ åœ¨è¿›å…¥å·¦å­æ ‘ä¹‹å‰ï¼Œå…ˆæ‰¾åˆ°å·¦å­æ ‘é‡Œâ€œæœ€åä¸€ä¸ªè¢«è®¿é—®çš„èŠ‚ç‚¹â€ï¼ˆå³å·¦å­æ ‘çš„æœ€å³èŠ‚ç‚¹ï¼‰æŠŠè¿™ä¸ªèŠ‚ç‚¹çš„å³æŒ‡é’ˆï¼ˆæœ¬åº”è¯¥æ˜¯Â nilï¼‰ï¼ŒæŒ‡å‘å½“å‰æ ¹èŠ‚ç‚¹ã€‚æ•´ä¸ªéå†è¿‡ç¨‹å®Œå…¨é rootæŒ‡é’ˆçš„ç§»åŠ¨æ¥éå†\nÂ å…·ä½“å®ç°:\nÂ - rootæ²¡æœ‰å·¦å­©å­,ç›´æ¥è®°å½•+æ‰“å°.\nÂ - rootæœ‰å·¦å­©å­ ä¸èƒ½ç›´æ¥å¾€å·¦èµ°,éœ€è¦å…ˆè®°å½•ä¸‹å·¦å­æ ‘é‡Œæœ€å³è¾¹çš„èŠ‚ç‚¹\n\nå¦‚æœprerightæ˜¯ç©ºçš„,è¯´æ˜æˆ‘ä»¬ç¬¬ä¸€æ¬¡æ¥åˆ°root,è¿˜æ²¡æœ‰éå†å·¦å­æ ‘.æ‰€ä»¥æ‰¾åˆ°preright,æŒ‡å‘root.\nå¦‚æœprerightå·²ç»æŒ‡å‘root,è¯´æ˜æˆ‘ä»¬å·²ç»éå†å®Œäº†å·¦å­æ ‘,å›æ¥äº†,é‚£ä¹ˆå°±å¤åŸpreright\n\nä»£ç \n/**\n * Definition for a binary tree node.\n * type TreeNode struct {\n *     Val int\n *     Left *TreeNode\n *     Right *TreeNode\n * }\n */\nfunc inorderTraversal(root *TreeNode) []int {\n    //é€’å½’\n    ans:=[]int{}\n    var dfs func(root *TreeNode)\n    dfs=func(root *TreeNode){\n        if root==nil{\n            return \n        }\n        dfs(root.Left)\n        ans=append(ans,root.Val)\n        dfs(root.Right)\n    }\n    dfs(root)\n    return ans\n}\nmorris\nå…·ä½“å®ç°ä¸Šè¿˜æ˜¯æ¯”è¾ƒç»•çš„,è§£è¯´ä¸€ä¸‹:\nå¦‚æœå·¦å­æ ‘ä¸ä¸ºç©º å°±è¦æ‰¾ä¸€ä¸ªå‰é©±ï¼Œä¸ºäº†éå†å®Œå·¦å­æ ‘ç«‹åˆ»å›åˆ°root\n\nå¦‚æœæ˜¯å› ä¸ºpreright=nilè€Œå¯¼è‡´å¾ªç¯ç»“æŸçš„è¯ å°±è¯´æ˜æ˜¯ç¬¬ä¸€æ¬¡æ¥åˆ°root é‚£ä¹ˆå°±åšè¿æ¥ å¹¶ä¸”ä½¿å¾—rootè¿›è¡Œå·¦å­æ ‘éå†\nå¦‚æœæ˜¯å› ä¸ºpreright=rootä¸­æ–­çš„å¾ªç¯ å°±è¯´æ˜æ˜¯ç¬¬äºŒæ¬¡åˆ°è¾¾äº†æ‰€ä»¥æŠŠprerightå¤åŸ\nç„¶åè¿™æ˜¯å·¦å­æ ‘ç»“æŸäº† æ¥ä¸‹æ¥æ­£å¸¸çš„è®°å½•rootå’Œå³å­æ ‘éå†\n\n "},"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/äºŒå‰æ ‘/äºŒå‰æ ‘":{"slug":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/äºŒå‰æ ‘/äºŒå‰æ ‘","filePath":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/äºŒå‰æ ‘/äºŒå‰æ ‘.md","title":"äºŒå‰æ ‘","links":["æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/æ ˆä¸é˜Ÿåˆ—/é€’å½’"],"tags":[],"content":"äºŒå‰æ ‘çš„ç§ç±»\næ»¡äºŒå‰æ ‘\nåªæœ‰åº¦ä¸º0çš„ç»“ç‚¹å’Œåº¦ä¸º2çš„ç»“ç‚¹,è€Œä¸”åº¦ä¸º0çš„ç»“ç‚¹åœ¨åŒä¸€å±‚ä¸Š\nå®Œå…¨äºŒå‰æ ‘\nåœ¨å®Œå…¨äºŒå‰æ ‘ä¸­ï¼Œé™¤äº†æœ€åº•å±‚èŠ‚ç‚¹å¯èƒ½æ²¡å¡«æ»¡å¤–ï¼Œå…¶ä½™æ¯å±‚èŠ‚ç‚¹æ•°éƒ½è¾¾åˆ°æœ€å¤§å€¼ï¼Œå¹¶ä¸”æœ€ä¸‹é¢ä¸€å±‚çš„èŠ‚ç‚¹éƒ½é›†ä¸­åœ¨è¯¥å±‚æœ€å·¦è¾¹çš„è‹¥å¹²ä½ç½®ã€‚è‹¥æœ€åº•å±‚ä¸ºç¬¬ h å±‚ï¼ˆhä»1å¼€å§‹ï¼‰ï¼Œåˆ™è¯¥å±‚åŒ…å« 1~ 2^(h-1) ä¸ªèŠ‚ç‚¹ã€‚\n\nå †å°±æ˜¯ä¸€æ£µå®Œå…¨äºŒå‰æ ‘\näºŒå‰æœç´¢æ ‘\næœ‰åºæ ‘.\n\nè‹¥å®ƒçš„å·¦å­æ ‘ä¸ç©ºï¼Œåˆ™å·¦å­æ ‘ä¸Šæ‰€æœ‰ç»“ç‚¹çš„å€¼å‡å°äºå®ƒçš„æ ¹ç»“ç‚¹çš„å€¼ï¼›\nè‹¥å®ƒçš„å³å­æ ‘ä¸ç©ºï¼Œåˆ™å³å­æ ‘ä¸Šæ‰€æœ‰ç»“ç‚¹çš„å€¼å‡å¤§äºå®ƒçš„æ ¹ç»“ç‚¹çš„å€¼ï¼›\nå®ƒçš„å·¦ã€å³å­æ ‘ä¹Ÿåˆ†åˆ«ä¸ºäºŒå‰æœç´¢æ ‘\n\n\nå¹³è¡¡äºŒå‰æœç´¢æ ‘\nåˆç§°ä½œAVLæ ‘.\nå®ƒæ˜¯ä¸€æ£µç©ºæ ‘æˆ–å®ƒçš„å·¦å³ä¸¤ä¸ªå­æ ‘çš„é«˜åº¦å·®çš„ç»å¯¹å€¼ä¸è¶…è¿‡1ï¼Œå¹¶ä¸”å·¦å³ä¸¤ä¸ªå­æ ‘éƒ½æ˜¯ä¸€æ£µå¹³è¡¡äºŒå‰æ ‘ã€‚\n\näºŒå‰æ ‘çš„å­˜å‚¨æ–¹å¼\nå¯ä»¥é“¾å¼å­˜å‚¨(æŒ‡é’ˆ),ä¹Ÿå¯ä»¥é¡ºåºå­˜å‚¨(æ•°ç»„)\nå¦‚æœçˆ¶èŠ‚ç‚¹çš„æ•°ç»„ä¸‹æ ‡æ˜¯ iï¼Œé‚£ä¹ˆå®ƒçš„å·¦å­©å­å°±æ˜¯ i * 2 + 1ï¼Œå³å­©å­å°±æ˜¯ i * 2 + 2\néå†æ–¹å¼\næ·±åº¦ä¼˜å…ˆéå†\nå…ˆå¾€æ·±å¤„èµ°,é‡åˆ°å¶å­èŠ‚ç‚¹å†å¾€å›èµ°\nè¿™é‡Œçš„å‰ä¸­åæŒ‡çš„æ˜¯ä¸­é—´èŠ‚ç‚¹çš„éå†é¡ºåº\nå‰åºéå†: é€’å½’/è¿­ä»£æ³•    ä¸­å·¦å³\nä¸­åºéå†: é€’å½’/è¿­ä»£æ³•    å·¦ä¸­å³\nååºéå†: é€’å½’/è¿­ä»£æ³•    å·¦å³ä¸­\nç”¨é€’å½’æ¯”è¾ƒæ–¹ä¾¿.åŒæ—¶,æ ˆå…¶å®æ˜¯é€’å½’çš„ä¸€ç§å®ç°ç»“æ„,å› æ­¤å‰ä¸­ååºéå†æ˜¯å¯ä»¥ç”¨æ ˆå®ç°çš„.\nå¹¿åº¦ä¼˜å…ˆéå†\nå±‚æ¬¡éå†: è¿­ä»£æ³•\nä¸€èˆ¬ç”¨é˜Ÿåˆ—æ¥å®ç°,å› ä¸ºé˜Ÿåˆ—æ˜¯å…ˆè¿›å…ˆå‡ºçš„,è¿™æ ·æ‰èƒ½ä¸€å±‚ä¸€å±‚åœ°éå†äºŒå‰æ ‘\nå…·ä½“å®ç°\ntype TreeNode struct {\n    Val int\n    Left *TreeNode\n    Right *TreeNode\n}\né€’å½’éå†\nTransclude of é€’å½’#é€’å½’ç®—æ³•ä¸‰è¦ç´ \n\nå‚æ•°åº”è¯¥æ˜¯å­æ ‘çš„æ ¹èŠ‚ç‚¹.é¦–å…ˆè¿™ä¸ªé€’å½’å‡½æ•°æ˜¯å¾—ä½œç”¨åœ¨ä¸€æ•´æ£µæ ‘ä¸Šçš„.ç„¶åå†é€’å½’å»å¯¹å„ä¸ªå­æ ‘åšæ“ä½œ.è€Œç»“æœæ•°ç»„ä¸éœ€è¦ç»è¿‡ä¼ é€’.\næœ€ç»ˆåˆ°å­æ ‘çš„å¶å­èŠ‚ç‚¹,node==nilçš„æ—¶å€™å°±è¿”å›,ä¹Ÿä¸éœ€è¦åŠ å…¥resæ•°ç»„\n\n\nfunc preorderTraversal(root *TreeNode) (res []int) {\n    var traversal func(node *TreeNode)//å£°æ˜é€’å½’å‡½æ•°å˜é‡\n    traversal = func(node *TreeNode) {//ç»™å˜é‡èµ‹å€¼\n\t//base case\n\tif node == nil {\n            return\n\t}\n\t\n\tres = append(res,node.Val)//æŠŠä¸­(ä¹Ÿå°±æ˜¯è‡ªå·±)æ”¾è¿›ç¯®å­\n\ttraversal(node.Left)//å·¦é€’å½’\n\ttraversal(node.Right)//å³é€’å½’\n    }\n    traversal(root)//ä½¿ç”¨é€’å½’å‡½æ•°\n    return res\n}\n \nè¿­ä»£éå†\nTransclude of é€’å½’#é€’å½’çš„å®ç°\nå› æ­¤ç›´æ¥ç”¨æ ˆä¹Ÿå¯ä»¥å®ç°æ·±åº¦ä¼˜å…ˆéå†.\nå‰åºéå†\nå‰åºéå†æ˜¯ä¸­å·¦å³.å› æ­¤æ¯æ¬¡å…ˆå°†æ ¹èŠ‚ç‚¹æ”¾å…¥æ ˆä¸­,ç„¶åå°†å³èŠ‚ç‚¹åŠ å…¥æ ˆ,å†åŠ å…¥å·¦èŠ‚ç‚¹.è¿™æ ·å‡ºæ ˆçš„æ—¶å€™æ˜¯ä¸­å·¦å³çš„é¡ºåº\nä¸­åºéå†\nç»Ÿä¸€è¿­ä»£æ³•\nå±‚åºéå†"},"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/äºŒå‰æ ‘/å¯¹ç§°äºŒå‰æ ‘":{"slug":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/äºŒå‰æ ‘/å¯¹ç§°äºŒå‰æ ‘","filePath":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/äºŒå‰æ ‘/å¯¹ç§°äºŒå‰æ ‘.md","title":"å¯¹ç§°äºŒå‰æ ‘","links":[],"tags":[],"content":""},"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/äºŒå‰æ ‘/ç¿»è½¬äºŒå‰æ ‘":{"slug":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/äºŒå‰æ ‘/ç¿»è½¬äºŒå‰æ ‘","filePath":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/äºŒå‰æ ‘/ç¿»è½¬äºŒå‰æ ‘.md","title":"ç¿»è½¬äºŒå‰æ ‘","links":[],"tags":[],"content":""},"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/å‰ç¼€å’Œ/121.-ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº":{"slug":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/å‰ç¼€å’Œ/121.-ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº","filePath":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/å‰ç¼€å’Œ/121. ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº.md","title":"121. ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº","links":[],"tags":[],"content":"ç»™å®šä¸€ä¸ªæ•°ç»„Â pricesÂ ï¼Œå®ƒçš„ç¬¬Â iÂ ä¸ªå…ƒç´ Â prices[i]Â è¡¨ç¤ºä¸€æ”¯ç»™å®šè‚¡ç¥¨ç¬¬Â iÂ å¤©çš„ä»·æ ¼ã€‚\nä½ åªèƒ½é€‰æ‹©Â æŸä¸€å¤©Â ä¹°å…¥è¿™åªè‚¡ç¥¨ï¼Œå¹¶é€‰æ‹©åœ¨Â æœªæ¥çš„æŸä¸€ä¸ªä¸åŒçš„æ—¥å­Â å–å‡ºè¯¥è‚¡ç¥¨ã€‚è®¾è®¡ä¸€ä¸ªç®—æ³•æ¥è®¡ç®—ä½ æ‰€èƒ½è·å–çš„æœ€å¤§åˆ©æ¶¦ã€‚\nè¿”å›ä½ å¯ä»¥ä»è¿™ç¬”äº¤æ˜“ä¸­è·å–çš„æœ€å¤§åˆ©æ¶¦ã€‚å¦‚æœä½ ä¸èƒ½è·å–ä»»ä½•åˆ©æ¶¦ï¼Œè¿”å›Â 0Â ã€‚\nå°è®°\nç»´æŠ¤ä¸¤ä¸ªå…³é”®å˜é‡:\n\nè®°å½•ä»ç¬¬ä¸€å¤©åˆ°å½“å‰è¿™ä¸€å¤©ä¸ºæ­¢,å‡ºç°çš„æœ€ä½ä»·æ ¼(å‡è®¾ä¹°å…¥ç‚¹)\n\né¡ºæ‰‹è®°ä½çš„,æ‰€ä»¥åªéœ€è¦éå†ä¸€éå³å¯.\n\n\nans:è®°å½•åˆ°ç›®å‰ä¸ºæ­¢èƒ½è·å¾—çš„å†å²æœ€å¤§åˆ©æ¶¦\n\nä»£ç \nfunc maxProfit(prices []int) (ans int) {\n    minPrice := prices[0]\n    for _, p := range prices {\n        ans = max(ans, p-minPrice)\n        minPrice = min(minPrice, p)\n    }\n    return\n}"},"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/å‰ç¼€å’Œ/53.-æœ€å¤§å­æ•°ç»„å’Œ":{"slug":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/å‰ç¼€å’Œ/53.-æœ€å¤§å­æ•°ç»„å’Œ","filePath":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/å‰ç¼€å’Œ/53. æœ€å¤§å­æ•°ç»„å’Œ.md","title":"53. æœ€å¤§å­æ•°ç»„å’Œ","links":[],"tags":[],"content":"ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„Â numsÂ ï¼Œè¯·ä½ æ‰¾å‡ºä¸€ä¸ªå…·æœ‰æœ€å¤§å’Œçš„è¿ç»­å­æ•°ç»„ï¼ˆå­æ•°ç»„æœ€å°‘åŒ…å«ä¸€ä¸ªå…ƒç´ ï¼‰ï¼Œè¿”å›å…¶æœ€å¤§å’Œã€‚\nå­æ•°ç»„æ˜¯æ•°ç»„ä¸­çš„ä¸€ä¸ªè¿ç»­éƒ¨åˆ†(éç©ºå…ƒç´ åºåˆ—)\nå‰ç¼€å’Œ\nå°è®°\n\né¢˜ç›®è¦æ±‚å­æ•°ç»„ä¸èƒ½ä¸ºç©ºï¼Œåº”å½“å…ˆè®¡ç®—å‰ç¼€å’Œ-æœ€å°å‰ç¼€å’Œï¼Œå†æ›´æ–°æœ€å°å‰ç¼€å’Œã€‚ç›¸å½“äºä¸èƒ½åœ¨åŒä¸€å¤©ä¹°å…¥è‚¡ç¥¨åˆå–å‡ºè‚¡ç¥¨ã€‚\nè€Œä¸”å®é™…ä¸Šå‰ç¼€å’Œå¹¶ä¸éœ€è¦ç»´æŠ¤æ•´ä¸ªå‰ç¼€å’Œæ•°ç»„\n\nä»£ç \nfunc maxSubArray(nums []int) int {\n    ans := math.MinInt\n    minPreSum := 0\n    preSum := 0\n    for _, x := range nums {\n        preSum += x // å½“å‰çš„å‰ç¼€å’Œ\n        ans = max(ans, preSum-minPreSum)   // å‡å»å‰ç¼€å’Œçš„æœ€å°å€¼\n        minPreSum = min(minPreSum, preSum) // ç»´æŠ¤å‰ç¼€å’Œçš„æœ€å°å€¼\n    }\n    return ans\n}\n \nåŠ¨æ€è§„åˆ’\nå°è®°\nf[i] ä»£è¡¨ï¼šå¦‚æœå¿…é¡»ä»¥ç¬¬ i ä¸ªäººä½œä¸ºç»ˆç‚¹ï¼Œè¿™ä¸€é˜Ÿäººèƒ½å‡‘å‡ºçš„æœ€å¤§æ•°å€¼æ˜¯å¤šå°‘ï¼Ÿ\nf[i] = \\max(f[i-1], 0) + nums[i]\nä»£ç \nfunc maxSubArray(nums []int) int {\n    ans := math.MinInt // æ³¨æ„ç­”æ¡ˆå¯ä»¥æ˜¯è´Ÿæ•°ï¼Œä¸èƒ½åˆå§‹åŒ–æˆ 0\n    f := 0\n    for _, x := range nums {\n        f = max(f, 0) + x\n        ans = max(ans, f)\n    }\n    return ans\n}\n "},"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/å‰ç¼€å’Œ/KMPç®—æ³•":{"slug":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/å‰ç¼€å’Œ/KMPç®—æ³•","filePath":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/å‰ç¼€å’Œ/KMPç®—æ³•.md","title":"KMPç®—æ³•","links":[],"tags":[],"content":"å–äº†ä¸‰ä½å­¦è€…åå­—çš„é¦–å­—æ¯ã€‚æ‰€ä»¥å«åšKMP\nä¸»è¦æ€æƒ³\nå½“å‡ºç°å­—ç¬¦ä¸²ä¸åŒ¹é…æ—¶,å¯ä»¥çŸ¥é“ä¸€éƒ¨åˆ†ä¹‹å‰å·²ç»åŒ¹é…çš„å†…å®¹,å¯ä»¥åˆ©ç”¨è¿™äº›ä¿¡æ¯,é¿å…ä»å¤´åŒ¹é….\nåŸç†\nnextæ•°ç»„\næœ¬è´¨ä¸Šå³ä¸ºå‰ç¼€è¡¨prefixtable\n\nç”¨æ¥å›é€€.è®°å½•äº†æ¨¡å¼ä¸²ä¸ä¸»ä¸²ä¸åŒ¹é…çš„æ—¶å€™,æ¨¡å¼ä¸²åº”è¯¥ä»å“ªé‡Œå¼€å§‹é‡æ–°åŒ¹é….\n\n\nä½†æ˜¯å®ç°ä¸Šä¹Ÿå¯ä»¥é‡‡ç”¨å‰ç¼€è¡¨ç»Ÿä¸€å‡ä¸€\n\nç”Ÿæˆ\n\nè®°å½•ä¸‹æ ‡iä¹‹å‰ï¼ˆåŒ…æ‹¬iï¼‰çš„å­—ç¬¦ä¸²ä¸­ï¼Œæœ‰å¤šå¤§é•¿åº¦çš„ç›¸åŒå‰åç¼€\n\n\n\n                  \n                  æœ€é•¿å…¬å…±å‰åç¼€ \n                  \n                \n\nå‰ç¼€:ä¸åŒ…å«æœ€åä¸€ä¸ªå­—ç¬¦çš„,æ‰€æœ‰ä»¥ç¬¬ä¸€ä¸ªå­—ç¬¦å¼€å¤´çš„è¿ç»­å­—ä¸².\nåç¼€:ä¸åŒ…å«ç¬¬ä¸€ä¸ªå­—ç¬¦çš„,æ‰€æœ‰ä»¥æœ€åä¸€ä¸ªå­—ç¬¦ç»“å°¾çš„è¿ç»­å­ä¸².\n\n\n\nå‰åç¼€ç›¸ç­‰ï¼ˆKMPçš„é€»è¾‘ï¼‰ï¼š A B C â€¦ A B C ï¼ˆå¹³ç§»é‡å¤ï¼ŒåŒå‘ï¼‰\n\nå¯¹äºä¸‹æ ‡0: å•ç‹¬ä¸€ä¸ªâ€™aâ€™ æœ€é•¿å…¬å…±å‰åç¼€æ˜¯0(å› ä¸ºè®¡ç®—å…¬å…±å‰åç¼€æ˜¯ä¸åŒ…æ‹¬ç¬¬ä¸€ä¸ª/æœ€åä¸€ä¸ªçš„)\nå¯¹äºä¸‹æ ‡1: â€˜aaâ€™ æœ€é•¿å…¬å…±å‰åç¼€æ˜¯1\nå¯¹äºä¸‹æ ‡2: â€˜aabâ€™æœ€é•¿å…¬å…±å‰åç¼€æ˜¯0\n\nä½¿ç”¨\nä½¿ç”¨å‰ç¼€è¡¨çš„æƒ…å†µä¸‹: æ‰¾åˆ°ä¸åŒ¹é…çš„ä½ç½®,é‚£ä¹ˆå»çœ‹å®ƒçš„å‰ä¸€ä¸ªå­—ç¬¦å¯¹åº”å‰ç¼€è¡¨çš„æ•°å€¼æ˜¯å¤šå°‘. å‰å¾€å‰é¢å­—ç¬¦ä¸²çš„æœ€å¤§å…¬å…±åç¼€çš„å‰ä¸€ä¸ªä½ç½®é‡æ–°åŒ¹é…\nç”¨nextæ•°ç»„çš„æƒ…å†µä¸‹: å‰å¾€å‰é¢å­—ç¬¦ä¸²çš„æœ€å¤§å…¬å…±åç¼€çš„å¼€å¤´é‡æ–°åŒ¹é…\n\nå®ç°\n\nå•ç‹¬ç”Ÿæˆnextæ•°ç»„ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯O(m)\næ ¹æ®å‰ç¼€è¡¨ä¸æ–­è°ƒæ•´åŒ¹é…çš„ä½ç½®O(n)\næ‰€ä»¥æ•´ä¸ªKMPç®—æ³•çš„æ—¶é—´å¤æ‚åº¦æ˜¯O(n+m)\n\næ„é€ nextæ•°ç»„\næ˜¯é’ˆå¯¹æ¨¡å¼ä¸²[å³ç›®æ ‡å­—ç¬¦ä¸²]åšçš„å‡†å¤‡\n\nåˆå§‹åŒ–\n\njæŒ‡å‘å‰ç¼€æœ«å°¾ä½ç½®,iæŒ‡å‘åç¼€æœ«å°¾ä½ç½®\nåˆå§‹åŒ–next[0]-[å¯ä»¥è®©j=-1,ç„¶ånext[0]=j,ä¹‹åæ£€ç´¢éƒ½ç”¨next[j+1]]\n\n\nå¤„ç†å‰åç¼€ä¸ç›¸åŒçš„æƒ…å†µ\n\nä¸‹æ ‡iä»1å¼€å§‹éå†,å¦‚æœ s[i] å’Œ s[j+1] ä¸åŒ¹é…ï¼Œæˆ‘ä»¬æƒ³æ‰¾ä¸€ä¸ªæ›´çŸ­çš„å‰ç¼€ï¼Œè¿™ä¸ªå‰ç¼€åˆšå¥½ä¹Ÿæ˜¯å½“å‰ i ä¹‹å‰çš„åç¼€ã€‚\nå› ä¸ºnextæ•°ç»„é‡Œé¢è®°å½•ç€ä»¥ä¸‹æ ‡ç»“å°¾çš„å­—ä¸²çš„ç›¸åŒå‰åç¼€é•¿åº¦.\nå½“æˆ‘ä»¬ä»ä¸€ä¸ªè¾ƒé•¿çš„åŒ¹é…ï¼ˆLï¼‰å›é€€åˆ°ä¸€ä¸ªè¾ƒçŸ­çš„åŒ¹é…ï¼ˆXï¼‰æ—¶ï¼ŒX çš„ä¸‹ä¸€ä¸ªå­—ç¬¦å¯èƒ½ä¾ç„¶æ— æ³•æ»¡è¶³å½“å‰çš„åŒ¹é…éœ€æ±‚ã€‚ å› æ­¤è¿™é‡Œè¦ç”¨for,ç›´åˆ°ä¸‹ä¸€ä¸ªå­—ç¬¦èƒ½åŒ¹é…ä¸ºæ­¢\naabaa è¿™æ—¶å€™j+1=2æŒ‡å‘b,iæŒ‡å‘æ–°æ¥çš„å­—ç¬¦,å¦‚æœæ˜¯aé‚£ä¹ˆåŒ¹é…å¤±è´¥[aab!=aaa]\nj=next[j]=next[1]=1,ä»è¿™ä¸ªä½ç½®å¼€å§‹é‡æ–°åŒ¹é…,è¿™æ ·å°±å¯ä»¥aabaaa æŠŠç¬¬äºŒä¸ªaå’Œæœ€åä¸€ä¸ªaåŒ¹é…èµ·æ¥.\n\n\n\n\n\n                  \n                  æ€è€ƒè¿‡ç¨‹ \n                  \n                \n\nQ: ä¸ºä»€ä¹ˆj=next[j]å°±èƒ½è¾¾åˆ°è¿™æ ·çš„æ•ˆæœ?next[j]é‡Œé¢æ”¾çš„æ˜¯0jè¿™ä¸ªå­—ç¬¦ä¸²çš„æœ€å¤§å…¬å…±å‰åç¼€,ä¸ºä»€ä¹ˆèƒ½å¯¹0içš„è¿™ä¸ªå­—ç¬¦ä¸²èµ·åˆ°ä¸€ä¸ªå›é€€çš„ä½œç”¨?æˆ‘è§‰å¾—åº”è¯¥æ˜¯çœ‹next[i-1] å‘ç°å‰é¢è¿™ä¸ªå­—ç¬¦ä¸²é‡Œé¢æœ€å¤§å‰åç¼€æ˜¯1,ç„¶åæ–°æ¥äº†ä¸€ä¸ªæ²¡åŒ¹é…ä¸Š,æœ¬æ¥æœ€å¤§å‰åç¼€åº”è¯¥æ˜¯2çš„,æ‰€ä»¥2-1=1 ,è®©å‰ç¼€ä»è¿™ä¸ª1çš„åœ°æ–¹å¼€å§‹é‡æ–°åŒ¹é….\n\n\n\nSï¼šä¸»å­—ç¬¦ä¸²ï¼ˆ0 ~ i-1ï¼‰ã€‚\nLï¼šS çš„æœ€é•¿å…¬å…±å‰åç¼€ï¼ˆå³ next[i-1] å¯¹åº”çš„ä¸²ï¼‰ã€‚\nXï¼šS çš„æ¬¡é•¿å…¬å…±å‰åç¼€ï¼ˆæˆ‘ä»¬éœ€è¦æ‰¾çš„ç›®æ ‡ï¼‰ã€‚\néœ€è¦è¯æ˜çš„æ˜¯ï¼šX ä¸€å®šæ˜¯ L çš„æœ€é•¿å…¬å…±å‰åç¼€ã€‚\nå®é™…ä¸Šæ˜¯æŠŠLåˆ‡æˆäº†ä¸¤éƒ¨åˆ†,å‰ç¼€æ”¾åˆ°Sçš„æœ€å‰é¢,åç¼€ç•™åœ¨åŸåœ°,ç„¶åxä½œä¸ºsçš„æ¬¡é•¿å…¬å…±å‰åç¼€,å°±ç¡®å®æ˜¯Lçš„æœ€é•¿å…¬å…±å‰åç¼€\n\n\nå¤„ç†å‰åç¼€ç›¸åŒçš„æƒ…å†µ\n\nå¦‚æœ s[i]Â ä¸ s[jÂ +Â 1] ç›¸åŒï¼Œé‚£ä¹ˆå°±åŒæ—¶å‘åç§»åŠ¨i å’Œj è¯´æ˜æ‰¾åˆ°äº†ç›¸åŒçš„å‰åç¼€ï¼ŒåŒæ—¶è¿˜è¦å°†jï¼ˆå‰ç¼€çš„é•¿åº¦ï¼‰èµ‹ç»™next[i]è®°å½•ä¸‹æ¥\n\n\n\nåšåŒ¹é…\n\nä¸‹æ ‡jæŒ‡å‘æ¨¡å¼ä¸²èµ·å§‹ä½ç½®,iæŒ‡å‘æ–‡æœ¬ä¸²èµ·å§‹ä½ç½®.jåˆå§‹å€¼ä¾ç„¶ä¸º-1[ç”¨-1è¡¨ç¤ºèµ·å§‹/ç©ºçŠ¶æ€]\niåœ¨æ–‡æœ¬ä¸²ä¸­ä¸æ–­è¿›è¡Œéå†,å¹¶ä¸”s[i]å’Œs[j+1]ä½œæ¯”è¾ƒ.\n\nå¦‚æœä¸åŒ,jå°±ä»nextæ•°ç»„é‡Œå¯»æ‰¾ä¸‹ä¸€ä¸ªåŒ¹é…çš„ä½ç½®(å¦‚æœjåœ¨å¼€å¤´,å°±ä¸åŠ¨)\nå¦‚æœç›¸åŒ,é‚£ä¹ˆijåŒæ—¶å‘åç§»åŠ¨\n\n\nå¦‚æœjæŒ‡å‘äº†æ¨¡å¼ä¸²çš„æœ«å°¾,é‚£ä¹ˆå°±è¯´æ˜æ¨¡å¼ä¸²tå®Œå…¨åŒ¹é…æ–‡æœ¬ä¸²sé‡Œçš„æŸå­ä¸²äº†\n\n\nå®é™…ä¸Šiæ˜¯ä¸€ç›´å¾€ä¸‹èµ°çš„,åªæœ‰jä¸€ç›´åœ¨è°ƒæ•´ä½ç½®å˜æ¢åˆ°(å‡è®¾å½“å‰æ˜¯æ–‡æœ¬ä¸²ä¸­çš„æ¨¡å¼ä¸²,é‚£ä¹ˆä¸ºäº†ç»§ç»­å¾€ä¸‹éå†, åº”è¯¥å¤„åœ¨å“ªä¸ªä¸‹æ ‡å¤„)\n\nä»£ç \næš´åŠ›è§£\n \nfunc strStr(haystack string, needle string) int {\n    l1:=len(haystack)\n    l2:=len(needle)\n    if l2==0{\n        return 0\n    }\n    if l1==0||l1&lt;l2{\n        return -1\n    }\n    for i:0=;i&lt;=l1-l2;i++{\n        if haystack[i:i+l2]==needle{\n            return i\n        }\n    }\n    return -1\n}\nkmp\nfunc strStr(haystack string, needle string) int {\n    if len(needle) == 0{\n        return 0\n    }\n    next:=make([]int,len(needle))\n    getNext(next, needle)\n    j:=-1\n    for i := 0; i &lt; len(haystack); i++ {\n\t\tfor j &gt;= 0 &amp;&amp; haystack[i] != needle[j+1] {\n\t\t\tj = next[j]     // å¯»æ‰¾ä¸‹ä¸€ä¸ªåŒ¹é…ç‚¹\n\t\t}\n\t\tif haystack[i] == needle[j+1] {\n\t\t\tj++\n\t\t}\n\t\tif j == len(needle)-1 {      // jæŒ‡å‘äº†æ¨¡å¼ä¸²çš„æœ«å°¾\n\t\t\treturn i - len(needle) + 1\n\t\t}\n\t}\n    return -1\n}\n \n \nfunc getNext(next []int, s string){\n    j:=-1\n    next[0]=j\n    for i:=1;i&lt;len(next);i++{\n        for j&gt;=0&amp;&amp;s[i]!=s[j+1]{\n            j=next[j]\n        }\n        if s[i]==s[j+1]{\n            j++\n        }\n        next[i]=j\n    }\n}"},"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/åŠ¨æ€è§„åˆ’ä¸å›æº¯/131.-åˆ†å‰²å›æ–‡ä¸²":{"slug":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/åŠ¨æ€è§„åˆ’ä¸å›æº¯/131.-åˆ†å‰²å›æ–‡ä¸²","filePath":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/åŠ¨æ€è§„åˆ’ä¸å›æº¯/131. åˆ†å‰²å›æ–‡ä¸².md","title":"131. åˆ†å‰²å›æ–‡ä¸²","links":[],"tags":[],"content":"ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸²Â sï¼Œè¯·ä½ å°†Â sÂ åˆ†å‰²æˆä¸€äº›Â å­ä¸²ï¼Œä½¿æ¯ä¸ªå­ä¸²éƒ½æ˜¯Â å›æ–‡ä¸²Â ã€‚è¿”å›Â sÂ æ‰€æœ‰å¯èƒ½çš„åˆ†å‰²æ–¹æ¡ˆã€‚\nå°è®°\nä¸€èˆ¬å†™ç€æ‰€æœ‰å¯èƒ½çš„åˆ†å‰²æ–¹æ¡ˆ,å°±å¾€å›æº¯å»æƒ³.\n\nç¬¬ä¸€ç§æ–¹æ³•,è¾“å…¥çš„è§†è§’.\n\nåˆ‡æˆ–è€…ä¸åˆ‡.å¦‚æœåˆ‡ä¸€åˆ€,å‰é¢çš„éƒ¨åˆ†å˜æˆä¸€ä¸ªå­ä¸²\n\n\nç¬¬äºŒç§æ–¹æ³•,ç­”æ¡ˆçš„è§†è§’,æšä¸¾é€‰å“ªä¸ª.\n\nç¬¬ä¸€åˆ€åˆ‡åœ¨å“ªï¼Ÿ (æšä¸¾ i ä» 1 åˆ° n)\n\nåˆ‡ 1 ä¸ªå­— aï¼šæ˜¯å›æ–‡å—ï¼Ÿæ˜¯ â†’ å‰©ä¸‹ ab ä¸¢ç»™é€’å½’å»åˆ‡ã€‚\nåˆ‡ 2 ä¸ªå­— aaï¼šæ˜¯å›æ–‡å—ï¼Ÿæ˜¯ â†’ å‰©ä¸‹ b ä¸¢ç»™é€’å½’å»åˆ‡ã€‚\nåˆ‡ 3 ä¸ªå­— aabï¼šæ˜¯å›æ–‡å—ï¼Ÿå¦ â†’ è·³è¿‡ã€‚\n\n\n\n\n\nä»£ç \n\nanså­˜æ‰€æœ‰çš„å¯èƒ½æ–¹æ¡ˆ\npathå­˜å½“å‰æ–¹æ¡ˆ\ndfsæ˜¯å¹²æ´»çš„å‡½æ•°\n\ndfsæ˜¯é€’å½’å‡½æ•°,å…ˆè€ƒè™‘ç»ˆæ­¢æ¡ä»¶.å½“å‰©ä¸‹é•¿åº¦ä¸º0çš„æ—¶å€™,è¯´æ˜så·²ç»è¢«åˆ†å‰²å®Œäº†,é‚£ä¹ˆæŠŠå½“å‰çš„pathå­˜åˆ°ansé‡Œé¢.\nå› ä¸ºæœ¬é¢˜ä¸­pathè¿™ä¸ªåˆ‡ç‰‡ä¸€ç›´åœ¨å¤ç”¨,æ‰€ä»¥å¦‚æœè¦å­˜è¿›ansä¸€å®šè¦ç”¨slices.Clone(path)\nç„¶åè¿›è¡Œåˆ‡å‰².å¯¹äºå½“å‰dfsçš„å­—ç¬¦ä¸²æ¥è¯´,å¯ä»¥åˆ‡1~nè¿™ä¹ˆå¤šç§.è€Œä¸”è¦æ˜¯å›æ–‡å­ä¸²,æ‰å¯ä»¥åˆ‡.é‚£ä¹ˆå°±å¾ªç¯å»åˆ¤æ–­å½“å‰åˆ‡çš„è¿™ä¸ªé•¿åº¦æ˜¯å¦æ˜¯å›æ–‡å­ä¸².\n\næ˜¯å›æ–‡å­ä¸²çš„è¯,è¿˜è¦é¢ä¸´ä¸‹é¢ä¸‰æ­¥.\né€‰å…¥path.é‚£ä¹ˆç»§ç»­å‰©ä¸‹çš„å­—ç¬¦ä¸²çš„dfs.dfsç»“æŸåå›æ¥,è¿˜è¦åšä¸€æ¬¡åæ‚”çš„å›æº¯,æŠŠæ”¾è¿›pathçš„å†å»æ‰.è¿™æ ·æ‰èƒ½éå†åˆ°æ‰€æœ‰çš„æ–¹æ³•\n\n\n\n\n\nfunc partition(s string) [][]string {\n    ans:=[][]string{}\n    path:=[]string{}\n    var dfs func(s string)\n    dfs=func(s string){\n        n:=len(s)\n        if n==0{\n            ans=append(ans,slices.Clone(path))\n            return \n        }\n        for i:=1;i&lt;=n;i++{// i çš„å€¼æ˜¯ 0, 1, 2 ... n-1\n            if isPalindrome(s[:i]){\n                 path=append(path,s[:i])\n                 dfs(s[i:])\n                 path=path[:len(path)-1]\n            }\n        }\n    }\n    dfs(s)\n    return ans\n}\n \nfunc isPalindrome(s string) bool{\n    n:=len(s)\n    for i:=range n/2{\n        if s[i]!=s[n-1-i]{\n            return false\n        }\n    }\n    return true\n}"},"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/åŠ¨æ€è§„åˆ’ä¸å›æº¯/139.-å•è¯æ‹†åˆ†":{"slug":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/åŠ¨æ€è§„åˆ’ä¸å›æº¯/139.-å•è¯æ‹†åˆ†","filePath":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/åŠ¨æ€è§„åˆ’ä¸å›æº¯/139. å•è¯æ‹†åˆ†.md","title":"139. å•è¯æ‹†åˆ†","links":[],"tags":[],"content":"ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸²Â sÂ å’Œä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨Â wordDictÂ ä½œä¸ºå­—å…¸ã€‚å¦‚æœå¯ä»¥åˆ©ç”¨å­—å…¸ä¸­å‡ºç°çš„ä¸€ä¸ªæˆ–å¤šä¸ªå•è¯æ‹¼æ¥å‡ºÂ sÂ åˆ™è¿”å›Â trueã€‚\næ³¨æ„ï¼šä¸è¦æ±‚å­—å…¸ä¸­å‡ºç°çš„å•è¯å…¨éƒ¨éƒ½ä½¿ç”¨ï¼Œå¹¶ä¸”å­—å…¸ä¸­çš„å•è¯å¯ä»¥é‡å¤ä½¿ç”¨ã€‚\nå°è®°\n\né¢„å¤„ç†.å°†å­—å…¸ä¸­çš„è¯æ”¾å…¥å“ˆå¸Œè¡¨.å¹¶è®°ä¸‹æœ€é•¿å•è¯çš„é•¿åº¦\nå®šä¹‰dpçŠ¶æ€æ•°ç»„\n\nf[i] çš„å«ä¹‰ï¼šå­—ç¬¦ä¸² s çš„å‰ i ä¸ªå­—ç¬¦ï¼ˆå³ s[0â€¦i-1]ï¼‰èƒ½å¦è¢«æ‹†åˆ†æˆå­—å…¸ä¸­çš„å•è¯.\\\n\næ³¨æ„f[0]éœ€è¦å…ˆé»˜è®¤ä¸ºtrue å¦åˆ™æ˜¯æ— æ³•è¿›è¡Œæ¥ä¸‹æ¥çš„é€’å½’äº†\n\n\nå†…å±‚å¾ªç¯j,å°†å‰iä¸ªå­—ç¬¦åˆ‡åˆ†æˆs[0â€¦j-1] å’Œ s[jâ€¦i-1] ç„¶ååˆ¤æ–­f[j-1]æ˜¯å¦èƒ½è¢«æ‹†åˆ†\\s[jâ€¦i-1]æ˜¯å¦åœ¨å­—å…¸é‡Œ.å¦‚æœéƒ½æ»¡è¶³,è¯´æ˜f[i]ä¹Ÿèƒ½å¤Ÿè¢«æ‹†åˆ†.\n\nåªè¦æ‰¾åˆ°ä¸€ç§åˆæ³•çš„åˆ‡åˆ†æ–¹å¼ï¼Œf[i] å°±æ˜¯ trueï¼Œæ— éœ€ç»§ç»­å°è¯•å…¶ä»– j\n\n\næ³¨æ„è¿™é‡Œçš„s[jâ€¦i-1] å¦‚æœè¶…è¿‡äº†æœ€é•¿å•è¯é•¿åº¦,å°±ä¸éœ€è¦å†å¾ªç¯äº†,å› ä¸ºæ˜¯ä¸å¯èƒ½äº‹ä»¶.\n\n\næœ€åè¿”å›f[n],å°±å¯ä»¥çŸ¥é“æ•´ä¸ªå­—ç¬¦ä¸²èƒ½å¦è¢«æ‹†åˆ†äº†.\n\nä»£ç \nfunc wordBreak(s string, wordDict []string) bool {\n\tinDict := map[string]bool{}\n\tmaxLen := 0\n\tfor _, c := range wordDict {\n\t\tinDict[c] = true\n\t\tmaxLen = max(maxLen, len(c))\n\t}\n\tn := len(s)\n\tf := make([]bool, n+1)\n\tf[0] = true\n\tfor i := 1; i &lt; n+1; i++ { //iæœ€å¤§å€¼éœ€è¦åˆ°n å› ä¸ºå¿…é¡»è¦è®¡ç®—åˆ°f[n]\n\t\tfor j := i - 1; j &gt;= max(i-maxLen, 0); j-- {\n\t\t\t//f[i-1]å’Œ s[i-1åˆ°i] å‰jä¸ª:0~j-1,åé¢:jåˆ°n-1  n)\n\t\t\tif f[j] &amp;&amp; inDict[s[j:i]] {\n\t\t\t\tf[i] = true\n\t\t\t\tbreak //åªè¦æœ‰ä¸€ç§å¯ä»¥åˆ’åˆ†æˆåŠŸçš„æ–¹æ¡ˆ,å°±å¯ä»¥è·³å‡ºè¿™æ¬¡å¾ªç¯äº†.æ¯•ç«Ÿiæ˜¯ä»å°åˆ°å¤§çš„\n\t\t\t}\n\t\t}\n\t}\n\treturn f[n]\n}"},"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/åŠ¨æ€è§„åˆ’ä¸å›æº¯/198.-æ‰“å®¶åŠ«èˆ":{"slug":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/åŠ¨æ€è§„åˆ’ä¸å›æº¯/198.-æ‰“å®¶åŠ«èˆ","filePath":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/åŠ¨æ€è§„åˆ’ä¸å›æº¯/198. æ‰“å®¶åŠ«èˆ.md","title":"198. æ‰“å®¶åŠ«èˆ","links":[],"tags":[],"content":"ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å°å·ï¼Œè®¡åˆ’å·çªƒæ²¿è¡—çš„æˆ¿å±‹ã€‚æ¯é—´æˆ¿å†…éƒ½è—æœ‰ä¸€å®šçš„ç°é‡‘ï¼Œå½±å“ä½ å·çªƒçš„å”¯ä¸€åˆ¶çº¦å› ç´ å°±æ˜¯ç›¸é‚»çš„æˆ¿å±‹è£…æœ‰ç›¸äº’è¿é€šçš„é˜²ç›—ç³»ç»Ÿï¼Œå¦‚æœä¸¤é—´ç›¸é‚»çš„æˆ¿å±‹åœ¨åŒä¸€æ™šä¸Šè¢«å°å·é—¯å…¥ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æŠ¥è­¦ã€‚\nç»™å®šä¸€ä¸ªä»£è¡¨æ¯ä¸ªæˆ¿å±‹å­˜æ”¾é‡‘é¢çš„éè´Ÿæ•´æ•°æ•°ç»„ï¼Œè®¡ç®—ä½  ä¸è§¦åŠ¨è­¦æŠ¥è£…ç½®çš„æƒ…å†µä¸‹ ï¼Œä¸€å¤œä¹‹å†…èƒ½å¤Ÿå·çªƒåˆ°çš„æœ€é«˜é‡‘é¢ã€‚\nå°è®°\nä»£ç \nfunc rob(nums []int) int {\n    n:=len(nums)\n    f:=make([]int,n+2)\n    f[0],f[1]=0,0\n    for i,x:=range nums{\n        f[i+2]=max(f[i+1],f[i]+x)\n    }\n    return f[n+1]\n}\n \n \n \nç®—å‡ºå½“å‰çŠ¶æ€ `f[i]`ï¼Œåªéœ€è¦å‰é¢ä¸¤ä¸ªçŠ¶æ€ `f[i-1]` å’Œ `f[i-2]`\nfunc rob(nums []int) int {\n    f0,f1:=0,0\n    for _,x:=range nums{\n        f0,f1=f1,max(f1,f0+x)\n    }\n    return f1\n}"},"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/åŠ¨æ€è§„åˆ’ä¸å›æº¯/279.-å®Œå…¨å¹³æ–¹æ•°":{"slug":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/åŠ¨æ€è§„åˆ’ä¸å›æº¯/279.-å®Œå…¨å¹³æ–¹æ•°","filePath":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/åŠ¨æ€è§„åˆ’ä¸å›æº¯/279. å®Œå…¨å¹³æ–¹æ•°.md","title":"279. å®Œå…¨å¹³æ–¹æ•°","links":[],"tags":[],"content":"ç»™ä½ ä¸€ä¸ªæ•´æ•°Â nÂ ï¼Œè¿”å›Â å’Œä¸ºÂ nÂ çš„å®Œå…¨å¹³æ–¹æ•°çš„æœ€å°‘æ•°é‡ ã€‚\nå®Œå…¨å¹³æ–¹æ•°Â æ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œå…¶å€¼ç­‰äºå¦ä¸€ä¸ªæ•´æ•°çš„å¹³æ–¹ï¼›æ¢å¥è¯è¯´ï¼Œå…¶å€¼ç­‰äºä¸€ä¸ªæ•´æ•°è‡ªä¹˜çš„ç§¯ã€‚ä¾‹å¦‚ï¼Œ1ã€4ã€9Â å’ŒÂ 16Â éƒ½æ˜¯å®Œå…¨å¹³æ–¹æ•°ï¼Œè€ŒÂ 3Â å’ŒÂ 11Â ä¸æ˜¯ã€‚\nå°è®°\n\nå®Œå…¨èƒŒåŒ…é—®é¢˜\n\nç‰©å“:å®Œå…¨å¹³æ–¹æ•°\nç‰©å“é‡é‡:æ•°å€¼æœ¬èº«.æ¯ä¸ªæ•°å­—ç®—ä¸€ä¸ªè®¡æ•°.\nç‰¹ç‚¹:æ¯ä¸ªæ•°å¯ä»¥æ— é™æ¬¡ä½¿ç”¨,å°±æ˜¯å®Œå…¨èƒŒåŒ…é—®é¢˜.\nç›®æ ‡:æŠŠèƒŒåŒ…è£…æ»¡,å¹¶ä¸”ç”¨çš„ç‰©å“æ•°é‡æœ€å°‘\n\n\nè®°å¿†åŒ–æœç´¢å½¢å¼(é€’å½’)\n\nåªè€ƒè™‘å‰iä¸ªå®Œå…¨å¹³æ–¹æ•°,å‡‘å‡ºå’Œä¸ºj,æœ€å°‘éœ€è¦å‡ ä¸ªæ•°\nå¦‚æœä¸é€‰i,é‚£å°±å¾—å»å‰i-1ä¸ªæ•°é‡Œé¢å‡‘j\nå¦‚æœé€‰äº†i,é‚£å‰©ä½™å®¹é‡å˜æˆj-iå¹³æ–¹.ä½†æ˜¯å› ä¸ºiå¯ä»¥é‡å¤é€‰,æ‰€ä»¥è¿˜æ˜¯åœ¨[é€‰äº†iä¸ªæ•°å‡‘æˆj-iå¹³æ–¹]çš„åŸºç¡€ä¸Š,åˆåŠ äº†ä¸€ä¸ªæ•°i.\nåœ¨é€‰å’Œä¸é€‰ä¸­å–ä¸€ä¸ªæœ€å°å€¼\n\n\né€’æ¨æ•°ç»„å½¢å¼\n\næ¢æˆæ•°ç»„\n\n\nç©ºé—´ä¼˜åŒ–æ¨è\n\nè®¡ç®—fijçš„æ—¶å€™å…¶å®åªéœ€è¦ä¸Šä¸€è¡Œçš„æ•°æ®å’Œæœ¬è¡Œå·¦è¾¹çš„æ•°æ®,å…¶å®åªéœ€è¦ä¸€ä¸ªä¸€ç»´æ•°ç»„,æœ¬æ¥æ”¾æ—§çš„,ç„¶åä¸€ä¸ªä¸ªå»è¦†ç›–å°±å¯ä»¥\næ³¨æ„è¿™ä¸ªæ€ç»´,å…·ä½“ä»£ç ä¸­æ˜¯å›ºå®šæ‹¿ç€ä¸€ä¸ªi,å»ä¸€ä¸ªä¸ªæ›´æ–°æ•°ç»„é‡Œçš„å†…å®¹.å®ç°ä¸Šéœ€è¦æ³¨æ„\nå†™æ³•ç»†èŠ‚\n\nweight[i]ï¼šå½“å‰è¦å¾€åŒ…é‡Œå¡çš„é‚£ä¸ª â€œå¤§çŸ³å—â€ï¼ˆæ¯”å¦‚æ˜¯ 9ï¼‰\njï¼šä¹Ÿå°±æ˜¯æƒ³å‡‘å‡ºçš„ç›®æ ‡æ•°å­—. ä»£ç ä¸­ä»weight[i]å‡‘åˆ°ç›®æ ‡n\n\nå½“jå°äºç‰©ä½“ä½“ç§¯çš„æ—¶å€™è¿™ä¸ªç‰©ä½“æ ¹æœ¬ä¸å¯ç”¨,æ‰€ä»¥ç›´æ¥ä»èƒ½è£…å¾—ä¸‹çš„é‚£ä¸ªå®¹é‡å¼€å§‹,å‰é¢çš„å®¹é‡ç›´æ¥å¿½ç•¥\n\n\ndp[j]ï¼šå‡‘å‡ºæ•°å­— j æœ€å°‘éœ€è¦å‡ ä¸ªçŸ³å—ã€‚\n\n\n\n\n\nç©ºé—´ä¼˜åŒ–çš„å†…å¤–å±‚å¾ªç¯èƒ½å¦äº’æ¢?\n\nå¤–å±‚å¾ªç¯ç‰©å“,å†…å±‚å¾ªç¯å®¹é‡: æŠŠç¡¬å¸1èƒ½å¹²çš„äº‹éƒ½å¹²å®Œ,å°±æ¢ç¡¬å¸2.è¿™æ ·èƒ½ä¿è¯ç‰©å“å‡ºç°çš„é¡ºåºå›ºå®š,ç®—çš„æ˜¯ç»„åˆæ•°.\n\næ³¨æ„è¿™é‡Œä¸€ä¸ªç‰©å“æ˜¯å¯ä»¥é‡å¤ç”¨çš„,å› ä¸ºå¾ªç¯å®¹é‡çš„æ—¶å€™,å¯¹ä¸åŒçš„å®¹é‡ä¼šä¸€ç›´æ›´æ–°çš„\nå¦‚æœç‰©å“ä¸èƒ½é‡å¤ç”¨,æˆ‘ä»¬å†…å±‚å¾ªç¯æ”¹æˆä»å¤§åˆ°å°,å°±å¯ä»¥é˜²æ­¢æœ¬å±‚çš„æ•°æ®æœ‰ä¸€æ¬¡æ±¡æŸ“æœ¬å±‚äº†.\n\n\nå¦‚æœå¤–å±‚å¾ªç¯å®¹é‡,å†…å±‚å¾ªç¯ç‰©å“,ç®—çš„æ˜¯æ’åˆ—æ•°,ä¸åŒé¡ºåº.å› ä¸ºæ˜¯åœ¨ä¸Šä¸€ä¸ªå®¹é‡çš„æ’åˆ—çš„åŸºç¡€ä¸Š,åˆå¾ªç¯äº†ç‰©å“.\nå¯¹äºæœ€å€¼é—®é¢˜,å› ä¸ºç®—çš„æ˜¯æ­¥éª¤æ•°,è€Œä¸”åŠ æ³•å¯ä»¥äº¤æ¢,å…¶å®é¡ºåºå¹¶ä¸å½±å“ç»“æœ,é‚£ä¹ˆç”¨ä¸¤ç§å¾ªç¯éƒ½å¯ä»¥çš„.\n\nä»£ç \nfunc numSquares(n int) int {\n    dp:=make([]int,n+1) \n    for i := 1; i &lt;= n; i++ {\n        dp[i] = math.MaxInt\n    }//æ³¨æ„è¿™é‡Œè¦ä¿ç•™ç¬¬ä¸€ä¸ªæ•°ä¸º0æ‰å¯ä»¥å¾€ä¸‹è¿›è¡Œ\n    for i:=1;i*i&lt;n+1;i++{\n        for j:=i*i;j&lt;=n;j++{\n            dp[j]=min(dp[j],dp[j-i*i]+1)//è¿™é‡Œè¿™ä¸ªj-i*i,å®é™…ä¸Šå°±æ˜¯æŠŠiæ”¾è¿›å»äº†.\n        }\n    }\n    return dp[n]\n}"},"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/åŠ¨æ€è§„åˆ’ä¸å›æº¯/300.-æœ€é•¿é€’å¢å­åºåˆ—":{"slug":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/åŠ¨æ€è§„åˆ’ä¸å›æº¯/300.-æœ€é•¿é€’å¢å­åºåˆ—","filePath":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/åŠ¨æ€è§„åˆ’ä¸å›æº¯/300. æœ€é•¿é€’å¢å­åºåˆ—.md","title":"300. æœ€é•¿é€’å¢å­åºåˆ—","links":[],"tags":[],"content":"ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„Â numsÂ ï¼Œæ‰¾åˆ°å…¶ä¸­æœ€é•¿ä¸¥æ ¼é€’å¢å­åºåˆ—çš„é•¿åº¦ã€‚\nå­åºåˆ—Â æ˜¯ç”±æ•°ç»„æ´¾ç”Ÿè€Œæ¥çš„åºåˆ—ï¼Œåˆ é™¤ï¼ˆæˆ–ä¸åˆ é™¤ï¼‰æ•°ç»„ä¸­çš„å…ƒç´ è€Œä¸æ”¹å˜å…¶ä½™å…ƒç´ çš„é¡ºåºã€‚ä¾‹å¦‚ï¼Œ[3,6,2,7]Â æ˜¯æ•°ç»„Â [0,3,1,6,2,2,7]Â çš„å­åºåˆ—ã€‚\nå°è®°\n\n\nå‡è®¾ nums[i] å¿…é¡»æ˜¯è¢«é€‰ä¸­çš„ï¼Œä¸”æ˜¯å­åºåˆ—çš„æœ€åä¸€ä¸ªæ•°ã€‚\nf[i] è¡¨ç¤ºï¼šä»¥ nums[i] è¿™ä¸ªæ•°ç»“å°¾çš„æœ€é•¿é€’å¢å­åºåˆ—çš„é•¿åº¦ã€‚\n\n\nåœ¨é•¿åº¦ç›¸åŒçš„æƒ…å†µä¸‹ï¼Œå­åºåˆ—çš„æœ«å°¾å…ƒç´ è¶Šå°ï¼Œæœªæ¥å˜é•¿çš„æ½œåŠ›è¶Šå¤§\næ‰€ä»¥gæ•°ç»„è®°å½•äº†,å„ä¸ªé•¿åº¦é˜Ÿä¼çš„æœ€å°é˜Ÿå°¾.\n\n\n\ng æ•°ç»„çš„æ¯ä¸€æ¬¡å¢é•¿ï¼ˆappendï¼‰ï¼Œéƒ½æ„å‘³ç€æˆ‘ä»¬çœŸçš„æ‰¾åˆ°äº†ä¸€ä¸ªæ¯”å½“å‰æœ€é•¿é“¾ç»“å°¾è¿˜è¦å¤§çš„æ•°ï¼Œä»è€ŒæŠŠæœ€é•¿é“¾å»¶é•¿äº† 1 ä½ã€‚\nä¸­é—´çš„é‚£äº›æ›¿æ¢ï¼ˆg[j] = xï¼‰ï¼Œåªæ˜¯åœ¨â€œä¼˜åŒ–å†…éƒ¨ç»“æ„â€ï¼Œè™½ç„¶æ²¡æœ‰ç«‹åˆ»è®©æ•°ç»„å˜é•¿ï¼Œä½†å®ƒæŠŠé—¨æ§›é™ä½äº†ï¼Œæ˜¯ä¸ºäº†è®©åé¢èƒ½æœ‰æ›´å¤šæœºä¼šè§¦å‘â€œå¢é•¿â€.\n\nå› æ­¤,å¯¹äºæ–°æ¥çš„æ•°å­—,æˆ‘ä»¬ç”¨äºŒåˆ†æŸ¥æ‰¾,åœ¨gä¸­æŸ¥æ‰¾.å¦‚æœxæ¯”gä¸­æ‰€æœ‰æ•°éƒ½å¤§,è¯´æ˜xå¯ä»¥æ¥åœ¨æœ€å¤§çš„æ•°å­—åé¢.å¦‚æœgé‡Œé¢æœ‰ä¸€ä¸ªæ•°å¤§äºç­‰äºx,å°±æ›¿æ¢.\n\n\n\n\nå¦‚æœæ˜¯10 20 30 è¿™æ—¶å€™æ¥äº†ä¸ª12 ä¼šå˜æˆ10 12 30 å…¶å®è¿™æœ¬èº«æ˜¯ä¸ç¬¦åˆé¢˜æ„çš„,å› ä¸º12æ˜¯åæ¥çš„,ä¸åº”è¯¥æ’åœ¨30çš„å‰é¢.\nå®é™…ä¸Šæœ¬é¢˜åªå…³å¿ƒé•¿åº¦,å¹¶ä¸å…³å¿ƒå…·ä½“æ˜¯è°æ„æˆçš„è¿™ä¸ªé•¿åº¦.ä½†æ˜¯æ¢æˆ12æ˜¯å¿…è¦çš„,å¦‚æœåç»­æ¥äº†15,åº”è¯¥æ›¿æ¢æ‰30,ä¼˜åŒ–ç»“æ„æˆ10 12 15,è¿™æ ·åç»­æ¥äº†29,å°±å¯ä»¥å¢é•¿è¿™ä¸ªåºåˆ—çš„é•¿åº¦.å¦‚æœä¿æŒæœ¬æ¥çš„10 20 30 çš„è¯u29æ˜¯æ— æ³•åŠ è¿›å»çš„.\n\nè¸¢æ‰æŸä¸ªå…ƒç´ ,å¹¶ä¸ä¼šå¯¼è‡´ç»“æœé”™è¯¯.å¦‚æœæ²¡èµ°åˆ°é•¿åº¦å¢åŠ çš„é‚£ä¸€æ­¥,æ˜¯ä¸å½±å“çš„\nè€Œå¦‚æœèµ°åˆ°é•¿åº¦å¢åŠ çš„ç¨‹åº¦,æ­£å¥½è¯´æ˜æ¯æ¬¡è¿›è¡Œæ›¿æ¢å¾—åˆ°æœ€ç»ˆçš„è¿™ä¸ªé•¿åº¦æ˜¯æœ€ä¼˜åºåˆ—.\n\n\n\nç›¸é‚»æ— å…³å­åºåˆ—é—®é¢˜ï¼ˆæ¯”å¦‚ 0-1 èƒŒåŒ…ï¼‰ï¼Œé€‚åˆã€Œé€‰æˆ–ä¸é€‰ã€ã€‚ ç›¸é‚»ç›¸å…³å­åºåˆ—é—®é¢˜ï¼ˆæ¯”å¦‚æœ¬é¢˜ï¼‰ï¼Œé€‚åˆã€Œæšä¸¾é€‰å“ªä¸ªã€\nè¿™è§£é‡Šäº†ä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸ç”¨èƒŒåŒ…é—®é¢˜çš„æ€è·¯ï¼ˆå¯¹äºæ¯ä¸ªæ•°ï¼Œå†³å®šé€‰å®ƒè¿˜æ˜¯ä¸é€‰å®ƒï¼‰\n\n\né€‰æˆ–ä¸é€‰ (0-1 èƒŒåŒ…): æˆ‘æ‹¿äº†è¿™ä¸ªè‹¹æœï¼Œå¹¶ä¸å½±å“æˆ‘èƒ½ä¸èƒ½æ‹¿ä¸‹ä¸€ä¸ªæ¢¨ã€‚å®ƒä»¬ä¹‹é—´æ²¡æœ‰å¤§å°å…³ç³»çš„çº¦æŸï¼Œåªå—æ€»å®¹é‡çº¦æŸã€‚\næšä¸¾é€‰å“ªä¸ª (LIS): æˆ‘é€‰äº† nums[i]ï¼Œé‚£ä¹ˆæˆ‘ä¸Šä¸€ä¸ªé€‰çš„å¿…é¡»æ˜¯ nums[j]ï¼Œä¸”å¿…é¡»æ»¡è¶³ nums[j] &lt; nums[i]ã€‚å…ƒç´ ä¹‹é—´æœ‰å¼ºçƒˆçš„æ¬¡åºå’Œå¤§å°ä¾èµ–ã€‚å¦‚æœå¼ºè¡Œç”¨â€œé€‰æˆ–ä¸é€‰â€ï¼Œéœ€è¦å¤šä¸€ä¸ªçŠ¶æ€å‚æ•°æ¥è®°å½•â€œä¸Šä¸€ä¸ªé€‰çš„æ•°æ˜¯è°â€ï¼Œè¿™ä¼šæŠŠç©ºé—´å¤æ‚åº¦æ’‘å¤§ã€‚\n\nä»£ç \nfunc lengthOfLIS(nums []int) int {\n    g:=[]int{}\n    for _,x:=range nums{\n        j:=sort.SearchInts(g,x)//è¿”å›ç¬¬ä¸€ä¸ª&gt;=xçš„ä¸‹æ ‡ä½ç½®\n        if j==len(g){\n            g=append(g,x)\n        }else{\n            g[j]=x\n        }\n    }\n    return len(g)\n}"},"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/åŠ¨æ€è§„åˆ’ä¸å›æº¯/322.-é›¶é’±å…‘æ¢":{"slug":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/åŠ¨æ€è§„åˆ’ä¸å›æº¯/322.-é›¶é’±å…‘æ¢","filePath":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/åŠ¨æ€è§„åˆ’ä¸å›æº¯/322. é›¶é’±å…‘æ¢.md","title":"322. é›¶é’±å…‘æ¢","links":["æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/åŠ¨æ€è§„åˆ’ä¸å›æº¯/279.-å®Œå…¨å¹³æ–¹æ•°"],"tags":[],"content":"ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„Â coinsÂ ï¼Œè¡¨ç¤ºä¸åŒé¢é¢çš„ç¡¬å¸ï¼›ä»¥åŠä¸€ä¸ªæ•´æ•°Â amountÂ ï¼Œè¡¨ç¤ºæ€»é‡‘é¢ã€‚\nè®¡ç®—å¹¶è¿”å›å¯ä»¥å‡‘æˆæ€»é‡‘é¢æ‰€éœ€çš„Â æœ€å°‘çš„ç¡¬å¸ä¸ªæ•°Â ã€‚å¦‚æœæ²¡æœ‰ä»»ä½•ä¸€ç§ç¡¬å¸ç»„åˆèƒ½ç»„æˆæ€»é‡‘é¢ï¼Œè¿”å›Â -1Â ã€‚\nä½ å¯ä»¥è®¤ä¸ºæ¯ç§ç¡¬å¸çš„æ•°é‡æ˜¯æ— é™çš„ã€‚\nå°è®°\nè¯¦è§279. å®Œå…¨å¹³æ–¹æ•°\nä»£ç \nfunc coinChange(coins []int, amount int) int {\n    dp:=make([]int,amount+1)\n    n:=len(coins)\n    for i:=1;i&lt;amount+1;i++{\n        dp[i]=amount + 1\n    }\n    for j:=0;j&lt;n;j++{\n        for k:=coins[j];k&lt;amount+1;k++{\n            dp[k]=min(dp[k],dp[k-coins[j]]+1)\n        }\n    }\n    if dp[amount]==amount + 1{\n        return -1\n    }else{\n        return dp[amount]\n    }\n}"},"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/åŠ¨æ€è§„åˆ’ä¸å›æº¯/45.-è·³è·ƒæ¸¸æˆII":{"slug":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/åŠ¨æ€è§„åˆ’ä¸å›æº¯/45.-è·³è·ƒæ¸¸æˆII","filePath":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/åŠ¨æ€è§„åˆ’ä¸å›æº¯/45. è·³è·ƒæ¸¸æˆII.md","title":"45. è·³è·ƒæ¸¸æˆII","links":[],"tags":[],"content":"ç»™å®šä¸€ä¸ªé•¿åº¦ä¸º n çš„ 0 ç´¢å¼•æ•´æ•°æ•°ç»„ numsã€‚åˆå§‹ä½ç½®åœ¨ä¸‹æ ‡ 0ã€‚\næ¯ä¸ªå…ƒç´  nums[i] è¡¨ç¤ºä»ç´¢å¼• i å‘åè·³è½¬çš„æœ€å¤§é•¿åº¦ã€‚æ¢å¥è¯è¯´ï¼Œå¦‚æœä½ åœ¨ç´¢å¼• i å¤„ï¼Œä½ å¯ä»¥è·³è½¬åˆ°ä»»æ„ (i + j) å¤„ï¼š\n0 â‡ j â‡ nums[i] ä¸”\ni + j &lt; n\nè¿”å›åˆ°è¾¾ n - 1 çš„æœ€å°è·³è·ƒæ¬¡æ•°ã€‚æµ‹è¯•ç”¨ä¾‹ä¿è¯å¯ä»¥åˆ°è¾¾ n - 1ã€‚\nå°è®°\nåªè¦æœ€å¤§è·³è·ƒè·ç¦»è¶…è¿‡ç›®æ ‡åœ°ç‚¹å°±å¯ä»¥ã€‚\nåœ¨å¯ä»¥é€‰çš„æ¡¥ä¸­ï¼Œé€‰æ‹©å³ç«¯ç‚¹æœ€å¤§çš„æ¡¥ã€‚é‡å¤è¯¥è¿‡ç¨‹ï¼Œåœ¨èƒ½åˆ°è¾¾ç»ˆç‚¹æ—¶é€€å‡ºå¾ªç¯\nä¸€æ—¦çš„ curRight è¦†ç›–äº†ç»ˆç‚¹ï¼Œi å°±å†ä¹Ÿè¿½ä¸ä¸Š curRight äº†ï¼Œæ‰€ä»¥ ans++ å°±æ°¸è¿œä¸ä¼šå†è§¦å‘äº†\n\nä¸æ˜¯åœ¨æ— è·¯å¯èµ°çš„é‚£ä¸ªä½ç½®é€ æ¡¥ï¼Œè€Œæ˜¯å½“å‘ç°æ— è·¯å¯èµ°çš„æ—¶å€™ï¼Œæ—¶å…‰å€’æµåˆ°èƒ½è·³åˆ°æœ€è¿œç‚¹çš„é‚£ä¸ªä½ç½®é€ æ¡¥ã€‚æ¢å¥è¯è¯´ï¼Œåœ¨æ— è·¯å¯èµ°ä¹‹å‰ï¼Œæˆ‘ä»¬ä¸€ç›´åœ¨é»˜é»˜åœ°æ”¶é›†ä¿¡æ¯ã€‚å½“å‘ç°æ— è·¯å¯èµ°çš„æ—¶å€™ï¼Œæ‰ä»æ”¶é›†åˆ°çš„ä¿¡æ¯ä¸­ï¼Œé€‰æ‹©æœ€è¿œç‚¹é€ æ¡¥ã€‚æ‰€å»ºé€ çš„è¿™åº§æ¡¥çš„å·¦ç«¯ç‚¹ï¼ˆèµ·è·³ä½ç½®ï¼‰å¯èƒ½åœ¨æˆ‘ä»¬å½“å‰èµ°çš„è¿™åº§æ¡¥çš„ä¸­é—´ã€‚\n\nä»£ç \nfunc jump(nums []int) (ans int) {\n    curRight := 0  // å·²å»ºé€ çš„æ¡¥çš„å³ç«¯ç‚¹\n    nextRight := 0 // ä¸‹ä¸€åº§æ¡¥çš„å³ç«¯ç‚¹çš„æœ€å¤§å€¼\n    for i, num := range nums[:len(nums)-1] {\n        // éå†çš„è¿‡ç¨‹ä¸­ï¼Œè®°å½•ä¸‹ä¸€åº§æ¡¥çš„æœ€è¿œç‚¹\n        nextRight = max(nextRight, i+num)\n        if i == curRight { // æ— è·¯å¯èµ°ï¼Œå¿…é¡»å»ºæ¡¥\n            curRight = nextRight // å»ºæ¡¥åï¼Œæœ€è¿œå¯ä»¥åˆ°è¾¾ next_right\n            ans++\n        }\n    }\n    return\n}"},"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/åŠ¨æ€è§„åˆ’ä¸å›æº¯/51.-N-çš‡å":{"slug":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/åŠ¨æ€è§„åˆ’ä¸å›æº¯/51.-N-çš‡å","filePath":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/åŠ¨æ€è§„åˆ’ä¸å›æº¯/51. N çš‡å.md","title":"51. N çš‡å","links":[],"tags":[],"content":"æŒ‰ç…§å›½é™…è±¡æ£‹çš„è§„åˆ™ï¼Œçš‡åå¯ä»¥æ”»å‡»ä¸ä¹‹å¤„åœ¨åŒä¸€è¡Œæˆ–åŒä¸€åˆ—æˆ–åŒä¸€æ–œçº¿ä¸Šçš„æ£‹å­ã€‚\nnÂ çš‡åé—®é¢˜Â ç ”ç©¶çš„æ˜¯å¦‚ä½•å°†Â nÂ ä¸ªçš‡åæ”¾ç½®åœ¨Â nÃ—nÂ çš„æ£‹ç›˜ä¸Šï¼Œå¹¶ä¸”ä½¿çš‡åå½¼æ­¤ä¹‹é—´ä¸èƒ½ç›¸äº’æ”»å‡»ã€‚\nç»™ä½ ä¸€ä¸ªæ•´æ•°Â nÂ ï¼Œè¿”å›æ‰€æœ‰ä¸åŒçš„Â nÂ çš‡åé—®é¢˜Â çš„è§£å†³æ–¹æ¡ˆã€‚\næ¯ä¸€ç§è§£æ³•åŒ…å«ä¸€ä¸ªä¸åŒçš„Â n çš‡åé—®é¢˜Â çš„æ£‹å­æ”¾ç½®æ–¹æ¡ˆï¼Œè¯¥æ–¹æ¡ˆä¸­Â &#039;Q&#039;Â å’ŒÂ &#039;.&#039;Â åˆ†åˆ«ä»£è¡¨äº†çš‡åå’Œç©ºä½ã€‚\nå°è®°\nè¿”å›æ‰€æœ‰æ–¹æ¡ˆ:å›æº¯\n\nå…ˆå†™ä¸€ä¸ªå°å‡½æ•°.åœ¨å½“å‰çš„æ‘†æ”¾æƒ…å†µä¸‹,æ‘†æ”¾åœ¨å½“å‰ä½ç½®æ˜¯å¦æœ‰æ•ˆ.\nä¸‰æ­¥èµ°:æ‘†æ”¾\\æ·±åº¦\\å›æº¯\n\nä½†æ˜¯è¿˜æœ‰é—®é¢˜éœ€è¦è§£å†³\nç»“æ„é—®é¢˜: è¿™ä¸ªä¸€è¡Œæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²,ç„¶åå››è¡Œç»„æˆä¸€ä¸ªåˆ‡ç‰‡.\nä»£ç \nfunc solveNQueens(n int) [][]string {\n    queens:=make([]int,n)//ç¬¬iè¡Œçš„çš‡åæ‰€åœ¨åˆ—.næ˜¯è¡Œæ•°.\n    col:=make([]bool,n)//ç¬¬iåˆ—æ˜¯å¦å­˜åœ¨çš‡å.næ˜¯åˆ—æ•°\n    diag1:=make([]bool,2*n-1) //å·¦ä¸Šè§’\n    diag2:=make([]bool,2*n-1) //å³ä¸Šè§’\n    ans:=[][]string{}\n    var dfs func(r int)  //ç¡®å®šç‰¹å®šrowçš„çš‡åä½ç½®\n    dfs=func(r int){\n        if r==n{\n            //ç»„ç»‡ç­”æ¡ˆ,åŠ å…¥ç­”æ¡ˆæ•°ç»„\n            vals:=make([]string,n)\n            for i,c:=range queens{\n                //ç¬¬iè¡Œéœ€è¦ä¸€ä¸ªstring,å‰cä¸ªæ˜¯.\n                vals[i]=strings.Repeat(&quot;.&quot;,c)+&quot;Q&quot;+strings.Repeat(&quot;.&quot;,n-1-c)\n            }\n            ans=append(ans,vals)\n            return \n        }\n \n        //æ¥ä¸‹æ¥è¿›å…¥å›æº¯é˜¶æ®µ\n        // \n        for c:=range n{//cä»1åˆ°n-1\n            rc:=r-c+n-1\n            if !col[c]&amp;&amp;!diag1[r+c]&amp;&amp;!diag2[rc]{\n                queens[r]=c//å‡è®¾å½“å‰rowçš„çš‡åä½ç½®åœ¨c\n                col[c],diag1[r+c],diag2[rc]=true,true,true\n                dfs(r+1)\n                col[c],diag1[r+c],diag2[rc]=false,false,false\n            }\n        }\n    }\n    dfs(0)\n    return ans\n }\n "},"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/åŠ¨æ€è§„åˆ’ä¸å›æº¯/56.-åˆå¹¶åŒºé—´":{"slug":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/åŠ¨æ€è§„åˆ’ä¸å›æº¯/56.-åˆå¹¶åŒºé—´","filePath":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/åŠ¨æ€è§„åˆ’ä¸å›æº¯/56. åˆå¹¶åŒºé—´.md","title":"56. åˆå¹¶åŒºé—´","links":[],"tags":[],"content":"ä»¥æ•°ç»„Â intervalsÂ è¡¨ç¤ºè‹¥å¹²ä¸ªåŒºé—´çš„é›†åˆï¼Œå…¶ä¸­å•ä¸ªåŒºé—´ä¸ºÂ intervals[i] = [starti, endi]Â ã€‚è¯·ä½ åˆå¹¶æ‰€æœ‰é‡å çš„åŒºé—´ï¼Œå¹¶è¿”å›Â \\ä¸€ä¸ªä¸é‡å çš„åŒºé—´æ•°ç»„ï¼Œè¯¥æ•°ç»„éœ€æ°å¥½è¦†ç›–è¾“å…¥ä¸­çš„æ‰€æœ‰åŒºé—´ã€‚\nå°è®°\n\nå…ˆå¯¹æ¯ä¸ªåŒºé—´çš„å·¦ç«¯ç‚¹è¿›è¡Œæ’åº,è¿™æ ·å¯ä»¥ä¿è¯,å¦‚æœä¸‹ä¸€ä¸ªåŒºé—´ä¸èƒ½å’Œå½“å‰åŒºé—´åˆå¹¶,è¯´æ˜å½“å‰åŒºé—´ç¡®å®åˆå¹¶å®Œæ¯•äº†,å¯ä»¥ä»¥ä¸‹ä¸€ä¸ªæ•°ç»„ä¸ºå¼€å¤´å…ƒç´ å¾€ä¸‹åˆå¹¶.\nåˆå¹¶é€»è¾‘:å½“sjè½åœ¨ç¬¬ä¸€ä¸ªåŒºé—´å†…,é‚£ä¹ˆä¸¤ä¸ªåŒºé—´å°±å¯ä»¥åˆå¹¶,â†’[si,max(ei,ej)]\nå®é™…ä¸Šåˆå¹¶çš„è¿‡ç¨‹æ˜¯åœ¨ç­”æ¡ˆæ•°ç»„ä¸­å®Œæˆçš„,å¦‚æœåˆå¹¶å°±æ›´æ–°,æ— æ³•åˆå¹¶å°±æŠŠæ–°çš„å¼€å¤´å…ƒç´ åŠ è¿›å»,ç­‰å¾…åç»­æ›´æ–°.\n\nä»£ç \nfunc merge(intervals [][]int) (ans [][]int) {\n    slices.SortFunc(intervals, func(p, q []int) int { return p[0] - q[0] }) // æŒ‰ç…§å·¦ç«¯ç‚¹ä»å°åˆ°å¤§æ’åº\n    for _, p := range intervals {\n        m := len(ans)\n        if m &gt; 0 &amp;&amp; p[0] &lt;= ans[m-1][1] { // å¯ä»¥åˆå¹¶\n            ans[m-1][1] = max(ans[m-1][1], p[1]) // æ›´æ–°å³ç«¯ç‚¹æœ€å¤§å€¼\n        } else { // ä¸ç›¸äº¤ï¼Œæ— æ³•åˆå¹¶\n            ans = append(ans, p) // æ–°çš„åˆå¹¶åŒºé—´\n        }\n    }\n    return\n}"},"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/åŠ¨æ€è§„åˆ’ä¸å›æº¯/62.-ä¸åŒè·¯å¾„":{"slug":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/åŠ¨æ€è§„åˆ’ä¸å›æº¯/62.-ä¸åŒè·¯å¾„","filePath":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/åŠ¨æ€è§„åˆ’ä¸å›æº¯/62. ä¸åŒè·¯å¾„.md","title":"62. ä¸åŒè·¯å¾„","links":[],"tags":[],"content":"ä¸€ä¸ªæœºå™¨äººä½äºä¸€ä¸ªÂ m x nÂ ç½‘æ ¼çš„å·¦ä¸Šè§’ ï¼ˆèµ·å§‹ç‚¹åœ¨ä¸‹å›¾ä¸­æ ‡è®°ä¸º â€œStartâ€ ï¼‰ã€‚\næœºå™¨äººæ¯æ¬¡åªèƒ½å‘ä¸‹æˆ–è€…å‘å³ç§»åŠ¨ä¸€æ­¥ã€‚æœºå™¨äººè¯•å›¾è¾¾åˆ°ç½‘æ ¼çš„å³ä¸‹è§’ï¼ˆåœ¨ä¸‹å›¾ä¸­æ ‡è®°ä¸º â€œFinishâ€ ï¼‰ã€‚\né—®æ€»å…±æœ‰å¤šå°‘æ¡ä¸åŒçš„è·¯å¾„ï¼Ÿ\nå°è®°\nå›æº¯é€šå¸¸ç”¨äºæ±‚å…·ä½“çš„è·¯å¾„åˆ—è¡¨ï¼ˆä¾‹å¦‚ï¼šæ‰“å°å‡ºæ‰€æœ‰è·¯å¾„ï¼‰ï¼Œè€Œä¸æ˜¯æ±‚è·¯å¾„çš„æ•°é‡ã€‚æ±‚æ•°é‡é€šå¸¸ä½¿ç”¨åŠ¨æ€è§„åˆ’\nä»£ç \nclass Solution:\n    def uniquePaths(self, m: int, n: int) -&gt; int:\n        f = [[0] * (n + 1) for _ in range(m + 1)]\n        f[0][1] = 1\n        for i in range(m):\n            for j in range(n):\n                f[i + 1][j + 1] = f[i][j + 1] + f[i + 1][j]\n        return f[m][n]\n \nfunc uniquePaths(m, n int) int {\n    f := make([]int, n+1)\n    f[1] = 1\n    for range m {\n        for j := range n {\n            f[j+1] += f[j]\n        }\n    }\n    return f[n]\n}\n \n \nè¿˜å¯ä»¥ç”¨ç»„åˆæ•°,æ—¶é—´å¤æ‚åº¦å°±æ˜¯min(m,n)å› ä¸ºåªæœ‰æ•°å­¦è®¡ç®—. ä½†æ˜¯é˜¶ä¹˜ä¼šæœ‰å¤§æ•°æº¢å‡ºé£é™©."},"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/åŠ¨æ€è§„åˆ’ä¸å›æº¯/64.-æœ€å°è·¯å¾„å’Œ":{"slug":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/åŠ¨æ€è§„åˆ’ä¸å›æº¯/64.-æœ€å°è·¯å¾„å’Œ","filePath":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/åŠ¨æ€è§„åˆ’ä¸å›æº¯/64. æœ€å°è·¯å¾„å’Œ.md","title":"64. æœ€å°è·¯å¾„å’Œ","links":[],"tags":[],"content":"ç»™å®šä¸€ä¸ªåŒ…å«éè´Ÿæ•´æ•°çš„Â _m_Â xÂ _n_Â ç½‘æ ¼Â gridÂ ï¼Œè¯·æ‰¾å‡ºä¸€æ¡ä»å·¦ä¸Šè§’åˆ°å³ä¸‹è§’çš„è·¯å¾„ï¼Œä½¿å¾—è·¯å¾„ä¸Šçš„æ•°å­—æ€»å’Œä¸ºæœ€å°ã€‚\nè¯´æ˜ï¼šæ¯æ¬¡åªèƒ½å‘ä¸‹æˆ–è€…å‘å³ç§»åŠ¨ä¸€æ­¥ã€‚\nå°è®°\nå†™æ³•2: å¸¦å“¨å…µçš„ 2D DPâ€”ä¼˜é›…è§£å†³è¾¹ç•Œé—®é¢˜\n\nå®šä¹‰Â dfs(i,j)Â è¡¨ç¤ºä»å·¦ä¸Šè§’åˆ°ç¬¬Â iÂ è¡Œç¬¬Â jÂ åˆ—è¿™ä¸ªæ ¼å­ï¼ˆè®°ä½œÂ (i,j)ï¼‰çš„æœ€å°ä»·å€¼å’Œ.\nçŠ¶æ€è½¬ç§»æ–¹ç¨‹:dfs(i,j)=min(dfs(i,jâˆ’1),dfs(iâˆ’1,j))+grid[i][j]\nå“¨å…µå°±æ˜¯ å¤šç”³è¯·ä¸€è¡Œä¸€åˆ—,ä¸€å¼€å§‹åˆå§‹åŒ–ä¸ºæœ€å¤§å€¼,åç»­åŠ¨æ€è§„åˆ’éƒ½ä»+1å¼€å§‹\n\nå†™æ³•3: ä¸€ç»´æ»šåŠ¨æ•°ç»„\n\næ³¨æ„ç»™å·¦è¾¹å“¨å…µå’Œç¬¬ä¸€è¡Œå“¨å…µèµ‹æœ€å¤§å€¼\nç„¶åä»f[1]å¼€å§‹,æ‰€ä»¥f[1]ä¸€å¼€å§‹è¦èµ‹å€¼0.è¿™æ ·æ‰èƒ½é€šç”¨çŠ¶æ€è½¬ç§»æ–¹ç¨‹.ä½†æ˜¯f[0]ä¸€å®šè¦æ˜¯æœ€å¤§å€¼\n\næ–°çš„ f[0] å…¶å®ä¸ä¼šè¢«è¦†ç›–\nå› ä¸º f[j+1] ä¸å¯èƒ½ç­‰äº f[0] æ‰€ä»¥ä¸€ç›´ä¸è¢«èµ‹å€¼\nä½†æ˜¯ä¼šç”¨åˆ° f[0]ï¼Œè¿™ä¸ª f[0] å¿…é¡»ä¸å½±å“ f[1] çš„ç»“æœ\né‚£ä¹ˆä¹‹åçš„æ–°f[1]å°±æ˜¯è¿™ä¸ªf[0]å’Œä¹‹å‰çš„æ—§f[1]å–æœ€å°å€¼å¹¶ä¸”åŠ ä¸Šè‡ªå·±çš„å¤§å°,å®Œå…¨ç¬¦åˆé¢˜ç›®è¦æ±‚.\n\n\n\nä»£ç \nåˆè§çš„å†™æ³•: ä½†æ˜¯ifåˆ¤æ–­å¤ªå¤šäº†.å†™æ³•2æ”¹æˆå…ˆå¤„ç†ç¬¬ä¸€è¡Œå’Œç¬¬ä¸€åˆ—\nfunc minPathSum(grid [][]int) int {\n\t//ä»å·¦ä¸Šè§’åˆ°å³ä¸‹è§’çš„è·¯å¾„:åªèƒ½å‘å³æˆ–è€…å‘ä¸‹,ç§»åŠ¨ä¸€æ­¥.\n\t//ä¸€ä¸ªmxnçš„grid å­˜å‚¨åˆ°è¾¾è¿™ä¸ªæ ¼å­ijçš„æœ€å°æ•°å­—æ€»å’Œ.ç„¶åæ±‚mnå°±è¡Œ\n\tm := len(grid)\n\tn := len(grid[0])\n\tsum := make([][]int, m)\n\tfor i := range m {\n\t\tsum[i] = make([]int, n)\n\t}\n\tsum[0][0] = grid[0][0]\n\tfor i, row := range sum {\n \n\t\tfor j, _ := range row {\n\t\t\tif i == 0 &amp;&amp; j &gt; 0 {\n\t\t\t\tsum[0][j] = grid[0][j] + sum[0][j-1]\n \n\t\t\t}\n\t\t\tif j == 0 &amp;&amp; i &gt; 0 {\n\t\t\t\tsum[i][0] = grid[i][0] + sum[i-1][0]\n \n\t\t\t} else if i &gt; 0 &amp;&amp; j &gt; 0 {\n\t\t\t\tsum[i][j] = min(sum[i][j-1], sum[i-1][j]) + grid[i][j]\n \n\t\t\t}\n\t\t}\n\t}\n\treturn sum[m-1][n-1]\n}\nå†™æ³•2: å¸¦å“¨å…µçš„ 2D DPâ€”ä¼˜é›…è§£å†³è¾¹ç•Œé—®é¢˜\nfunc minPathSum(grid [][]int) int {\n    m, n := len(grid), len(grid[0])\n    f := make([][]int, m+1)//å¤šåˆå§‹åŒ–ä¸€è¡Œ\n    for i := range f {\n        f[i] = make([]int, n+1)//å¤šåˆå§‹åŒ–ä¸€è¡Œ\n    }\n    for j := range f[0] {\n        f[0][j] = math.MaxInt\n    }\n    for i, row := range grid {\n        f[i+1][0] = math.MaxInt//// åœ¨éå†æ¯ä¸€è¡Œæ—¶ï¼Œé¡ºæ‰‹æŠŠè¯¥è¡Œçš„ç¬¬ 0 åˆ—è®¾ä¸ºæ— ç©·å¤§\n        for j, x := range row {\n            if i == 0 &amp;&amp; j == 0 {\n                f[1][1] = x\n            } else {\n                f[i+1][j+1] = min(f[i+1][j], f[i][j+1]) + x\n            }\n        }\n    }\n    return f[m][n]\n}\n \nå†™æ³•3: ä¸€ç»´æ»šåŠ¨æ•°ç»„\nfunc minPathSum(grid [][]int) int {\n    n:=len(grid[0])\n    f:=make([]int,n+1)\n    for i,_:=range f{\n        f[i]=math.MaxInt\n    }\n    f[1]=0\n    for _,row:=range grid{\n        for j,x:=range row{\n            f[j+1]=min(f[j],f[j+1])+x\n        }\n    }\n    return f[n]\n}\n "},"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/åŠ¨æ€è§„åˆ’ä¸å›æº¯/70.-çˆ¬æ¥¼æ¢¯":{"slug":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/åŠ¨æ€è§„åˆ’ä¸å›æº¯/70.-çˆ¬æ¥¼æ¢¯","filePath":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/åŠ¨æ€è§„åˆ’ä¸å›æº¯/70. çˆ¬æ¥¼æ¢¯.md","title":"70. çˆ¬æ¥¼æ¢¯","links":["æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/åŠ¨æ€è§„åˆ’ä¸å›æº¯/åŠ¨æ€è§„åˆ’-è´ªå¿ƒç®—æ³•"],"tags":[],"content":"å‡è®¾ä½ æ­£åœ¨çˆ¬æ¥¼æ¢¯ã€‚éœ€è¦Â nÂ é˜¶ä½ æ‰èƒ½åˆ°è¾¾æ¥¼é¡¶ã€‚\næ¯æ¬¡ä½ å¯ä»¥çˆ¬Â 1Â æˆ–Â 2Â ä¸ªå°é˜¶ã€‚ä½ æœ‰å¤šå°‘ç§ä¸åŒçš„æ–¹æ³•å¯ä»¥çˆ¬åˆ°æ¥¼é¡¶å‘¢ï¼Ÿ\nTransclude of åŠ¨æ€è§„åˆ’-è´ªå¿ƒç®—æ³•#åŠ¨æ€è§„åˆ’æ€è·¯\nä»£ç \n//æ˜“è¯»ç‰ˆ\nfunc climbStairs(n int) int {\n    if n == 1 {\n        return 1 // ç‰¹æ®Šå¤„ç†\n    }\n    f:=make([]int,n+1)\n    f[1],f[2]=1,2\n    for i:=3;i&lt;=n;i++{\n        f[i]=f[i-1]+f[i-2]\n    }\n    return f[n]\n}\n \n//ä¸æ˜“è¯»ç‰ˆ\nfunc climbStairs(n int) int {\n    // å®šä¹‰ dp æ•°ç»„ï¼ˆè¿™é‡Œå« fï¼‰\n    f := make([]int, n+1)\n    // åˆå§‹åŒ–è¾¹ç•Œ\n    f[0], f[1] = 1, 1//å…¶å®è¿™ä¸ªf[0]=1æ˜¯å¾ˆä¸å¥½è§£é‡Šçš„,ä½†æ˜¯å‡ºäºç»“æœé©±åŠ¨è¿˜æ˜¯=1å§\n    for i := 2; i &lt;= n; i++ {\n        f[i] = f[i-1] + f[i-2]\n    }\n    return f[n]\n}\n \n \n//ç©ºé—´ä¼˜åŒ–ç‰ˆ\nfunc climbStairs(n int) int {\n    p, q := 1, 1 // pæ˜¯å‰ä¸¤æ­¥ï¼Œqæ˜¯å‰ä¸€æ­¥\n    for i := 2; i &lt;= n; i++ {\n        p, q = q, p+q // æ»šåŠ¨æ›´æ–°\n    }\n    return q\n}"},"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/åŠ¨æ€è§„åˆ’ä¸å›æº¯/72.-ç¼–è¾‘è·ç¦»":{"slug":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/åŠ¨æ€è§„åˆ’ä¸å›æº¯/72.-ç¼–è¾‘è·ç¦»","filePath":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/åŠ¨æ€è§„åˆ’ä¸å›æº¯/72. ç¼–è¾‘è·ç¦».md","title":"72. ç¼–è¾‘è·ç¦»","links":[],"tags":[],"content":"å¤ªéš¾äº†ä¸çœ‹è§†é¢‘æ ¹æœ¬æƒ³ä¸é€š\nç»™ä½ ä¸¤ä¸ªå•è¯Â word1Â å’ŒÂ word2ï¼ŒÂ è¯·è¿”å›å°†Â word1Â è½¬æ¢æˆÂ word2Â æ‰€ä½¿ç”¨çš„æœ€å°‘æ“ä½œæ•°_\nä½ å¯ä»¥å¯¹ä¸€ä¸ªå•è¯è¿›è¡Œå¦‚ä¸‹ä¸‰ç§æ“ä½œï¼š\n\næ’å…¥ä¸€ä¸ªå­—ç¬¦\nåˆ é™¤ä¸€ä¸ªå­—ç¬¦\næ›¿æ¢ä¸€ä¸ªå­—ç¬¦\n\nå°è®°\nsä¸‹æ ‡iè¡¨ç¤ºå­—ç¬¦ä¸²é‡Œçš„ç¬¬i+1ä¸ªå­—ç¬¦.\nf[k][â€¦] çš„kè¡¨ç¤ºå‰kä¸ªå­—ç¬¦ç»„æˆçš„å­—ç¬¦ä¸².0å°±è¡¨ç¤ºå‰0ä¸ªå­—ç¬¦ä¹Ÿå°±æ˜¯ç©ºå­—ç¬¦ä¸²\næ‰€ä»¥å½“æˆ‘æ‹¿ç€ä¸‹æ ‡içš„å­—ç¬¦æ—¶,æˆ‘å®é™…ä¸Šåœ¨å¤„ç†å‰i+1ä¸ªå­—ç¬¦.å¯¹åº”çš„ä¹Ÿå°±æ˜¯f[i+1]\næ‰€ä»¥éå†ijçš„æ—¶å€™å®é™…ä¸Šåœ¨å¡«å†™f[i+1][j+1]è¿™ä¸ªæ ¼å­\n\nå½“x=y(ç¬¬i+1ä¸ªå­—ç¬¦å’Œç¬¬j+1ä¸ªå­—ç¬¦ç›¸ç­‰çš„æ—¶å€™ )f[i+1][j+1] (å½“å‰æ ¼) çš„å€¼ï¼Œç›´æ¥ç»§æ‰¿ f[i][j] (å·¦ä¸Šè§’)ã€‚\nå½“x!=yçš„æ—¶å€™\n\nåˆ é™¤sçš„å­—ç¬¦.é‚£ä¹ˆå°±æ˜¯ç”¨å‰iä¸ªå­—ç¬¦åŒ¹é…j+1ä¸ªå­—ç¬¦.å†åŠ ä¸Šåˆ é™¤æ“ä½œ:f[i][j+1] + 1\nç±»ä¼¼çš„.\n\n\n\nä»£ç \nfunc minDistance(s, t string) int {\n    n, m := len(s), len(t)\n    f := make([][]int, n+1)\n    for i := range f {\n        f[i] = make([]int, m+1)\n    }\n    for j := range m {//æ³¨æ„è¿™é‡Œçš„å†™æ³• 1.22çš„ç‰¹æ€§ å¯ä»¥éå†æ•´æ•°\n        f[0][j+1] = j + 1\n    }\n    for i, x := range s {//ä¸‹æ ‡içš„å­—ç¬¦x,å®é™…ä¸Šæ˜¯ç¬¬i+1ä¸ªå­— å¡«å…¥åˆ°f[i+1é‡Œé¢å»]\n        f[i+1][0] = i + 1\n        for j, y := range t {\n            if x == y {\n                f[i+1][j+1] = f[i][j]\n            } else {\n                f[i+1][j+1] = min(f[i][j+1], f[i+1][j], f[i][j]) + 1\n            }\n        }\n    }\n    return f[n][m]\n}\n "},"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/åŠ¨æ€è§„åˆ’ä¸å›æº¯/78.-å­é›†":{"slug":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/åŠ¨æ€è§„åˆ’ä¸å›æº¯/78.-å­é›†","filePath":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/åŠ¨æ€è§„åˆ’ä¸å›æº¯/78. å­é›†.md","title":"78. å­é›†","links":[],"tags":[],"content":"ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„Â numsÂ ï¼Œæ•°ç»„ä¸­çš„å…ƒç´ Â äº’ä¸ç›¸åŒÂ ã€‚è¿”å›è¯¥æ•°ç»„æ‰€æœ‰å¯èƒ½çš„å­é›†ï¼ˆå¹‚é›†ï¼‰ã€‚\nè§£é›†Â ä¸èƒ½Â åŒ…å«é‡å¤çš„å­é›†ã€‚ä½ å¯ä»¥æŒ‰Â ä»»æ„é¡ºåºÂ è¿”å›è§£é›†ã€‚\nå°è®°\nå°±æ˜¯é€‰ä¸é€‰çš„é—®é¢˜:æ‰€æœ‰å¯èƒ½:å›æº¯.å› ä¸ºè¦è®°å½•å…·ä½“çš„ç­”æ¡ˆæ‰€ä»¥ä¸èƒ½åŠ¨æ€è§„åˆ’\nä»£ç \nfunc subsets(nums []int) [][]int {\n    //å°±æ˜¯é€‰ä¸é€‰çš„é—®é¢˜:æ‰€æœ‰å¯èƒ½:å›æº¯.å› ä¸ºè¦è®°å½•å…·ä½“çš„ç­”æ¡ˆæ‰€ä»¥ä¸èƒ½åŠ¨æ€è§„åˆ’\n    ans:=[][]int{}//è¿™é‡Œæœ€å¥½è¿›è¡Œé¢„åˆ†é….ans := make([][]int, 0, 1&lt;&lt;n),æœ€ç»ˆä¸€å®šæ˜¯æœ‰2çš„næ¬¡æ–¹ä¸ªè§£ æ‰€ä»¥åˆ†é…å¥½äº†.ä½†æ˜¯è¦æ³¨æ„é•¿åº¦è¦è®¾ç½®ä¸º0,ä¸ç„¶ä¸å¥½append\n    path:=[]int{}//(0,n)\n    var dfs func(i int)\n    dfs=func(i int){\n        if i==len(nums){\n            ans=append(ans,slices.Clone(path))\n            return \n        }\n        dfs(i+1)\n        path=append(path,nums[i])\n        dfs(i+1)\n        path=path[:len(path)-1]\n    }\n    dfs(0)\n    return ans\n}\nè§£æ³•2,å¦‚æœé‡åˆ°éœ€è¦å»é‡çš„,æœ€å¥½ç”¨è¿™ç§\nfunc subsets(nums []int) [][]int {\n    n := len(nums)\n    ans := make([][]int, 0, 1&lt;&lt;n) // é¢„åˆ†é…ç©ºé—´\n    path := make([]int, 0, n) // é¢„åˆ†é…ç©ºé—´\n \n    // æšä¸¾é€‰å“ªä¸ªï¼šåœ¨ä¸‹æ ‡ i åˆ° n-1 ä¸­é€‰ä¸€ä¸ªæ•°ï¼ŒåŠ åˆ° path æœ«å°¾\n    var dfs func(int)\n    dfs = func(i int) {\n        ans = append(ans, slices.Clone(path)) // ä¸é€‰ï¼ŒæŠŠå½“å‰å­é›†åŠ å…¥ç­”æ¡ˆ\n        for j := i; j &lt; n; j++ { // é€‰ï¼Œæšä¸¾é€‰æ‹©çš„æ•°å­—\n            path = append(path, nums[j])\n            dfs(j + 1) // é€‰ nums[j] æ„å‘³ç€ i åˆ° j-1 éƒ½è·³è¿‡ä¸é€‰ï¼Œä¸‹ä¸€ä¸ªæ•°ä» j+1 å¼€å§‹é€‰\n            path = path[:len(path)-1] // æ¢å¤ç°åœº\n        }\n    }\n \n    dfs(0)\n    return ans\n}\n \n "},"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/åŠ¨æ€è§„åˆ’ä¸å›æº¯/åŠ¨æ€è§„åˆ’-è´ªå¿ƒç®—æ³•":{"slug":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/åŠ¨æ€è§„åˆ’ä¸å›æº¯/åŠ¨æ€è§„åˆ’-è´ªå¿ƒç®—æ³•","filePath":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/åŠ¨æ€è§„åˆ’ä¸å›æº¯/åŠ¨æ€è§„åˆ’-è´ªå¿ƒç®—æ³•.md","title":"åŠ¨æ€è§„åˆ’-è´ªå¿ƒç®—æ³•","links":["æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/åŠ¨æ€è§„åˆ’ä¸å›æº¯/70.-çˆ¬æ¥¼æ¢¯"],"tags":[],"content":"è´ªå¿ƒç®—æ³•\n\nè´ªå¿ƒç®—æ³•åœ¨æ¯ä¸€æ­¥é€‰æ‹©ä¸­ï¼Œéƒ½é‡‡å–åœ¨å½“å‰çŠ¶æ€ä¸‹æœ€å¥½ã€æœ€ä¼˜çš„é€‰æ‹©ï¼ˆå±€éƒ¨æœ€ä¼˜è§£ï¼‰ä»è€Œå¸Œæœ›æœ€ç»ˆçš„ç»“æœä¹Ÿæ˜¯å…¨å±€æœ€ä¼˜çš„ã€‚\nåªæœ‰å½“é—®é¢˜å…·å¤‡â€œè´ªå¿ƒé€‰æ‹©æ€§è´¨â€æ—¶ï¼ˆå³å±€éƒ¨æœ€ä¼˜ç¡®å®èƒ½æ¨å¯¼å‡ºå…¨å±€æœ€ä¼˜ï¼‰æ‰èƒ½å¾—åˆ°æ­£ç¡®ç­”æ¡ˆã€‚å¦åˆ™ï¼Œå®ƒåªèƒ½å¾—åˆ°ä¸€ä¸ªâ€œå·®ä¸å¤šâ€çš„è§£ï¼Œè€Œä¸æ˜¯æœ€ä¼˜è§£ã€‚\n\nåŠ¨æ€è§„åˆ’\n\nåŠ¨æ€è§„åˆ’å°†ä¸€ä¸ªå¤æ‚çš„é—®é¢˜åˆ†è§£æˆè‹¥å¹²ä¸ªé‡å çš„å­é—®é¢˜ã€‚é€šè¿‡è§£å†³å­é—®é¢˜ï¼Œå¹¶å°†ç»“æœè®°å½•ä¸‹æ¥ï¼ˆMemoization/å¡«è¡¨ï¼‰é¿å…é‡å¤è®¡ç®—ï¼Œæœ€åæ¨å¯¼å‡ºåŸé—®é¢˜çš„è§£ã€‚\næ ¸å¿ƒåœ¨äºâ€œè®°è¡¨â€ï¼Œç®—è¿‡çš„ä¸œè¥¿ç»å¯¹ä¸ç®—ç¬¬äºŒæ¬¡ã€‚\n\nåŠ¨æ€è§„åˆ’æ€è·¯\nä»¥70. çˆ¬æ¥¼æ¢¯ä¸ºä¾‹:\nç¬¬ä¸€å±‚æ¥¼æ¢¯è·¨ä¸¤æ­¥å¯ä»¥åˆ°ç¬¬ä¸‰å±‚,ç¬¬äºŒå±‚è·¨ä¸€æ­¥å¯ä»¥åˆ°ç¬¬ä¸‰å±‚,å› æ­¤,ç¬¬ä¸‰å±‚æ¥¼æ¢¯çš„çŠ¶æ€å¯ä»¥ç”±å‰ä¸¤å±‚æ¨å¯¼å‡ºæ¥.ä¹Ÿå°±æ˜¯åŠ¨æ€è§„åˆ’äº†.\n\nç¡®å®šdpæ•°ç»„ä»¥åŠä¸‹æ ‡çš„å«ä¹‰:  çˆ¬åˆ°iå±‚æ¥¼æ¢¯,æœ‰dp[i]ç§æ–¹æ³•\nç¡®å®šé€’æ¨å…¬å¼:  dp[i] = dp[i - 1] + dp[i - 2]\ndpæ•°ç»„å¦‚ä½•åˆå§‹åŒ–:  dp[1] = 1ï¼Œdp[2] = 2.å› ä¸ºè¿™é¢˜é‡Œnä¸ºæ­£æ•´æ•°,å› æ­¤ä¸è¦è€ƒè™‘n=0çš„æƒ…å†µ,åæ­£ä¹Ÿä¸ç¬¦åˆç”Ÿæ´»å®é™…\nç¡®å®šéå†é¡ºåº:  ä»é€’æ¨å…¬å¼å¯ä»¥çœ‹å‡ºé€’æ¨é¡ºåºä¸€å®šæ˜¯ä»å‰å¾€åçš„\nä¸¾ä¾‹æ¨å¯¼dpæ•°ç»„: å°±æ˜¯æ£€æŸ¥ä¸€ä¸‹\n"},"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/åŠ¨æ€è§„åˆ’ä¸å›æº¯/å›æº¯":{"slug":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/åŠ¨æ€è§„åˆ’ä¸å›æº¯/å›æº¯","filePath":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/åŠ¨æ€è§„åˆ’ä¸å›æº¯/å›æº¯.md","title":"å›æº¯","links":[],"tags":[],"content":"å›æº¯å°±æ˜¯â€œæš´åŠ›æšä¸¾â€çš„ä¸€ç§ä¼˜é›…å†™æ³•ã€‚æƒ³è±¡ä½ åœ¨èµ°è¿·å®«ï¼Œé‡åˆ°åˆ†å²”è·¯å£ï¼š\n\nå…ˆèµ°å·¦è¾¹ï¼ˆåšå‡ºé€‰æ‹©ï¼‰ã€‚\nèµ°åˆ°æ­»èƒ¡åŒï¼Œé€€å›æ¥ï¼ˆå›æº¯/æ¢å¤ç°åœºï¼‰ã€‚\nå†èµ°å³è¾¹ï¼ˆå°è¯•ä¸‹ä¸€ä¸ªé€‰é¡¹ï¼‰\n\nå›æº¯ä¸åŠ¨æ€è§„åˆ’çš„åŒºåˆ«\nå›æº¯æ˜¯æš´åŠ›ç©·ä¸¾,åªç®¡è¯•é”™.:\n\nå¯»æ‰¾æ‰€æœ‰å¯èƒ½çš„æ–¹æ¡ˆ\nè€ŒåŠ¨æ€è§„åˆ’æ˜¯èªæ˜å¤ç”¨,æ¯æ¬¡éƒ½ä»æœ€ä¼˜è§£å¼€å§‹å‘ä¸‹.\næ±‚æœ€ç»ˆå€¼\nå¯è¡Œæ€§\næ±‚æ€»æ•°(æœ‰å¤šå°‘ç§æ–¹æ³•)\n\næ‰€æœ‰çš„ DP éƒ½å¯ä»¥å†™æˆâ€œè®°å¿†åŒ–æœç´¢â€ï¼ˆMemoization Searchï¼‰ï¼Œè€Œè®°å¿†åŒ–æœç´¢æœ¬è´¨ä¸Šå°±æ˜¯ å¸¦å¤‡å¿˜å½•çš„é€’å½’ï¼ˆå›æº¯ï¼‰ã€‚\næ¼”å˜è·¯å¾„ï¼š\n\nçº¯å›æº¯ (Backtracking)ï¼š æš´åŠ›å°è¯•æ‰€æœ‰è§£ã€‚\n\nç¼ºç‚¹ï¼š é‡åˆ°é‡å¤çŠ¶æ€ä¼šé‡å¤è®¡ç®—ï¼Œå¯èƒ½ä¼šè¶…æ—¶ã€‚\n\n\nè®°å¿†åŒ–æœç´¢ (Memoization)ï¼š åœ¨å›æº¯çš„åŸºç¡€ä¸Šï¼ŒåŠ ä¸€ä¸ª memo æ•°ç»„ã€‚å¦‚æœ memo[state] æœ‰å€¼ï¼Œç›´æ¥è¿”å›ã€‚\n\næ•ˆæœï¼š å‰ªæ‰äº†é‡å¤çš„æ ‘æï¼Œæ•ˆç‡ç­‰åŒäº DPã€‚\n\n\nåŠ¨æ€è§„åˆ’ (DP)ï¼š æŠŠé€’å½’æ”¹æˆå¾ªç¯ï¼ˆè‡ªåº•å‘ä¸Šï¼‰ï¼Œå¡«è¡¨ã€‚\n\nä½†æ˜¯ï¼å¹¶éæ‰€æœ‰å›æº¯éƒ½èƒ½å˜æˆ DPã€‚\n\nèƒ½å˜ DP çš„ï¼š è®¡ç®—ä¸ªæ•°å­—ç»“æœï¼ˆæœ€å¤§å€¼ã€æ–¹æ¡ˆæ•°ï¼‰ã€‚æ¯”å¦‚â€œçˆ¬æ¥¼æ¢¯æœ‰å¤šå°‘ç§çˆ¬æ³•â€ã€‚\nä¸èƒ½å˜ DP çš„ï¼š éœ€è¦åˆ—å‡ºæ‰€æœ‰å…·ä½“è·¯å¾„ã€‚æ¯”å¦‚â€œè¯·æ‰“å°å‡ºæ‰€æœ‰çˆ¬æ¥¼æ¢¯çš„å…·ä½“æ–¹æ¡ˆï¼ˆ1-1-2, 1-2-1â€¦ï¼‰â€ã€‚è¿™ç§å¿…é¡»ç”¨å›æº¯ï¼Œå› ä¸ºä½ è¦è®°å½•è·¯å¾„ï¼ˆPathï¼‰ï¼Œæ¯ä¸ªè·¯å¾„éƒ½æ˜¯ç‹¬ä¸€æ— äºŒçš„ï¼Œä¸å­˜åœ¨â€œå¤ç”¨â€çš„æ¦‚å¿µã€‚\n\nå›æº¯æ¨¡æ¿\n "},"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/åŒæŒ‡é’ˆ/11.-ç››æœ€å¤šæ°´çš„å®¹å™¨":{"slug":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/åŒæŒ‡é’ˆ/11.-ç››æœ€å¤šæ°´çš„å®¹å™¨","filePath":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/åŒæŒ‡é’ˆ/11. ç››æœ€å¤šæ°´çš„å®¹å™¨.md","title":"11. ç››æœ€å¤šæ°´çš„å®¹å™¨","links":["æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/åŒæŒ‡é’ˆ/42.-æ¥é›¨æ°´"],"tags":["ç›²è¿‡"],"content":"ç»™å®šä¸€ä¸ªé•¿åº¦ä¸ºÂ nÂ çš„æ•´æ•°æ•°ç»„Â heightÂ ã€‚æœ‰Â nÂ æ¡å‚çº¿ï¼Œç¬¬Â iÂ æ¡çº¿çš„ä¸¤ä¸ªç«¯ç‚¹æ˜¯Â (i, 0)Â å’ŒÂ (i, height[i])Â ã€‚\næ‰¾å‡ºå…¶ä¸­çš„ä¸¤æ¡çº¿ï¼Œä½¿å¾—å®ƒä»¬ä¸Â xÂ è½´å…±åŒæ„æˆçš„å®¹å™¨å¯ä»¥å®¹çº³æœ€å¤šçš„æ°´ã€‚\nè¿”å›å®¹å™¨å¯ä»¥å‚¨å­˜çš„æœ€å¤§æ°´é‡ã€‚\n**è¯´æ˜ï¼š**ä½ ä¸èƒ½å€¾æ–œå®¹å™¨ã€‚\n\nå…¶å®æ€è·¯è·Ÿ42. æ¥é›¨æ°´ä¸€æ¨¡ä¸€æ ·,æ²¡å•¥å¥½è¯´äº†\nfunc maxArea(height []int) (ans int) {\n    left, right := 0, len(height)-1\n    for left &lt; right {\n        area := (right - left) * min(height[left], height[right])\n        ans = max(ans, area)\n        if height[left] &lt; height[right] {\n            // height[left] ä¸å³è¾¹çš„ä»»æ„å‚çº¿éƒ½æ— æ³•ç»„æˆä¸€ä¸ªæ¯” ans æ›´å¤§çš„é¢ç§¯\n            left++\n        } else {\n            // height[right] ä¸å·¦è¾¹çš„ä»»æ„å‚çº¿éƒ½æ— æ³•ç»„æˆä¸€ä¸ªæ¯” ans æ›´å¤§çš„é¢ç§¯\n            right--\n        }\n    }\n    return\n}\n "},"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/åŒæŒ‡é’ˆ/234.-å›æ–‡é“¾è¡¨":{"slug":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/åŒæŒ‡é’ˆ/234.-å›æ–‡é“¾è¡¨","filePath":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/åŒæŒ‡é’ˆ/234. å›æ–‡é“¾è¡¨.md","title":"234. å›æ–‡é“¾è¡¨","links":[],"tags":[],"content":"ç»™ä½ ä¸€ä¸ªå•é“¾è¡¨çš„å¤´èŠ‚ç‚¹Â headÂ ï¼Œè¯·ä½ åˆ¤æ–­è¯¥é“¾è¡¨æ˜¯å¦ä¸ºå›æ–‡é“¾è¡¨ã€‚å¦‚æœæ˜¯ï¼Œè¿”å›Â trueÂ ï¼›å¦åˆ™ï¼Œè¿”å›Â falseÂ ã€‚\nå°è®°\n\nç”¨å¿«æ…¢æŒ‡é’ˆæ³•æ‰¾ä¸­ç‚¹ï¼šfastä¸€æ¬¡èµ°ä¸¤æ­¥ã€‚å¦‚æœæ˜¯å¶æ•°é•¿åº¦ï¼Œå°±è¿”å›ä¸‹åŠéƒ¨åˆ†çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ã€‚å°±æ˜¯ç¡®å®šäº†ä»å“ªé‡Œå¼€å§‹ç®—æ˜¯ååŠæ®µ\nåè½¬é“¾è¡¨\nä¸»å‡½æ•°é€»è¾‘\n\né¦–å…ˆæ‰¾åˆ°ä¸­ç‚¹\nåè½¬ååŠæ®µï¼Œhead2æŒ‡å‘ååŠæ®µçš„å¼€å¤´ã€‚\nå¾ªç¯æ¯”è¾ƒã€‚åè½¬åï¼Œhead2 ä»£è¡¨çš„é“¾è¡¨é•¿åº¦ â‡ head ä»£è¡¨çš„é“¾è¡¨é•¿åº¦\n\nfor head2 != nil\n\n\n\n\n\nä»£ç \n/**\n * Definition for singly-linked list.\n * type ListNode struct {\n *     Val int\n *     Next *ListNode\n * }\n */\nfunc isPalindrome(head *ListNode) bool {\n    head2:=reverseLink(middleNode(head))\n    for head2!=nil{\n        if head.Val!=head2.Val{\n            return false \n        }\n        head=head.Next\n        head2=head2.Next\n    }\n    return true \n}\n \nfunc middleNode(head *ListNode)*ListNode{\n   slow,fast:=head,head\n   for fast!=nil&amp;&amp; fast.Next != nil{\n        fast=fast.Next.Next\n        slow=slow.Next\n   }\n   return slow \n}\n \nfunc reverseLink(head *ListNode)*ListNode{\n    var pre *ListNode=nil\n    cur := head\n    for cur!=nil{\n        nxt:=cur.Next\n        cur.Next=pre\n        pre=cur\n        cur=nxt\n    }\n    return pre \n}"},"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/åŒæŒ‡é’ˆ/42.-æ¥é›¨æ°´":{"slug":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/åŒæŒ‡é’ˆ/42.-æ¥é›¨æ°´","filePath":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/åŒæŒ‡é’ˆ/42. æ¥é›¨æ°´.md","title":"42. æ¥é›¨æ°´","links":[],"tags":[],"content":"æ¥é›¨æ°´\nç»™å®šÂ nÂ ä¸ªéè´Ÿæ•´æ•°è¡¨ç¤ºæ¯ä¸ªå®½åº¦ä¸ºÂ 1Â çš„æŸ±å­çš„é«˜åº¦å›¾ï¼Œè®¡ç®—æŒ‰æ­¤æ’åˆ—çš„æŸ±å­ï¼Œä¸‹é›¨ä¹‹åèƒ½æ¥å¤šå°‘é›¨æ°´ã€‚\nå°±æ˜¯å·¦å³ä¸¤è¾¹æŸ±å­æœ€å¤§å€¼çš„æœ€å°å€¼,å‡å»å½“å‰ä½ç½®æŸ±å­çš„é«˜åº¦,å³ä¸ºå½“å‰ä½ç½®èƒ½æ¥çš„é›¨æ°´æ•°é‡.\n\néå†ä¸‰éæ•°ç»„\néœ€è¦ä¸‰ä¸ªé¢å¤–çš„æ•°ç»„\n\nä¼˜åŒ–:\nåªéå†ä¸€é,ä¸ç”¨é¢å¤–æ•°ç»„\n\nåˆå§‹åŒ–LRä¸¤ä¸ªæŒ‡é’ˆæŒ‡å‘æ•°ç»„å¤´å’Œæ•°ç»„å°¾.\nå½“maxLâ‡maxR.å› ä¸ºmaxLæ˜¯ä»å·¦åˆ°å³é€’å¢,maxRä»å³åˆ°å·¦é€’å¢.æ‰€ä»¥è¯´æ˜LæŒ‡å‘çš„ä½ç½®,å·¦å³ä¸¤è¾¹æœ€å°å€¼å°±æ˜¯maxL.å› ä¸ºarea[i]æ˜¯åœ¨maxLå’ŒmaxRä¸­å–æœ€å°å€¼å˜›.ç„¶åå‡å»æŸ±å­çš„é«˜åº¦å¯ä»¥ç›´æ¥å¾—åˆ°é›¨æ°´æ•°é‡,å†L++\nå¦‚æœå¤§äºå°±åè¿‡æ¥.\n\nè¿™ä¸€é¢˜çš„é‡ç‚¹åœ¨äº,å¯¹äºæŸä¸ªæŸ±å­æ¥è¯´,ä¸€å®šè¦æ¯”å¦‚ä»–çš„å·¦è¾¹æœ€é«˜å€¼å·²ç»ç¡®å®š,å¹¶ä¸”å·¦å³ä¸­å·¦ä¸ºæœ€å°å€¼,æ‰å¯ä»¥è®¡ç®—å‡ºç»“æœ.æ‰€ä»¥è¿™é‡Œæ˜¯ å“ªé‡Œè®¡ç®—å‡ºç»“æœ,å“ªè¾¹å¯ä»¥ç¼©å°èŒƒå›´.\n\nfunc trap(height []int) (ans int) {\n    preMax, sufMax := 0, 0\n    left, right := 0, len(height)-1\n    for left &lt; right {//å¦‚æœleft=right å› ä¸ºmaxæ˜¯æŠŠå½“å‰çš„æŸ±é•¿è®¡ç®—åœ¨å†…,æœ€åleft\\rightä¼šç›¸é‡åˆ°åœºä¸Šæœ€é«˜ç‚¹çš„.\n        preMax = max(preMax, height[left])\n        sufMax = max(sufMax, height[right])\n        if preMax &lt; sufMax {\n            ans += preMax - height[left]\n            left++\n        } else {\n            ans += sufMax - height[right]\n            right--\n        }\n    }\n    return\n}\n "},"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/å›¾è®º/200.-å²›å±¿æ•°é‡":{"slug":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/å›¾è®º/200.-å²›å±¿æ•°é‡","filePath":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/å›¾è®º/200. å²›å±¿æ•°é‡.md","title":"200. å²›å±¿æ•°é‡","links":[],"tags":[],"content":"ç»™ä½ ä¸€ä¸ªç”±Â &#039;1&#039;ï¼ˆé™†åœ°ï¼‰å’ŒÂ &#039;0&#039;ï¼ˆæ°´ï¼‰ç»„æˆçš„çš„äºŒç»´ç½‘æ ¼ï¼Œè¯·ä½ è®¡ç®—ç½‘æ ¼ä¸­å²›å±¿çš„æ•°é‡ã€‚\nå²›å±¿æ€»æ˜¯è¢«æ°´åŒ…å›´ï¼Œå¹¶ä¸”æ¯åº§å²›å±¿åªèƒ½ç”±æ°´å¹³æ–¹å‘å’Œ/æˆ–ç«–ç›´æ–¹å‘ä¸Šç›¸é‚»çš„é™†åœ°è¿æ¥å½¢æˆã€‚\næ­¤å¤–ï¼Œä½ å¯ä»¥å‡è®¾è¯¥ç½‘æ ¼çš„å››æ¡è¾¹å‡è¢«æ°´åŒ…å›´ã€‚\nå°è®°\n\næ·±åº¦ä¼˜å…ˆæœç´¢.\n\nä¸€æ—¦æˆ‘ä»¬å‘ç°Â (i,j)Â æ˜¯Â 1ï¼Œå°±ä»Â (i,j)Â å¼€å§‹ï¼ŒDFS è¿™ä¸ªå²›.ä¸»è¦æ˜¯ä¸èƒ½é‡å¤è®¿é—®ä¹‹å‰è®¿é—®è¿‡çš„æ ¼å­ã€‚\næ‰¾åˆ°ä¸€ä¸ªå²›(1)å°±å¼€å§‹å·¦å³ä¸Šä¸‹å››ä¸ªæ–¹å‘èµ°,ç›´åˆ°å…¨å²›æ’æ»¡æ——å­(2)\n\næœªå‘ç°çš„é™†åœ°æ ¼å­:å˜2\nå‡ºç•Œ/æ°´/å·²å‘ç°çš„é™†åœ°,å°±åœæ­¢é€’å½’.\n\n\n\nå¦‚æœéƒ½æ²¡æœ‰1äº†ç®—æ³•å°±ç»“æŸäº†,è¿”å›å²›å±¿ä¸ªæ•°\nä¸ºä»€ä¹ˆç”¨å›¾è®ºæ€æƒ³?\ngridä¸­æ¯ä¸ªæ ¼å­æ˜¯ä¸€ä¸ªèŠ‚ç‚¹,ä¸Šä¸‹å·¦å³ç›¸é‚»è¯´æ˜å­˜åœ¨è¾¹.æ‰€ä»¥é¢˜ç›®å°±å˜æ¢ä¸ºå¯»æ‰¾è¿é€šåˆ†é‡çš„æ€»ä¸ªæ•°.\n\n\n\nä»£ç \næ³¨æ„äºŒç»´æ•°ç»„çš„è¡Œåˆ—ç´¢å¼•\nfunc numIslands(grid [][]byte) int {\n    m,n:=len(grid)-1,len(grid[0])-1\n    ans:=0\n    var dfs func(int ,int )\n    dfs =func(i,j int){\n        if i&lt;0||i&gt;m||j&lt;0||j&gt;n||grid[i][j]==&#039;0&#039;||grid[i][j]==&#039;2&#039;{\n            return \n        }\n        grid[i][j]=&#039;2&#039;\n        dfs(i,j-1)\n        dfs(i,j+1)\n        dfs(i-1,j)\n        dfs(i+1,j)\n    }\n \n    for i,row:=range grid{\n        for j,c:=range row{\n            if c==&#039;1&#039;{\n                dfs(i,j)\n                ans++\n            }\n        }\n    }\n    return ans\n}\n \n "},"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/å›¾è®º/ACMæ¨¡å¼è¾“å‡º":{"slug":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/å›¾è®º/ACMæ¨¡å¼è¾“å‡º","filePath":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/å›¾è®º/ACMæ¨¡å¼è¾“å‡º.md","title":"ACMæ¨¡å¼è¾“å‡º","links":[],"tags":[],"content":""},"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/å›¾è®º/å›¾":{"slug":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/å›¾è®º/å›¾","filePath":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/å›¾è®º/å›¾.md","title":"å›¾","links":[],"tags":[],"content":"å›¾çš„åŸºæœ¬æ¦‚å¿µ\näºŒç»´åæ ‡ä¸­ï¼Œä¸¤ç‚¹å¯ä»¥è¿æˆçº¿ï¼Œå¤šä¸ªç‚¹è¿æˆçš„çº¿å°±æ„æˆäº†å›¾ã€‚\nå½“ç„¶å›¾ä¹Ÿå¯ä»¥å°±ä¸€ä¸ªèŠ‚ç‚¹ï¼Œç”šè‡³æ²¡æœ‰èŠ‚ç‚¹ï¼ˆç©ºå›¾\nå›¾çš„ç§ç±»\næ•´ä½“ä¸Šä¸€èˆ¬åˆ†ä¸º æœ‰å‘å›¾ å’Œ æ— å‘å›¾ã€‚\næœ‰å‘å›¾: è¾¹æ˜¯æœ‰æ–¹å‘çš„\næ— å‘å›¾: è¾¹æ²¡æœ‰æ–¹å‘\nåŠ æƒæœ‰å‘å›¾: å°±æ˜¯è¾¹æ˜¯æœ‰æƒå€¼çš„\nåŠ æƒæ— å‘å›¾åŒç†\nåº¦\næ— å‘å›¾:\n\næœ‰å‡ æ¡è¾¹è¿æ¥è¯¥èŠ‚ç‚¹ï¼Œè¯¥èŠ‚ç‚¹å°±æœ‰å‡ åº¦ã€‚\næœ‰å‘å›¾:\næ¯ä¸ªèŠ‚ç‚¹æœ‰å‡ºåº¦å’Œå…¥åº¦ã€‚\n\nå‡ºåº¦ï¼šä»è¯¥èŠ‚ç‚¹å‡ºå‘çš„è¾¹çš„ä¸ªæ•°ã€‚\nå…¥åº¦ï¼šæŒ‡å‘è¯¥èŠ‚ç‚¹è¾¹çš„ä¸ªæ•°ã€‚\n\n\n\nè¿é€šæ€§\n\nè¿é€šå›¾: åœ¨æ— å‘å›¾ä¸­,ä»»ä½•ä¸¤ä¸ªèŠ‚ç‚¹éƒ½æ˜¯å¯ä»¥åˆ°è¾¾çš„,æˆ‘ä»¬ç§°ä¹‹ä¸ºè¿é€šå›¾\néè¿é€šå›¾: æœ‰èŠ‚ç‚¹ä¸èƒ½åˆ°è¾¾å…¶ä»–èŠ‚ç‚¹\nå¼ºè¿é€šå›¾: åœ¨æœ‰å‘å›¾ä¸­ï¼Œä»»ä½•ä¸¤ä¸ªèŠ‚ç‚¹æ˜¯å¯ä»¥ç›¸äº’åˆ°è¾¾çš„\nè¿é€šåˆ†é‡: æ— å‘å›¾ä¸­çš„æå¤§è¿é€šå­å›¾\nå¼ºè¿é€šåˆ†é‡: æœ‰å‘å›¾ä¸­æå¤§å¼ºè¿é€šå­å›¾\n\nå›¾çš„æ„é€ -å¦‚ä½•ç”¨ä»£ç è¡¨ç¤ºä¸€ä¸ªå›¾\næœ´ç´ å­˜å‚¨\n\næœ‰8æ¡è¾¹ï¼Œæˆ‘ä»¬å°±å®šä¹‰ 8 * 2çš„æ•°ç»„ï¼Œå³æœ‰næ¡è¾¹å°±ç”³è¯·n * 2ï¼Œè¿™ä¹ˆå¤§çš„æ•°ç»„.ç„¶åå°†æ¯ä¸¤ä¸ªèŠ‚ç‚¹çš„å…³ç³»è®°å½•åˆ°è¡¨ä¸­.\nå¯ä»¥ç”¨æ•°ç»„\\map\\ç±»å®ç°,ä½†æ˜¯å¦‚æœæƒ³çŸ¥é“ä¸ç›¸é‚»çš„ä¸¤ä¸ªèŠ‚ç‚¹æ˜¯å¦ç›¸è¿,å°±å¿…é¡»è¦æŠŠå­˜å‚¨ç©ºé—´éƒ½æšä¸¾ä¸€é.\n\né‚»æ¥è¡¨\næ•°ç»„+é“¾è¡¨,æ˜¯ä»è¾¹çš„æ•°é‡æ¥è¡¨ç¤ºå›¾,æœ‰å¤šå°‘è¾¹å°±ç”³è¯·å¯¹åº”å¤§å°çš„é“¾è¡¨.\n\n\nåˆ©äºç¨€ç–å›¾çš„å­˜å‚¨,å› ä¸ºåªéœ€è¦å­˜å‚¨è¾¹,ç©ºé—´åˆ©ç”¨ç‡é«˜\néå†èŠ‚ç‚¹è¿æ¥æƒ…å†µç›¸å¯¹å®¹æ˜“\nç„¶æ˜¯å¦‚æœæ£€æŸ¥ä»»æ„ä¸¤ä¸ªèŠ‚ç‚¹é—´æ˜¯å¦å­˜åœ¨è¾¹,æ•ˆç‡å°±æ¯”è¾ƒä½,éœ€è¦O(v)æ—¶é—´:Vè¡¨ç¤ºæŸèŠ‚ç‚¹è¿æ¥å…¶ä»–èŠ‚ç‚¹çš„æ•°é‡\n\né‚»æ¥çŸ©é˜µ\nä½¿ç”¨äºŒç»´æ•°ç»„æ¥è¡¨ç¤ºå›¾ç»“æ„,æœ‰å¤šå°‘èŠ‚ç‚¹å°±ç”³è¯·å¤šå¤§çš„äºŒç»´æ•°ç»„\nä¾‹å¦‚ï¼š grid[2][5] = 6ï¼Œè¡¨ç¤º èŠ‚ç‚¹ 2 è¿æ¥ èŠ‚ç‚¹5 ä¸ºæœ‰å‘å›¾ï¼ŒèŠ‚ç‚¹2 æŒ‡å‘ èŠ‚ç‚¹5ï¼Œè¾¹çš„æƒå€¼ä¸º6\næƒ³è¡¨ç¤ºæ— å‘å›¾ï¼Œå³ï¼šgrid[2][5] = 6ï¼Œgrid[5][2] = 6ï¼Œè¡¨ç¤ºèŠ‚ç‚¹2 ä¸ èŠ‚ç‚¹5 ç›¸äº’è¿é€šï¼Œæƒå€¼ä¸º6ã€‚\n\n\né€‚åˆç¨ å¯†å›¾(è¾¹æ•°æ¥è¿‘é¡¶ç‚¹æ•°å¹³æ–¹).åœ¨è¾¹å°‘èŠ‚ç‚¹å¤šçš„æƒ…å†µä¸‹ä¼šå¯¼è‡´ç”³è¯·è¿‡å¤§çš„äºŒç»´æ•°ç»„,é€ æˆç©ºé—´æµªè´¹.\nåœ¨å¯»æ‰¾èŠ‚ç‚¹è¿æ¥æƒ…å†µçš„æ—¶å€™,éœ€è¦éå†æ•´ä¸ªçŸ©é˜µ(nå¹³æ–¹).\næ£€æŸ¥ä»»æ„ä¸¤ä¸ªé¡¶ç‚¹ä¹‹é—´æ˜¯å¦å­˜åœ¨è¾¹çš„æ“ä½œéå¸¸å¿«\n\nå›¾çš„éå†æ–¹å¼\næ·±åº¦ä¼˜å…ˆæœç´¢dfs\né€’å½’æ·±åº¦è¾¾åˆ°æœ€å¤§:\n\né€’å½’æ·±åº¦:â€œå½“å‰è¿˜æ²¡ç»“æŸçš„å‡½æ•°è°ƒç”¨æ•°é‡â€\né€’å½’æ·±åº¦æœ€æ·±çš„æƒ…å†µï¼Œå°±æ˜¯ä¸€æ¡è·¯èµ°åˆ°é»‘ï¼Œå®Œå…¨ä¸å›å¤´ï¼Œä¹Ÿä¸åˆ†å‰\n\nå¹¿åº¦ä¼˜å…ˆæœç´¢bfs"},"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/å­—ç¬¦ä¸²å¤„ç†":{"slug":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/å­—ç¬¦ä¸²å¤„ç†","filePath":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/å­—ç¬¦ä¸²å¤„ç†.md","title":"å­—ç¬¦ä¸²å¤„ç†","links":[],"tags":[],"content":"runeä¸byteä¸string\n\n&#039;a&#039; (å•å¼•å·)ï¼šå­—ç¬¦ï¼ˆGo é‡Œå« runeï¼Œæœ¬è´¨æ˜¯æ•´æ•° `int32\n\nint32ï¼Œæœ‰ 32 ä½ï¼Œæœ€å¤§èƒ½è¡¨ç¤ºå‡ åäº¿,ä¼šæ ¹æ®å­—ç¬¦ä¸²é‡Œçš„å…ƒç´ è‡ªåŠ¨åŒ¹é…è¦è¡¨ç¤ºä»€ä¹ˆ.æ¯”å¦‚â€anæŒ‰â€ä¼šè§£æå‡º3ä¸ªrune:a\\n\\æŒ‰\n\n\n&quot;a&quot; (åŒå¼•å·ï¼šå­—ç¬¦ä¸²`string\nbyte\n\nåªæœ‰ 8 ä½ï¼Œæœ€å¤§åªèƒ½è¡¨ç¤ºåˆ° 255ã€‚è‹±æ–‡å­—ç¬¦ï¼ˆASCIIï¼‰æ¯”å¦‚ &#039;a&#039; æ˜¯ 97ï¼Œèƒ½è£…ä¸‹ã€‚ä½†æ±‰å­— &#039;æŒ‰&#039; çš„ç¼–å·æ˜¯ 25353ï¼Œä¸€èˆ¬æ˜¯3ä¸ªbyteã€‚\n\n\n\n\n\n                  \n                  Title \n                  \n                \n\nâ€˜aâ€™è™½ç„¶è¢«è®¤ä¸ºæ˜¯rune,ä½†æ˜¯å®é™…ä¸Šå±äºæ— ç±»å‹å¸¸é‡ (Untyped Constant).å‚ä¸è¿ç®—æ—¶è‡ªåŠ¨é€‚é…å¯¹æ–¹ç±»å‹ã€‚\n\n\nrangeä¸ä¸‹æ ‡\nå­—ç¬¦ä¸²æœ¬è´¨æ˜¯åªè¯»çš„byteåˆ‡ç‰‡.å¦‚æœè¦ä¿®æ”¹,ä¸€å®šè¦è½¬æ¢æˆçœŸæ­£çš„byteåˆ‡ç‰‡.[]byte(s),ç„¶åstring(cnt)å˜å›å­—ç¬¦ä¸²\n\nå¦‚æœæ˜¯çº¯è‹±æ–‡,æ•°å­—,è‹±æ–‡ç¬¦å·,å­—ç¬¦ä¸²é‡Œçš„æ¯ä¸€ä¸ªbyteéƒ½å®Œå…¨å¯¹åº”ASCIIç \nå¦‚æœæ˜¯ä¸­æ–‡,emojiç­‰éASCIIç å­—ç¬¦,ä¸€ä¸ªæ±‰å­—åœ¨ UTF-8 ç¼–ç ä¸­é€šå¸¸å ç”¨ 3 ä¸ª byte.è¿™æ—¶å€™è¦æ”¹ç”¨rune\n\n\nrangeå¾ªç¯å¾—åˆ°çš„æ˜¯rune.\n\nå› æ­¤å¦‚æœå­—ç¬¦ä¸²ä¸­æœ‰ä¸­æ–‡,éå†ä¸‹æ ‡å…¶å®æ˜¯è·³è·ƒçš„.\nfor i := 0; i &lt; len(s); i++å¾ªç¯å¾—åˆ°çš„æ˜¯byte,å› ä¸ºå°±æ˜¯æŒ‰ç…§åŸå­—ç¬¦ä¸²çš„byteåˆ‡ç‰‡ä¸‹æ ‡æ¥çš„.\n\n\nä¸‹æ ‡.s[0]é»˜è®¤æ‹¿å‡ºæ¥çš„æ˜¯å­—èŠ‚.\n\nå¦‚æœæƒ³è¦æ‹¿å‡ºæ¥ä¸­æ–‡å­—ç¬¦,éœ€è¦runes := []rune(s)è½¬æ¢æˆruneåˆ‡ç‰‡,ç„¶åç”¨ä¸‹æ ‡æ‹¿å–.\n\n\n\nå“ˆå¸Œè¡¨\n//runeä½œä¸ºkey\nm := map[rune]int{}\nm[&#039;a&#039;]=1\nm[&#039;æŸä¸ªè¡¨æƒ…ç¬¦å·&#039;]=2\n \n//byteä½œä¸ºkey\nm :=map[byte]int){}\nm[&#039;x&#039;] = 100//è¿™é‡Œå¦‚æœè¦å†™ä¸­æ–‡å’Œè¡¨æƒ…ç¬¦å·å°±ä¸è¡Œäº†,å› ä¸ºä¸ç¬¦åˆbyte\næ•°ç»„å¡«å……ç±»\nå…¶å®å¾ˆå¤šæ•°ç»„å¡«å……ç±»çš„é—®é¢˜ï¼Œå…¶åšæ³•éƒ½æ˜¯å…ˆé¢„å…ˆç»™æ•°ç»„æ‰©å®¹å¸¦å¡«å……åçš„å¤§å°ï¼Œç„¶ååœ¨ä»åå‘å‰è¿›è¡Œæ“ä½œã€‚"},"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/æ’åº/215.-æ•°ç»„ä¸­çš„ç¬¬Kä¸ªæœ€å¤§å…ƒç´ ":{"slug":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/æ’åº/215.-æ•°ç»„ä¸­çš„ç¬¬Kä¸ªæœ€å¤§å…ƒç´ ","filePath":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/æ’åº/215. æ•°ç»„ä¸­çš„ç¬¬Kä¸ªæœ€å¤§å…ƒç´ .md","title":"215. æ•°ç»„ä¸­çš„ç¬¬Kä¸ªæœ€å¤§å…ƒç´ ","links":["æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/æ’åº/æ’åºç®—æ³•"],"tags":[],"content":"ç»™å®šæ•´æ•°æ•°ç»„Â numsÂ å’Œæ•´æ•°Â kï¼Œè¯·è¿”å›æ•°ç»„ä¸­ç¬¬Â kÂ ä¸ªæœ€å¤§çš„å…ƒç´ ã€‚\nè¯·æ³¨æ„ï¼Œä½ éœ€è¦æ‰¾çš„æ˜¯æ•°ç»„æ’åºåçš„ç¬¬Â kÂ ä¸ªæœ€å¤§çš„å…ƒç´ ï¼Œè€Œä¸æ˜¯ç¬¬Â kÂ ä¸ªä¸åŒçš„å…ƒç´ ã€‚\nä½ å¿…é¡»è®¾è®¡å¹¶å®ç°æ—¶é—´å¤æ‚åº¦ä¸ºÂ O(n)Â çš„ç®—æ³•è§£å†³æ­¤é—®é¢˜ã€‚\nå°è®°\nTransclude of æ’åºç®—æ³•#å¿«é€Ÿé€‰æ‹©æ€è·¯\nä»£ç \nTransclude of æ’åºç®—æ³•#ä»£ç "},"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/æ’åº/æ’åºç®—æ³•":{"slug":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/æ’åº/æ’åºç®—æ³•","filePath":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/æ’åº/æ’åºç®—æ³•.md","title":"æ’åºç®—æ³•","links":["æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/æ’åº/æ’åºç®—æ³•","tags/å¾…è§£å†³"],"tags":["å¾…è§£å†³"],"content":"å¿«é€Ÿé€‰æ‹©quick select\næ ¸å¿ƒç›®çš„: è§£å†³ Top K é—®é¢˜ï¼Œå¹¶ä¸”è¦åšåˆ° O(N) çš„æ—¶é—´å¤æ‚åº¦\nå¿«é€Ÿé€‰æ‹©æ€è·¯\nTransclude of æ’åºç®—æ³•#å¿«é€Ÿæ’åºæ€è·¯\nè€Œé’ˆå¯¹Top Ké—®é¢˜,å¯ä»¥åšå¦‚ä¸‹ä¼˜åŒ–.\nå¦‚æœpivot&lt;K,é‚£ä¹ˆä¸ç”¨è¿›è¡Œå·¦è¾¹é€’å½’,åªéœ€è¦è¿›è¡Œå³è¾¹é€’å½’å³å¯.åªå¤„ç†ä¸€è¾¹ï¼Œå¦ä¸€è¾¹ç›´æ¥å¿½ç•¥\n\nç±»ä¼¼äºäºŒåˆ†ï¼Œåªè¦ç¡®å®šæ’åºä¹‹åä¸‹æ ‡åœ¨n-kå¤„çš„æ•°æ®å³å¯ã€‚\nä¸»è¦æ˜¯å®ç°ä¸Šçš„ç»†èŠ‚ã€‚å¾ªç¯çš„æ—¶å€™éœ€è¦ä¿è¯iâ‡j å¦‚æœi&gt;jäº†ä¼šé€€å‡ºå¾ªç¯,iâ‡jçš„æ—¶å€™è¿›è¡Œäº¤æ¢,èƒ½å¤Ÿä¿è¯å·¦è¾¹å°å³è¾¹å¤§.\ni&gt;jçš„æ—¶å€™è¯´æ˜jåˆ°äº†å°çš„è¿™è¾¹,iåˆ°äº†å¤§çš„é‚£è¾¹,å› æ­¤pivotè·Ÿnums[left]æ¢ä¸€ä¸‹ä½ç½®å°±å¯ä»¥äº†.\n\nä»£ç \n// åœ¨å­æ•°ç»„ [left, right] ä¸­éšæœºé€‰æ‹©ä¸€ä¸ªåŸºå‡†å…ƒç´  pivot\n// æ ¹æ® pivot é‡æ–°æ’åˆ—å­æ•°ç»„ [left, right]\n// é‡æ–°æ’åˆ—åï¼Œ&lt;= pivot çš„å…ƒç´ éƒ½åœ¨ pivot çš„å·¦ä¾§ï¼Œ&gt;= pivot çš„å…ƒç´ éƒ½åœ¨ pivot çš„å³ä¾§\n// è¿”å› pivot åœ¨é‡æ–°æ’åˆ—åçš„ nums ä¸­çš„ä¸‹æ ‡\n// ç‰¹åˆ«åœ°ï¼Œå¦‚æœå­æ•°ç»„çš„æ‰€æœ‰å…ƒç´ éƒ½ç­‰äº pivotï¼Œæˆ‘ä»¬ä¼šè¿”å›å­æ•°ç»„çš„ä¸­å¿ƒä¸‹æ ‡ï¼Œé¿å…é€€åŒ–\nfunc partition(nums []int, left int, right int) int {\n    // 1. åœ¨å­æ•°ç»„ä¸­éšæœºé€‰æ‹©ä¸€ä¸ªä¸‹æ ‡ï¼Œå¹¶æ¢åˆ°æœ€å·¦è¾¹\n    i := left + rand.Intn(right-left+1)\n    pivot := nums[i]\n    // æŠŠ pivot ä¸å­æ•°ç»„ç¬¬ä¸€ä¸ªå…ƒç´ äº¤æ¢ï¼Œé¿å… pivot å¹²æ‰°åç»­åˆ’åˆ†ï¼Œä»è€Œç®€åŒ–å®ç°é€»è¾‘\n    nums[i], nums[left] = nums[left], nums[i]\n \n    // 2. ç›¸å‘åŒæŒ‡é’ˆéå†å­æ•°ç»„ [left + 1, right]\n    // å¾ªç¯ä¸å˜é‡ï¼šåœ¨å¾ªç¯è¿‡ç¨‹ä¸­ï¼Œå­æ•°ç»„çš„æ•°æ®åˆ†å¸ƒå§‹ç»ˆå¦‚ä¸‹å›¾\n    // [ pivot | &lt;=pivot | å°šæœªéå† | &gt;=pivot ]\n    //   ^                 ^     ^         ^\n    //   left              i     j         right\n \n    i, j := left+1, right\n    for {\n        for i &lt;= j &amp;&amp; nums[i] &lt; pivot {\n            i++\n        }//iè¿˜æ²¡é‡åˆ°jä¸”iæŒ‡å‘çš„å…ƒç´ å°äºpivotï¼ˆä¸éœ€è¦äº¤æ¢ï¼‰çš„è¯å°±ä¸€ç›´å‘å³\n        // æ­¤æ—¶ nums[i] &gt;= pivotï¼šåœä¸‹\n \n        for i &lt;= j &amp;&amp; nums[j] &gt; pivot {\n            j--\n        }\n        // æ­¤æ—¶ nums[j] &lt;= pivotï¼šåœä¸‹\n \n        if i &gt;= j {\n            break\n        }\n \n        // ç»´æŒå¾ªç¯ä¸å˜é‡\n        nums[i], nums[j] = nums[j], nums[i]\n        i++\n        j--\n    }\n \n    // å¾ªç¯ç»“æŸå\n    // [ pivot | &lt;=pivot | &gt;=pivot ]\n    //   ^             ^   ^     ^\n    //   left          j   i     right\n \n    // 3. æŠŠ pivot ä¸ nums[j] äº¤æ¢ï¼Œå®Œæˆåˆ’åˆ†ï¼ˆpartitionï¼‰\n    // ä¸ºä»€ä¹ˆä¸ j äº¤æ¢ï¼Ÿ\n    // å¦‚æœä¸ i äº¤æ¢ï¼Œå¯èƒ½ä¼šå‡ºç° i = right + 1 çš„æƒ…å†µï¼Œå·²ç»ä¸‹æ ‡è¶Šç•Œäº†ï¼Œæ— æ³•äº¤æ¢\n    // å¦ä¸€ä¸ªåŸå› æ˜¯å¦‚æœ nums[i] &gt; pivotï¼Œäº¤æ¢ä¼šå¯¼è‡´ä¸€ä¸ªå¤§äº pivot çš„æ•°å‡ºç°åœ¨å­æ•°ç»„æœ€å·¦è¾¹ï¼Œä¸æ˜¯æœ‰æ•ˆåˆ’åˆ†\n    // ä¸ j äº¤æ¢ï¼Œå³ä½¿ j = leftï¼Œäº¤æ¢ä¹Ÿä¸ä¼šå‡ºé”™\n    nums[left], nums[j] = nums[j], nums[left]\n \n    // äº¤æ¢å\n    // [ &lt;=pivot | pivot | &gt;=pivot ]\n    //               ^\n    //               j\n \n    // è¿”å› pivot çš„ä¸‹æ ‡\n    return j\n}\n \nfunc findKthLargest(nums []int, k int) int {\n    n := len(nums)\n    targetIndex := n - k  // ç¬¬ k å¤§å…ƒç´ åœ¨å‡åºæ•°ç»„ä¸­çš„ä¸‹æ ‡æ˜¯ n - k\n    left, right := 0, n-1 // é—­åŒºé—´\n    for {\n        i := partition(nums, left, right)\n        if i == targetIndex {\n            // æ‰¾åˆ°ç¬¬ k å¤§å…ƒç´ \n            return nums[i]\n        }\n        if i &gt; targetIndex {\n            // ç¬¬ k å¤§å…ƒç´ åœ¨ [left, i - 1] ä¸­\n            right = i - 1\n        } else {\n            // ç¬¬ k å¤§å…ƒç´ åœ¨ [i + 1, right] ä¸­\n            left = i + 1\n        }\n    }\n}\n \n \næ‰‹å†™å †æ’åº\nå¾…è§£å†³\næ‰‹å†™å¿«æ’\nå¾…è§£å†³\nå¿«é€Ÿæ’åºæ€è·¯\n\né€‰å®šä¸€ä¸ªpivot,å·¦è¾¹éƒ½æ˜¯æ¯”å®ƒå°çš„,å³è¾¹éƒ½æ˜¯æ¯”å®ƒå¤§çš„,é‚£ä¹ˆè¿™ä¸ªpivotçš„ä½ç½®å°±å›ºå®šæ­£ç¡®äº†.\nç„¶ååˆ°è¿™ä¸ªpivotçš„å·¦è¾¹é€’å½’,å³è¾¹ä¹Ÿé€’å½’,é‡å¤ä¸Šè¿°æ“ä½œ.å¤æ‚åº¦æ˜¯ O(N \\log N)\n\nä»£ç \nfunc QuickSort(nums, left, right) {\n    if left &gt;= right { return }\n    \n    // 1. æ’å¥½ä¸€ä¸ªåŸºå‡†ï¼Œæ‹¿åˆ°ä»–çš„ä½ç½® pivotIndex\n    pivotIndex := partition(nums, left, right)\n    \n    // 2. é€’å½’å¤„ç†å·¦è¾¹ (å‹¤å¥‹)\n    QuickSort(nums, left, pivotIndex - 1)\n    \n    // 3. é€’å½’å¤„ç†å³è¾¹ (å‹¤å¥‹)\n    QuickSort(nums, pivotIndex + 1, right)\n}"},"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/æ•°/15.-ä¸‰æ•°ä¹‹å’Œ":{"slug":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/æ•°/15.-ä¸‰æ•°ä¹‹å’Œ","filePath":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/æ•°/15. ä¸‰æ•°ä¹‹å’Œ.md","title":"15. ä¸‰æ•°ä¹‹å’Œ","links":["tags/flashcard"],"tags":["flashcard"],"content":"\nä¸‰æ•°ä¹‹å’Œ\nç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„Â numsÂ ï¼Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨ä¸‰å…ƒç»„Â [nums[i], nums[j], nums[k]]Â æ»¡è¶³Â i != jã€i != kÂ ä¸”Â j != kÂ ï¼ŒåŒæ—¶è¿˜æ»¡è¶³Â nums[i] + nums[j] + nums[k] == 0Â ã€‚è¯·ä½ è¿”å›æ‰€æœ‰å’Œä¸ºÂ 0Â ä¸”ä¸é‡å¤çš„ä¸‰å…ƒç»„ã€‚\næ³¨æ„ï¼šç­”æ¡ˆä¸­ä¸å¯ä»¥åŒ…å«é‡å¤çš„ä¸‰å…ƒç»„ã€‚ flashcard\n\nå°è®°\n\næœ€é‡è¦çš„æ˜¯å»é‡é€»è¾‘,å¿…é¡»å‘ç”Ÿåœ¨å·²ç»è®°å½•äº†ç­”æ¡ˆä¹‹å,å› ä¸ºä¼šæœ‰å‰åä¸¤ä¸ªæ•°ç›¸ç­‰çš„æ—¶å€™ä¹Ÿå¯ä»¥ç»„æˆç­”æ¡ˆçš„æƒ…å†µ.\nå¦å¤–è¿˜æœ‰ä¸¤ä¸ªæ’åºä¹‹åå¯ä»¥åšçš„ä¼˜åŒ–\næ³¨æ„ç»†èŠ‚\n\nä»£ç \nfunc threeSum(nums []int) [][]int {\n    slices.Sort(nums)\n    n := len(nums)\n    ans := [][]int{}\n    for i := 0; i &lt; n-2; i++ {\n        x := nums[i]\n        // 1. å¤–å±‚å»é‡\n        if i &gt; 0 &amp;&amp; x == nums[i-1] {\n            continue\n        }\n        // ã€å…³é”®ä¼˜åŒ– 1ã€‘ï¼šæœ€å°çš„ä¸‰ä¸ªæ•°ç›¸åŠ éƒ½ &gt; 0ï¼Œåé¢è‚¯å®šæ²¡æˆäº†ï¼Œç›´æ¥ç»“æŸ\n        if x + nums[i+1] + nums[i+2] &gt; 0 {\n            break\n        }\n        // ã€å…³é”®ä¼˜åŒ– 2ã€‘ï¼šå½“å‰æ•°åŠ ä¸Šæœ€å¤§çš„ä¸¤ä¸ªæ•°éƒ½ &lt; 0ï¼Œè¯´æ˜å½“å‰æ•°å¤ªå°ï¼Œè·³è¿‡çœ‹ä¸‹ä¸€ä¸ª\n        if x + nums[n-2] + nums[n-1] &lt; 0 {\n            continue\n        }\n        left, right := i+1, n-1\n        for left &lt; right {\n            sum := x + nums[left] + nums[right]\n            if sum == 0 {\n                ans = append(ans, []int{x, nums[left], nums[right]})\n                // å†…å±‚å»é‡ï¼ˆä½ çš„å†™æ³•å¾ˆå¥½ï¼Œä¿æŒä½ï¼‰\n                for left &lt; right &amp;&amp; nums[left] == nums[left+1] { left++ }\n                for left &lt; right &amp;&amp; nums[right] == nums[right-1] { right-- }\n                left++\n                right--\n            } else if sum &lt; 0 {\n                left++\n            } else {\n                right--\n            }\n        }\n    }\n    return ans\n}"},"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/æ•°/næ•°ä¹‹å’Œ":{"slug":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/æ•°/næ•°ä¹‹å’Œ","filePath":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/æ•°/næ•°ä¹‹å’Œ.md","title":"næ•°ä¹‹å’Œ","links":[],"tags":[],"content":"ä¸€ä¸ªæ•°ç»„ä¸­ä¸é‡å¤\n\n0 &lt;= a, b, c, dÂ &lt; n\naã€bã€cÂ å’ŒÂ dÂ äº’ä¸ç›¸åŒ\nnums[a] + nums[b] + nums[c] + nums[d] == target\n\n\n\nä¿è¯æ•°ç»„æœ‰åº.ä¸æœ‰åºå°±æ’ä¸€ä¸‹åº.\néœ€è¦ä¿è¯a&lt;b&lt;c&lt;d,åŒæ—¶å¤–å±‚ä¸€ä¸ªforå¾ªç¯æŠŠaå›ºå®šä½.\nå†…å±‚forå¾ªç¯å›ºå®šb,å‰©ä¸‹cå’Œdåœ¨[b+1,len(æ•°ç»„)]çš„èŒƒå›´å†…è¿›è¡ŒåŒæŒ‡é’ˆå³å¯.[äºŒè€…ç›¸åŠ ç»“æœä¸ºtarget-nums[a]-nums[b]]\n\n\n\n\n                  \n                  è¯­æ³•ç»†èŠ‚ \n                  \n                \n\n\næ³¨æ„æ‰¾åˆ°ä¸€ç»„è§£ä¹‹åä¸èƒ½åœæ­¢,è¦ä¸€ç›´å¾ªç¯åˆ°c&lt;dçš„ä¸´ç•Œ\næ³¨æ„å»é‡.å¦‚æœä¸å…è®¸é‡å¤çš„å…ƒç»„,é‚£ä¹ˆå°±è¦ç”¨for a &gt; 0 &amp;&amp; nums[a] == nums[a-1] { continue }è¿™ç§å†™æ³•å»é‡.\n\næ³¨æ„è¿™é‡Œä¸€å®šè¦æ˜¯for,å°±æ˜¯å»é‡åˆ°æ— é‡ä¸ºæ­¢.//æˆ–è€…ç”¨ifcontinue,è·³å‡ºå½“æ¬¡å¾ªç¯,é‡æ–°èµ°ä¸€éforçš„æ¡ä»¶åˆ¤æ–­.\n\n\nå°ä¼˜åŒ–:å¦‚æœåœ¨å›ºå®šabçš„æ—¶å€™,å¦‚æœæœ€å°çš„abcå’Œæœ€å¤§çš„dåŠ èµ·æ¥å°±&gt;targetçš„è¯,då°±å¯ä»¥ç›´æ¥â€”.ç±»ä¼¼è¿™æ ·çš„æŠ€å·§å¦‚æœå†…å­˜è¦æ±‚ä¸¥æ ¼çš„è¯å¯ä»¥ç”¨\n\n\n"},"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/æ•°/äºŒåˆ†æŸ¥æ‰¾":{"slug":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/æ•°/äºŒåˆ†æŸ¥æ‰¾","filePath":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/æ•°/äºŒåˆ†æŸ¥æ‰¾.md","title":"äºŒåˆ†æŸ¥æ‰¾","links":[],"tags":[],"content":"\næ•°ç»„ä¸‹æ ‡éƒ½æ˜¯ä»0å¼€å§‹çš„ã€‚\næ•°ç»„å†…å­˜ç©ºé—´çš„åœ°å€æ˜¯è¿ç»­çš„\næ•°ç»„çš„å…ƒç´ æ˜¯ä¸èƒ½åˆ çš„ï¼Œåªèƒ½è¦†ç›–ã€‚\n\näºŒåˆ†æŸ¥æ‰¾\næœç´¢çš„åŒºé—´æ˜¯å·¦é—­å³é—­è¿˜æ˜¯å·¦é—­å³å¼€è¿˜æ˜¯å…¨å¼€\nè¿™ä¸ªæ˜¯ä¸€ä¸ªåŸåˆ™,åœ¨åé¢çš„åŒºé—´å¤„ç†ä¸­è¦è´¯å½».åŒºé—´æ˜¯ä¸€ä¸ªä¸å˜é‡\n\nåœ¨åŒºé—´ä¸ºç©ºåå†è¿›è¡Œè¿”å›,å¯ä»¥æ‰¾ç¬¬ä¸€ä¸ªç­‰äºtargetçš„æ•°çš„ä¸‹æ ‡,æ³›ç”¨æ€§æ›´å¼º.\nè¿”å›å€¼=ç›®æ ‡çš„ä¸‹æ ‡,æ‰¾ä¸åˆ°å°±è¿”å›æ•°ç»„é•¿åº¦\næš´åŠ›åšæ³•éå†,æ—¶é—´æ˜¯onçš„æ—¶é—´å¤æ‚åº¦\näºŒåˆ†æŸ¥æ‰¾åˆ©ç”¨äº†æ•°ç»„æœ‰åºçš„æ€§è´¨\n\n// ã€ä¸‹é¢åˆ—äº†ä¸‰ç§å†™æ³•ï¼Œé€‰ä¸€ç§è‡ªå·±å–œæ¬¢çš„å°±è¡Œã€‘\n \n// lowerBound è¿”å›æœ€å°çš„æ»¡è¶³ nums[i] &gt;= target çš„ i\n// å¦‚æœæ•°ç»„ä¸ºç©ºï¼Œæˆ–è€…æ‰€æœ‰æ•°éƒ½ &lt; targetï¼Œåˆ™è¿”å› nums.length\n// è¦æ±‚ nums æ˜¯éé€’å‡çš„ï¼Œå³ nums[i] &lt;= nums[i + 1]\n \n// é—­åŒºé—´å†™æ³•\nfunc lowerBound(nums []int, target int) int {\n    left, right := 0, len(nums)-1 // é—­åŒºé—´ [left, right]\n    for left &lt;= right {           // åŒºé—´ä¸ä¸ºç©º\n \n        mid := left + (right-left)/2\n        if nums[mid] &lt; target {\n            left = mid + 1 // èŒƒå›´ç¼©å°åˆ° [mid+1, right]\n        } else {\n            right = mid - 1 // èŒƒå›´ç¼©å°åˆ° [left, mid-1]//è¿™é‡Œrightä¸€å®šè¦-1 åæ­£æœ€åæ˜¯è¿”å›leftçš„å€¼,ä¸ä¼šå­˜åœ¨æ­£å¥½é”™è¿‡targetçš„æƒ…å†µ\n        }\n    }//æœ€åä¸€æ­¥åº”è¯¥æ˜¯L=Rçš„æ—¶å€™,å‘ç°num[mid]&gt;=target,é‚£ä¹ˆright-1\n    //æ²¡æ‰¾åˆ°å°±æ˜¯L=Rçš„æ—¶å€™num[mid]&lt;target,é‚£ä¹ˆleft+1\n    return left // æˆ–è€… right+1///å¾ªç¯ç»“æŸæ—¶,ä¸€å®šæ˜¯left=right+1,è¿èƒŒwhileå¾ªç¯æ¡ä»¶,é‚£ä¹ˆè¿”å›left,å°±ä¼šæ˜¯targetçš„ä¸‹æ ‡.\n}\n//å¦‚æœæ‰€æœ‰å…ƒç´ éƒ½æ¯”8å°,é‚£ä¹ˆleftå›ä¸€ç›´å‘å³ç§»åŠ¨,æœ€åå°±ä¼šè¿”å›æ•´ä¸ªæ•°ç»„çš„é•¿åº¦(Rçš„å³è¾¹ä¹Ÿå°±æ˜¯ä¸‹æ ‡+1=æ•°ç»„é•¿åº¦)\n \n// å·¦é—­å³å¼€åŒºé—´å†™æ³•\nfunc lowerBound2(nums []int, target int) int {\n    left, right := 0, len(nums) // å·¦é—­å³å¼€åŒºé—´ [left, right)\n    for left &lt; right {          // åŒºé—´ä¸ä¸ºç©º\n        mid := left + (right-left)/2\n        if nums[mid] &lt; target {\n            left = mid + 1 // èŒƒå›´ç¼©å°åˆ° [mid+1, right)\n        } else {\n            right = mid // èŒƒå›´ç¼©å°åˆ° [left, mid)\n        }\n    }\n    return left // æˆ–è€… right\n}\n \n// å¼€åŒºé—´å†™æ³•[æ¨è!]\nfunc lowerBound3(nums []int, target int) int {\n    left, right := -1, len(nums) // å¼€åŒºé—´ (left, right)\n    for left+1 &lt; right {         // åŒºé—´ä¸ä¸ºç©º\n        // å¾ªç¯ä¸å˜é‡ï¼š\n        // nums[left] &lt; target\n        // nums[right] &gt;= target\n        mid := left + (right-left)/2\n        if nums[mid] &lt; target {\n            left = mid // èŒƒå›´ç¼©å°åˆ° (mid, right)\n        } else {\n            right = mid // èŒƒå›´ç¼©å°åˆ° (left, mid)\n        }\n    }\n    return right // æˆ–è€… left+1\n}\n- **Left**ï¼šåˆå§‹åŒ–ä¸ºâ€œä¸€å®šæ»¡è¶³æ¡ä»¶çš„å€¼â€æˆ–è€…â€œæœ€å°è¾¹ç•Œ - 1â€ã€‚\n- **Right**ï¼šåˆå§‹åŒ–ä¸ºâ€œä¸€å®šä¸æ»¡è¶³æ¡ä»¶çš„å€¼â€æˆ–è€…â€œæœ€å¤§è¾¹ç•Œ + 1â€ã€‚\n \nfunc search(nums []int, target int) int {\n    i := lowerBound(nums, target) // é€‰æ‹©å…¶ä¸­ä¸€ç§å†™æ³•å³å¯\n    if i == len(nums) || nums[i] != target {\n        return -1\n    }//æ’é”™é€»è¾‘:éƒ½æ¯”ç›®æ ‡å°,æˆ–è€…åªæœ‰æ¯”ç›®æ ‡å¤§çš„æ•°\n    return i\n}\n \nä½œè€…ï¼šçµèŒ¶å±±è‰¾åºœ\né“¾æ¥ï¼šleetcode.cn/problems/binary-search/solutions/2023397/er-fen-cha-zhao-zong-shi-xie-bu-dui-yi-g-eplk/\næ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰\nè‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚\ntips\nä¸ºä»€ä¹ˆè¦å†™æˆ left + (right-left)/2 è€Œä¸æ˜¯ (left+right)/2ï¼Ÿ\n\né˜²æ­¢ç›¸åŠ å¤ªå¤§ä¼šæº¢å‡º.è·Ÿè®¡ç®—é¡ºåºæœ‰å…³,æœ€å¥½å…ˆç®—ç›¸å‡çš„éƒ¨åˆ†é™¤2,å¾—åˆ°ä¸€ä¸ªæ¯”è¾ƒå°çš„ç»“æœ,æ‰€ä»¥è®¡ç®—è¿‡ç¨‹ä¸­æ°¸è¿œä¸ä¼šäº§ç”Ÿè¶…è¿‡rightçš„å€¼,æ˜¯ç»å¯¹å®‰å…¨çš„.[æ—¢ç„¶rightéƒ½æ²¡æœ‰æº¢å‡º,é‚£ä¹ˆè¿™ä¸ªmidçš„å€¼ä¹Ÿä¸ä¼šæº¢å‡ºäº†]\ngoä¸­ç”¨&gt;&gt;1æ¥ä»£æ›¿é™¤2,å› ä¸ºä½è¿ç®—æ¯”é™¤æ³•è¿ç®—æ›´å¿«,è™½ç„¶goè‡ªå·±ä¼šè¿›è¡Œä¼˜åŒ–,ä½†æ˜¯è¿™æ ·å†™æ˜¾å¾—æ¯”è¾ƒä¸“ä¸šå§\n\n\n\n                  \n                  æœ‰ç¬¦å·æ•°çš„èŒƒå›´ \n                  \n                \n\n\nè´Ÿæ•°æ€ä¹ˆç†è§£?ç†è§£ä¸º,ç¬¦å·ä½ä»£è¡¨-2çš„å…­åä¸‰æ¬¡æ–¹,è€Œæ•°å­—ä½æ˜¯åŠ ä¸Šå¯¹åº”æ­£æ•°.æ‰€ä»¥10000å°±æ˜¯2çš„å…­åä¸‰æ¬¡æ–¹,åŠ çš„æ­£æ•°éƒ¨åˆ†ä¸º0\n\n\næ—¶é—´å¤æ‚åº¦\næ¯æ¬¡å¾ªç¯ï¼ŒæŸ¥æ‰¾èŒƒå›´éƒ½ç¼©å°ä¸€åŠã€‚\nç¬¬ 1 æ¬¡å¾ªç¯ï¼šä½ æ¯”è¾ƒäº†ä¸­é—´å€¼ï¼Œå¦‚æœä¸åŒ¹é…ï¼Œä½ æ‰”æ‰äº†ä¸€åŠã€‚å‰©ä¸‹ N/2 ä¸ªå…ƒç´ ã€‚\nç¬¬ k æ¬¡å¾ªç¯ï¼šå‰©ä¸‹ N / 2^k ä¸ªå…ƒç´ ã€‚\nä»€ä¹ˆæ—¶å€™ç»“æŸï¼Ÿ\nå½“å‰©ä¸‹çš„å…ƒç´ åªæœ‰ 1 ä¸ªï¼ˆæˆ–è€… 0 ä¸ªï¼‰æ—¶ï¼Œå¾ªç¯ç»“æŸã€‚\nä¹Ÿå°±æ˜¯è¯´ï¼š\n\\frac{N}{2^k} = 1\nN = 2^k\nå¦‚æœæ¯æ¬¡éƒ½å¯¹Né™¤2 é‚£ä¹ˆé™¤å¹²å‡€çš„æ—¶å€™åº”è¯¥é™¤äº†log2Næ¬¡\nå¿½ç•¥åº•æ•°ï¼ˆå› ä¸ºå¸¸æ•°å·®å¼‚ä¸å½±å“å¢é•¿é‡çº§)å’Œä¸€æ¬¡è®¡ç®—ä¸­çš„æ—¶é—´éƒ¨åˆ†ï¼Œè®°ä½œ O(\\log n)\nè¯­æ³•\nleftå’Œrightä¸èƒ½åœ¨å¾ªç¯é‡Œé¢é‡æ–°å®šä¹‰,å¦åˆ™whileçš„æ¡ä»¶ä¸€ç›´ä¸å˜.\nè€Œmiddleæœ€å¥½åœ¨å¾ªç¯é‡Œé¢å®šä¹‰,å› ä¸º\n"},"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/æ ˆä¸é˜Ÿåˆ—/å¯¹ç§°åŒ¹é…":{"slug":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/æ ˆä¸é˜Ÿåˆ—/å¯¹ç§°åŒ¹é…","filePath":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/æ ˆä¸é˜Ÿåˆ—/å¯¹ç§°åŒ¹é….md","title":"å¯¹ç§°åŒ¹é…","links":[],"tags":[],"content":"ç”±äºæ ˆç»“æ„çš„ç‰¹æ®Šæ€§,éå¸¸é€‚åˆåšå¯¹ç§°åŒ¹é…ç±»çš„é¢˜ç›®\nä¸åŒ¹é…çš„ä¸‰ç§æƒ…å†µ\n\nå·²ç»éå†å®Œäº†å­—ç¬¦ä¸²ï¼Œä½†æ˜¯æ ˆä¸ä¸ºç©ºï¼Œè¯´æ˜æœ‰ç›¸åº”çš„å·¦æ‹¬å·æ²¡æœ‰å³æ‹¬å·æ¥åŒ¹é…ï¼Œæ‰€ä»¥return false\néå†å­—ç¬¦ä¸²åŒ¹é…çš„è¿‡ç¨‹ä¸­ï¼Œå‘ç°æ ˆé‡Œæ²¡æœ‰è¦åŒ¹é…çš„å­—ç¬¦ã€‚æ‰€ä»¥return false\néå†å­—ç¬¦ä¸²åŒ¹é…çš„è¿‡ç¨‹ä¸­ï¼Œæ ˆå·²ç»ä¸ºç©ºäº†ï¼Œæ²¡æœ‰åŒ¹é…çš„å­—ç¬¦äº†ï¼Œè¯´æ˜å³æ‹¬å·æ²¡æœ‰æ‰¾åˆ°å¯¹åº”çš„å·¦æ‹¬å·return false\n\næŠ€å·§:\nè®¡ç®—å­—ç¬¦ä¸²é•¿åº¦å¦‚æœæ˜¯å¥‡æ•°é‚£ä¹ˆä¸€å®šä¸true\nåœ¨é‡åˆ°å·¦æ‹¬å·çš„æ—¶å€™æŠŠå³æ‹¬å·å…¥æ ˆï¼Œé‚£ä¹ˆä¸‹æ¬¡é‡åˆ°å³æ‹¬å·å°±åªéœ€è¦æ¯”è¾ƒå½“å‰å…ƒç´ å’Œæ ˆé¡¶æ˜¯å¦ç›¸ç­‰å°±å¯ä»¥äº†\nfunc isValid(s string) bool {\n    if len(s)%2 != 0 { // s é•¿åº¦å¿…é¡»æ˜¯å¶æ•°\n        return false\n    }\n    st := []rune{}\n    for _, c := range s {\n        switch c {\n        case &#039;(&#039;:\n            st = append(st, &#039;)&#039;) // å…¥æ ˆå¯¹åº”çš„å³æ‹¬å·\n        case &#039;[&#039;:\n            st = append(st, &#039;]&#039;)\n        case &#039;{&#039;:\n            st = append(st, &#039;}&#039;)\n        default: // c æ˜¯å³æ‹¬å·\n            if len(st) == 0 || st[len(st)-1] != c {\n                return false // æ²¡æœ‰å·¦æ‹¬å·ï¼Œæˆ–è€…å·¦æ‹¬å·ç±»å‹ä¸å¯¹\n            }\n            st = st[:len(st)-1] // å‡ºæ ˆ\n        }\n    }\n    return len(st) == 0 // æ‰€æœ‰å·¦æ‹¬å·å¿…é¡»åŒ¹é…å®Œæ¯•\n}\n "},"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/æ ˆä¸é˜Ÿåˆ—/æ ˆä¸é˜Ÿåˆ—":{"slug":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/æ ˆä¸é˜Ÿåˆ—/æ ˆä¸é˜Ÿåˆ—","filePath":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/æ ˆä¸é˜Ÿåˆ—/æ ˆä¸é˜Ÿåˆ—.md","title":"æ ˆä¸é˜Ÿåˆ—","links":[],"tags":[],"content":"\n\ngo ä¸­æ²¡æœ‰åä¸ºStackçš„å®¹å™¨, ä¸€èˆ¬ç›´æ¥ç”¨åˆ‡ç‰‡ä½œä¸ºæ ˆ\n\n\nstackæ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ\n\nå®ç°ï¼š[]int (æˆ–å…¶ä»–ç±»å‹çš„åˆ‡ç‰‡)ã€‚\nPush (å…¥æ ˆ)ï¼šä½¿ç”¨ append å‡½æ•°ã€‚\nPop (å‡ºæ ˆ)ï¼šä½¿ç”¨åˆ‡ç‰‡çš„æˆªå–æ“ä½œ\nTop (å–æ ˆé¡¶)ï¼šç›´æ¥ç´¢å¼• len(s)-1ã€‚\n\n\n\n// è¿™æ˜¯ä¸€ä¸ª Go è¯­è¨€å®ç°æ ˆçš„æ ‡å‡†å†™æ³•\nstack := make([]int, 0)\n \n// Push\nstack = append(stack, 1)\nstack = append(stack, 2)\n \n// Top (è·å–æ ˆé¡¶å…ƒç´ )\ntop := stack[len(stack)-1]\n \n// Pop (ç§»é™¤æ ˆé¡¶å…ƒç´ )\nstack = stack[:len(stack)-1]\n\nå¯ä»¥éå†stackç©ºé—´ä¹ˆï¼Ÿ\næ ˆçš„æ ¸å¿ƒå®šä¹‰æ˜¯åè¿›å…ˆå‡º,è™½ç„¶è¯´å¯¹äºåˆ‡ç‰‡å®ç°çš„æ ˆå¯ä»¥ç”¨rangeå»éå†,ä½†æ˜¯ä¸å»ºè®®,ä¼šç ´åæ ˆçš„å°è£…æ€§å’Œé€»è¾‘å®šä¹‰.\n\nç”¨ä¸¤ä¸ªæ ˆå®ç°å…ˆå…¥å…ˆå‡ºé˜Ÿåˆ—\n\nè¾“å…¥æ ˆ è¾“å…¥çš„æ—¶å€™æ”¾è¿›æ¥å°±å¥½\nè¾“å‡ºæ ˆ è¾“å‡ºçš„çš„æ—¶å€™,å¦‚æœè¾“å‡ºæ ˆä¸ºç©º,å°±æŠŠè¿›æ ˆæ•°æ®å…¨éƒ¨å¯¼å…¥è¿›æ¥,å†ä»å‡ºæ ˆå¯¼å…¥æ•°æ®.\nå¦‚æœè¾“å…¥æ ˆå’Œè¾“å‡ºæ ˆéƒ½ä¸ºç©º,åˆ™è¯´æ˜æ¨¡æ‹Ÿçš„é˜Ÿåˆ—ä¸ºç©º\n\ntype MyQueue struct {\n    stackIn  *MyStack\n    stackOut *MyStack\n}\n \nfunc Constructor() MyQueue {\n    return MyQueue{\n      stackIn: &amp;MyStack{},\n      stackOut: &amp;MyStack{},\n    }\n}\n \n func (this *MyQueue) fillStackOut() {\n    if this.stackOut.Empty() {\n        for !this.stackIn.Empty(){\n            val:=this.stackIn.Pop()\n            this.stackOut.Push(val)\n        }\n    }\n }\n \nfunc (this *MyQueue) Push(x int)  {\n    this.stackIn.Push(x)\n}\n \n \nfunc (this *MyQueue) Pop() int {\n    this.fillStackOut()\n    return this.stackOut.Pop()\n}\n \n \nfunc (this *MyQueue) Peek() int {\n    this.fillStackOut()\n    return this.stackOut.Peek()\n}\n \n \nfunc (this *MyQueue) Empty() bool {\n    if this.stackIn.Empty()&amp;&amp;this.stackOut.Empty(){\n        return true\n    }\n    return false\n}\n \n \n/**\n * Your MyQueue object will be instantiated and called as such:\n * obj := Constructor();\n * obj.Push(x);\n * param_2 := obj.Pop();\n * param_3 := obj.Peek();\n * param_4 := obj.Empty();\n */\n type MyStack []int\n \n func (s *MyStack) Push(v int){\n    *s=append(*s,v)\n }\n \n func (s *MyStack) Pop() int {\n    val:=(*s)[len(*s)-1]\n    *s=(*s)[:len(*s)-1]\n    return val\n }\n \n \n func (s *MyStack) Peek()int{\n    return (*s)[len(*s)-1]\n }\n \n func (s *MyStack) Size() int {\n\treturn len(*s)\n}\n \n func (s *MyStack) Empty()bool{\n    return s.Size()==0\n }\n \nç”¨ä¸€ä¸ªé˜Ÿåˆ—å®ç°æ ˆ\nå…ˆè¯´ä¸¤ä¸ªé˜Ÿåˆ—å®ç°æ ˆçš„æ€è·¯\nä¸€ä¸ªè´Ÿè´£ä¸»è¦çš„è¿›å‡ºæ ˆ,å¦å¤–ä¸€ä¸ªè´Ÿè´£å¤‡ä»½\nqueue.push(1);        \nqueue.push(2);        \nqueue.pop();   // å¯¹æ ˆæ¥è¯´è¿™æ—¶å€™åº”è¯¥å¼¹å‡º2.å¦‚æœåªç”¨ä¸€ä¸ªé˜Ÿåˆ—æ¥æ¨¡æ‹Ÿçš„è¯,ä¼šå¼¹å‡º1.å› æ­¤æˆ‘ä»¬å…ˆæŠŠ1æ”¾åˆ°å¦å¤–ä¸€ä¸ªé˜Ÿåˆ—,æŠŠ2å¼¹å‡ºä¹‹åå†æŠŠ1ç§»å›æ¥.  \nqueue.push(3);        \nqueue.push(4);       \nqueue.pop();  // æ³¨æ„å¼¹å‡ºçš„æ“ä½œ    \nqueue.pop();    \nqueue.pop();    \nqueue.empty();    \ntype MyStack struct {\n    queue1 *MyQueue\n    queue2 *MyQueue\n}\n \n \nfunc Constructor() MyStack {\n    return MyStack{\n    queue1: &amp;MyQueue{},\n    queue2: &amp;MyQueue{},   \n    }\n}\n \n \nfunc (this *MyStack) Push(x int)  {\n    this.queue1.Push(x)\n}\n \nfunc (this *MyStack) fillQueue2(){\n    n:=this.queue1.Size()//è¿™é‡Œå¿…é¡»å•ç‹¬æå‡ºæ¥,å› ä¸ºå¦‚æœæ”¾åœ¨å¾ªç¯é‡Œé¢,æ¯æ¬¡è¿›è¡Œæ¡ä»¶æ¯”è¾ƒçš„æ—¶å€™,éƒ½ä¼šé‡æ–°è®¡ç®—ä¸€æ¬¡size,ä½†æ˜¯popä¼šå¯¼è‡´sizeå˜å°,æ‰€ä»¥å¾ªç¯å®é™…ä¸Šåªè¿›è¡Œäº†ä¸€åŠ\n    for i:=0;i&lt;n-1;i++{\n        val:=this.queue1.Pop()\n        this.queue2.Push(val)\n    }\n}\nfunc (this *MyStack) fillQueue1(){\n    n:=this.queue2.Size()\n    for i:=0;i&lt;n;i++{\n        val:=this.queue2.Pop()\n        this.queue1.Push(val)\n    }\n}\n \nfunc (this *MyStack) Pop() int {\n    this.fillQueue2()\n    val:=this.queue1.Pop()\n    this.fillQueue1()\n    return val\n}\n//å®é™…ä¸Šè¿™é‡Œæœ€åå¯ä»¥ç”¨äº¤æ¢æŒ‡é’ˆçš„æ–¹æ³•,ä¸ç”¨å†è´¹åŠ²å€’å›å».å…·ä½“åšæ³•å¦‚ä¸‹\nthis.queue1, this.queue2 = this.queue2, this.queue1\n \nfunc (this *MyStack) Top() int {\n    return this.queue1.Tail()\n}\n \n \nfunc (this *MyStack) Empty() bool {\n    return this.queue1.Empty()&amp;&amp;this.queue2.Empty()\n}\n \n \n/**\n * Your MyStack object will be instantiated and called as such:\n * obj := Constructor();\n * obj.Push(x);\n * param_2 := obj.Pop();\n * param_3 := obj.Top();\n * param_4 := obj.Empty();\n */\n \ntype MyQueue []int\n \nfunc (s *MyQueue) Push(v int){\n    (*s)=append(*s,v)\n}\n \nfunc (s *MyQueue) Pop() int{\n    val:=(*s)[0]\n    (*s)=(*s)[1:]\n    return val\n}\n \nfunc (s *MyQueue) Peek() int{\n    return (*s)[0]\n}\n \nfunc (s *MyQueue) Tail() int{\n    return (*s)[len(*s)-1]\n}\n \nfunc (s *MyQueue) Size() int{\n    return len(*s)\n}\nfunc (s *MyQueue) Empty() bool{\n    return s.Size()==0\n}\nå…¶å®è¿˜æœ‰å¦å¤–ä¸€ç§å†™æ³•,æ˜¯pushæ¯”è¾ƒéº»çƒ¦,popæ¯”è¾ƒç®€å•çš„\ntype MyStack struct {\n    //åˆ›å»ºä¸¤ä¸ªé˜Ÿåˆ—\n    queue1 []int\n    queue2 []int\n}\n \n \nfunc Constructor() MyStack {\n    return MyStack{\t//åˆå§‹åŒ–\n        queue1:make([]int,0),\n        queue2:make([]int,0),\n    }\n}\n \n \nfunc (this *MyStack) Push(x int)  {\n     //å…ˆå°†æ•°æ®å­˜åœ¨ç©ºçš„queue2ä¸­\n    this.queue2 = append(this.queue2,x)\t\n   //å°†queue1ä¸­æ‰€æœ‰å…ƒç´ ç§»åˆ°queue2ä¸­ï¼Œå†å°†ä¸¤ä¸ªé˜Ÿåˆ—è¿›è¡Œäº¤æ¢\n    this.Move() \n}\n \n//æ ¸å¿ƒç›®çš„æ˜¯,ç¡®ä¿æœ€æ–°çš„å…ƒç´ æ°¸è¿œæ’åœ¨ç¬¬ä¸€ä¸ªé˜Ÿåˆ—çš„æœ€å‰é¢.ä¹Ÿå°±æ˜¯æ•°ç»„ä¸‹æ ‡0å¤„.ç”¨è¿™ä¸ªå‡½æ•°,queue1ä¸€ç›´æ˜¯æ ˆçš„çŠ¶æ€(å…ˆè¿›å…ˆå‡º.)\nfunc (this *MyStack) Move(){    \n    if len(this.queue1) == 0{\n        //äº¤æ¢ï¼Œqueue1ç½®ä¸ºqueue2,queue2ç½®ä¸ºç©º\n        this.queue1,this.queue2 = this.queue2,this.queue1\n    }else{\n        //queue1å…ƒç´ ä»å¤´å¼€å§‹ä¸€ä¸ªä¸€ä¸ªè¿½åŠ åˆ°queue2ä¸­\n            this.queue2 = append(this.queue2,this.queue1[0])  \n            this.queue1 = this.queue1[1:]\t//å»é™¤ç¬¬ä¸€ä¸ªå…ƒç´ \n            this.Move()     //é‡å¤\n    }\n}\n \nfunc (this *MyStack) Pop() int {\n    val := this.queue1[0]\n    this.queue1 = this.queue1[1:]\t//å»é™¤ç¬¬ä¸€ä¸ªå…ƒç´ \n    return val\n \n}\n \n \nfunc (this *MyStack) Top() int {\n    return this.queue1[0]\t//ç›´æ¥è¿”å›\n}\n \n \nfunc (this *MyStack) Empty() bool {\nreturn len(this.queue1) == 0\n}\nä¼˜åŒ–:åªç”¨ä¸€ä¸ªé˜Ÿåˆ—.\nå¯¹äºé˜Ÿåˆ—è€Œè¨€.å¦‚æœæƒ³è¦åˆ æ‰æœ€åè¿›æ¥çš„é‚£ä¸ªå…ƒç´ ,åªéœ€è¦æŠŠå‰é¢çš„äººå…¨éƒ¨æ‹¿å‡ºæ¥é‡æ–°æ’åˆ°é˜Ÿå°¾,ç„¶åæŠŠé˜Ÿåˆ—æœ€å‰é¢çš„å…ƒç´ [ä¹Ÿå°±æ˜¯æ ˆé¡¶]å¼¹å‡ºå³å¯.å¦™å“‰å¦™å“‰..\ntype MyStack struct {\n    queue []int//åˆ›å»ºä¸€ä¸ªé˜Ÿåˆ—\n}\n \n \n/** Initialize your data structure here. */\nfunc Constructor() MyStack {\n    return MyStack{   //åˆå§‹åŒ–\n        queue:make([]int,0),\n    }\n}\n \n \n/** Push element x onto stack. */\nfunc (this *MyStack) Push(x int)  {\n    //æ·»åŠ å…ƒç´ \n    this.queue=append(this.queue,x)\n}\n \n \n/** Removes the element on top of the stack and returns that element. */\nfunc (this *MyStack) Pop() int {\n    n:=len(this.queue)-1//åˆ¤æ–­é•¿åº¦\n    for n!=0{ //é™¤äº†æœ€åä¸€ä¸ªï¼Œå…¶ä½™çš„éƒ½é‡æ–°æ·»åŠ åˆ°é˜Ÿåˆ—é‡Œ\n        val:=this.queue[0]\n        this.queue=this.queue[1:]\n        this.queue=append(this.queue,val)\n        n--\n    }\n    //å¼¹å‡ºå…ƒç´ \n    val:=this.queue[0]\n    this.queue=this.queue[1:]\n    return val\n    \n}\n \n \n/** Get the top element. */\nfunc (this *MyStack) Top() int {\n    //åˆ©ç”¨Popå‡½æ•°ï¼Œå¼¹å‡ºæ¥çš„å…ƒç´ é‡æ–°æ·»åŠ \n    val:=this.Pop()\n    this.queue=append(this.queue,val)//åªæ˜¯æ‹¿å‡ºæ¥çœ‹ä¸€çœ¼,é©¬ä¸Šå¡å›å»\n    return val\n}\n \n \n/** Returns whether the stack is empty. */\nfunc (this *MyStack) Empty() bool {\n    return len(this.queue)==0\n}\n "},"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/æ ˆä¸é˜Ÿåˆ—/é€’å½’":{"slug":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/æ ˆä¸é˜Ÿåˆ—/é€’å½’","filePath":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/æ ˆä¸é˜Ÿåˆ—/é€’å½’.md","title":"é€’å½’","links":[],"tags":[],"content":"é€’å½’çš„å®ç°\n\né€’å½’çš„å®ç°å°±æ˜¯ï¼š\n\næ¯ä¸€æ¬¡é€’å½’è°ƒç”¨éƒ½ä¼šæŠŠå‡½æ•°çš„å±€éƒ¨å˜é‡ã€å‚æ•°å€¼å’Œè¿”å›åœ°å€ç­‰å‹å…¥è°ƒç”¨æ ˆä¸­.\nç„¶åé€’å½’è¿”å›çš„æ—¶å€™ï¼Œä»æ ˆé¡¶å¼¹å‡ºä¸Šä¸€æ¬¡é€’å½’çš„å„é¡¹å‚æ•°\n\n\nå› æ­¤å®é™…ä¸Š,æ ˆä¸é€’å½’åœ¨æŸç§ç¨‹åº¦ä¸Šæ˜¯å¯ä»¥è½¬æ¢çš„\n\né€’å½’ç®—æ³•ä¸‰è¦ç´ \n\nç¡®å®šå•å±‚é€’å½’çš„åŸç†\n\nåŸé—®é¢˜å’Œå­é—®é¢˜è¦ä½¿ç”¨çš„ç›¸åŒå‡½æ•°.\n\n\nç¡®å®šé€’å½’å‡½æ•°çš„å‚æ•°å’Œè¿”å›å€¼\nç¡®å®šè¾¹ç•Œæ¡ä»¶.[å¦‚æœé€’å½’æ²¡æœ‰ç»ˆæ­¢ä¼šå¯¼è‡´æ ˆæº¢å‡º]\n\nåˆ†è§£å‡ºå­é—®é¢˜,ç›´åˆ°æœ€å°çš„å­é—®é¢˜,éœ€è¦ç›´æ¥è¿”å›çš„å€¼.\næ¯”å¦‚è¦è®¡ç®—æ·±åº¦,å…±åŒçš„å‡½æ•°æ˜¯å·¦å­æ ‘æ·±åº¦å’Œå³å­æ ‘æ·±åº¦çš„æœ€å¤§å€¼+1.è€Œè¾¹ç•Œæ¡ä»¶: åˆ†è§£åˆ°æœ€å°å°±æ˜¯å¶å­èŠ‚ç‚¹ç›´æ¥è¿”å›0\n\n\n"},"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/æ»‘åŠ¨çª—å£ä¸å‰ç¼€å’Œ/3.-æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²":{"slug":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/æ»‘åŠ¨çª—å£ä¸å‰ç¼€å’Œ/3.-æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²","filePath":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/æ»‘åŠ¨çª—å£ä¸å‰ç¼€å’Œ/3. æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸².md","title":"3. æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²","links":["æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/å­—ç¬¦ä¸²å¤„ç†"],"tags":["ç›²è¿‡"],"content":"ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸²Â sÂ ï¼Œè¯·ä½ æ‰¾å‡ºå…¶ä¸­ä¸å«æœ‰é‡å¤å­—ç¬¦çš„Â æœ€é•¿Â å­ä¸²Â çš„é•¿åº¦\nå°è®°\n\næ»‘åŠ¨çª—å£æ€æƒ³\né‡å¤å­—ç¬¦:è®°å½•é¢‘ç‡\nTransclude of å­—ç¬¦ä¸²å¤„ç†#rangeä¸ä¸‹æ ‡\n\nä»£ç \nfunc lengthOfLongestSubstring(s string) int {\n    //ä¸å«æœ‰é‡å¤å­—ç¬¦:ä¸€ä¸ªæ•°ç»„æ¥è®°å½•å­—ç¬¦å‡ºç°çš„é¢‘ç‡,.å¦‚æœæ–°è¿›æ¥çš„è¿™ä¸ªæ•°=2äº†,å°±ç¼©å°å·¦è¾¹ç›´åˆ°è¿™ä¸ªæ•°å‰é¢é‚£ä¸ªé‡å¤çš„æ•°å‡ºå»,2-1=1.ç¡®ä¿æ•´ä¸ªæ•°ç»„å†…æ²¡æœ‰é‡å¤å…ƒç´ çš„æ—¶å€™å¯ä»¥è®°å½•æœ€å¤§å€¼ans.\n    cnt:=[128]int{}\n    left:=0\n    ans:=0\n    for i,c:=range s{\n        cnt[c]++\n        for cnt[c]&gt;1{\n            cnt[s[left]]--\n            left++\n        }\n        ans = max(ans, i-left+1)\n    } \n    return ans\n}\nfunc lengthOfLongestSubstring(s string) int {\n    //å¥½å§ç°åœ¨çœ‹åˆ°è¿™ç§ä¹ä¸€çœ‹å°±è§‰å¾—åº”è¯¥ç”¨åŠ¨æ€è§„åˆ’.å†ä»”ç»†çœ‹çœ‹\n    //ä¸å«æœ‰é‡å¤å­—ç¬¦ çœ‹åˆ°è¿™é‡Œè§‰å¾—åº”è¯¥æ˜¯å“ˆå¸Œè¡¨+æ»‘åŠ¨çª—å£äº†\n    //å³è¾¹ä¸€ç›´çº³å…¥,å¦‚æœé‡åˆ°æœ‰é‡å¤çš„å­—ç¬¦äº†,å°±å·¦è¾¹ç¼©å°ç›´åˆ°æ²¡æœ‰é‡å¤ä¸ºæ­¢.è¿™æ—¶å€™å†è®°å½•æœ€å¤§å€¼!æ„Ÿè§‰éå¸¸çš„å¯è¡Œ\n    cnt:=map[rune]int{}\n    t:=[]rune(s)//è¿™é‡Œå¿…é¡»è¦è½¬æˆruneæ•°ç»„,ä¸ç„¶åé¢s[left]æ˜¯æ‹¿ä¸å‡ºruneçš„åªèƒ½æ‹¿å‡ºbyte,åˆä¸ç¬¦åˆå“ˆå¸Œè¡¨äº†\n    //è¿™é‡Œè¯´sç”±è‹±æ–‡å­—æ¯æ•°å­—ç¬¦å·å’Œç©ºæ ¼ç»„æˆ æ‰€ä»¥è¿™ä¸ªå¤§å°åº”è¯¥æ˜¯å¯æ§çš„ä½†æ˜¯æˆ‘åˆå¿˜è®°asciiç èŒƒå›´äº†æ‰€ä»¥è¿˜æ˜¯æ²¡åŠæ³•ç”¨æ•°ç»„äº†ç®—äº†\n    left:=0\n    ans:=0\n    for right,c:=range t{\n        cnt[c]++\n        for cnt[c]==2{\n            cnt[t[left]]--\n            left++\n        }\n        //åˆ°è¿™é‡Œçš„æ—¶å€™,çª—å£å†…åº”è¯¥éƒ½æ˜¯ä¸å«æœ‰é‡å¤å­—ç¬¦çš„,å¯ä»¥è®°å½•äº†\n        ans=max(ans,right-left+1)\n    }\n    return ans\n}"},"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/æ»‘åŠ¨çª—å£ä¸å‰ç¼€å’Œ/560.-å’Œä¸ºKçš„å­æ•°ç»„":{"slug":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/æ»‘åŠ¨çª—å£ä¸å‰ç¼€å’Œ/560.-å’Œä¸ºKçš„å­æ•°ç»„","filePath":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/æ»‘åŠ¨çª—å£ä¸å‰ç¼€å’Œ/560. å’Œä¸ºKçš„å­æ•°ç»„.md","title":"560. å’Œä¸ºKçš„å­æ•°ç»„","links":["æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/æ•°/næ•°ä¹‹å’Œ"],"tags":[],"content":"ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„Â numsÂ å’Œä¸€ä¸ªæ•´æ•°Â kÂ ï¼Œè¯·ä½ ç»Ÿè®¡å¹¶è¿”å›è¯¥æ•°ç»„ä¸­å’Œä¸ºÂ kÂ çš„å­æ•°ç»„çš„ä¸ªæ•°ã€‚\nå­æ•°ç»„æ˜¯æ•°ç»„ä¸­å…ƒç´ çš„è¿ç»­éç©ºåºåˆ—ã€‚\nå°è®°\n\nä½¿ç”¨næ•°ä¹‹å’Œçš„æ€æƒ³.\n\nå½“éå†åˆ°å½“å‰ä½ç½® j æ—¶ï¼Œå‰ç¼€å’Œæ˜¯ s[j]ã€‚å¦‚æœå‰é¢æœ‰ä¸ªä½ç½® i çš„å‰ç¼€å’Œæ˜¯ s[j] - kï¼Œé‚£å°±è¯´æ˜ä¸­é—´è¿™ä¸€æ®µçš„å’Œæ­£å¥½æ˜¯ kã€‚[target]\n\n\næŸ¥æ‰¾å‰é¢æœ‰æ²¡æœ‰ä¸€ä¸ªæ•°=target,ä½¿ç”¨å“ˆå¸Œè¡¨æ˜¯æœ€å¿«çš„.\n\nä»£ç \nfunc subarraySum(nums []int, k int) int {\n    // Key: å‰ç¼€å’Œçš„å€¼, Value: è¿™ä¸ªå‰ç¼€å’Œå‡ºç°çš„æ¬¡æ•°\n    // é¢„åˆ†é…å†…å­˜ï¼Œé¿å…mapæ‰©å®¹ï¼Œé•¿åº¦è®¾ä¸ºlen(nums)+1\n    mp := make(map[int]int, len(nums)+1)\n    \n    //éœ€è¦è¿™ä¸ª0å­˜åœ¨ã€‚å“ˆå¸Œè¡¨ä¸­å­˜å‚¨çš„æ˜¯indexå‰ç¼€å’Œå‡ºç°çš„æ¬¡æ•°\n    mp[0] = 1\n    \n    count := 0 // è®°å½•æœ€ç»ˆç­”æ¡ˆ\n    pre := 0   // è®°å½•å½“å‰çš„å‰ç¼€å’Œ\n    //å¦‚æœå½“å‰å‰ç¼€å’Œç›´æ¥ç­‰äº `k` (æ¯”å¦‚ `s[j]=2, k=2`)ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾ `2-2=0`ã€‚å¦‚æœä¸å­˜ `0`ï¼Œå°±ä¼šæ¼æ‰ä»å¤´å¼€å§‹çš„å­æ•°ç»„ã€‚\n    for _, x := range nums {\n        pre += x // 1. æ›´æ–°å½“å‰å‰ç¼€å’Œ\n        \n        // 2. æŸ¥è¡¨ï¼šçœ‹çœ‹å‰é¢æœ‰æ²¡æœ‰ å‰ç¼€å’Œ = (pre - k)\n        // å¦‚æœæœ‰ï¼Œè¯´æ˜è¿™ä¸¤æ®µå‰ç¼€å’Œçš„å·®å€¼æ­£å¥½æ˜¯ k.æ³¨æ„è¿™é‡Œçš„å†™æ³•\n        if c, ok := mp[pre-k]; ok {\n            count += c//å› ä¸ºé‡å¤ä¹Ÿä¼šè¢«è®¡å…¥\n        }\n        // 3. å­˜è¡¨ï¼šæŠŠå½“å‰çš„å‰ç¼€å’Œè®°å½•ä¸‹æ¥ï¼Œä¾›åé¢æŸ¥è¯¢\n        mp[pre]++\n    }\n    \n    return count\n}"},"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/æ»‘åŠ¨çª—å£ä¸å‰ç¼€å’Œ/æ»‘åŠ¨çª—å£ä¸å‰ç¼€å’Œ":{"slug":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/æ»‘åŠ¨çª—å£ä¸å‰ç¼€å’Œ/æ»‘åŠ¨çª—å£ä¸å‰ç¼€å’Œ","filePath":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/æ»‘åŠ¨çª—å£ä¸å‰ç¼€å’Œ/æ»‘åŠ¨çª—å£ä¸å‰ç¼€å’Œ.md","title":"æ»‘åŠ¨çª—å£ä¸å‰ç¼€å’Œ","links":[],"tags":[],"content":"å˜é•¿æ»‘åŠ¨çª—å£\n\næ³¨æ„ä½¿ç”¨æ•°ç»„å…ƒç´ éƒ½æ˜¯æ­£æ•°çš„æ€§è´¨\n\nå³æŒ‡é’ˆå¾€å³ç§» \\rightarrow çª—å£å†…å’Œä¸€å®šå˜å¤§ã€‚\nå·¦æŒ‡é’ˆå¾€å³ç§» \\rightarrow çª—å£å†…å’Œä¸€å®šå˜å°ã€‚\n\n\nå¦‚æœé¢˜ç›®ä¸­å‡ºç°è´Ÿæ•°,åˆ™æ— æ³•ä½¿ç”¨æ»‘åŠ¨çª—å£\nç©ºé—´å¤æ‚åº¦O(1)\n\nå‰ç¼€å’Œ\né€šå¸¸é…åˆå“ˆå¸Œè¡¨,é€šè¿‡æ•°å­¦å·®å€¼è®¡ç®—è§£å†³é—®é¢˜,ä¸ä¾èµ–å•è°ƒæ€§(æ­£è´Ÿæ•°å‡å¯)\néœ€è¦é¢å¤–ç©ºé—´å­˜å‚¨å‰ç¼€ä¿¡æ¯:é™æ€é¢„å¤„ç†\nå®šé•¿æ»‘åŠ¨çª—å£\næ­£è´Ÿæ•°å‡å¯.\nç©ºé—´å¤æ‚åº¦O(1)"},"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/ç§»åŠ¨åŒ¹é…":{"slug":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/ç§»åŠ¨åŒ¹é…","filePath":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/ç§»åŠ¨åŒ¹é….md","title":"ç§»åŠ¨åŒ¹é…","links":[],"tags":[],"content":""},"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/è¯­æ³•ç»†èŠ‚":{"slug":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/è¯­æ³•ç»†èŠ‚","filePath":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/è¯­æ³•ç»†èŠ‚.md","title":"è¯­æ³•ç»†èŠ‚","links":[],"tags":[],"content":"\ngoä¸­çš„äº¤æ¢å¯ä»¥è¿™æ ·å†™:\n\n s[left], s[right] = s[right], s[left]\n\n\nå…³äºå°æ‹¬å·å’ŒèŠ±æ‹¬å·\n\n() å°æ‹¬å·ï¼šæ˜¾å¼ç±»å‹è½¬æ¢ (Type Conversion)å¯ä»¥å†™t:=[]byte(s)ç›´æ¥æŠŠå­—ç¬¦ä¸²æ˜¾å¼è½¬æ¢æˆæ•°ç»„.string(cnt)å†è¿™æ ·è½¬æ¢å›å»å°±è¡Œäº†\n{} èŠ±æ‹¬å·ï¼šåˆå§‹åŒ–/æ„é€  (Composite Literal)\n\n\n\nimportåé¢ç”¨çš„æ˜¯å°æ‹¬å·\n\n\nå¾ªç¯ä¸­æ–­\n\ncontinue è·³å‡ºå½“æ¬¡å¾ªç¯\nbreak ç»“æŸå½“å‰å¾ªç¯\nå¦‚æœæƒ³è¦ç»“æŸæ‰€æœ‰å¾ªç¯,å¯ä»¥ä½¿ç”¨goè¯­è¨€çš„é…åˆæ ‡ç­¾çš„break(Label)\n\n\n\npackage main\n \nimport &quot;fmt&quot;\n \nfunc main() {\n// ç»™å¤–å±‚å¾ªç¯èµ·ä¸ªåå­—å« MyLoop (åå­—éšä¾¿èµ·)\nMyLoop: \n    for i := 0; i &lt; 3; i++ {\n        for j := 0; j &lt; 5; j++ {\n            if j == 2 {\n                // æŒ‡åé“å§“ï¼šæˆ‘è¦è·³å‡ºåå« MyLoop çš„é‚£ä¸ªå¾ªç¯\n                break MyLoop \n            }\n            fmt.Printf(&quot;i:%d, j:%d\\n&quot;, i, j)\n        }\n    }\n    // break MyLoop åç›´æ¥æ¥åˆ°è¿™é‡Œï¼Œå¤–å±‚å¾ªç¯ä¹Ÿè¢«ç»ˆæ­¢äº†\n    fmt.Println(&quot;å½»åº•ç»“æŸ&quot;)\n}\n\né€—å·\n\ntype MyQueue struct {\n    stackIn  *MyStack\n    stackOut *MyStack\n}\n \nfunc Constructor() MyQueue {\n    return MyQueue{\n      stackIn: &amp;MyStack{},\n      stackOut: &amp;MyStack{},\n    }\n}\nå†’å·å«ä¹‰:è´´æ ‡ç­¾.\né€—å·å«ä¹‰:åˆ—è¡¨åˆ†éš”,ä¸ºäº†gitç‰ˆæœ¬æ§åˆ¶å‹å¥½.è¿™æ ·ä¸‹ä¸€æ¬¡è¦åŠ ä¸€ä¸ªå­—æ®µçš„æ—¶å€™åªæœ‰ä¸€è¡Œä¿®æ”¹,è€Œä¸æ˜¯ä¸Šä¸€è¡ŒåŠ ä¸Šé€—å·+æ–°å­—æ®µè¡Œ.\nå®é™…ä¸Š,è¿™å°±æ˜¯ä¸€ä¸ªJSONå†™æ³•,key-valueå¯¹.\n\n\nå‡½æ•°è°ƒç”¨æ“ä½œç¬¦.\nè°ƒç”¨ä¸€ä¸ªå‡½æ•°ä¸€å®šè¦åŠ ä¸Š(),è¡¨ç¤ºæ‰§è¡Œè¿™ä¸ªå‡½æ•°.å³ä½¿ä¸éœ€è¦ä¼ å‚æ•°ä¹Ÿè¦åŠ \nå¦‚æœä¸åŠ æ‹¬å·,è¡¨ç¤ºæåˆ°è¿™ä¸ªå‡½æ•°æœ¬èº«,æ˜¯æŠŠå‡½æ•°å½“ä½œä¸€ä¸ªå˜é‡æˆ–è€…å¯¹è±¡\n\n\nç»“æ„ä½“\n\n\n//æƒ…å†µ1\ntype MyQueue []int\nfunc (q *MyQueue) Push(...)//å¦‚æœè¦ä¿®æ”¹é•¿åº¦,ä¸€å®šè¦ä¼ åˆ‡ç‰‡çš„æŒ‡é’ˆè¿›å».\n(*q)[0]//æ—¢ç„¶ç©¿äº†æŒ‡é’ˆ,é‚£ä¹ˆä¿®æ”¹åˆ‡ç‰‡ä¸­æŸä¸ªå…ƒç´ çš„æ—¶å€™å°±å¿…é¡»è§£å¼•ç”¨\n \n \n//æƒ…å†µ2\ntype MyQueue struct {\n    queue []int\n}\n//é‚£ä¹ˆé»˜è®¤ä¼ myqueueçš„æŒ‡é’ˆ.ä½†æ˜¯å¦‚æœè¦æ”¹queueä¸­çš„å…ƒç´ ,ä¸éœ€è¦è§£å¼•ç”¨,m.queue[0]å°±å¯ä»¥.\n//å¦‚æœè¦å¢åˆ å­—æ®µä¹Ÿæ¯”è¾ƒæ–¹ä¾¿.\n//ç¼ºç‚¹æ˜¯éœ€è¦å¤šå†™ä¸€ä¸ªm."},"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/è´ªå¿ƒç®—æ³•/300.-æœ€é•¿é€’å¢å­åºåˆ—":{"slug":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/è´ªå¿ƒç®—æ³•/300.-æœ€é•¿é€’å¢å­åºåˆ—","filePath":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/è´ªå¿ƒç®—æ³•/300. æœ€é•¿é€’å¢å­åºåˆ—.md","title":"300. æœ€é•¿é€’å¢å­åºåˆ—","links":[],"tags":[],"content":"ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„Â numsÂ ï¼Œæ‰¾åˆ°å…¶ä¸­æœ€é•¿ä¸¥æ ¼é€’å¢å­åºåˆ—çš„é•¿åº¦ã€‚\nå­åºåˆ—Â æ˜¯ç”±æ•°ç»„æ´¾ç”Ÿè€Œæ¥çš„åºåˆ—ï¼Œåˆ é™¤ï¼ˆæˆ–ä¸åˆ é™¤ï¼‰æ•°ç»„ä¸­çš„å…ƒç´ è€Œä¸æ”¹å˜å…¶ä½™å…ƒç´ çš„é¡ºåºã€‚ä¾‹å¦‚ï¼Œ[3,6,2,7]Â æ˜¯æ•°ç»„Â [0,3,1,6,2,2,7]Â çš„å­åºåˆ—ã€‚\nå°è®°\nä»£ç \n "},"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/é“¾è¡¨/141.-ç¯å½¢é“¾è¡¨":{"slug":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/é“¾è¡¨/141.-ç¯å½¢é“¾è¡¨","filePath":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/é“¾è¡¨/141. ç¯å½¢é“¾è¡¨.md","title":"141. ç¯å½¢é“¾è¡¨","links":[],"tags":[],"content":"ç»™ä½ ä¸€ä¸ªé“¾è¡¨çš„å¤´èŠ‚ç‚¹Â headÂ ï¼Œåˆ¤æ–­é“¾è¡¨ä¸­æ˜¯å¦æœ‰ç¯ã€‚\nå¦‚æœé“¾è¡¨ä¸­æœ‰æŸä¸ªèŠ‚ç‚¹ï¼Œå¯ä»¥é€šè¿‡è¿ç»­è·Ÿè¸ªÂ nextÂ æŒ‡é’ˆå†æ¬¡åˆ°è¾¾ï¼Œåˆ™é“¾è¡¨ä¸­å­˜åœ¨ç¯ã€‚ ä¸ºäº†è¡¨ç¤ºç»™å®šé“¾è¡¨ä¸­çš„ç¯ï¼Œè¯„æµ‹ç³»ç»Ÿå†…éƒ¨ä½¿ç”¨æ•´æ•°Â posÂ æ¥è¡¨ç¤ºé“¾è¡¨å°¾è¿æ¥åˆ°é“¾è¡¨ä¸­çš„ä½ç½®ï¼ˆç´¢å¼•ä» 0 å¼€å§‹ï¼‰ã€‚æ³¨æ„ï¼šposÂ ä¸ä½œä¸ºå‚æ•°è¿›è¡Œä¼ é€’Â ã€‚ä»…ä»…æ˜¯ä¸ºäº†æ ‡è¯†é“¾è¡¨çš„å®é™…æƒ…å†µã€‚\nå¦‚æœé“¾è¡¨ä¸­å­˜åœ¨ç¯Â ï¼Œåˆ™è¿”å›Â trueÂ ã€‚ å¦åˆ™ï¼Œè¿”å›Â falseÂ ã€‚\nå°è®°\nä»£ç \n/**\n * Definition for singly-linked list.\n * type ListNode struct {\n *     Val int\n *     Next *ListNode\n * }\n */\nfunc hasCycle(head *ListNode) bool {\n    //å› ä¸ºæœ¬ä½“ä¸éœ€è¦æ‰¾åˆ°ç¯çš„å¼€å§‹ä½ç½® æ‰€ä»¥ä¸ç”¨å¤ªå¤æ‚\n    //å¿«æŒ‡é’ˆ:2x æ…¢æŒ‡é’ˆx  å·®å€¼ä¸ºx ç„¶åè¿›å…¥ç¯ä¹‹å,è¿™ä¸ªxå°†ç”±xæ­¥è¿½å¹³.å› æ­¤,å¦‚æœç›¸é‡è¯´æ˜æœ‰ç¯.\n    slow, fast := head, head\n    for fast!=nil&amp;&amp;fast.Next!=nil{\n        fast=fast.Next.Next\n        slow=slow.Next\n        if fast==slow{\n            return true \n        }\n    }\n    return false\n}"},"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/é“¾è¡¨/142.-ç¯å½¢é“¾è¡¨-II":{"slug":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/é“¾è¡¨/142.-ç¯å½¢é“¾è¡¨-II","filePath":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/é“¾è¡¨/142. ç¯å½¢é“¾è¡¨ II.md","title":"142. ç¯å½¢é“¾è¡¨ II","links":["tags/flashcard"],"tags":["flashcard"],"content":"ç»™å®šä¸€ä¸ªé“¾è¡¨çš„å¤´èŠ‚ç‚¹ Â headÂ ï¼Œè¿”å›é“¾è¡¨å¼€å§‹å…¥ç¯çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ã€‚Â å¦‚æœé“¾è¡¨æ— ç¯ï¼Œåˆ™è¿”å›Â nullã€‚\nå¦‚æœé“¾è¡¨ä¸­æœ‰æŸä¸ªèŠ‚ç‚¹ï¼Œå¯ä»¥é€šè¿‡è¿ç»­è·Ÿè¸ªÂ nextÂ æŒ‡é’ˆå†æ¬¡åˆ°è¾¾ï¼Œåˆ™é“¾è¡¨ä¸­å­˜åœ¨ç¯ã€‚ ä¸ºäº†è¡¨ç¤ºç»™å®šé“¾è¡¨ä¸­çš„ç¯ï¼Œè¯„æµ‹ç³»ç»Ÿå†…éƒ¨ä½¿ç”¨æ•´æ•°Â posÂ æ¥è¡¨ç¤ºé“¾è¡¨å°¾è¿æ¥åˆ°é“¾è¡¨ä¸­çš„ä½ç½®ï¼ˆç´¢å¼•ä» 0 å¼€å§‹ï¼‰ã€‚å¦‚æœÂ posÂ æ˜¯Â -1ï¼Œåˆ™åœ¨è¯¥é“¾è¡¨ä¸­æ²¡æœ‰ç¯ã€‚æ³¨æ„ï¼šposÂ ä¸ä½œä¸ºå‚æ•°è¿›è¡Œä¼ é€’ï¼Œä»…ä»…æ˜¯ä¸ºäº†æ ‡è¯†é“¾è¡¨çš„å®é™…æƒ…å†µã€‚\nä¸å…è®¸ä¿®æ”¹Â é“¾è¡¨ã€‚ flashcard\nå°è®°\n\nç¯å½¢é“¾è¡¨:å¿«æ…¢æŒ‡é’ˆç›¸é‡ä¹‹å,ä»å¤´èŠ‚ç‚¹å¼€å§‹å’Œæ…¢æŒ‡é’ˆç›¸é‡.ç›¸é‡çš„èŠ‚ç‚¹å°±æ˜¯ç¯çš„å…¥å£\næˆ‘è‡ªå·±å†™å€’æ˜¯èƒ½å†™å‡ºæ¥,ä½†æ˜¯å°±æ˜¯è§‰å¾—ä¸å¤ªç¾è§‚ä¹Ÿæ²¡ä»€ä¹ˆç»“æ„,è¿˜æ˜¯å¤šæ¨¡ä»¿å¤šå­¦ä¹ â€¦\nåªè¦ fast ä¸ä¸ºç©ºï¼Œä¸” fast.Next ä¸ä¸ºç©ºï¼Œå°±å¯ä»¥å®‰å…¨åœ°æ‰§è¡Œ fast = fast.Next.Next..å³ä½¿ fast.Next.Next æ˜¯ç©ºï¼Œèµ‹å€¼ç»™ fast åï¼Œfast å˜æˆ nil ä¹Ÿå°±æ˜¯äº†ï¼Œä¸‹ä¸€è½®å¾ªç¯è‡ªç„¶ä¼šç”± fast != nil æ‹¦æˆªä½ã€‚\n\nfor ... {\n    if ç›¸é‡ {\n        å¤„ç†;\n        return ç»“æœ; // åªè¦æœ‰ç¯ï¼Œè¿™é‡Œå°±è¿”å›äº†\n    }\n}\nreturn nil; // èƒ½èµ°åˆ°è¿™é‡Œï¼Œè¯´æ˜å¾ªç¯è‡ªç„¶ç»“æŸäº†ï¼Œè‚¯å®šæ— ç¯\n//è¿™æ ·å°±ä¸éœ€è¦ä¸ºäº†å¼¥è¡¥ `break` è·³å‡ºå¾ªç¯åä¸çŸ¥é“æ˜¯â€œå› ä¸ºç›¸é‡è·³å‡ºâ€è¿˜æ˜¯â€œå› ä¸ºèµ°åˆ°å°½å¤´è·³å‡ºâ€ è€Œä¸å¾—å·²åŠ ä¸Šè¡¥ä¸..\nä»£ç \nfunc detectCycle(head *ListNode) *ListNode {\n    slow, fast := head, head\n    for fast != nil &amp;&amp; fast.Next != nil {\n        slow = slow.Next\n        fast = fast.Next.Next\n        if fast == slow { // ç›¸é‡\n            for slow != head { // å†èµ° a æ­¥\n                slow = slow.Next\n                head = head.Next\n            }\n            return slow\n        }\n    }//æ‰€ä»¥è¯´å¦‚æœå­˜åœ¨ç©º,å°±ä¸ä¼šè¿›å…¥ä¸Šé¢è¿™ä¸ªå¾ªç¯,è‡ªç„¶è€Œç„¶ä¹Ÿå°±ä¸å­˜åœ¨ç¯.\n    return nil\n}"},"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/é“¾è¡¨/åè½¬é“¾è¡¨/25.-Kä¸ªä¸€ç»„ç¿»è½¬é“¾è¡¨":{"slug":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/é“¾è¡¨/åè½¬é“¾è¡¨/25.-Kä¸ªä¸€ç»„ç¿»è½¬é“¾è¡¨","filePath":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/é“¾è¡¨/åè½¬é“¾è¡¨/25. Kä¸ªä¸€ç»„ç¿»è½¬é“¾è¡¨.md","title":"25. Kä¸ªä¸€ç»„ç¿»è½¬é“¾è¡¨","links":[],"tags":[],"content":"ç»™ä½ é“¾è¡¨çš„å¤´èŠ‚ç‚¹Â headÂ ï¼Œæ¯Â kÂ ä¸ªèŠ‚ç‚¹ä¸€ç»„è¿›è¡Œç¿»è½¬ï¼Œè¯·ä½ è¿”å›ä¿®æ”¹åçš„é“¾è¡¨ã€‚\nkÂ æ˜¯ä¸€ä¸ªæ­£æ•´æ•°ï¼Œå®ƒçš„å€¼å°äºæˆ–ç­‰äºé“¾è¡¨çš„é•¿åº¦ã€‚å¦‚æœèŠ‚ç‚¹æ€»æ•°ä¸æ˜¯Â kÂ çš„æ•´æ•°å€ï¼Œé‚£ä¹ˆè¯·å°†æœ€åå‰©ä½™çš„èŠ‚ç‚¹ä¿æŒåŸæœ‰é¡ºåºã€‚\nä½ ä¸èƒ½åªæ˜¯å•çº¯çš„æ”¹å˜èŠ‚ç‚¹å†…éƒ¨çš„å€¼ï¼Œè€Œæ˜¯éœ€è¦å®é™…è¿›è¡ŒèŠ‚ç‚¹äº¤æ¢\nå°è®°\n\nåˆ†ç»„çœ‹ä¸‹ä¸€ç»„æ˜¯å¦å¤Ÿkä¸ª\n\nä¸å¤Ÿçš„è¯ç›´æ¥ç»“æŸ,\nå¦‚æœå¤Ÿçš„è¯,è®°ä¸‹è¿™ä¸€ç»„çš„å¤´å°¾,å’Œä¸‹ä¸€ç»„çš„å¤´\n\n\næ¯ä¸€ç»„ä¹‹é—´æ–­å¼€\næ¯ç»„å†…å„è‡ªç¿»è½¬\næ‹¼æ¥\næ¨è¿›\n\nä»£ç \nfunc reverseKGroup(head *ListNode, k int) *ListNode {\n    i:=head\n    n:=0\n    for i!=nil{\n        n++\n        i=i.Next\n    }\n    dummy:=&amp;ListNode{Next:head}\n    p0:=dummy\n    var pre *ListNode=nil\n    cur:=head\n    for ;n&gt;=k;n-=k{\n \n        for j:=0;j&lt;k;j++{\n            next:=cur.Next\n            cur.Next=pre\n            pre=cur\n            cur=next\n        }\n \n        p0.Next.Next=cur\n        nxt:=p0.Next\n        p0.Next=pre\n        p0=nxt\n        \n    }\n    return dummy.Next\n}"},"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/é“¾è¡¨/åè½¬é“¾è¡¨/åè½¬é“¾è¡¨":{"slug":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/é“¾è¡¨/åè½¬é“¾è¡¨/åè½¬é“¾è¡¨","filePath":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/é“¾è¡¨/åè½¬é“¾è¡¨/åè½¬é“¾è¡¨.md","title":"åè½¬é“¾è¡¨","links":[],"tags":[],"content":"Dummy èŠ‚ç‚¹é€šå¸¸ç”¨äºâ€œå¤´èŠ‚ç‚¹å¯èƒ½ä¼šå˜åŠ¨ï¼Œæˆ–è€…éœ€è¦åœ¨å¤´èŠ‚ç‚¹ä¹‹å‰è¿›è¡Œæ’å…¥/åˆ é™¤æ“ä½œâ€çš„åœºæ™¯\nåè½¬é“¾è¡¨\n\n\ncurå°±æ˜¯å½“å‰èŠ‚ç‚¹,åˆå§‹åŒ–ä¸ºhead.preåˆå§‹åŒ–ä¸ºç©º.æœ€åä¸ºnilçš„æ—¶å€™å¾ªç¯ç»“æŸ.for cur!=nil\n\nfunc reverseList(head *ListNode) *ListNode {\n    var pre *ListNode =nil\n    cur:=head\n    for cur!=nil{\n        next:=cur.Next\n        cur.Next=pre\n        pre=cur\n        cur=next\n    }\n \n    return pre\n}\n1- &gt; 2 â†’ 3 â†’ 4\nä¿®æ”¹2â†’3çš„æŒ‡é’ˆ,å¹¶ä¿æŒå…¶ä»–ä¸å˜.\nåè½¬é“¾è¡¨2: åè½¬ä»leftåˆ°rightä¹‹é—´çš„é“¾è¡¨\n\n\nåè½¬è¿‡å,preæŒ‡å‘è¿™ä¸€æ®µçš„æœ«å°¾,curæŒ‡å‘è¿™ä¸€æ®µçš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ è¿™å°±æ˜¯æ­£å¸¸çš„åè½¬é€»è¾‘,ä¸€å¼€å§‹cur=2,pre=0å³å¯,æœ€åå¾—åˆ°çš„å°±æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç»“æœ.ç„¶åè¡”æ¥çš„éƒ¨åˆ†åœ¨ä¸‹ä¸€æ­¥å•ç‹¬å¤„ç†\n\n\n\né‚£ä¹ˆåè½¬è¿‡å,è¿™ä¸€æ®µçš„å‰ä¸€ä¸ªèŠ‚ç‚¹å°±è¦æŒ‡å‘è¿™ä¸€æ®µçš„æœ€åä¸€ä¸ªèŠ‚ç‚¹,ç„¶åè¿™ä¸€æ®µçš„å¼€å¤´èŠ‚ç‚¹éœ€è¦æŒ‡å‘è¿™ä¸€æ®µçš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹.æ€»ä¹‹å¦‚å›¾æ‰€ç¤º\n\n\n\nå½“left=1çš„æ—¶å€™æ˜¯æ²¡æœ‰p0çš„,æ‰€ä»¥æˆ‘ä»¬ç”¨ä¸€ä¸ªå¤´èŠ‚ç‚¹æ¥å¤„ç†\n\n\né‚£ä¹ˆå¾ªç¯left-1æ¬¡,å°±ä¼šåˆ°è¾¾åè½¬è¿™ä¸€æ®µçš„ä¸Šä¸€ä¸ªèŠ‚ç‚¹\n\n\næœ€ä¸»è¦çš„æ˜¯,å¯¹äºè¿™ä¸ªp0çš„æ¦‚å¿µè¦æ¸…æ™°,å®ƒä»£è¡¨çš„æ˜¯åˆ†ç»„çš„å‰ä¸€ä¸ªèŠ‚ç‚¹.\n\n\næ¯æ¬¡åè½¬è¿‡å,æ–°æœ«å°¾è¦æŒ‡å‘ä¸‹ä¸€ä¸ªå¤´,è¿™æ˜¯åè½¬é“¾è¡¨çš„åŸºæœ¬äº‹ä»¶.ç­‰åˆ°ä¸‹ä¸€æ¬¡å¾ªç¯çš„æ—¶å€™åˆ†ç»„çš„å‰ä¸€ä¸ªèŠ‚ç‚¹ä¼šæŒ‡å‘åˆ†ç»„æœ«å°¾çš„,æ‰€ä»¥ä¸ç”¨æ‹…å¿ƒå¤šæ¬¡åè½¬ä¼šå¯¼è‡´é¡ºåºé”™äº†.\n\n\nfunc reverseBetween(head *ListNode, left int, right int) *ListNode {\n    dummy:=&amp;ListNode{Next:head}\n    p0:=dummy\n    for i:=0;i&lt;left-1;i++{\n        p0 = p0.Next\n    }\n    var pre *ListNode = nil\n    cur:=p0.Next\n    for j:=0;j&lt;right-left+1;j++{\n        next:=cur.Next\n        cur.Next=pre\n        pre=cur\n        cur=next\n    }\n    nxt:=p0.Next\n    nxt.Next=cur\n    p0.Next=pre\n    \n    return dummy.Next\n}"},"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/é“¾è¡¨/åˆå¹¶é“¾è¡¨/21.-åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨":{"slug":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/é“¾è¡¨/åˆå¹¶é“¾è¡¨/21.-åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨","filePath":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/é“¾è¡¨/åˆå¹¶é“¾è¡¨/21. åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨.md","title":"21. åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨","links":[],"tags":[],"content":"å°†ä¸¤ä¸ªå‡åºé“¾è¡¨åˆå¹¶ä¸ºä¸€ä¸ªæ–°çš„Â å‡åºÂ é“¾è¡¨å¹¶è¿”å›ã€‚æ–°é“¾è¡¨æ˜¯é€šè¿‡æ‹¼æ¥ç»™å®šçš„ä¸¤ä¸ªé“¾è¡¨çš„æ‰€æœ‰èŠ‚ç‚¹ç»„æˆçš„ã€‚\nå°è®°\n\næœ€å¥½ç”»å›¾çœ‹ä¸€ä¸‹æŒ‡é’ˆæ€ä¹ˆå˜å§\nå¤´èŠ‚ç‚¹çœŸå¥½ç”¨\næ³¨æ„æœ€åè¿”å›å€¼,æ€»ä¹‹è¦æ€è·¯æ¸…æ™°äº†å†å†™ä¸è¦ä¹±å†™äº†\n\nä»£ç \nfunc mergeTwoLists(list1, list2 *ListNode) *ListNode {\n    dummy := ListNode{} // ç”¨å“¨å…µèŠ‚ç‚¹ç®€åŒ–ä»£ç é€»è¾‘\n    cur := &amp;dummy // cur æŒ‡å‘æ–°é“¾è¡¨çš„æœ«å°¾\n    for list1 != nil &amp;&amp; list2 != nil {\n        if list1.Val &lt; list2.Val {\n            cur.Next = list1 // æŠŠ list1 åŠ åˆ°æ–°é“¾è¡¨ä¸­\n            list1 = list1.Next\n        } else { // æ³¨ï¼šç›¸ç­‰çš„æƒ…å†µåŠ å“ªä¸ªèŠ‚ç‚¹éƒ½æ˜¯å¯ä»¥çš„\n            cur.Next = list2 // æŠŠ list2 åŠ åˆ°æ–°é“¾è¡¨ä¸­\n            list2 = list2.Next\n        }\n        cur = cur.Next\n    }\n    // æ‹¼æ¥å‰©ä½™é“¾è¡¨\n    if list1 != nil {\n        cur.Next = list1\n    } else {\n        cur.Next = list2\n    }\n    return dummy.Next\n}"},"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/é“¾è¡¨/åˆå¹¶é“¾è¡¨/23.-åˆå¹¶Kä¸ªå‡åºé“¾è¡¨":{"slug":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/é“¾è¡¨/åˆå¹¶é“¾è¡¨/23.-åˆå¹¶Kä¸ªå‡åºé“¾è¡¨","filePath":"æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/é“¾è¡¨/åˆå¹¶é“¾è¡¨/23. åˆå¹¶Kä¸ªå‡åºé“¾è¡¨.md","title":"23. åˆå¹¶Kä¸ªå‡åºé“¾è¡¨","links":["æŠ€æœ¯ç§¯ç´¯/ç®—æ³•é¢˜/æ ˆä¸é˜Ÿåˆ—/å †"],"tags":[],"content":"ç»™ä½ ä¸€ä¸ªé“¾è¡¨æ•°ç»„ï¼Œæ¯ä¸ªé“¾è¡¨éƒ½å·²ç»æŒ‰å‡åºæ’åˆ—ã€‚\nè¯·ä½ å°†æ‰€æœ‰é“¾è¡¨åˆå¹¶åˆ°ä¸€ä¸ªå‡åºé“¾è¡¨ä¸­ï¼Œè¿”å›åˆå¹¶åçš„é“¾è¡¨ã€‚\nå°è®°\nå¯ä»¥ç”¨æœ€å°å †å®ç°ã€‚åˆå§‹æŠŠæ‰€æœ‰é“¾è¡¨çš„å¤´èŠ‚ç‚¹å…¥å †ï¼Œç„¶åä¸æ–­å¼¹å‡ºå †ä¸­æœ€å°èŠ‚ç‚¹ xï¼Œå¦‚æœ x.next ä¸ä¸ºç©ºå°±åŠ å…¥å †ä¸­ã€‚å¾ªç¯ç›´åˆ°å †ä¸ºç©ºã€‚æŠŠå¼¹å‡ºçš„èŠ‚ç‚¹æŒ‰é¡ºåºæ‹¼æ¥èµ·æ¥ï¼Œå°±å¾—åˆ°äº†ç­”æ¡ˆ.\nä»£ç \n\næ³¨æ„æ–­è¨€çš„å†™æ³•Transclude of å †#heapä¸­çš„æ–­è¨€\nå¦‚æœ node.Next ä¸ºç©ºï¼ˆnilï¼‰ï¼Œæ„å‘³ç€è¿™ä¸€æ¡é“¾è¡¨å·²ç»å…¨éƒ¨åˆå¹¶å®Œäº†ã€‚æ­¤æ—¶æˆ‘ä»¬ä»€ä¹ˆéƒ½ä¸åšï¼ˆä¸æŠŠ nil å…¥å †ï¼‰ï¼Œè®©å †é‡Œçš„å…ƒç´ æ•°é‡å‡ 1ï¼Œè¿™æ­£æ˜¯æˆ‘ä»¬è¦çš„æ•ˆæœã€‚\n\nfunc mergeKLists(lists []*ListNode) *ListNode {\n    h := hp{}\n    for _, head := range lists {\n        if head != nil {\n            h = append(h, head) // æŠŠæ‰€æœ‰éç©ºé“¾è¡¨çš„å¤´èŠ‚ç‚¹å…¥å †\n        }\n    }\n    heap.Init(&amp;h) // å †åŒ–\n \n    dummy := &amp;ListNode{} // å“¨å…µèŠ‚ç‚¹ï¼Œä½œä¸ºåˆå¹¶åé“¾è¡¨å¤´èŠ‚ç‚¹çš„å‰ä¸€ä¸ªèŠ‚ç‚¹\n    cur := dummy\n    for len(h) &gt; 0 { // å¾ªç¯ç›´åˆ°å †ä¸ºç©º\n        node := heap.Pop(&amp;h).(*ListNode) // å‰©ä½™èŠ‚ç‚¹ä¸­çš„æœ€å°èŠ‚ç‚¹\n        if node.Next != nil { // ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ä¸ä¸ºç©º\n            heap.Push(&amp;h, node.Next) // ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æœ‰å¯èƒ½æ˜¯æœ€å°èŠ‚ç‚¹ï¼Œå…¥å †\n        }\n        cur.Next = node // æŠŠ node æ·»åŠ åˆ°æ–°é“¾è¡¨çš„æœ«å°¾\n        cur = cur.Next // å‡†å¤‡åˆå¹¶ä¸‹ä¸€ä¸ªèŠ‚ç‚¹\n    }\n    return dummy.Next // å“¨å…µèŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹å°±æ˜¯æ–°é“¾è¡¨çš„å¤´èŠ‚ç‚¹\n}\n \ntype hp []*ListNode\nfunc (h hp) Len() int           { return len(h) }\nfunc (h hp) Less(i, j int) bool { return h[i].Val &lt; h[j].Val } // æœ€å°å †\nfunc (h hp) Swap(i, j int)      { h[i], h[j] = h[j], h[i] }\nfunc (h *hp) Push(v any)        { *h = append(*h, v.(*ListNode)) }\nfunc (h *hp) Pop() any          { a := *h; v := a[len(a)-1]; *h = a[:len(a)-1]; return v }\n \n "},"æŠ€æœ¯ç§¯ç´¯/é¡¹ç›®/01-çŸ­é“¾æ¥/QA":{"slug":"æŠ€æœ¯ç§¯ç´¯/é¡¹ç›®/01-çŸ­é“¾æ¥/QA","filePath":"æŠ€æœ¯ç§¯ç´¯/é¡¹ç›®/01 çŸ­é“¾æ¥/QA.md","title":"QA","links":["æŠ€æœ¯ç§¯ç´¯/é¡¹ç›®/01-çŸ­é“¾æ¥/é›ªèŠ±ç®—æ³•snowflake"],"tags":[],"content":"ç¬¬ä¸€ç»´åº¦ï¼šæ¶æ„è®¾è®¡ä¸IDç”Ÿæˆï¼ˆå¿…é—®åŒºï¼‰\n\nQ: ä¸ºä»€ä¹ˆé€‰ç”¨Snowflakeï¼ˆé›ªèŠ±ç®—æ³•ï¼‰ï¼Ÿç›¸æ¯”UUID å’Œæ•°æ®åº“è‡ªå¢IDï¼Œå®ƒçš„ä¼˜åŠ¿åœ¨å“ªï¼Ÿ\nTransclude of é›ªèŠ±ç®—æ³•snowflake#å…¶ä»–å”¯ä¸€idç”Ÿæˆæ³•\n\n\nUUID å¤ªé•¿ä¸é€‚åˆçŸ­è¿æ¥ ä¸”æ— åºï¼ˆå½±å“ æ•°æ®åº“çš„B+ æ ‘å†™å…¥æ€§èƒ½ï¼‰,æ’å…¥ä½ç½®éšæœº,ä¼šå¯¼è‡´é¡µåˆ†è£‚\nè‡ªå¢ ID å®¹æ˜“è¢«éå†ï¼ˆä¸å®‰å…¨ï¼‰ä¸”åˆ†åº“åˆ†è¡¨éº»çƒ¦,æ¯æ¬¡ç”Ÿæˆè¦è®¿é—®æ•°æ®åº“\nSnowflake æœ‰åºã€çº¯æ•°å­—ã€é«˜æ€§èƒ½ã€å¤©ç„¶æ”¯æŒåˆ†åº“åˆ†è¡¨.æœ¬åœ°ç”Ÿæˆä¸ä¾èµ–ç½‘ç»œã€‚\n\n\n\nQ: ä½ çš„Snowflake æ—¶é’Ÿå›æ‹¨ï¼ˆClock Rollbackï¼‰é—®é¢˜æ€ä¹ˆè§£å†³çš„ï¼Ÿ\n\n\nQ: çŸ­é“¾æ¥çš„æ˜ å°„ç®—æ³•æ˜¯æ€ä¹ˆåšçš„ï¼Ÿ ï¼ˆé•¿é“¾è½¬çŸ­é“¾ï¼‰\n\n\n_å…³é”®ç‚¹ï¼š_æ˜¯ç”¨Hashï¼ˆMD5/SHAï¼‰æˆªå–ï¼Ÿè¿˜æ˜¯Base62 è¿›åˆ¶è½¬æ¢ï¼Ÿ\n\n\næ¨èå›ç­”ç»“åˆç®€å†ï¼š â€œæˆ‘ä½¿ç”¨çš„æ˜¯å°† Snowflake ç”Ÿæˆçš„ 64ä½ ID è½¬æ¢ä¸º Base62 ç¼–ç ï¼ˆa-z, A-Z, 0-9ï¼‰ï¼Œè¿™æ ·ç”Ÿæˆçš„çŸ­é“¾é•¿åº¦çŸ­ä¸”å”¯ä¸€ã€‚â€\n\n\n\n\nQ: æ—¢ç„¶æ˜¯åˆ†å¸ƒå¼ï¼Œä½ çš„Snowflake é‡Œçš„æœºå™¨IDï¼ˆWorkerIDï¼‰æ˜¯æ€ä¹ˆåˆ†é…çš„ï¼Ÿ\n\n\n_å‘ç‚¹ï¼š_åˆ«è¯´æ˜¯æ‰‹åŠ¨å†™çš„ã€‚\n\n\nå‚è€ƒï¼š å¯ä»¥åˆ©ç”¨ Redis çš„ INCR åŸå­é€’å¢æ¥åˆ†é…ï¼Œæˆ–è€…åˆ©ç”¨ Zookeeper/Etcd æ³¨å†Œä¸´æ—¶èŠ‚ç‚¹ã€‚\n\n\n\n\n\nç¬¬äºŒç»´åº¦ï¼šç¼“å­˜ä½“ç³»ä¸å¸ƒéš†è¿‡æ»¤å™¨ï¼ˆé«˜å±åŒºï¼‰\né’ˆå¯¹ä½ ç®€å†ä¸­çš„ï¼šâ€œå¼•å…¥å¸ƒéš†è¿‡æ»¤å™¨æ‹¦æˆª99% æ— æ•ˆè¯·æ±‚ï¼Œè§£å†³ç¼“å­˜ç©¿é€â€\n\n\nQ: å¸ƒéš†è¿‡æ»¤å™¨çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆå®ƒèƒ½åˆ¤æ–­â€œä¸€å®šä¸å­˜åœ¨â€ï¼Ÿ\n\nå…³é”®ç‚¹ï¼š å¤šä¸ª Hash å‡½æ•°ï¼Œä½å›¾ï¼ˆBitMapï¼‰ã€‚å¦‚æœæŸä¸ªä½ç½®æ˜¯ 0ï¼Œåˆ™ä¸€å®šä¸å­˜åœ¨ï¼›å…¨ä¸º 1ï¼Œåˆ™å¯èƒ½å­˜åœ¨ï¼ˆè¯¯åˆ¤ï¼‰ã€‚\n\n\n\nQ: æ—¢ç„¶æœ‰è¯¯åˆ¤ï¼ˆFalse Positiveï¼‰ï¼Œå¦‚æœå¸ƒéš†è¿‡æ»¤å™¨è¯¯åˆ¤äº†ï¼ˆè¯´å­˜åœ¨ï¼Œå®é™…DB é‡Œæ²¡æœ‰ï¼‰ï¼Œä½ çš„ç³»ç»Ÿä¼šæ€ä¹ˆæ ·ï¼Ÿ\n\nå›ç­”é€»è¾‘ï¼š è¯¯åˆ¤ä¼šå¯¼è‡´å°‘é‡è¯·æ±‚ç©¿é€åˆ° DBï¼Œä½†å› ä¸ºå¸ƒéš†è¿‡æ»¤äº†ç»å¤§å¤šæ•°ï¼ŒDB å‹åŠ›å¯æ§ã€‚DB æŸ¥ä¸åˆ°æ—¶ï¼Œè¿”å›â€œé“¾æ¥ä¸å­˜åœ¨â€ç»™ç”¨æˆ·ã€‚\n\n\n\nQ: çŸ­é“¾æ¥å¦‚æœè¿‡æœŸäº†æˆ–è€…è¢«åˆ é™¤äº†ï¼Œå¸ƒéš†è¿‡æ»¤å™¨ä¸æ”¯æŒåˆ é™¤æ€ä¹ˆåŠï¼Ÿ\n\n\n_é«˜é¢‘è€ƒé¢˜ï¼š_å¸ƒéš†è¿‡æ»¤å™¨å¾ˆéš¾åˆ é™¤ã€‚\n\n\nè§£æ³•ï¼š 1. å¿å—è¯¯åˆ¤ï¼ˆé  DB å…œåº•ï¼‰ã€‚2. ä½¿ç”¨å¸ƒè°·é¸Ÿè¿‡æ»¤å™¨ï¼ˆCuckoo Filterï¼‰æ”¯æŒåˆ é™¤ã€‚3. å®šæœŸé‡å»ºå¸ƒéš†è¿‡æ»¤å™¨ã€‚\n\n\n\n\nQ: ä½ çš„Redis ç¼“å­˜è¿‡æœŸæ—¶é—´æ˜¯æ€ä¹ˆè®¾ç½®çš„ï¼Ÿæœ‰æ²¡æœ‰è€ƒè™‘çƒ­ç‚¹Key è¿‡æœŸå¯¼è‡´çš„â€œç¼“å­˜é›ªå´©â€ï¼Ÿ\n\nè§£æ³•ï¼š éšæœºè¿‡æœŸæ—¶é—´ï¼ˆRandom TTLï¼‰ï¼Œé¿å…åŒä¸€æ—¶åˆ»å¤§é¢ç§¯å¤±æ•ˆã€‚\n\n\n\n\nç¬¬ä¸‰ç»´åº¦ï¼šå¹¶å‘æ§åˆ¶ä¸SingleFlightï¼ˆæºç çº§æ‹·æ‰“ï¼‰\né’ˆå¯¹ä½ ç®€å†ä¸­çš„ï¼šâ€œåˆ©ç”¨Go SingleFlight åˆå¹¶çƒ­ç‚¹é“¾æ¥ç¬æ—¶å¹¶å‘è¯»è¯·æ±‚â€\n\n\nQ: SingleFlight æ˜¯æ€ä¹ˆåšåˆ°åˆå¹¶è¯·æ±‚çš„ï¼Ÿ ï¼ˆæºç é€»è¾‘ï¼‰\n\n\nå…³é”®è¯ï¼š map[key]*callï¼Œsync.WaitGroupã€‚\n\n\næµç¨‹ï¼š ç¬¬ä¸€ä¸ªè¯·æ±‚è¿›æ¥ï¼Œåˆ›å»ºä¸€ä¸ª call ç»“æ„ä½“æ”¾å…¥ mapï¼Œå¹¶åŠ é”ï¼›åç»­è¯·æ±‚å‘ç° map é‡Œæœ‰è¿™ä¸ª keyï¼Œå°± wg.Wait() ç­‰å¾…ï¼›ç¬¬ä¸€ä¸ªè¯·æ±‚æ‰§è¡Œå®Œï¼Œwg.Done()ï¼Œç»“æœå…±äº«ç»™æ‰€æœ‰ç­‰å¾…çš„è¯·æ±‚ã€‚\n\n\n\n\nQ: å¦‚æœé‚£ä¸ªâ€œé¢†å¤´â€çš„è¯·æ±‚ï¼ˆç¬¬ä¸€ä¸ªè¯·æ±‚ï¼‰æŒ‚äº†æˆ–è€…è¶…æ—¶äº†ï¼Œåé¢çš„è¯·æ±‚æ€ä¹ˆåŠï¼Ÿ\n\n\n_æ·±å‘ï¼š_å¯èƒ½ä¼šå¯¼è‡´æ‰€æœ‰ç­‰å¾…çš„è¯·æ±‚ä¸€èµ·æ­»é”æˆ–è¶…æ—¶ã€‚\n\n\nè§£æ³•ï¼š ä½¿ç”¨ DoChan é…åˆ select è¶…æ—¶æ§åˆ¶ï¼Œæˆ–è€…åœ¨ Do å†…éƒ¨é€»è¾‘é‡Œåšå¥½è¶…æ—¶å¤„ç†ã€‚\n\n\n\n\nQ: SingleFlight é€‚åˆä»€ä¹ˆåœºæ™¯ï¼Ÿå†™è¯·æ±‚èƒ½ç”¨å—ï¼Ÿ\n\nå›ç­”ï¼š åªé€‚åˆè¯»åœºæ™¯ï¼ˆä¸”æ˜¯å¹‚ç­‰çš„è¯»ï¼‰ã€‚å†™è¯·æ±‚ä¸èƒ½åˆå¹¶ï¼Œå¦åˆ™æ•°æ®å°±ä¹±äº†ã€‚\n\n\n\n\nç¬¬å››ç»´åº¦ï¼šæ•°æ®åº“ä¸å­˜å‚¨ï¼ˆå­—èŠ‚æœ€çˆ±ï¼‰\né’ˆå¯¹ä½ ç®€å†ä¸­çš„ï¼šâ€œMySQL Snowflakeâ€¦ è§£å†³åˆ†åº“åˆ†è¡¨å†²çªâ€\n+1\n\n\nQ: ä½ çš„MySQL è¡¨ç»“æ„æ˜¯æ€ä¹ˆè®¾è®¡çš„ï¼Ÿ\n\n\nå…³é”®ç‚¹ï¼š short_code (ä¸»é”®/å”¯ä¸€ç´¢å¼•), original_url, created_at, expiration_timeã€‚\n\n\nç´¢å¼•ï¼š short_codeè‚¯å®šè¦åŠ ç´¢å¼•ã€‚\n\n\n\n\nQ: ä½ è¯´è§£å†³åˆ†åº“åˆ†è¡¨å†²çªï¼Œé‚£ä½ å…·ä½“æ˜¯æ€ä¹ˆåˆ†åº“åˆ†è¡¨çš„ï¼Ÿåˆ†ç‰‡é”®ï¼ˆSharding Keyï¼‰æ˜¯è°ï¼Ÿ\n\né€»è¾‘ï¼š å¦‚æœç”¨ short_code æŸ¥ï¼Œå°±ç”¨ short_code åšåˆ†ç‰‡é”®ã€‚å¦‚æœæ˜¯ Snowflake IDï¼Œå¯ä»¥ç›´æ¥æ¨¡è¿ç®—åˆ†è¡¨ã€‚\n\n\n\nQ: ä»€ä¹ˆæ˜¯è¦†ç›–ç´¢å¼•ï¼Ÿåœ¨ä½ çš„çŸ­é“¾æŸ¥è¯¢é‡Œæ€ä¹ˆç”¨åˆ°ï¼Ÿ\n\nåœºæ™¯ï¼š å¦‚æœ SQL æ˜¯ select original_url from table where short_code = ?ï¼Œå¯ä»¥ç»™ (short_code, original_url) å»ºè”åˆç´¢å¼•ï¼Œè¿™æ ·å°±ä¸ç”¨å›è¡¨äº†ã€‚\n\n\n\n\nç¬¬äº”ç»´åº¦ï¼šæç«¯åœºæ™¯ä¸ç³»ç»Ÿç¨³å®šæ€§ï¼ˆå‹åŠ›é¢ï¼‰\n\n\nQ: å¦‚æœRedis æ•´ä¸ªæŒ‚äº†ï¼Œä½ çš„ç³»ç»Ÿä¼šå´©å—ï¼Ÿæ€ä¹ˆé™çº§ï¼Ÿ\n\nå›ç­”ï¼š å¼€å¯ Redis çš„é«˜å¯ç”¨ï¼ˆSentinel/Clusterï¼‰ã€‚å¦‚æœçœŸå…¨æŒ‚äº†ï¼Œä½¿ç”¨æœ¬åœ°ç¼“å­˜ï¼ˆGo sync.Map æˆ– BigCacheï¼‰åšä¸€çº§ç¼“å­˜ï¼Œé™æµä¿æŠ¤ DBã€‚\n\n\n\nQ: åŒä¸€ä¸ªé•¿é“¾æ¥ç”Ÿæˆå¤šæ¬¡ï¼Œæ˜¯è¿”å›åŒä¸€ä¸ªçŸ­é“¾ï¼Œè¿˜æ˜¯ç”Ÿæˆæ–°çš„ï¼Ÿ\n\n\nä¸šåŠ¡é€»è¾‘é¢˜ï¼š\n\n\næ–¹æ¡ˆAï¼ˆçœç©ºé—´ï¼‰ï¼šæŸ¥è¡¨ï¼Œæœ‰äº†å°±è¿”å›æ—§çš„ï¼ˆéœ€è¦ç»™é•¿é“¾å»ºç´¢å¼•ï¼Œå†™æ€§èƒ½ä½ï¼‰ã€‚\n\n\næ–¹æ¡ˆBï¼ˆé«˜æ€§èƒ½ï¼‰ï¼šç›´æ¥ç”Ÿæˆæ–°çš„ï¼ˆä¼šæœ‰ç©ºé—´æµªè´¹ï¼Œä½†ä¹Ÿæ˜¯ä¸€ç§é€‰æ‹©ï¼‰ã€‚çœ‹ä½ é¡¹ç›®æ€ä¹ˆå®ç°çš„ï¼Œè‡ªåœ†å…¶è¯´å³å¯ã€‚\n\n\n\n\n\n\nQ: æ¶æ„ç”¨æˆ·ç–¯ç‹‚è¯·æ±‚ä¸å­˜åœ¨çš„çŸ­é“¾æ¥ï¼ˆæ”»å‡»ï¼‰ï¼Œä½ çš„ç³»ç»Ÿæ€ä¹ˆé˜²ï¼Ÿ\n\nå›ç­”ï¼š è¿™å°±æ˜¯ç¼“å­˜ç©¿é€ï¼Œæˆ‘çš„å¸ƒéš†è¿‡æ»¤å™¨å°±æ˜¯å¹²è¿™ä¸ªçš„ï¼é…åˆ Nginx é™æµï¼ˆRate Limitingï¼‰ã€‚\n\n\n\nQ: ä½ çš„QPS å¤§æ¦‚æ˜¯å¤šå°‘ï¼Ÿä½ æ˜¯æ€ä¹ˆå‹æµ‹çš„ï¼Ÿ\n\n\næ•°æ®ï¼š åˆ«çç¼–ã€‚å•æœº Go + Redis è½»æ¾ä¸Šä¸‡ã€‚\n\n\nå·¥å…·ï¼š å³ä½¿æ²¡æµ‹è¿‡ï¼Œä¹Ÿè¦è¯´ï¼šâ€œæˆ‘ä½¿ç”¨ wrk æˆ– JMeter è¿›è¡Œå‹æµ‹â€¦â€\n\n\n\n"},"æŠ€æœ¯ç§¯ç´¯/é¡¹ç›®/01-çŸ­é“¾æ¥/ä¼˜åŒ–æ€»è§ˆ":{"slug":"æŠ€æœ¯ç§¯ç´¯/é¡¹ç›®/01-çŸ­é“¾æ¥/ä¼˜åŒ–æ€»è§ˆ","filePath":"æŠ€æœ¯ç§¯ç´¯/é¡¹ç›®/01 çŸ­é“¾æ¥/ä¼˜åŒ–æ€»è§ˆ.md","title":"ä¼˜åŒ–æ€»è§ˆ","links":[],"tags":[],"content":"æ ¸å¿ƒæ€æƒ³\n\nç”¨æˆ·è¾“å…¥ä¸€ä¸ªå¾ˆé•¿çš„ç½‘å€ï¼ˆæ¯”å¦‚ï¼šwww.google.com/searchï¼‰\nç³»ç»Ÿç”Ÿæˆä¸€ä¸ªçŸ­ç ï¼ˆæ¯”å¦‚ï¼šabc123ï¼‰\nç”¨æˆ·è®¿é—®çŸ­é“¾æ¥ï¼ˆæ¯”å¦‚ï¼šhttp://ä½ çš„åŸŸå/abc123ï¼‰\nç³»ç»Ÿè‡ªåŠ¨è·³è½¬åˆ°åŸå§‹é•¿ç½‘å€\n\n\nå½“æˆ‘ä»¬åœ¨æµè§ˆå™¨é‡Œè¾“å…¥ dwz.cn/XzhYJMkZ\nDNSé¦–å…ˆè§£æè·å¾— dwz.cn/ çš„ IP åœ°å€\nå½“ DNS è·å¾— IP åœ°å€ä»¥åï¼Œä¼šå‘è¿™ä¸ªåœ°å€å‘é€ HTTPè¯·æ±‚ï¼ŒæŸ¥è¯¢çŸ­ç  XzhYJMkZ\ndwz.cn/ æœåŠ¡å™¨ä¼šé€šè¿‡çŸ­ç  XzhYJMkZ è·å–å¯¹åº”çš„é•¿ URL\nè¯·æ±‚é€šè¿‡ HTTP 301 è½¬åˆ°å¯¹åº”çš„é•¿ URL www.baidu.com\n\né¡¹ç›®ç»“æ„\n\n\nmain.go ç¨‹åºå…¥å£ å¯åŠ¨æ•´ä¸ªæœåŠ¡\n\n\nbase åŸºç¡€å±‚ åŒ…æ‹¬åˆå§‹åŒ–é…ç½® æ•°æ®åº“ å·¥å…·\n\n\nconf é…ç½®æ–‡ä»¶\n\n\ncontroller æ§åˆ¶å™¨å±‚ å¤„ç†httpè¯·æ±‚\n\n\nmodel æ¨¡å‹å±‚ ä¸šåŠ¡é€»è¾‘ åŒ…æ‹¬åºåˆ—ç”Ÿæˆå™¨å’ŒçŸ­é“¾æ¥ä¸šåŠ¡é€»è¾‘\n\n\nserver æœåŠ¡å™¨å±‚,åŒ…æ‹¬è·¯ç”±å’ŒhttpæœåŠ¡\n\n\ncontroller: åªè´Ÿè´£æ¥æ”¶httpè¯·æ±‚å’Œè§£æå‚æ•°\n\n\nservice è´Ÿè´£æ ¸å¿ƒé€»è¾‘ åŒ…æ‹¬é›ªèŠ±ç®—æ³•ç”Ÿæˆå’Œå¸ƒéš†è¿‡æ»¤åˆ¤æ–­\n\n\nmodel åªè´Ÿè´£å­˜å–æ•°æ®åº“/redis\n\nController è°ƒ Serviceã€‚\nService è°ƒ Modelã€‚\nä¸èƒ½è®© Model å»è°ƒ Controllerï¼ˆè¿™å°±æ˜¯å¾ªç¯å¼•ç”¨ï¼ŒGo ç¼–è¯‘å™¨ä¼šæŠ¥é”™ï¼‰\n\n\n\nbase62è¿›åˆ¶è½¬æ¢ ç¼©çŸ­URLé•¿åº¦\nå¾—åˆ°çš„æœ€çŸ­è€Œä¸”å†²çªç‡ä½\nTenToAny(1000000, 62) â‡’ â€œ4c92â€\nGORMä¸XORM\nORM object relational mapping\nç”¨æ“ä½œç»“æ„ä½“çš„æ–¹å¼æ¥æ“ä½œæ•°æ®åº“ï¼Œè€Œä¸éœ€è¦å¤æ‚çš„æ‰‹å†™SQLè¯­å¥\nâ€œåŸæ¥çš„ Baseline ä½¿ç”¨ XORMï¼Œæˆ‘è€ƒè™‘åˆ°åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œå¤æ‚çš„ ORM åå°„å¸¦æ¥çš„æ€§èƒ½å¼€é”€è¾ƒå¤§ã€‚æˆ‘å¯¹æ¯”äº† GORM V2 çš„æ€§èƒ½æ”¹è¿›ï¼Œå¹¶æœ€ç»ˆå†³å®šåœ¨æ ¸å¿ƒè¯»å†™è·¯å¾„ä¸Šä½¿ç”¨åŸç”Ÿçš„ sqlx æˆ– sqlcï¼Œè€Œåœ¨åå°ç®¡ç†ç•Œé¢ä½¿ç”¨ GORMã€‚è¿™ç§â€˜è¯»å†™åˆ†ç¦»ã€å·¥å…·åˆ†ç¦»â€™çš„è®¾è®¡æ›´ç¬¦åˆé«˜æ€§èƒ½åœºæ™¯ã€‚â€\næœåŠ¡\ngin webæ¡†æ¶\nginæ˜¯goè¯­è¨€é‡Œé¢æœ€æµè¡Œçš„webæ¡†æ¶.\n\nå½“ç”¨æˆ·åœ¨æµè§ˆå™¨è¾“å…¥ç½‘å€è¯·æ±‚,ginè´Ÿè´£æ¥æ”¶è¯·æ±‚\nè§£æå‚æ•°\næŠŠç»“æœæ‰“åŒ…å‘å›ç»™ç”¨æˆ·.\næ›¿ä»£äº†æ‰‹å†™è§£æhttpåè®®å“ªäº›ç¹ççš„åº•å±‚ä»£ç \n\nmysql æ•°æ®åº“\nå…³ç³»å‹æ•°æ®åº“ è´Ÿè´£æ°¸ä¹…å­˜å‚¨æ•°æ®\n\nä¸ºäº†æŠŠé•¿é“¾æ¥å­˜è¿›æ•°æ®åº“,æˆ‘ä»¬éœ€è¦ç»™å®ƒä¸€ä¸ªå”¯ä¸€id,ç„¶åæŠŠè¿™ä¸ªidè½¬æˆçŸ­ç .å¦‚æœç”¨è‡ªå¢id,å®¹æ˜“è¢«çŒœå‡ºæ€»å…±æœ‰å¤šå°‘æ•°æ®,è€Œä¸”å¦‚æœæœ‰å¤šä¸ªæ•°æ®åº“,idå°±ä¼šé‡å¤.\n\nsnowflake\ntwitterå‘æ˜çš„ä¸€ç§ç®—æ³•\n\nä¸é‡å¤: åˆ©ç”¨æ—¶é—´æˆ³+æœºå™¨ç¼–å·+åºåˆ—å·ç”Ÿæˆä¸€ä¸ª64ä½æ•´æ•°,å¯ä»¥åšåˆ°å…¨çƒå”¯ä¸€\næœ‰åº: å¹¶ä¸”æ€»ä½“ä¸Šæ˜¯éšæ—¶é—´é€’å¢çš„,å¯¹æ•°æ®åº“ç´¢å¼•æ¯”è¾ƒçš„å‹å¥½.\né«˜æ€§èƒ½: è€Œä¸”æœ¬åœ°ç”Ÿæˆ,ä¸éœ€è¦è”ç½‘æŸ¥è¯¢æ•°æ®åº“,é€Ÿåº¦å¾ˆå¿«.\nç¬¦å·ä½+41ä½æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰+10ä½æœºå™¨id+12ä½åºåˆ—å·ï¼ˆåŒæ¯«ç§’å†…åºåˆ—ï¼‰\n\n\nç¬¦å·ä½å§‹ç»ˆä¸º0\n41ä½æ—¶é—´æˆ³å¯ç”¨69å¹´ï¼ˆåŸºäºè®¾å®šçš„starttimeçš„ç›¸å¯¹æ—¶é—´ï¼‰\næ”¯æŒ1024å°æœºå™¨\nåŒä¸€æ¯«ç§’å†…å¯ç”Ÿæˆ4096ä¸ªid\n\nredis ç¼“å­˜\nå†…å­˜æ•°æ®åº“ é€Ÿåº¦æå¿«æ¯”mysqlå¿«å‡ ä¸‡å€,ä½†æ˜¯æ–­ç”µå¯èƒ½ä¼šä¸¢å¤±éƒ¨åˆ†æ•°æ®,æ‰€ä»¥ä¸»è¦å½“ä½œç¼“å­˜åœ¨ä½¿ç”¨.\nå› ä¸ºçŸ­é“¾æ¥ä¸šåŠ¡æ˜¯è¯»å¤šå†™å°‘,ç”Ÿæˆä¸€æ¬¡,å¯èƒ½ä¼šè¢«å‡ ä¸‡äººç‚¹å‡»è®¿é—®,å¦‚æœéƒ½å»æŸ¥mysqlä¼šè¢«æŒ¤çˆ†ç‚¸,æ‰€ä»¥å¼•å…¥redisæ¥æŠ—å¹¶å‘\nå¸ƒéš†è¿‡æ»¤å™¨ bloom filter\n\nå¦‚æœé»‘å®¢ç–¯ç‹‚è¯·æ±‚ä¸€å †ä¸å­˜åœ¨çš„çŸ­é“¾æ¥,redisæŸ¥ä¸åˆ°mysqlä¹ŸæŸ¥ä¸åˆ°,å¤§é‡çš„ç©ºè¯·æ±‚ç›´æ¥æ‰“ç©¿rediså‹åœ¨mysqlä¸Š,æ•°æ®åº“ç›´æ¥æŒ‚æ‰,å«åšç¼“å­˜ç©¿é€.\n\næ˜¯ä¸€ä¸ªèŠ‚çœå†…å­˜çš„æ•°æ®ç»“æ„,å®ˆåœ¨æœ€å‰é¢,å¦‚æœä»–è¯´ä¸åœ¨,é‚£å°±è‚¯å®šä¸åœ¨,æŠŠè¯·æ±‚é©³å›,ä¸æŸ¥è¯¢rediså’Œmysqläº†.\nSingleFlight\n\nå¦‚æœæŸä¸ªçŸ­é“¾æ¥åŒä¸€ç§’é’Ÿæœ‰ä¸€ä¸‡äººç‚¹å‡»,åˆšå¥½è¿™æ—¶å€™redisé‡Œé¢è¿™ä¸ªé“¾æ¥çš„ç¼“å­˜è¿‡æœŸäº†,é‚£ä¹ˆåˆè¾¾æˆäº†ç¼“å­˜å‡»ç©¿.\n\nsingleflightæ˜¯goå®˜æ–¹çš„ä¸€ä¸ªåº“,å½“ä¸€ä¸‡ä¸ªè¯·æ±‚åŒæ—¶æ¥çš„æ—¶å€™,singleflightä¼šæŒ¡ä½ä»–ä»¬,åªæ”¾ç¬¬ä¸€ä¸ªäººæŸ¥è¯¢æ•°æ®åº“"},"æŠ€æœ¯ç§¯ç´¯/é¡¹ç›®/01-çŸ­é“¾æ¥/å‹æµ‹":{"slug":"æŠ€æœ¯ç§¯ç´¯/é¡¹ç›®/01-çŸ­é“¾æ¥/å‹æµ‹","filePath":"æŠ€æœ¯ç§¯ç´¯/é¡¹ç›®/01 çŸ­é“¾æ¥/å‹æµ‹.md","title":"å‹æµ‹","links":[],"tags":[],"content":"çº¯cpuå†…å­˜è®¡ç®—ï¼š\né›ªèŠ±ç®—æ³•ã€å¸ƒéš†è¿‡æ»¤å™¨ã€‚ä¸èµ°ç½‘ç»œä¸è¯»ç¡¬ç›˜ï¼Œè¿™æ—¶å€™qpså¤§æ¦‚æ˜¯ä¸€ç™¾ä¸‡åˆ°äº”ç™¾ä¸‡\né›ªèŠ±ç®—æ³•å°±æ˜¯ç®€å•çš„ä½è¿ç®—ï¼Œå¯¹gpså‡ ä¹æ²¡æœ‰è´Ÿé¢å½±å“\nå¸ƒéš†è¿‡æ»¤å™¨æŒ¡ä½äº†å»æ•°æ®åº“çš„è¯·æ±‚ï¼Œå¯ä»¥æå‡gps\nå†…å­˜+ç½‘ç»œio\nredisï¼š æ•°æ®åœ¨å†…å­˜é‡Œï¼Œä½†æ˜¯éœ€è¦tcpç½‘ç»œè¿æ¥å»æˆ–è®¸ qpså¤§æ¦‚åœ¨å‡ ä¸‡å·¦å³ã€‚å•æœºçš„è¯å°±æ˜¯5åˆ°8wå·¦å³\nç£ç›˜io\nmysqlï¼š å› ä¸ºæ•°æ®åœ¨ç¡¬ç›˜ä¸Šï¼Œæ¶‰åŠåˆ°ç£ç›˜å¯»é“æˆ–è€…ssdio æ˜¯å¾ˆæ…¢çš„ï¼Œå¤§æ¦‚å‡ ç™¾åˆ°å‡ åƒã€‚å¦‚æœæ˜¯å•æœºç®€å•çš„selectå°±æ˜¯ä»¥å‰åˆ°ä¸¤åƒqps"},"æŠ€æœ¯ç§¯ç´¯/é¡¹ç›®/01-çŸ­é“¾æ¥/é›ªèŠ±ç®—æ³•snowflake":{"slug":"æŠ€æœ¯ç§¯ç´¯/é¡¹ç›®/01-çŸ­é“¾æ¥/é›ªèŠ±ç®—æ³•snowflake","filePath":"æŠ€æœ¯ç§¯ç´¯/é¡¹ç›®/01 çŸ­é“¾æ¥/é›ªèŠ±ç®—æ³•snowflake.md","title":"é›ªèŠ±ç®—æ³•snowflake","links":[],"tags":[],"content":"å½“å‰æ–¹æ¡ˆä¸é—®é¢˜\n\nä½¿ç”¨ Redis INCR ç”Ÿæˆè‡ªå¢ ID\né€šè¿‡ Base62 ç¼–ç å°†æ•°å­— ID è½¬æ¢ä¸ºçŸ­ç \n\næ€§èƒ½ç“¶é¢ˆ:æ¯æ¬¡ç”Ÿæˆidéƒ½è¦è®¿é—®redis,ç½‘ç»œå»¶è¿Ÿå½±å“æ€§èƒ½[ä¸€æ¬¡ Redis è¯·æ±‚å¾€è¿”ï¼ˆRTTï¼‰é€šå¸¸éœ€è¦ 1-5 æ¯«ç§’ã€‚]\nredisæ•…éšœä¼šå¯¼è‡´idç”Ÿæˆå¤±è´¥\næ— æ³•æ”¯æŒåˆ†åº“åˆ†è¡¨: æ•°æ®é‡å¤ªå¤§ä¼šéœ€è¦åˆ†åº“åˆ†è¡¨,ä½†æ˜¯å¦‚æœç”¨è‡ªå¢id,åœ¨ä¸¤ä¸ªæ•°æ®åº“ä¹‹é—´å¾ˆéš¾ç´¢å¼•äº†.\n\nä¸­å¿ƒåŒ–:æ‰€æœ‰æœåŠ¡å™¨èŠ‚ç‚¹éƒ½å‘åŒä¸€ä¸ªredisè¦id\n\næ‰©å±•æ€§å·®,é«˜å¹¶å‘ä¸‹redisæˆä¸ºç“¶é¢ˆ,å•å°redisçš„ååé‡æ˜¯æœ‰ä¸Šé™çš„,è€Œä¸”å¤„ç†ä¸€ä¸ªè‡ªå¢idä»»åŠ¡,æ˜¯æ— æ³•ç”¨clusteré›†ç¾¤å»åšçš„,åªèƒ½ç»‘å®šåœ¨ä¸€ä¸ªkeyä¹Ÿå°±æ˜¯ä¸€å°æœºå™¨ä¸Š.\nä¼˜åŒ–\nrediså»æ‰¹é‡é¢„å–\né›ªèŠ±ç®—æ³•:ç›®å‰åˆ†å¸ƒå¼ç³»ç»Ÿæœ€ä¸»æµçš„æ–¹æ¡ˆ:å®Œå…¨å»ä¸­å¿ƒåŒ–\n\næœ¬åœ°ç”Ÿæˆï¼šæ— éœ€è®¿é—® Redisï¼Œæ€§èƒ½æå‡ 100+ å€\nåˆ†å¸ƒå¼æ”¯æŒï¼šæ¯ä¸ªå®ä¾‹ç‹¬ç«‹ç”Ÿæˆå”¯ä¸€ IDï¼Œæ”¯æŒåˆ†åº“åˆ†è¡¨\né«˜å¯ç”¨æ€§ï¼šä¸ä¾èµ–å¤–éƒ¨æœåŠ¡ï¼Œå•æœºä¹Ÿèƒ½å·¥ä½œ\næ€§èƒ½æå‡ï¼šä» Redis ç½‘ç»œè°ƒç”¨ï¼ˆ1-5msï¼‰æå‡åˆ°æœ¬åœ°å†…å­˜æ“ä½œï¼ˆ&lt;1Î¼sï¼‰\n\nå…¶ä»–å”¯ä¸€idç”Ÿæˆæ³•\nUUID\nåŸºäºmacåœ°å€æ—¶é—´æˆ³å’Œéšæœºæ•°ç”Ÿæˆçš„128ä½å­—ç¬¦ä¸²,å¤ªé•¿è€Œä¸”æ— åº,è€Œä¸”è½¬æ¢æˆ62è¿›åˆ¶è¿˜æ˜¯å¾ˆé•¿\nç¾å›¢leaf\nRedis æ‰¹é‡é¢„å–çš„å‡çº§ç‰ˆã€‚å®ƒç›´æ¥ä»æ•°æ®åº“ï¼ˆMySQLï¼‰æ‰¹é‡æ‹‰å– ID å·æ®µç¼“å­˜åˆ°å†…å­˜ã€‚å®ƒä½¿ç”¨äº†â€œåŒç¼“å­˜â€æŠ€æœ¯ã€‚å½“å†…å­˜ä¸­ç¬¬ä¸€ä¸ªå·æ®µç”¨æ‰ 10% æ—¶ï¼Œå®ƒä¼šå¼‚æ­¥å»åŠ è½½ä¸‹ä¸€ä¸ªå·æ®µï¼Œä¿è¯ä¸šåŠ¡å–å·æ—¶æ°¸è¿œä¸éœ€è¦ç­‰å¾…ç½‘ç»œ IOã€‚\nç™¾åº¦uidgenerater\nä¹Ÿæ˜¯é›ªèŠ±ç®—æ³•çš„å˜ç§ï¼Œä½†å®ƒæ”¯æŒâ€œå€Ÿç”¨â€æœªæ¥æ—¶é—´ã€‚å¦‚æœå½“å‰ç§’çš„ ID ç”¨å®Œäº†ï¼Œå®ƒå¯ä»¥é¢„æ”¯ä¸‹ä¸€ç§’çš„ã€‚\nå®ç°\n\nå¯åŠ¨æ—¶.init :NewSnowflakeGenerator()\nå°è¯•ä»redisæŠ¢å æœºå™¨id\n\næˆåŠŸ å¯åŠ¨å¿ƒè·³ç»­æœŸ\nå¤±è´¥ å¯åŠ¨æœ¬åœ°ipé™çº§ç­–ç•¥\n\n\nGetBorrowOrder,ä¼˜å…ˆä½¿ç”¨Snowflake.GetId(),å¦‚æœä¸å¯ç”¨,é™çº§åˆ°redisincrè‡ªå¢\né€€å‡ºçš„æ—¶å€™,æ”¶åˆ°ä¿¡å·,å°±è°ƒç”¨sequence.Release,é‡Šæ”¾redisä¸­çš„æœºå™¨id\n\næœ‰ä¸¤æ¬¡é™çº§å¤„ç†:\né™çº§ç­–ç•¥1ï¼šRedis æœºå™¨IDåˆ†é…å¤±è´¥ â†’ ä½¿ç”¨æœ¬åœ°IPè®¡ç®—æœºå™¨ID\nè§¦å‘æ¡ä»¶ï¼š\n\nRedis è¿æ¥å¤±è´¥ï¼ˆç½‘ç»œé—®é¢˜ã€Rediså®•æœºï¼‰\n\n\nacquireMachineID()Â ä¸­çš„Â r.SetNX()Â è¿”å›é”™è¯¯\n\n\næ‰€æœ‰æœºå™¨IDéƒ½è¢«å ç”¨ï¼ˆ1024ä¸ªå®ä¾‹éƒ½åœ¨è¿è¡Œï¼‰\n\n\néå† 0-1023 éƒ½å¤±è´¥ï¼Œè¿”å›Â â€œall machine IDs are occupiedâ€\n\né™çº§åçš„è¡Œä¸ºï¼š\n\n\nä»ä½¿ç”¨ SnowflakeÂ ç®—æ³•ç”ŸæˆID\n\n\næœºå™¨IDé€šè¿‡æœ¬åœ°IPçš„hashå€¼è®¡ç®—ï¼ˆ0-1023ï¼‰\n\n\nä¸å†å¯åŠ¨å¿ƒè·³ç»­æœŸï¼ˆå› ä¸ºRedisä¸å¯ç”¨æˆ–ä¸éœ€è¦ï¼‰\n\n\nä¸åŒIPçš„hashå€¼å–æ¨¡1024åå¯èƒ½ç›¸åŒï¼ˆæ¦‚ç‡çº¦ 1/1024ï¼‰\n\n\nä¸€å°ç”¨Redisåˆ†é…ï¼Œä¸€å°ç”¨æœ¬åœ°IPï¼Œæœºå™¨IDå¯èƒ½ç›¸åŒ\nä½†æ˜¯æ—¶é—´æˆ³å’Œåºåˆ—å·ä¸€èˆ¬ä¸åŒ,æƒ³è¦åŒæ—¶ç›¸åŒè¿˜æ˜¯å¾ˆæœ‰éš¾åº¦..\nä½†æ˜¯k8sçš„æ—¶å€™,K8s å¯ä»¥åœ¨ä¸€ç§’å†…æ‹‰èµ·å‡ åä¸ª Podã€‚å¦‚æœè¿™äº› Pod è·‘åœ¨åŒä¸€å°å®¿ä¸»æœºä¸Šï¼Œå®ƒä»¬çœ‹åˆ°çš„ç³»ç»Ÿæ—¶é’Ÿæ˜¯å®Œå…¨ä¸€è‡´çš„ã€‚æ¯ä¸ª Pod çš„åºåˆ—å·ï¼ˆSequenceï¼‰åœ¨å†…å­˜é‡Œéƒ½æ˜¯ä» 0 å¼€å§‹çš„ã€‚é‚£ä¹ˆ,è¦æƒ³idå·®å¼‚åŒ–å°±å¾—å…¨éƒ¨ä¾èµ–æœºå™¨id.é‚£ä¹ˆå°±æ¢ä¸€äº›å¤æ‚çš„å“ˆå¸Œç®—æ³•,ä»¥åŠåŠ å…¥hostname(podåç§°è‡ªå¸¦å”¯ä¸€åç¼€)\n\n\nå›æ‹¨: å°äºé˜ˆå€¼ç¡çœ ,å¤§äºé˜ˆå€¼æŠ¥é”™,å¹¶ä¸”å…œåº•:å°±æ˜¯ç›´æ¥å¼ºè¡Œå¢åŠ æ—¶é—´æˆ³.\né™çº§ç­–ç•¥2ï¼šSnowflake åˆå§‹åŒ–å®Œå…¨å¤±è´¥ â†’ ä½¿ç”¨ Redis INCR\nè§¦å‘æ¡ä»¶ï¼š\n\nNewSnowflakeGenerator()Â è¿”å›é nil é”™è¯¯\nå½“å‰å®ç°ä¸­å‡ ä¹ä¸ä¼šå‘ç”Ÿ\né™çº§åçš„è¡Œä¸ºï¼š\nä¸å†ä½¿ç”¨ Snowflake\nå®Œå…¨å›é€€åˆ° Redis INCR è‡ªå¢\n\né›ªèŠ±ç®—æ³•çš„é—®é¢˜\n\næ—¶é’Ÿå›æ‹¨ å¦‚æœæœºå™¨æ—¶é—´å›é€€,é‚£ä¹ˆé€šå¸¸åªèƒ½æŠ¥é”™æˆ–è€…æ­»ç­‰,ç›´åˆ°è¿½å›æ­£å¸¸æ—¶é—´.\næœºå™¨idç®¡ç†,åœ¨Docker/k8sçš„æƒ…å†µä¸‹,å®¹å™¨æ˜¯åŠ¨æ€é”€æ¯å’Œå¯åŠ¨çš„,å¦‚ä½•ä¿è¯æ‹¿åˆ°ä¸é‡å¤çš„workid\n\n\nå¦‚ä½•ä¿è¯? å®¹å™¨å¯åŠ¨çš„æ—¶å€™,å»redisæŠ¢å ä¸€ä¸ªè¿˜æ²¡è¢«å ç”¨çš„id,èµ°çš„æ—¶å€™é‡Šæ”¾æ‰\næˆ–è€…åˆ©ç”¨k8séƒ¨ç½²çš„æ—¶å€™,æ‰‹åŠ¨ç»™æ¯ä¸ªå®ä¾‹æ³¨å…¥ä¸åŒçš„workidå˜é‡\n\n\nidè§„å¾‹æ€§å¤ªå¼º èƒ½å¤Ÿç›´æ¥åæ¨å‡ºç”Ÿæˆæ—¶é—´\n\né—®é¢˜\n\nä¸ºä»€ä¹ˆä½ è§‰å¾— Snowflake IDï¼ˆ19ä½ï¼‰å’Œ Redis IDï¼ˆä»1å¼€å§‹ï¼‰ä¸ä¼šå†²çªï¼Ÿå¦‚æœé¡¹ç›®è¿è¡Œäº†å¾ˆä¹…ï¼ŒRedis ID ä¹Ÿé•¿åˆ°äº† 19 ä½å‘¢ï¼Ÿ\n\n\nè¿™æ˜¯ä¸€ä¸ªæ•°å­¦è§„æ¨¡é—®é¢˜ã€‚Redis ID è¦è¾¾åˆ° 19 ä½ï¼ˆå³ 10 çš„ 18 æ¬¡æ–¹çº§åˆ«ï¼‰ï¼Œå³ä¾¿æ¯ç§’ç”Ÿæˆ 100 ä¸‡ä¸ª IDï¼Œä¹Ÿéœ€è¦ 3 ä¸‡å¹´ æ‰èƒ½è¾¾åˆ°è¿™ä¸ªæ•°å­—ã€‚\nè€Œ Snowflake ID å› ä¸ºèµ·å§‹æ—¶é—´æˆ³çš„å­˜åœ¨ï¼Œå¤©ç”Ÿå°±ä» 10 çš„ 18 æ¬¡æ–¹å·¦å³å¼€å§‹ã€‚å› æ­¤ï¼Œåœ¨å¯é¢„è§çš„å‡ åƒå¹´å†…ï¼Œä¸¤è€…çš„æ•°å€¼ç©ºé—´æ˜¯äº’ä¸é‡å çš„ã€‚\n\n\nå¦‚æœredisè¿è¡Œä¸­æŒ‚äº†,å¿ƒè·³ç»­æœŸå¤±è´¥æ€ä¹ˆåŠ?åˆ«äººä¼šæŠ¢å è¿™ä¸ªid.ä½†æ˜¯æœºå™¨idéƒ½æ˜¯ä¸€å¼€å§‹è¿è¡Œå°±ç”³è¯·å¥½,æ‰€ä»¥åŸæœ¬çš„ä¹Ÿä¸ä¼šå‘ç°\n\n"},"æŠ€æœ¯ç§¯ç´¯/é¡¹ç›®/01-çŸ­é“¾æ¥/é¡¹ç›®æµç¨‹":{"slug":"æŠ€æœ¯ç§¯ç´¯/é¡¹ç›®/01-çŸ­é“¾æ¥/é¡¹ç›®æµç¨‹","filePath":"æŠ€æœ¯ç§¯ç´¯/é¡¹ç›®/01 çŸ­é“¾æ¥/é¡¹ç›®æµç¨‹.md","title":"é¡¹ç›®æµç¨‹","links":[],"tags":[],"content":"çŸ­é“¾æ¥ç”Ÿæˆ\nç”¨æˆ·è¾“å…¥é•¿é“¾æ¥,è‡ªåŠ¨ç”ŸæˆçŸ­ç .ç”¨æˆ·è®¿é—®çŸ­é“¾æ¥,ç³»ç»Ÿè·³è½¬åˆ°é•¿é“¾æ¥.\n\nç³»ç»Ÿè‡ªåŠ¨åˆ†é…çŸ­ç \nç”¨æˆ·è‡ªå®šä¹‰çŸ­ç \nåŒä¸€é•¿é“¾æ¥å¤„ç†:é‡å¤ç”Ÿæˆè¿”å›å·²æœ‰çŸ­ç \n\n\n1. HTTP POST /v1/create_url\nÂ  Â â†“\n2. server/route.go ç›‘å¬åˆ°è¯·æ±‚å¹¶è¿›è¡Œè·¯ç”±åˆ†å‘\nÂ  Â â†“\n3. controller/sequence.go â†’ CreateLink()\nÂ  Â â†“\n4. model/short_url/links.go â†’ CreateLinks()\nÂ  Â â”œâ”€â”€ 4.1 GetLinksByUrl() â†’ æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨\nÂ  Â â”œâ”€â”€ 4.2 ç³»ç»Ÿåˆ†é…æ¨¡å¼ï¼š\nÂ  Â â”‚ Â  â”œâ”€â”€ sequence.GetBorrowOrder() â†’ Redis INCR\nÂ  Â â”‚ Â  â””â”€â”€ tool.TenToAny() â†’ Base62ç¼–ç \nÂ  Â â””â”€â”€ 4.3 MySQL Insert â†’ æŒä¹…åŒ–\nÂ  Â â†“\n5. è¿”å›çŸ­é“¾æ¥ï¼šhttp://domain/{keyword}\n\nçŸ­é“¾æ¥è·³è½¬\n\næ ¹æ®çŸ­ç æŸ¥è¯¢å¯¹åº”é•¿è¿æ¥\nhttp301æ°¸ä¹…é‡å®šå‘\n404é”™è¯¯å¤„ç†\n\n1. HTTP GET /{keyword}\nÂ  Â â†“\n2. HTTPæœåŠ¡å™¨æ¥æ”¶è¯·æ±‚\nÂ  Â â†“\n3. CORSä¸­é—´ä»¶æ‰§è¡Œï¼ˆå·²æ³¨å†Œçš„ä¸­é—´ä»¶ï¼‰\nÂ  Â â†“\n4. Middlewareä¸­é—´ä»¶æ‰§è¡Œï¼ˆå·²æ³¨å†Œçš„ä¸­é—´ä»¶ï¼‰\nÂ  Â â”œâ”€â”€ æ£€æŸ¥è·¯å¾„ï¼šåŒ…å«&quot;create_url&quot;ï¼Ÿâ†’ å¦\nÂ  Â â”œâ”€â”€ æå– keywordï¼ˆå»é™¤&quot;/&quot;ï¼‰\nÂ  Â â”œâ”€â”€ model/short_url/links.go â†’ GetLinksByKeyword()\nÂ  Â â””â”€â”€ MySQL Select\nÂ  Â â†“\n5. 301 Redirect â†’ é•¿é“¾æ¥\n\n\nåˆ†å¸ƒå¼idç”Ÿæˆ\nredisåŸå­æ“ä½œ,ä¿è¯å…¨å±€å”¯ä¸€\nç»“æ„\nbase åŸºç¡€è®¾æ–½å±‚\n\nconfigæ•°æ®åº“é…ç½®ç®¡ç†(ä» .ini é…ç½®æ–‡ä»¶è¯»å–é…ç½®ï¼Œè§£æå¹¶æ˜ å°„åˆ°ç»“æ„ä½“)\ndbæ•°æ®åº“è¿æ¥ ç®¡ç†è¿æ¥æ± å’Œæ•°æ®åº“å®¢æˆ·ç«¯è·å–æ¥å£\nä»¥åŠä¸€äº›å·¥å…·å‡½æ•°\n\næ—¥å¿—ç®¡ç† zap+lumberjackæ»šåŠ¨æ—¥å¿—\né›ªèŠ±ç®—æ³•\nè¿›åˆ¶è½¬æ¢\n\n\n\nconf é…ç½®æ–‡ä»¶ç›®å½•\nä¼šè¢«baseå±‚è¯»å–,åŒ…æ‹¬æ•°æ®åº“é…ç½®å’Œå·¥å…·é…ç½®\ncontroller æ§åˆ¶å™¨å±‚\n\næ§åˆ¶å™¨åŸºç±»(ä¸€ä¸ªå®¹å™¨,è£…æ‰€æœ‰åŠŸèƒ½)\n\nä¾èµ–æ³¨å…¥æ¥å£(ä¹Ÿå°±æ˜¯è¯´ è¿™ä¸ªå®¹å™¨é‡Œçš„åŠŸèƒ½å¹¶ä¸æ˜¯ç›´æ¥å®ç°çš„,è€Œæ˜¯è°ƒç”¨æŸä¸ªæ¥å£çš„æ–¹æ³•.è¿™æ ·ä¹‹åå¦‚æœè¦æ¢ä¸šåŠ¡æ¯”è¾ƒæ–¹ä¾¿,ä¸ç”¨ä¿®æ”¹åŸºç±»ä»£ç )\nå•ä¾‹æ¨¡å¼åˆå§‹åŒ–(æ•´ä¸ªç¨‹åºåªæœ‰ä¸€ä¸ªå®¹å™¨å®ä¾‹ï¼Œä¸ä¼šé‡å¤åˆ›å»º)\n\n\nçŸ­é“¾æ¥åˆ›å»ºæ§åˆ¶å™¨\n\nè§£æ post create url è¡¨å•å‚æ•°\nè°ƒç”¨CreateLinks(åœ¨modelä¸šåŠ¡å±‚)å¤„ç†è¯·æ±‚\n\n\nhttpå“åº”å°è£…\n\næˆåŠŸå“åº”å°è£…\nå¤±è´¥å“åº”å°è£…\n\n\n\nmodel ä¸šåŠ¡é€»è¾‘å±‚\n\nåºåˆ—ç”Ÿæˆå™¨æ¨¡å—\n\nGetBorrowOrder()ï¼šä½¿ç”¨Redis INCRç”Ÿæˆå…¨å±€å”¯ä¸€è‡ªå¢ID\n\n\nçŸ­é“¾æ¥ä¸šåŠ¡æ¨¡å—\n\næ•°æ®æ¨¡å‹ç»“æ„ä½“\nåˆ›å»ºçŸ­é“¾æ¥ä¸šåŠ¡CreateLinks ä¸ºé•¿è¿æ¥ç”ŸæˆçŸ­é“¾æ¥\n\nåˆ¤æ–­é•¿è¿æ¥æ˜¯å¦å·²å­˜åœ¨\nç³»ç»Ÿåˆ†é… Redis INCR â†’ Base62ç¼–ç \nè‡ªå®šä¹‰\næŒä¹…åŒ–åˆ°mysql\næ·»åŠ åˆ°å¸ƒéš†è¿‡æ»¤å™¨bloomFilter.Add(keyword)\nè¿”å›çŸ­é“¾æ¥\n\n\næ ¹æ®é•¿è¿æ¥æŸ¥è¯¢GetLinksByUrl  æ£€æŸ¥è¿™ä¸ªé•¿é“¾æ¥æ˜¯å¦å·²ç»åˆ›å»ºè¿‡çŸ­é“¾æ¥äº†\næ ¹æ®çŸ­é“¾æ¥æŸ¥è¯¢GetLinksByKeyword é€šè¿‡çŸ­ç æŸ¥æ‰¾å¯¹åº”çš„é•¿é“¾æ¥ï¼ˆè·³è½¬æ—¶ç”¨ï¼‰\n\n\n\nç”¨æˆ·åˆ›å»ºçŸ­é“¾æ¥\n\né•¿é“¾æ¥ï¼šwww.google.com\næ¨¡å¼ï¼š1ï¼ˆç³»ç»Ÿè‡ªåŠ¨åˆ†é…ï¼‰\nå‘é€åˆ°æœåŠ¡å™¨ï¼šPOST /v1/create_url\n\n\nç„¶åè§£æå®Œä¹‹åä¸šåŠ¡å±‚CreateLinks()Â å‡½æ•°å¼€å§‹å·¥ä½œ,ä¼šè°ƒç”¨GetLinksByUrl.å¦‚æœå·²ç»åˆ›å»ºè¿‡,å°±ç›´æ¥è¿”å›æ—§çŸ­ç .\næ²¡æœ‰åˆ›å»ºè¿‡,é‚£ä¹ˆå°±éœ€è¦å¼€å§‹åˆ›å»º,æ ¹æ®æ¨¡å¼è¿›è¡Œåˆ›å»º.\n\nå¦‚æœæ˜¯ç³»ç»Ÿåˆ†é…,ä¼šorder = Redis.INCR()è·å–å”¯ä¸€id,ç„¶åkeyword = TenToAny(order)è½¬æ¢æˆ62è¿›åˆ¶\nå¦‚æœæ˜¯è‡ªå®šä¹‰,å°±å…ˆéªŒè¯æ˜¯å¦è¢«å ç”¨,åªè¦æ²¡è¢«å ç”¨å°±å¯ä»¥ä½¿ç”¨ç”¨æˆ·è‡ªå®šä¹‰çš„çŸ­ç \n\n\nä¿å­˜åˆ°æ•°æ®åº“Insert(links)å¹¶ æ·»åŠ åˆ°å¸ƒéš†è¿‡æ»¤å™¨bloomFilter.Add(keyword)\n\nredis\nç‹¬ç«‹çš„æ•°æ®åº“æœåŠ¡.å¯ä»¥åœ¨æœ¬åœ°è¿è¡Œ/è¿œç¨‹æœåŠ¡å™¨è¿è¡Œ/ç½‘ç»œè¿æ¥è®¿é—®\ngoç¨‹åºæ„å»ºrediså‘½ä»¤,ç„¶åé€šè¿‡tcpipå‘é€åˆ°redisæœåŠ¡å™¨,redisæ”¶åˆ°å‘½ä»¤åæ“ä½œå®Œè¿”å›ç»“æœ.\nredisæ˜¯å†…å­˜æ•°æ®åº“(å­˜å‚¨åœ¨ç‹¬ç«‹æœåŠ¡å™¨çš„å†…å­˜),mysqlæ˜¯ç¡¬ç›˜æ•°æ®åº“(å­˜å‚¨åœ¨æœåŠ¡å™¨çš„ç¡¬ç›˜)\nç”¨æˆ·è®¿é—®çŸ­é“¾æ¥\n\nç”¨æˆ·åœ¨æµè§ˆå™¨è¾“å…¥ï¼šhttp://127.0.0.1:8099/b\nserver.Middleware()æ‹¦æˆªè¯·æ±‚,æå–åˆ°çŸ­ç \nGetLinksByKeyword(â€œbâ€)\n\næŸ¥å¸ƒéš†è¿‡æ»¤å™¨.å¦‚æœfalse,é‚£ä¹ˆä¸€å®šä¸å­˜åœ¨.ç›´æ¥è¿”å›404,ä¸æŸ¥æ•°æ®åº“\nå¦‚æœtrue,é‚£ä¹ˆå¯èƒ½å­˜åœ¨,è¿›å…¥ç¬¬äºŒå±‚é˜²æŠ¤ï¼šSingleFlight\n\nåˆå¹¶å¹¶å‘è¯·æ±‚.ç¬¬ä¸€ä¸ªè¯·æ±‚æŸ¥æ•°æ®åº“,å¦‚æœæŸ¥åˆ°äº†é‚£ä¹ˆè¿”å›ç»“æœå¹¶ä¸”ç»™serverå±‚å¤„ç†ç»“æœè¿›è¡Œé‡å®šå‘æˆ–è€…404\nå…¶ä»–å¹¶å‘ç­‰å¾…ç¬¬ä¸€ä¸ªå…±äº«ç»“æœ\n\n\n\n\nc.Redirect(301, â€œwww.google.comâ€) é‡å®šå‘åˆ°åŸæœ¬çš„é•¿è¿æ¥,æµè§ˆå™¨å¯ä»¥è·³è½¬.\n\nå¸ƒéš†è¿‡æ»¤å™¨\nç»„æˆ:\n\nä¸€ä¸ªå¾ˆé•¿çš„äºŒè¿›åˆ¶å‘é‡(ä½æ•°ç»„),æ¯ä¸€ä½åªæœ‰0æˆ–1,åˆå§‹åŒ–æ—¶å…¨æ˜¯0.æ¯ä¸ªçŸ­é“¾æ¥ä¸€èµ·å…±ç”¨.å¦‚æœä¸€ä¸ªçŸ­é“¾æ¥æ¥è¿›è¡Œtestçš„æ—¶å€™,ç®—å‡ºæ¥çš„å“ˆå¸Œå‡½æ•°å€¼å¯¹åº”çš„ä½ä¸æ˜¯1,é‚£ä¹ˆè¯´æ˜è‚¯å®šä¸åœ¨(å› ä¸ºä¸€å¼€å§‹addçš„æ—¶å€™éƒ½ä¼šç½®1),é‚£å¦‚æœæ˜¯1,ä¹Ÿä¸èƒ½è¯æ˜ä¸€å®šåœ¨,ä½†æ˜¯æ—¢ç„¶å¯èƒ½åœ¨,å°±ç»§ç»­æŸ¥è¯¢mysql.\nkä¸ªå“ˆå¸Œå‡½æ•°,å¯ä»¥å°†è¾“å…¥æ˜ å°„åˆ°ä½æ•°ç»„çš„æŸä¸ªç´¢å¼•ä¸Š\n\nsingleflight\ns.sfGroup.Do(key, fn)ã€‚è¿™ä¸ªåº“ (golang.org/x/sync/singleflight) çš„æºç éå¸¸çŸ­ï¼Œæ ¸å¿ƒæ€æƒ³æ˜¯ â€œå¤ç”¨â€ å’Œ â€œé˜»å¡ç­‰å¾…â€ã€‚\nSingleFlight çš„ Group ç»“æ„ä½“å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ª Mapï¼š\ntype Group struct {\n    mu sync.Mutex       // ä¿æŠ¤ Map çš„é”\n    m  map[string]*call // å…³é”®ï¼šå­˜æ”¾æ­£åœ¨è¿›è¡Œçš„è¯·æ±‚\n}\n \ntype call struct {\n    wg  sync.WaitGroup  // å…³é”®ï¼šç”¨äºè®©åç»­è¯·æ±‚æ’é˜Ÿç­‰å¾…\n    val interface{}     // å­˜æ”¾å‡½æ•°æ‰§è¡Œç»“æœ\n    err error           // å­˜æ”¾é”™è¯¯\n}\ndo: å½“10000ä¸ªè¯·æ±‚åŒæ—¶è°ƒç”¨doæ—¶\n\nè¿›é—¨å…ˆæŠ¢groupçš„äº’æ–¥é”\nåˆ¤æ–­èº«ä»½ å¦‚æœæ˜¯ç¬¬ä¸€ä¸ªäºº\n\næŸ¥map,å‘ç°keyä¸å­˜åœ¨\nåˆ›å»ºä¸€ä¸ªæ–°çš„callå¯¹è±¡\ncall.wg.Add(1)\næŠŠkeyâ†’callæ”¾å…¥map\né‡Šæ”¾é”mu\næ‰§è¡ŒçœŸæ­£çš„fn()æŸ¥æ•°æ®åº“\n\n\nå¦‚æœæ˜¯åæ¥è€…\n\næŸ¥mapå‘ç°keyå·²ç»å­˜åœ¨äº†,\né‚£ä¹ˆæ‹¿åˆ°callå¯¹è±¡çš„æŒ‡é’ˆ,é‡Šæ”¾é”mu\nåŸåœ°é˜»å¡ç¡è§‰,ç­‰å¾…leaderç¯å½¢\n\n\nleaderå¹²å®Œæ´»äº†æŠŠç»“æœå†™åˆ°call.val\nleaderå†æ¬¡åŠ é”åˆ é™¤key\nè°ƒç”¨calldone\nfolloweræ¥è§¦é˜»å¡\næ‰€æœ‰followerç›´æ¥è¯»å–call.val\næ‹¿ç€åŒä¸€ä¸ªç»“æœè¿”å›äº†\n\nserver httpæœåŠ¡å±‚\n\nhttpæœåŠ¡å™¨å¯åŠ¨\n\nå¯åŠ¨Gin HTTPæœåŠ¡å™¨å¹¶é…ç½®è¶…æ—¶æ—¶é—´\\æœ€å¤§è¯·æ±‚å¤´å¤§å°,ç›‘å¬æ¥è‡ªæµè§ˆå™¨çš„è¯·æ±‚\n\n\nè·¯ç”±é…ç½®;å®šä¹‰ä¸åŒè¯·æ±‚åº”ç”±è°å¤„ç†\n\nroute()æ³¨å†Œè·¯ç”±\nè®¾ç½®corsè·¨è¶Šä¸­é—´ä»¶\n\nå…è®¸æ¥è‡ªä¸åŒç½‘ç«™çš„æµè§ˆå™¨è®¿é—®è¿™ä¸ªæœåŠ¡å™¨ï¼Œé˜²æ­¢è·¨åŸŸè®¿é—®è¢«æµè§ˆå™¨é˜»æ­¢\n\n\nè®¾ç½®çŸ­é“¾æ¥è·³è½¬ä¸­é—´ä»¶Middleware\n\nå¦‚æœæ˜¯åˆ›å»ºçŸ­é“¾æ¥å°±ç»§ç»­å¤„ç†(è¿™é‡Œåœ¨ä¸‹é¢apiæ³¨å†Œè·¯ç”±çš„æ—¶å€™,ä¼šåˆ†å‘åˆ°CreateLinkå‡½æ•°çš„)\nå¦‚æœæ˜¯çŸ­é“¾æ¥è·³è½¬ è¿™é‡Œè´Ÿè´£è°ƒç”¨GetLinksByKeywordæˆ–è€…è¿”å›404\n\n\nç™»è®°apiè·¯ç”±: æ ¹æ®:è·¯ç”±ç»„(v1)\\httpæ–¹æ³•(.post)å’Œurlè·¯å¾„,è°ƒç”¨å¯¹åº”å¤„ç†å‡½æ•°.ç¨‹åºå¯åŠ¨æ—¶æ³¨å†Œ(mainä¸­server.run runä¸­route().) â†’ è¿è¡Œæ—¶æŸ¥æ‰¾è·¯ç”±è¡¨ â†’ è°ƒç”¨å¤„ç†å‡½æ•°.()\n\n\n\næ•°æ®ç»“æ„\nlinks\nçŸ­é“¾æ¥çš„æ•°æ®ç»“æ„,å¯¹åº”æ•°æ®åº“linkè¡¨.\nkeyword çŸ­ç  å”¯ä¸€ç´¢å¼•\nurl é•¿è¿æ¥ å”¯ä¸€ç´¢å¼•\nstatus ä¸åŒçš„æ¨¡å¼\næ¥å£\nShortUrlServiceä¸šåŠ¡æ¥å£ å®šä¹‰çŸ­è¿æ¥æœåŠ¡çš„æ ¸å¿ƒä¸šåŠ¡æ–¹æ³•\nSequenceService ç”Ÿæˆå…¨å±€å”¯ä¸€id\nBaseController httpè¯·æ±‚å¤„ç†å™¨.æŒæœ‰ ShortUrlService å®ä¾‹"},"æŠ€æœ¯ç§¯ç´¯/é¡¹ç›®/02-miniSQL/é¡¹ç›®æµç¨‹":{"slug":"æŠ€æœ¯ç§¯ç´¯/é¡¹ç›®/02-miniSQL/é¡¹ç›®æµç¨‹","filePath":"æŠ€æœ¯ç§¯ç´¯/é¡¹ç›®/02 miniSQL/é¡¹ç›®æµç¨‹.md","title":"é¡¹ç›®æµç¨‹","links":[],"tags":[],"content":"\nåº”ç”¨å±‚:åŒ…æ‹¬å‘½ä»¤è¡Œæ¥å£,sqlè¾“å…¥è¾“å‡º\næ‰§è¡Œå¼•æ“å±‚:\n\nExecuteEngineæ‰§è¡Œå¼•æ“å…¥å£\nPlanneræŸ¥è¯¢è®¡åˆ’ç”Ÿæˆ\nExecutorå„ç§æ‰§è¡Œå™¨\n\n\nå…ƒæ•°æ®ç®¡ç†å±‚\n\nCatalogManagerç®¡ç†è¡¨å’Œç´¢å¼•çš„å…ƒæ•°æ®\nè¡¨ä¿¡æ¯\nç´¢å¼•ä¿¡æ¯\n\n\nå­˜å‚¨å±‚\n\nTableHeapè¡¨å †,ç®¡ç†æ•°æ®é¡µ\næ•°æ®é¡µ,å­˜å‚¨å®é™…è®°å½•\nb+æ ‘ç´¢å¼•\n\n\nç¼“å†²æ± å±‚\n\nç¼“å†²æ± ç®¡ç†å™¨\né¡µé¢æ›¿æ¢ç®—æ³•\n\n\nç£ç›˜ç®¡ç†å±‚\n\nç£ç›˜æ–‡ä»¶è¯»å†™\n\n\n\nå¹¶å‘æ§åˆ¶:è´¯ç©¿å„å±‚\n\nTxnmanageräº‹åŠ¡ç®¡ç†å™¨\n\näº‹åŠ¡å¯¹è±¡\n\n\nLockManageré”ç®¡ç†å™¨\n\næ•°æ®æµ\né¦–å…ˆè¯»å–sql\nParserè§£æsql ç”Ÿæˆè¯­æ³•æ ‘AST\nExecuteEngineæ ¹æ®ASTç±»å‹åˆ†å‘\nDMLæ“ä½œ:\n\nPlanQuery() ç”Ÿæˆæ‰§è¡Œè®¡åˆ’\nExecutePlan() æ‰§è¡Œè®¡åˆ’\nè¿”å›ç»“æœç»™ç”¨æˆ·\n\nExecuteEngine::ExecutePlan()\nInsertExecutor::Init()\n\nä»catalogè·å–table info\nè·å–è¡¨çš„æ‰€æœ‰ç´¢å¼•\nInsertExecutor::Next()\né€šè¿‡ç´¢å¼•æ£€æŸ¥å”¯ä¸€æ€§çº¦æŸ\næ’å…¥è®°å½•åˆ°è¡¨\næ›´æ–°æ‰€æœ‰ç´¢å¼•\n\n\n\n"},"æŠ€æœ¯ç§¯ç´¯/é¡¹ç›®/goé¡¹ç›®ç›¸å…³/00-åˆå§‹åŒ–":{"slug":"æŠ€æœ¯ç§¯ç´¯/é¡¹ç›®/goé¡¹ç›®ç›¸å…³/00-åˆå§‹åŒ–","filePath":"æŠ€æœ¯ç§¯ç´¯/é¡¹ç›®/goé¡¹ç›®ç›¸å…³/00 åˆå§‹åŒ–.md","title":"00 åˆå§‹åŒ–","links":[],"tags":[],"content":"\ngoè¯­è¨€\nmysqlæ•°æ®åº“\nredis/docker\n\nmkdir short_url\ncd short_url\ngo mod init short_url\næ•°æ®åº“\nmysql -u root -p\nCREATE DATABASE seqsrv;\nUSE seqsrv;\nåˆ›å»ºæ•°æ®åº“è¡¨\nCREATE TABLE `links` (\n  `id` int(11) NOT NULL AUTO_INCREMENT,\n  `url` varchar(200) COLLATE utf8mb4_bin NOT NULL COMMENT &#039;é•¿é“¾æ¥&#039;,\n  `keyword` varchar(50) COLLATE utf8mb4_bin NOT NULL COMMENT &#039;çŸ­é“¾æ¥ç &#039;,\n  `status` tinyint(1) NOT NULL COMMENT &#039;1ç³»ç»Ÿåˆ†é… 2ç”¨æˆ·è‡ªå®šä¹‰&#039;,\n  `create_time` bigint(20) NOT NULL,\n  `update_time` bigint(20) NOT NULL,\n  PRIMARY KEY (`id`),\n  UNIQUE KEY `links_UN` (`url`),\n  UNIQUE KEY `links_keyword` (`keyword`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_bin;\ngo get -u github.com/go-ini/ini\n\nè¿™ä¸ª-uå°±æ˜¯ å¦‚æœä¸åŠ çš„è¯ ä¼šä¼˜å…ˆåœ¨æœ¬åœ°æ‰¾æ˜¯å¦ä¸‹è½½è¿‡è¿™ä¸ªåŒ…,ç„¶åä¼˜å…ˆç”¨æœ¬åœ°çš„.\nå¦‚æœåŠ ä¸Š-uçš„è¯ å°±ä¼šä¼˜å…ˆä¸‹è½½æœ€æ–°çš„,å¦‚æœæœ¬åœ°æœ‰,å°±ä¼šè¢«è¦†ç›–"},"æŠ€æœ¯ç§¯ç´¯/é¡¹ç›®/goé¡¹ç›®ç›¸å…³/01-Goè¯­è¨€çš„errå¤„ç†":{"slug":"æŠ€æœ¯ç§¯ç´¯/é¡¹ç›®/goé¡¹ç›®ç›¸å…³/01-Goè¯­è¨€çš„errå¤„ç†","filePath":"æŠ€æœ¯ç§¯ç´¯/é¡¹ç›®/goé¡¹ç›®ç›¸å…³/01 Goè¯­è¨€çš„errå¤„ç†.md","title":"01 Goè¯­è¨€çš„errå¤„ç†","links":[],"tags":[],"content":"panic(err)\nç¨‹åºç«‹åˆ»åœæ­¢è¿è¡Œ,æ‰“å°å‡ºä¸€å †çº¢è‰²çš„å †æ ˆä¿¡æ¯è¡¨æ˜æ˜¯å“ªä¸€è¡Œä»£ç å¯¼è‡´äº†å´©æºƒï¼Œç„¶åé€€å‡º.\n\nä¸€èˆ¬åªåœ¨ç¨‹åºå¯åŠ¨é˜¶æ®µ,æˆ–è€…é‡åˆ°äº†ä¿®å¤ä¸å¥½çš„é€»è¾‘é”™è¯¯çš„æ—¶å€™ä½¿ç”¨\n\nreturn err\nå‡½æ•°æ— æ³•å¤„ç†,ä½†æ˜¯ä¸å´©æºƒ,è€Œæ˜¯é€šè¿‡å‡½æ•°è¿”å›å€¼å‘Šè¯‰è°ƒç”¨è€…,è®©å®ƒå†³å®šåº”è¯¥æ€ä¹ˆåŠ.ä¸€èˆ¬éƒ½ä¼šç”¨è¿™ç§.\nlog.Fatal(err)\næ‰“å°ä¸€æ¡é”™è¯¯æ—¥å¿—,ç„¶åç›´æ¥é€€å‡ºç¨‹åº.\né€šå¸¸ç”¨åœ¨mainå‡½æ•°é‡Œ,æˆ–è€…å‘½ä»¤è¡Œå·¥å…·ä¸­,å…¶å®æ•ˆæœå’Œpanicå·®ä¸å¤š,ä½†æ˜¯æ²¡æœ‰é‚£ä¹ˆå¤šæ—¥å¿—,æ¯”è¾ƒæ¸…çˆ½"},"æŠ€æœ¯ç§¯ç´¯/é¡¹ç›®/goé¡¹ç›®ç›¸å…³/Go-mod":{"slug":"æŠ€æœ¯ç§¯ç´¯/é¡¹ç›®/goé¡¹ç›®ç›¸å…³/Go-mod","filePath":"æŠ€æœ¯ç§¯ç´¯/é¡¹ç›®/goé¡¹ç›®ç›¸å…³/Go mod.md","title":"Go mod","links":[],"tags":[],"content":"go mod init short_url\ngo mod tidy //\n\næ‰«ææ‰€æœ‰Â .goÂ æ–‡ä»¶ä¸­çš„Â importÂ è¯­å¥\nè‡ªåŠ¨ä¸‹è½½ç¼ºå¤±çš„ä¾èµ–åŒ…\nè®°å½•åˆ°Â go.modÂ å’ŒÂ go.sumÂ æ–‡ä»¶\nç§»é™¤æœªä½¿ç”¨çš„ä¾èµ–\n"},"æŠ€æœ¯ç§¯ç´¯/é¡¹ç›®/goé¡¹ç›®ç›¸å…³/ORM-GORM":{"slug":"æŠ€æœ¯ç§¯ç´¯/é¡¹ç›®/goé¡¹ç›®ç›¸å…³/ORM-GORM","filePath":"æŠ€æœ¯ç§¯ç´¯/é¡¹ç›®/goé¡¹ç›®ç›¸å…³/ORM-GORM.md","title":"ORM-GORM","links":[],"tags":[],"content":"ORM object relational mapping\nç”¨æ“ä½œç»“æ„ä½“çš„æ–¹å¼æ¥æ“ä½œæ•°æ®åº“ï¼Œè€Œä¸éœ€è¦å¤æ‚çš„æ‰‹å†™SQLè¯­å¥\nä¸»è¦åŠŸèƒ½\n\næ˜ å°„mappingï¼Œå°†æ•°æ®åº“è¡¨æ˜ å°„ä¸ºgoçš„ç»“æ„ä½“ï¼Œå°†è¡Œå†…æ•°æ®æ˜ å°„ä¸ºç»“æ„ä½“ç¤ºä¾‹\nCRUDæ“ä½œçš„é“¾å¼è°ƒç”¨\nè‡ªåŠ¨è¿ç§»ï¼Œæ ¹æ®ç»“æ„ä½“å®šä¹‰è‡ªåŠ¨åˆ›å»ºæˆ–è€…ä¿®æ”¹æ•°æ®åº“è¡¨ç»“æ„\nå…³è”æŸ¥è¯¢ï¼Œå¤„ç†ä¸€å¯¹ä¸€ã€ä¸€å¯¹å¤šã€å¤šå¯¹å¤šç­‰å¤æ‚çš„è¡¨å…³ç³»\né’©å­hooks åœ¨æ’å…¥æˆ–è€…æ›´æ–°åæ‰§è¡Œç‰¹å®šçš„é€»è¾‘\n\nGORM\ngorm.io\nGORMä¸XORM\nGORMåŸç”Ÿæ€§èƒ½ç•¥é€Šè‰²äºXORMï¼Œå› ä¸ºå…¶åŠŸèƒ½å¤šã€åå°„ç”¨å¾—å¹¿ã€‚\nä½†æ˜¯æµè¡Œåº¦è¾ƒé«˜ï¼Œæ–‡æ¡£ä¸°å¯Œï¼ŒåŠŸèƒ½å…¨é¢ã€‚\né”™è¯¯å¤„ç†æ–¹é¢ï¼Œå°†é”™è¯¯ä¿å­˜åœ¨dbã€‚Errorä¸­ï¼Œéœ€è¦æ‰‹åŠ¨æ£€æŸ¥ã€‚\nXORMåˆ™ç›´æ¥è¿”å›ï¼ˆint64ï¼Œerrorï¼‰æ›´ç¬¦åˆgoçš„ä¼ ç»Ÿé£æ ¼\nä½¿ç”¨\ngo get -u gorm.io/gorm gormæ ¸å¿ƒåº“\ngo get -u gorm.io/driver/mysql æ•°æ®åº“é©±åŠ¨\n\nè¿æ¥\nå®šä¹‰define\nè¿ç§»\næ“ä½œ\n\né“¾å¼è°ƒç”¨ method chaining\n.where(â€œname = ?â€, â€œGeminiâ€)è¿™é‡Œçš„é—®å·æ˜¯å ä½ç¬¦,é˜²æ­¢æ³¨å…¥æ”»å‡»\n.Order(â€œage descâ€):æ’åº  æŒ‰ageé™åº\n.Limit(10) é™åˆ¶æ•°é‡\n.Preload(â€œCreditCardsâ€)é¢„åŠ è½½,db.Preload(â€œCreditCardsâ€).Find(&amp;users)å°±æ˜¯è¯´æŸ¥ç”¨æˆ·çš„æ—¶å€™,æŠŠç”¨æˆ·åä¸‹çš„ä¿¡ç”¨å¡ä¸€èµ·æŸ¥å‡ºæ¥å¡è¿›ç»“æ„ä½“,è¿™æ˜¯ä¸ºäº†åŒæ—¶æŸ¥ä¸¤ä¸ªè¡¨çš„å…³è”æ“ä½œ.\n\nSELECT * FROM users;\nSELECT * FROM credit_cards WHERE user_id IN (1, 2, 3â€¦);\næ‹¼è£…åˆ°ç”¨æˆ·çš„creditCardså­—æ®µé‡Œ\n\n.First(&amp;user)æ˜¯,æˆ‘åªè¦æ‰¾åˆ°çš„ç¬¬ä¸€æ¡æ•°æ®,å¹¶ä¸”æŒ‰ä¸»é”®æ’åº.æ‰¾åˆ°æ•°æ®ä¹‹å,æŠŠæ•°æ®å¡«è¿›userè¿™ä¸ªç»“æ„ä½“é‡Œé¢.\n\ndb.First(&amp;u, 1)æ˜¯ç®€å†™,çœç•¥æ‰äº†å‰é¢çš„where\n.find(&amp;users)æ‰¾å¤šä¸ªäºº,æ‰€ä»¥ä¼ å…¥çš„å˜é‡é€šå¸¸æ˜¯ä¸€ä¸ªç»“æ„ä½“åˆ‡ç‰‡æ•°ç»„\n\nè¿æ¥æ•°æ®åº“\nfunc initDB() {\n  // Data Source Name (DSN) é…ç½®\n  dsn := &quot;user:password@tcp(127.0.0.1:3306)/dbname?charset=utf8mb4&amp;parseTime=True&amp;loc=Local&quot;\n  //åŒ…æ‹¬è´¦å·å¯†ç  \n  //æ•°æ®åº“åœ°å€ åŒ…æ‹¬æœ¬æœºipå’Œæ•°æ®åº“ç«¯å£\n  //æ•°æ®åº“åå­—\n  //ä¸€äº›é¢å¤–åœ°é…ç½®charset\n  var err error\n  db, err = gorm.Open(mysql.Open(dsn), &amp;gorm.Config{})\n  if err != nil {\n    log.Fatal(&quot;æ•°æ®åº“è¿æ¥å¤±è´¥:&quot;, err)\n  }\n  \n  // è®¾ç½®è¿æ¥æ± ï¼ˆæ¨èåœ¨ç”Ÿäº§ç¯å¢ƒé…ç½®ï¼‰\n  sqlDB, _ := db.DB()\n  sqlDB.SetMaxIdleConns(10)  // ç©ºé—²è¿æ¥æ•°\n  sqlDB.SetMaxOpenConns(100) // æœ€å¤§è¿æ¥æ•°\n}\næ¨¡å‹å®šä¹‰\normçš„æ ¸å¿ƒåœ¨äºå°†goç»“æ„ä½“æ˜ å°„ä¸ºæ•°æ®åº“è¡¨.\n\nç»“æ„ä½“åç§° \\rightarrow è¡¨åï¼ˆé»˜è®¤è›‡å½¢å¤æ•°ï¼Œå¦‚ User \\rightarrow usersï¼‰ã€‚\nç»“æ„ä½“å­—æ®µ \\rightarrow è¡¨å­—æ®µ\n\ntype User struct {\n  gorm.Model        // åµŒå…¥å­—æ®µï¼ŒåŒ…å« ID, CreatedAt, UpdatedAt, DeletedAt\n  Name      string  `gorm:&quot;type:varchar(100);not null&quot;` // æŒ‡å®šç±»å‹å’Œçº¦æŸ\n  Age       int     `gorm:&quot;default:18&quot;`                 // é»˜è®¤å€¼\n  Email     string  `gorm:&quot;uniqueIndex&quot;`                // å”¯ä¸€ç´¢å¼•\n  Role      string  `gorm:&quot;-&quot;`                          // å¿½ç•¥æ­¤å­—æ®µï¼Œä¸æ˜ å°„åˆ°æ•°æ®åº“\n}\ndeletedat:GORM è¿™é‡Œçš„åˆ é™¤ï¼Œç›¸å½“äºæŠŠæ–‡ä»¶ä¸¢è¿›äº†â€œå›æ”¶ç«™â€ã€‚æ•°æ®åº“é‡Œè¿™æ¡æ•°æ®è¿˜åœ¨ï¼Œä½†æ˜¯æ‰“ä¸Šäº†ä¸€ä¸ªâ€œå·²åˆ é™¤â€çš„æ ‡è®°ã€‚å½“ä½ ä¸‹æ¬¡æŸ¥è¯¢æ—¶ï¼ŒGORM ä¼šè‡ªåŠ¨å¿½ç•¥å›æ”¶ç«™é‡Œçš„ä¸œè¥¿ï¼Œå‡è£…å®ƒæ²¡äº†ã€‚è¿™æ ·åšæ˜¯ä¸ºäº†é˜²æ­¢è¯¯åˆ ï¼Œæ•°æ®è¿˜èƒ½æ‰¾å›æ¥ã€‚\nè‡ªåŠ¨è¿ç§»\nå› ä¸ºä¹‹å‰éƒ½æ˜¯å®šä¹‰,è¿˜å¹¶æ²¡æœ‰çœŸæ­£æ“ä½œåˆ°æ•°æ®åº“\ndb.AutoMigrate(&amp;User{})è¿™ä¸€è¡Œè¿è¡Œåï¼Œæ•°æ®åº“é‡Œå°±ä¼šå‡­ç©ºå¤šå‡ºä¸€å¼ å« users çš„è¡¨\nå¢åˆ æ”¹æŸ¥æ“ä½œ\nè°ƒç”¨db(ä¹‹å‰gormopençš„ç»“æœ),å¯¹æ•°æ®åº“è¿›è¡Œæ“ä½œ.\n// 1. åˆ›å»ºä¸€ä¸ªå¯¹è±¡\nu := User{Name: &quot;å°æ˜&quot;, Age: 18}\n// 2. æŠŠå®ƒå­˜è¿›å»\nresult := db.Create(&amp;user) // ä¼ å…¥æŒ‡é’ˆ\n// result.Error        // è¿”å›é”™è¯¯\n// result.RowsAffected // è¿”å›æ’å…¥è®°å½•çš„æ¡æ•°\n// user.ID             // æ’å…¥æˆåŠŸåï¼ŒID ä¼šè‡ªåŠ¨å›å¡«åˆ°ç»“æ„ä½“ä¸­\n \nvar u User // å‡†å¤‡ä¸€ä¸ªç©ºç›’å­ç”¨æ¥è£…æ•°æ®\n//æ ¹æ®ä¸»é”®æŸ¥è¯¢\ndb.First(&amp;u, 1) // SELECT * FROM users WHERE id = 1\nfmt.Println(u.Name) // è¾“å‡ºï¼šå°æ˜\n//æ ¹æ®æ¡ä»¶æŸ¥è¯¢ç¬¬ä¸€æ¡\ndb.Where(&quot;name = ?&quot;, &quot;Gemini&quot;).First(&amp;user)\n//æŸ¥è¯¢å¤šæ¡\nvar users []User\n// æŸ¥è¯¢æ‰€æœ‰\ndb.Find(&amp;users)\n// å¤æ‚æ¡ä»¶æŸ¥è¯¢\ndb.Where(&quot;age &gt; ? AND name LIKE ?&quot;, 18, &quot;%Ge%&quot;).Order(&quot;age desc&quot;).Limit(10).Find(&amp;users)\n \n \n//ä¿å­˜æ‰€æœ‰å­—æ®µ\ndb.First(&amp;user, 1)\nuser.Name = &quot;New Name&quot;\ndb.Save(&amp;user)\n \n \n// æ›´æ–°å•ä¸ªå­—æ®µ\ndb.Model(&amp;user).Update(&quot;name&quot;, &quot;New Name&quot;)\n// æ›´æ–°å¤šä¸ªå­—æ®µ (Struct) - æ³¨æ„é›¶å€¼é™·é˜±ï¼\n// ä»…æ›´æ–°éé›¶å€¼å­—æ®µã€‚å¦‚æœ Age è®¾ç½®ä¸º 0ï¼ŒGORM é»˜è®¤ä¼šå¿½ç•¥æ›´æ–°è¯¥å­—æ®µã€‚\ndb.Model(&amp;user).Updates(User{Name: &quot;New Name&quot;, Age: 0}) // Age ä¸ä¼šè¢«æ›´æ–°ä¸º 0\n \n \n// æ›´æ–°å¤šä¸ªå­—æ®µ (Map)\n// Map å¯ä»¥å¤„ç†é›¶å€¼æ›´æ–°\ndb.Model(&amp;user).Updates(map[string]interface{}{&quot;name&quot;: &quot;New Name&quot;, &quot;age&quot;: 0})\n \n//åˆ é™¤\n// æ ¹æ®ä¸»é”®åˆ é™¤\ndb.Delete(&amp;User{}, 1)\n// æ ¹æ®æ¡ä»¶åˆ é™¤\ndb.Where(&quot;name = ?&quot;, &quot;Gemini&quot;).Delete(&amp;User{})\nå…³è”æŸ¥è¯¢\ntype User struct {\n  gorm.Model\n  Name        string\n  CreditCards []CreditCard // ä¸€å¯¹å¤šå…³è”\n}\n \ntype CreditCard struct {\n  gorm.Model\n  Number string\n  UserID uint // å¤–é”®\n}\n \nvar users []User\n// ç”Ÿæˆ SQL: SELECT * FROM users; SELECT * FROM credit_cards WHERE user_id IN (1,2,3...);\ndb.Preload(&quot;CreditCards&quot;).Find(&amp;users)\näº‹åŠ¡ä¸é’©å­\n//äº‹åŠ¡,ä¿è¯æ•°æ®ä¸€è‡´æ€§\nerr := db.Transaction(func(tx *gorm.DB) error {\n  // åœ¨äº‹åŠ¡ä¸­æ‰§è¡Œæ•°æ®åº“æ“ä½œï¼Œä½¿ç”¨ tx è€Œä¸æ˜¯ db\n  if err := tx.Create(&amp;Animal{Name: &quot;Giraffe&quot;}).Error; err != nil {\n    return err // è¿”å›é”™è¯¯ä¼šè‡ªåŠ¨å›æ»š\n  }\n  \n  if err := tx.Create(&amp;Animal{Name: &quot;Lion&quot;}).Error; err != nil {\n    return err\n  }\n  \n  return nil // è¿”å› nil ä¼šè‡ªåŠ¨æäº¤\n})\n \n//åœ¨å¢åˆ æ”¹æŸ¥å‰ååœ¨iæ‡‚æ‰§è¡Œé€»è¾‘\nfunc (u *User) BeforeCreate(tx *gorm.DB) (err error) {\n  u.UUID = uuid.New() // åˆ›å»ºå‰è‡ªåŠ¨ç”Ÿæˆ UUID\n  return\n}"},"æŠ€æœ¯ç§¯ç´¯/é¡¹ç›®/goé¡¹ç›®ç›¸å…³/docker":{"slug":"æŠ€æœ¯ç§¯ç´¯/é¡¹ç›®/goé¡¹ç›®ç›¸å…³/docker","filePath":"æŠ€æœ¯ç§¯ç´¯/é¡¹ç›®/goé¡¹ç›®ç›¸å…³/docker.md","title":"docker","links":[],"tags":[],"content":"é•œåƒ\nç›¸å½“äºå®‰è£…åŒ…,åªè¯»\nå®¹å™¨\nç›¸å½“äºè¿è¡Œèµ·æ¥çš„ç¨‹åº,ç”¨é•œåƒå¯ä»¥ç”Ÿæˆæ— æ•°ä¸ªè¿è¡Œçš„å®¹å™¨\nä»“åº“\nä¸‹è½½åˆ«äººçš„é•œåƒ\næ•°æ®å·\nvolumes: - mysql_data:/var/lib/mysql\ndockerå®¹å™¨æ˜¯åŠ¨æ€é”€æ¯çš„,ä½†æ˜¯å…¶å®ä¸šåŠ¡ä»£ç å®¹å™¨å¹¶ä¸å­˜æ•°æ®,æ•°æ®åº“å®¹å™¨ä¼šé€šè¿‡æŒ‚è½½æ¥ä¿è¯æ•°æ®è¿˜åœ¨ç£ç›˜é‡Œ.\nåŠ¨æ€é”€æ¯\n\nå¼¹æ€§æ‰©å®¹ï¼ˆåŒ 11 æˆ–ä¿ƒé”€ï¼‰ï¼šå¹³æ—¶ä½ çš„çŸ­é“¾æ¥é¡¹ç›®å¼€ 2 ä¸ªå®¹å™¨ï¼ˆèŠ‚ç‚¹ï¼‰å°±å¤Ÿäº†ã€‚çªç„¶æœ‰ä¸ªå¤§ä¿ƒï¼Œæµé‡ç¿»äº† 10 å€ï¼Œè¿ç»´ç³»ç»Ÿä¼šè‡ªåŠ¨å¯åŠ¨ 20 ä¸ªå®¹å™¨ã€‚ç­‰ä¿ƒé”€ç»“æŸï¼Œå†æŠŠè¿™ 18 ä¸ªå¤šå‡ºæ¥çš„å®¹å™¨é”€æ¯\næ»šåŠ¨æ›´æ–°ï¼ˆæ— æ„Ÿå‡çº§ï¼‰ï¼šä½ æƒ³ä¸Šçº¿æ–°åŠŸèƒ½ï¼Œä¸æ˜¯åœæœºæ›´æ–°ã€‚è€Œæ˜¯å…ˆå¯åŠ¨ä¸€ä¸ªâ€œæ–°ç‰ˆ V2 å®¹å™¨â€ï¼Œç­‰å®ƒè¿è¡Œæ­£å¸¸äº†ï¼Œå†æŠŠâ€œæ—§ç‰ˆ V1 å®¹å™¨â€é”€æ¯æ‰ã€‚\næ•…éšœè‡ªæ„ˆï¼šå¦‚æœæŸä¸ªæœåŠ¡å™¨ç¡¬ä»¶åäº†ï¼Œä¸Šé¢çš„å®¹å™¨å´©äº†ï¼ŒK8sï¼ˆå®¹å™¨ç®¡ç†ç³»ç»Ÿï¼‰ä¼šè‡ªåŠ¨åœ¨å¦ä¸€å°å¥åº·çš„æœåŠ¡å™¨ä¸Šæ‹‰èµ·ä¸€ä¸ªæ–°çš„å®¹å™¨æ¥é¡¶æ›¿å®ƒã€‚\n\ndocker compose\nå¯ä»¥é€šè¿‡ä¸€ä¸ª docker-compose.yml æ–‡ä»¶å®šä¹‰æ‰€æœ‰æœåŠ¡ï¼Œæ‰§è¡Œ docker-compose up å°±èƒ½ä¸€é”®å¯åŠ¨æ•´ä¸ªé¡¹ç›®ã€‚åŒ…æ‹¬webç¨‹åº+mysqlæ•°æ®åº“ç­‰ç­‰ç­‰ç­‰\nåªéœ€è¦å°†dockerfileå˜æˆä¸€ä¸ªå¯æ‰§è¡Œçš„é•œåƒ,ç„¶ååŸºäºé•œåƒå¯åŠ¨å®¹å™¨å³å¯.\nversion: &#039;3.8&#039;\n \nservices:\n  mysql:\n    image: mysql:8.0\n    container_name: short_url_mysql\n    ports:\n      - &quot;3306:3306&quot;\n    environment:\n      MYSQL_ROOT_PASSWORD: 123456\n      MYSQL_DATABASE: seqsrv\n      TZ: Asia/Shanghai\n    volumes:\n      # æ•°æ®æŒä¹…åŒ–\n      - mysql_data:/var/lib/mysql\n      # æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬\n      - ./docker/mysql/init:/docker-entrypoint-initdb.d\n    command:\n      - --character-set-server=utf8mb4\n      - --collation-server=utf8mb4_bin\n      - --default-authentication-plugin=mysql_native_password\n    restart: unless-stopped\n    healthcheck:\n      test: [&quot;CMD&quot;, &quot;mysqladmin&quot;, &quot;ping&quot;, &quot;-h&quot;, &quot;localhost&quot;, &quot;-u&quot;, &quot;root&quot;, &quot;-p123456&quot;]\n      interval: 10s\n      timeout: 5s\n      retries: 5\n \n  redis:\n    image: redis:alpine\n    container_name: short_url_redis\n    ports:\n      - &quot;6379:6379&quot;\n    volumes:\n      # Redis æ•°æ®æŒä¹…åŒ–\n      - redis_data:/data\n    command: redis-server --appendonly yes\n    restart: unless-stopped\n    healthcheck:\n      test: [&quot;CMD&quot;, &quot;redis-cli&quot;, &quot;ping&quot;]\n      interval: 10s\n      timeout: 3s\n      retries: 5\n \nvolumes:\n  mysql_data:\n    driver: local\n  redis_data:\n    driver: local\n \n \næŸ¥çœ‹æ—¥å¿—\n# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡æ—¥å¿—\ndocker-compose logs -f\n \n# åªçœ‹ MySQL æ—¥å¿—\ndocker-compose logs -f mysql\n \n# åªçœ‹ Redis æ—¥å¿—\ndocker-compose logs -f redis"},"æŠ€æœ¯ç§¯ç´¯/é¡¹ç›®/goé¡¹ç›®ç›¸å…³/æ—¥å¿—ç®¡ç†":{"slug":"æŠ€æœ¯ç§¯ç´¯/é¡¹ç›®/goé¡¹ç›®ç›¸å…³/æ—¥å¿—ç®¡ç†","filePath":"æŠ€æœ¯ç§¯ç´¯/é¡¹ç›®/goé¡¹ç›®ç›¸å…³/æ—¥å¿—ç®¡ç†.md","title":"æ—¥å¿—ç®¡ç†","links":[],"tags":[],"content":"toolåŒ…:å°è£…äº†å…¨å±€å”¯ä¸€çš„æ—¥å¿—å¯¹è±¡.\ntool.GetLogger()å¯ä»¥è°ƒç”¨è¿™ä¸ªæ—¥å¿—å¯¹è±¡\n.Debug(...)ç”¨æ¥å®šçº§åˆ«,debugæ˜¯æ™®é€šè°ƒè¯•ä¿¡æ¯,\n\nåœ¨ç”Ÿäº§ç¯å¢ƒä¸ºäº†æ€§èƒ½å’Œç£ç›˜ç©ºé—´ï¼Œé€šå¸¸ä¼šè®¾ç½®åªè®°å½• Info æˆ– Error çº§åˆ«ã€‚æ‰€ä»¥è¿™è¡Œ Debug ä»£ç åœ¨çº¿ä¸Šä¼šè‡ªåŠ¨è¢«å¿½ç•¥ï¼Œä¸ä¼šæ‰“å°å‡ºæ¥ï¼Œåªæœ‰åœ¨å¼€å‘ç¯å¢ƒæ‰ä¼šæ˜¾ç¤ºã€‚\n\n&quot;mysql connected&quot;, zap.String(&quot;dsn&quot;, dsn) æ—¥å¿—çš„å†…å®¹.é¦–å…ˆæ˜¯ç»™äººçœ‹çš„message,ç„¶åæ˜¯ç»“æ„åŒ–å­—æ®µzap.String(&quot;dsn&quot;, dsn)\n\nzapæ‰“å°å‡ºæ¥é€šå¸¸æ˜¯jsonæ ¼å¼{â€œlevelâ€: â€œdebugâ€, â€œmsgâ€: â€œmysql connectedâ€, â€œdsnâ€: â€œuser:pass@tcpâ€¦â€œ}\nå¿«.goè‡ªå¸¦çš„logåº“åœ¨å¤„ç†å¤§é‡æ—¥å¿—çš„æ—¶å€™ä¼šå¾ˆæ…¢,å› ä¸ºæ¶‰åŠåˆ°å†…å­˜åˆ†é….zapåšåˆ°äº†æè‡´çš„æ€§èƒ½ä¼˜åŒ–(å¼‚æ­¥ä¼˜åŒ–),è¢«ç§°ä¸ºé›¶å†…å­˜åˆ†é…æ—¥å¿—åº“\nç»“æ„åŒ–,å°±æ˜¯å¼ºåˆ¶æŠŠæ—¥å¿—å†™æˆkeyvalueå½¢å¼\n\nLumberjackçš„ä½œç”¨æ˜¯æ—¥å¿—è½®è½¬,å¯ä»¥åšåˆ°å¤§æ–‡ä»¶åˆ‡å‰²\\å‹ç¼©\\æ¸…ç†ç­‰"},"ç”Ÿæ´»æ‚è°ˆ/test":{"slug":"ç”Ÿæ´»æ‚è°ˆ/test","filePath":"ç”Ÿæ´»æ‚è°ˆ/test.md","title":"test","links":[],"tags":[],"content":""},"ç”Ÿæ´»æ‚è°ˆ/é¢ç»/GC":{"slug":"ç”Ÿæ´»æ‚è°ˆ/é¢ç»/GC","filePath":"ç”Ÿæ´»æ‚è°ˆ/é¢ç»/GC.md","title":"GC","links":[],"tags":[],"content":"Garbage Collection\nå·¥ä½œåŸåˆ™æ˜¯ï¼šåªè¦è¿™å—å†…å­˜è¿˜æœ‰äººåœ¨ç”¨ï¼ˆæœ‰æŒ‡é’ˆæŒ‡å‘å®ƒï¼‰æˆ‘å°±ä¸èƒ½æ‰”ï¼›æ²¡äººæŒ‡å‘å®ƒäº†ï¼Œæˆ‘å°±å›æ”¶ã€‚\nSlice å¯¼è‡´å†…å­˜æ³„éœ²çš„ç»å…¸åœºæ™¯ï¼š æƒ³è±¡ä¸€ä¸‹ï¼Œä½ ä»æœåŠ¡å™¨ä¸‹è½½äº†ä¸€ä¸ª 100MB çš„è¶…å¤§æ–‡ä»¶ï¼ˆæ¯”å¦‚ä¸€æœ¬å°è¯´ï¼‰ï¼Œè¯»åˆ°äº†å†…å­˜é‡Œï¼Œå˜æˆäº†ä¸€ä¸ªå·¨å¤§çš„æ•°ç»„ã€‚\n// 1. è¿™æ˜¯ä¸€ä¸ªå·¨å¤§çš„åˆ‡ç‰‡ï¼Œåº•å±‚æ•°ç»„å ç”¨ 100MB\nbigData := getHugeFile() \n \n// 2. ä½ åªéœ€è¦å‰ 10 ä¸ªå­—èŠ‚ï¼ˆæ¯”å¦‚åªè¦æ ‡é¢˜ï¼‰\ntinySlice := bigData[:10]\n \n// 3. æ­¤æ—¶ï¼Œä½ æŠŠ bigData å¼„ä¸¢æˆ–è€…å‡½æ•°è¿”å›äº†ï¼Œåªç•™ä¸‹äº† tinySlice\nreturn tinySlice\n\nè¡¨é¢çœ‹ï¼š tinySlice åªæœ‰ 10 ä¸ªå­—èŠ‚ã€‚\nå®é™…ä¸Šï¼š tinySlice çš„ç»“æ„ä½“é‡Œæœ‰ä¸€ä¸ªæŒ‡é’ˆ,æŒ‡å‘åº•å±‚çš„é‚£ä¸ªæ•°ç»„\nç»“æœï¼š åªè¦ tinySlice è¿˜æ´»ç€ï¼Œä¿æ´é˜¿å§¨ï¼ˆGCï¼‰å°±ä¼šè®¤ä¸ºï¼šâ€œå“¦ï¼Œé‚£ä¸ª 100MB çš„æ•°ç»„è¿˜æœ‰äººï¼ˆtinySliceï¼‰æŒ‡ç€å®ƒå‘¢ï¼Œä¸èƒ½æ‰”ã€‚â€\nåæœï¼š ä¸ºäº†è¿™ 10 ä¸ªå­—èŠ‚çš„å°æ•°æ®ï¼Œä½ å¼ºè¡Œå ç”¨äº† 100MB çš„å†…å­˜ä¸é‡Šæ”¾ã€‚è¿™å°±æ˜¯å†…å­˜æ³„éœ²ã€‚\n\nè§£å†³åŠæ³•:"},"ç”Ÿæ´»æ‚è°ˆ/é¢ç»/summary":{"slug":"ç”Ÿæ´»æ‚è°ˆ/é¢ç»/summary","filePath":"ç”Ÿæ´»æ‚è°ˆ/é¢ç»/summary.md","title":"summary","links":[],"tags":[],"content":"ä¸€ã€ Go è¯­è¨€åŸºç¡€ï¼ˆé‡ç¾åŒºï¼Œå¿…é—®ï¼‰\né¢è¯•å®˜éå¸¸å–œæ¬¢é—®åº•å±‚å®ç°ï¼Œç‰¹åˆ«æ˜¯ Slice å’Œ GMPï¼Œå‡ ä¹æ¯åœºå¿…é¢ã€‚\n\n\nSlice (åˆ‡ç‰‡) â€”â€” å‡ºç°é¢‘ç‡ï¼šâ­â­â­â­â­\n\n\nåº•å±‚åŸç†ï¼š æ•°ç»„æŒ‡é’ˆ + é•¿åº¦ (len) + å®¹é‡ (cap)ã€‚\n\n\næ‰©å®¹æœºåˆ¶ï¼š ä»€ä¹ˆæ—¶å€™ç¿»å€ï¼Ÿä»€ä¹ˆæ—¶å€™ 1.25 å€ï¼Ÿã€‚\n\n\nå¼•ç”¨ vs å¤åˆ¶ï¼š ä¼ é€’ Slice æ˜¯å€¼ä¼ é€’è¿˜æ˜¯å¼•ç”¨ä¼ é€’ï¼Ÿï¼ˆç­”æ¡ˆæ˜¯å€¼ä¼ é€’ï¼Œä½†å› ä¸ºæŒæœ‰åº•å±‚æ•°ç»„æŒ‡é’ˆï¼Œæ‰€ä»¥ä¿®æ”¹å…ƒç´ ä¼šå½±å“åŸæ•°ç»„ï¼Œä½† append å¯èƒ½ä¼šå¯¼è‡´æ‰©å®¹æ¢æ•°ç»„ï¼‰ã€‚\n\n\n\n\nGMP æ¨¡å‹ â€”â€” å‡ºç°é¢‘ç‡ï¼šâ­â­â­â­â­\n\nGã€Mã€P åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿè°ƒåº¦æµç¨‹æ˜¯æ€æ ·çš„ï¼Ÿã€‚\n\n\n\nMap (å­—å…¸) â€”â€” å‡ºç°é¢‘ç‡ï¼šâ­â­â­â­\n\n\nåº•å±‚ç»“æ„ï¼Ÿæ˜¯æœ‰åºè¿˜æ˜¯æ— åºçš„ï¼Ÿï¼ˆæ— åºï¼‰ã€‚\n\n\nå¹¶å‘è¯»å†™ä¼š Panic å—ï¼Ÿï¼ˆä¼šï¼Œæ€ä¹ˆè§£å†³ï¼Ÿç”¨ sync.Map æˆ–åŠ é”ï¼‰ã€‚\n\n\n\n\nChannel (é€šé“) â€”â€” å‡ºç°é¢‘ç‡ï¼šâ­â­â­â­\n\n\næœ‰ç¼“å†² vs æ— ç¼“å†²çš„åŒºåˆ«ã€‚\n\n\nå‘å…³é—­çš„ channel è¯»/å†™ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿï¼ˆå†™ä¼š panicï¼Œè¯»ä¼šè¿”å›é›¶å€¼ï¼‰ã€‚\n\n\n\n\nContext &amp; Defer\n\n\ndefer çš„æ‰§è¡Œé¡ºåºï¼ˆæ ˆï¼Œåè¿›å…ˆå‡ºï¼‰ã€‚\n\n\ncontext å¦‚ä½•åšè¶…æ—¶æ§åˆ¶ï¼Ÿã€‚\n\n\n\n\n\näºŒã€ MySQL æ•°æ®åº“ï¼ˆç»“åˆä½ çš„ MiniSQL é¡¹ç›®çœ‹ï¼‰\nè¿™éƒ¨åˆ†ä½ ç»“åˆä½ çš„é¡¹ç›®å¤ä¹ ï¼Œæ•ˆæœä¼šç¿»å€ã€‚\n\n\nç´¢å¼• (Index) â€”â€” å‡ºç°é¢‘ç‡ï¼šâ­â­â­â­â­\n\n\nB+ æ ‘ï¼š ä¸ºä»€ä¹ˆè¦ç”¨ B+ æ ‘ï¼Ÿå’Œ B æ ‘åŒºåˆ«ï¼Ÿã€‚\n\n\nå¤±æ•ˆåœºæ™¯ï¼š where æ¡ä»¶ã€like æ¨¡ç³ŠæŸ¥è¯¢ã€æœ€å·¦å‰ç¼€åŸåˆ™ã€‚\n\n\nåˆ†ç±»ï¼š èšç°‡ç´¢å¼• vs éèšç°‡ç´¢å¼•ã€‚\n\n\n\n\näº‹åŠ¡ (Transaction) â€”â€” å‡ºç°é¢‘ç‡ï¼šâ­â­â­â­\n\n\nACID ç‰¹æ€§ï¼š åŸå­æ€§ã€ä¸€è‡´æ€§ã€éš”ç¦»æ€§ã€æŒä¹…æ€§ã€‚\n\n\néš”ç¦»çº§åˆ«ï¼š è¯»æœªæäº¤ã€è¯»å·²æäº¤ã€å¯é‡å¤è¯»ï¼ˆé»˜è®¤ï¼‰ã€ä¸²è¡ŒåŒ–ã€‚å¦‚ä½•è§£å†³å¹»è¯»ï¼Ÿï¼ˆMVCC + Next-Key Lockï¼‰ã€‚\n\n\n\n\næ…¢æŸ¥è¯¢ä¼˜åŒ–\n\n\nlimit åˆ†é¡µå¤ªæ·±æ€ä¹ˆä¼˜åŒ–ï¼Ÿã€‚\n\n\nexplain å‘½ä»¤æ€ä¹ˆçœ‹ï¼Ÿ\n\n\n\n\n\nä¸‰ã€ Redis &amp; åˆ†å¸ƒå¼ï¼ˆè¿›é˜¶åŠ åˆ†é¡¹ï¼‰\nå­—èŠ‚è·³åŠ¨éå¸¸å–œæ¬¢é—® Redisï¼Œå°¤å…¶æ˜¯åˆ†å¸ƒå¼é”ã€‚\n\n\nåŸºç¡€æ•°æ®ç»“æ„\n\nString, List, Hash, Set, ZSet (æœ‰åºé›†åˆï¼Œåº•å±‚æ˜¯è·³è¡¨)ã€‚\n\n\n\nåˆ†å¸ƒå¼é” (é‡ç‚¹)\n\næ€ä¹ˆå®ç°ï¼ŸSETNX æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿæ€ä¹ˆç»­æœŸï¼ˆWatchDog æœºåˆ¶ï¼‰ï¼Ÿã€‚\n\n\n\næ¶ˆæ¯é˜Ÿåˆ— (Kafka)\n\nå¦‚ä½•ä¿è¯æ¶ˆæ¯é¡ºåºï¼Ÿï¼ˆPartitionï¼‰æ¶ˆæ¯ç§¯å‹æ€ä¹ˆåŠï¼Ÿã€‚\n\n\n\n\nå››ã€ è®¡ç®—æœºç½‘ç»œ &amp; æ“ä½œç³»ç»Ÿ\n\n\nTCP/IP\n\n\nä¸‰æ¬¡æ¡æ‰‹ï¼š ä¸ºä»€ä¹ˆä¸æ˜¯ä¸¤æ¬¡ï¼Ÿæœ€åä¸€æ¬¡ ACK ä¸¢äº†æ€ä¹ˆåŠï¼Ÿã€‚\n\n\nè¾“å…¥ä¸€ä¸ª URL åˆ°ç½‘é¡µæ˜¾ç¤ºçš„æµç¨‹ï¼ˆç»å…¸è€é¢˜ï¼‰ã€‚\n\n\n\n\nLinux å‘½ä»¤\n\næŸ¥è¯¢ç«¯å£å ç”¨ã€æŸ¥çœ‹ç£ç›˜/å†…å­˜æ»¡æ²¡æ»¡ (top, df, netstat/lsof)ã€‚\n\n\n\n\näº”ã€ æ‰‹æ’•ç®—æ³• (Code)\nä»é¢ç»çœ‹ï¼Œè€ƒçš„éƒ½æ˜¯ Hot 100 é‡Œçš„ç»å…¸é¢˜ï¼Œæ²¡æœ‰æ€ªé¢˜ã€‚\n\n\né“¾è¡¨ç±»ï¼š åè½¬é“¾è¡¨ã€åè½¬é“¾è¡¨ IIã€‚\n\n\nLRU ç¼“å­˜ï¼š è®¾è®¡ LRUï¼ˆå­—èŠ‚é«˜é¢‘é¢˜ï¼‰ã€‚\n\n\nå­—ç¬¦ä¸²ï¼š æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²ã€å›æ–‡ä¸²åˆ¤æ–­ã€‚\n\n\næ’åºï¼š å¿«æ’ï¼ˆé—®æœ€åæƒ…å†µï¼‰ã€‚\n\n\nå…¶ä»–ï¼š ä¸‰æ•°ä¹‹å’Œã€‚\n\n"},"è¯¾ç¨‹ç¬”è®°/mySQL/å…¶ä»–/ç´¢å¼•":{"slug":"è¯¾ç¨‹ç¬”è®°/mySQL/å…¶ä»–/ç´¢å¼•","filePath":"è¯¾ç¨‹ç¬”è®°/mySQL/å…¶ä»–/ç´¢å¼•.md","title":"ç´¢å¼•","links":[],"tags":[],"content":""},"è¯¾ç¨‹ç¬”è®°/å†…å­˜ä¸­çš„æ ˆ":{"slug":"è¯¾ç¨‹ç¬”è®°/å†…å­˜ä¸­çš„æ ˆ","filePath":"è¯¾ç¨‹ç¬”è®°/å†…å­˜ä¸­çš„æ ˆ.md","title":"å†…å­˜ä¸­çš„æ ˆ","links":[],"tags":[],"content":""},"è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/01-introduction":{"slug":"è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/01-introduction","filePath":"è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/01 introduction.md","title":"01 introduction","links":["tags/flashcard"],"tags":["flashcard"],"content":"DECK: CS::OS\næ“ä½œç³»ç»Ÿæ¦‚è¿°\nå®šä¹‰ä¸è®¾è®¡ç›®æ ‡\næ“ä½œç³»ç»Ÿï¼š\n\nèŒèƒ½ï¼šèµ„æºç®¡ç†ç³»ç»Ÿ\nå­˜åœ¨ï¼šæœ¬è´¨ä¸Šæ˜¯è½¯ä»¶ç¨‹åº\n\næœ€åŸºç¡€æœ€ä¸­å¤®çš„éƒ¨åˆ†æ˜¯å†…æ ¸kernel\n\n\n\nè®¾è®¡ç›®æ ‡ï¼š\n\nå¯é æ€§å’Œå®‰å…¨æ€§\n\nå¼‚å¸¸å¤„ç†æœºåˆ¶ï¼šä¸­æ–­\næƒé™ç®¡ç†ç³»ç»Ÿï¼šç‰¹æƒ\n\n\næ˜“ç”¨æ€§\n\næ–¹ä¾¿ç”¨æˆ·ä½¿ç”¨ç³»ç»Ÿèµ„æºï¼šç³»ç»Ÿè°ƒç”¨\n\n\né«˜æ•ˆæ€§\n\nä»»åŠ¡æ‰§è¡Œè®¾è®¡ï¼šæ‰¹å¤„ç†ç³»ç»Ÿ-ã€‹åˆ†æ—¶ç³»ç»Ÿ\n\n\nå…¬å¹³æ€§\n\nè¿›ç¨‹ç®¡ç†çš„å†²çªä¸é¥¥é¥¿starvation\n\n\nå¯æ‹“å±•æ€§ã€æ˜“ç»´æŠ¤æ€§\n\nè®¾è®¡ä¸å®ç°\nä»ç›®æ ‡/éœ€æ±‚å¼€å§‹ï¼šuser goals &amp; system goals\næœºåˆ¶å’Œç­–ç•¥ç›¸åˆ†ç¦» flashcard\n\n\næœºåˆ¶/è§„åˆ™è¢«å­˜åœ¨é…’åº—çš„ä¸­å¿ƒæœåŠ¡å™¨ä¸Šï¼ˆdatabaseï¼‰ å’Œç­–ç•¥åˆ†ç¦»å¼€äº†,æ¯”å¦‚é…ç½®æ–‡ä»¶å°±ç›¸å½“äºpolicy\n\n\n\n                  \n                  ä¾‹é¢˜ \n                  \n                \n\n\n\n\næ“ä½œç³»ç»Ÿæä¾›çš„ä¸‰ç§èƒ½åŠ›\nå¤ç”¨ multiplexing\n\ncpuå¤ç”¨ å¤šä¸ªç¨‹åºå…±äº« æ—¶é—´åˆ†é…å¤ç”¨\nå†…å­˜å¤ç”¨ å¤šä¸ªè¿›ç¨‹  ç©ºé—´åˆ†é…å¤ç”¨\n\néš”ç¦»  isolation\n\nç¨‹åºä¹‹é—´ä¸èƒ½è®¿é—®å¯¹æ–¹çš„æ•°æ®\næ•°æ®èŒƒå›´æƒé™çš„éš”ç¦»\nç”¨æˆ· kernel\n\næŠ½è±¡ abstraction\nè¿›ç¨‹é—´é€šè®¯ interaction\næ“ä½œç³»ç»Ÿçš„æ•´ä½“è®¾è®¡\nè®¡ç®—æœºç³»ç»Ÿæ¶æ„\n\næ ¹æ®å¤„ç†å™¨çš„æ•°é‡å’Œç»„ç»‡å½¢å¼ï¼Œå­˜åœ¨ä¸‰ç§è®¡ç®—æœºç³»ç»Ÿæ¶æ„\n\nå•å¤„ç†å™¨\n\næœ‰ä¸”ä»…æœ‰ä¸€ä¸ªå•æ ¸é€šç”¨å¤„ç†å™¨general-purpose processor\nå¯ä»¥æœ‰è‹¥å¹²ä¸“ç”¨å¤„ç†å™¨ç”¨æ¥å¤„ç†ç‰¹å®šæŒ‡ä»¤ï¼Œå¹¶ä¸è¿è¡Œçº¿ç¨‹\n\n\nå¤šå¤„ç†å™¨ç³»ç»Ÿ\n\næœ‰å¤šä¸ªå•æ ¸é€šç”¨å¤„ç†å™¨çš„ç³»ç»Ÿï¼Œå¤„ç†å™¨å…±äº«åŒä¸€å—ä¸»å†…å­˜ï¼Œé€šè¿‡æ€»çº¿æˆ–è€…äº¤æ¢ç½‘ç»œè¿æ¥\nå¢åŠ äº†å¤„ç†è¥¿æ•°é‡èƒ½å¤Ÿå¢åŠ ååé‡throughputï¼Œä¹Ÿå°±æ˜¯å•ä½æ—¶é—´å†…å¤„ç†çš„ä»»åŠ¡æ•°é‡ï¼Œä½†æ˜¯å¢åŠ å¹¶ä¸çº¿æ€§ï¼ˆå¤„ç†å™¨ä¹‹é—´é€šä¿¡éœ€è¦æ—¶é—´å’Œé¢å¤–å¼€é”€ï¼‰\n\n\né›†ç¾¤ç³»ç»Ÿ\n\né€šè¿‡å†—ä½™å®ç°é«˜å¯ç”¨æœåŠ¡ï¼Œé€šè¿‡å¹¶è¡Œå®ç°é«˜æ€§èƒ½è®¡ç®—ï¼Œç”±å¤šä¸ªç‹¬ç«‹çš„è®¡ç®—æœºç³»ç»Ÿä½œä¸ºèŠ‚ç‚¹ï¼Œé€šè¿‡é«˜é€Ÿé€šä¿¡ç½‘ç»œç›¸äº’è¿æ¥å½¢æˆ\nåˆ†ä¸ºå¯¹ç§°å’Œä¸å¯¹ç§°ä¸¤ç§ï¼Œå¯¹ç§°é›†ç¾¤ä¸­å„ä¸ªèŠ‚ç‚¹äº’ç›¸ç›‘ç£ï¼Œä¸å¯¹ç§°é›†ç¾¤ä¸­å­˜åœ¨â€œæ›¿è¡¥â€ç›‘ç£å·¥ä½œä¸­çš„èŠ‚ç‚¹ï¼Œæˆ–è€…æ¥æ›¿æœ‰é—®é¢˜èŠ‚ç‚¹çš„å·¥ä½œã€‚\n\n\n\næ“ä½œç³»ç»Ÿçš„ä»»åŠ¡æ‰§è¡Œè®¾è®¡\n1. ï¼ˆå•é“ï¼‰æ‰¹å¤„ç†ç³»ç»Ÿ  flashcard\nbatch processing system\n\næ‰¹å¤„ç†ï¼šè‹¥å¹²ä»»åŠ¡è¢«ä½œä¸ºä¸€æ•´æ‰¹äº¤ä»˜ç»™æ“ä½œç³»ç»Ÿï¼Œæ“ä½œç³»ç»Ÿä¼šè‡ªåŠ¨æŒ‰ç…§é¡ºåºä¸²è¡Œserialæ‰§è¡Œä»»åŠ¡\nå•é“ï¼šä¸€æ®µæ—¶é—´å†…å†…å­˜ä¸­åªæœ‰ä¸€é“ç¨‹åºåœ¨è¿è¡Œï¼ˆè¿›ç¨‹process ï¼‰ï¼Œç»“æŸåå†åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªä»»åŠ¡\né—®é¢˜ï¼šå½“å­˜åœ¨I/Oæ“ä½œä»»åŠ¡æ—¶ï¼Œç”±äºè€—æ—¶ï¼ŒCPUé•¿æ—¶é—´å¤„äºç©ºé—²çŠ¶æ€\n\n\n\n                  \n                  I/O \n                  \n                \n\nå³CPUå’ŒRAMï¼ˆä¸»å†…å­˜ï¼‰ä¸â€œå¤–éƒ¨ä¸–ç•Œâ€ä¹‹é—´è¿›è¡Œæ•°æ®äº¤æ¢çš„è¿‡ç¨‹\n\nå­˜å‚¨è®¾å¤‡ï¼ˆç£ç›˜IOï¼‰\nç½‘ç»œè®¾å¤‡ï¼ˆç½‘ç»œIOï¼‰\näººæœºäº¤äº’è®¾å¤‡\nå…¶ä»–å¤–éƒ¨è®¾å¤‡\n\nç‰¹ç‚¹ï¼šé€Ÿåº¦æ…¢ã€‚\n\n\n\n2. å¤šé“æ‰¹å¤„ç†ç³»ç»Ÿ flashcard\nmultiprogramming batch processing system\n\nä¸€æ®µæ—¶é—´å†…ï¼Œå››ä¸ªè¿›ç¨‹ ï¼ˆjob=processï¼‰éƒ½åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå¹¶å‘è¿è¡Œï¼ˆåœ¨Aå®Œæˆä¹‹å‰Bå¯èƒ½ä¹Ÿå¼€å§‹äº†ï¼‰ã€‚å½“å½“å‰ job å‘ç”Ÿ I/O æ—¶ï¼Œæ“ä½œç³»ç»Ÿè´Ÿè´£è®© CPU è½¬è€Œè¿è¡Œå¦ä¸€ä¸ª jobã€‚\nä½†å¾®è§‚æ¥çœ‹ï¼Œå¤šé“æ‰¹å¤„ç†ä»ç„¶æ˜¯é¡ºåºä¸²è¡Œçš„ã€‚\nä¸å…³å¿ƒè¿è¡Œçš„å…ˆåé¡ºåºï¼ˆä»»æ„ï¼‰ï¼Œåªè¦åŒæ—¶åŠ è½½è¿›å»å°±å«åšmultiprogrammingã€‚è°ƒåº¦çš„éƒ¨åˆ†æ˜¯ç”±jobscheduleå®Œæˆï¼ˆæ‰¹å¤„ç†\nåŸå› ï¼šå†…å­˜å¤§ï¼Œcpuå¼ºï¼Œæœ‰èƒ½åŠ›åŒæ—¶å¤„ç†4ä¸ªè¿›ç¨‹ï¼Œå› æ­¤å°±å¯ä»¥æå‡ç¡¬ä»¶çš„ä½¿ç”¨æ•ˆæœ\nneeded forç¡¬ä»¶è®¡ç®—èµ„æºCPU utlization\näº¤äº’æ€§å·®ï¼Œåœ¨å®Œæˆä»»åŠ¡å‰ç”¨æˆ·æ— æ³•æ“ä½œ\n\n\n\n                  \n                  å¹¶å‘ä¸å¹¶è¡Œ \n                  \n                \n\nå¹¶å‘**(concurrency)**æ˜¯æŒ‡ä¸¤ä¸ªæˆ–å¤šä¸ªäº‹ä»¶åœ¨åŒä¸€æ—¶é—´é—´éš”å†…å‘ç”Ÿï¼Œè€Œå¹¶è¡Œæ˜¯æŒ‡ä¸¤ä¸ªæˆ–å¤šä¸ªäº‹ä»¶åœ¨åŒä¸€æ—¶åˆ»å‘ç”Ÿã€‚é€»è¾‘ä¸Šï¼Œå¹¶è¡Œæ˜¯å¹¶å‘çš„å­é›†ã€‚\n\n3. åˆ†æ—¶ç³»ç»Ÿ flashcard\ntimesharing systems/multitasking\n\nmultiprogrammingçš„é€»è¾‘æ‹“å±•ï¼šä¿ç•™å…¶å†…å­˜ä¸­æœ‰å¤šä¸ªè¿›ç¨‹çš„å¹¶å‘ç‰¹ç‚¹\nå¤„ç†å™¨ä¼šåœ¨jobsä¸Šé¢è½®æµåœ°èµ‹äºˆcpuèµ„æºï¼Œåœ¨è¿›ç¨‹é—´ä¸æ–­åˆ‡æ¢ï¼ˆå¾ˆçŸ­çš„æ—¶é—´å†…ï¼‰ï¼Œè®©ç”¨æˆ·å¯Ÿè§‰ä¸åˆ°è¿›ç¨‹çš„åˆ‡æ¢/cpuçš„å…±äº«ï¼Œè¾¾åˆ°è¿‘ä¼¼äºå¹¶è¡Œçš„æ•ˆæœã€‚\næ³¨é‡çš„æ˜¯ç”¨æˆ·çš„äº¤äº’æ€§interactivityï¼Œå…è®¸å¤šä¸ªç”¨æˆ·åŒæ—¶ä½¿ç”¨åŒä¸€å°è®¡ç®—æœºï¼Œæ‰€æœ‰ä»»åŠ¡ä¹‹é—´äº’ç›¸ç‹¬ç«‹ï¼Œäº’ä¸å¹²æ‰°ã€äº’ä¸é˜»å¡ï¼Œå› æ­¤ä»»åŠ¡çš„æœ€é•¿å‘¨è½¬æ—¶é—´å‡å°‘ï¼Œç”¨æˆ·çš„æ“ä½œä¹Ÿä¼šè¢«åŠæ—¶å“åº”ï¼Œå®ç°äº†æ›´æ–¹ä¾¿è¿›è¡Œäººæœºå¯¹è¯ã€‚\nå¯¹ç¡¬ä»¶é…ç½®æœ‰è¾ƒé«˜è¦æ±‚ï¼ˆæ¯ä¸ªç”¨æˆ·çš„terminalï¼‰å’Œè°ƒåº¦ç®—æ³•\n\n\næ“ä½œç³»ç»Ÿçš„ç»“æ„è®¾è®¡\nå®/å·¨å†…æ ¸(monolithic-kernels) flashcard\nä¹Ÿå«å•å†…æ ¸æˆ–å¤§å†…æ ¸\n\nå°†æ‰€æœ‰ä¸»è¦åŠŸèƒ½ç´§å¯†è€¦åˆï¼Œæ“ä½œç³»ç»Ÿæ•ˆç‡é«˜\nç»´æŠ¤ååˆ†å›°éš¾ï¼›æŸä¸ªéƒ¨åˆ†å‡ºç°å›°éš¾ï¼Œæ•´ä¸ªç³»ç»Ÿéƒ½ä¼šå—å½±å“ã€‚\n\n\n\nåˆ†å±‚è®¾è®¡(layer approach)\n\nå°†ç³»ç»Ÿåˆ†ä¸ºè‹¥å¹²å±‚ï¼Œåº•å±‚ä¸ºç¡¬ä»¶ï¼Œé¡¶å±‚ä¸ºç”¨æˆ·æ¥å£ï¼Œç¬¬Â iÂ å±‚åªè°ƒç”¨iâˆ’1Â å±‚æä¾›çš„æ¥å£ã€‚æ¯ä¸€å±‚éƒ½å®ç°è‰¯å¥½çš„å°è£…ï¼Œäºæ˜¯å¼€å‘è¿‡ç¨‹ä¸­åªéœ€è¦é€æ­¥å®ç°å¹¶è°ƒè¯•éªŒè¯æ¯ä¸€å±‚ï¼Œå†é€çº§å‘ä¸Šå¼€å‘å³å¯ï¼›åœ¨ç»´æŠ¤æˆ–æ‰©å±•è¿‡ç¨‹ä¸­ï¼Œåªè¦ä¿®æ”¹æ¯ä¸€å±‚çš„å†…éƒ¨å®ç°ï¼Œè€Œä¸éœ€è¦ä¿®æ”¹å…¶å®ƒå±‚çš„ä»£ç ï¼Œè¿™æ ·å°±å¤§å¤§é™ä½äº†å¼€å‘å’Œç»´æŠ¤çš„éš¾åº¦ã€‚Â \nç”±äºæ¯æ¬¡æ‰§è¡Œä¸€ä¸ªåŠŸèƒ½éƒ½éœ€è¦ä¸Šä¸‹è·¨è¶Šå¤šå±‚ï¼Œå‘ç”Ÿå¤šæ¬¡æ¥å£è°ƒç”¨ï¼Œåˆ†å±‚è®¾è®¡ä¸‹çš„ç³»ç»Ÿæ•ˆç‡å¾€å¾€éƒ½å—åˆ°é™åˆ¶ï¼›ä¸ä»…å¦‚æ­¤ï¼Œè¦æƒ³çœŸæ­£æ„ä¹‰ä¸Šå®ç°è‰¯å¥½çš„åˆ†å±‚è®¾è®¡ï¼Œå°±éœ€è¦å¯¹å„å±‚æœ‰è‰¯å¥½çš„å®šä¹‰ï¼Œè¿™ä¸ªè®¾è®¡éš¾åº¦æ˜¯ä¸å°çš„ã€‚\n\nå¾®å†…æ ¸(micro-kernels) flashcard\n\nå°†ä¸æ˜¯å¿…è¦çš„ä¸œè¥¿éƒ½ä»å†…æ ¸æ‹¿å‡ºå»ï¼Œæ”¾åˆ°ç”¨æˆ·ç©ºé—´ä»¥ç”¨æˆ·æ€æ‰§è¡Œã€‚åªæœ‰é€šè®¯ã€å†…å­˜ç®¡ç†ã€è¿›ç¨‹ç®¡ç†ç­‰åŸºæœ¬åŠŸèƒ½ç›´æ¥è¿è¡Œåœ¨å†…æ ¸æ€ã€‚å…¶ä»–åŠŸèƒ½éƒ¨ä»¶é€šè¿‡æ¶ˆæ¯ä¼ é€’æœºåˆ¶å’Œå†…æ ¸äº’åŠ¨ã€‚\nç»´æŠ¤æ‰©å±•å˜å¾—å®¹æ˜“ï¼Œè‡ªèº«æ•ˆç‡å¾—åˆ°æå‡ï¼Œå¯é æ€§ä¹Ÿæé«˜äº†ã€‚ä½†æ˜¯å¾ˆå¤šæ¨¡å—ç§»åˆ°usermodeä¸å®‰å…¨\n\n\n\næ¨¡å—åŒ–è®¾è®¡(modules approach)\næ¨¡å—-æ¥å£æ³•ã€‚ç†æƒ³çš„è®¾è®¡å¯ä»¥è®©ç³»ç»Ÿå¤šçº¿å¹¶è¡Œï¼Œåªè¦å•†é‡å¥½æ¥å£å°±èƒ½ç‹¬ç«‹å®ç°ï¼Œç»´æŠ¤å’Œæ‰©å±•å®¹æ˜“ã€‚ä½†æ˜¯è®¾è®¡å¼€å‘å¾ˆå›°éš¾ã€‚\næ··åˆç³»ç»Ÿ(hybrid systems)\nå®å†…æ ¸å’Œå¾®å†…æ ¸çš„æ€è·¯ç»“åˆèµ·æ¥ï¼Œæ˜¯ç›®å‰ä¸»æµçš„æ“ä½œç³»ç»Ÿæ¨¡å¼\næ“ä½œç³»ç»Ÿçš„è¿è¡ŒåŸç†\nä¸­æ–­interrupts\nä¸­æ–­ï¼ˆå¹¿ä¹‰ï¼‰æ˜¯è´¯ç©¿ç°ä»£æ“ä½œç³»ç»Ÿçš„ä¸€ä¸ªé‡è¦æŠ€æœ¯ï¼Œå®ƒä½¿å¾—â€œè®¡åˆ’ä¹‹å¤–â€çš„äº‹æƒ…å¯ä»¥åŠæ—¶çš„è¢«å‘ŠçŸ¥å¹¶å¤„ç†ï¼ˆè®©äº§ç”Ÿæ„å¤–çš„äººè‡ªè¡Œä¸ŠæŠ¥è¿™äº›æ„å¤–ï¼‰ ç°ä»£æ“ä½œç³»ç»Ÿéƒ½æ˜¯ä¸­æ–­é©±åŠ¨çš„\ninterrupt-request line flashcard\n\nCPU æœ‰ç§°ä¸ºÂ interrupt-request lineÂ çš„çº¿è·¯ã€‚CPUä¼šåœ¨æ¯ä¸€æ¡æŒ‡ä»¤ç»“æŸåæ£€æµ‹æ˜¯å¦æœ‰ä¸­æ–­å‘ç”Ÿï¼Œå¹¶ä¼šè¯»å– interrupt number å¹¶ä¸”ä»¥æ­¤ä½œä¸º interrupt vector ä¸­çš„ index æ¥è·³è½¬åˆ°å¯¹åº”çš„ interrupt-handler routineã€‚\n\n\nä¸­æ–­å‘é‡è¡¨ interrupt vector table flashcard\nä¸­æ–­å‘é‡è¡¨æ˜¯å¿«é€Ÿå®šä½ä¸­æ–­å¤„ç†æ–¹æ³•çš„æ‰‹æ®µã€‚é€šè¿‡ä¸­æ–­å·æ¥ç´¢å¼•ä¸­æ–­å¤„ç†æ–¹æ³•ï¼Œå®ç°äº†ä¸€ç§â€œéšæœºè®¿é—®â€ï¼Œå¤§å¤§åŠ é€Ÿäº†ä¸­æ–­å¤„ç†çš„é€Ÿåº¦ã€‚\n\nåˆ†ç±»\n\nç¡¬ä»¶å¼•èµ·çš„ä¸­æ–­ï¼ˆå¤–ä¸­æ–­ï¼‰\nè½¯ä»¶å¼•èµ·çš„ä¸­æ–­ï¼ˆå†…ä¸­æ–­ï¼‰trap\n\nerror éä¸»åŠ¨çš„\nsystem call ç¨‹åºä¸»åŠ¨çš„ è°ƒç”¨æ“ä½œç³»ç»Ÿçš„åŠŸèƒ½\n\n\n\n\n\n                  \n                  riscvçš„å¯¹åº”æœ¯è¯­åŒºåˆ« \n                  \n                \n\n\nä¸­æ–­traps\n\nç¡¬ä»¶ä¸­æ–­ interrupts\nè½¯ä»¶ä¸­æ–­\n\nerrorâ†’exceptions\nç³»ç»Ÿè°ƒç”¨â†’ecallsï¼ˆç¯å¢ƒè°ƒç”¨ï¼‰\n\n\n\n\n\n\n\n\n\n                  \n                  cause a page fault \n                  \n                \n\nç¼ºé¡µ è®¿é—®memoryåœ°å€çš„æ—¶å€™ç”±äºå¯¹åº”çš„åœ°å€å†…å®¹éæ³•è€Œäº§ç”Ÿçš„ä¸­æ–­\n\n\n\nè¿‡ç¨‹\n\n\ndevice driver I/Oä¸æ“ä½œç³»ç»Ÿä¹‹é—´çš„é©±åŠ¨\nå·¦è¾¹ï¼šCPU\nå³è¾¹ï¼šI/O controller\nI/Ocontrollerå‘èµ·ä¸­æ–­ä¹‹åï¼ŒCPUå¯¹å…¶è¿›è¡Œå¤„ç†ï¼Œè°ƒç”¨interrupt handlerï¼Œå¤„ç†å¥½ä¹‹åreturnåˆ°è¢«ä¸­æ–­çš„ä¸‹ä¸€æ¡æŒ‡ä»¤é‡æ–°å¼€å§‹è¿è¡Œ çš„è¿™ä¹ˆä¸€ä¸ªå¾ªç¯è¿‡ç¨‹\n\næ³¢åŠ¨è¡¨ç¤ºçŠ¶æ€çš„æ”¹å˜\n\n\n\n                  \n                  ä¸­æ–­çŠ¶æ€çš„ä¿å­˜ \n                  \n                \n\nä¸ºäº†ä¿è¯ä¸­æ–­å¤„ç†å®Œæˆåä»èƒ½ç»§ç»­å½“å‰ä»»åŠ¡ï¼Œæ“ä½œç³»ç»Ÿéœ€è¦ä¿å­˜å½“å‰ä»»åŠ¡çš„çŠ¶æ€ï¼Œä»¥ä¾¿å®Œæˆä¸­æ–­å¤„ç†åæ¢å¤å½“å‰ä»»åŠ¡çš„çŠ¶æ€ã€‚\n\n\nä¸­æ–­å†²çª flashcard\nä¸­æ–­å¤„ç†ä¹ŸåŒæ ·éœ€è¦èµ„æºï¼Œè¿™æ„å‘³ç€ä¸­æ–­ä¹Ÿæœ‰å¯èƒ½äº§ç”Ÿå†²çª\n\nä¼˜å…ˆå¤„ç†ä¼˜å…ˆçº§é«˜çš„ä¸­æ–­ï¼šä¸­æ–­åˆ†çº§\n\nè™½ç„¶ä½çº§çš„ä¸­æ–­å¯ä»¥è¢«é«˜çº§çš„ä¸­æ–­æ‰“æ–­ï¼Œä½†æ˜¯ä¿å­˜å’Œæ¢å¤ç°åœºçŠ¶æ€çš„è¿‡ç¨‹æ˜¯ä¸åº”å½“è¢«æ‰“æ–­çš„ã€‚\n\n\nåŸå­æ€§è¡Œä¸ºä¸å¯è¢«ä¸­æ–­ï¼Œé‡è¦ä»»åŠ¡ä¸åº”è¯¥è¢«ä¸­æ–­ï¼šä¸­æ–­å±è”½\n\n\n\n                  \n                  ä¸­æ–­è¯·æ±‚çº¿ \n                  \n                \n\n\nmaskable interrupt-request line å¯å±è”½çš„ä¸­æ–­ å®ƒå¯ä»¥åœ¨æ‰§è¡Œä¸å¯ä¸­æ–­çš„å…³é”®ç¨‹åºä¹‹å‰è¢« CPU å…³é—­ï¼Œç­‰åˆ°å…³é”®ç¨‹åºç»“æŸåå†è§£é™¤å±è”½å¤„ç†å…¶ä¸­çš„ä¸­æ–­ã€‚\nÂ 2. non-maskable interrupt-request line ä¸å¯å±è”½çš„ä¸­æ–­ ä¸ºä¸€äº›ä¸å¯æ¢å¤çš„å†…å­˜é”™è¯¯ç­‰äº‹ä»¶ä¿ç•™\n\n\n\n\nè®¡æ—¶å™¨ timer flashcard\n\nè®¡æ—¶å™¨éœ€è¦ä¸€ä¸ªå›ºå®šé¢‘ç‡çš„æ—¶é’Ÿä»¥åŠä¸€ä¸ªè®¡æ•°å™¨ï¼Œåœ¨æ¯ä¸ªæ—¶é’Ÿå‘¨æœŸä»¤è®¡æ•°å™¨å‡ 1ï¼Œå½“è®¡æ•°å™¨å½’é›¶æ—¶äº§ç”Ÿä¸­æ–­ï¼Œå‘Šè¯‰æ“ä½œç³»ç»Ÿå®šçš„æ—¶å·²ç»åˆ°äº†\nåŠŸèƒ½è™½ç„¶åŸºç¡€ä½†æ˜¯ååˆ†é‡è¦ï¼Œä¾‹å¦‚åˆ†æ—¶ç³»ç»Ÿä¸­å°±éœ€è¦è®¡æ•°å™¨æ¥æ§åˆ¶æ—¶é—´ç‰‡çš„é•¿åº¦ï¼Œåˆæ¯”å¦‚æ“ä½œç³»ç»Ÿéœ€è¦å®šæœŸæ£€æŸ¥å†…å­˜ä¸­çš„è¿›ç¨‹ï¼Œä»¥é˜²æ­¢è¿›ç¨‹ä¸€ç›´å ç”¨ç³»ç»Ÿèµ„æº\n\n\nç‰¹æƒæ¨¡å¼privileged mode\nå…è®¸ç”¨æˆ·ç¨‹åºæ‰§è¡Œå¸¸è§„æ“ä½œï¼Œå±é™©æ“ä½œç”±ä¸“ä¸šäººå£«æ‰§è¡Œã€‚\nå·¥ä¸šä¸Šç‰¹æƒæ¨¡å¼æœ‰è®¸å¤šå¤æ‚çš„å®ç°å½¢å¼ï¼Œæ¯”å¦‚\nåŒæ¨¡å¼(dual-modeï¼‰ flashcard\n\nç”¨æˆ·æ€  user mode\nå†…æ ¸æ€  kernel mode\nMode bit ä¸º 0ï¼Œè¡¨ç¤º CPU å·¥ä½œåœ¨å†…æ ¸æ€ï¼›mode bit ä¸º 1 æ—¶ï¼ŒCPU å·¥ä½œåœ¨ç”¨æˆ·æ€ã€‚modebitç”±ç‰¹æƒæŒ‡ä»¤è¿›è¡Œç®¡ç†ã€‚\n\n\nç‰¹æƒæŒ‡ä»¤(privileged instruction)\nä¾‹å¦‚ I/O æ§åˆ¶ï¼Œè®¡æ—¶å™¨ç®¡ç†ï¼Œä¸­æ–­ç®¡ç†ç­‰ã€‚è¿™äº›æŒ‡ä»¤åªèƒ½åœ¨å†…æ ¸æ€ä¸‹æ‰§è¡Œï¼Œè€Œç”¨æˆ·æ€ä¸‹æ‰§è¡Œè¿™äº›æŒ‡ä»¤æ—¶ä¼šè®¤ä¸ºè¿™æ¡æŒ‡ä»¤ä¸å­˜åœ¨ã€‚\n\n\n                  \n                  æ˜¯ä¸æ˜¯åœ¨kernalmodeä¸‹è¿è¡Œçš„æ‰€æœ‰æŒ‡ä»¤éƒ½æ˜¯ç‰¹æƒæŒ‡ä»¤ï¼Ÿ \n                  \n                \n\nä¸æ˜¯ï¼Œéç‰¹æƒæŒ‡ä»¤ä¹Ÿå¯ä»¥è¿è¡Œåœ¨kernalmodeä¸‹ï¼Œä½†æ˜¯ç‰¹æƒæŒ‡ä»¤åªèƒ½åœ¨kernalmodeä¸‹è¿è¡Œ\n\n\nåŒæ¨¡å¼ä¹‹é—´çš„äº¤äº’\nç”¨æˆ·å§”æ‰˜è¿›è¡Œå±é™©æ“ä½œçš„è¿‡ç¨‹ï¼šæ¯”å¦‚writing data to a disk drive ï¼Œç”¨æˆ·ç¨‹åºæƒ³è¦ä½¿ç”¨kernalæä¾›çš„æœåŠ¡ï¼Œéœ€è¦è°ƒç”¨ç³»ç»Ÿè°ƒç”¨ï¼ˆsystem callï¼‰åˆ‡æ¢åˆ°kernelmodeã€‚\n\nå…·ä½“å®ç°ä¸Šå³å‘ç”Ÿè½¯ä¸­æ–­ï¼ˆtrapï¼‰çš„æ—¶å€™\n\nç»†èŠ‚ï¼šå°†usermodeæœ¬èº«æ‰§è¡Œçš„ä¸Šä¸‹æ–‡ä¿å­˜ä¸‹æ¥ä»¥ä¾¿äºæ¢å¤ç­‰\nç³»ç»Ÿè°ƒç”¨å¯èƒ½éœ€è¦ä¼ é€’å‚æ•°ã€‚å‚æ•°å¯ä»¥æ”¾åœ¨å¯„å­˜å™¨é‡Œç›´æ¥ä¼ é€’ï¼›ä¹Ÿå¯ä»¥æ”¾åœ¨ä¸€å—å†…å­˜ä¸­ï¼Œç”¨å¯„å­˜å™¨ä¼ é€’åœ°å€ï¼›ä¹Ÿå¯ä»¥ç”¨æ ˆä¼ é€’ã€‚\n\n\n\n                  \n                  èƒ½å¦è®©ä¸­æ–­è¿è¡Œåœ¨usermodeï¼Ÿ \n                  \n                \n\nä¸è¡Œï¼Œç­‰åŒäºkernelçš„æƒé™å’Œusermodeæ˜¯ä¸€æ ·çš„ï¼Œç ´åäº†éš”ç¦»æ€§ï¼ˆå¤šä¸ªuser programéƒ½å¯¹è®¾å¤‡è¿›è¡Œioï¼‰\n\n\nç³»ç»Ÿè°ƒç”¨\n\nç³»ç»Ÿå‘ç”¨æˆ·ç¨‹åºæä¾›æœåŠ¡çš„ä¸€ä¸ªæ¥å£ï¼Œå®ƒä»¬ç»å¸¸ä»¥ C/C++ å‡½æ•°çš„å½¢å¼å­˜åœ¨ï¼Œå¯¹äºæŸäº›æ¯”è¾ƒæ¥è¿‘åº•å±‚çš„ä»»åŠ¡ï¼Œä¹Ÿå¯èƒ½æ˜¯é€šè¿‡æ±‡ç¼–ç¼–å†™çš„ã€‚\nä½†è¯´åˆ°åº•ï¼Œç³»ç»Ÿè°ƒç”¨è¿˜æ˜¯ç›¸å¯¹åº•å±‚çš„è®¾è®¡ï¼Œé€šå¸¸çš„å¼€å‘å¹¶ä¸åŸºäºå¦‚æ­¤åº•å±‚çš„è®¾è®¡å±•å¼€ã€‚æ›´å¸¸è§çš„æ˜¯åˆ©ç”¨å„ç§æŠ½è±¡å±‚çº§æ›´é«˜çš„Â Application Programming Interface, APIÂ è¿›è¡Œå¼€å‘ã€‚\nAPI æ˜¯ä¸€ä¸ªéå¸¸å¸¸è§çš„æ¦‚å¿µï¼Œåœ¨æˆ‘çœ‹æ¥ç³»ç»Ÿè°ƒç”¨æœ¬èº«ä¹Ÿæ˜¯ä¸€ç§æä¸ºåº•å±‚çš„ APIã€‚API çš„æ ¸å¿ƒæ€æƒ³æ˜¯è®©è°ƒç”¨è€…åªéœ€è¦çŸ¥é“å¦‚ä½•ä¸è¢«è°ƒç”¨è€…äº¤æµä»¥å®ç°ç›®çš„ï¼Œè€Œä¸éœ€è¦å…³å¿ƒå…¶å…·ä½“å®ç°ã€‚è¿™åŒæ—¶ä¹Ÿæš—ç¤ºç€ï¼Œåªè¦ API ä¸€è‡´ï¼ŒåŒæ ·çš„ç¨‹åºåœ¨ä¸åŒçš„å¹³å°ä¸Šä¹Ÿèƒ½ç›´æ¥ç¼–è¯‘åè¿è¡Œã€‚\næ˜¾ç„¶ï¼ŒAPI ä¸ç¼–ç¨‹è¯­è¨€å¾€å¾€æ˜¯å¼ºç›¸å…³çš„ï¼Œç‰¹å®šç¼–ç¨‹è¯­è¨€åœ¨æ“ä½œç³»ç»Ÿä¸Šè¿è¡Œä¹Ÿæ˜¯éœ€è¦ä¸€å®šçš„â€œç¯å¢ƒâ€çš„ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„è¿è¡Œæ—¶ç¯å¢ƒ(run-time environment, RTE)ã€‚RTE é€šå¸¸åŒ…æ‹¬äº†ç¼–è¯‘å™¨(compilers)ã€è§£é‡Šå™¨(interpreters)ã€åº“(libraries)å’Œè£…è½½å™¨(loaders)ç­‰ï¼Œå®ƒä»¬å…±åŒç»„æˆäº†ä¸€ä¸ªå®Œæ•´çš„è¿è¡Œæ—¶ç¯å¢ƒã€‚\n\n\n\n                  \n                  åº“å‡½æ•°ä¸ç³»ç»Ÿè°ƒç”¨ \n                  \n                \n\nåº“å‡½æ•°è¿è¡Œåœ¨ç”¨æˆ·ç©ºé—´è€Œç³»ç»Ÿè°ƒç”¨è¿è¡Œåœ¨å†…æ ¸ç©ºé—´ã€‚å¤§éƒ¨åˆ†åº“å‡½æ•°å¯èƒ½ä½¿ç”¨ç³»ç»Ÿè°ƒç”¨æ¥å®ç°ç›®çš„ã€‚\n\n\n\nsystemcallæ˜¯å‡½æ•° é€šè¿‡interfaceè¢«è°ƒç”¨ ä½†æ˜¯è°ƒç”¨çš„è¿‡ç¨‹æ¯”å‡½æ•°è°ƒç”¨æ›´å¤æ‚ï¼ˆæ ¹æ®systemcontrolçš„indexä¸‹æ ‡å»æŸ¥è¯¢systemcallçš„è¡¨å¾—åˆ°systemcallå…·ä½“çš„å†…å®¹ï¼‰\nç³»ç»Ÿè°ƒç”¨çš„åˆ†ç±»\n\né“¾æ¥å™¨å’Œè£…è½½å™¨\næ“ä½œç³»ç»Ÿåˆ°åº•æ˜¯å¦‚ä½•æ‰§è¡Œä¸€ä¸ªç¨‹åºçš„å‘¢ï¼Ÿä»¥ C ä¸ºä¾‹ï¼Œä¸€ä¸ªå†™å®Œçš„ä»£ç éœ€è¦ç»è¿‡ç¼–è¯‘ã€é“¾æ¥ã€è£…è½½ä¸‰ä¸ªæ­¥éª¤ï¼Œæ‰èƒ½æˆä¸ºä¸€ä¸ªåœ¨å†…å­˜ä¸­çš„ï¼Œå¯ä»¥è¢«æ‰§è¡Œçš„ç¨‹åºã€‚\n\n\nç¼–è¯‘å™¨é¦–å…ˆå°†è‹¥å¹²Â .cÂ æºæ–‡ä»¶ç¼–è¯‘ä¸ºè‹¥å¹²Â .oÂ æ–‡ä»¶ï¼ˆè¿™é‡Œåˆå¹¶äº†é¢„å¤„ç†ã€ç¼–è¯‘ã€æ±‡ç¼–æ­¥éª¤ï¼‰ï¼Œè¿™äº›Â .oÂ æ–‡ä»¶è¢«ç§°ä¸ºå¯é‡å®šä½ç›®æ ‡æ–‡ä»¶(relocatable object file)ï¼Œå…¶å­˜åœ¨å½¢å¼ä¸ºæœºå™¨ç \n\n\néšåé“¾æ¥å™¨å°†è‹¥å¹²Â .oÂ æ–‡ä»¶è¿å¸¦æ‰€éœ€è¦çš„ä¸€äº›åº“æ–‡ä»¶ï¼ˆå¦‚Â .aÂ æ–‡ä»¶ï¼‰é“¾æ¥ä¸ºä¸€ä¸ªå¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶(executable object file)ã€‚\n\n\né™æ€é“¾æ¥å°†åº“æ–‡ä»¶çš„ä»£ç ç›´æ¥åˆå¹¶è¿›å…¥æœ€ç»ˆçš„å¯æ‰§è¡Œæ–‡ä»¶\n\n\nåŠ¨æ€é“¾æ¥ä»…ä»…å°†åº“æ–‡ä»¶çš„å¼•ç”¨ä¿¡æ¯å†™å…¥æœ€ç»ˆçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œè€Œåœ¨ç¨‹åºè¿è¡Œæ—¶å†å»å¯»æ‰¾è¿™äº›åº“æ–‡ä»¶\n\n\n\nå¼•å¯¼\n\nåœ¨è®¡ç®—æœºåˆšåˆšå¯åŠ¨ï¼Œæ“ä½œç³»ç»Ÿè¿˜æœªå¼€å§‹è¿è¡Œä¹‹å‰ï¼Œéœ€è¦å¼€æœºåçš„ç¬¬ä¸€ä¸ªç¨‹åºâ€”â€”å¼•å¯¼åŠ è½½å™¨(bootstrap loader)æ¥ä¸€æ­¥ä¸€æ­¥åœ°åˆå§‹åŒ–æ“ä½œç³»ç»Ÿã€‚å¯¹å¤§å¤šæ•°æ“ä½œç³»ç»Ÿæ¥è¯´ï¼Œbootstrap éƒ½ä¼šè¢«å­˜å‚¨åœ¨ ROM ä¸­ï¼Œå¹¶ä¸”éœ€è¦åœ¨ä¸€ä¸ªå·²çŸ¥çš„ä½ç½®\nBootstrap loader ä¼šè½½å…¥æ›´åŠ å¤æ‚çš„ï¼Œå®Œæ•´çš„ bootstrapï¼Œè€ŒåŒ…å« bootstrap ç¨‹åºçš„åˆ†åŒºå°±è¢«ç§°ä¸ºå¼•å¯¼åˆ†åŒº(bootstrap partition)ã€‚\n\nåŒæ­¥/å¼‚æ­¥IO\n\n\nåŒæ­¥(synchronous)\n\nç”¨æˆ·ç­‰å¾…ioæ“ä½œçš„å®Œæˆï¼ˆæ§åˆ¶æƒç§»äº¤ç»™æ“ä½œç³»ç»Ÿç›´åˆ°ioæ“ä½œç»“æŸ\n\n\nå¼‚æ­¥ï¼ˆAsynchronous)\n\nioæ“ä½œå¯åŠ¨ä»¥åç”¨æˆ·å‘èµ·ioçš„è¯·æ±‚åï¼Œæ§åˆ¶æƒè¿…é€Ÿè¿”å›è°ƒç”¨ç¨‹åºï¼Œç„¶åioæ“ä½œå†è‡ªå·±å»è¿›è¡Œï¼ˆå¹¶è®°å½•å¥½è¿™ä¸ªæ“ä½œçš„æœ‰å…³ä¿¡æ¯æ¯”å¦‚æ˜¯ç”±å“ªä¸ªè¿›ç¨‹å‘èµ·çš„ éœ€è¦æŠŠå¾—åˆ°çš„æ•°æ®äº¤ç»™è°ä¹‹ç±»ï¼ˆdevice-status table\n\n\n\n\n\nä¸‰ä¸ªmanagement\nprocess management\n\næ“ä½œç³»ç»Ÿåˆ†é…ç»™è¿›ç¨‹ä¸€å®šçš„èµ„æºã€‚è¿›ç¨‹åœ¨è¿è¡Œä¸­éœ€è¦å§‹ç»ˆæ‹¥æœ‰è¿™äº›èµ„æºæ‰èƒ½å¤Ÿè¿è¡Œå®Œæ¯•ã€‚\n\nprogram é™æ€æ¦‚å¿µ\nprocess   è¿è¡Œä¸­çš„åŠ¨æ€å®ä½“ï¼ˆæŠ½è±¡æ¦‚å¿µ\n\nä¸€ä¸ªç¨‹åºå¯ä»¥æœ‰å¤šä¸ªè¿è¡Œä¸­çš„è¿›ç¨‹\nä¸åŒè¿›ç¨‹æ‰€å ç”¨çš„èµ„æºä¸åŒï¼Œå› æ­¤å¯ä»¥è¯´è¿›ç¨‹æ˜¯ä¸€ä¸ªèµ„æºåˆ†é…çš„å•ä½\nè¿›ç¨‹åˆå¯ä»¥æœ‰å¯¹åº”çš„å­è¿›ç¨‹ï¼ˆæ ‘çŠ¶ç»§æ‰¿å…³ç³»\n\n\n\nè¿›ç¨‹å½“å‰æŒ‡å‘çš„åœ°å€ pcå¯„å­˜å™¨\nä¸€ä¸ªç¨‹åºå¯èƒ½æœ‰å¤šä¸ªæ‰§è¡Œçš„é¡ºåº å«åšthreadçº¿ç¨‹\n\n\n                  \n                  æ˜¯å¦æ—¶åœ¨æ•´ä¸ªè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œéƒ½è¦å æœ‰æ‰€æœ‰è¯¥è¿›ç¨‹éœ€è¦çš„èµ„æºï¼Ÿ \n                  \n                \n\nè¿›ç¨‹è¿è¡Œçš„å„ä¸ªç”Ÿå‘½å‘¨æœŸï¼Œéœ€è¦çš„èµ„æºä¸åŒã€‚åœ¨éœ€è¦çš„æ—¶å€™å†è¿›è¡Œå ç”¨ï¼Œä¸éœ€è¦çš„æ—¶å€™è¿›è¡Œé‡Šæ”¾ï¼Œæé«˜äº†çµæ´»æ€§å’Œèµ„æºåˆ©ç”¨ç‡ã€‚\n\n\nè¿›ç¨‹é‡Œé¢å¯ä»¥åŒ…å«å¤šä¸ªæ‰§è¡Œçš„åºåˆ—ï¼šçº¿ç¨‹thread\nçº¿ç¨‹ï¼šæ‰§è¡Œçš„æœ€å°å•ä½\nè¿›ç¨‹ï¼šåˆ†é…èµ„æºçš„å•ä½\n\nè¿›ç¨‹çš„åˆ›å»º\n\nè¿›ç¨‹çš„ç»§æ‰¿å…³ç³»\n\n\näº¤äº’çš„èƒ½åŠ›ï¼ˆç»™å¦ä¸€ä¸ªè¿›ç¨‹å‘æ¶ˆæ¯ signal\nè¿›ç¨‹çš„çŠ¶æ€\nåˆ é™¤è¿›ç¨‹\nå¤šä¸ªè¿›ç¨‹ä¹‹é—´å…±äº«å†…å­˜ï¼ˆè®¿é—®å†²çª\n\nmemory management\n\nè®©è¿›ç¨‹èƒ½ï¼ˆæŒ‰ç…§æƒé™/è§„å®šï¼‰äº†è§£åˆ°è‡ªå·±ç›®å‰æ‰€æ‹¥æœ‰çš„å†…å­˜ï¼ˆé™æ€åˆ†é…oråŠ¨æ€åˆ†é…ï¼‰çš„ç»“æ„ï¼Œçš„è§†å›¾ã€‚\nstorage management\nåœ¨å­˜å‚¨çš„ä»‹è´¨ä¸Šé¢ï¼ˆç¡¬ç›˜/SSDï¼‰\n\næä¾›ä¸€ä¸ªæŠ½è±¡çš„è®¿é—®æ¥å£ï¼šæ–‡ä»¶file\næ–‡ä»¶çš„å±‚ç»“æ„ï¼šç›®å½•\næ–‡ä»¶è®¿é—®çš„æƒé™\næ–‡ä»¶æ˜¯å•ä¸ªæ•°æ®å®ä½“\næ–‡ä»¶ç³»ç»Ÿæ˜¯ä¸€æ•´å¥—æ–‡ä»¶ä»¥åŠç®¡ç†ç›®å½•çš„æ•´ä½“\nç£ç›˜ä¸Šé¢åˆ†æˆè‹¥å¹²å—çš„partition å¹¶èµ‹äºˆæ–‡ä»¶ç³»ç»Ÿï¼ˆä¸€ä¸ªç›˜ç¬¦å°±ä»£è¡¨ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ç³»ç»Ÿï¼‰\nmass-storage management\næµ·é‡å­˜å‚¨ç®¡ç†ï¼Œä¹Ÿå°±æ˜¯ç£ç›˜ç®¡ç†\nç›¸è¾ƒäºé¢å‘ç”¨æˆ·çš„storageç®¡ç† æ›´å¤šçš„æ˜¯é¢å‘ç¡¬ä»¶çš„ç®¡ç†\nI/O subsystem\n\n\n\n                  \n                  system callèƒ½å¦å®ç°æˆä¸ºlibraryï¼ˆå‡½æ•°è°ƒç”¨ \n                  \n                \n\nå­˜åœ¨å®‰å…¨æ€§é£é™©ï¼Œæ¯”å¦‚è½¯ä»¶è°ƒç”¨ç‰¹æƒæŒ‡ä»¤ç­‰\n\n\nè™šæ‹Ÿæœº\næœ¬è´¨å…¶å®æ˜¯ä¸€ç§æŠ½è±¡\nç»™ä¸Šå±‚æä¾›å’Œåº•å±‚ç¡¬ä»¶ä¸€æ ·çš„interface\n\n\nhardwareï¼šhostå®¿ä¸»æœº\nvirtual machine managerVMM/hypervisorï¼šæä¾›äº†å…·å¤‡æ“ä½œç³»ç»Ÿç‰¹æ€§çš„ä¸€ä¸ªåŸºæœ¬çš„ç®¡ç†è½¯ä»¶ï¼Œæä¾›æ¥å£ä¾›è™šæ‹Ÿæœºè¿è¡Œï¼Œç»“æ„ç›¸å¯¹æ¥è¯´ç®€å•\n\ntype1 è£¸é‡‘å±çš„è™šæ‹ŸåŒ–baremtal hyperboza æ¯”è¾ƒå¥½å› ä¸ºä¸éœ€è¦å®Œæ•´çš„è¿è¡Œæ“ä½œç³»ç»Ÿ\ntype2 æ¯”å¦‚qemu ç¦»ä¸å¼€åœ°ä¸‹åŸç”Ÿosçš„è¿è¡Œ\n\n\nguestsï¼šè¿›ç¨‹ï¼Œå¯ä»¥è¿è¡Œå¤šä¸ªè¿›ç¨‹ï¼ˆä¸€ä¸ªè¿›ç¨‹å°±æ˜¯ä¸€ä¸ªè‡ªæˆä¸€ä½“çš„å®Œæ•´æ“ä½œç³»ç»Ÿ ï¼‰\n\nå¯¹guestosä¸åšä¿®æ”¹ï¼šå…¨è™šæ‹ŸåŒ–\nå¯¹guestosåšä¸€ç‚¹æ”¹åŠ¨ï¼šåŠè™šæ‹ŸåŒ–ï¼Œä½†æ˜¯è¿è¡Œæ•ˆç‡æ›´é«˜\nsysgen ï¼šdevice driverä¹‹ç±»çš„é…ç½®\nåœ¨æ“ä½œç³»ç»Ÿpower-onçš„è¿‡ç¨‹ä¸­cpuæ‰§è¡Œçš„ç¬¬ä¸€ä¸ªè½¯ä»¶ï¼ˆç³»ç»Ÿåˆå§‹åŒ–è‡ªæ£€ç¡¬ä»¶éƒ¨åˆ†ï¼‰ï¼šfirmwareå›ºä»¶\nbootloaderæ˜¯åŠ è½½æ“ä½œç³»ç»Ÿç”¨çš„ï¼ˆlocate kernel image on disk å¹¶ä¸”åŠ è½½è¿›ramï¼Œswitching the cpu mode for kernel executionï¼‰"},"è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/02.1-è¿›ç¨‹":{"slug":"è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/02.1-è¿›ç¨‹","filePath":"è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/02.1 è¿›ç¨‹.md","title":"02.1 è¿›ç¨‹","links":["tags/flashcard"],"tags":["flashcard"],"content":"DECK: CS::OS\nè¿›ç¨‹åŸºæœ¬æ¦‚å¿µ flashcard\n\nä¸€æ®µæœ¬è´¨ä¸Šæ˜¯é™æ€çš„ã€å­˜å‚¨åœ¨ç¡¬ç›˜ä¸Šçš„æŒ‡ä»¤æ•°æ®ï¼Œè€Œå½“å®ƒé™„å¸¦è¿è¡Œç¨‹åºæ‰€éœ€è¦çš„å¿…è¦ä¿¡æ¯è¿›å…¥å†…å­˜ï¼Œå¾—åˆ°ç›¸å…³èµ„æºåï¼Œå®ƒæˆä¸ºä¸€ä¸ªåŠ¨æ€çš„ã€ä¸è®¡ç®—æœºèµ„æºäº’åŠ¨çš„å®ä½“ï¼Œè¿™ä¸ªå®ä½“å°±æ˜¯è¿›ç¨‹(process)ã€‚ç®€å•æ¥è¯´å°±æ˜¯è¿è¡Œä¸­çš„ä¸€ä¸ªå®ä¾‹ã€‚\nprocess=jobã€‚\n\n\nè¿›ç¨‹çš„å½¢å¼ flashcard\nåœ¨å†…å­˜ä¸­éœ€è¦ä¸€å—è™šæ‹Ÿçš„åœ°å€ç©ºé—´æ¥å­˜å‚¨ã€‚åŒ…å«ä¸¤ä¸ªéƒ¨åˆ†\nè™šæ‹Ÿåœ°å€ç©ºé—´ä¸­çš„ç”¨æˆ·éƒ¨åˆ†\n\ntext section(code) å­˜å‚¨ä»£ç  åŠ è½½åˆ°å†…å­˜å‰ä»¥ executable file çš„å½¢å¼å­˜å‚¨åœ¨ disk ä¸­\nstack section å¸¸è¯´çš„æ ˆ å­˜å‚¨ä¸€äº›æš‚æ—¶æ€§çš„æ•°æ®ï¼Œå¦‚å‡½æ•°ä¼ å‚ã€è¿”å›å€¼ã€å±€éƒ¨å˜é‡ç­‰\ndata section å­˜å‚¨ä»£ç ä¸­çš„å…¨å±€å˜é‡ã€é™æ€å˜é‡\nheap section å¸¸è¯´çš„å †ï¼Œè¢«åŠ¨æ€åˆ†é…çš„å†…å­˜\n\n\nå†…å­˜æ˜ åƒï¼š0~maxåœ°å€ä¹‹é—´çš„åŒºåŸŸå«åšaddress space\n\n\nè¿›ç¨‹è®¿é—®çš„ç‰©ç†ç©ºé—´æ˜¯è™šåœ°å€ï¼Œå› æ­¤è¿™é‡Œçš„maxä¹Ÿå«åšmaxVA(æœ€å¤§çš„è™šåœ°å€)\nç©ºæ´holeï¼šè¿™ä¸ªéƒ¨åˆ†å…¶å®å æ¯”ä¾‹å¾ˆå¤§ï¼Œæ˜¯æ— æ³•åˆæ³•è®¿é—®çš„åŒºåŸŸã€‚\ntextå’Œdataéƒ¨åˆ†æ‰€éœ€è¦çš„ç©ºé—´åœ¨ä¸€å¼€å§‹å°±è¢«ç¡®å®šï¼Œheapå’Œstackå¯ä»¥åŠ¨æ€æ‰©å±•å’Œæ”¶ç¼©ï¼ˆä½†æ˜¯åŠ ä¸Šholeçš„æ•´ä¸ªç©ºé—´ä¸å˜ï¼‰\n\n\nè™šæ‹Ÿåœ°å€ç©ºé—´ä¸­çš„å†…æ ¸éƒ¨åˆ†\nPCB\n\nprogram counter æ ‡è¯†è¯¥è¿›ç¨‹è·‘åˆ°äº†å“ªé‡Œï¼ˆå­˜å‚¨ä¸­æ–­å‰çš„å·¥ä½œçŠ¶æ€ï¼ŒæŒ‡å‘ä¸‹ä¸€ä¸ªè¦è¿è¡Œçš„æŒ‡ä»¤\nCPU registers ä¿å­˜è¿›ç¨‹ç›¸å…³çš„å¯„å­˜å™¨ä¿¡æ¯\n\n\nprocess control blockï¼ˆPCBï¼‰ flashcard\næ“ä½œç³»ç»Ÿç”¨ä¸€ä¸ªPCBè¡¨ç¤ºè¿›ç¨‹ï¼Œæ¯ä¸ªè¿›ç¨‹æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªPCBï¼ŒPCB æ˜¯è¿›ç¨‹å­˜åœ¨çš„å”¯ä¸€æ ‡å¿—ã€‚å…¶ä¸­åŒ…å«è®¸å¤šå½“å‰è¿›ç¨‹çš„ç›¸å…³ä¿¡æ¯\n\nprocess state è¿›ç¨‹çš„çŠ¶æ€\nprogram counter æ ‡è¯†è¯¥è¿›ç¨‹è·‘åˆ°äº†å“ªé‡Œï¼ˆå­˜å‚¨ä¸­æ–­å‰çš„å·¥ä½œçŠ¶æ€ï¼ŒæŒ‡å‘ä¸‹ä¸€ä¸ªè¦è¿è¡Œçš„æŒ‡ä»¤\nCPU registers ä¿å­˜è¿›ç¨‹ç›¸å…³çš„å¯„å­˜å™¨ä¿¡æ¯\nCPU-scheduling information CPUè°ƒåº¦å‚è€ƒçš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬ä¼˜å…ˆçº§ã€è°ƒåº¦é˜Ÿåˆ—çš„æŒ‡é’ˆã€è°ƒåº¦å‚æ•°ç­‰ã€‚\nmemory-management information åŒ…æ‹¬é¡µè¡¨ã€æ®µè¡¨ç­‰ä¿¡æ¯ï¼Œå…·ä½“ä¸å®ç°çš„å†…å­˜ç³»ç»Ÿæœ‰å…³ã€‚\nAccounting information ä¸€äº›å…³äºè¿›ç¨‹çš„åŠ¨æ€æ•°æ®çš„ç»Ÿè®¡å’Œè®°å½•ï¼Œæ¯”å¦‚å·²ç»è·‘äº†å¤šä¹…ã€æ—¶é—´é™åˆ¶ã€è¿›ç¨‹å·ç­‰ç­‰\nIO status information è¢«åˆ†é…ç»™è¿›ç¨‹çš„IOè®¾å¤‡åˆ—è¡¨ã€æ‰“å¼€çš„æ–‡ä»¶åˆ—è¡¨ç­‰\n\n\næ˜¯æ¯ä¸ªè¿›ç¨‹æ‰€ç‹¬æœ‰çš„æ•°æ®ï¼Œå’Œåˆ«çš„è¿›ç¨‹æ— å…³ã€‚\næ˜¯æŠ½è±¡æ¦‚å¿µçš„æ•°æ®ç»“æ„ï¼Œä¸ä¸€å®šå®ç°ä¸ºblockã€‚ä¸åŒçš„ç³»ç»Ÿå¯èƒ½æœ‰ä¸åŒçš„ PCBã€‚Linux ä¸­çš„è¿›ç¨‹ç”¨ç»“æ„ä½“Â task_structå­˜å‚¨ã€‚\nå¦‚æœåªæ˜¯ä¸­æ–­å»å¤„ç†ä»€ä¹ˆè€Œä¸æ¶‰åŠè¿›ç¨‹åˆ‡æ¢ï¼ŒPCBä¹Ÿå¯ä»¥ä¸ç”¨å·¥ä½œï¼Œè€Œé‡è¦çš„ä¿¡æ¯ç›´æ¥ä¿å­˜åˆ°kernel stacké‡Œé¢ã€‚\n\n\n\nè¿›ç¨‹ç®¡ç†\nè¿›ç¨‹æ ‘ (process tree)\n\n\nç”¨æˆ·è¿›ç¨‹åœ¨æ“ä½œç³»ç»Ÿä¸­ï¼Œæ€»ä½“ä¸Šéµå¾ªæ ‘çŠ¶ç»„ç»‡å½¢å¼ï¼Œæ¯ä¸€ä¸ªè¿›ç¨‹æœ‰ä¸€ä¸ªå”¯ä¸€æ ‡è¯†ç¬¦è¿›ç¨‹å·ï¼ˆé€šå¸¸ä¸ºpidï¼‰\nè¿›ç¨‹ä¹‹é—´å­˜åœ¨ä¸€ç§çˆ¶å­å…³ç³»ï¼Œå³ child è¿›ç¨‹æ˜¯ç”± parent è¿›ç¨‹åˆ›å»ºçš„ï¼Œç”¨Â ppidÂ æ¥æ ‡è¯†å®ƒçš„ parent è¿›ç¨‹\n\nè¿›ç¨‹çš„åˆ›å»º flashcard\n\nchild è¿›ç¨‹çš„èµ„æºå¯èƒ½ç›´æ¥æ¥è‡ªæ“ä½œç³»ç»Ÿçš„åˆ†é…ï¼Œä¹Ÿå¯èƒ½æ¥è‡ª parent è¿›ç¨‹çš„ç»§æ‰¿ï¼Œé™åˆ¶ä½¿ç”¨åè€…çš„å¥½å¤„æ˜¯èƒ½å¤Ÿé¿å…å› ä¸ºåˆ›å»ºå¤ªå¤šå­è¿›ç¨‹è€Œå¯¼è‡´èµ„æºä¸å¤Ÿç”¨ã€‚\nè¿›ç¨‹æ ‘çš„æ ¹æ˜¯Â systemdï¼Œå†å²ä¸Šä¹Ÿæ›¾å«è¿‡Â initï¼Œå®ƒæ˜¯æ“ä½œç³»ç»Ÿå¯åŠ¨åè¿è¡Œçš„ç¬¬ä¸€ä¸ªç”¨æˆ·è¿›ç¨‹ï¼Œè‡³å°‘åœ¨ Linux ä¸­ï¼Œå®ƒçš„Â pidÂ è¢«åˆ†é…ä¸º 1ï¼Œè€Œå®ƒçš„Â ppidÂ æ˜¯ 0ï¼Œå¯ä»¥ç†è§£ä¸ºè¿™ä¸ªè¿›ç¨‹çš„ parent æ˜¯ scheduler è€Œéä¸€ä¸ªè¿›ç¨‹\n\n#include &lt;stdio.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;sys/wait.h&gt;\n#include &lt;sys/types.h&gt;\n \nint main() {\n    printf(&quot;A process starts!\\n&quot;);\n \n    pid_t pid;\n    **pid = fork();**\n \n    if (pid &lt; 0) {\n        printf(&quot;Fork failed!\\n&quot;);\n    } else if (pid == 0) {\n        // sleep(1);\n        printf(&quot;pid is zero, so it&#039;s child process!\\n&quot;);\n    } else {\n        **// wait(NULL);**\n        // sleep(1);\n        printf(&quot;pid is nonzero thus it&#039;s parent process!\\n&quot;);\n    }\n}\n \n\nUNIX ç³»ç»Ÿä¸­å¯ä»¥ä½¿ç”¨ç³»ç»Ÿè°ƒç”¨Â fork()Â æ¥åˆ›å»ºä¸€ä¸ªæ–°è¿›ç¨‹ã€‚è¿™ä¸ªæ–°è¿›ç¨‹æ˜¯çˆ¶è¿›ç¨‹çš„ä¸€ä»½æ‹·è´ï¼Œå®ƒä»¬åªæœ‰ pid å’Œ ppid ä¸åŒï¼Œå¦å¤–å­è¿›ç¨‹å½“å‰å†…å­˜ä½¿ç”¨è®°å½•ä¸º 0ï¼Œé™¤æ­¤ä»¥å¤–å…¨éƒ¨ç›¸åŒã€‚\npid = fork()ä¹‹åï¼Œå†…å­˜ä¸­æœ‰ä¸¤ä¸ªè¿›ç¨‹ï¼Œä¸€èµ·ä»è¿™è¡Œä»£ç çš„ä¸‹ä¸€è¡Œå¾€ä¸‹æ‰§è¡Œï¼Œé€šè¿‡æ£€æŸ¥è¿”å›å€¼pidæ¥åˆ¤æ–­å±äºparentè¿˜æ˜¯childã€‚åœ¨çˆ¶è¿›ç¨‹ä¸­ï¼Œforkï¼ˆï¼‰è¿”å›çš„æ˜¯åˆ›å»ºçš„å­è¿›ç¨‹çš„pidï¼Œå­è¿›ç¨‹è¿”å›0ï¼Œæ‰§è¡Œå¤±è´¥è¿”å›è´Ÿæ•°ã€‚\n\nè¿™é‡Œçš„pid_tæ˜¯ä¸€ä¸ªå±€éƒ¨å˜é‡\n\n\nwaiteï¼ˆNULLï¼‰ å³çˆ¶è¿›ç¨‹å¯ä»¥ç»§ç»­è¿è¡Œï¼Œæˆ–è€…ç­‰å¾…å­è¿›ç¨‹è¿è¡Œå®Œä»¥åå†è¿è¡Œ\n\nä½¿å¾—å½“å‰è¿›ç¨‹è¿›å…¥ waiting çŠ¶æ€ï¼Œå¹¶åœ¨ä»»ä¸€å­è¿›ç¨‹ç»ˆæ­¢ï¼Œæˆ–è¢«ä¿¡å·åœæ­¢ï¼Œæˆ–è¢«ä¿¡å·æ¢å¤æ—¶è¿›å…¥ ready çŠ¶æ€ï¼ŒåŒæ—¶è¿”å›å‘ç”Ÿè¯¥äº‹ä»¶çš„å­è¿›ç¨‹çš„ pid\nå¦‚æœç¬¬ 18 è¡Œä»ç„¶è¢«æ³¨é‡Šï¼Œé‚£ä¹ˆ parent è¿›ç¨‹å’Œ child è¿›ç¨‹å°†å¹¶å‘æ‰§è¡Œï¼Œå³å®ŒæˆÂ fork()Â åä¸¤ä¸ªè¿›ç¨‹éƒ½ä» 11 è¡Œå¼€å§‹ç»§ç»­å‘ä¸‹å¹¶å‘çš„æ‰§è¡Œï¼Œäº’ä¸é˜»å¡\n\næ“ä½œç³»ç»Ÿä¼šè®©å®ƒä»¬äº¤æ›¿ä½¿ç”¨CPUã€‚è°å…ˆå®Œæˆè‡ªå·±çš„printfï¼Œå®Œå…¨å–å†³äºæ“ä½œç³»ç»Ÿçš„â€œå¿ƒæƒ…â€ï¼ˆè°ƒåº¦ï¼‰ã€‚æ‰€ä»¥å¯èƒ½ä¼šå…ˆçœ‹åˆ°çˆ¶è¿›ç¨‹çš„è¾“å‡ºï¼Œä¹Ÿå¯èƒ½å…ˆçœ‹åˆ°å­è¿›ç¨‹çš„è¾“å‡ºã€‚\n\n\nå¦‚æœ 18 è¡Œçš„æ³¨é‡Šè¢«å–æ¶ˆï¼Œé‚£ä¹ˆ parent è¿›ç¨‹å°†ç­‰å¾… child è¿›ç¨‹ç»“æŸåå†ç»§ç»­ã€‚\n\nçˆ¶è¿›ç¨‹æ‰§è¡Œwait(NULL)è¿™è¡Œæ—¶ï¼Œä¼šè¢«é˜»å¡ï¼Œéœ€è¦ç­‰åˆ°å­è¿›ç¨‹å®Œå…¨ç»“æŸï¼ˆæ‰§è¡Œå®Œæ‰€æœ‰ä»£ç æˆ–è°ƒç”¨äº†exitï¼‰ä¹‹åæ‰èƒ½ç»§ç»­å¾€ä¸‹æ‰§è¡Œè‡ªå·±çš„å†…å®¹ï¼Œå­è¿›ç¨‹è¾“å‡ºä¸€å®šåœ¨çˆ¶è¿›ç¨‹ä¹‹å‰\né€»è¾‘ä¸Šåˆ›å»ºçš„æ–°è¿›ç¨‹æœ‰ä¸¤ç§æƒ…å†µï¼š\n\n\n\n\n\n\nå¤åˆ¶ parent è¿›ç¨‹çš„ä»£ç æ•°æ®ï¼›\nè½½å…¥æ–°çš„ç¨‹åºå¹¶ç»§ç»­æ‰§è¡Œï¼›\nè€Œå®é™…åœ¨ Linux ä¸­ï¼Œç¬¬ä¸€ç§é€šè¿‡Â fork()Â å®ç°ï¼Œç¬¬äºŒç§é€šè¿‡Â fork()Â åÂ execXX()Â å®ç°ï¼ŒexecXX()Â ä¼šè¦†ç›–é‚£ä¸ªè¿›ç¨‹çš„åœ°å€ç©ºé—´ï¼Œä»¥å®ç°æ‰§è¡Œå…¶ä»–ç¨‹åº\n\nè¿›ç¨‹çš„ç»ˆæ­¢ flashcard\n\nå½“è¿›ç¨‹è°ƒç”¨Â exit()Â è¿™ä¸ªç³»ç»Ÿè°ƒç”¨æ—¶ï¼Œå°†è¢«ç»ˆæ­¢ã€‚\nC è¯­è¨€ main å‡½æ•°è¿”å›æ—¶ä¹Ÿä¼šéšå¼åœ°è°ƒç”¨Â exit()ã€‚\nè¿›ç¨‹ä¹Ÿä¼šç”±äºä¸€äº›ä¿¡å·ã€å¼‚å¸¸ç­‰ç»ˆæ­¢ã€‚\nè¿™æ„å‘³ç€è¿™ä¸ªè¿›ç¨‹å°†ä¸å†æ‰§è¡Œï¼Œå…¶èµ„æºå°†è¢«é‡Šæ”¾ï¼ŒåŒæ—¶è¿”å›çŠ¶æ€å€¼ï¼Œè€Œè¿™ä¸ªçŠ¶æ€å€¼å°†è¢« parent è¿›ç¨‹çš„Â wait()Â æ¥æ”¶ã€‚\n\nçˆ¶è¿›ç¨‹é€šè¿‡è°ƒç”¨ wait() æ¥åšä¸¤ä»¶äº‹ï¼š\n\nç­‰å¾…å­è¿›ç¨‹ç»“æŸã€‚\næ¥æ”¶ï¼ˆå›æ”¶ï¼‰ å­è¿›ç¨‹çš„è¿™ä¸ªâ€œçŠ¶æ€ç â€ï¼ˆæ£€æŸ¥ä½œä¸šæœ¬ï¼‰ã€‚\n\n\nç‰¹åˆ«çš„ï¼Œå¦‚æœ parent è¿›ç¨‹å°šæœªè°ƒç”¨Â wait()ï¼Œåˆ™è¿™ä¸ª child è¿›ç¨‹è¿˜ä¸ä¼šå®Œå…¨æ¶ˆå¤±ï¼Œå› ä¸ºè¦è¿”å›çš„ä¸œè¥¿è¿˜æ²¡è¿”å›ï¼ˆchild å¹¶ä¸çŸ¥é“ parent ä¼šä¸ä¼šã€ä»€ä¹ˆæ—¶å€™æ¥å›æ”¶å®ƒï¼‰ã€‚è¿™ç§é€»è¾‘ä¸Šå·²ç»ç»ˆæ­¢ï¼Œä½†ä»ç„¶å æœ‰ä¸€éƒ¨åˆ†èµ„æºï¼Œç­‰å¾… parent è¿›ç¨‹è°ƒç”¨Â wait()Â çš„è¿›ç¨‹ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºåƒµå°¸è¿›ç¨‹(zombie)ã€‚\nå½“å­è¿›ç¨‹æ²¡æœ‰ç»“æŸï¼Œæˆ–è€…ç»ˆæ­¢äº†ä½†çˆ¶è¿›ç¨‹æ²¡æœ‰è°ƒç”¨Â wait()Â çš„æƒ…å†µä¸‹ï¼Œçˆ¶è¿›ç¨‹å°±ç»“æŸäº†ï¼Œå­è¿›ç¨‹å°±ä¼šæˆä¸ºÂ å­¤å„¿è¿›ç¨‹ (orphan processes)ï¼ˆå¦‚æœparent exiting ï¼Œæˆä¸ºå­¤å„¿è¿›ç¨‹ï¼Œå®ƒçš„çˆ¶è¿›ç¨‹å˜æˆinit processï¼ˆpid=1ï¼‰init è¿›ç¨‹ä¼šå®šæœŸè°ƒç”¨Â wait()ï¼‰\n\n\n\nè¿›ç¨‹é—´é€šä¿¡\n\n\nå¦‚æœä¸€ä¸ªè¿›ç¨‹å—åˆ°å…¶å®ƒè¿›ç¨‹çš„å½±å“ï¼Œæˆ–ä¼šå½±å“å…¶å®ƒè¿›ç¨‹ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç§°ä¹‹ä¸ºåä½œè¿›ç¨‹(cooperation process)ï¼Œæ¯”å¦‚ä¸€ä¸ªè¿›ç¨‹çš„è¾“å‡ºä½œä¸ºå¦ä¸€ä¸ªè¿›ç¨‹çš„è¾“å…¥ä½¿ç”¨ï¼Œä¹‹ç±»çš„ã€‚\n\nä¸ºäº†æ¨¡å—åŒ–è®¾è®¡ï¼Œå¿…ä¸å¯å°‘\n\n\n\nè¿›ç¨‹é—´é€šä¿¡(inter-process communication, IPC) flashcard\n\næ˜¯ä¸ºäº†åœ¨è¿›ç¨‹çš„èµ„æºç›¸äº’éš”ç¦»çš„æƒ…å†µä¸‹ï¼Œè®©ä¸åŒçš„è¿›ç¨‹èƒ½ç›¸äº’è®¿é—®èµ„æºä»è€Œåè°ƒå·¥ä½œã€‚\nä¸¤ç§æ–¹å¼\n\nå…±äº«å†…å­˜(shared memory)ï¼šï¼ˆaï¼‰\n\nç›¸æ¯”ä¸‹é¢å‡ ç§æ•ˆç‡æ›´é«˜ï¼Œéœ€è¦ç”¨åˆ° system call çš„åœ°æ–¹åªæœ‰å»ºç«‹å…±äº«å†…å­˜çš„æ—¶å€™\nä¸¤ä¸ªè¿›ç¨‹å„è‡ªæœ‰ä¸€å—è™šæ‹Ÿå†…å­˜ï¼Œæ˜ å°„åˆ°åŒä¸€å—ç‰©ç†å†…å­˜ã€‚\nä¹Ÿéœ€è¦ä¿¡å·é‡ç­‰åŒæ­¥æ‰‹æ®µä¿æŠ¤\n\n\næ¶ˆæ¯ä¼ é€’(message passing)ï¼šï¼ˆbï¼‰\n\nåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­æ›´å®¹æ˜“å®ç°ï¼Œå¯¹äºå°‘é‡æ•°æ®é€šä¿¡å¾ˆæœ‰ç”¨ï¼ˆå› ä¸ºä¸éœ€è¦å¤„ç†å†²çªé—®é¢˜ ï¼‰ï¼›\n\nå»ºç«‹link\n\nç›´æ¥é€šä¿¡ ç‰¹å®šæŸä¸ªidçš„è¿›ç¨‹\né—´æ¥é€šä¿¡ ä¸­è½¬æ‰‹æ®µï¼Œæ¯”å¦‚ä¿¡ç®±mailboxï¼ˆwell-known mailbox//portsï¼‰\n\n\nåŒæ­¥ blocking\n\nblocking send  è®©sender blocked ç›´åˆ°ä¿¡æ¯è¢«æ¥æ”¶åˆ°\nblocking receive receiver blockç›´åˆ°ä¿¡æ¯å¯ä»¥è¢«æ¥æ”¶åˆ°\n\n\nå¼‚æ­¥ non-blocking\n\n\n\n\n\n\n\n\n\nä¿¡å·é‡(semaphores)ï¼šæœ¬æ„ç”¨æ¥çº¿ç¨‹é—´åŒæ­¥ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡ sem_open()Â ç³»ç»Ÿè°ƒç”¨æ¥å»ºç«‹å’Œç»´æŠ¤è¿›ç¨‹é—´çš„ä¿¡å·é‡ï¼›è¿™æ ·çš„ä¿¡å·é‡å±äº OS èµ„æºï¼Œå®ƒä¼šåœ¨ç›¸å…³è¿›ç¨‹ç»“æŸåç”± OS é‡Šæ”¾\n\n\næ–‡ä»¶ / ç®¡é“(pipe)ï¼š\n\nç®¡é“æœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ç§æ–‡ä»¶ï¼Œåˆ›å»ºç®¡é“æ—¶æ“ä½œç³»ç»Ÿä¼šè¿”å›ä¸¤ç«¯çš„æ–‡ä»¶æè¿°ç¬¦\nä½†ä¸€ä¸ªç®¡é“åªæ”¯æŒå•å‘ä¼ è¾“ï¼Œå³åªèƒ½ A å†™ B è¯»ï¼Œå¦‚æœè¦å®ç°åŒå‘éœ€è¦ä¸¤ä¸ªç®¡é“ã€é€»è¾‘ä¸Šæ˜¯ä¸€ä¸ªåŠåŒå·¥çš„ä¿¡é“ã€‘\n\n\n\n\nã€æ¨¡å‹ã€‘producer-consumer problem\nproducer ä¿¡æ¯è¾“å‡ºæ–¹\nconsumer ä¿¡æ¯æ¥æ”¶æ–¹\n\næ— ç•Œç¼“å†²åŒº unbounded-buffer ç¼“å†²åŒºçš„å¤§å°ç›¸æ¯”äºå‘é€çš„ä¿¡æ¯ç›¸æ¯”ä¸ä¼šæ»¡\næœ‰ç•Œç¼“å†²åŒº bounded-buffer\n\nproducerå¾€bufferä¸­æ”¾å…¥itemsï¼Œconsumerå–å‡º\næŒ‡å®šæŒ‡é’ˆindex-inç»™producerä½¿ç”¨ï¼Œindex-outæä¾›ç»™consumer\n\n\næ£€æŸ¥å¦‚æœ==outï¼šè®¤ä¸ºæ²¡æœ‰freeitemæ˜¯å¯ä»¥æ”¾çš„ã€ä¸‹ä¸€ä¸ªä½ç½®å°±æ˜¯outæŒ‡é’ˆã€‘\nå¦åˆ™æ”¾å…¥å¹¶ä¸”åç§»ä¸€ä½ï¼š0~buffersize-1ï¼Œä¸‹ä¸€ä¸ªåˆä»0å¼€å§‹ã€ç†è§£ä¸ºç¯å½¢é˜Ÿåˆ—ã€‘\n\n\n\n\nå¦‚æœæœ‰å¯å–ç”¨çš„item å°±å¾€åç§»ä¸€ä½ï¼Œå¹¶å–å‡ºä½¿ç”¨\né—®é¢˜æ˜¯ï¼šä¼šæµªè´¹ä¸€ä¸ªelement å½“out=1 in=0çš„æ—¶å€™ inæ²¡æœ‰åŠæ³•insertè¿›å»äº†\nï¼š\n\n\n\n\n"},"è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/02.2-è°ƒåº¦":{"slug":"è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/02.2-è°ƒåº¦","filePath":"è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/02.2 è°ƒåº¦.md","title":"02.2 è°ƒåº¦","links":["tags/flashcard"],"tags":["flashcard"],"content":"DECK: CS::OS\nå°±ç»ªé˜Ÿåˆ—(ready queue)å’Œç­‰å¾…é˜Ÿåˆ—(wait queue) flashcard\nå®é™…ä¸Šæ¢è¿›ç¨‹å°±æ˜¯æ¢PCBçš„æŒ‡é’ˆä½ç½®æ”¾åˆ°å“ªä¸ªé˜Ÿåˆ—ï¼ˆkernelè´Ÿè´£ç§»åŠ¨ï¼‰\n\n\nready queneï¼ˆé‡Œé¢çš„processéƒ½å¤„åœ¨readyçŠ¶æ€ï¼‰ï¼ˆ CPUç­‰å¾…é˜Ÿåˆ—ï¼šï¼‰\nå®é™…å®ç°ä¸­ï¼Œç”±äºç­‰å¾…çš„ioæˆ–è€…äº‹ä»¶ä¸åŒï¼Œå¯èƒ½ç»´æŠ¤å¤šä¸ªç­‰å¾…é˜Ÿåˆ—ã€‚\n\nIOè®¾å¤‡ç­‰å¾…é˜Ÿåˆ—ï¼šdevice queue ç­‰å¾…å®Œç”¨å¥½IOè®¾å¤‡ä¹‹åPCBè¢«ç§»èµ°\n\n\n\nä¸éœ€è¦ç­‰å¾…å…¶ä»–è®¾å¤‡ä¹Ÿä¸éœ€è¦ä½¿ç”¨å¤„ç†å™¨çš„è¿›ç¨‹ï¼Ÿï¼šç©ºé—²çŠ¶æ€ã€å°†è¦ç»“æŸçš„çŠ¶æ€ç­‰ï¼Œè¿™æ ·çš„è¿›ç¨‹å°±ä¸ä¼šå‡ºç°åœ¨ä¸Šè¿°é˜Ÿåˆ—ä¸­ï¼Œä¼šè¢«æ”¾åœ¨job queueï¼ˆç³»ç»Ÿä¸­æ‰€æœ‰è¿›ç¨‹éƒ½åœ¨å…¶ä¸­ï¼‰\n\n\nè¿›ç¨‹çŠ¶æ€state flashcard\nè¿›ç¨‹åœ¨executeæ—¶ä¼šæ”¹å˜çŠ¶æ€ã€‚ä¸€ä¸ªå¤„ç†å™¨ä¸Šåªæœ‰ä¸€ä¸ªè¿›ç¨‹å¯ä»¥runningã€‚\n\nnew\n\nè¿›ç¨‹æ­£åœ¨åˆ›å»ºè¿‡ç¨‹ä¸­ï¼ŒåŒ…æ‹¬ç”³è¯· PCBï¼Œåˆ†é…åˆå§‹èµ„æºç­‰ï¼›\n\n\nrunning\n\nè¿›ç¨‹æ­£åœ¨è¿è¡Œï¼ˆæ­£åœ¨ä½¿ç”¨CPUèµ„æºï¼‰\næœ‰å‡ ä¸ªæ ¸å°±æœ€å¤šæœ‰å‡ ä¸ªè¿›ç¨‹å¤„äºrunningçŠ¶æ€\n\n\nwaiting\n\nè¿›ç¨‹æ­£åœ¨ç­‰å¾…æŸä¸ªäº‹ä»¶çš„å‘ç”Ÿï¼Œæ¯”å¦‚è°ƒç”¨systemcallä¹‹åè¿›ç¨‹æš‚åœçš„çŠ¶æ€/IOæ“ä½œä¸­/å…¶ä»–event\næ­¤æ—¶å³ä½¿æœ‰ç©ºä½™çš„ CPU èµ„æºï¼Œè¯¥è¿›ç¨‹ä¹Ÿæ— æ³•ç»§ç»­\nä¸€èˆ¬è¿›ç¨‹ä»runningåˆ°waitingæ˜¯ä¸»åŠ¨çš„ï¼ˆç³»ç»Ÿè°ƒç”¨ä¹‹ç±» ï¼‰ï¼Œç¦»å¼€waitingè¿›å…¥readyæ˜¯è¢«åŠ¨çš„\n\n\nready\n\nè¿›ç¨‹å·²ç»å‡†å¤‡å¥½äº†åªå·®CPUèµ„æºï¼Œä¸€æ—¦æœ‰CPUèµ„æºå¯ä»¥åˆ†é…ç»™è¯¥è¿›ç¨‹ï¼Œå°±ä¼šå˜ä¸ºrunningæ€ï¼ˆç­‰å¾… CPU èµ„æºçš„æ´¾å‘(dispatch)ï¼Œæ¥å—è°ƒåº¦ï¼‰\nå¦‚æœæœ‰è¿›ç¨‹ready è¯´æ˜ä¸€å®šæœ‰è¿›ç¨‹æ­£åœ¨running\nCPU è°ƒåº¦å®é™…ä¸ŠæŒ‡çš„å°±æ˜¯è‹¥å¹²è¿›ç¨‹åœ¨readyå’Œrunningä¹‹é—´çš„åˆ‡æ¢ï¼Œå½“å‘ç”Ÿäº† interruptï¼Œå¦‚è®¡æ—¶å™¨åˆ°æ—¶é—´äº†ï¼Œrunningå°±ä¼šåˆ‡æ¢åˆ°ready\n\n\nterminated\n\nè¿›ç¨‹å› ä¸ºæŸäº›åŸå› ç»ˆæ­¢ï¼Œç»“æŸè¿è¡Œï¼Œéœ€è¦é‡Šæ”¾èµ„æºï¼›\n\n\ninterruptè§¦å‘åï¼Œæœ¬æ¥è¦æ‰§è¡Œçš„æŒ‡ä»¤è¢«ä¸­æ–­ï¼Œosé™·å…¥åˆ°kernelä¸­ï¼Œåœ¨è¿›è¡Œä¸­æ–­å¤„ç†çš„æ—¶å€™ï¼Œå‘ç°å…è®¸è¿›ç¨‹å¤„ç†çš„æ—¶é—´ç‰‡åˆ°äº†ï¼Œé‚£ä¹ˆå°±éœ€è¦æŠŠè¿™ä¸ªè¿›ç¨‹æ¢ä¸‹æ¥æ¢æˆåˆ«çš„è¿›ç¨‹ã€‚åŸæœ¬çš„é‚£ä¸ªè¿›ç¨‹è¿›å…¥readyçš„çŠ¶æ€ã€‚\nscheduler dispatch è°ƒåº¦ç¨‹åºï¼Œå†³å®šä¸‹ä¸€ä¸ªå°†è¦è¿è¡Œçš„è¿›ç¨‹\nwaitingä¸èƒ½ç›´æ¥è¿›å…¥åˆ°runingå¿…é¡»ç»è¿‡ready\n\n\nè°ƒåº¦\nschedulerç±»å‹ flashcard\n\n\nlong-term schedulerï¼šï¼ˆjob schedulerï¼‰\n\nå†å²ä¸Šçš„æ¦‚å¿µï¼Œä¸»æµæ“ä½œç³»ç»Ÿé‡Œé¢å·²ç»æ²¡æœ‰äº†ï¼Œç°åœ¨å®é™…ä¸Šå°±æ˜¯ç”¨æˆ·è‡ªå·±åœ¨æ‹…ä»»è¿™ä¸ªè§’è‰²ã€‚é€‰æ‹©å“ªä¸ªprocesseséœ€è¦ä»ç¡¬ç›˜è¿›å…¥memoryï¼ˆthe ready queueï¼‰\nå¦‚æœå…è®¸å¤ªå¤šio boundçš„è¿›ç¨‹è¿›å…¥cpu é‚£ä¹ˆå°±ä¼šé˜»å¡åœ¨io queueé‡Œé¢ï¼Œé‚£ä¹ˆcpuå°±å¾—ä¸åˆ°æœ‰æ•ˆçš„ä½¿ç”¨ï¼Œå› ä¸ºç­‰å¾…ioçš„è¿›ç¨‹å¤ªå¤šï¼Œè€Œå‡†å¤‡è¿è¡Œçš„è¿›ç¨‹å¤ªå°‘\n\n\nshort-term scheduler ï¼ˆCPU schedulerï¼‰\n\nå¤šé“ (multiprogramming)Â ç¯å¢ƒä¸‹ï¼Œè¿›ç¨‹çš„ä¸ªæ•°é€šå¸¸å¤§äº CPU çš„ä¸ªæ•°ã€‚CPU è°ƒåº¦å°±æ˜¯ OS å…³äºå“ªä¸ª ready è¿›ç¨‹å¯ä»¥è¿è¡Œï¼ˆä½¿ç”¨ CPUï¼‰ä»¥åŠè¿è¡Œå¤šä¹…çš„å†³å®šã€‚\n\n\nmedium term scheduler\n\nä¸»å†…å­˜ä¸¥é‡ä¸è¶³æ—¶ï¼Œéœ€è¦å°†ä¼˜å…ˆçº§è¾ƒé«˜çš„è¿›ç¨‹å…ˆåŠ è½½åˆ°RAMï¼ˆä¸»å†…å­˜ï¼‰ä¸­ã€‚\næ¢åˆ°å¤–å­˜ï¼ˆç¡¬ç›˜ï¼‰ä¸­ï¼ˆwipe outï¼‰ä¹‹åçŠ¶æ€ä»ç„¶æ˜¯waitingï¼Œå½“æ¥æ”¶åˆ°æ‰€éœ€çš„ç”¨æˆ·è¾“å…¥ä¹‹åï¼Œä¼šè¢«è€ƒè™‘é‡æ–°æ¢åˆ°å†…å­˜ä¸­ã€‚\n\n\n\n\nè¿›ç¨‹ç±»å‹\n\nI/O-bound (I/O å¯†é›†å‹): è¿™ç§ç¨‹åºå¤§éƒ¨åˆ†æ—¶é—´éƒ½åœ¨â€œç­‰å¾…â€ã€‚æ¯”å¦‚ç­‰å¾…ç½‘ç»œæ•°æ®ã€ç­‰å¾…è¯»å–ç¡¬ç›˜æ–‡ä»¶ã€‚å®ƒåªéœ€è¦ CPU ç®—ä¸€å°ä¼šå„¿ï¼Œç„¶åå°±å»ç­‰å¾… I/Oã€‚\nCPU-bound (è®¡ç®—å¯†é›†å‹): è¿™ç§ç¨‹åºæ˜¯éœ€è¦ CPU ä¸€ç›´ä¸åœåœ°ç®—å¾ˆä¹…ï¼Œå¾ˆå°‘éœ€è¦ç­‰å¾… I/Oã€‚æ¯”å¦‚è§†é¢‘æ¸²æŸ“ã€ç§‘å­¦è®¡ç®—ã€‚\nä¸€ä¸ªå¥½çš„æ“ä½œç³»ç»Ÿä¼šæ··åˆæ­é…è¿™ä¸¤ç§ç¨‹åºï¼Œç¡®ä¿ CPU å’Œç¡¬ç›˜/ç½‘ç»œéƒ½èƒ½ä¿æŒå¿™ç¢Œï¼Œæé«˜æ•´ä½“æ•ˆç‡ã€‚\n\n\n\n                  \n                  Title \n                  \n                \n\n\nä¸»å†…å­˜ å°±æ˜¯å†…å­˜ï¼ŒCPUå·¥ä½œçš„åŒºåŸŸï¼Œè€Œ RAM æ˜¯ä¸»å†…å­˜çš„ç‰©ç†å®ç°ã€‚\nå¤–å­˜  SSD/HDD(ç¡¬ç›˜)æ˜¯å¤–å­˜çš„ç‰©ç†å®ç°\nROM æ˜¯ä¸€ä¸ªå®Œå…¨ä¸åŒçš„ä¸œè¥¿ã€‚å®ƒæ˜¯ä¸€ä¸ªå°å®¹é‡ã€åªè¯»ã€æ–­ç”µä¸ä¸¢çš„èŠ¯ç‰‡ï¼Œå®ƒçš„å”¯ä¸€å·¥ä½œå°±æ˜¯åœ¨ä½ æŒ‰ä¸‹å¼€æœºé”®æ—¶ï¼Œå¼•å¯¼ç”µè„‘å»â€œå¤–å­˜â€é‡ŒåŠ è½½æ“ä½œç³»ç»Ÿåˆ°â€œä¸»å†…å­˜(RAM)â€ä¸­\n\n\n\nè°ƒåº¦çš„æ—¶æœº flashcard\n\nschedulerè°ƒåº¦\n\néæŠ¢å å¼è°ƒåº¦(non-preemptive scheduling) runningçš„è¿›ç¨‹ç”±äºæŸäº›åŸå› éœ€è¦ä¸»åŠ¨ç¦»å¼€runningçŠ¶æ€ã€ç»¿è‰²ã€‘\næŠ¢å å¼è°ƒåº¦(preemptive scheduling) readyçš„æŸä¸ªè¿›ç¨‹éœ€è¦ç«‹åˆ»å¾—åˆ°CPUèµ„æºã€è“è‰²ã€‘\n\nå…¶ä»–æ€è½¬å˜ä¸ºreadyæ€æ¥æ’é˜Ÿ\næˆ–è€…åœ¨æ’é˜Ÿçš„æ—¶å€™æŸä¸ªäººæƒ³æ’é˜Ÿï¼ˆä¼˜å…ˆçº§è°ƒåº¦ ï¼‰\n\n\néæŠ¢å å¼è°ƒåº¦æ˜¯ç”±å·²ç»æ‹¥æœ‰èµ„æºçš„è¿›ç¨‹ä¸»åŠ¨é‡Šæ”¾ CPU èµ„æºå¼•èµ·çš„ï¼Œè€ŒæŠ¢å å¼è°ƒåº¦åˆ™æ˜¯ä¸å æœ‰èµ„æºçš„è¿›ç¨‹ç´¢å– CPU èµ„æºæˆåŠŸå¼•èµ·çš„ã€‚\n\n\nè°ƒåº¦çš„è¿‡ç¨‹ï¼šä¸Šä¸‹æ–‡åˆ‡æ¢ flashcard\nç”± CPU scheduler é€‰æ‹©å“ªä¸€ä¸ªreadyæ€çš„å°†è¦è¢«æ‰§è¡Œåï¼Œç”± dispatcher æ¥å®Œæˆå…·ä½“çš„åˆ‡æ¢å·¥ä½œåŒ…æ‹¬ï¼š\n\nåœ¨ä¸¤ä¸ªè¿›ç¨‹é—´è¿›è¡Œä¸Šä¸‹æ–‡åˆ‡æ¢(context switchï¼ŒåŒ…æ‹¬æ¢å¤ç°åœºã€ä¿è¯è¿›ç¨‹æ‰§è¡Œä¸€è‡´æ€§çš„è¿‡ç¨‹)\n\nä¸Šä¸‹æ–‡ï¼šâ‘  CPU å¯„å­˜å™¨ä¸­çš„å€¼ï¼Œâ‘¡Â è¿›ç¨‹çŠ¶æ€ï¼Œâ‘¢ å†…å­˜çš„ç®¡ç†ä¿¡æ¯\n\n\nåˆ‡æ¢åˆ°ç”¨æˆ·æ€ï¼›\nè·³è½¬åˆ°ç”¨æˆ·ç¨‹åºä¸­åˆé€‚çš„ä½ç½®ä»¥ç»§ç»­è¿›ç¨‹æ‰§è¡Œï¼›\n\n\nè¿›ç¨‹åˆ‡æ¢ï¼šåŒ…æ‹¬è¢«ä¸­æ–­å’Œsystemcallä¸¤ç§\n\nè¢«ä¸­æ–­ è¿›å…¥ready\nsystem call è¿›å…¥waiting\n\n\nè€Œä» dispatcher åœæ­¢ä¸Šä¸€ä¸ªè¿è¡Œæ—¶çš„è¿›ç¨‹ï¼Œå®Œæˆä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå¹¶å¯åŠ¨ä¸‹ä¸€ä¸ªè¿›ç¨‹çš„å»¶æ—¶ï¼Œç§°ä¸º dispatch latencyã€‚\n\n\n\nè°ƒåº¦ç®—æ³•\nè°ƒåº¦ç®—æ³•çš„è¯„ä»·æŒ‡æ ‡(scheduling criteria) flashcard\n\nMaximizeÂ CPU UtilizationÂ \n\nCPU ä½¿ç”¨ç‡ï¼ŒCPU ä½¿ç”¨æ—¶é—´ / æ€»æ—¶é—´ã€‚å³ CPU éç©ºé—²çš„æ—¶é—´æ¯”ä¾‹\nä» CPU æ˜¯å¦è¶³å¤Ÿå¿™ç¢Œæ¥çœ‹ç¡¬ä»¶æ€§èƒ½æ˜¯å¦å……åˆ†å‘æŒ¥\n\n\nMaximizeÂ ThroughputÂ \n\nååé‡ï¼Œæ¯ä¸ªæ—¶é—´å•å…ƒå†…å®Œæˆçš„è¿›ç¨‹æ•°\nä»ç»“æœæ¥çœ‹ä»»åŠ¡å®Œæˆæ˜¯å¦è¶³å¤Ÿé«˜æ•ˆ\n\n\nMinimizeÂ Turnaround Time\n\nå‘¨è½¬æ—¶é—´ï¼Œä»è¿›ç¨‹åˆ›ç«‹åˆ°è¿›ç¨‹å®Œæˆçš„æ—¶é—´ï¼ŒåŒ…æ‹¬ç­‰å¾…è¿›å…¥å†…å­˜ã€åœ¨ ready queue ä¸­ç­‰å¾…ã€åœ¨ CPU ä¸Šæ‰§è¡Œã€I/O æ‰§è¡Œç­‰æ—¶é—´\né€šè¿‡è§‚å¯Ÿæœ€å¤§å‘¨è½¬æ—¶é—´ï¼Œèƒ½åæ˜ è°ƒåº¦çš„æ•ˆç‡å’Œâ€œå…¬å¹³æ€§â€\n\n\nMinimizeÂ Waiting TimeÂ \n\nç­‰å¾…æ—¶é—´ï¼Œåœ¨ ready queue ä¸­ï¼ˆæˆ–åœ¨ Ready çŠ¶æ€ä¸‹ï¼‰ç­‰å¾…æ‰€èŠ±çš„æ—¶é—´ä¹‹å’Œ\nç”±äºä»»åŠ¡æ‰€éœ€è¦çš„ CPU æ—¶é—´ã€I/O æ—¶é—´ä¸å—è°ƒåº¦ç®—æ³•å½±å“ï¼Œæ‰€ä»¥æŠ›å¼€è¿™äº›åªçœ‹åœ¨ ready queue ä¸­çš„ç­‰å¾…æ—¶é—´ï¼Œèƒ½åæ˜ è°ƒåº¦ç®—æ³•çš„æ•ˆç‡\nç­‰å¾…æ—¶é—´ = å‘¨è½¬æ—¶é—´ - è¿è¡Œæ—¶é—´\n\n\nMinimizeÂ Response TimeÂ \n\nå“åº”æ—¶é—´ï¼Œäº¤äº’ç³»ç»Ÿä»è¿›ç¨‹åˆ›ç«‹åˆ°ç¬¬ä¸€æ¬¡äº§ç”Ÿå“åº”çš„æ—¶é—´\nèƒ½ååº”äº¤äº’å¼ç³»ç»Ÿä¸­è°ƒåº¦ç®—æ³•çš„â€œåŠæ—¶æ€§â€\n\n\n\n\nè°ƒåº¦ç®—æ³•\nä»¥ä¸‹è°ƒåº¦ç®—æ³•å­˜åœ¨ç†æƒ³åŒ–å»ºæ¨¡ï¼Œä»¥åŠä»¥multiprogramä¸ºåŸºç¡€\nFirst-Come, First-Serve (FCFS) | Nonpreemptive flashcard\nå…ˆç”³è¯· CPU çš„è¿›ç¨‹é¦–å…ˆè·å¾— CPUï¼Œç”¨First-In, First-Outï¼ˆFIFOï¼‰é˜Ÿåˆ—å®ç°\n\n\nShortest-Job-First (SJF) flashcard\nSJF çš„æ ¸å¿ƒæƒ³æ³•æ˜¯ï¼Œè®©ä¸‹ä¸€æ¬¡è¿è¡Œæ—¶é—´æœ€çŸ­çš„è¿›ç¨‹å…ˆæ¥è¿è¡Œï¼›æ ¹æ®æ•°å­¦çŸ¥è¯†ï¼Œæˆ‘ä»¬å¯ä»¥å¾—çŸ¥è¿™æ ·èƒ½å¾—åˆ°æœ€å°‘çš„å¹³å‡ç­‰å¾…æ—¶é—´\n\nå¯¹äºéæŠ¢å å¼çš„ç³»ç»Ÿæ¥è¯´ï¼Œå½“æˆ‘ä»¬å¿½ç•¥ I/O ç­‰ä¼šè¿›å…¥ waiting çš„æƒ…å†µï¼ˆå› ä¸ºé¢˜ç›®é€šå¸¸è¿™æ ·è®¾è®¡ï¼‰ï¼Œè¿›ç¨‹ã€Œä¸‹ä¸€æ¬¡è¿è¡Œæ—¶é—´ã€å°±æ˜¯æ•´ä¸ªè¿›ç¨‹æ‰€éœ€çš„æ€»è¿è¡Œæ—¶é—´ã€‚\nå¯¹äºæŠ¢å å¼çš„ç³»ç»Ÿè€Œè¨€ï¼Œã€Œä¸‹ä¸€æ¬¡è¿è¡Œæ—¶é—´ã€å®é™…ä¸Šæ˜¯è¿›ç¨‹çš„å‰©ä½™è¿è¡Œæ—¶é—´ï¼Œå› ä¸ºè¿›ç¨‹å¯èƒ½æ›¾ç»è¢«æ‰“æ–­è¿‡ã€‚\nå› æ­¤æˆ‘ä»¬å°† SJF è¿›ä¸€æ­¥ç»†åˆ†æˆäº†ä¸¤ç§ã€‚\n\nNon-preemptive: Shortest-next-CPU-burst\né€‰å– ready queue ä¸­ä¸‹æ¬¡ CPU æ‰§è¡Œæ—¶é—´æœ€çŸ­çš„è¿›ç¨‹ã€‚è¿™æ ·ä¼šä½¿å¾—ç»™å®šçš„ä¸€ç»„è¿›ç¨‹å…·æœ‰ minimum average waiting time.\n\n\nåœ¨è¿™ä¸ªæƒ…æ™¯ä¸­ï¼Œ0s æ—¶åªæœ‰ P1 åˆ°è¾¾ï¼Œå› æ­¤ P1 å…ˆè¿è¡Œ\nç”±äºæ˜¯éæŠ¢å å¼çš„ï¼Œå› æ­¤ P1 è¿è¡Œè¿‡ç¨‹ä¸­å…¶ä»–è¿›ç¨‹çš„åˆ°è¾¾å¹¶ä¸ä¼šå¯¼è‡´é‡æ–°è°ƒåº¦ï¼ŒP1 å¾—ä»¥å®Œå…¨è¿è¡Œ\nP1 ç»“æŸæ—¶ï¼Œå‰©ä½™è¿›ç¨‹éƒ½å·²åˆ°è¾¾ï¼Œå¤„äº ready çŠ¶æ€ï¼Œå› æ­¤è°ƒåº¦å™¨ä» ready queue ä¸­é€‰å– brust time æœ€çŸ­çš„æ¥è¿è¡Œï¼Œä»¥æ­¤ç±»æ¨ã€‚[ä¸€ä¸ªè¿›ç¨‹è¿è¡Œç»“æŸåè¿›è¡Œå†è°ƒåº¦]\n\nâ€‹Preemptive: Shortest-remaining-time-first(SRTF)\nâ€‹æ¯å½“ CPU è°ƒåº¦æ—¶ï¼ˆæ³¨æ„æŠ¢å å¼è°ƒåº¦çš„è°ƒåº¦æ—¶æœºï¼‰ï¼Œé€‰æ‹©æœ€çŸ­å‰©ä½™è¿è¡Œæ—¶é—´çš„è¿›ç¨‹ã€‚\n\n\nåœ¨è¿™ä¸ªæƒ…å¢ƒä¸­ï¼Œ0s æ—¶åªæœ‰ P1 åˆ°è¾¾ï¼Œå› æ­¤ P1 å…ˆè¿è¡Œ\nä½†ä¸åŒçš„æ˜¯ï¼Œç”±äºæ˜¯æŠ¢å å¼çš„ï¼Œå› æ­¤ 2s P2 åˆ°è¾¾æ—¶ä¹Ÿä¼šå¼•å‘ä¸€æ¬¡è°ƒåº¦ï¼Œæ­¤æ—¶ P1 çš„å‰©ä½™æ—¶é—´æ˜¯ 8sï¼ŒP2 æ˜¯ 6sï¼Œå› æ­¤ P2 ä¼˜å…ˆè¿è¡Œ\n4s æ—¶ P3 åˆ°è¾¾ä¹Ÿå¼•å‘ä¸€æ¬¡è°ƒåº¦ï¼Œä½†æ­¤æ—¶ P1 çš„å‰©ä½™æ—¶é—´æ˜¯ 8sï¼ŒP2 æ˜¯ 4sï¼ŒP3 æ˜¯ 7sï¼Œå…¶ä¸­ P2 æœ€çŸ­ï¼Œå› æ­¤ä»ç„¶æ˜¯ P2 ç»§ç»­è¿è¡Œ[æ–°è¿›ç¨‹åˆ°è¾¾æ—¶å‘ç”Ÿä¸€æ¬¡è°ƒåº¦]\n5s æ—¶ P4 åˆ°è¾¾ä¹Ÿå¼•å‘ä¸€æ¬¡è°ƒåº¦ï¼Œæ­¤æ—¶ P1 çš„å‰©ä½™æ—¶é—´æ˜¯ 8sï¼ŒP2 æ˜¯ 3sï¼ŒP3 æ˜¯ 7sï¼ŒP4 æ˜¯ 2sï¼Œå…¶ä¸­ P4 æœ€çŸ­ï¼Œå› æ­¤ P4 ä¼˜å…ˆè¿è¡Œ\nP4 è¿è¡Œç»“æŸæ—¶ï¼Œready queue ä¸­ P1 çš„å‰©ä½™æ—¶é—´æ˜¯ 8sï¼ŒP2 æ˜¯ 3sï¼ŒP3 æ˜¯ 7sï¼Œå› æ­¤ P2 å…ˆè¿è¡Œï¼Œä»¥æ­¤ç±»æ¨ã€‚\nâ€‹SJF çš„ä¸¤ä¸ªç‰ˆæœ¬éƒ½å¯ä»¥è·å¾—æœ€å°çš„å¹³å‡ç­‰å¾…æ—¶é—´ï¼Œä½†æœ€å¤§çš„é—®é¢˜åœ¨äºæˆ‘ä»¬å¹¶ä¸çŸ¥é“ã€Œä¸‹ä¸€æ¬¡è¿è¡Œæ—¶é—´ ã€ã€‚è§£å†³æ–¹æ¡ˆæ˜¯é¢„æµ‹ï¼Œå°†ä¸‹æ¬¡æ‰§è¡Œæ—¶é—´é¢„æµ‹ä¸ºæ­¤å‰ CPU æ‰§è¡Œé•¿åº¦çš„æŒ‡æ•°å¹³å‡ã€‚æŒ‡æ•°å¹³å‡éœ€è¦æ“ä½œç³»ç»Ÿç»Ÿè®¡è¯¥è¿›ç¨‹æ­¤å‰çš„è¿è¡Œæƒ…å†µ\n\n\nRound-Robin (RR) | Preemptive flashcard\nå®šä¹‰ä¸€ä¸ªÂ æ—¶é—´ç‰‡ (time slice / time quantum)Â ï¼Œå³ä¸€ä¸ªå›ºå®šçš„è¾ƒå°æ—¶é—´å•å…ƒ (10-100ms)ã€‚\n\né™¤éä¸€ä¸ª process æ˜¯ ready queue ä¸­çš„å”¯ä¸€è¿›ç¨‹ï¼Œå®ƒä¸ä¼šè¿ç»­è¿è¡Œè¶…è¿‡ä¸€ä¸ªæ—¶é—´ç‰‡çš„æ—¶é—´ã€‚\nReady queue æ˜¯ä¸€ä¸ª FIFO çš„å¾ªç¯é˜Ÿåˆ—ã€‚æ¯æ¬¡è°ƒåº¦æ—¶å–å‡º ready queue ä¸­çš„ç¬¬ä¸€ä¸ªè¿›ç¨‹ï¼Œè®¾ç½®ä¸€ä¸ªè®¡æ—¶å™¨ä½¿å¾—è¿›ç¨‹åœ¨ä¸€ä¸ªæ—¶é—´ç‰‡åå‘ç”Ÿä¸­æ–­ï¼Œç„¶å dispatch the processã€‚\n\nç›¸æ¯” SJF è€Œè¨€ï¼Œå¹³å‡ç­‰å¾…æ—¶é—´æ›´é•¿ï¼Œä½†å“åº”æ—¶é—´æ›´çŸ­ã€‚\nâ€‹RR scheduling çš„æ€§èƒ½å¾ˆå¤§ç¨‹åº¦ä¸Šå–å†³äºæ—¶é—´ç‰‡çš„å¤§å°ã€‚å¦‚æœæ—¶é—´ç‰‡è¾ƒå°ï¼Œåˆ™ response/interactivity ä¼šå¾ˆå¥½ï¼Œä½†ä¼šæœ‰è¾ƒå¤§çš„ overheadï¼Œå› ä¸ºæœ‰è¾ƒå¤šçš„ context-switchï¼›æ—¶é—´ç‰‡è¾ƒå¤§åˆ™å“åº”è¾ƒå·®ï¼Œä½† overhead ä¼šè¾ƒå°ã€‚\nå¦‚æœæ—¶é—´ç‰‡æ— é™å¤§ï¼Œåˆ™ RRâ‰ˆFCFSã€‚\nåœ¨å®è·µä¸­ï¼Œæ—¶é—´ç‰‡å¤§çº¦ 10~100msï¼Œæ¯æ¬¡ contest-switch çº¦ 10Î¼sã€‚å³ context-switch çš„æ—¶é—´èŠ±è´¹æ˜¯æ¯”è¾ƒå°çš„ã€‚\n\n\nPriority Scheduling flashcard\næ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä¸ªä¼˜å…ˆçº§ï¼Œæ¯æ¬¡è°ƒåº¦æ—¶é€‰å–æœ€é«˜ä¼˜å…ˆçº§çš„è¿›ç¨‹ã€‚ï¼ˆä¸‹ä¾‹ä¸­è§„å®šä¼˜å…ˆçº§å€¼å°çš„ä¼˜å…ˆçº§é«˜ï¼‰\nä¼˜å…ˆçº§å¯ä»¥æ˜¯å†…éƒ¨çš„æˆ–è€…å¤–éƒ¨çš„ï¼š\n\ninternal: ä¸€äº›æµ‹é‡æ•°æ®ï¼Œä¾‹å¦‚ SJF æ˜¯ Priority çš„ä¸€ä¸ªç‰¹ä¾‹ï¼Œå³ä¼˜å…ˆçº§ç”±é¢„æµ‹ CPU è¿è¡Œæ—¶é—´å†³å®šã€‚\nexternal: ç”±ç”¨æˆ·æŒ‡å®šè¿›ç¨‹çš„é‡è¦æ€§ã€‚\nâ€‹è¦å®ç° Priority Schedulingï¼Œå¯ä»¥ç®€å•åœ°å°† ready queue ç”¨ priority queue å®ç°ï¼›priority queue ä¹Ÿå¯ä»¥æ˜¯æŠ¢å å¼æˆ–éæŠ¢å å¼çš„ï¼Œå¦‚ SJF ä¸€æ ·ã€‚\nâ€‹Priority çš„ä¸€ä¸ªé‡è¦é—®é¢˜æ˜¯Â indefinite blocking / starvationÂ ï¼Œå³ä½ä¼˜å…ˆçº§çš„è¿›ç¨‹å¯èƒ½æ°¸è¿œæ²¡æœ‰æœºä¼šè¢«æ‰§è¡Œã€‚ä¸€ä¸ªè§£å†³æ–¹æ³•æ˜¯Â Priority AgingÂ ï¼Œå³æ ¹æ®ç­‰å¾…æ—¶é—´é€æ¸å¢åŠ åœ¨ç³»ç»Ÿä¸­ç­‰å¾…çš„è¿›ç¨‹çš„ä¼˜å…ˆçº§ã€‚\n\n\nMultilevel Queue Scheduling flashcard\nåœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿›ç¨‹é€šå¸¸è¢«åˆ†ä¸ºä¸åŒçš„ç»„ï¼Œæ¯ä¸ªç»„æœ‰ä¸€ä¸ªè‡ªå·±çš„ ready queueï¼Œä¸”æ¯ä¸ªé˜Ÿåˆ—å†…éƒ¨æœ‰è‡ªå·±ç‹¬ç«‹çš„è°ƒåº¦ç®—æ³•ã€‚\n\nå‰å°é˜Ÿåˆ—ä½¿ç”¨ RR è°ƒåº¦ä»¥ä¿è¯ responseï¼Œåå°é˜Ÿåˆ—å¯ä»¥ä½¿ç”¨ FCFSã€‚\né˜Ÿåˆ—ä¹‹é—´ä¹Ÿåº”å½“æœ‰è°ƒåº¦ã€‚é€šå¸¸ä½¿ç”¨ preemptive priority schedulingï¼Œå³å½“ä¸”ä»…å½“é«˜ä¼˜å…ˆçº§çš„é˜Ÿåˆ—ï¼ˆå¦‚å‰å°é˜Ÿåˆ—ï¼‰ä¸ºç©ºæ—¶ï¼Œä½ä¼˜å…ˆçº§çš„é˜Ÿåˆ—ï¼ˆå¦‚åå°é˜Ÿåˆ—ï¼‰ä¸­çš„è¿›ç¨‹æ‰èƒ½è·å‡†è¿è¡Œã€‚\nä½¿ç”¨é˜Ÿåˆ—é—´çš„ time-slicingï¼Œä¾‹å¦‚ä¸€ä¸ªé˜Ÿåˆ—ä½¿ç”¨ 80% çš„æ—¶é—´ç‰‡è€Œå¦ä¸€ä¸ªä½¿ç”¨ 20%ã€‚\n\n\n\nMultilevel Feedback Queue Scheduling flashcard\nâ€‹Multilevel Feedback Queue Scheduling å…è®¸è¿›ç¨‹åœ¨é˜Ÿåˆ—ä¹‹é—´è¿ç§»ã€‚è¿™ç§ç®—æ³•å¯ä»¥æœ‰å¾ˆå¤šç§å®ç°ï¼Œå› ä¸ºé˜Ÿåˆ—çš„æ•°é‡ã€æ¯ä¸ªé˜Ÿåˆ—ä¸­çš„è°ƒåº¦ç­–ç•¥ã€é˜Ÿåˆ—ä¹‹é—´çš„è°ƒåº¦ç®—æ³•ä»¥åŠå°†è¿›ç¨‹å‡çº§åˆ°æ›´é«˜ä¼˜å…ˆçº§/é™çº§åˆ°æ›´ä½ä¼˜å…ˆçº§çš„é˜Ÿåˆ—çš„æ¡ä»¶éƒ½æ˜¯å¯å˜çš„ã€‚ä¸€ä¸ªç³»ç»Ÿä¸­çš„æœ€ä¼˜é…ç½®åœ¨å¦ä¸€ä¸ªç³»ç»Ÿä¸­ä¸ä¸€å®šå¾ˆå¥½ã€‚è¿™ç§ç®—æ³•ä¹Ÿæ˜¯æœ€ä¸ºå¤æ‚çš„ã€‚\n\næœ‰ä¸‰ä¸ªé˜Ÿåˆ— 0, 1, 2ï¼Œä¼˜å…ˆçº§é€æ¬¡é™ä½ã€‚\nå½“è¿›ç¨‹ ready æ—¶è¢«æ·»åŠ åˆ° Q0 ä¸­ï¼ŒQ0 å†…éƒ¨é‡‡ç”¨ RR Schedulingï¼Œçš„æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ 8ms çš„æ—¶é—´å®Œæˆå…¶è¿è¡Œï¼Œå¦‚æœæ²¡æœ‰å®Œæˆåˆ™è¢«æ‰“æ–­å¹¶è¿›å…¥ Q1ï¼›\nåªæœ‰å½“ Q0 ä¸ºç©ºæ—¶ Q1 æ‰å¯èƒ½è¢«è¿è¡Œã€‚Q1 å†…éƒ¨ä¹Ÿä½¿ç”¨ RR Schedulingï¼Œæ¯ä¸ªè¿›ç¨‹æœ‰ 16ms æ—¶é—´å®Œæˆå…¶è¿è¡Œï¼Œå¦‚æœæ²¡æœ‰å®Œæˆåˆ™è¢«æ‰“æ–­å¹¶è¿›å…¥ Q2ï¼›\nåªæœ‰å½“ Q1 ä¹Ÿä¸ºç©ºæ—¶ Q2 æ‰å¯èƒ½è¢«è¿è¡Œã€‚Q2 å†…éƒ¨é‡‡ç”¨ FCFS ç®—æ³•ã€‚\n"},"è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/02.3-çº¿ç¨‹":{"slug":"è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/02.3-çº¿ç¨‹","filePath":"è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/02.3 çº¿ç¨‹.md","title":"02.3 çº¿ç¨‹","links":["tags/flashcard"],"tags":["flashcard"],"content":"DECK: CS::OS\nå¤šçº¿ç¨‹ç¼–ç¨‹Multi-Threaded Programming flashcard\nã€‹çº¿ç¨‹æ˜¯ä¸€ç§è½»é‡çº§çš„è¿›ç¨‹ï¼Œå®ƒåœ¨è¿›ç¨‹çš„åŸºç¡€ä¸Šè¿›è¡Œåˆ’åˆ†ï¼Œæ˜¯è¿›ç¨‹å†…çš„ä¸€ä¸ªå¯è°ƒåº¦çš„æ‰§è¡Œå•å…ƒï¼Œä»¥å‡å°è¿›ç¨‹ folk å’Œåˆ‡æ¢çš„å¼€é”€ä¸ºç›®çš„ã€‚\nã€‹å¯¹äºæ”¯æŒçº¿ç¨‹çš„æ“ä½œç³»ç»Ÿï¼Œå®é™…è°ƒåº¦çš„æ˜¯å†…æ ¸çº§çº¿ç¨‹è€Œéè¿›ç¨‹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œçº¿ç¨‹æ˜¯è¿è¡Œä»¥åŠ CPU è°ƒåº¦çš„åŸºæœ¬å•å…ƒã€‚ï¼ˆè€Œè¿›ç¨‹æ˜¯åˆ†é…èµ„æºçš„åŸºæœ¬å•å…ƒã€‚ï¼‰\nåŒä¸€è¿›ç¨‹çš„è‹¥å¹²çº¿ç¨‹\n\nå…±äº«ä»£ç ã€æ•°æ®ç­‰â€œç›¸å¯¹é™æ€â€çš„èµ„æº\nå„è‡ªç»´æŠ¤å¯„å­˜å™¨ã€æ ˆã€PC ç­‰â€œç›¸å¯¹åŠ¨æ€â€çš„èµ„æº\n\nä¼˜ç‚¹\n\nç«‹çº¿ç¨‹ç›¸æ¯”è¿›ç¨‹æ˜¯å¾ˆç»æµçš„ï¼Œå› ä¸º code, data &amp; heap å·²ç»åœ¨å†…å­˜ä¸­äº†ã€‚åœ¨åŒä¸€è¿›ç¨‹çš„çº¿ç¨‹é—´è¿›è¡Œ context switch æ—¶ä¹Ÿä¼šæ›´å¿«ï¼Œå› ä¸ºä¸éœ€è¦ cache flush\nçº¿ç¨‹å¤©ç”Ÿå’ŒåŒä¸€è¿›ç¨‹å†…çš„å…¶å®ƒçº¿ç¨‹å…±äº«èµ„æºï¼Œå› æ­¤åŒè¿›ç¨‹å†…çº¿ç¨‹å¤©ç”Ÿå°±æœ‰çº¿ç¨‹é—´é€šä¿¡çš„èƒ½åŠ›ã€‚ä¸éœ€è¦IPCï¼ˆinter-process communicationï¼‰è¿›è¡Œä¸åŒè¿›ç¨‹é—´äº¤æµ\nåŒæ—¶ï¼Œç”±äºå°†è¿›ç¨‹è¿›è¡Œäº†å†åˆ’åˆ†ï¼Œä¸€æ–¹é¢åœ¨ç¡¬ä»¶æ”¯æŒçš„æƒ…å†µä¸‹èƒ½æ›´å¥½åœ°é€‚é…å¹¶è¡Œï¼Œå¦ä¸€æ–¹é¢ä¹Ÿèƒ½ï¼ˆä»£ä»·æ›´å°åœ°ï¼‰è®©ä»»åŠ¡çš„ç²’åº¦å˜å°ï¼Œæ­¤æ—¶å¯ä»¥å°†æ•´ä¸ªè¿›ç¨‹çš„é˜»å¡è½¬ç§»åˆ°å•ä¸ªçº¿ç¨‹çš„é˜»å¡ä¸Šï¼Œè¿›ä¸€æ­¥å‡å°‘å“åº”æ—¶é—´ã€‚\n\nç¼ºç‚¹\n\nè™½ç„¶å°†è‹¥å¹²ä»»åŠ¡éƒ½æ”¾åˆ°ä¸€ä¸ªè¿›ç¨‹çš„å¤šçº¿ç¨‹å¯ä»¥æé«˜æ•ˆç‡ï¼Œä½†æ˜¯ä¸€æ—¦â€œç¯®å­â€åäº†ï¼Œé‚£æ‰€æœ‰â€œé¸¡è›‹â€éƒ½æ— æ³•å¹¸å…ï¼›\nå…¶æ¬¡ï¼Œè™½ç„¶å¤©ç„¶çš„å…±äº«å±æ€§è®©çº¿ç¨‹èƒ½æ›´æ–¹ä¾¿åœ°è¿›è¡Œçº¿ç¨‹é—´é€šä¿¡ï¼Œä½†ä¹Ÿå¸¦æ¥äº†å†…å­˜ä¿æŠ¤çš„é—®é¢˜ã€‚\nç”±äº OS å¯¹æ¯ä¸ªè¿›ç¨‹åœ°å€ç©ºé—´çš„å¤§å°é™åˆ¶ï¼Œå¤šçº¿ç¨‹å¯èƒ½ä¼šä½¿å¾—è¿›ç¨‹çš„å†…å­˜é™åˆ¶æ›´åŠ ç´§ç¼©ï¼ˆè¿™åœ¨ 64 ä½ä½“ç³»ç»“æ„ä¸­ä¸å†æ˜¯é—®é¢˜ï¼‰\n\n\nçº¿ç¨‹å®ç°æ–¹å¼ flashcard\næŒ‰ç…§çº¿ç¨‹åˆ’åˆ†çš„å®ç°ä½ç½®ï¼Œå¤šçº¿ç¨‹æ¨¡å‹åˆ†ä¸º\n\nç”¨æˆ·çº§å¤šçº¿ç¨‹(user threads)\n\nå®ƒåœ¨æ“ä½œç³»ç»Ÿä¸Šåªæ˜¯ä¸€ä¸ªè¿›ç¨‹ï¼Œè¿™ä¸ªè¿›ç¨‹åŒ…å«Â çº¿ç¨‹åº“ (Thread Library)Â çš„éƒ¨åˆ†ï¼Œâ€‹è¿™éƒ¨åˆ†ä»£ç è´Ÿè´£å®Œæˆçº¿ç¨‹çš„åˆ›å»ºã€åˆ‡æ¢ç­‰æ“ä½œï¼›\n\n\nå†…æ ¸çº§å¤šçº¿ç¨‹(kernel threads)ã€‚\n\nå†…æ ¸çº§çº¿ç¨‹åˆ™æ˜¯ç”±æ“ä½œç³»ç»Ÿæ”¯æŒè¿™äº›æ“ä½œã€‚\nä¸¤è€…å„æœ‰ä¼˜ç¼ºç‚¹ï¼š\n\n\nç”¨æˆ·çº§å¤šçº¿ç¨‹ &gt; å†…æ ¸çº§å¤šçº¿ç¨‹\n\nç”¨æˆ·çº§å¤šçº¿ç¨‹ä¸éœ€è¦è¿›å…¥å†…æ ¸æ€å®ç°å¤šçº¿ç¨‹ï¼Œä¹Ÿä¸éœ€è¦å ç”¨çº¿ç¨‹ IDï¼Œå› æ­¤ç†è®ºä¸Šå¯ä»¥æ¯”å†…æ ¸çº§æ”¯æŒæ›´å¤šçš„çº¿ç¨‹æ•°ï¼›\nç”±äºå…¶åˆ’åˆ†æ˜¯é’ˆå¯¹è¿›ç¨‹çš„ï¼Œè€Œä¸åŒè¿›ç¨‹ä¹‹é—´çš„çº¿ç¨‹å®ç°æ²¡æœ‰ç›´æ¥å…³ç³»ï¼Œè€Œä¸”ç”±äºæ˜¯åœ¨ç”¨æˆ·ç©ºé—´å®ç°ç®—æ³•ï¼Œæ‰€ä»¥èƒ½å¤Ÿæ›´å®¹æ˜“çš„å¯¹å•ä¸ªè¿›ç¨‹å†…çš„å¤šä¸ªçº¿ç¨‹çš„è°ƒåº¦ç®—æ³•è¿›è¡Œè‡ªå®šä¹‰ï¼›\n\n\nç”¨æˆ·çº§å¤šçº¿ç¨‹ &lt; å†…æ ¸çº§å¤šçº¿ç¨‹\n\nç”±äºå¯¹å†…æ ¸æ¥è¯´ï¼Œç”¨æˆ·çº§å¤šçº¿ç¨‹ä»ç„¶æ˜¯ä¸€ä¸ªæ™®é€šçš„è¿›ç¨‹ï¼Œæ‰€ä»¥å½“ç”¨æˆ·çº§çš„çº¿ç¨‹å‡ºç°é˜»å¡æ—¶ï¼Œå†…æ ¸ä¼šè®¤ä¸ºæ•´ä¸ªè¿›ç¨‹éƒ½è¢«é˜»å¡ï¼›å†…æ ¸çº§çº¿ç¨‹ç”±äºæ˜¯å†…æ ¸å®ç°ï¼Œæ‰€ä»¥å•çº¿ç¨‹çš„é˜»å¡å¹¶ä¸ä¼šå¯¼è‡´æ•´ä¸ªè¿›ç¨‹é˜»å¡ï¼›\nåœ¨å¤šæ ¸çš„æƒ…å†µä¸‹ï¼Œç”¨æˆ·çº§å¤šçº¿ç¨‹æ²¡æ³•åˆ©ç”¨å¤šæ ¸è¿›è¡Œçº¿ç¨‹å¹¶è¡Œï¼›åªæœ‰å†…æ ¸ (OS) æ‰èƒ½æŠŠå·¥ä½œåˆ†é…åˆ°ä¸åŒçš„ CPU æ ¸å¿ƒä¸Š\n\n\n\n\nå¤šçº¿ç¨‹ä¸»è¦æ¨¡å‹ flashcard\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”¨æˆ·çº§å¤šçº¿ç¨‹å’Œå†…æ ¸çº§å¤šçº¿ç¨‹å¹¶ä¸å†²çªï¼Œå› è€Œæ’åˆ—ç»„åˆåå¾—åˆ°å¤šçº¿ç¨‹ä¸»è¦æœ‰å¦‚ä¸‹ä¸‰ç§æ¨¡å‹ï¼š\n\n(a) One-to-one model. (b) Many-to-many model. (c) Many-to-one model.\n\næ¯ä¸ªç”¨æˆ·çº¿ç¨‹éƒ½åˆ›å»ºä¸€ä¸ªå†…æ ¸çº¿ç¨‹ï¼Œå¼€é”€å¤§ï¼Œä½†æ˜¯ä¸ä¼šæœ‰ä¸€ä¸ªé˜»å¡éƒ½è¢«é˜»å¡çš„é—®é¢˜\nå¯ä»¥æ™ºèƒ½åœ°è°ƒåº¦userthreadè¦ç”¨å“ªä¸ªkernelthreadï¼Œä¸€ä¸ªè¢«é˜»å¡äº†å°±æ¢å¦ä¸€ä¸ªkernelthreadå·¥ä½œ\nåªç»™kernelthreadsåˆ†é…ä¸€ä¸ªCPUcoreï¼Œä¸€ä¸ªè¢«é˜»å¡å°±ä¼šéƒ½è¢«é˜»å¡[kernelthreadçš„é˜»å¡é—®é¢˜]\n\n\n\nçº¿ç¨‹æ± \n\né€‚ç”¨åœºæ™¯ï¼šå¤§é‡åŒæ—¶å¹¶å‘ä»»åŠ¡å¤„ç†"},"è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/03.1-è¿›ç¨‹åŒæ­¥åŠå…¶å·¥å…·":{"slug":"è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/03.1-è¿›ç¨‹åŒæ­¥åŠå…¶å·¥å…·","filePath":"è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/03.1 è¿›ç¨‹åŒæ­¥åŠå…¶å·¥å…·.md","title":"03.1 è¿›ç¨‹åŒæ­¥åŠå…¶å·¥å…·","links":["tags/flashcard"],"tags":["flashcard"],"content":"\nå¹¶å‘: åŒæ—¶è¿è¡Œä½†ä¸ä¸€å®šå®Œå…¨å¯¹é½é‡å ,\nå¹¶è¡Œ: æ›´åŠ ä¸¥æ ¼\n\n\nã€Œâ€‹åŒæ­¥ã€çš„æ ¸å¿ƒæ„ä¹‰æ˜¯ï¼Œè§„å®šè¿›ç¨‹æ‰€åšçš„å·¥ä½œä¹‹é—´çš„é¡ºåºæˆ–è€…å…ˆåºå…³ç³»ï¼Œä»è€Œé˜²æ­¢ä¸€äº›éæ³•æƒ…å†µçš„å‘ç”Ÿã€‚\n\nä¸ºä»€ä¹ˆéœ€è¦åŒæ­¥\n\nÂ Cooperating ProcessÂ æ˜¯å¯ä»¥å½±å“ç³»ç»Ÿä¸­å…¶ä»–è¿è¡Œè¿›ç¨‹æˆ–è¢«å…¶ä»–è¿›ç¨‹å½±å“çš„è¿›ç¨‹ã€‚\nCooperating processes ä¼šå…±åŒä½¿ç”¨ä¸€äº›æ•°æ®\n\nå¯èƒ½æ˜¯ç›´æ¥ä½¿ç”¨åŒä¸€æ®µåœ°å€ç©ºé—´ï¼ˆä»£ç +æ•°æ®ï¼‰\næˆ–è€…æ˜¯é€šè¿‡å…±äº«çš„å†…å­˜æˆ–ä¿¡æ¯ä¼ é€’æ¥å…±ç”¨ä¸€äº›æ•°æ®ã€‚\n\n\nå› ä¸ºæ•°æ®çš„ä¸€è‡´æ€§éœ€è¦ cooperating processes æœ‰åºçš„è¿è¡Œ[ä¸æ“ä½œçš„æ—¶åºæœ‰å…³]ã€‚å¯¹æ•°æ®çš„åŒæ—¶è®¿é—® (concurrent access) å¯èƒ½ä¼šå¯¼è‡´ data inconsistency\n\nrace condition:\n\nå¤šä¸ªè¿›ç¨‹åŒæ—¶æ“æ§åŒä¸€ä¸ªæ•°æ®ï¼Œå› è€Œç»“æœå–å†³äºæ¯ä¸€ç§æ“æ§çš„å‡ºç°é¡ºåºçš„æƒ…å½¢\né˜²æ­¢ race conditionï¼Œæˆ‘ä»¬éœ€è¦ä¿è¯åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªè¿›ç¨‹å¯ä»¥æ“æ§æŸä¸ªå˜é‡ã€‚\n\nBounded-buffer Problemä¸­çš„race conditioné—®é¢˜\nç»™å®šä¸¤ä¸ªè¿›ç¨‹ï¼šproducer å’Œ consumerï¼Œå®ƒä»¬å…±ç”¨å¤§å°ä¸ºÂ Â çš„ bufferã€‚Producer ç”Ÿäº§æ•°æ®æ”¾å…¥ bufferï¼Œconsumer ä» buffer å–å‡ºæ•°æ®ä»è€Œä½¿ç”¨ä¹‹ã€‚\nè¯¥é—®é¢˜éœ€è¦ä¿è¯ï¼šproducer ä¸åº”å½“åœ¨ buffer æ»¡æ—¶æ”¾å…¥æ•°æ®ï¼Œconsumer ä¹Ÿä¸åº”å½“åœ¨ buffer ç©ºæ—¶å–å‡ºæ•°æ®ã€‚\næˆ‘ä»¬å¯èƒ½æƒ³è¦åƒè¿™æ ·å®ç°è¿™ä¸¤ä¸ªè¿›ç¨‹ï¼š\n/* Producer Process */\nwhile (true) {\n    /* produce an item in next_produced */\n    while (count == BUFFER_SIZE)\n        ; /* do nothing */\n    //ç›´åˆ°æ¶ˆè´¹è€…å–èµ°ä¸€ä¸ªæ•°æ®,å¯¼è‡´count&lt;buffer_size\n    buffer[in] = next_produced;\n    in = (in + 1) % BUFFER_SIZE;\n    count++;\n}\n \n/* Consumer Process */\nwhile (true) {\n    while (count == 0)\n        ; /* do nothing */\n    next_consumed = buffer[out];\n    out = (out + 1) % BUFFER_SIZE;\n    count--;\n    /* consume the item in next_consumed */\n}\ncount++ (ç”Ÿäº§è€…åšçš„) ï¼š\n\nregister1 = count: æŠŠå†…å­˜é‡Œçš„æ•°æ¬åˆ° CPU å¯„å­˜å™¨é‡Œ\nregister1 = register1 + 1: å¯„å­˜å™¨åŠ  1\ncount = register1: æŠŠç®—å¥½çš„æ–°å€¼å†™å›å†…å­˜\ncount-- (æ¶ˆè´¹è€…åšçš„) åŒç†ï¼Œä¹Ÿæ˜¯æ¬è¿ã€å‡ 1ã€å†™å›ã€‚\nä½†æ˜¯ä¸€ç³»åˆ—æ“ä½œæ˜¯å¯ä»¥è¢«æ‰“æ–­çš„,æ‰€ä»¥å¯èƒ½ä¼šæœ‰ä¸‹è¿°è¿è¡Œé¡ºåºå¯¼è‡´countå€¼å‘ç”Ÿé”™è¯¯\n\nkernelä¸­è¯·æ±‚å­è¿›ç¨‹pidä¸­çš„race conditioné—®é¢˜\n\nåŒæ—¶éƒ½å»è·å–ä¸€ä¸ªå­è¿›ç¨‹pid,ä½†æ˜¯next_available_pidè¿˜æœªæ¥å¾—åŠæ›´æ–°çš„æƒ…å†µ\nThe Critical-Section Problem flashcard\n\nè€ƒè™‘ä¸€ä¸ªæœ‰ n ä¸ªè¿›ç¨‹çš„ç³»ç»Ÿï¼Œæ¯ä¸ªè¿›ç¨‹ä¸­éƒ½æœ‰è¿™æ ·ä¸€æ®µä»£ç ï¼Œå®ƒå¯èƒ½ä¼šä¿®æ”¹ä¸€äº›ä¸å…¶ä»–è‡³å°‘ä¸€ä¸ªè¿›ç¨‹å…¬ç”¨çš„æ•°æ®ï¼Œè¿™æ®µä»£ç ç§°ä¸ºÂ critical section\n\nè¿™ä¸ªç³»ç»Ÿéœ€è¦æ»¡è¶³çš„é‡è¦æ€§è´¨æ˜¯ï¼šå½“ä¸€ä¸ªè¿›ç¨‹æ­£åœ¨è¿è¡Œå®ƒçš„ critical section æ—¶ï¼Œå…¶ä»–è¿›ç¨‹éƒ½ä¸èƒ½è¿›å…¥å®ƒçš„ critical sectionã€‚\n\n\néœ€è¦è®¾è®¡ä¸€ç§èƒ½è®©å„ä¸ªè¿›ç¨‹Â åŒæ­¥ (synchronize)Â å®ƒä»¬çš„æ´»åŠ¨ï¼Œä»è€Œå®‰å…¨åœ°å…±äº«æ•°æ®çš„åè®®ã€‚\n\n\n\nâ€‹\nCritical-section problem çš„è§£å†³æ–¹æ³•å¿…é¡»æ»¡è¶³å¦‚ä¸‹ä¸‰ä¸ªè¦æ±‚ flashcard\n\nMutual exclusion:æ²¡æœ‰ä¸¤ä¸ªè¿›ç¨‹å¯ä»¥åŒæ—¶è¿è¡Œ critical sectionã€‚\nProgress:ç³»ç»Ÿæ•´ä½“ä¸Šæ˜¯åœ¨è¿è¡Œçš„,\nBounded waitingÂ :æå‡ºè¯·æ±‚åä¸ä¼šæ— é™ç­‰å¾…,æœ€ç»ˆä¸€å®šèƒ½å¤Ÿè¿›å…¥Â critical section\n\n\nkernelä¸­çš„CS problem\n\n\nâ€‹å¯¹äºå•æ ¸ç³»ç»Ÿï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨ critical section ä¸­ç¦æ­¢ä¸­æ–­[å³åœ¨ entry section ä¸­ disableï¼Œåœ¨ exit section ä¸­ enable]çš„æ–¹å¼æ¥å®ç°ä¸Šè¿°åŠŸèƒ½ï¼ˆè™½ç„¶å¯èƒ½æ˜¯å±é™©çš„ï¼‰\n\n\nä½†æ˜¯å¯¹äºå¤šæ ¸ç³»ç»Ÿï¼Œä¸­æ–­ç¦æ­¢çš„æ¶ˆæ¯è¦ä¼ åˆ°æ‰€æœ‰æ ¸[ä¸ç„¶åˆ«çš„è¿›ç¨‹ä¼šè¿›å…¥è‡ªå·±çš„cs]ï¼Œæ¶ˆæ¯ä¼ é€’ä¼šå»¶è¿Ÿè¿›å…¥ä¸´ç•ŒåŒºï¼Œä¼šé™ä½æ•ˆç‡ï¼›åŒæ—¶ä¹Ÿä¼šå½±å“æ—¶é’Ÿä¸­æ–­ã€‚\n\n\næˆ‘ä»¬éœ€è¦ä¿è¯ kernel çš„è®¾è®¡å®ç°äº† critical sectionã€‚Kernel çš„å®ç°åˆ†ä¸ºä¸¤ç§ç±»å‹\n\nåˆ†åˆ«æ˜¯Â æŠ¢å å¼å†…æ ¸ preemptive kernelÂ å’ŒÂ éæŠ¢å å¼å†…æ ¸ nonpreemptive kernelï¼Œå…¶åŒºåˆ«æ˜¯æ˜¯å¦å…è®¸å¤„äº kernel mode çš„è¿›ç¨‹è¢«æŠ¢å ã€‚\n\n\n\nå¯¹å•æ ¸æ¥è¯´\n\néæŠ¢å å¼å†…æ ¸ä¸ä¼šå¯¼è‡´ kernel mode çš„ race conditionï¼Œå› ä¸ºåœ¨ä»»ä¸€æ—¶é—´ç‚¹åªæœ‰ä¸€ä¸ªè¿›ç¨‹èƒ½åœ¨å†…æ ¸æ€é‡Œè·‘.\nâ€‹æŠ¢å å¼å†…æ ¸è¦è§£å†³ critical-section problem çš„è¯ç›¸å¯¹è€Œè¨€æ›´éš¾è®¾è®¡ï¼Œä½†æ˜¯åŒæ—¶ä¹Ÿèƒ½æœ‰æ›´å¿«çš„å“åº”ã€‚\n\n\n\nå…³äºå¤„ç†å™¨/æ ¸/å†…æ ¸æ€/ç”¨æˆ·æ€çš„è¾¨æ.\n\n\nCPU(é€šå¸¸æŒ‡ç‰©ç†å°è£…çš„èŠ¯ç‰‡)ä¸Šå¯èƒ½æœ‰å•æ ¸/å¤šæ ¸.ä¸€ä¸ªæ ¸åªèƒ½åŒæ—¶è¿è¡Œä¸€ä¸ªä»»åŠ¡.\n\næ ¸ä¹‹é—´å…±äº«æ€»çº¿æ¥å£å’Œ3çº§ç¼“å­˜\nä½†æ˜¯12çº§ç¼“å­˜å’Œè®¡ç®—å•å…ƒæ˜¯å±äºæ ¸è‡ªå·±çš„\n\n\nå†…å­˜æ˜¯å•ç‹¬çš„,cpuä¹Ÿæ˜¯å•ç‹¬çš„,cpuåªæ˜¯åŠ è½½å†…æ ¸ä»£ç å»è·‘è€Œå·².å®é™…ä¸Š,å†…æ ¸æ€å’Œç”¨æˆ·æ€æœ¬è´¨ä¸Šæ²¡æœ‰åŒºåˆ«,åªæ˜¯ç‰¹æƒæ¨¡å¼\\ç‰¹æƒå¯„å­˜å™¨\\è®¿é—®ä»£ç æƒé™çš„åŒºåˆ«.\n\n\nPetersonâ€™s Solution\nPetersonâ€™s solution åŸºäºä¸€å®šçš„å‡è®¾è§£å†³äº†ä¸¤ä¸ª task çš„ synchornizationï¼š\nint turn;           // Who is allowed to enter\nboolean flag[2];    // Ready to enter its CS\n \nvoid foo() {\n    while (true) {\n        flag[i] = true;     // Mark self ready\n        turn = 1 - i;       // Assert that if the other process wishes to å¦‚æœæˆ‘æ˜¯1é‚£ä¹ˆ1-iå°±æ˜¯0,å¦‚æœæˆ‘æ˜¯0é‚£ä¹ˆ1-iå°±æ˜¯1,è¿™æ˜¯ä¸€ä¸ªè°¦è®©ç­–ç•¥.\n                            // enter its CS, it can do so.\n        while (flag[1 - i] &amp;&amp; turn == 1 - i);   // Wait\n        /* critical section */\n        flag[i] = false;    // Set ready to false\n        /* remainder section */\n    }//è°æœ€åæ‰§è¡Œ `turn = 1 - i`ï¼Œè°å°±ä¼šå› ä¸ºâ€œå¤ªå®¢æ°”â€è€Œè¢«å¡åœ¨é—¨å£ç­‰å¾…\n}\nå…¶ä¸­ï¼ŒÂ iÂ æ˜¯ 0 æˆ– 1ï¼Œè¡¨ç¤ºç¬¬ i ä¸ªè¿›ç¨‹ï¼›Â turnÂ æ˜¯å½“å‰æœ‰æƒè¿›å…¥ critical section çš„è¿›ç¨‹ï¼ˆ0 æˆ– 1ï¼‰ï¼›Â flag[i]Â æ˜¯ç¬¬ i ä¸ªè¿›ç¨‹æ˜¯å¦å‡†å¤‡å¥½è¿›å…¥ critical sectionï¼Œåˆå§‹å€¼å‡ä¸º FALSEã€‚\næ€§è´¨è¯æ˜\né€šè¿‡ç®€æ˜“çš„åˆ†ç±»è®¨è®ºè¯æ˜ Petersonâ€™s Solution æ»¡è¶³ä¸‰ä¸ªæ€§è´¨ï¼šMutual exclusion, process and bounded waitingã€‚\n\np0å·²ç»åœ¨csé‡Œé¢çš„æ—¶å€™p1æ— æ³•è¿›å…¥\n\nå¦‚æœp0æˆåŠŸè¿›å…¥cs,é‚£ä¹ˆwhile (flag[1] &amp;&amp; turn == 1)ä¸ºå‡.\np1çš„æƒ…å†µ:å¯èƒ½æ˜¯flag[1] = false,ä»–è‡ªå·±ä¸æƒ³è¿›.æˆ–è€…flag[1] = true ä½† turn = 1,ä½†æ˜¯è¿™å’Œä¸Šä¸€æ¡çŸ›ç›¾äº†.å› æ­¤ä¸å­˜åœ¨.\nflag[1] = true ä¸” turn = 0ç¬¦åˆ.\n\n\nå¦‚æœæ²¡æœ‰äººåœ¨cså†…,ä¸”æœ‰äººæƒ³è¿›å»,å°±å¯ä»¥è¿›,ä¸ä¼šå¯¼è‡´æ­»é”\n\nå› ä¸º turn æˆ–è€…æ˜¯ 0ï¼Œæˆ–è€…æ˜¯ 1ï¼Œä¸å¯èƒ½æ—¢æ˜¯ 0 åˆæ˜¯ 1ã€‚æ€»æœ‰ä¸€ä¸ªäººèƒ½çªç ´å¾ªç¯\n\n\næœç»äº†é¥¥é¥¿\n\nå½“p1å‡ºæ¥çš„æ—¶å€™ä¼šæ‰§è¡Œflag[1] = false,å¯ä»¥å½“p0è¿›å».ä¸ä¼šå¯¼è‡´p0ä¸€ç›´æ— æ³•è¿›å…¥cs\n\n\n\nReordering\n1. æŒ‡ä»¤é‡æ’\nä½†å®é™…ä¸Šï¼ŒPetersonâ€™s solution åœ¨ç°ä»£è®¡ç®—æœºä½“ç³»ç»“æ„ä¸Šä¸ä¸€å®šé€‚ç”¨ï¼Œå› ä¸ºç°ä»£çš„å¤„ç†å™¨å’Œç¼–è¯‘å™¨æœ‰å¯èƒ½ä¼šä¸ºäº†ä¼˜åŒ–æ€§èƒ½è€Œå¯¹ä¸€äº›è¯»å†™æ“ä½œè¿›è¡Œé‡æ’ã€‚\nåœ¨ä¼˜åŒ–ä¸­ï¼Œå¤„ç†å™¨æˆ–ç¼–è¯‘å™¨ä¼šè€ƒè™‘å…¶é‡æ’çš„åˆç†æ€§ï¼Œå³ä¿è¯äº†åœ¨å•çº¿ç¨‹ç¨‹åºä¸­ç»“æœå€¼æ˜¯ç¨³å®šä¸”æ­£ç¡®çš„ã€‚ä½†æ˜¯è¿™ä¸èƒ½ä¿è¯å…¶åœ¨å¤šçº¿ç¨‹å…±ç”¨æ•°æ®æ—¶çš„æ­£ç¡®æ€§ï¼Œé‡æ’å¯èƒ½ä¼šå¯¼è‡´ä¸ç¨³å®šæˆ–è€…ä¸æœŸæœ›çš„è¾“å‡ºã€‚ä¾‹å¦‚å¦‚æœç¼–è¯‘å™¨å°†å¯¹Â flag[i]Â å’ŒÂ turnÂ èµ‹å€¼çš„é¡ºåºäº¤æ¢ï¼š\n\n2. å†…å­˜è®¿é—®é‡æ’Memory Access Reordering\nå› ä¸ºå­˜åœ¨è¯»å†™ç¼“å­˜,æ‰€ä»¥å°±ç®—æŒ‡ä»¤çš„æ‰§è¡Œé¡ºåºä¸å˜, å†…å­˜å±‚é¢ä¸Šçš„é¡ºåºè¿˜æ˜¯æœ‰å¯èƒ½å‘ç”Ÿå˜åŒ–\nMemory Barrier\nâ€‹é‡æ’å¯èƒ½ä½¿å¾—åœ¨å¤šæ ¸è¿è¡Œæ—¶å‡ºç°ä¸æœŸæœ›ä¸åŒçš„ç»“æœã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¼•å…¥Â Memory Barrierï¼šå®ƒç”¨æ¥ä¿è¯å…¶ä¹‹å‰çš„å†…å­˜è®¿é—®å…ˆäºå…¶åçš„å®Œæˆã€‚å³ï¼Œæˆ‘ä»¬ä¿è¯åœ¨æ­¤å‰å¯¹å†…å­˜çš„æ”¹å˜å¯¹å…¶ä»–å¤„ç†å™¨ä¸Šçš„è¿›ç¨‹æ˜¯å¯è§çš„\né‡åˆ°è¿™è¡Œå‘½ä»¤å°±åœä¸‹æ¥ç›´åˆ°å†…å­˜è¯»å†™å®Œæ¯•.\nMemory Model\nâ€‹å¦å¤–ï¼Œåœ¨ç°ä»£çš„ä½“ç³»ç»“æ„ä¸Šï¼Œä¸€ä¸ªçº¿ç¨‹å†™äº†å¯¹åº”çš„å˜é‡åæœ‰å¯èƒ½ä¸ä¼šç«‹åˆ»å†™å›å†…å­˜ï¼Œè¿™ä¹Ÿæœ‰å¯èƒ½å¯¼è‡´é—®é¢˜ï¼š\nè®¡ç®—æœºæ¶æ„å¦‚ä½•ç¡®å®šå®ƒå°†å‘åº”ç”¨ç¨‹åºæä¾›ä»€ä¹ˆæ ·çš„å†…å­˜ä¿è¯ï¼Œè¿™è¢«ç§°ä¸ºå…¶å†…å­˜æ¨¡å‹ã€‚é€šå¸¸ï¼Œå†…å­˜æ¨¡å‹åˆ†ä¸ºä»¥ä¸‹ä¸¤ç±»ä¹‹ä¸€ï¼š\n\nStrongly ordered, ä¸€ä¸ªå¤„ç†å™¨[åœ¨æ“ä½œç³»ç»ŸåŸç†å’Œå¹¶å‘ç¼–ç¨‹çš„è¯­å¢ƒä¸‹,å¤„ç†å™¨=æ ¸!=CPU]ä¸Šä¿®æ”¹äº†å†…å­˜,å…¶ä»–æ‰€æœ‰å¤„ç†å™¨ä¼šé©¬ä¸Šçœ‹åˆ°ä¿®æ”¹åçš„å€¼,å³å¤§å®¶çœ‹åˆ°çš„é¡ºåºä¸€è‡´.\n\nå‹å¥½,ä½†æ˜¯é¢‘ç¹é€šè®¯.æ¯”å¦‚x86\n\n\nWeakly ordered, ä¸stronglyç›¸å,å…¶ä»–å¤„ç†å™¨ä¸ä¸€å®šèƒ½é©¬ä¸Šçœ‹åˆ° ,ç”šè‡³å¯èƒ½çœ‹åˆ°ä¹±åº.\n\nçµæ´»,æ€§èƒ½é«˜;ä½†æ˜¯å±é™©,éœ€è¦æ˜¾å¼ä½¿ç”¨memorybarrier.æ¯”å¦‚armæ ¸riscv\n\n\n\nç¡¬ä»¶æŒ‡ä»¤\nâ€‹è®¸å¤šç°ä»£ç³»ç»Ÿæä¾›ç¡¬ä»¶æŒ‡ä»¤ï¼Œç”¨äºæ£€æµ‹å’Œä¿®æ”¹ word çš„å†…å®¹ï¼Œæˆ–è€…ç”¨äºÂ atomicallyï¼ˆuniterruptablyï¼Œä¸å¯è¢«æ‰“æ–­åœ°ï¼‰äº¤æ¢ä¸¤ä¸ª wordã€‚è¿™é‡Œï¼Œæˆ‘ä»¬ä¸è®¨è®ºç‰¹å®šæœºå™¨çš„ç‰¹å®šæŒ‡ä»¤ï¼Œè€Œæ˜¯é€šè¿‡æŒ‡ä»¤Â test_and_set()Â å’ŒÂ compare_and_swap()Â æŠ½è±¡äº†è§£è¿™äº›æŒ‡ä»¤èƒŒåçš„ä¸»è¦æ¦‚å¿µã€‚\ntest_and_set\næŒ‡ä»¤Â test_and_set()Â çš„åŠŸèƒ½å¯ä»¥æŒ‰å¦‚ä¸‹æ–¹å¼æ¥å®šä¹‰ï¼šè¿™ä¸€æŒ‡ä»¤çš„é‡è¦ç‰¹å¾æ˜¯ï¼Œå®ƒçš„æ‰§è¡Œæ˜¯ atomic çš„ã€‚\nbool test_and_set(bool *target) {\n    bool rv = *target;\n    *target = true;\n    return rv;\n}\næˆ‘ä»¬å¯ä»¥åœ¨æ”¯æŒè¿™ä¸ªæŒ‡ä»¤çš„æœºå™¨ä¸Šå®ç° mutual exclusiveï¼šå®šä¹‰ä¸€ä¸ª bool å˜é‡Â lockÂ ï¼Œåˆå§‹åŒ–ä¸º falseã€‚è¿›ç¨‹çš„ç»“æ„ä¸ºï¼š\nwhile (true) {\n    /* Entry Section */\n    while (test_and_set(&amp;lock))     \n        ; /* do nothing */\n \n    /* Critical Section */\n \n    /* Exit Section */\n    lock = false;\n \n    /* Remainder Section */\n}\n\nå¦‚æœÂ lockÂ åœ¨ Entry Section æ—¶ä¸º trueï¼Œé‚£ä¹ˆÂ test_and_set(&amp;lock)Â å°†è¿”å› trueï¼Œå› æ­¤ä¼šå§‹ç»ˆåœ¨ while å¾ªç¯ä¸­å¾ªç¯ã€‚[é”ä½äº†,æ‰€ä»¥ä¸èƒ½è¿›å…¥cs]\nåˆ°æŸä¸ªæ—¶åˆ»Â lockÂ ä¸º falseï¼Œé‚£ä¹ˆÂ test_and_set(&amp;lock)Â å°†è¿”å› false åŒæ—¶å°†Â lockÂ ç½®ä¸º trueï¼Œè¿›ç¨‹è¿›å…¥ Critical Sectionï¼ŒåŒæ—¶ä¿è¯å…¶ä»–è¿›ç¨‹æ— æ³•è¿›å…¥ Critical Sectionã€‚\nå½“æŒé”çš„è¿›ç¨‹å®Œæˆ Critical Section çš„è¿è¡Œï¼Œå®ƒåœ¨ Exit Section ä¸­é‡Šæ”¾Â lockÂ ï¼Œä»è€Œå…è®¸å…¶ä»–è¿›ç¨‹è¿›å…¥ Critical Sectionã€‚\nè€Œå¦‚æœæŸä¸ªæ—¶åˆ»Â lockÂ ä¸º falseï¼Œè€Œæœ‰ä¸¤ä¸ªæˆ–å¤šä¸ªè¿›ç¨‹å‡ ä¹åŒæ—¶è°ƒç”¨äº†Â test_and_set(&amp;lock)Â ã€‚ä½†ç”±äºå®ƒæ˜¯ atomic çš„ï¼Œå› æ­¤åªæœ‰ä¸€ä¸ªè¿›ç¨‹å¯ä»¥è¿”å› falseã€‚\nâ€‹ä½†æ˜¯ï¼Œå¦‚ä¸Šæ‰€ç¤ºçš„æ§åˆ¶ä¸èƒ½æ»¡è¶³ bounded waiting æ¡ä»¶ï¼š\n\nâ€‹æˆ‘ä»¬å¯ä»¥ä½œå¦‚ä¸‹æ›´æ”¹ä»¥æ»¡è¶³ bounded waitingï¼š\n\nwhile (true) {\n    /* Entry Section */\n    waiting[i] = true;\n    while (waiting[i] &amp;&amp; test_and_set(&amp;lock))   \n        ; /* do nothing */\n    waiting[i] = false;\n \n    /* Critical Section */\n \n    /* Exit Section */\n    j = (i + 1) % n;\n    while ((j != i) &amp;&amp; !waiting[j]))\n        j = (j + 1) % n;\n    if (j == i)\n        lock = false;\n    else\n        waiting[j] = false;\n \n    /* Remainder Section */\n}\næˆ‘ä»¬å¼•å…¥äº† bool æ•°ç»„Â waiting[]Â \n\nåœ¨ Entry Section ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆç½®Â waiting[i]Â ä¸º trueï¼›å½“Â waiting[i]Â æˆ–è€…Â lockÂ ä¸­ä»»æ„ä¸€ä¸ªè¢«é‡Šæ”¾æ—¶ï¼Œè¿›ç¨‹å¯ä»¥è¿›å…¥ Critical Sectionã€‚\nåˆå§‹æ—¶ï¼ŒÂ lockÂ ä¸º falseï¼Œç¬¬ä¸€ä¸ªè¯·æ±‚è¿›å…¥ CS çš„è¿›ç¨‹å¯ä»¥è·è®¸è¿è¡Œã€‚\nåœ¨ Exit Section ä¸­ï¼Œè¿›ç¨‹ä»ä¸‹ä¸€ä¸ªè¿›ç¨‹å¼€å§‹ï¼Œéå†ä¸€éæ‰€æœ‰è¿›ç¨‹ï¼Œå‘ç°æ­£åœ¨ç­‰å¾…çš„è¿›ç¨‹æ—¶é‡Šæ”¾å®ƒçš„Â waiting[j]Â ï¼Œä½¿å…¶è·è®¸è¿›å…¥ CSï¼Œå½“å‰è¿›ç¨‹ç»§ç»­ Remainder Section çš„è¿è¡Œï¼›\nå¦‚æœæ²¡æœ‰ä»»ä½•è¿›ç¨‹åœ¨ç­‰å¾…ï¼Œé‚£ä¹ˆå®ƒé‡Šæ”¾Â lockÂ ï¼Œä½¿å¾—ä¹‹åç¬¬ä¸€ä¸ªè¯·æ±‚è¿›å…¥ CS çš„è¿›ç¨‹å¯ä»¥ç›´æ¥è·è®¸ã€‚\nè¿™æ ·çš„æ–¹å¼å¯ä»¥ä¿è¯æ¯ä¸€ä¸ªè¿›ç¨‹è‡³å¤šç­‰å¾… n-1 ä¸ªè¿›ç¨‹åœ¨å…¶å‰é¢è¿›å…¥ CSï¼Œæ»¡è¶³äº† bounded waiting æ¡ä»¶ã€‚\n\ncompare_and_swap\næŒ‡ä»¤Â compare_and_swap()Â å¯ä»¥å¦‚ä¸‹å®šä¹‰ï¼šåŒæ ·ï¼Œcompare_and_swap()Â çš„æ‰§è¡Œæ˜¯ atomic çš„ã€‚\nint compare_and_swap(int *value, int expected, int new_value) {\n    int temp = *value;\n    if (*value == expected)\n        *value = new_value;\n    return temp;\n}\nç±»ä¼¼åœ°ï¼Œæˆ‘ä»¬å£°æ˜ä¸€ä¸ªå…¨å±€å˜é‡Â lockÂ ï¼Œåˆå§‹å€¼è®¾ä¸º 0ã€‚è¿›ç¨‹çš„ç»“æ„ä¸ºï¼š\nwhile (true) {\n    /* Entry Section */\n    while (compare_and_swap(&amp;lock, 0, 1) != 0)  \n        ; /* do nothing */\n \n    /* Critical Section */\n \n    /* Exit Section */\n    lock = 0;\n \n    /* Remainder Section */\n}\nå¯è§ï¼Œcompare_and_swap()Â å’ŒÂ test_and_set()Â æ²¡æœ‰æœ¬è´¨åŒºåˆ«ã€‚ä¸Šä¾‹Â compare_and_swap()Â çš„ä½¿ç”¨æ–¹æ³•åŒæ ·æ— æ³•ä¿è¯ bounded waitingï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸Â test_and_set()Â åŒæ ·çš„æ–¹å¼æ¥è§£å†³ã€‚\nAtomic Vaviables\nâ€‹å¯ä»¥ä½¿ç”¨Â compare_and_swap()Â æŒ‡ä»¤æ¥å®ç°ä¸€äº›å·¥å…·ã€‚å…¶ä¸­ä¸€ä¸ªå·¥å…·å°±æ˜¯Â Atomic Variableã€‚\nâ€‹ä¸€ä¸ªå˜é‡åœ¨æ›´æ–°çš„è¿‡ç¨‹ä¸­å¯èƒ½ä¼šå¯¼è‡´ä¸€ä¸ª race conditionï¼Œè€Œ Atomic Variable å¯ä»¥ä¸ºæ•°æ®æä¾› atomic updatesã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸å¯æ‰“æ–­çš„Â increment(&amp;count); æŒ‡ä»¤æ¥ä»£æ›¿å¯è¢«æ‰“æ–­çš„Â count++Â æŒ‡ä»¤å°±å¯ä»¥è§£å†³æœ¬èŠ‚å¼€å¤´çš„ Bounded-buffer Problemï¼š\nvoid increment(atomic_int *v) {\n    int temp;\n    do {\n        temp = *v;\n    } while (temp != compare_and_swap(v, temp, temp+1));\n}//å¦‚æœè¿˜æ˜¯temp,é‚£ä¹ˆ+1,å¦‚æœä¸æ˜¯çš„è¯å°±ä¿®æ”¹å¤±è´¥:casè¿”å›vçš„å€¼,å‘ç°ç¡®å®ä¸ç›¸ç­‰,ç»§ç»­å¾ªç¯.\n\n\nå¹¶ä¸æ˜¯ä¸ºäº†è®©vä¸€ç›´ä¿æŒæŸä¸ªå€¼,è€Œæ˜¯ä¸ºäº†vå˜åŒ–æ—¶åŸæœ¬çš„å€¼ä¸ä¸¢æ‰.å¦‚æœä¸¤ä¸ªæ“ä½œè¯»åˆ°åŒä¸€ä¸ªvçš„æ—§å€¼,é‚£ä¹ˆå®ƒä»¬å„è‡ªç›¸åŠ çš„è¯ä¸ä¼šå¾—åˆ°å åŠ çš„ç»“æœè€Œæ˜¯ä¼šæœ‰äººè¢«è¦†ç›–æ‰.å¦‚æœç”¨AtomicVariable,å¦‚æœåŸæœ¬çš„æ•°å€¼è¢«æ”¹äº†,å°±å–æœ€æ–°çš„å€¼,ç¡®ä¿äº†æ•°æ®æ²¡æœ‰è¢«æŸå.\nCASæ“ä½œæœ¬èº«æ˜¯åŸå­çš„\n\n\nä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒAtomic Variable å¹¶ä¸èƒ½è§£å†³æ‰€æœ‰ race conditionï¼Œå› ä¸ºå®ƒè§£å†³çš„é—®é¢˜ä»…æ˜¯å˜é‡æ›´æ–°è¿‡ç¨‹ä¸­çš„ race conditionã€‚å› ä¸ºcheckå’Œactä¹‹é—´å­˜åœ¨æ—¶é—´å·®,æ‰€ä»¥è¿™ä¸ªæ—¶é—´å†…è¿˜æ˜¯å¯èƒ½è¢«æ‰“æ–­.\nMutex\nâ€‹æˆ‘ä»¬å°è¯•è®¾è®¡è½¯ä»¶å·¥å…·æ¥è§£å†³ CS problemã€‚æˆ‘ä»¬è®¨è®º Mutex (MUTual EXclusion) Lock çš„å®ç°ï¼Œå®ƒé€šå¸¸è¢«è®¤ä¸ºæ˜¯æœ€ç®€å•çš„ synchronization toolã€‚\nâ€‹æˆ‘ä»¬è€ƒè™‘è®©è¿›ç¨‹åœ¨ Entry Section ç”³è¯· acquire() ä¸€ä¸ªé”ï¼Œç„¶ååœ¨ Exit Section release() ä¸€ä¸ªé”ã€‚å¯¹äºè¿™ä¸ªé”ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ªå¸ƒå°”å˜é‡æ¥è¡¨ç¤ºå®ƒæ˜¯å¦ availableï¼š\nwhile (true) {\n    acquire();\n    /* critical section */\n    release();\n    /* remainder section */\n}\n \n/* ------- */\nvoid acquire() {\n    while (!available)\n        ; /* busy waiting */\n    avaliable = false;\n}\n \nvoid release() {\n    avaliable = true;\n}\næˆ‘ä»¬éœ€è¦ä¿è¯Â acquire()Â å’ŒÂ release()Â æ˜¯ atomic çš„ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Â test_and_set()Â å’ŒÂ compare_and_swap()Â æ¥å®ç°ï¼š\nvoid acquire() {\n    while (compare_and_swap(&amp;available, 1, 0) != 1)\n        ; /* busy waiting */\n}\n \nvoid release() {\n    available = true;\n}\n\nâ€‹æˆ‘ä»¬è¿˜å¯ä»¥è€ƒè™‘ä¸‹é¢çš„è®¾è®¡ï¼Œå…¶ä¸­ yield() ä¼šä½¿ç¨‹åºä» running è½¬ä¸º readyï¼Œä»è€Œè®©å‡º CPUï¼š\nvoid acquire() {\n    while (compare_and_swap(&amp;avaliable, 1, 0) != 1)\n        yield(); \n}\n \nvoid release() {\n    avaliable = true;\n}\nâ€‹ä¸è¿‡ï¼Œå¦‚æœæ‰€éœ€çš„ç­‰å¾…æ—¶é—´ä¸€èˆ¬å°äº context switch æ‰€éœ€çš„æ—¶é—´çš„è¯ï¼Œç”¨ spinlock å¯èƒ½æ˜¯æ›´å¥½çš„\nSemaphores\næˆ‘ä»¬ç»™å‡ºä¸€ç§æ›´å‰å®³çš„ synchronization toolï¼Œç§°ä¸º semaphoreä¿¡å·é‡ã€‚ä¸€ä¸ª semaphoreÂ SÂ æ˜¯ä¸€ä¸ªæ•´å‹å˜é‡ï¼Œå®ƒé™¤äº†åˆå§‹åŒ–å¤–åªèƒ½é€šè¿‡ä¸¤ä¸ª atomic æ“ä½œÂ wait()Â å’ŒÂ signal()Â ï¼ˆåŸç§°ä¸ºÂ P()Â å’ŒÂ V()Â ï¼‰æ¥è®¿é—®ï¼š\nvoid wait(S) {\n    while (S &lt;= 0)\n        ;   /* busy waiting */\n    S--;\n}\n \nvoid signal(S) {\n    S++;\n}\næœ‰ 2 ç§ semaphoreï¼š\n\nCounting semaphoreÂ - S çš„å€¼ä¸å—é™åˆ¶ï¼›\nBinary semaphoreÂ - S çš„å€¼åªèƒ½æ˜¯ 0 æˆ– 1ã€‚ç±»ä¼¼äºäº’æ–¥é”ã€‚\nä½†æ˜¯ï¼Œå¦‚åŒå‰é¢æˆ‘ä»¬æ‰€è¯´ï¼Œsemaphore ä¹Ÿå…·æœ‰ busy waiting çš„é—®é¢˜ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä¸º semaphore å¼•å…¥Â waiting queueï¼š\n\ntypedef struct {\n    int value;\n    struct list_head * waiting_queue;\n} semaphore; \n \nwait(semaphore *S) {\n    S-&gt;value--;\n    if (S-&gt;value &lt; 0) {\n        add this process to S-&gt;list;\n        block();\n    }\n}\nsignal(semaphore *S) {\n    S-&gt;value++;\n    if (S-&gt;value &lt;= 0) {\n        remove a process P from S-&gt;list;\n        wakeup(P);\n    }\n}\næ“ä½œÂ block()Â æŒ‚èµ·è°ƒç”¨å®ƒçš„è¿›ç¨‹ï¼Œæ“ä½œÂ wakeup(P)Â é‡æ–°å¯åŠ¨ P çš„æ‰§è¡Œï¼Œè¿™ä¸¤ä¸ªæ“ä½œéƒ½æ˜¯ç”±æ“ä½œç³»ç»Ÿä½œä¸ºåŸºæœ¬ç³»ç»Ÿè°ƒç”¨æä¾›çš„ã€‚é”™è¯¯åœ°ä½¿ç”¨ semaphore å¯èƒ½ä¼šå¯¼è‡´ deadlock\n\nPriority Inversion\n\nè¿™ä¸ªé—®é¢˜ç§°ä¸ºÂ priority inversionï¼Œå³å…·æœ‰ä¸­ç­‰ä¼˜å…ˆçº§çš„ M çš„è¿è¡Œæ—¶é—´åè€Œå½±å“äº†å…·æœ‰è¾ƒé«˜ä¼˜å…ˆçº§çš„ H çš„ç­‰å¾…æ—¶é—´ã€‚\nnce**Â æ¥è§£å†³è¿™ä¸€é—®é¢˜ï¼šæ‰€æœ‰æ­£åœ¨è®¿é—®èµ„æºï¼ˆå¦‚ä¸Šä¾‹ä¸­ï¼Œä½ä¼˜å…ˆçº§çš„ L æ‰€æŒçš„é”ï¼‰çš„è¿›ç¨‹è·å¾—éœ€è¦è®¿é—®è¿™ä¸ªèµ„æºçš„æ›´é«˜ä¼˜å…ˆçº§è¿›ç¨‹çš„ä¼˜å…ˆçº§ï¼Œç›´åˆ°å®ƒä»¬ç”¨å®Œæœ‰å…³èµ„æºä¸ºæ­¢ã€‚ï¼ˆå¦‚ä¸Šä¾‹ä¸­ï¼Œpriority inheritance å°†å…è®¸ L ä¸´æ—¶ç»§æ‰¿ H çš„ä¼˜å…ˆçº§ä»è€Œé˜²æ­¢è¢« M æŠ¢å ï¼›å½“ L é‡Šæ”¾é”ååˆ™å›åˆ°åŸæ¥çš„ä¼˜å…ˆçº§ï¼Œæ­¤æ—¶ H å°†åœ¨ M ä¹‹å‰æ‰§è¡Œã€‚ï¼‰"},"è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/03.2-ç»å…¸åŒæ­¥é—®é¢˜":{"slug":"è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/03.2-ç»å…¸åŒæ­¥é—®é¢˜","filePath":"è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/03.2 ç»å…¸åŒæ­¥é—®é¢˜.md","title":"03.2 ç»å…¸åŒæ­¥é—®é¢˜","links":[],"tags":[],"content":"ç»å…¸åŒæ­¥é—®é¢˜\nä¸€èˆ¬æˆ‘ä»¬ç”¨ä¿¡å·é‡è§£å†³é—®é¢˜ï¼Œå› ä¸ºä¿¡å·é‡ç›¸å¯¹æ¥è¯´åŠŸèƒ½æ›´å¤šï¼Œè€Œä¸”å¾ˆå¤šæ“ä½œç³»ç»Ÿå¯¹ä¿¡å·é‡åšäº†æ›´å¤šè®¾è®¡ï¼Œç”¨æ¥é¿å… busy waiting ç­‰é—®é¢˜ã€‚\nä¿¡å·é‡çš„é€»è¾‘\n\nä¸€ä¸ªä¿¡å·é‡ç”¨æ¥è¡¨ç¤ºÂ ä¸€ç±»ã€Œèµ„æºã€çš„ä½™é‡\nwait()Â ç­‰å¾…åˆ°å…¶æœ‰ä½™é‡æ—¶ä»ä¸­å–èµ°ä¸€ä¸ª\nsignal()Â é‡Šæ”¾ä¸€ä¸ªèµ„æº\nå› æ­¤ï¼Œåœ¨ç”¨ä¿¡å·é‡è§£å†³åŒæ­¥é—®é¢˜æ—¶ï¼Œæˆ‘ä»¬é€šå¸¸è€ƒè™‘å“ªäº›ä¸œè¥¿å±äºèµ„æºï¼Œå¯¹å®ƒä»¬çš„è®¿é—®æœ‰å“ªäº›ã€‚åŒæ—¶ï¼Œé€šè¿‡è€ƒè™‘åœ¨å“ªäº›åœ°æ–¹éœ€è¦ç­‰å¾…ï¼Œæˆ‘ä»¬ä¹Ÿèƒ½å¤Ÿå¾—åˆ°ä¸€äº›æç¤ºã€‚\n\nBounded-Buffer Problem\n\nç»™å®šä¸¤ä¸ªè¿›ç¨‹ï¼šproducer å’Œ consumerï¼Œå®ƒä»¬å…±ç”¨å¤§å°ä¸ºnçš„bufferã€‚Producer ç”Ÿäº§æ•°æ®æ”¾å…¥ bufferï¼Œconsumer ä» buffer å–å‡ºæ•°æ®ä»è€Œä½¿ç”¨ä¹‹ã€‚\nè¯¥é—®é¢˜éœ€è¦ä¿è¯ï¼šproducer ä¸åº”å½“åœ¨ buffer æ»¡æ—¶æ”¾å…¥æ•°æ®ï¼Œconsumer ä¹Ÿä¸åº”å½“åœ¨ buffer ç©ºæ—¶å–å‡ºæ•°æ®ã€‚\n\né¦–å…ˆï¼Œæ ¹æ®æˆ‘ä»¬åœ¨å‰ä¸€èŠ‚ä¸­çš„è®¨è®ºï¼Œproduce å’Œ consume çš„è¿‡ç¨‹ä¼šè®¿é—®åˆ°Â bufferÂ çš„èµ„æºï¼Œå› æ­¤æ˜¯ critical sectionï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¸€ä¸ªé”ï¼ˆæˆ–è€…ä¿¡å·é‡ï¼ŒååŒï¼‰æ¥æ§åˆ¶å¯¹Â bufferÂ çš„è®¿é—®ï¼š[è¿™é‡Œlockçš„å€¼åªèƒ½æ˜¯0/1]\n\n\n                  \n                  NOTE\n                  \n                \n\nå¦‚æœlock=1 é‚£ä¹ˆè¯´æ˜èƒ½æ‹¿ wait(lock)å°±ä¼šæŠŠlockå˜æˆ0\nå¦‚æœlock=0 é‚£ä¹ˆwait(lock)å°†ç­‰å¾…lockå˜æˆ1 signal(lock)ä¼šæŠŠlockå˜æˆ0å¹¶ä¸”å«é†’wait\n\n\nsemaphore lock = 1;\n \nproducer() {\n    while (true) {\n        // &lt;1&gt; If buffer is full, wait \n        wait(lock);\n        add_to_buffer(next_produced);\n        signal(lock);\n    }\n}\n \nconsumer() {\n    while (true) {\n        // &lt;2&gt; If buffer is empty, wait\n        wait(lock);\n        next_consumed = take_from_buffer();\n        signal(lock);\n    }\n}\nä¸è¿‡ï¼Œä¸Šé¢ä¸¤å¤„æ³¨é‡Šä¸­è¦æ±‚æ ¹æ®Â bufferÂ çš„å®¹é‡å†³å®šæ˜¯å¦éœ€è¦ç­‰å¾…çš„éœ€æ±‚è¿˜æ²¡æœ‰å®ç°ã€‚\næˆ‘ä»¬å¯ä»¥è€ƒè™‘ä½¿ç”¨ä¸€ä¸ªå˜é‡Â countÂ æ¥è®°å½•Â bufferÂ ä¸­æœ‰å¤šå°‘ä¸ªå…ƒç´ ï¼›å¦‚æœè¿™æ ·å®ç°çš„è¯ï¼Œå¯¹Â countÂ çš„ä¿®æ”¹ä¹Ÿæ˜¯ critical sectionï¼Œå› æ­¤ä¹Ÿéœ€è¦é”çš„æ§åˆ¶ï¼š\nsemaphore lock = 1;\nint count = 0;\n \nproducer() {\n    while (true) { \n        wait(lock);\n        while (count == BUFFER_SIZE) ;  // If buffer is full, wait \n        add_to_buffer(next_produced);\n        count++;\n        signal(lock);\n    }\n}\n \nconsumer() {\n    while (true) {\n        wait(lock);\n        while (count == 0) ;    // If buffer is empty, wait\n        next_consumed = take_from_buffer();\n        count--;\n        signal(lock);\n    }\n}\nè¿™ç§æ–¹å¼çš„å®ç°é—®é¢˜æ˜¯æ˜¾ç„¶çš„ï¼šæ¯”å¦‚å½“å‰Â bufferÂ ä¸ºç©ºï¼Œå³Â countÂ ä¸º 0ï¼ŒconsumerÂ ä¼šåœ¨ 16 è¡Œå¤„ç­‰å¾…ï¼›ä½†å› ä¸ºæ­¤æ—¶å®ƒæŒæœ‰ç€Â lockï¼Œä»»ä½• producer éƒ½ä¸èƒ½ produceï¼Œå› æ­¤è¿™ä¸ªç­‰å¾…ä¼šæ°¸ä¹…æŒç»­ä¸‹å»ã€‚è¿™è¿åäº†Â ProgressÂ å’ŒÂ Bounded waitingÂ çš„è¦æ±‚ã€‚\næˆ‘ä»¬å¯ä»¥ç¨ä½œä¿®æ”¹ï¼Œå½“Â countÂ çš„è¦æ±‚ä¸æ»¡è¶³æ—¶ï¼Œç«‹å³é‡Šæ”¾Â lockÂ å¹¶è¿›å…¥ä¸‹ä¸€æ¬¡å¾ªç¯ï¼Œå³ï¼š\nsemaphore lock = 1;\nint count = 0;\n \nproducer() {\n    while (true) { \n        wait(lock);\n        if (count == BUFFER_SIZE) {\n            // If buffer is full, give up\n            signal(lock);\n            continue;\n        } else {\n            add_to_buffer(next_produced);\n            count++;\n            signal(lock);\n        }\n    }\n}\n \nconsumer() {\n    while (true) {\n        wait(lock);\n        if (count == 0) {\n            // If buffer is empty, give up\n            signal(lock);\n            continue;\n        } else {\n            next_consumed = take_from_buffer();\n            count--;\n            signal(lock);\n        }\n    }\n}\nä¹Ÿå°±æ˜¯ï¼š\nsemaphore lock = 1;\nint count = 0;\n \nproducer() {\n    while (true) { \n        wait(lock);\n        if (count != BUFFER_SIZE) {\n            add_to_buffer(next_produced);\n            count++;\n        }\n        signal(lock);\n    }\n}\n \nconsumer() {\n    while (true) {\n        wait(lock);\n        if (count != 0) {\n            next_consumed = take_from_buffer();\n            count--;\n        }\n        signal(lock);\n    }\n}\nä½†æ˜¯ï¼Œè¿™ç§å®ç°æ–¹æ³•å¼ºåˆ¶äº† busy waiting[å°±æ˜¯cpuå¹¶æ²¡æœ‰ä¼‘æ¯,è€Œæ˜¯ä¸åœåœ°æ‰§è¡Œä¸€æ®µæ£€æŸ¥æ¡ä»¶çš„ä»£ç å¾ªç¯,ç›´åˆ°æ¡ä»¶æ»¡è¶³ä¸ºæ­¢,è¿™é‡Œè¯´çš„æ˜¯æ•´ä¸ªwhiletrueå¾ªç¯,åœ¨signalé‡Šæ”¾äº†ä¹‹å,é©¬ä¸Šä¼šä¸€ç›´é‡å¤åˆšæ‰çš„å¾ªç¯è¿‡ç¨‹]ã€‚æˆ‘ä»¬åœ¨å‰ä¸€èŠ‚è®¨è®ºè¿‡äº† busy waiting åŠå…¶åˆ©å¼Šï¼›åœ¨è¿™é‡Œ critical section çš„è¿è¡Œæ—¶é—´æ˜æ˜¾æ¯” context switch çš„æ—¶é—´è¦é•¿ï¼Œå› æ­¤è¿™é‡Œä½¿ç”¨ busy waiting æ˜¯æµªè´¹æ—¶é—´çš„ã€‚\nè€Œæˆ‘ä»¬ä¹‹å‰æåˆ°ï¼Œè®¸å¤šæ“ä½œç³»ç»Ÿå¯¹ä¿¡å·é‡åšäº†ä¸€äº›å¤„ç†ï¼Œä½¿å¾—å…¶ç­‰å¾…ä¸å†æ˜¯ busy waitingï¼Œè€Œæ˜¯ç±»ä¼¼äºç¬¬ 6 èŠ‚ä¸­è®²åˆ°çš„è§£å†³æ–¹æ¡ˆã€‚å› æ­¤ï¼Œæˆ‘ä»¬æ›´å€¾å‘äºä½¿ç”¨ä¿¡å·é‡æ¥è§£å†³é—®é¢˜ã€‚\né¦–å…ˆæˆ‘ä»¬å°è¯•ä½¿ç”¨ä¸€ä¸ªÂ lockÂ  å’Œä¸€ä¸ªÂ eslotÂ (empty slotï¼Œç©ºé—² buffer çš„ä¸ªæ•°) æ¥è§£å†³ï¼š\nsemaphore lock = 1;\nsemaphore eslot = BUFFER_SIZE;\n \nproducer() {\n    while (true) {\n        wait(eslot);    // if buffer is full, i.e. eslot == 0, wait//æ»¡äº†çš„è¯,eslotå°±ä¼šè¢«è®¾ç½®æˆ0 æ•´ä¸ªç¨‹åºå¡åœ¨è¿™ä¸ªwaitè¿™é‡Œ,ä¸ä¼šä¸€ç›´åšåˆ¤æ–­ä»€ä¹ˆçš„\n                        // else, eslot--\n        wait(lock);\n        add_to_buffer(next_produced);\n        signal(lock);\n    }\n}\n \nconsumer() {\n    while (true) {\n        // &lt;2&gt; If buffer is empty, i.e. eslot == BUFFER_SIZE, wait\n        wait(lock);\n        next_consumed = take_from_buffer();\n        signal(lock);\n        signal(eslot);  // eslot++\n    }\n}\nç”±äºÂ eslotÂ ä½œä¸ºä¸€ä¸ªä¿¡å·é‡ï¼Œæˆ‘ä»¬å¯¹å®ƒÂ ++Â å’ŒÂ --Â (å®é™…ä¸Šæ˜¯Â waitÂ å’ŒÂ signal) æ˜¯ atomic çš„ï¼Œä¸éœ€è¦è€ƒè™‘åŒæ­¥é—®é¢˜ã€‚\nä½†æ˜¯ï¼Œ16 è¡Œå¤„æˆ‘ä»¬å¸Œæœ›è®©Â eslot == BUFFER_SIZEÂ çš„æ—¶å€™å¾ªç¯ç­‰å¾…ï¼Œä¸è¿‡ä¿¡å·é‡æœ¬èº«å¹¶æ²¡æœ‰æä¾›è¿™ä¸ªåŠŸèƒ½ã€‚æ€ä¹ˆåŠå‘¢ï¼Ÿæˆ‘ä»¬éœ€è¦ä¸€ä¸ªé¢å¤–çš„ semaphoreÂ fslotÂ  (full slot) æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š\nsemaphore lock = 1;\nsemaphore eslot = BUFFER_SIZE;\nsemaphore fslot = 0;\n \nproducer() {\n    while (true) {\n        wait(eslot);    // if buffer is full, i.e. eslot == 0, wait\n                        // else, eslot--\n        wait(lock);\n        add_to_buffer(next_produced);\n        signal(lock);\n        signal(fslot);  // fslot++\n    }\n}\n \nconsumer() {\n    while (true) {\n        wait(fslot);    // if buffer is empty, i.e. fslot == 0, wait\n                        // else, fslot--\n        wait(lock);\n        next_consumed = take_from_buffer();\n        signal(lock);\n        signal(eslot);  // eslot++\n    }\n}\näº‹å®ä¸Šï¼Œå¦‚æˆ‘ä»¬ä¹‹å‰æ‰€è¯´ï¼Œåˆ†æä¸¤å¤„éœ€è¦ wait çš„æƒ…å†µï¼ˆå³ producer åœ¨ buffer æ»¡æ—¶ã€consumer åœ¨ buffer ç©ºæ—¶ï¼‰å°±å¯ä»¥å¾—åˆ°ä½¿ç”¨ä¿¡å·é‡çš„æç¤ºã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹äº producer æ¥è¯´ï¼Œã€Œç©ºæ ¼å­ã€æ˜¯å®ƒéœ€è¦çš„èµ„æºï¼›è€Œå¯¹äº consumer æ¥è¯´ï¼Œã€Œæœ‰ä¸œè¥¿çš„æ ¼å­ã€æ˜¯å®ƒéœ€è¦çš„èµ„æºã€‚æˆ‘ä»¬å¯ä»¥æ ¹æ®è¿™æ ·çš„æç¤ºæ¥è®¾è®¡ä¿¡å·é‡ã€‚\néœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯Â waitÂ ä¹‹é—´çš„é¡ºåºã€‚ä¾‹å¦‚å¦‚æœå°†Â wait(lock)Â å’ŒÂ wait(fslot)Â çš„é¡ºåºè°ƒè½¬è¿‡æ¥ï¼Œå°±ä¼šå‘ç”Ÿå’Œå‰é¢æåˆ°çš„æƒ…å†µä¸€æ ·çš„æ­»é”ã€‚\nReaders-Writers Problem\n\nå¯¹ä¸€ä¸ªæ•°æ®ï¼Œreaders è¯»ï¼Œwriters è¯»å’Œå†™ã€‚\nè®¾è®¡æ–¹æ¡ˆä¿è¯ï¼šå¤šä¸ª readers å¯ä»¥åŒæ—¶è¯»å–ï¼Œä½†æ˜¯ writer è¿›è¡Œè¯»å†™æ—¶ä¸èƒ½æœ‰å…¶ä»– writers å’Œ readersã€‚\n\nwriter() {\n    while (true) {\n        // if there is any reader or any other writer, wait\n        read_and_write();\n    }\n}\n \nreader() {\n    while (true) {\n        // if there is any writer, wait\n        read();\n    }\n}\næˆ‘ä»¬åˆ†ç±»è®¨è®ºä¸åŒçš„æƒ…å½¢ä¸‹ï¼Œreader å’Œ writer åœ¨ entry section ä¸­æœŸæœ›çš„åšæ³•ï¼š\nå¯¹äº readerï¼š\n\næœ‰ writerï¼šç­‰å¾…\næœ‰å…¶ä»– readerï¼šä»€ä¹ˆéƒ½ä¸åšï¼Œç›´æ¥è¿›å…¥ CS\néƒ½æ²¡æœ‰ï¼šç¦æ­¢ writerï¼Œç„¶åè¿›å…¥ CS\nè¿™æ ·çš„åšæ³•å¯ä»¥ä¿è¯ä¸ä¼šåŒæ—¶æœ‰ writer å’Œ reader åœ¨ critical sectionã€‚\nå¯¹äº writerï¼›\næœ‰å…¶ä»– reader / writerï¼šç­‰å¾…\néƒ½æ²¡æœ‰ï¼šç¦æ­¢ reader å’Œå…¶ä»– writerï¼Œç„¶åè¿›å…¥ CS\n\nåœ¨ exit section çš„æ“ä½œä¸ä¹‹å¯¹ç§°ã€‚\nè¿™ä¸¤å¤„ã€Œç¦æ­¢ã€å¯èƒ½å¯¹åº”ç€ä¸¤å¤„ä¿¡å·é‡ï¼Œæˆ‘ä»¬åˆ†åˆ«ç»™å®ƒä»¬èµ·åä¸ºÂ RÂ å’ŒÂ Wï¼Œåˆå€¼å‡ä¸º 1ï¼›é‚£ä¹ˆ reader çš„ entry section å°±å½¢å¦‚ï¼š\nwait for W but not take;    // if there is a writer, wait\nif (no other readers)       // if no other readers, take R\n    wait(R);                // else, do nothing\n//è¿™é‡Œæ˜¯è¯´,å½“æˆ‘æ˜¯ç¬¬ä¸€ä¸ªè¯»è€…çš„æ—¶å€™æˆ‘æ‰è´Ÿè´£é”é—¨,æŒ¡ä½å†™è€….å¦‚æœè¿™é‡Œä¸å†™ifé€»è¾‘ ç›´æ¥wait(R)çš„è¯,å› ä¸ºè¿™ä¸ªwait(R)å¤§å®¶éƒ½è¦ç»è¿‡,é‚£ç¬¬äºŒä¸ªè¯»è€…å°±æ²¡åŠæ³•åˆ°ä¸‹ä¸€è¡Œäº†.\nwriter çš„ entry section å½¢å¦‚ï¼š\nwait for R but not take;    // if there are some readers, wait\nwait(W);                    // if there is another writer, wait; else take W\nè¿™é‡Œæœ‰ä¸¤ä¸ªé—®é¢˜æ²¡æœ‰è§£å†³ï¼Œç¬¬ä¸€ä¸ªæ˜¯ã€Œwait but not takeã€è¿™æ ·çš„æ“ä½œæ˜¯ä¸å­˜åœ¨çš„ï¼Œç¬¬äºŒä¸ªæ˜¯å¦‚ä½•åˆ¤å®šã€Œno other readersã€æˆ‘ä»¬åˆ†åˆ«è®¨è®ºè¿™ä¸¤ä¸ªé—®é¢˜ã€‚\nwait but not take\né¦–å…ˆï¼Œwait but not take è‚¯å®šè¿˜æ˜¯è¦ä½¿ç”¨Â wait()Â æ¥è§£å†³çš„ï¼Œå› ä¸ºæˆ‘ä»¬æ²¡æœ‰é™¤æ­¤ä¹‹å¤–çš„ç”¨æ¥ç­‰å¾…çš„ä¿¡å·é‡æ“ä½œã€‚æˆ‘ä»¬åˆ†åˆ«è€ƒè™‘ä¸¤å¤„ wait but not take å¦‚æœç›´æ¥ç”¨Â wait()Â å®ç°ä¼šå¸¦æ¥ä»€ä¹ˆé—®é¢˜ã€‚\nå¯¹äº readerï¼Œå¦‚æœæˆ‘ä»¬ç›´æ¥æ”¹ä¸ºÂ wait(W)ï¼Œä¼šå‡ºç°çš„é—®é¢˜æ˜¯ï¼šè¿™æ ·åªæœ‰ç¬¬ä¸€ä¸ª reader èƒ½å¤Ÿè¿›å…¥ CS äº†ï¼Œåç»­çš„éƒ½ä¼šè¢«é˜»å¡ã€‚ä¸è¿‡æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œè¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œåªè¦æŠŠÂ wait(W)Â ä¹Ÿæ”¾åˆ°Â ifÂ é‡Œé¢å»å°±å¥½äº†ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœæœ‰å…¶ä»– reader åœ¨çš„æƒ…å†µä¸‹ï¼Œä¸€å®šä¸å­˜åœ¨ writerï¼ŒWÂ ä¹Ÿä¸€å®šè¢«æŸä¸ªï¼ˆç¬¬ä¸€ä¸ªï¼‰reader æŒæœ‰ï¼Œå°±ä¸éœ€è¦å† wait äº†ã€‚å³ï¼š\nif (no other readers) {\n    wait(W);\n    wait(R);      \n}\nå®¹æ˜“æ£€æŸ¥ï¼Œè¿™æ ·çš„è®¾è®¡ç¬¦åˆæˆ‘ä»¬ä¹‹å‰åˆ†ç±»è®¨è®ºçš„è¦æ±‚ã€‚\nå¯¹äº writerï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æ”¹ä¸ºÂ wait(R)ï¼Œå› ä¸ºé‡Šæ”¾Â WÂ ä¹‹å‰ä¸€å®šä¸ä¼šæœ‰ reader èƒ½å¤Ÿè¿›å…¥ CSï¼Œè€Œé‡Šæ”¾Â WÂ æ—¶å¯ä»¥ä¸€å¹¶é‡Šæ”¾Â Rã€‚å³ï¼š\nwait(R);      \nwait(W);\nè¿™é‡Œæœ¬æ¥åº”è¯¥æ£€æŸ¥ä¸€ä¸‹æ­»é”ï¼Œå› ä¸ºä»ç¬¬ 8 èŠ‚å¯ä»¥çœ‹åˆ°ï¼Œè¿™ç§è®¾è®¡æœ‰å¾ªç¯ç­‰å¾…çš„æƒ…å†µï¼Œå› æ­¤æœ‰æ­»é”çš„é£é™©ï¼›ä½†æ˜¯æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œå…¶å®Â RÂ å’ŒÂ WÂ æ€»æ˜¯ä¼šåŒæ—¶è¢«è·å–ï¼ˆå¯¹ç§°åœ°ï¼Œä¹ŸåŒæ—¶è¢«é‡Šæ”¾ï¼‰[è·å–çš„å°±æ˜¯ç¬¬ä¸€ä¸ªè¯»è€…,å’Œå”¯ä¸€çš„å†™è€…]å› æ­¤å…¶å®æˆ‘ä»¬å¯ä»¥åˆå¹¶ä¸ºä¸€ä¸ªä¿¡å·é‡ï¼Œä¸å¦¨å«åšÂ write_lockã€‚å…¶è®¾è®¡ä¸ºï¼š\nsemaphore write_lock = 1;\n \nwriter() {\n    while (true) {\n        wait(write_lock);\n        read_and_write();\n        signal(write_lock);\n    }\n}\n \nreader() {\n    while (true) {\n        if (no other readers)\n            wait(write_lock);\n        read();\n        if (no other readers)\n            signal(write_lock);\n    }\n}\nno other readers\nè¿™ä¸ªé—®é¢˜æ¯”è¾ƒå¥½è§£å†³ï¼Œæˆ‘ä»¬å¼•å…¥ä¸€ä¸ªæ•´å‹Â reader_countÂ ç”¨æ¥ä¿å­˜æœ‰å¤šå°‘ä¸ª readersï¼Œå½“å…¶å€¼å˜ä¸º 0 æ—¶ï¼Œä»£è¡¨æ²¡æœ‰å…¶ä»– readers åœ¨è¯»äº†ã€‚æˆ‘ä»¬åŒæ—¶å¢åŠ ä¿è¯å…¶åŒæ­¥çš„ä¿¡å·é‡ã€‚å³ï¼š\nsemaphore write_lock = 1;\nint reader_count = 0;//this one\nsemaphore reader_count_lock = 1;\n \nwriter() {\n    while (true) {\n        wait(write_lock);\n        read_and_write();\n        signal(write_lock);\n    }\n}\n \nreader() {\n    while (true) {\n        wait(reader_count_lock);\n        reader_count++;\n        if (reader_count == 1)     // first reader take write_lock\n            wait(write_lock);\n        signal(reader_count_lock);\n \n        read();\n \n        wait(reader_count_lock);\n        reader_count--;\n        if (reader_count == 0)      // release write_lock when ...\n            signal(write_lock);     // ... no other readers reading\n        signal(reader_count_lock);\n    }\n}\nå¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ç§å®ç°çš„ç»“æœæ˜¯ï¼šå½“å­˜åœ¨è¯»è¿›ç¨‹æ—¶ï¼Œå†™è¿›ç¨‹å°†è¢«å»¶è¿Ÿã€‚è¿™å¯èƒ½å¯¼è‡´å†™è¿›ç¨‹å‘ç”ŸÂ starvationã€‚\nå¦‚æœå¸Œæœ›å†™è¿›ç¨‹ä¼˜å…ˆï¼Œæˆ‘ä»¬å¯ä»¥è§„å®šï¼Œå¦‚æœå†™è¿›ç¨‹ readyï¼Œé‚£ä¹ˆå…¶ä»–è¯»è¿›ç¨‹åº”å½“ç­‰å¾…ï¼Œç›´åˆ°å†™è¿›ç¨‹ç»“æŸï¼›å³ä½¿å¾—å†™è¿›ç¨‹å°½å¯èƒ½æ—©åœ°å¼€å§‹ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡æ–°å¢ä¸€ä¸ªä¿¡å·é‡å®ç°ï¼š\nsemaphore write_lock = 1;\nint reader_count = 0;\nsemaphore reader_count_lock = 1;\nsemaphore writer_first = 1;//this\n \nwriter() {\n    while (true) {\n        wait(writer_first);\n        wait(write_lock);\n        read_and_write();\n        signal(write_lock);\n        signal(writer_first);\n    }\n}\n \nreader() {\n    while (true) {\n        wait(writer_first);\n        wait(reader_count_lock);\n        reader_count++;\n        if (reader_count == 1)\n            wait(write_lock);\n        signal(reader_count_lock);\n        signal(writer_first);\n \n        read();\n \n        wait(reader_count_lock);\n        reader_count--;\n        if (reader_count == 0)\n            signal(write_lock);\n        signal(reader_count_lock);\n    }\n}\nDining-Philosophers Problem\n5 ä¸ªå“²å­¦å®¶ä¸€èµ·åƒé¥­ï¼æ¯ä¸¤ä¸ªå“²å­¦å®¶ä¹‹é—´æœ‰ä¸€æ ¹ç­·å­ï¼Œæ¯ä¸ªäººä¸€æ¬¡å¯ä»¥æ‹¿èµ·æ¥ä¸€æ ¹ç­·å­ï¼Œæ‹¿åˆ°ä¸¤æ ¹ç­·å­çš„å°±å¯ä»¥åƒä¸€æ®µæ—¶é—´ã€‚åƒå®Œæ€è€ƒä¸€æ®µæ—¶é—´ã€‚\n\nä¸€ä¸ªæœ´ç´ çš„è§£æ³•æ˜¯è¿™æ ·çš„ï¼š\nvector&lt;semaphore&gt; chopstick(5, 1);  // initialize semaphores to all 1\n \nphilosopher(int index) {\n    while (true) {\n        wait(chopstick[i]);\n        wait(chopstick[(i + 1) % 5]);\n        eat();\n        signal(chopstick[i]);\n        signal(chopstick[(i + 1) % 5]);\n        think();\n    }\n}\né—®é¢˜æ˜¯ï¼Œå¯èƒ½æŸæ—¶åˆ»æ¯ä¸ªäººåŒæ—¶æ‹¿èµ·å·¦è¾¹çš„ç­·å­ï¼Œè¿™æ ·ä¼šå¯¼è‡´æ­»é”ã€‚\nè§£å†³æ–¹æ¡ˆä¹‹ä¸€æ˜¯ï¼Œåªå…è®¸åŒæ—¶æ‹¿èµ·ä¸¤æ ¹ç­·å­ï¼›è¿™ç§æ–¹æ¡ˆçš„å®ç°æ˜¯ï¼Œè½®æµè¯¢é—®æ¯ä¸ªäººæ˜¯å¦èƒ½å¤Ÿæ‹¿èµ·ä¸¤æ ¹ç­·å­ï¼Œå¦‚æœèƒ½åˆ™æ‹¿èµ·ï¼Œå¦‚æœä¸èƒ½åˆ™éœ€è¦ç­‰å¾…é‚£äº›ç­·å­æ”¾ä¸‹ï¼š\nè®©â€œæ‹¿èµ·ä¸¤æ ¹ç­·å­â€è¿™ä¸ªåŠ¨ä½œå˜æˆäº†åŸå­æ“ä½œ (Atomic)ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªå“²å­¦å®¶è¦ä¹ˆä¸€å£æ°”æŠŠä¸¤æ ¹ç­·å­éƒ½æ‹¿èµ·æ¥ï¼Œè¦ä¹ˆè¿æ‹¿ç¬¬ä¸€æ ¹ç­·å­çš„èµ„æ ¼éƒ½æ²¡æœ‰ã€‚\nvector&lt;semaphore&gt; chopstick(5, 1);  // initialize semaphores to all 1\nsemaphore lock = 1;\n \nphilosopher(int index) {\n    while (true) {\n        wait(lock);\n        wait(chopstick[i]);\n        wait(chopstick[(i + 1) % 5]);\n        signal(lock);\n \n        eat();\n \n        signal(chopstick[i]);\n        signal(chopstick[(i + 1) % 5]);\n        think();\n    }\n}\nå¦ä¸€ç§è§£å†³æ–¹æ¡ˆæ˜¯ï¼Œå¥‡æ•°å·äººå…ˆæ‹¿å·¦è¾¹ç­·å­ï¼Œå¶æ•°å·äººå…ˆæ‹¿å³è¾¹ç­·å­ï¼Œè¿™æ ·ä¹Ÿèƒ½é¿å…æ­»é”ã€‚\nLinux Sync\n2.6 ä»¥å‰çš„ç‰ˆæœ¬çš„ kernel ä¸­é€šè¿‡ç¦ç”¨ä¸­æ–­æ¥å®ç°ä¸€äº›çŸ­çš„ critical sectionï¼›2.6 åŠä¹‹åçš„ç‰ˆæœ¬çš„ kernel æ˜¯æŠ¢å å¼çš„ã€‚\nLinux æä¾›ï¼š\n\nAtomic integers\nSpinlocks\nSemaphores\nReader-writer locks\n\nPOSIX Sync"},"è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/03.3-æ­»é”":{"slug":"è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/03.3-æ­»é”","filePath":"è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/03.3 æ­»é”.md","title":"03.3 æ­»é”","links":[],"tags":[],"content":"æ­»é”çš„å®šä¹‰å’Œä¾‹å­\næ­»é” (Deadlock)Â æ˜¯æŒ‡ï¼Œå¤šä¸ªè¿›ç¨‹å› ç«äº‰èµ„æºå¯¼è‡´çš„ä¸€ç§åƒµå±€ï¼Œå³è‹¥å¹²è¿›ç¨‹å„è‡ªæŒæœ‰ä¸€äº›èµ„æºï¼ŒåŒæ—¶ç­‰å¾…è·å–å¦ä¸€ä¸ªè¿›ç¨‹æŒæœ‰çš„èµ„æºï¼Œå½¢æˆçš„äº’ç›¸ç­‰å¾…çš„å±€é¢ã€‚\nä¸€ä¸ªä¾‹å­æ˜¯ï¼Œä¸€ä¸ªç³»ç»Ÿé‡Œæœ‰ä¸¤ä¸ªè¿›ç¨‹ï¼Œåˆ†åˆ«å®Œæˆä»ä¸€ä¸ªç£ç›˜é©±åŠ¨å™¨æ‹·è´å†…å®¹åˆ°å¦ä¸€ä¸ªç£ç›˜é©±åŠ¨å™¨çš„æ“ä½œï¼Œå³å„è‡ªéœ€è¦ä¸¤ä¸ªç£ç›˜é©±åŠ¨å™¨ã€‚ç³»ç»Ÿé‡Œä¸¤ä¸ªç£ç›˜é©±åŠ¨å™¨ã€‚å½“å‰ï¼Œp1æŒæœ‰Aå¹¶å¸Œæœ›è·å–Bï¼ŒåŒæ—¶p2æŒæœ‰Bå¹¶å¸Œæœ›è·å–Aï¼Œè¿™ä¸¤ä¸ªè¿›ç¨‹å°±ä¼šç›¸äº’ç­‰å¾…ï¼Œé™·å…¥æ­»é”ã€‚\nsemaphore first_mutex = 1;\nsemaphore second_mutex = 1;\n \nthread_one() {\n    wait(first_mutex);\n    wait(second_mutex);\n    // ......\n}\n \nthread_two() {\n    wait(second_mutex);\n    wait(first_mutex);\n    // ......\n}\n\n\n                  \n                  Bridge Crossing Example \n                  \n                \n\n\nä¸Šå›¾æ‰€ç¤ºçš„æƒ…å½¢ä¹Ÿå±•ç¤ºäº†ä¸€ç§æ­»é”ã€‚\nå¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœæ¡¥ä¸Šçš„ä»»ä¸€è¾†è½¦æ„¿æ„å€’è½¦å›å»ï¼Œå°±èƒ½å¤Ÿè§£å†³æ­»é”ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ†é…ä¼˜å…ˆçº§çš„æ–¹å¼è¦æ±‚å“ªè¾†è½¦å€’è½¦ã€‚\nä¼˜å…ˆçº§å¯èƒ½å¯¼è‡´ starvationã€‚\n\n\nç³»ç»Ÿèµ„æºåˆ†é…å›¾\n\n\næœ¬èŠ‚ç¬¬ä¸€ä¸ªä¾‹å­çš„æƒ…å†µï¼Œå¯ä»¥ç”¨å¦‚ä¸‹çš„èµ„æºåˆ†é…å›¾åˆ»ç”»ï¼š\n\nå½“è¿›ç¨‹ç”³è¯·ä¸€ä¸ªèµ„æºæ—¶ï¼Œåº”å½“æ·»åŠ ä¸€æ¡ç”³è¯·è¾¹ï¼›å½“è¯¥ç”³è¯·å¯ä»¥å¾—åˆ°æ»¡è¶³æ—¶ï¼Œè¿™æ¡ç”³è¯·è¾¹åº”å½“Â ç«‹å³Â è½¬æ¢ä¸ºåˆ†é…è¾¹ï¼›å½“è¿›ç¨‹ä¸å†éœ€è¦æŸä¸ªèµ„æºæ—¶ï¼Œå°±åˆ é™¤å¯¹åº”åˆ†é…è¾¹ã€‚\næ ¹æ®èµ„æºåˆ†é…å›¾çš„å®šä¹‰æˆ‘ä»¬å¯ä»¥çŸ¥é“\n\nå¦‚æœèµ„æºåˆ†é…å›¾å½“å‰æ²¡æœ‰ç¯ï¼Œé‚£ä¹ˆç³»ç»Ÿå½“å‰Â ä¸€å®šÂ æ²¡æœ‰æ­»é”\nå¦‚æœåˆ†é…å›¾æœ‰ç¯ï¼Œé‚£ä¹ˆç³»ç»Ÿå½“å‰Â å¯èƒ½Â å­˜åœ¨æ­»é”ã€‚\nä½†æ˜¯ï¼Œå¦‚æœåˆ†é…å›¾æœ‰ç¯ï¼Œä¸”æ¯ä¸ªèµ„æºç±»å‹åªæœ‰ 1 ä¸ªå®ä¾‹ï¼Œé‚£ä¹ˆÂ å¿…å®šÂ å­˜åœ¨æ­»é”ã€‚\n\n\nåˆ†é…å›¾æœ‰ç¯ä¸ä¸€å®šå­˜åœ¨æ­»é”\n[\n\næ­»é”çš„å¿…è¦æ¡ä»¶\näº‹å®ä¸Šï¼Œå½“ä¸‹é¢å››ä¸ªæ¡ä»¶Â åŒæ—¶Â æˆç«‹æ—¶ï¼Œç³»ç»Ÿæ‰ä¼šå‡ºç°é”ï¼š\n\nMutual exclusionÂ : è‡³å°‘ä¸€ä¸ªèµ„æºå¤„äºéå…±äº«æ¨¡å¼ï¼›\nHold and waitÂ : ä¸€ä¸ªè¿›ç¨‹åº”Â å æœ‰Â è‡³å°‘ä¸€ä¸ªèµ„æºï¼Œå¹¶Â ç­‰å¾…Â å¦ä¸€ä¸ªä¸ºå…¶ä»–è¿›ç¨‹å æœ‰çš„èµ„æºï¼›\nNo preemptionÂ : èµ„æºä¸èƒ½è¢«æŠ¢å ï¼Œåªèƒ½åœ¨è¿›ç¨‹ç»“æŸåä¸»åŠ¨é‡Šæ”¾ï¼›\nCircular waitÂ : æˆ‘ç­‰ä½ çš„ç­·å­ï¼Œä½ ç­‰ä»–çš„ï¼Œä»–ç­‰æˆ‘çš„â€¦â€¦å½¢æˆä¸€ä¸ªåœˆ[æœ€å…³é”®]\nè¿™å››ä¸ªæ¡ä»¶å¹¶ä¸å®Œå…¨ç‹¬ç«‹ã€‚\n\nä¸‹å›¾ä¸­æè¿°äº†ä¸€ä¸ªæ­»é”çŠ¶æ€ï¼š\næˆ‘ä»¬éªŒè¯å®ƒç¬¦åˆä¸Šè¿°å››ä¸ªæ¡ä»¶ï¼š\n\nmutual exclusiveï¼šæ¯ä¸ªè·¯å£ï¼ˆèµ„æºï¼‰ 1 ~ 4 åŒæ—¶åªèƒ½æœ‰ä¸€è¾†è½¦ç­‰å¾…æˆ–é€šè¡Œ\nhold and waitï¼šä½äº 1, 2, 3, 4 è·¯å£çš„è½¦åˆ†åˆ«æŒæœ‰å½“å‰è·¯å£ï¼Œå¹¶ä¸”ç­‰å¾… 2, 3, 4, 1è·¯å£çš„è½¦ç»è¿‡\nno preemptionï¼šæ˜¾ç„¶ï¼Œä»»ä½•ä¸€ä¸ªè·¯å£è¾¹ç­‰å¾…çš„è½¦ä¸èƒ½å…ˆäºå½“å‰åœ¨è·¯å£ç­‰å¾…çš„è½¦ç»è¿‡è·¯å£\ncircular waitï¼šä½äº 1, 2, 3, 4 è·¯å£çš„è½¦åˆ†åˆ«ç­‰å¾… 2, 3, 4, 1è·¯å£çš„è½¦ç»è¿‡\n\næ­»é”çš„å¤„ç†ç­–ç•¥\nå¦‚ä½•å¤„ç†æ­»é”å‘¢ï¼Ÿæœ‰å››ç§æ–¹æ³•ï¼š\n\nä¿è¯ç³»ç»Ÿä¸ä¼šè¿›å…¥æ­»é”çŠ¶æ€\n\næ­»é”é¢„é˜² (deadlock prevention)\næ­»é”é¿å… (deadlock avoidance)\n\n\nåœ¨ç³»ç»Ÿè¿›å…¥æ­»é”çŠ¶æ€åæ¢å¤\n\næ­»é”æ£€æµ‹å’Œæ¢å¤ (deadlock detection and recovery)ï¼šä¾‹å¦‚æ•°æ®åº“\n\n\nå‡è£…ç³»ç»Ÿä¸ä¼šå‘ç”Ÿæ­»é”ï¼ŒçœŸçš„å‘ç”Ÿäº†å°±å¯„(é‡å¯)\n\näº‹å®ä¸Šï¼Œå¤§å¤šæ•°æ“ä½œç³»ç»Ÿï¼ˆåŒ…æ‹¬ Linux å’Œ Windowsï¼‰é€‰æ‹©çš„æ˜¯æœ€åä¸€ç§æ–¹æ¡ˆã€‚å› æ­¤ï¼Œç¨‹åºå‘˜éœ€è¦è‡ªå·±ç¼–å†™ç¨‹åºæ¥å¤„ç†æ­»é”ã€‚ä½†æ˜¯å‰é¢ä¸‰ç§è¿˜æ˜¯è¦å­¦â€¦\næ­»é”é¢„é˜²\næ­»é”é¢„é˜²çš„æ ¸å¿ƒæ€è·¯æ˜¯ï¼Œç¡®ä¿è‡³å°‘ä¸€ä¸ªå¿…è¦æ¡ä»¶æ°¸ä¸æˆç«‹ï¼Œæ¥ä¿è¯ç³»ç»Ÿä¸ä¼šå‡ºç°æ­»é”ã€‚æˆ‘ä»¬åˆ†åˆ«è®¨è®ºå››ä¸ªæ¡ä»¶å¦‚ä½•ç ´åã€‚\nMutual Exclusion\nå¦‚æœä¿è¯ç³»ç»Ÿèµ„æºéƒ½èƒ½å…±äº«ï¼Œåˆ™è¯¥æ¡ä»¶ç”¨ä¸æˆç«‹ã€‚\nä½†æ˜¯è¿™åªæ˜¯ä¸ªç¾å¥½çš„æ„¿æœ›ï¼Œå› ä¸ºæœ‰å¾ˆå¤šèµ„æºå¤©ç”Ÿå°±ä¸èƒ½å…±äº«ï¼Œæ¯”å¦‚ä¿¡å·é‡ã€‚\nHold and Wait\nä¿è¯æ¯ä¸ªè¿›ç¨‹åœ¨ç”³è¯·èµ„æºæ—¶ä¸èƒ½å æœ‰å…¶ä»–èµ„æºã€‚\nå®ç°æ–¹å¼:\n\nåœ¨å¼€å§‹æ‰§è¡Œå‰ç”³è¯·å¹¶è·å¾—æ‰€æœ‰èµ„æºã€‚\næˆ–è€…ï¼Œåªå…è®¸è¿›ç¨‹åœ¨æ²¡æœ‰èµ„æºæ—¶æ‰èƒ½ç”³è¯·èµ„æºã€‚\nè¿™ç§æ–¹å¼çš„é—®é¢˜æ˜¯ï¼Œèµ„æºåˆ©ç”¨ç‡è¾ƒä½ï¼Œè€Œä¸”éœ€è¦èµ„æºè¾ƒå¤šçš„è¿›ç¨‹å¯èƒ½å‘ç”Ÿstarvationã€‚\n\nNo Preemption\n\nNo Preemptionï¼ˆä¸å¯æŠ¢å ï¼‰ï¼šèµ„æºä¸€æ—¦ç»™äº†ä½ ï¼Œé™¤éä½ è‡ªæ„¿ç”¨å®Œï¼Œå¦åˆ™è°ä¹Ÿä¸èƒ½è®©ä½ åå‡ºæ¥ã€‚\n\nå½“ä¸€ä¸ªè¿›ç¨‹è¯·æ±‚ä¸€ä¸ªèµ„æºä½†æ˜¯æ²¡æœ‰ç«‹åˆ»å¾—åˆ°æ»¡è¶³æ—¶ï¼Œå®ƒå¿…é¡»é‡Šæ”¾å·²ç»æŒæœ‰çš„æ‰€æœ‰èµ„æº. ç›´åˆ°å®ƒéœ€æ±‚çš„æ‰€æœ‰èµ„æºï¼ˆåŒ…æ‹¬åˆšæ‰é‡Šæ”¾çš„é‚£äº›èµ„æºï¼‰éƒ½å¯ç”¨æ—¶æ‰èƒ½ä¸€å¹¶è·å–å®ƒä»¬å¹¶ç»§ç»­æ‰§è¡Œã€‚\nä½†æ˜¯ä¿¡å·é‡ä¹‹ç±»çš„èµ„æºä¹Ÿä¸èƒ½è¿™æ ·ç”¨[ä¸»åŠ¨é‡Šæ”¾ä¹Ÿå°±ç›¸å½“äºè¢«æŠ¢å ,ä½†æ˜¯ä¿¡å·é‡ä¹‹é—´çš„csæ˜¯åŸå­çš„ä¸å¯è¢«ä¸­æ–­]ï¼›åŒæ—¶ä¹Ÿä¼šé™ä½èµ„æºåˆ©ç”¨ç‡ã€‚\nCircular Wait\nå¯¹æ‰€æœ‰èµ„æºç±»å‹è¿›è¡Œæ’åºï¼Œè¦æ±‚æ¯ä¸ªè¿›ç¨‹æŒ‰ç…§é€’å¢é¡ºåºç”³è¯·èµ„æºã€‚\nç¨‹åºå‘˜éœ€è¦ä¿è¯æŒ‰ç…§è¿™ä¸ªé¡ºåºç”³è¯·èµ„æºï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœç¨‹åºå‘˜ä¸å¬è¯ï¼Œè¿˜æ˜¯ä¼šå‘ç”Ÿæ­»é”ã€‚è¿™ç§æ–¹æ³•ä¹Ÿå¯èƒ½å½±å“èµ„æºåˆ©ç”¨ç‡ã€‚\næ­»é”é¿å…\né¿å…æ­»é”éœ€è¦ä¸€äº›é¢å¤–ä¿¡æ¯ï¼Œä¾‹å¦‚è¿›ç¨‹æœªæ¥éœ€è¦ä½¿ç”¨å“ªäº›èµ„æºã€èµ„æºçš„ä½¿ç”¨é¡ºåºç­‰ã€‚åœ¨æ¯æ¬¡è¯·æ±‚åˆ°æ¥æ—¶ï¼Œå³ä½¿å¯¹åº”èµ„æºå¯ç”¨ï¼Œç³»ç»Ÿä¹Ÿåº”è¯¥ç»“åˆç°æœ‰å¯ç”¨èµ„æºã€ç°æœ‰å·²åˆ†é…èµ„æºä»¥åŠå„ä¸ªè¿›ç¨‹æœªæ¥ç”³è¯·å’Œé‡Šæ”¾çš„èµ„æºï¼Œè€ƒè™‘æ˜¯å¦è®©è¿™ä¸ªè¯·æ±‚ç­‰å¾…ä»è€Œé¿å…æœªæ¥å¯èƒ½çš„æ­»é”ã€‚\nä¸åŒæ¨¡å‹å¯èƒ½å¯¹ä¸Šè¿°é¢å¤–ä¿¡æ¯æœ‰ä¸åŒçš„éœ€æ±‚ã€‚æœ€ç®€å•ä¸”æœ€æœ‰ç”¨çš„æ¨¡å‹ç»´æŠ¤è¿™æ ·çš„Â èµ„æºåˆ†é…çŠ¶æ€ (resource allocation state):\n\næ¯ä¸ªè¿›ç¨‹å£°æ˜å¯èƒ½å¯¹æ¯ç§èµ„æºç±»å‹çš„Â æœ€å¤§éœ€æ±‚ (maximum demands)\nå½“å‰ç³»ç»Ÿçš„ available å’Œ allocated çš„èµ„æºæ•°ç›®ã€‚\n\nèµ„æºåˆ†é…å›¾ç®—æ³•\nè¿™ç§ç®—æ³•é€‚ç”¨äºæ¯ç§èµ„æºç±»å‹åªæœ‰ 1 ä¸ªå®ä¾‹çš„æƒ…å†µã€‚\næˆ‘ä»¬åœ¨èµ„æºåˆ†é…å›¾çš„åŸºç¡€ä¸Šå¢åŠ ä¸€ç§è¾¹ï¼Œå« claim edgeï¼Œè¡¨ç¤ºæŸä¸ªè¿›ç¨‹æœªæ¥Â å¯èƒ½Â ä¼šéœ€æ±‚æŸç§èµ„æºï¼Œç”¨è™šçº¿è¡¨ç¤ºã€‚\n\n\n\nå½“è¿™ä¸ªéœ€æ±‚çœŸçš„å‡ºç°çš„æ—¶å€™ï¼Œclaim edge è½¬ä¸º request edgeï¼› è™šçº¿å˜éœ€æ±‚çº¿\nå½“éœ€æ±‚è¢«æ»¡è¶³çš„æ—¶å€™ï¼Œrequest edge è½¬ä¸º assignment edgeï¼›éœ€æ±‚çº¿å˜åˆ†é…çº¿\nå½“è¯¥è¿›ç¨‹é‡Šæ”¾è¯¥èµ„æºæ—¶ï¼Œassignment edge è½¬ä¸º claim edgeã€‚åˆ†é…çº¿å˜å›è™šçº¿\nå½“ä¸€ä¸ªéœ€æ±‚æ¥äº†çš„æ—¶å€™ï¼Œå¦‚æœ request edge è½¬ä¸º assignment edge ä¸ä¼šå¯¼è‡´å›¾ä¸­æœ‰ä¸€ä¸ª cycleï¼Œåˆ™è¯¥è¦æ±‚å¯ä»¥è¢«æ»¡è¶³ï¼›å¦åˆ™è¯¥è¯·æ±‚åº”å½“ç­‰å¾…ã€‚\n\nå®‰å…¨çŠ¶æ€ | Safe State\nå¦‚æœç³»ç»Ÿèƒ½å¤ŸæŒ‰ç…§ä¸€å®šé¡ºåºä¸ºæ¯ä¸ªè¿›ç¨‹åˆ†é…èµ„æºï¼ŒåŒæ—¶é¿å…æ­»é”ï¼Œé‚£ä¹ˆç³»ç»Ÿå°±å¤„åœ¨Â å®‰å…¨çŠ¶æ€ (safe state)ã€‚\n\né“¶è¡Œå‰©ä¸‹çš„é’±+å‰é¢æ‰€æœ‰äººå®Œæˆä¹‹åè¿˜ç»™é“¶è¡Œçš„é’±,æ˜¯å¦èƒ½æ»¡è¶³è‡ªå·±çš„éœ€æ±‚\nå®‰å…¨çŠ¶æ€ä¿è¯ä¸å‘ç”Ÿæ­»é”ã€‚\n\nExample\n\nÂ 102æ˜¯ä¸€ä¸ª safe sequenceã€‚å› æ­¤ç³»ç»Ÿå¤„åœ¨å®‰å…¨çŠ¶æ€ã€‚\nÂ å°±æ˜¯ä¸€å¼€å§‹ åªèƒ½æ»¡è¶³p1çš„need ç„¶åp1è¿è¡Œå®Œäº†ä¹‹å,è¿˜äº†4,3-2+4=5 ç„¶åç»™0è·‘.ç±»ä¼¼çš„..\næ ¹æ®è¿™ä¸€æ¦‚å¿µï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·å®šä¹‰æ­»é”é¿å…çš„ç®—æ³•ï¼šèµ·åˆï¼Œç³»ç»Ÿå¤„äºå®‰å…¨çŠ¶æ€ã€‚å½“æœ‰è¿›ç¨‹ç”³è¯·ä¸€ä¸ªå¯ç”¨èµ„æºæ—¶ï¼Œç³»ç»Ÿåº”ç¡®å®šï¼Œå¦‚æœç«‹åˆ»è¿›è¡Œè¿™ä¸€åˆ†é…åç³»ç»Ÿä»å¤„äºå®‰å…¨çŠ¶æ€åˆ™å¯ä»¥åˆ†é…ï¼Œå¦åˆ™åº”å½“è®©è¿›ç¨‹ç­‰å¾…ã€‚\né“¶è¡Œå®¶ç®—æ³• | Bankerâ€™s Algorithm\næˆ‘ä»¬é€šè¿‡ available, max, allocation, need è¿™å››ä¸ªçŸ©é˜µåˆ»ç”»ä¸€ä¸ªæ—¶é—´å†…å„ä¸ªè¿›ç¨‹å¯¹å„ç§èµ„æºçš„æŒæœ‰å’Œéœ€æ±‚æƒ…å†µï¼Œä»¥åŠå½“å‰ç³»ç»Ÿçš„èµ„æºæƒ…å†µï¼›æ“ä½œç³»ç»Ÿæ ¹æ®è¿™äº›æ•°æ®ä¿æŒç³»ç»Ÿå¤„äºå®‰å…¨çŠ¶æ€ï¼Œä»è€Œå†³å®šä¸€ä¸ªéœ€æ±‚æ˜¯å¦åº”å½“è¢«ç«‹å³æ»¡è¶³ã€‚\nå‚è€ƒä¸‹é¢çš„ä¾‹å­ä¸­é—®é¢˜ 1 ç†è§£ï¼Œæ‰¾ä¸€ä¸ªå®‰å…¨åºåˆ—çš„åŸºæœ¬æ€è·¯å°±æ˜¯ï¼šé€‰å–ä¸€ä¸ª needï¼ˆçš„æ¯ä¸€é¡¹éƒ½å¯¹åº”åœ°ï¼‰å°äº availableï¼ˆçš„å¯¹åº”é¡¹ï¼‰çš„è¿›ç¨‹ï¼Œå…¶è¿è¡Œå®Œåä¼šå°† allocation é‡Šæ”¾å› availableï¼Œä»¥æ­¤ç±»æ¨ã€‚\nè€Œå†³å®šä¸€ä¸ªéœ€æ±‚æ˜¯å¦åº”å½“è¢«ç«‹å³æ»¡è¶³çš„æ–¹æ¡ˆæ˜¯ï¼Œå‡è®¾Â è¿™ä¸ªéœ€æ±‚è¢«æ¥å—äº†ï¼Œæ ¹æ®è¯¥éœ€æ±‚æ›´æ–°å¯¹åº”çš„ need, available, allocationï¼Œåœ¨æ­¤çŠ¶æ€ä¸‹æ¨æ¼”æ˜¯å¦æœ‰åˆæ³•çš„å®‰å…¨åºåˆ—ã€‚å¦‚æœæœ‰ï¼Œåˆ™å¯ä»¥ç«‹å³æ»¡è¶³ï¼Œå¦åˆ™åº”ç­‰å¾…ã€‚å‚è€ƒä¸‹é¢ä¾‹å­ä¸­çš„é—®é¢˜ 2~4ã€‚\nQuestion\nConsider the following snapshot of a system:\n\nTè¡¨ç¤ºä¸åŒçš„è¿›ç¨‹,ABCDè¡¨ç¤ºä¸åŒç±»å‹çš„èµ„æº\nå…ˆç”¨max-allocation,å¯ä»¥å¾—åˆ°need\nç„¶åå°±å…ˆçœ‹å½“å‰çš„avaliableèƒ½æ»¡è¶³å“ªä¸ªneed,ç„¶åç¬¬ä¸€ä¸ªè¿›ç¨‹è¿è¡Œå®Œä¹‹å,æ–° Available = åŸAvailable + T2 Allocation = (2,2,2,4) + (2,4,1,3) = (4, 6, 3, 7)ã€‚å†è¿›è¡Œæ–°ä¸€è½®å¯»æ‰¾!æœ€ç»ˆå°±å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªå®‰å…¨åºåˆ—,ä¸€èˆ¬æ¥è¯´ç­”æ¡ˆä¸å”¯ä¸€.åªè¦å­˜åœ¨å®‰å…¨åºåˆ—,å°±è¯´æ˜å¤„äºå®‰å…¨çŠ¶æ€\nAnswer the following questions using the bankerâ€™s algorithm:\n\nIllustrate that the system is in a safe state by demonstrating an order in which the threads may complete.\nIf a request from thread T4 arrives for (2, 2, 2, 4), can the request be granted immediately?\nå°äºç­‰äºneed,å°äºç­‰äºavaliable.é€šè¿‡èµ„æ ¼æ£€æŸ¥.\nä½†æ˜¯å¦‚æœå‡è®¾è¿›è¡Œåˆ†é…ä¹‹å,t4å¹¶æ²¡æœ‰æ»¡è¶³èƒ½è¿è¡Œçš„æ¡ä»¶(æ²¡è·‘å®Œ,å½“ç„¶ä¹Ÿå°±ä¸èƒ½é‡Šæ”¾),è€Œä¸”å‰©ä½™çš„ä¹Ÿä¸è¶³ä»¥æ”¯æŒåˆ«çš„è¿›ç¨‹è¿è¡Œ,æ‰€ä»¥æ˜¯ä¸å®‰å…¨çš„\nå®é™…ä¸Šå°±æ˜¯ æŒ‰ç…§é¢˜æ„è¿›è¡Œåˆ†é…,ç„¶åç”¨æ–°çš„çŸ©é˜µå†åšä¸€æ¬¡æ‰¾å®‰å…¨åºåˆ—çš„åŠ¨ä½œ.\nIf a request from thread T2 ar7rives for (0, 1, 1, 0), can the request be granted immediately?\nIf a request from thread T3 arrives for (2, 2, 1, 2), can the request be granted immediately?\n\nç­”æ¡ˆ\n\nå¦‚å›¾ï¼š  \næˆ‘ä»¬å¯ä»¥å…ˆè®© T2 è¿è¡Œï¼ˆä¹Ÿå¯ä»¥æ˜¯ T3ï¼‰ï¼Œæ­¤åå˜æˆï¼š\n[\nç°åœ¨å¯ä»¥è®©é™¤äº† T4 ä»¥å¤–çš„æ¯ä¸ª thread è¿è¡Œï¼Œåç»­ç±»ä¼¼ã€‚å› æ­¤ä¸€ä¸ªå®‰å…¨åºåˆ—æ˜¯ T2â†’T0â†’T1â†’T3â†’T4ã€‚å› æ­¤å½“å‰ç³»ç»Ÿæ˜¯å®‰å…¨çš„ã€‚\nå¦‚æœæ»¡è¶³è¿™ä¸€è¦æ±‚ï¼Œä¹‹åçš„çŠ¶æ€ä¸ºï¼š\n\nå¯è§ï¼Œæ­¤æ—¶ä»»ä¸€çº¿ç¨‹éƒ½æ— æ³•æ‰§è¡Œã€‚å› æ­¤æ­¤è¦æ±‚ä¸èƒ½ç«‹å³æ»¡è¶³ã€‚\nå¦‚æœæ»¡è¶³è¿™ä¸€è¦æ±‚ï¼Œä¹‹åçš„çŠ¶æ€ä¸ºï¼š  \nè¿™ä¸å½±å“æˆ‘ä»¬å¦‚ 1) é‚£æ ·å®Œæˆå…¨éƒ¨çº¿ç¨‹çš„è¿è¡Œï¼Œå³ç³»ç»Ÿæ˜¯å®‰å…¨çš„ã€‚å› æ­¤æ­¤è¦æ±‚å¯ä»¥ç«‹å³æ»¡è¶³ã€‚\nå¦‚æœæ»¡è¶³è¿™ä¸€è¦æ±‚ï¼Œä¹‹åçš„çŠ¶æ€ä¸ºï¼š  \næˆ‘ä»¬å¯ä»¥æŒ‰ T3â†’T2â†’T4â†’T1â†’T0 ç­‰é¡ºåºå®Œæˆå…¨éƒ¨çº¿ç¨‹çš„è¿è¡Œï¼Œå³ç³»ç»Ÿæ˜¯å®‰å…¨çš„ã€‚å› æ­¤æ­¤è¦æ±‚å¯ä»¥ç«‹å³æ»¡è¶³ã€‚\n\næ­»é”æ£€æµ‹\nSingle Instance Resources\nå¯ä»¥é€šè¿‡èµ„æºåˆ†é…å›¾çš„å˜ä½“Â wait-for graphÂ æ¥è§£å†³ï¼š\n\nåœ¨è¿™ä¸ªå›¾é‡Œæ‰¾ç¯ï¼Œç”¨æ‹“æ‰‘æ’åºçš„è¯æ—¶é—´å¤æ‚åº¦æ˜¯Â Â çš„ï¼Œè¿™æœ€å·®æƒ…å†µä¸‹æ˜¯Â Â çš„ã€‚\nMulti-Instance Resources\nç±»ä¼¼é“¶è¡Œå®¶ç®—æ³•ã€‚å¦‚æœæ‰¾ä¸åˆ°ä»»ä½•å®‰å…¨åºåˆ—ï¼Œåˆ™è¯´æ˜ç³»ç»Ÿå¤„äºæ­»é”çŠ¶æ€ã€‚\næ­»é”æ¢å¤\næ­»é”æ¢å¤æœ‰ä¸¤ä¸ªé€‰æ‹©ï¼š\nè¿›ç¨‹ç»ˆæ­¢ Treminate deadlocked processes\nç»ˆæ­¢è¿›ç¨‹å¹¶ä¸ç®€å•ï¼Œå®ƒéœ€è¦ç»´æŠ¤ç»ˆæ­¢æ—¶çš„çŠ¶æ€ï¼Œå¹¶ä¸”æœ‰å¯èƒ½éœ€è¦é‡æ–°è®¡ç®—ä¸€äº›å†…å®¹ï¼ŒåŒæ—¶è¿˜éœ€è¦é¿å…äº§ç”Ÿé‡å¤çš„å‰¯ä½œç”¨ï¼ˆå¦‚è¾“å‡ºï¼‰ï¼›è¿™éœ€è¦èŠ±è´¹å¾ˆå¤šæ—¶é—´ã€‚\nOptions:\n\næ”¾å¼ƒæ‰€æœ‰æ­»é”è¿›ç¨‹ã€‚è¿™æ ·çš„èŠ±è´¹ä¼šå¾ˆå¤§ï¼\næ¯æ¬¡æ”¾å¼ƒä¸€ä¸ªè¿›ç¨‹ï¼Œç›´åˆ°æ­»é”ç¯è§£é™¤ã€‚è¿™æ ·çš„èŠ±è´¹ä¹Ÿå¾ˆå¤§ï¼Œå› ä¸ºæ¯æ¬¡æ”¾å¼ƒä¸€ä¸ªè¿›ç¨‹ä¹‹åéƒ½éœ€è¦è°ƒç”¨æ­»é”æ£€æµ‹ç®—æ³•ã€‚\n\nåŒæ—¶åè€…éœ€è¦è€ƒè™‘çš„æ˜¯ï¼Œå¦‚ä½•é€‰æ‹©æ”¾å¼ƒçš„è¿›ç¨‹ï¼Ÿåº”å½“æ ¹æ®å…·ä½“æƒ…å†µï¼Œå‚è€ƒå¦‚ä¸‹æŒ‡æ ‡é€‰æ‹©é€ æˆçš„ä»£ä»·æœ€å°çš„è¿›ç¨‹æ¥ç»ˆæ­¢ï¼š\n\nè¿›ç¨‹çš„ä¼˜å…ˆçº§\nå·²ç»ç®—äº†å¤šä¹…ï¼Œè¿˜è¦ç®—å¤šä¹…\nç”¨äº†å“ªäº›ã€å¤šå°‘èµ„æºï¼Œæ˜¯å¦å®¹æ˜“æŠ¢å \nè¿˜éœ€è¦å¤šå°‘èµ„æº\nç»ˆæ­¢è¿™ä¸€è¿›ç¨‹çš„è¯è¿˜éœ€è¦ç»ˆæ­¢å¤šå°‘è¿›ç¨‹\nè¿›ç¨‹æ˜¯äº¤äº’çš„è¿˜æ˜¯æ‰¹å¤„ç†çš„\n\nèµ„æºæŠ¢å  Resource preemption\nä¸æ–­æŠ¢å èµ„æºç»™å…¶ä»–è¿›ç¨‹ç”¨ï¼Œç›´åˆ°æ¶ˆé™¤æ­»é”ç¯ä¸ºæ­¢ã€‚\néœ€è¦è€ƒè™‘ä¸‰ä¸ªé—®é¢˜ï¼š\n\né€‰æ‹©ç‰ºç‰²è¿›ç¨‹ (Select a victim)ã€‚æŠ¢å å“ªäº›è¿›ç¨‹çš„å“ªäº›èµ„æºï¼Ÿè¿™å’Œå‰ä¸€èŠ‚çš„è®¨è®ºå·®ä¸å¤šã€‚\nå›æ»š (Rollback)ã€‚å½“ä¸€ä¸ªè¿›ç¨‹çš„è‹¥å¹²èµ„æºè¢«æŠ¢å ï¼Œæˆ‘ä»¬éœ€è¦å°†è¿™ä¸ªè¿›ç¨‹Â å›æ»šÂ åˆ°æŸä¸ªå®‰å…¨çŠ¶æ€ï¼Œå³å›æ»šåˆ°ç”³è¯·é‚£äº›è¢«æŠ¢å çš„èµ„æºä¹‹å‰ã€‚\nä¸è¿‡ä¸€èˆ¬æ¥è¯´ï¼Œå¾ˆéš¾ç¡®å®šä»€ä¹ˆæ˜¯å®‰å…¨çŠ¶æ€ï¼Œæœ€ç®€å•çš„æ–¹æ¡ˆå°±æ˜¯å®Œå…¨å›æ»šï¼Œä¹Ÿå°±æ˜¯ç»ˆæ­¢è¿›ç¨‹å¹¶é‡æ–°æ‰§è¡Œã€‚å›æ»šåˆ°è¶³å¤Ÿæ‰“æ–­æ­»é”çš„çŠ¶æ€æ›´åŠ ç»æµï¼Œä½†æ˜¯éœ€è¦ç³»ç»Ÿä¿å­˜æ›´å¤šèµ„æºã€‚\né¥¥é¥¿ (Starvation)ã€‚å¦‚ä½•ä¿è¯ä¸ä¼šæ°¸è¿œä»ä¸€ä¸ªè¿›ç¨‹ä¸­æŠ¢å èµ„æºï¼Ÿåœ¨ä»£ä»·è¯„ä»·ä¸­å¢åŠ å›æ»šæ¬¡æ•°ï¼Œä¹Ÿç±»ä¼¼äº priority agingã€‚\n"},"è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/04.1-ä¸»å­˜":{"slug":"è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/04.1-ä¸»å­˜","filePath":"è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/04.1 ä¸»å­˜.md","title":"04.1 ä¸»å­˜","links":["tags/flashcard"],"tags":["flashcard"],"content":"DECK: CS::OS\n\nå†…å­˜æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„å­—èŠ‚æ•°ç»„ï¼ŒCPU æ ¹æ® PC (Program Counter) çš„å€¼ä»å†…å­˜ä¸­æå–æŒ‡ä»¤ã€‚ç¨‹åºéœ€è¦è¿è¡Œï¼Œè‡³å°‘éƒ¨åˆ†ç¨‹åºåŠå…¶è®¿é—®çš„æ•°æ®åº”åœ¨å†…å­˜ä¸­ï¼ˆæˆ–è€…æ›´æ˜ç¡®åœ°ï¼Œå†…å­˜ä¸­çš„ä¸€ä¸ªè¿›ç¨‹é‡Œï¼‰\nCPU å¯ä»¥ç›´æ¥è®¿é—®çš„é€šç”¨å­˜å‚¨åªæœ‰ main memory å’Œ registersã€‚å¯¹ registers çš„è®¿é—®é€šå¸¸å¯ä»¥åœ¨ä¸€ä¸ª CPU æ—¶é’Ÿå‘¨æœŸä¸­å®Œæˆï¼Œè€Œå®Œæˆå†…å­˜çš„è®¿é—®å¯èƒ½éœ€è¦å¤šä¸ªæ—¶é’Ÿå‘¨æœŸã€‚åœ¨è¿™äº›æ—¶é’Ÿå‘¨æœŸé‡Œï¼Œç”±äºæ²¡æœ‰ç”¨æ¥å®ŒæˆæŒ‡ä»¤çš„æ•°æ®ï¼Œè¿™ä¼šå¼•èµ·Â stallï¼‰ã€‚\n\nä¸ºäº†è¡¥æ•‘ï¼Œåœ¨ CPU èŠ¯ç‰‡ä¸Šå¢è®¾æ›´å¿«çš„å†…å­˜ï¼Œç§°ä¸ºÂ cacheÂ ã€‚\n\n\nåŒæ—¶ï¼Œéœ€è¦ä¿æŠ¤å†…å­˜ç©ºé—´ï¼Œé˜²æ­¢ç”¨æˆ·ç¨‹åºä¿®æ”¹æ“ä½œç³»ç»Ÿæˆ–å…¶ä»–ç”¨æˆ·ç¨‹åºçš„ä»£ç æˆ–è€…æ•°æ®ã€‚\n\nAddress Binding flashcard\n\n.c-&gt;.oçš„è¿‡ç¨‹\n\nç¼–è¯‘å™¨complierå°†æºä»£ç ä¸­çš„åœ°å€ç»‘å®šåˆ°Relocatable Address\n\næºä»£ç ä¸­çš„åœ°å€é€šå¸¸æ˜¯ç”¨ç¬¦å·è¡¨ç¤ºï¼ˆsymbolicï¼‰ï¼š ä¾‹å¦‚å„ç§å˜é‡ã€å‡½æ•°åï¼›æ±‡ç¼–ä¸­çš„ label ç­‰\nRelocatable Addressï¼šå¯é‡å®šä½åœ°å€ã€‚ç›¸å¯¹äºæŸä¸€ä¸ªæ®µ/æ¨¡å—ç­‰çš„åç§»ï¼Œä¾‹å¦‚Â sp - 8,Â ds:[0]ã€‚å³æŠŠæºä»£ç ç¬¦å·åœ°å€èƒŒåçš„å…·ä½“å†…å®¹é‡æ’åˆ°æºç¨‹åºçš„ç›¸å¯¹ä½ç½®\n\n\n\n\n.p-&gt;.exeï¼ˆandå…¶ä»–å¯æ‰§è¡Œæ–‡ä»¶å½¢å¼ï¼‰çš„è¿‡ç¨‹\n\né“¾æ¥å™¨linker æ”¶é›†æ‰€æœ‰.oæ–‡ä»¶ï¼Œå°†æ¯ä¸ªä»£ç æ–‡ä»¶çš„åœ°å€ç»‘å®šæˆç›¸å¯¹æ•´ä¸ªç¨‹åºçš„åœ°å€\n\n\nåŠ è½½å™¨loader å°†å¯æ‰§è¡Œæ–‡ä»¶ç»‘å®šåˆ°å†…å­˜åœ°å€ä¸­ï¼Œå¾—åˆ°æœ€ç»ˆçš„ç»å¯¹åœ°å€Absolute Address\n\nå½“ç„¶ï¼Œå¦‚æœç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶å°±çŸ¥é“ç¨‹åºæ‰€å¤„çš„å†…å­˜åœ°å€ï¼Œåˆ™ä¼šç”ŸæˆÂ absolute code-ã€‹program in memory\n\n\n\n\n\nè¿ç»­å†…å­˜åˆ†é…\n\nåœ¨ Batchï¼ˆæ‰¹å¤„ç†ï¼‰ç³»ç»Ÿä¸­ï¼Œæ¯æ¬¡åªæœ‰ä¸€ä¸ªç¨‹åºè¢«åŠ è½½å…¥ç‰©ç†å†…å­˜ï¼Œå¹¶è¢«è¿è¡Œè‡³ç»“æŸã€‚\n\nå¦‚æœç¨‹åºæ‰€éœ€çš„å­˜å‚¨ç©ºé—´æ¯”ç‰©ç†å†…å­˜å¤§ï¼Œåˆ™å°†ç¨‹åºåˆ†å¼€ä¸ºå¯ä»¥è¿è¡Œè‡³äº§ç”ŸæŸä¸ªç»“æœä¸”å¤§å°å¯ä»¥æ”¾å…¥ç©ºä½™å†…å­˜çš„éƒ¨åˆ†ï¼Œé€ä¸ªè¿è¡Œï¼Œå°†è¿è¡Œç»“æœä¼ é€’ç»™ä¸‹ä¸€ä¸ªéƒ¨åˆ†ã€‚\n\n\nç°åœ¨æˆ‘ä»¬éœ€è¦æŠŠå¤šä¸ªè¿›ç¨‹åŒæ—¶æ”¾åœ¨å†…å­˜ä¸­ï¼Œå¹¶ä¸”æ”¯æŒå…¶å½¼æ­¤ä¹‹é—´çš„å¿«é€Ÿåˆ‡æ¢ã€‚æœ€ç®€å•çš„å†…å­˜åˆ†é…æ–¹æ³•ä¹‹ä¸€ï¼Œå°±æ˜¯å°†å†…å­˜åˆ†æˆè®¸å¤šçš„ partitionï¼Œæ¯ä¸ª partition åŒ…å«ä¸€ä¸ªè¿›ç¨‹ã€‚å…¶è¦æ±‚æœ‰ï¼š\n\nProtection:Â ä¿è¯è¿›ç¨‹ä¹‹é—´ä¸ä¼šäº’ç›¸é—¯å…¥å¯¹æ–¹çš„å­˜å‚¨ã€‚\nFast execution:Â ä¸èƒ½ç”±äº protection é™ä½è®¿é—®å†…å­˜çš„æ•ˆç‡ã€‚\nFast context switch:Â æ¯å½“è¿›è¡Œ context switch æ—¶ï¼Œå¯ä»¥æ¯”è¾ƒå¿«åœ°æ‰¾åˆ°å¹¶è®¿é—®å½“å‰è¿›ç¨‹çš„å†…å­˜ã€‚\n\n\nå½“è¿›ç¨‹è¿›å…¥ç³»ç»Ÿï¼Œæ“ä½œç³»ç»Ÿæ ¹æ®å„ä¸ªè¿›ç¨‹çš„å†…å­˜éœ€è¦ä»¥åŠå½“å‰çš„ç©ºé—²å†…å­˜ç©ºé—´æ¥å†³å®šä¸ºå“ªäº›è¿›ç¨‹åˆ†é…å†…å­˜ã€‚å½“ä¸€ä¸ªè¿›ç¨‹è¢«åˆ†é…åˆ°äº†ç©ºé—´ï¼Œä»–å°†è¢«è½½å…¥åˆ°å†…å­˜ä¸­ï¼Œå¹¶ä¸å…¶ä»–è¿›ç¨‹ç«äº‰ CPU æ—¶é—´ã€‚å½“ä¸€ä¸ªè¿›ç¨‹ç»“æŸæ—¶ï¼Œå®ƒé‡Šæ”¾å®ƒçš„ç©ºé—´ã€‚\nå¦‚æœä¸€ä¸ªè¿›ç¨‹è¯·æ±‚ç©ºé—´æ¥è¿è¡Œï¼Œä½†æ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜æ¥æ»¡è¶³å…¶è¦æ±‚\n\nç›´æ¥æ‹’ç»å…¶è¯·æ±‚å¹¶ç»™å‡ºä¸€ä¸ªé”™è¯¯ä¿¡æ¯\næˆ–å°†å…¶åŠ å…¥ waiting queue ä¸­ï¼Œå½“æœ‰å†…å­˜è¢«é‡Šæ”¾æ—¶ CPU æ¥æ£€æŸ¥æ˜¯å¦ä¸ºå…¶åˆ†é…å†…å­˜ã€‚\n\n\n\nå†…å­˜åˆ†åŒºç­–ç•¥partion flashcard\nFixed Partition å›ºå®šå¤§å°partition\n\nå›ºå®š partition çš„å¤§å°ï¼ˆé™¤äº† OS ä½¿ç”¨çš„å†…å­˜ï¼‰ï¼Œåªéœ€è¦è®°å½•æ¯ä¸ªpartitionæ˜¯å¦è¢«å ç”¨å³å¯ã€‚\nInternal Fragmentationï¼šä¸€ä¸ªpartitionä¸­å‰©ä½™çš„ç©ºé—´ä¸èƒ½å¤Ÿè¢«åˆ«çš„è¿›ç¨‹æ‰€ä½¿ç”¨ã€‚ã€ ä¸å¯ç”¨å†…å­˜åˆ†å¸ƒåœ¨ partition ä¹‹å†…ã€‘\n\nVariable Partition\n\nä¸å›ºå®š partition çš„å¤§å°ï¼Œç»´æŠ¤ä¸€ä¸ªè¡¨ï¼Œè®°å½•å¯ç”¨å’Œå·²ç”¨çš„å†…å­˜ã€‚\næœ€å¼€å§‹æ—¶æ˜¯ä¸€å¤§å—å¯ç”¨å†…å­˜å—ï¼ˆå¯ç”¨å†…å­˜å—ç§°ä¸ºholeï¼‰ï¼Œç»è¿‡ä¸€æ®µæ—¶é—´è¿è¡Œåå¯èƒ½å°±ä¼šåŒ…å«ä¸€ç³»åˆ—ä¸åŒå¤§å°çš„å­”\nExternal Fragmentationï¼š ä¸€æ®µæ—¶é—´è¿è¡Œåï¼Œå†…å­˜ç©ºé—´è¢«åˆ†ä¸ºå¤§é‡çš„holeï¼ŒåŠ èµ·æ¥å¯ä»¥æ»¡è¶³è¦æ±‚ä½†æ˜¯å¹¶ä¸è¿ç»­ï¼Œæ‰€ä»¥æ— æ³•è¢«åˆ©ç”¨ã€‚ã€ ä¸å¯ç”¨å†…å­˜åˆ†å¸ƒåœ¨ partition ä¹‹å¤–ã€‘\n\n\nåŠ¨æ€å­˜å‚¨åˆ†é…é—®é¢˜ Dynamic Storage-Allocation Problem flashcard\næ ¹æ®ä¸€ç»„ hole æ¥åˆ†é…å¤§å°ä¸º n çš„è¯·æ±‚ï¼Œçš„é—®é¢˜\nè§£å†³æ–¹æ³•æœ‰ï¼š\n\nfirst-fitÂ åˆ†é…é¦–ä¸ªè¶³å¤Ÿå¤§çš„ holeã€‚è¿™ç§æ–¹æ³•ä¼šä½¿å¾—åˆ†é…é›†ä¸­åœ¨ä½åœ°å€åŒºï¼Œå¹¶åœ¨æ­¤å¤„äº§ç”Ÿå¤§é‡çš„ç¢ç‰‡ï¼Œåœ¨æ¯æ¬¡å°è¯•åˆ†é…çš„æ—¶å€™éƒ½ä¼šéå†åˆ°ï¼Œå¢å¤§æŸ¥æ‰¾çš„å¼€é”€ã€‚\nbest-fitÂ åˆ†é…æœ€å°çš„è¶³å¤Ÿå¤§çš„ holeã€‚é™¤éç©ºé—²åˆ—è¡¨æŒ‰å¤§å°æ’åºï¼Œå¦åˆ™è¿™ç§æ–¹æ³•éœ€è¦å¯¹æ•´ä¸ªåˆ—è¡¨è¿›è¡Œéå†ã€‚è¿™ç§æ–¹æ³•åŒæ ·ä¼šç•™ä¸‹è®¸å¤šç¢ç‰‡ã€‚\nworst-fitÂ åˆ†é…æœ€å¤§çš„ holeã€‚åŒæ ·ï¼Œé™¤éåˆ—è¡¨æœ‰åºï¼Œå¦åˆ™æˆ‘ä»¬éœ€è¦éå†æ•´ä¸ªåˆ—è¡¨ã€‚è¿™ç§æ–¹æ³•çš„å¥½å¤„æ˜¯æ¯æ¬¡åˆ†é…åé€šå¸¸ä¸ä¼šä½¿å‰©ä¸‹çš„ç©ºé—²å—å¤ªå°ï¼Œè¿™åœ¨ä¸­å°è¿›ç¨‹è¾ƒå¤šçš„æƒ…å†µä¸‹æ€§èƒ½è¾ƒå¥½ï¼Œå¹¶ä¸”äº§ç”Ÿç¢ç‰‡çš„å‡ ç‡æ›´å°ã€‚\n\n\nå†…å­˜ä¿æŠ¤æœºåˆ¶Protection flashcard\nä¿è¯ä¸€ä¸ªè¿›ç¨‹èƒ½ä¸”ä»…èƒ½è®¿é—®è‡ªå·±ç©ºé—´ä¸­çš„åœ°å€ã€‚é€šè¿‡ä¸€å¥—Â baseÂ å’ŒÂ limitÂ å¯„å­˜å™¨æ¥ç¡®å®šä¸€ä¸ªç¨‹åºçš„ç©ºé—´ï¼š\n\n\næ¯å½“ context switch åˆ°ä¸€ä¸ªæ–°çš„è¿›ç¨‹æ—¶ï¼ŒCPU ä¼š load è¿™ä¸¤ä¸ªå¯„å­˜å™¨çš„å€¼\næ¯å½“ user mode æƒ³è¦è¿›è¡Œä¸€æ¬¡å†…å­˜è®¿é—®æ—¶ï¼ŒCPU éƒ½è¦æ£€æŸ¥å…¶æ˜¯å¦è¯•å›¾è®¿é—®éæ³•åœ°å€ï¼›å¦‚æœæ˜¯ï¼Œåˆ™ä¼šå¼•å‘ä¸€ä¸ª trap å¹¶è¢«å½“åšè‡´å‘½é”™è¯¯å¤„ç†ï¼ˆé€šå¸¸ä¼š terminate æ‰è¿›ç¨‹ ï¼‰ï¼š\n\n\nåˆ†æ®µSegmentation\nBasic Method\nè™½ç„¶æˆ‘ä»¬ç¨‹åºä¸­çš„ä¸»å‡½æ•°ã€æ•°ç»„ã€ç¬¦å·è¡¨ã€å­å‡½æ•°ç­‰ç­‰å†…éƒ¨éœ€è¦æœ‰ä¸€å®šçš„é¡ºåºï¼Œä½†æ˜¯è¿™äº›æ¨¡å—ä¹‹é—´çš„å…ˆåé¡ºåºæ˜¯æ— å…³ç´§è¦çš„ã€‚\n\n\nä¸€ä¸ªç¨‹åºæ˜¯ç”±ä¸€ç»„Â segmentÂ ï¼ˆæ®µï¼‰æ„æˆçš„ï¼Œæ¯ä¸ª segment éƒ½æœ‰å…¶åç§°å’Œé•¿åº¦ã€‚æˆ‘ä»¬åªè¦çŸ¥é“ segment åœ¨ç‰©ç†å†…å­˜ä¸­çš„åŸºåœ°å€ (base) å’Œæ®µå†…åç§»åœ°å€ (offset) å°±å¯ä»¥å¯¹åº”åˆ°ç‰©ç†åœ°å€ä¸­äº†ã€‚\nå¯¹äºæ¯ä¸€ä¸ª segmentï¼Œæˆ‘ä»¬ç»™å…¶ä¸€ä¸ªç¼–å·ã€‚å³ï¼Œæˆ‘ä»¬é€šè¿‡äºŒå…ƒæœ‰åºç»„Â è¡¨ç¤ºäº†ä¸€ä¸ªåœ°å€ã€‚è¿™ç§è¡¨ç¤ºç§°ä¸ºÂ logical addressï¼ˆé€»è¾‘åœ°å€ï¼‰æˆ–Â virtual addressï¼ˆè™šæ‹Ÿåœ°å€ï¼‰ã€‚\né€šå¸¸ï¼Œåœ¨ç¼–è¯‘ç”¨æˆ·ç¨‹åºæ—¶ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨æ„é€ æ®µã€‚\n\nSegmentationâ€”Logical Address &amp; MMU\nè¦å°†é€»è¾‘åœ°å€æ˜ å°„åˆ°ç‰©ç†åœ°å€ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦æ‰¾åˆ°æ®µçš„åŸºåœ°å€ã€‚\n\nsegment table\n\nå…¶ä¸­æ¯ä¸ªæ¡ç›®ä»¥ segment-number ç´¢å¼•\nå­˜å‚¨å…¶Â æ®µåŸºåœ°å€ segment-baseÂ å’ŒÂ æ®µç•Œé™ segment-limitï¼ˆå¯èƒ½è¿˜åŒ…å«æƒé™ä½ï¼‰ã€‚\nå› æ­¤é€»è¾‘åœ°å€çš„æ˜ å°„æ–¹å¼å¦‚ä¸‹å›¾ï¼šå¦‚æœoffset&lt;limitï¼Œåˆ™åŠ ä¸Šbaseå¾—åˆ°ç‰©ç†åœ°å€\n\n\nè¿™ä¸€è¿‡ç¨‹æ˜¯ç”±ç¡¬ä»¶è®¾å¤‡Â MMU (Memory-Management Unit, å†…å­˜ç®¡ç†å•å…ƒ)Â å®Œæˆçš„ã€‚CPU ä½¿ç”¨çš„æ˜¯é€»è¾‘åœ°å€ï¼Œè€Œå†…å­˜å¯»å€ä½¿ç”¨çš„æ˜¯ç‰©ç†åœ°å€ï¼ŒMMU å®Œæˆçš„æ˜¯ç¿»è¯‘ï¼ˆæ˜ å°„ï¼‰å’Œä¿æŠ¤å·¥ä½œï¼šè¿™é‡Œçš„Â relocation registerÂ å³ä¸º base registerã€‚\n\nProblems\nåˆ†æ®µå°†ä¸€ä¸ªç¨‹åºåˆ†ä¸ºæ•°ä¸ªéƒ¨åˆ†ï¼Œä½†æ˜¯å…¶å†…å­˜åˆ†é…çš„ç­–ç•¥ä¸ç®€å•çš„ partition æ˜¯ä¸€è‡´çš„ã€‚å› æ­¤ï¼Œåˆ†æ®µä»ç„¶ä¼šå­˜åœ¨ external fragmentation çš„é—®é¢˜ï¼šå…¶è¡¨å¾æ˜¯æ€»ç©ºä½™å†…å­˜æ˜¯è¶³å¤Ÿçš„ï¼Œä½†æ˜¯ç”±äºå®ƒä¸è¿ç»­å¯¼è‡´å…¶æ— æ³•ä½¿ç”¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªé—®é¢˜çš„æ ¸å¿ƒç‚¹åœ¨äºÂ not contiguousã€‚æˆ‘ä»¬æœ‰ä¸¤ç§æ€è·¯æ¥è§£å†³è¿™ä¸€é—®é¢˜ï¼šå°†\n\nå†…å­˜é‡æ’ä½¿å¾— holes è¿æˆä¸€å—\n\nCompactionÂ å°±æ˜¯å°†å†…å­˜ä¸­çš„å†…å®¹é‡æ’ä½¿å¾—æ‰€æœ‰ç©ºé—²ç©ºé—´è¿ç»­ã€‚è¿™ä¸€æ“ä½œè¦æ±‚å†…å­˜ä¸­çš„ç¨‹åºæ˜¯Â relocatableÂ  çš„ï¼Œå³å…¶åœ°å€æ˜¯ç›¸å¯¹ base çš„åç§»ï¼›è¿™ä¸€è¦æ±‚åœ¨å‰é¢ä¸¤ç§å†…å­˜åˆ†é…æ–¹å¼ä¸­æ˜¯æ»¡è¶³çš„ã€‚ä½†æ˜¯è¿™ä¸€æ“ä½œéœ€è¦å°†å†…å­˜é€ä¸€å¤åˆ¶ï¼Œè¿™å°†æ¶ˆè€—å¾ˆå¤šæ—¶é—´ã€‚\n\n\næˆ–è€…è®¾è®¡æ–¹æ¡ˆè®©ç¨‹åºä¸å†éœ€è¦è¿ç»­çš„åœ°å€ã€‚\n\nå®é™…ä¸Šï¼Œåˆ†æ®µå·²ç»æ˜¯è¿™ä¸ªæ–¹å‘ä¸Šåšå‡ºçš„ä¸€ç§å°è¯•äº†ï¼Œå› ä¸ºå®ƒå°†ç¨‹åºåˆ†ä¸ºäº†å‡ å—ï¼Œç›¸æ¯”äºç®€å•çš„ partitionï¼Œåˆ†æ®µæœ‰åŠ©äºå‡å° external fragmentationã€‚ä¸ºäº†æ›´å¥½åœ°è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æå‡º pagingã€‚\n\n\n\nåˆ†é¡µPaging\nPaging ï¼ˆåˆ†é¡µï¼‰æ˜¯ä¸€ç§å…è®¸è¿›ç¨‹çš„ç‰©ç†åœ°å€ç©ºé—´ä¸è¿ç»­çš„å†…å­˜ç®¡ç†æ–¹æ¡ˆã€‚å®ƒé¿å…äº† external fragmentation å’Œ Compactionã€‚å„ç§å½¢å¼çš„ paging è¢«å¤§å¤šæ•°æ“ä½œç³»ç»Ÿé‡‡ç”¨ï¼›å®ç° paging éœ€è¦ OS å’Œç¡¬ä»¶çš„åä½œ\nBasic Method\n\nç‰©ç†åœ°å€:\n\nå°† physical memory åˆ‡åˆ†æˆç­‰å¤§å°çš„å—ï¼ˆ2 çš„å¹‚ï¼Œé€šå¸¸ä¸º 4KB = 2^12B ï¼‰ï¼Œç§°ä¸ºÂ framesï¼ˆå¸§ï¼‰\nå½“ä¸€ä¸ªè¿›ç¨‹è¦æ‰§è¡Œæ—¶ï¼Œå…¶å†…å®¹å¡«åˆ°ä¸€äº›å¯ç”¨çš„ frame ä¸­ï¼Œå…¶ä¸­çš„æ¯ä¸€ä¸ªåœ°å€å¯ä»¥ç”¨è¿™ä¸ª frame çš„ base/number(å”¯ä¸€)ä»¥åŠç›¸å¯¹è¿™ä¸ª base çš„ offset è¡¨ç¤º\n\n\né€»è¾‘åœ°å€:\n\nå°† logical memory åˆ‡åˆ†æˆåŒæ ·å¤§å°çš„å—ï¼Œç§°ä¸ºÂ pagesï¼ˆé¡µï¼‰\nåŒæ—¶ CPU ç”Ÿæˆé€»è¾‘åœ°å€ï¼Œé€»è¾‘åœ°å€åŒ…å«ä¸€ä¸ª page number å’Œä¸€ä¸ª page offsetï¼›å¦æœ‰ä¸€ä¸ªÂ page tableï¼Œå®ƒä»¥ page number ç´¢å¼•ï¼Œå…¶ä¸­çš„ç¬¬Â iÂ é¡¹å­˜å‚¨çš„æ˜¯ page number ä¸ºÂ iÂ çš„ page æ‰€åœ¨ç‰©ç†å†…å­˜çš„ frame çš„ baseã€‚è¿™æ ·ï¼Œæ¯ä¸€ä¸ª page å°†é€šè¿‡å…¶ page number æ˜ å°„åˆ°ä¸€ä¸ª frame ä¸Šï¼›è¿›è€Œ page ä¸­çš„æ¯ä¸€ä¸ªåœ°å€ä¹Ÿé€šè¿‡ offset ä¸frameä¸­çš„å¯¹åº”åœ°å€å»ºç«‹æ˜ å°„ã€‚\n\n\nä¹Ÿå°±æ˜¯è¯´ï¼Œå½“ MMU éœ€è¦å°†ä¸€ä¸ª logical address ç¿»è¯‘ä¸º physical address æ—¶ï¼Œå®ƒéœ€è¦è·å– page numberÂ pï¼Œåœ¨ page table ä¸­æ‰¾åˆ°ç¬¬Â pÂ ä¸ª page å¯¹åº”çš„çš„ frame numberï¼ˆä¹Ÿå°±æ˜¯ frame baseï¼‰Â fÂ ï¼Œåœ¨Â fÂ åé¢è¿æ¥ä¸Š offsetÂ dÂ å°±å¾—åˆ°äº†å¯¹åº”çš„ physical addressã€‚å¦‚æˆ‘ä»¬ä¹‹å‰æ‰€è¯´ï¼Œlogical address å’Œ physical address çš„ offset åº”æ˜¯ä¸€è‡´çš„ã€‚\n\nå½“ä¸€ä¸ªè¿›ç¨‹éœ€è¦æ‰§è¡Œæ—¶ï¼Œå…¶æ¯ä¸€é¡µéƒ½éœ€è¦ä¸€å¸§ã€‚å› æ­¤ï¼Œå¦‚æœè¿›ç¨‹éœ€è¦ n é¡µï¼Œåˆ™å†…å­˜ä¸­éœ€è¦æœ‰ n ä¸ªå¸§ã€‚å¦‚æœæœ‰ï¼Œé‚£ä¹ˆå°±å¯ä»¥åˆ†é…ç»™æ–°è¿›ç¨‹ï¼šè¿›ç¨‹çš„æ¯ä¸€é¡µè£…å…¥ä¸€ä¸ªå¸§ï¼Œframe number æ”¾å…¥è¿›ç¨‹çš„ page table ä¸­ã€‚\nç”±äºæ“ä½œç³»ç»Ÿç®¡ç†ç‰©ç†å†…å­˜ï¼Œå®ƒåº”è¯¥çŸ¥é“ç‰©ç†å†…å­˜çš„åˆ†é…ç»†èŠ‚ï¼Œå³å…±æœ‰å¤šå°‘å¸§ã€å¸§æ˜¯å¦ç©ºé—²ç­‰ã€‚è¿™äº›ä¿¡æ¯ä¿å­˜åœ¨Â frame tableÂ ä¸­ï¼Œæ¯ä¸ªæ¡ç›®å¯¹åº”ä¸€ä¸ªå¸§ï¼Œä¿å­˜å…¶æ˜¯å¦è¢«å ç”¨ï¼›å¦‚æœè¢«å ç”¨ï¼Œæ˜¯è¢«å“ªä¸ªè¿›ç¨‹çš„å“ªä¸ªé¡µå ç”¨ã€‚\n\nWhy â€œNot Contiguousâ€\nPage table ç¡¬ä»¶å®ç°\n1. Simplest method\næœ€ç®€å•çš„æ–¹æ³•æ˜¯ç”¨ä¸€ç»„ä¸“ç”¨çš„å¯„å­˜å™¨æ¥å®ç°ã€‚\n\nè¿™ä¸€å®ç°æ–¹æ³•çš„ä¼˜ç‚¹æ˜¯ä½¿ç”¨æ—¶éå¸¸è¿…é€Ÿï¼Œå› ä¸ºå¯¹å¯„å­˜å™¨çš„è®¿é—®æ˜¯ååˆ†é«˜æ•ˆçš„ã€‚\nä½†æ˜¯ï¼Œç”±äºæˆæœ¬ç­‰åŸå› ï¼Œå¯„å­˜å™¨çš„æ•°é‡æœ‰é™ï¼Œå› æ­¤è¿™ç§æ–¹æ³•è¦æ±‚ page table çš„å¤§å°å¾ˆå°ï¼›åŒæ—¶ï¼Œç”±äºä¸“ç”¨å¯„å­˜å™¨åªæœ‰ä¸€ç»„ï¼Œå› æ­¤ context switch æ—¶éœ€è¦å­˜å‚¨å¹¶é‡æ–°åŠ è½½è¿™äº›å¯„å­˜å™¨ã€‚\n\n2. Page table in memory &amp; PTBR\n\nå¤§å¤šæ•°ç°ä»£è®¡ç®—æœºå…è®¸é¡µè¡¨éå¸¸å¤§ï¼Œå› æ­¤å¯¹äºè¿™äº›æœºå™¨ï¼Œé‡‡ç”¨å¿«é€Ÿå¯„å­˜å™¨å®ç°é¡µè¡¨å°±ä¸å¯è¡Œäº†ã€‚æˆ‘ä»¬å°†é¡µè¡¨æ”¾åœ¨å†…å­˜ä¸­ï¼Œå¹¶ç”¨Â Page-Table Base Register (PTBR)Â æŒ‡å‘é¡µè¡¨ã€‚åœ¨ context switch æ—¶åªéœ€è¦ä¿®æ”¹ PTBRã€‚\nä½†æ˜¯è¿™ç§æ–¹æ³•çš„æ•ˆç‡å­˜åœ¨é—®é¢˜ã€‚è¦è®¿é—® logical address å¯¹åº”çš„ physical addressï¼Œæˆ‘ä»¬é¦–å…ˆè¦æ ¹æ® PTBR å’Œ page number æ¥æ‰¾åˆ°é¡µè¡¨åœ¨å†…å­˜çš„ä½ç½®ï¼Œå¹¶åœ¨å…¶ä¸­å¾—åˆ° page å¯¹åº”çš„ frame numberï¼Œè¿™éœ€è¦ä¸€æ¬¡å†…å­˜è®¿é—®ï¼›ç„¶åæˆ‘ä»¬æ ¹æ® frame number å’Œ page offset ç®—å‡ºçœŸå®çš„ physical addressï¼Œå¹¶è®¿é—®å¯¹åº”çš„å­—èŠ‚å†…å®¹ã€‚å³ï¼Œè®¿é—®ä¸€ä¸ªå­—èŠ‚éœ€è¦ä¸¤æ¬¡å†…å­˜è®¿é—®ï¼Œè¿™ä¼šåŠ å€åŸæœ¬çš„å†…å­˜è®¿é—®çš„æ—¶é—´ï¼Œè¿™æ˜¯éš¾ä»¥æ¥å—çš„ã€‚\n\n3. TLB flashcard\n\nè¿™ä¸ªé—®é¢˜çš„è§£å†³æ–¹æ³•ç”¨åˆ°ä¸€ä¸ªä¸“ç”¨çš„é«˜é€ŸæŸ¥æ‰¾ç¡¬ä»¶ cache (associative memoryï¼Œæ”¯æŒÂ parallel search)ï¼Œè¿™é‡Œç§°å®ƒä¸ºÂ translation look-aside buffer (TLB)ã€‚æ€»ä¹‹å°±æ˜¯ç¼“å­˜!\nTLB çš„æ¯ä¸ªæ¡ç›®ç”± key &amp; value ç»„æˆï¼Œåˆ†åˆ«è¡¨ç¤º page number å’Œ frame numberï¼Œé€šå¸¸æœ‰ 641024 ä¸ªæ¡ç›®ï¼ˆPPT ä¸Šè¯´ 641024ï¼Œè¯¾æœ¬ä¸Šè¯´ 32~1024ï¼ŒåŒºåˆ«ä¸å¤§ï¼‰\nå½“æˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä¸€ä¸ª page number å¯¹åº”çš„ frame number æ—¶ï¼ŒTLB ä¼šÂ åŒæ—¶ä¸å…¶ä¸­æ‰€æœ‰çš„ key è¿›è¡Œæ¯”è¾ƒï¼šå¦‚æœæ‰¾åˆ°å¯¹åº”æ¡ç›®ï¼Œå°±ä¸å¿…è®¿é—®å†…å­˜ï¼›å¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼ˆç§°ä¸ºÂ TLB missï¼‰ï¼Œåˆ™è®¿é—®å†…å­˜å¹¶å°†æ–°çš„ key &amp; value å­˜å…¥ TLB ä¸­ï¼Œè¿™ä¼šæ›¿æ¢æ‰ TLB åŸæœ‰çš„ä¸€ä¸ªæ¡ç›®ã€‚\næ›¿æ¢çš„ç­–ç•¥åŒ…æ‹¬ least recently used (LRU), round-robin, random ç­‰ã€‚æœ‰äº› TLB æ”¯æŒå°†æŸäº›æ¡ç›®[æ¯”å¦‚é‡è¦çš„å†…æ ¸ä»£ç ] wired downï¼Œå³ä»–ä»¬ä¸ä¼šä» TLB ä¸­è¢«æ›¿æ¢ã€‚åœ¨ MIPS æ¶æ„ä¸­ï¼ŒTLB miss ä½œä¸º exception ç”±æ“ä½œç³»ç»Ÿå¤„ç†ï¼›åœ¨ X86 æ¶æ„ä¸­ï¼ŒTLB miss ç”±ç¡¬ä»¶å¤„ç†ã€‚\n\n\nTLB with ASID\n\næ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±çš„é¡µè¡¨,æ¯ä¸ªé¡µæ˜¯æŒ‰ç…§å¤šçº§ç»“æ„å­˜å‚¨çš„\nå¦‚åŒæˆ‘ä»¬æåˆ°è¿‡çš„ï¼Œæ¯ä¸ª process éƒ½æœ‰å…¶è‡ªå·±çš„ page tableã€‚å› æ­¤åˆ‡æ¢è¿›ç¨‹æ—¶ä¹Ÿéœ€è¦åˆ‡æ¢ page tableã€‚äº¦å³ï¼Œæˆ‘ä»¬éœ€è¦ä¿è¯ TLB ä¸å½“å‰è¿›ç¨‹çš„ page table æ˜¯ä¸€è‡´çš„ã€‚\n\n\nä¸ºäº†ä¿è¯è¿™ä¸€è¦æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ¯æ¬¡åˆ‡æ¢æ—¶Â flushÂ TLBã€‚\næˆ–è€…ï¼Œæœ‰äº› TLB è¿˜åœ¨æ¯ä¸ªæ¡ç›®ä¸­ä¿å­˜Â Address-Space Identifier (ASID)ï¼Œæ¯ä¸ª ASID å”¯ä¸€æ ‡è¯†ä¸€ä¸ªè¿›ç¨‹ã€‚å½“ TLB è¿›è¡ŒåŒ¹é…æ—¶ï¼Œé™¤äº† page number å¤–ä¹Ÿå¯¹ ASID è¿›è¡ŒåŒ¹é…ã€‚\n\nEffective memory-access time EAT\n\nMemory Protectionå†…å­˜ä¿æŠ¤\nåˆ†é¡µç¯å¢ƒä¸‹çš„å†…å­˜ä¿æŠ¤ç”±ä¸æ¯ä¸ª frame å…³è”çš„ protection bits å®ç°ã€‚è¿™äº› bits é€šå¸¸ä¿å­˜åœ¨é¡µè¡¨ä¸­ã€‚ä¾‹å¦‚ valid-invalid bitï¼š\n\nv (Valid/æœ‰æ•ˆ)ï¼š è¡¨ç¤ºå¯¹åº”çš„é¡µæ˜¯è¿›ç¨‹åˆæ³•åœ°å€ç©ºé—´çš„ä¸€éƒ¨åˆ†ï¼Œå› æ­¤åœ°å€è½¬æ¢å¯ä»¥æ­£å¸¸è¿›è¡Œã€‚\ni (Invalid/æ— æ•ˆ)ï¼š è¡¨ç¤ºå¯¹åº”çš„é¡µä¸æ˜¯è¿›ç¨‹åˆæ³•åœ°å€ç©ºé—´çš„ä¸€éƒ¨åˆ†ï¼Œå¦‚æœ CPU è¯•å›¾ç”Ÿæˆè¯¥é¡µå·å¯¹åº”çš„åœ°å€ï¼Œè®¡ç®—æœºå°†è§¦å‘ä¸€ä¸ª trap (é™·å…¥) åˆ°æ“ä½œç³»ç»Ÿï¼Œè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªæ— æ•ˆçš„é¡µå¼•ç”¨ (invalid page reference)ã€‚\nå¦‚å›¾æ‰€ç¤ºï¼Œåœ¨ä¸€ä¸ªå…·æœ‰ 14 ä½åœ°å€ç©ºé—´ï¼ˆ0 åˆ° 16383ï¼‰çš„ç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªç¨‹åºåº”è¯¥ä»…ä½¿ç”¨åœ°å€ 0 åˆ° 10468ã€‚ç»™å®šé¡µé¢å¤§å°ä¸º 2 KBï¼Œæˆ‘ä»¬æœ‰å¦‚å›¾ 9.13 æ‰€ç¤ºçš„æƒ…å†µã€‚é¡µé¢ 0ã€1ã€2ã€3ã€4 å’Œ 5 ä¸­çš„åœ°å€é€šè¿‡é¡µè¡¨æ­£å¸¸æ˜ å°„ã€‚ä½†æ˜¯ï¼Œå°è¯•ç”Ÿæˆé¡µé¢ 6 æˆ– 7 ä¸­çš„åœ°å€ä¼šå‘ç°ä½è¢«è®¾ç½®ä¸ºæ— æ•ˆï¼Œé™·å…¥æ— æ•ˆé¡µé¢å¼•ç”¨å¼‚å¸¸\næ³¨æ„ï¼Œå› ä¸ºç¨‹åºåªå»¶ä¼¸åˆ°åœ°å€ 10468ï¼Œä»»ä½•è¶…è¿‡è¯¥åœ°å€çš„å¼•ç”¨éƒ½æ˜¯éæ³•çš„ã€‚ç„¶è€Œï¼Œå¯¹é¡µé¢ 5 çš„å¼•ç”¨è¢«å½’ç±»ä¸ºæœ‰æ•ˆçš„ï¼Œæ‰€ä»¥å¯¹åœ°å€ 12287 ä»¥å†…çš„è®¿é—®éƒ½æ˜¯æœ‰æ•ˆçš„ã€‚åªæœ‰ä» 12288 åˆ° 16383 çš„åœ°å€æ˜¯æ— æ•ˆçš„ã€‚è¿™ä¸ªé—®é¢˜æ˜¯ 2-KB é¡µé¢å¤§å°çš„ç»“æœï¼Œåæ˜ äº†åˆ†é¡µçš„å†…éƒ¨ç¢ç‰‡ã€‚\næŸäº›ç³»ç»Ÿæä¾›ç¡¬ä»¶å½¢å¼çš„é¡µè¡¨é•¿åº¦å¯„å­˜å™¨ï¼ˆPTLRï¼‰ï¼Œä»¥æŒ‡ç¤ºé¡µè¡¨çš„å¤§å°ã€‚è¿™ä¸ªå€¼ä¼šé’ˆå¯¹æ¯ä¸ªé€»è¾‘åœ°å€è¿›è¡Œæ£€æŸ¥ï¼Œä»¥éªŒè¯è¯¥åœ°å€åœ¨è¿›ç¨‹çš„æœ‰æ•ˆèŒƒå›´å†…ã€‚æœªé€šè¿‡æ­¤æµ‹è¯•å°†å¯¼è‡´å¯¹æ“ä½œç³»ç»Ÿçš„é”™è¯¯é™·é˜±ã€‚\n\nShared Pages\nåˆ†é¡µå¯ä»¥å…è®¸è¿›ç¨‹é—´å…±äº«ä»£ç ï¼Œä¾‹å¦‚åŒä¸€ç¨‹åºçš„å¤šä¸ªè¿›ç¨‹å¯ä»¥ä½¿ç”¨åŒä¸€ä»½ä»£ç ï¼Œåªè¦è¿™ä»½ä»£ç æ˜¯Â reentrant codeÂ ï¼ˆorÂ non-self-modifying codeÂ : never changes between executionï¼‰ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼šå›¾ä¸­æ‰€è¿°çš„æ˜¯å¤šä¸ªè¿›ç¨‹å…±äº«ä¸€ä»½åº“ä»£ç çš„æƒ…å†µï¼›å…±äº«è¿˜å¯ä»¥ç”¨äºè¿›ç¨‹ä¹‹é—´çš„äº¤æµã€‚å½“ç„¶ï¼Œæ¯ä¸ªè¿›ç¨‹ä¹Ÿå¯ä»¥æœ‰å…¶è‡ªå·±çš„ä»£ç å’Œæ•°æ®ã€‚\nåˆ†é¡µProblems\n\nä¼šå¯¼è‡´å†…éƒ¨ç¢ç‰‡ã€‚å†…å­˜åˆ†é…æ˜¯ä»¥ frame ä¸ºå•ä½æ‰§è¡Œçš„ï¼Œå¦‚æœè¿›ç¨‹è¦æ±‚çš„å†…å­˜ä¸æ˜¯ frame å¤§å°çš„æ•´æ•°å€ï¼Œé‚£ä¹ˆæœ€åä¸€ä¸ª frame å°±ä¼šç”¨ä¸å®Œï¼Œäº§ç”Ÿå†…éƒ¨ç¢ç‰‡ã€‚æœ€åçš„æƒ…å†µä¸‹ï¼Œä¸€ä¸ªéœ€è¦Â n pages + 1 byteÂ çš„è¿›ç¨‹éœ€è¦åˆ†é…Â n+1Â ä¸ª frameï¼Œé‚£ä¹ˆå°±ä¼šäº§ç”ŸÂ FrameSize - 1Â é‚£ä¹ˆå¤§çš„ Internal Fragmentationã€‚\nå¦‚æœè¿›ç¨‹çš„å¤§å°ä¸é¡µå¤§å°æ— å…³ï¼Œæ¯ä¸ªè¿›ç¨‹ä¸­å†…éƒ¨ç¢ç‰‡çš„å‡å€¼ä¸ºÂ Â½ FrameSizeã€‚åœ¨å®é™…æƒ…å†µä¸­ï¼Œå¹³å‡å€¼æ¯”è¿™å°å¾ˆå¤šã€‚å½“ç„¶ï¼Œæˆ‘ä»¬ä¸èƒ½ä¸ºäº†å‡å°å†…éƒ¨ç¢ç‰‡è€Œå°† frame çš„å¤§å°æ— é™å‡å°ï¼Œå› ä¸ºæ›´å°çš„ frame size éœ€è¦æ›´å¤šçš„é¡µè¡¨é¡¹ã€‚\n\nStructure of Page Table\nå¤šçº§é¡µè¡¨\né¡µè¡¨æ˜¯ä¸€ä¸ªæ•°ç»„ï¼ŒÂ page_table[i]Â ä¸­å­˜å‚¨çš„æ˜¯ page number ä¸º i çš„ page æ‰€å¯¹åº”çš„ frame numberã€‚è€ƒè™‘æˆ‘ä»¬çš„é€»è¾‘åœ°å€ç»“æ„ï¼š\n\nè¿™æ ·çš„é€»è¾‘åœ°å€ç»“æ„éœ€è¦ä¸€ä¸ªå­˜å‚¨ 2^pÂ ä¸ªå…ƒç´ çš„ page tableï¼Œå³éœ€è¦è¿™ä¹ˆå¤§çš„è¿ç»­å†…å­˜ï¼Œè¿™æ˜¯éå¸¸å¤§çš„æ¶ˆè€—ã€‚æˆ‘ä»¬è€ƒè™‘å°† p å†åˆ†ä¸º p1Â å’Œ p2Â ï¼š\n\nä¸¤çº§é¡µè¡¨ï¼ŒÂ outer_page_table[i]Â ä¸­å­˜å‚¨çš„æ˜¯ p1Â ä¸º i çš„ inner page tableï¼Œå³inner_page_table[i][]Â çš„åŸºåœ°å€ï¼›\nè€ŒÂ inner_page_table[i][j]Â ä¸­å­˜å‚¨çš„å°±æ˜¯ p1Â ä¸º iï¼Œp2Â ä¸º j çš„ page å¯¹åº”çš„ frame numberï¼Œå³ page number ä¸º p1p2Â ï¼ˆæ²¡æœ‰åˆ†å‰²æ—¶çš„ pï¼‰å¯¹åº”çš„ frame numberã€‚\nç§° p1Â ä¸ºÂ page directory numberÂ ï¼Œp2Â ä¸ºÂ page table numberï¼Œd ä¸ºÂ page offsetã€‚ \né€»è¾‘åœ°å€Â ä»£æ›¿Â ç‰©ç†åœ°å€æ»¡è¶³äº†ç¨‹åºçš„ contiguous è¦æ±‚ã€‚è€ƒè™‘è¿™ä¸­åˆ†ä¸¤é¡µçš„ page table ç»“æ„ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°æˆ‘ä»¬åªæ˜¯å°† p åˆ†æˆäº†ä¸¤éƒ¨åˆ†ï¼›å¯¹äºç¨‹åºæ¥è¯´ï¼Œp+d æ„æˆçš„æ•´ä½“ï¼ˆå³é€»è¾‘åœ°å€ï¼‰ä»ç„¶æ˜¯ contiguous çš„ï¼Œè€Œä¸”ç¨‹åºå¹¶ä¸ä¼šæ„è¯†åˆ°æˆ‘ä»¬å°† p åˆ†æˆäº† p1Â å’Œ p2Â ä¸¤éƒ¨åˆ†ï¼Œå°±åƒæ›¾ç»å®ƒæ²¡æœ‰æ„è¯†åˆ°æˆ‘ä»¬å°† address åˆ†ä¸ºäº† p å’Œ d ä¸¤éƒ¨åˆ†ä¸€æ ·ã€‚è¿™äº›åˆ’åˆ†åªæ˜¯æˆ‘ä»¬ä¸ºäº†æ›´å¥½åœ°åˆ†é…å†…å­˜æ‰€åšçš„ã€Operating-System-Level çš„äº‹æƒ…è€Œå·²ã€‚\nè€ƒè™‘è¿™æ ·åšçš„å¥½å¤„ï¼šhierarchical paging å…¶å®å°±æ˜¯å¯¹é¡µè¡¨çš„åˆ†é¡µï¼ˆpage the page tableï¼‰ã€‚å› æ­¤ï¼Œå®ƒé¿å…äº† page table å¿…é¡»å¤„åœ¨è¿ç»­å†…å­˜çš„é—®é¢˜ï¼Œè¿™ä¸€é—®é¢˜åœ¨Â pÂ æ¯”è¾ƒå¤§æ—¶å°¤å…¶ä¸¥é‡ã€‚\nå¦å¤–ï¼Œè¿™æ ·åšåœ¨ä¸€èˆ¬æƒ…å†µä¸‹å¯ä»¥èŠ‚çœç©ºé—´ã€‚æˆ‘ä»¬ä¹‹å‰æåˆ°ï¼Œé¡µè¡¨ä¸ä¸€å®šä¼šå…¨éƒ¨ä½¿ç”¨ï¼›å¹¶ä¸”ç”±äºé€»è¾‘åœ°å€æ˜¯è¿ç»­çš„ï¼Œå› æ­¤ç”¨åˆ°çš„é¡µè¡¨é¡¹ä¹Ÿæ˜¯è¿ç»­çš„ï¼Œéƒ½æ’åœ¨é¡µè¡¨çš„å¤´éƒ¨ã€‚å› æ­¤å¦‚æœæˆ‘ä»¬é‡‡ç”¨äº†äºŒçº§é¡µè¡¨ï¼Œé‚£ä¹ˆè®¸å¤šæ’åœ¨åé¢çš„ inner page table å°†å®Œå…¨ä¸ºç©ºï¼›æ­¤æ—¶æˆ‘ä»¬å¯ä»¥ç›´æ¥ä¸ç»™è¿™äº› inner page table åˆ†é…ç©ºé—´ï¼Œå³æˆ‘ä»¬åªåˆ†é…æœ€å¤§çš„ p1Â é‚£ä¹ˆå¤šä¸ª inner page tableã€‚è¿™æ ·æˆ‘ä»¬å¯ä»¥èŠ‚çœå¾ˆå¤šç©ºé—´ã€‚å³ä½¿åœ¨æœ€å·®çš„æƒ…å†µä¸‹ï¼Œæ‰€æœ‰é¡µè¡¨éƒ½è¢«ä½¿ç”¨äº†ï¼Œæˆ‘ä»¬çš„é¡µè¡¨æ‰€ç”¨çš„æ€»æ¡ç›®æ•°ä¹Ÿåªæœ‰ç±»ä¼¼åœ°ï¼Œæˆ‘ä»¬å¯ä»¥è®¾è®¡æ›´å¤šçº§çš„é¡µè¡¨ã€‚ä¾‹å¦‚ï¼Œ64 ä½çš„é€»è¾‘åœ°å€ç©ºé—´ä½¿ç”¨äºŒçº§é¡µè¡¨å°±æ˜¯ä¸å¤Ÿçš„ï¼Œå¦åˆ™å®ƒçš„é¡µè¡¨å°±ä¼šé•¿æˆè¿™æ ·ï¼šè¿™æ ·ï¼Œæˆ‘ä»¬å°±å»ºç«‹äº†ä¸€ä¸ªä¸‰çº§é¡µè¡¨ã€‚\nå®é™…ä¸Šï¼Œæˆ‘ä»¬ä¸å¿…ä½¿ç”¨å…¨éƒ¨çš„ 64 ä½ï¼Œå³æˆ‘ä»¬ä¸éœ€è¦ä¸€ä¸ª 64 ä½é‚£ä¹ˆå·¨å¤§çš„ virtual address spaceã€‚AMD-64 æ”¯æŒ 48-bit çš„è™šæ‹Ÿåœ°å€ï¼ŒARM64 æ”¯æŒ 39-bit å’Œ 48-bit çš„è™šæ‹Ÿåœ°å€ç©ºé—´ï¼š\n\nHashed Page Tables å“ˆå¸Œé¡µè¡¨\nå‰é¢ä»‹ç»çš„é¡µè¡¨æ˜¯ä½¿ç”¨ä¸€ä¸ª table ä¿å­˜ page# å¯¹åº”çš„ frame#ï¼Œè¿™ç§è§£å†³æ–¹æ¡ˆé¢ä¸´çš„é—®é¢˜æ˜¯ç©ºé—´éœ€æ±‚æ˜¯ä¸”è¿ç»­çš„ï¼›æˆ‘ä»¬é€šè¿‡å¤šçº§é¡µè¡¨è§£å†³è¿™ä¸ªé—®é¢˜ã€‚è€Œå“ˆå¸Œé¡µè¡¨ç»™ page# åˆ†é… frame# å¹¶ä¸æ˜¯éšæ„åˆ†é…ï¼Œè€Œæ˜¯é€šè¿‡å“ˆå¸Œè®¡ç®—å¾—åˆ°ã€‚è¿™æ ·çš„æ–¹å¼å°†ç©ºé—´éœ€æ±‚é™ä½åˆ°ä¸”æ¯ä¸ª page å¯¹åº”çš„è¡¨é¡¹åœ¨å†…å­˜ä¸­å¹¶ä¸éœ€è¦è¿ç»­ï¼Œä»è€Œè§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚å“ˆå¸Œé¡µè¡¨çš„æ¯ä¸€ä¸ªæ¡ç›®é™¤äº† page number å’Œ frame number ä»¥å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªæŒ‡å‘æœ‰åŒä¸€å“ˆå¸Œå€¼çš„ä¸‹ä¸€ä¸ªé¡µè¡¨é¡¹çš„æŒ‡é’ˆã€‚è¿™ä¸ªç»“æ„ä¸ä¸€èˆ¬çš„å“ˆå¸Œè¡¨æ˜¯ä¸€è‡´çš„ã€‚è¿™æ˜¯ 32-bit address spaces é¡µè¡¨çš„ä¸€ä¸ªå¸¸ç”¨æ–¹æ¡ˆã€‚\nInverted Page Tables å€’æ’é¡µè¡¨\nåœ¨ä¹‹å‰çš„åˆ†é¡µæ–¹æ³•æ—¶ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä¸ªé¡µè¡¨ã€‚è¿™ç§æ–¹æ³•ä¼šå¯¼è‡´è¿™äº›è¡¨å¯èƒ½ä½¿ç”¨å¤§é‡çš„ç‰©ç†å†…å­˜ã€‚\nInverted page tables ç´¢å¼• physical address è€Œä¸æ˜¯ logical addressï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ•´ä¸ªç³»ç»Ÿåªæœ‰ä¸€ä¸ªé¡µè¡¨ï¼Œå¹¶ä¸”æ¯ä¸ªç‰©ç†å†…å­˜çš„ frame åªæœ‰ä¸€æ¡ç›¸åº”çš„æ¡ç›®ã€‚å¯»å€æ—¶ï¼ŒCPU éå†é¡µè¡¨ï¼Œæ‰¾åˆ°å¯¹åº”çš„ pid å’Œ page numberï¼Œå…¶åœ¨é¡µè¡¨ä¸­æ‰€å¤„çš„ä½ç½®å³ä¸º frame numberï¼š==é¡µè¡¨çš„ç¬¬ i é¡¹ï¼ˆå¸§ iï¼‰å­˜å‚¨äº†å“ªä¸ªè¿›ç¨‹çš„å“ªä¸ªé¡µå ç”¨äº†è¿™ä¸ªå¸§ï¼Œå³å­˜å‚¨äº† (pid, p) å¯¹ã€‚==\n\nè¿™ç§åšæ³•çš„ç¼ºç‚¹æ˜¯\n\nå¯»å€è¿‡ç¨‹éœ€è¦å¾ˆé•¿æ—¶é—´ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨ TLB æˆ–è€… hashed table æ¥åŠ é€Ÿã€‚\nè¿™ç§æ–¹æ³•ä¸èƒ½å¤Ÿå…±äº«å†…å­˜ï¼Œå› ä¸º page table çš„æ¯ä¸€ä¸ªæ¡ç›®ï¼ˆä¸ frame number ä¸€ä¸€å¯¹åº”ï¼‰åªèƒ½å­˜å‚¨ä¸€ä¸ª page numberã€‚\nä¼ ç»Ÿé¡µè¡¨æ˜¯æ¯ä¸ªè¿›ç¨‹æœ‰ä¸€ä¸ªç‹¬ç«‹çš„é¡µè¡¨ï¼ŒæŠŠç”¨åˆ°çš„é¡µå’Œå¯¹åº”çš„frameè”ç³»èµ·æ¥ã€‚å€’æ’é¡µè¡¨æ•´ä¸ªç³»ç»Ÿåªæœ‰ä¸€ä¸ªï¼Œç¬¬ié¡¹è¡¨ç¤ºå¸§iï¼Œå­˜å‚¨äº†å“ªä¸ªè¿›ç¨‹çš„å“ªä¸ªé¡µå ç”¨äº†è¿™ä¸ªå¸§ã€‚\n\nSwapping\n\nè¿›ç¨‹çš„æŒ‡ä»¤å’Œæ•°æ®å¿…é¡»åœ¨å†…å­˜ä¸­ä»¥æ‰§è¡Œï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥å°†è¿›ç¨‹æˆ–è¿›ç¨‹çš„ä¸€éƒ¨åˆ†æš‚æ—¶ä»å†…å­˜Â swapÂ åˆ°Â ==backing storeÂ ï¼ˆå¤‡ä»½å­˜å‚¨ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¿«çš„ç£ç›˜ï¼‰==ä¸­ï¼Œç»§ç»­è¿è¡Œæ—¶ä»ä¸­é‡æ–°æ‹¿å›åˆ°å†…å­˜ã€‚\nSwapping ä½¿å¾—æ‰€æœ‰è¿›ç¨‹æ€»çš„ç‰©ç†åœ°å€ç©ºé—´æ€»å’Œè¶…è¿‡ç³»ç»Ÿä¸­çœŸå®çš„ç‰©ç†åœ°å€ç©ºé—´ç§°ä¸ºå¯èƒ½ï¼Œæé«˜äº†ç³»ç»Ÿçš„ degree of multiprogrammingã€‚\nå½“ç„¶ï¼Œåœ¨å†…å­˜æ¯”è¾ƒå……è¶³çš„æƒ…å†µä¸‹ï¼Œswapping å¹¶ä¸å¿…ä½¿ç”¨ã€‚Swapping å¯èƒ½ä¼šå¯¼è‡´å¾ˆé•¿çš„ context switch ç”¨æ—¶ï¼Œå› ä¸ºä¸‹ä¸€ä¸ªè¿›ç¨‹å¯èƒ½å¹¶ä¸åœ¨å†…å­˜ä¸­ï¼Œè€Œç”±äºç£ç›˜çš„ I/O å¾ˆæ…¢ï¼Œswapping åˆ°å†…å­˜ä¼šèŠ±è´¹å¾ˆé•¿æ—¶é—´ã€‚\nåœ¨åˆ†é¡µçš„æœºåˆ¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åª swap out ä¸€äº› pagesï¼Œè€Œä¸å¿… swap out ä¸€æ•´ä¸ªè¿›ç¨‹ï¼š\n"},"è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/04.2-virtual-memory":{"slug":"è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/04.2-virtual-memory","filePath":"è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/04.2 virtual memory.md","title":"04.2 virtual memory","links":["tags/flashcard"],"tags":["flashcard"],"content":"DECK: CS::OS\nåœ°å€ç©ºé—´ä¸å¼‚å¸¸\nåœ°å€ç©ºé—´ (address space)Â æŒ‡çš„æ˜¯åœ°å€å–å€¼çš„å…¨é›†ã€‚\n\nç‰©ç†åœ°å€ç©ºé—´\n\nä¾‹å¦‚ï¼Œå¯¹äºä¸€ä¸ª 32 ä½å¯»å€çš„ä½“ç³»ç»“æ„ï¼Œå…¶Â ç‰©ç†åœ°å€ç©ºé—´ï¼ˆç‰©ç†åœ°å€çš„é›†åˆï¼‰å°±æ˜¯Â ï¼Œäº¦å³Â 0x00000000 ~ 0xffffffffã€‚\n-Â flat memoryå†…å­˜æ¨¡å‹: åœ¨å¼•å…¥åˆ†æ®µ / åˆ†é¡µæŠ€æœ¯ä¹‹å‰ï¼Œå„ä¸ªè¿›ç¨‹å’Œæ“ä½œç³»ç»Ÿå…±åŒä½¿ç”¨åŒä¸€ä¸ªç‰©ç†åœ°å€ç©ºé—´ã€‚å®ƒä¼šå¸¦æ¥æ¯”è¾ƒå¤§çš„ç¢ç‰‡ï¼ŒåŒæ—¶éš”ç¦»æ€§è¾ƒå·®ï¼Œå†…å­˜çš„ä¿æŠ¤è¾ƒå¼±ã€‚\n\n\nè™šæ‹Ÿåœ°å€ç©ºé—´\n\nè€Œåœ¨å¼•å…¥äº†åˆ†æ®µ / åˆ†é¡µæŠ€æœ¯ä¹‹åï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰äº†è‡ªå·±çš„ä¸€å¥— logical memory (a.k.a. virtual memory) ï¼Œå…¶å¯¹åº”çš„çš„åœ°å€ç©ºé—´å°±å«åšÂ é€»è¾‘åœ°å€ç©ºé—´ (logical address space)Â æˆ–è€…Â è™šæ‹Ÿåœ°å€ç©ºé—´ (virtual address space)ï¼›è€Œå¯¹åº”çš„æ®µè¡¨ / é¡µè¡¨çš„ä½œç”¨å°±æ˜¯æä¾›ä»è™šæ‹Ÿåœ°å€ç©ºé—´åˆ°ç‰©ç†åœ°å€ç©ºé—´çš„æ˜ å°„ï¼ˆæ˜ å°„è¿‡ç¨‹ä¸­ï¼Œç”±äº swapping æœºåˆ¶çš„å­˜åœ¨ï¼Œä¹Ÿæœ‰å¯èƒ½å‡ºç° swap çš„è¿‡ç¨‹ï¼‰ã€‚\n\n\næˆ‘ä»¬çŸ¥é“ï¼Œä¸Šè¿°çš„æ˜ å°„è¿‡ç¨‹ç”± OS å’Œ MMU å…±åŒå®ç°ï¼Œå› æ­¤è¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´æ˜¯è¢«éš”ç¦»çš„ï¼›åªè¦ MMU ä¸å‡ºç°é—®é¢˜ä»¥åŠé¡µè¡¨ä¸è¢«ç¯¡æ”¹ï¼ˆè¿™é€šå¸¸æ¯”è¾ƒå›°éš¾ï¼‰ï¼Œå…¶ä»–è¿›ç¨‹å°±æ²¡æœ‰åŠæ³•è®¿é—®åˆ°è¿™ä¸ªè¿›ç¨‹çš„å†…å­˜ã€‚\nä¹Ÿå°±æ˜¯è¯´ï¼Œè™šæ‹Ÿå†…å­˜ä¾›è½¯ä»¶ä½¿ç”¨ï¼Œè€Œ CPU åœ¨è®¿é—®å¯¹åº”çš„å†…å­˜åœ°å€æ—¶ä¼šç”± MMU è‡ªåŠ¨è½¬æ¢ä¸ºå¯¹åº”çš„ç‰©ç†åœ°å€ï¼›å¦‚æœå¯¹åº”çš„ page ä¸åœ¨ç‰©ç†å†…å­˜ä¸­ï¼Œå°±ä¼šè§¦å‘ä¸€æ¬¡Â page faultï¼Œè¿™æ˜¯ä¸€ä¸ª exceptionã€‚æœ‰ 3 ç§å¯èƒ½çš„æƒ…å†µï¼š\n\nå½“å‰çš„è¿›ç¨‹çš„é¡µè¡¨ä¸­å¹¶æ²¡æœ‰è¿™ä¸ªè™šæ‹Ÿåœ°å€å¯¹åº”çš„ pageï¼›\næƒé™ä¸ç¬¦ï¼Œä¾‹å¦‚è¯•å›¾è¿è¡ŒæŸä¸ªæƒé™ä½æ˜¯Â RW-Â çš„ page ä¸­çš„ä»£ç ï¼Œæˆ–è€…è¯•å›¾å†™å…¥æŸä¸ªæƒé™ä½æ˜¯Â R-XÂ æˆ–Â R--Â çš„ page ä¸­çš„æŸä¸ªå†…å­˜å•å…ƒï¼›\nå½“å‰è™šæ‹Ÿåœ°å€æ˜¯åˆæ³•çš„ï¼Œä½†æ˜¯å¯¹åº”çš„ page è¢« swapped out äº†ã€‚\n\n\næˆ‘ä»¬çŸ¥é“ï¼Œexception ä¼šäº¤ç”±æ“ä½œç³»ç»Ÿå¤„ç†ï¼›å¦‚æœæ˜¯å‰ä¸¤ç§æƒ…å†µï¼Œæ“ä½œç³»ç»Ÿåº”å½“æŠ¥é”™å¹¶åšç›¸å…³å¤„ç†ï¼ˆä¾‹å¦‚æ€æ‰å¯¹åº”è¿›ç¨‹ï¼‰ï¼›è€Œå¦‚æœæ˜¯åä¸€ç§æƒ…å†µï¼Œæ“ä½œç³»ç»Ÿåº”å½“å°†è¿›ç¨‹é˜»å¡ï¼Œå¹¶å°†å¯¹åº”çš„ page äº¤æ¢å›æ¥ï¼Œè°ƒé¡µå®Œæˆåå”¤é†’è¿›ç¨‹ã€‚\nåœ¨ä¸€æ¡æŒ‡ä»¤æ‰§è¡ŒæœŸé—´ï¼Œå¯èƒ½è§¦å‘å¤šæ¬¡ page faultï¼ˆæŒ‡ä»¤æœ¬èº«å’Œè®¿é—®çš„åœ°å€å¯èƒ½éƒ½ä¸åœ¨ç‰©ç†å†…å­˜ä¸­ï¼‰ã€‚å½“ page fault è¢«è§£å†³åï¼ŒæŒ‡ä»¤è¢«é‡æ–°è¿è¡Œï¼›å› æ­¤ä¸€æ¡æŒ‡ä»¤åœ¨çœŸæ­£æˆåŠŸè¿è¡Œä¹‹å‰å¯èƒ½ä¼šè¢«å°è¯•è¿è¡Œå¤šæ¬¡ã€‚\n\nKernel Addresses &amp; Userspace Addresses flashcard\n\næ¯ä¸ªè¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´ï¼ˆä¸‹ç®€ç§°åœ°å€ç©ºé—´ã€ASï¼‰è¢«åˆ†ä¸ºäº†Â Kernel PortionÂ å’ŒÂ User Portion\n\nkernel æ¨¡å¼ä¸‹çš„ä»£ç å¯ä»¥è®¿é—®è¿™ä¸¤å—ç©ºé—´ [CPU é™·å…¥å†…æ ¸ä»£ç ï¼Œè¿›å…¥é«˜æƒé™ï¼Œä½†å®ƒä¾ç„¶æ˜¯åœ¨è¿™ä¸ªè¿›ç¨‹çš„ä¸Šä¸‹æ–‡ä¸­å·¥ä½œ]\nuser æ¨¡å¼ä¸‹çš„ä»£ç åªèƒ½è®¿é—® User Portionã€‚\n\n\næ¯ä¸ªè¿›ç¨‹çš„ AS çš„ kernel portion éƒ½æ˜ å°„åˆ°äº†åŒä¸€å—ç‰©ç†å†…å­˜ã€‚åŸå› æ˜¯æ˜¾ç„¶çš„ï¼šæ‰€æœ‰è¿›ç¨‹ç”¨åˆ°çš„éƒ½æ˜¯åŒä¸€å¥— kernelï¼Œå› æ­¤æ²¡å¿…è¦æŠŠ kernel ç”¨çš„å†…å­˜ï¼ˆå­˜ä¾‹å¦‚å„ä¸ªè¿›ç¨‹çš„é¡µè¡¨ã€å„ç§é˜Ÿåˆ—ä¹‹ç±»çš„ä¸œè¥¿ï¼‰å¤åˆ¶å¥½å‡ ä»½ã€‚\n\nå®ç°\n\nåœ¨ 32 ä½è™šæ‹Ÿåœ°å€ç©ºé—´ï¼ˆ4GBï¼‰çš„è®¾è®¡é‡Œï¼Œkernel é»˜è®¤ä½¿ç”¨é«˜ 1GBï¼Œå„ä¸ªè¿›ç¨‹çš„ user portion ä½¿ç”¨ä½ 3GB çš„è™šæ‹Ÿåœ°å€ç©ºé—´ï¼›é€šè¿‡åœ¨ build kernel ä¹‹å‰æ›´æ”¹Â CONFIG_PAGE_OFFSETÂ å¯ä»¥æ›´æ”¹è¿™ä¸€åˆ†é…\n\n32ä½ç³»ç»Ÿåªä½¿ç”¨ä¸€å¥—é¡µè¡¨\n\n\nå¯¹äº 64 ä½è™šæ‹Ÿåœ°å€ç©ºé—´çš„è®¾è®¡ï¼Œç”±äºæ ¹æœ¬ç”¨ä¸äº†è¿™ä¹ˆå¤šï¼Œå› æ­¤ kernel space å’Œ user space è¢«è‡ªç„¶åˆ†éš”å¼€ï¼šå…¶ä¸­Â TTBR (Translation Table Base Register)Â ä¿å­˜é¡µè¡¨çš„åŸºåœ°å€\n=TTBR0 ç®¡ç†çš„ç”¨æˆ·ç©ºé—´ + TTBR1 ç®¡ç†çš„å†…æ ¸ç©ºé—´ã€‚å¯¹åº”ä¸¤å¥—é¡µè¡¨\nTTBR0Â æ˜¯æ¯ä¸ªè¿›ç¨‹çš„é¡µè¡¨å¯¹åº”çš„ TTBR\nTTBR1Â æ˜¯ kernel portion çš„é¡µè¡¨å¯¹åº”çš„ TTBRã€‚\n\n\n\n\n                  \n                  åˆ†é…ç­–ç•¥å’Œç½®æ¢ç­–ç•¥çš„åŒºåˆ« \n                  \n                \n\n\nå»¶è¿Ÿåˆ†é… å’Œ COW æ˜¯åœ¨å†…å­˜å……è¶³æ—¶ä¼˜åŒ–åˆ†é…æˆ–å¤åˆ¶çš„ç­–ç•¥ï¼Œç›®çš„æ˜¯æ¨è¿Ÿæˆ–é¿å…åˆ†é…ï¼Œä»è€ŒèŠ‚çœå†…å­˜ã€‚\né¡µé¢ç½®æ¢ æ˜¯åœ¨å†…å­˜ä¸è¶³æ—¶ï¼ˆç‰©ç†å¸§è€—å°½ï¼‰å¼ºåˆ¶é‡Šæ”¾å†…å­˜çš„ç­–ç•¥ï¼Œç›®çš„æ˜¯åœ¨èµ„æºç´§å¼ æ—¶ä¿è¯ç³»ç»Ÿèƒ½ç»§ç»­è¿è¡Œã€‚\n\n\n\nåˆ†é…ç­–ç•¥\nLazy Allocation / Demand Paging flashcard\næ“ä½œç³»ç»Ÿåœ¨åˆ†é… user space çš„å†…å­˜æ—¶ï¼Œä¼šä½¿ç”¨ lazy allocationï¼š\n\nå½“ç”¨æˆ·ç¨‹åºç”³è¯·ä¸€å—å†…å­˜æ—¶ï¼Œæ“ä½œç³»ç»Ÿå¹¶ä¸ä¼šçœŸçš„ç«‹å³åœ¨ç‰©ç†å†…å­˜ä¸­åˆ†é…å¯¹åº”çš„å†…å­˜ï¼›ç›´åˆ°è¿™å—å†…å­˜è¢«çœŸæ­£è®¿é—®ã€‚\nåŸç†: å¾ˆå¤šç”¨æˆ·ç¨‹åºç”³è¯·çš„å†…å­˜å¤§å°æ¯”çœŸæ­£éœ€è¦ä½¿ç”¨çš„é€šå¸¸è¦å¤§ï¼Œä¾‹å¦‚ buffer ç­‰ã€‚\n\n\nç¨‹åºï¼ˆä¾‹å¦‚é€šè¿‡ malloc åº“å‡½æ•°ï¼‰å‘ç°éœ€è¦æ›´å¤šå†…å­˜ï¼Œäºæ˜¯è°ƒç”¨ brk() ç³»ç»Ÿè°ƒç”¨æ¥è¯·æ±‚æ‰©å¤§å…¶å †ï¼ˆHeapï¼‰çš„è¾¹ç•Œã€‚\n\næ­¤æ—¶ï¼Œè™šæ‹Ÿå †å¤§å°ä¸º 8KBï¼Œç‰©ç†å†…å­˜å ç”¨ï¼ˆRss - Resident Set Sizeï¼‰ä¹Ÿæ˜¯ 8KBã€‚\n\n\nå†…æ ¸å“åº” brk() è¯·æ±‚ï¼Œä»…ä»…æ‰©å¤§äº†è¿›ç¨‹çš„è™šæ‹Ÿå†…å­˜åŒºåŸŸï¼ˆVMAï¼‰ã€‚æ–°çš„é¡µé¢æ­¤æ—¶å¹¶æœªæ˜ å°„åˆ°ä»»ä½•ç‰©ç†å†…å­˜ã€‚\n\nè¿›ç¨‹çš„è™šæ‹Ÿå †å¤§å°ï¼ˆSizeï¼‰å¢åŠ åˆ° 16KBï¼Œä½†å…¶ç‰©ç†å†…å­˜å ç”¨ï¼ˆRssï¼‰ä»ç„¶æ˜¯ 8KBã€‚å†…æ ¸åªæ˜¯åœ¨è¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­â€œç”»äº†ä¸€å—é¥¼â€ï¼Œä½†æ²¡æœ‰ç»™å®ƒâ€œçœŸæ­£çš„é£Ÿç‰©â€ï¼ˆç‰©ç†å†…å­˜ï¼‰ã€‚\n\n\nç¨‹åºæ‰§è¡Œä»£ç ï¼Œè¯•å›¾ç¬¬ä¸€æ¬¡è¯»å–æˆ–å†™å…¥åˆšåˆšç”³è¯·åˆ°çš„æ–°è™šæ‹Ÿå†…å­˜åœ°å€ã€‚\n\nCPUï¼ˆé€šè¿‡ MMUï¼‰åœ¨é¡µè¡¨ä¸­æŸ¥æ‰¾è¯¥è™šæ‹Ÿåœ°å€ï¼Œå‘ç°å®ƒæ²¡æœ‰ä»»ä½•å¯¹åº”çš„ç‰©ç†å†…å­˜æ˜ å°„ã€‚\nå¤„ç†å™¨è§¦å‘ä¸€ä¸ªç¼ºé¡µä¸­æ–­ï¼ˆPage Faultï¼‰ã€‚è¿™ä¸æ˜¯ä¸€ä¸ªç¨‹åºé”™è¯¯ï¼Œè€Œæ˜¯ä¸€ä¸ªç»™å†…æ ¸çš„ä¿¡å·ã€‚\n\n\nå†…æ ¸æ•è·è¿™ä¸ªä¸­æ–­ï¼Œæ„è¯†åˆ°è¿™æ˜¯ä¸€ä¸ªåˆæ³•çš„â€œæŒ‰éœ€åˆ†é¡µâ€è¯·æ±‚ã€‚\n- å®ƒä»å¯ç”¨çš„â€œfreeâ€åˆ—è¡¨ä¸­æ‰¾åˆ°ä¸€ä¸ªç©ºé—²çš„ç‰©ç†é¡µå¸§ï¼ˆPage Frameï¼‰ã€‚\n- å†…æ ¸å°†è¿™ä¸ªç‰©ç†é¡µå¸§æ˜ å°„åˆ°ç¨‹åºè¯•å›¾è®¿é—®çš„è™šæ‹Ÿåœ°å€ã€‚\n- å®ƒä¸ºæ­¤åˆ›å»ºæˆ–æ›´æ–°é¡µè¡¨é¡¹ï¼ˆPTE - Page Table Entryï¼‰ã€‚\n- çŠ¶æ€ï¼š ç‰©ç†å†…å­˜å ç”¨ï¼ˆRssï¼‰ç°åœ¨å¢åŠ åˆ° 12KBï¼ˆå‡è®¾æ–°åˆ†é…çš„é¡µæ˜¯ 4KBï¼‰ã€‚\n\n\nCopy-on-Write flashcard\n\nå¾ˆå¤šå­è¿›ç¨‹åœ¨Â fork()Â ä¹‹åç«‹åˆ»è°ƒç”¨Â exec()[åˆ›å»ºä¸€ä¸ªå¤åˆ¶çš„å­è¿›ç¨‹,å¹¶ä¸”ç”¨ä¸€ä¸ªå…¨æ–°çš„ç¨‹åº(å¯æ‰§è¡Œæ–‡ä»¶)çš„å†…å®¹è¦†ç›–å†…æ ¸æ€ä¸­çˆ¶è¿›ç¨‹çš„ä»£ç ã€æ•°æ®ã€æ ˆå’Œå †.]å› æ­¤å°†çˆ¶è¿›ç¨‹çš„åœ°å€ç©ºé—´æ•´ä¸ªå¤åˆ¶ä¸€ä»½æ˜¯æ¯”è¾ƒæµªè´¹çš„æ˜æ˜é©¬ä¸Šå°±ä¼šè¢«è¦†ç›–.\nCopy-on-Writeæœºåˆ¶å…è®¸çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹æœ€åˆä½¿ç”¨åŒä¸€ä»½ç‰©ç†é¡µæ¥è¿›è¡Œå·¥ä½œï¼Œåœ¨ä»»ä½•ä¸€ä¸ªè¿›ç¨‹éœ€è¦å†™å…¥æŸä¸ªå…±äº« frame æ—¶å†è¿›è¡Œå¤åˆ¶ã€‚\nè¿›ä¸€æ­¥åœ°ï¼ŒLinux ç­‰æ“ä½œç³»ç»Ÿæä¾›äº†Â vfork()ï¼Œè¿›ä¸€æ­¥ä¼˜åŒ–å­è¿›ç¨‹åœ¨Â fork()Â ä¹‹åç«‹åˆ»è°ƒç”¨Â exec()Â çš„æƒ…å½¢ã€‚vfork()Â å¹¶ä¸ä½¿ç”¨ copy-on-writeï¼›è°ƒç”¨Â vfork()Â ä¹‹åï¼Œçˆ¶è¿›ç¨‹ä¼šè¢«æŒ‚èµ·ï¼Œå­è¿›ç¨‹ä½¿ç”¨çˆ¶è¿›ç¨‹çš„åœ°å€ç©ºé—´ã€‚å¦‚æœå­è¿›ç¨‹æ­¤æ—¶ä¿®æ”¹åœ°å€ç©ºé—´ä¸­çš„ä»»ä½•é¡µé¢ï¼Œè¿™äº›ä¿®æ”¹å¯¹çˆ¶è¿›ç¨‹éƒ½æ˜¯å¯è§çš„ã€‚\n\n\nç½®æ¢ç­–ç•¥\nPage Replacement flashcard\n\næˆ‘ä»¬åœ¨Lazy Allocationæˆ–è€…Copy-on-Writeè®¨è®ºçš„æƒ…å†µä¸‹ï¼Œæˆ–è€…åœ¨ kernelã€I/O buffer ä¹‹ç±»çš„æƒ…å†µä¸‹,éœ€è¦ä»ç£ç›˜å°†é¡µè°ƒå…¥å†…å­˜,ä¼šéœ€è¦ç©ºé—²çš„ç‰©ç†å¸§[éœ€è¦æœ‰ä¸€ä¸ªä½ç½®].\n\nä½†æ˜¯æ²¡æœ‰ç©ºé—²çš„ç‰©ç†å¸§æ—¶åº”è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥äº¤æ¢å‡ºå»ä¸€æ•´ä¸ªè¿›ç¨‹:\n\nå°†ä¸€ä¸ªè¿›ç¨‹çš„æ‰€æœ‰é¡µéƒ½å†™å›ç£ç›˜ï¼ˆå¤‡ä»½å­˜å‚¨ï¼‰ï¼Œé‡Šæ”¾å®ƒå ç”¨çš„æ‰€æœ‰å¸§ã€‚\n\n\næ›´å¸¸è§åœ°ï¼Œæˆ‘ä»¬æ‰¾åˆ°ä¸€ä¸ªå½“å‰ä¸åœ¨ä½¿ç”¨çš„å¸§ï¼Œå¹¶é‡Šæ”¾å®ƒã€‚\nåŸºæœ¬æ­¥éª¤æ˜¯ï¼š\n\n\n\n\næ‰¾åˆ°è¿™ä¸ª victim frameï¼›\nå°†å…¶å†…å®¹å†™å›å¤‡ä»½å­˜å‚¨swap space/diskï¼›\n\nÂ dirty bit (a.k.a. modify bit)Â è¯¥ä½ä¿å­˜å¯¹åº” frame æ˜¯å¦è¢«ä¿®æ”¹è¿‡ï¼›å¦‚æœæ²¡æœ‰è¢«ä¿®æ”¹è¿‡,å°±ä¸ç”¨å†™å›\n\n\nè°ƒå…¥ Page Xï¼š å°†è¿›ç¨‹ P ç¼ºå¤±çš„ Page X ä»ç¡¬ç›˜ï¼ˆå¤‡ä»½å­˜å‚¨ï¼‰è°ƒå…¥åˆ°åˆšåˆšè…¾å‡ºçš„ç‰©ç†å¸§ F_A ä¸­ã€‚\nä¿®æ”¹é¡µè¡¨ï¼ˆå’Œ TLB ç­‰ï¼‰ä»¥è¡¨ç¤ºå®ƒä¸åœ¨å†…å­˜ä¸­äº†ã€‚\n\nå°†é¡µè¡¨ä¸­çš„æœ‰æ•ˆä½è®¾ç½®ä¸ºæ— æ•ˆ\nä»TLBä¸­åˆ é™¤å¯¹åº”æ¡ç›®\nå¦‚ä½•ç¡®å®šå“ªä¸ª frame åº”å½“ç”¨æ¥ä½œä¸º victim frame å‘¢ï¼Ÿæˆ‘ä»¬çš„æ ¸å¿ƒç›®æ ‡æ˜¯ï¼Œé™ä½ page fault çš„é¢‘ç‡ã€‚\n\n\n\n\n\n\n                  \n                  å¦‚ä½•ä»ç£ç›˜åŒ¹é…å’Œæ‰¾å›è¢«æ¢å‡ºçš„é¡µé¢ï¼Ÿ \n                  \n                \n\nè¢«æ¢å‡ºçš„é¡µé¢æ€»èƒ½è¢«ç³»ç»Ÿå‡†ç¡®æ‰¾å›ï¼Œè¿™æ˜¯å› ä¸ºé¡µè¡¨å’Œå¤‡ä»½å­˜å‚¨ï¼ˆBacking Storeï¼‰æœ‰æ˜ç¡®çš„è®°å½•æœºåˆ¶ã€‚\nå½“ä¸‹æ¬¡ CPU å†æ¬¡è¯·æ±‚è®¿é—®è¿™ä¸ªå·²è¢«æ¢å‡ºçš„é¡µé¢æ—¶ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š\n\nè§¦å‘ç¼ºé¡µä¸­æ–­ï¼ˆPage Faultï¼‰ï¼š CPU è¯·æ±‚è®¿é—® Page Xï¼ŒMMU æŸ¥é˜…è¯¥è¿›ç¨‹çš„é¡µè¡¨ã€‚é¡µè¡¨æ˜¾ç¤º X çš„ valid-invalid bit è®¾ç½®ä¸º æ— æ•ˆï¼ˆiï¼‰ï¼Œè§¦å‘ Page Faultï¼Œæ§åˆ¶æƒäº¤ç»™ OS å†…æ ¸ã€‚\nå®šä½ Page Xï¼š OS æ£€æŸ¥é¡µè¡¨ä¸­çš„å…¶ä»–ä¿¡æ¯ï¼ˆè¿™äº›ä¿¡æ¯åœ¨é¡µè¢«æ¢å‡ºæ—¶è¢«è®°å½•ï¼‰\n\né¡µè¡¨é¡¹ï¼š é¡µè¡¨é¡¹ä¸å†å­˜å‚¨å¸§å·ï¼Œè€Œæ˜¯å­˜å‚¨ä¸€ä¸ªç‰¹æ®Šæ ‡è®°ï¼Œè¯¥æ ‡è®°æŒ‡å‘ Page X åœ¨**å¤‡ä»½å­˜å‚¨ï¼ˆç£ç›˜ï¼‰**ä¸Šçš„ç¡®åˆ‡ä½ç½®ï¼ˆä¾‹å¦‚ï¼Œäº¤æ¢ç©ºé—´ä¸­çš„å—åœ°å€ï¼‰ã€‚\n\n\nè°ƒé¡µï¼ˆPagingï¼‰ï¼š\n\nOS æ‰§è¡Œé¡µé¢ç½®æ¢æµç¨‹ï¼ˆæ‰¾åˆ° Victim Frameï¼‰ã€‚\nOS ä»å¤‡ä»½å­˜å‚¨ä¸­ï¼Œæ ¹æ®ç¬¬ 2 æ­¥è®°å½•çš„åœ°å€ï¼Œå°† Page X è°ƒå…¥åˆ°è¿™ä¸ª Victim Frame ä¸­ã€‚\n\n\næ›´æ–°é¡µè¡¨ï¼š Page X è¢«è°ƒå…¥åï¼ŒOS æ›´æ–°é¡µè¡¨ï¼Œå°†è¯¥é¡µçš„ valid-invalid bit è®¾ç½®ä¸ºæœ‰æ•ˆï¼ˆvï¼‰ï¼Œå¹¶è®°å½•å®ƒç°åœ¨æ‰€å¤„çš„ç‰©ç†å¸§å·ã€‚\næŒ‡ä»¤é‡æ‰§è¡Œï¼š OS å°†æ§åˆ¶æƒäº¤è¿˜ç»™ CPUï¼Œè®© CPU é‡æ–°æ‰§è¡Œè¢«ä¸­æ–­çš„é‚£æ¡æŒ‡ä»¤ã€‚\n\n\n\né¡µé¢ç½®æ¢ç®—æ³• (page replacement algorithms) flashcard\nOptimal\nè¿™ç§ç®—æ³•é€‰æ‹©Â æœ€é•¿æ—¶é—´å†…ä¸å†è¢«è®¿é—®çš„é¡µé¢Â æ¢å‡ºã€‚å®¹æ˜“è¯æ˜ï¼Œè¿™ç§æ–¹æ¡ˆçš„ page-fault rate æ˜¯æœ€ä½çš„ã€‚ä¸è¿‡ï¼Œç”±äºå®é™…å®ç°ä¸­æˆ‘ä»¬æ²¡æœ‰åŠæ³•é¢„æµ‹ç»“æœï¼Œå› æ­¤å®ƒåªä½œä¸ºç†è®ºæœ€ä¼˜è§£ç”¨æ¥åˆ¤å®šå…¶ä»–ç®—æ³•çš„ä¼˜åŠ£ã€‚\nFIFO (First In First Out)\nè¿™ç§ç®—æ³•æ¢å‡ºÂ æœ€å…ˆè¿›å…¥å†…å­˜çš„é¡µé¢ã€‚å®ç°æ¯”è¾ƒç®€å•ï¼Œä½¿ç”¨ä¸€ä¸ªé˜Ÿåˆ—ä¿å­˜è°ƒå…¥å†…å­˜çš„é¡ºåºå³å¯ã€‚\nè¿™ç§ç®—æ³•çš„é—®é¢˜æ˜¯ï¼Œå…¶é€»è¾‘å’Œå®é™…ä¸ç¬¦ï¼›å®é™…æƒ…å†µä¸‹æœ‰å¾ˆå¤šé¡µé¢ä¼šç»å¸¸è¢«è®¿é—®ã€‚\nå¦å¤–ï¼Œè¿™ç§ç®—æ³•å¯èƒ½ä¼šé‡åˆ°ç‰©ç†å¸§å¢åŠ çš„æ—¶å€™ page-fault åè€Œæ›´å¤šçš„å¼‚å¸¸æƒ…å†µã€‚è¿™è¢«ç§°ä¸ºÂ Beladyâ€™s Anomalyï¼š\n\n123412512345æ˜¯ä¸€æ¬¡è¯·æ±‚è®¿é—®çš„é¡µé¢å·\n\nä¸ŠåŠéƒ¨åˆ†:é™åˆ¶è¿›ç¨‹åªèƒ½ä½¿ç”¨ 3 ä¸ªå¸§ã€‚\n\nå…³é”®é¡µ A å¯èƒ½ä¼šåœ¨å®ƒå†æ¬¡è¢«è®¿é—®ä¹‹å‰å°±è¢«æ·˜æ±°äº†ï¼ˆFIFO é€»è¾‘ï¼‰ã€‚\n\n\nä¸‹åŠéƒ¨åˆ†:é™åˆ¶è¿›ç¨‹å¯ä»¥ä½¿ç”¨ 4 ä¸ªå¸§ã€‚\n\nç”±äºå†…å­˜å˜å¤§ï¼Œå…³é”®é¡µ A é©»ç•™çš„æ—¶é—´å˜é•¿äº†ã€‚ä½†ä¸æ­¤åŒæ—¶ï¼Œå®ƒå ç”¨çš„ä½ç½®å¯èƒ½ä¼šå¯¼è‡´å¦ä¸€ä¸ªå¾ˆå¿«å°±è¦è¢«ç”¨åˆ°çš„æ›´å…³é”®çš„é¡µ B è¢«æå‰æ·˜æ±°ï¼Œä»è€Œå¯¼è‡´æ€»ä½“ç¼ºé¡µæ¬¡æ•°å¢åŠ \n\n\n\n\n\n\nLRU (Least Recently Used)\n\nå®ç°çš„ä¸€ç§ç­–ç•¥æ˜¯ç»™æ¯ä¸ªé¡µè¡¨é¡¹ä¸€ä¸ª counterï¼Œæ¯æ¬¡è®¿é—®æŸä¸ª page æ—¶ï¼Œå°† counter æ›´æ–°ä¸ºå½“å‰çš„æ—¶é—´[åªè¦è¢«ç”¨äº†,å°±ä¼šå¾€åè°ƒ,ä»æ·˜æ±°æœ€æ—©å˜æˆäº†æ·˜æ±°é—´éš”æœ€é•¿]\n\næ¯æ¬¡éœ€è¦ç½®æ¢æ—¶ï¼Œæœç´¢ counter æœ€å°çš„é¡µã€‚ä¹Ÿå¯ä»¥ç”¨ heap æ¥ä¼˜åŒ–ã€‚\n\n\nå¦ä¸€ç§ç­–ç•¥æ˜¯ç”¨ä¸€ä¸ªæ ˆä¿å­˜ page numbersï¼Œæ¯æ¬¡è®¿é—®æ—¶æ‰¾åˆ°å®ƒç„¶åæŠŠå®ƒæŒªåˆ°æ ˆé¡¶ã€‚\nè¿™ä¸¤ç§å®ç°å¼€é”€éƒ½æ¯”è¾ƒå¤§ã€‚\n\nLRU-Approximation\n\nå› æ­¤ï¼Œæˆ‘ä»¬åœ¨ LRU å’Œæ€§èƒ½ä¹‹é—´åšä¸€ä¸ªæŠ˜ä¸­ï¼›å¼•å…¥ä¸€ä¸ªÂ reference bitï¼Œæ¥è¿‘ä¼¼åœ°å®ç° LRUã€‚å½“ä¸€ä¸ª page è¢«è®¿é—®æ—¶è¿™ä¸ª bit è¢«ç½®ä¸º 1ï¼›æ“ä½œç³»ç»Ÿå®šæœŸå°† reference bit æ¸…é›¶ã€‚å› æ­¤ï¼Œåœ¨éœ€è¦äº¤æ¢æ—¶ï¼Œåªéœ€è¦æ‰¾ä¸€ä¸ª reference bit ä¸º 0 çš„å°±å¯ä»¥è¯´æ˜å®ƒåœ¨è¿™æ®µæ—¶é—´å†…æ²¡æœ‰è¢«è®¿é—®è¿‡ã€‚\næˆ–è€…åŠ ä¸Šä¼˜å…ˆçº§bit\nåŠ ä¸Šcounting bit è®°å½•è¢«è®¿é—®çš„æ¬¡æ•°\n\n\nè¿›é˜¶ç­–ç•¥\nAllocation of Frames\nä¸ºä»€ä¹ˆè¦åˆ†é…frame\n\n\né‡‡å–Â å…¨å±€ç½®æ¢ (global replacement)\n\nå½“è¿›ç¨‹ A å‘ç”Ÿç¼ºé¡µä¸­æ–­éœ€è¦ä¸€ä¸ªæ–°çš„å¸§æ—¶ï¼Œæ“ä½œç³»ç»Ÿå¯ä»¥ä»æ‰€æœ‰ç‰©ç†å¸§ä¸­ï¼ˆå³ç³»ç»Ÿä¸­æ‰€æœ‰è¿›ç¨‹ P1, P2, P3â€¦ å ç”¨çš„å¸§ï¼‰ä¸­é€‰å–ä¸€ä¸ª Victim Frame[çµæ´»:æ›´å¥½çš„ç³»ç»Ÿååé‡ä½†æ˜¯ä¸éš”ç¦»:è‡ªå·±çš„pagefaultç‡ä¼šå–å†³äºå…¶ä»–è¿›ç¨‹çš„è¿è¡ŒçŠ¶å†µ]\né‚£ä¹ˆæˆ‘ä»¬å°±ä¸ä¸€å®šæœ‰å¿…è¦æå‰è§„å®šæ¯ä¸ªè¿›ç¨‹æœ€å¤šèƒ½å¤Ÿä½¿ç”¨å¤šå°‘ä¸ª frameï¼›\n\n\n\né‡‡å–Â å±€éƒ¨æ›¿æ¢ (local replacement)[éš”ç¦»ä½†åƒµåŒ–]\n\nåªåœ¨å½“å‰è¿›ç¨‹åˆ†é…åˆ°çš„ç‰©ç†å¸§ä¸­è¿›è¡Œæ›¿æ¢\né‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦æå‰æŠŠç‰©ç† frame çš„èµ„æºåˆ†é…ç»™å„ä¸ªè¿›ç¨‹[è¦åˆ’åˆ†å¥½åŒºé—´ä¸ç„¶å°±è·Ÿå…¨å±€ç½®æ¢ä¸€æ ·äº†]ã€‚\n\n\n\nå½“æˆ‘ä»¬éœ€è¦å†³å®šä¸€ä¸ªè¿›ç¨‹èƒ½å¤Ÿä½¿ç”¨çš„é¡µé¢æ€»æ•°æ—¶ï¼Œæˆ‘ä»¬åœ¨ä¸Šè¿°æœ€å°å’Œæœ€å¤§çš„åŒºé—´å†…æœ‰éå¸¸å¤šçš„é€‰æ‹©ï¼Œè¿™å°±å¼•å…¥äº†åˆ†é…ç®—æ³•ã€‚å¸¸è§çš„åˆ†é…ç®—æ³•åŒ…æ‹¬å¹³å‡åˆ†é…ï¼Œæˆ–è€…æŒ‰è¿›ç¨‹å¯¹å†…å­˜çš„å®é™…éœ€æ±‚æŒ‰æ¯”ä¾‹åˆ†é…ï¼›ä¹Ÿå¯ä»¥å‚è€ƒè¿›ç¨‹çš„ä¼˜å…ˆçº§ï¼Œé«˜ä¼˜å…ˆçº§ç›¸å¯¹åˆ†é…åˆ°çš„æ›´å¤šï¼Œæˆ–è€…æ›´èƒ½æ»¡è¶³å…¶å®é™…éœ€æ±‚ã€‚\n\n\nç°åœ¨çš„å¾ˆå¤šè®¡ç®—æœºéƒ½æœ‰å¤šä¸ª CPUï¼Œè€Œæ¯ä¸ª CPU éƒ½å¯ä»¥æ¯”å…¶ä»– CPU æ›´å¿«åœ°è®¿é—®å†…å­˜çš„æŸäº›éƒ¨åˆ†ã€‚å¦‚æœè¿™ç§å·®å¼‚æ¯”è¾ƒæ˜æ˜¾ï¼Œæˆ‘ä»¬ç§°è¿™ç§ç³»ç»Ÿä¸ºÂ éå‡åŒ€å†…å­˜è®¿é—® (NUMA, Non-Uniform Memory Access)Â ç³»ç»Ÿã€‚åœ¨è¿™ç§ç³»ç»Ÿä¸‹ï¼Œä¸ºäº†æ›´å¥½çš„æ€§èƒ½è¡¨ç°ï¼Œå‰è¿°çš„åˆ†é…å’Œè°ƒé¡µç®—æ³•å¯èƒ½æ›´åŠ å¤æ‚ã€‚\n\n\nåˆ†é…å¤šå°‘ä¸ª Frames\nç»™æ¯ä¸ªè¿›ç¨‹åˆ†é…å¤šå°‘ä¸ª frame å‘¢ï¼Ÿ\n\næœ€å¤§å€¼ä¸å¯èƒ½è¶…è¿‡ç‰©ç†å†…å­˜åŒ…å«çš„ frame æ€»æ•°\næœ€å°å€¼æ˜¯ç”±å…·ä½“çš„è®¡ç®—æœºæ¶æ„å†³å®šçš„ã€‚[ä½œç³»ç»Ÿåªéœ€è¦ç¡®ä¿åœ¨æ‰§è¡Œä»»æ„ä¸€æ¡æŒ‡ä»¤æ—¶ï¼Œè¯¥è¿›ç¨‹æ‹¥æœ‰è¶³å¤Ÿçš„å¸§æ¥å®¹çº³è¯¥æŒ‡ä»¤æ¶‰åŠçš„æ‰€æœ‰é¡µã€‚å› æ­¤æœ€å°å€¼æ˜¯æœ€å¤æ‚çš„é‚£æ¡æŒ‡ä»¤çš„å¸§]\n\næŒ‡ä»¤åœ¨è§£å†³å…¶æ¶‰åŠçš„å…¨éƒ¨ page fault ä¹‹åæ‰èƒ½çœŸæ­£è¢«è¿è¡Œ[æŒ‡ä»¤æ˜¯åŸå­æ“ä½œ,å¦‚æœå‘ç”Ÿpagefault,cpuä¼šæš‚åœå½“å‰æŒ‡ä»¤å¹¶è¿›è¡Œä¸­æ–­å¤„ç†]\nå› æ­¤æ¯ä¸ªè¿›ç¨‹åˆ†é…çš„ frame çš„æœ€å°å€¼ä¸åº”å°äºå•ä¸ªæŒ‡ä»¤å¯èƒ½ä½¿ç”¨åˆ°çš„ frame æ€»æ•°[å…è®¸æŒ‡ä»¤è¿è¡Œ,æ˜¯æœ€ä½è¦æ±‚,è¿˜ä¼šæœ‰å…¶ä»–å¸§æ¥å­˜å‚¨æ•´ä¸ªè¿›ç¨‹çš„ä»£ç \\å…¨å±€å˜é‡\\å †\\æ ˆç­‰ç­‰]ã€‚ä¸€èˆ¬æƒ…å†µå¦‚ä¸‹\n\næŒ‡ä»¤æœ¬èº«:1ä¸ªpage[æŒ‡ä»¤ä¼šè¿›è¡Œå¯¹é½]\nä¸¤ä¸ªè®¿é—®å†…å­˜çš„æ“ä½œæ•°ï¼Œå…¶ä¸­æ¯ä¸ªæ“ä½œæ•°è®¿é—®çš„å†…å­˜[å¯èƒ½]è·¨è¶Š 2 ä¸ª pageï¼ˆå³ï¼Œè¿™å—æ•°æ®åœ¨ä¸€ä¸ª page çš„æœ«å°¾å’Œä¸‹ä¸€ä¸ª page çš„å¼€å¤´ï¼‰\né‚£ä¹ˆè¿™ä¸ªæ¶æ„ä¸Šè¿è¡Œçš„è¿›ç¨‹çš„ minimum frame number æ˜¯ 5ã€‚\n\n\n\n\n\nThrashing  flashcard\n\nå¦‚æœä¸€ä¸ªè¿›ç¨‹å¯ç”¨çš„å¸§æ•°é‡æ¯”è¾ƒå°‘ï¼ˆå°‘äºå…¶é¢‘ç¹è®¿é—®çš„é¡µé¢æ•°ç›®ï¼‰ï¼Œé‚£ä¹ˆå®ƒä¼šé¢‘ç¹å‡ºç° page faultï¼›åŒä¸€ä¸ª page å¯èƒ½ä¼šè¢«é¢‘ç¹åœ°æ¢å…¥æ¢å‡ºï¼Œä»¥æ»¡è¶³è¿è¡Œçš„è¦æ±‚ã€‚è¿™ç§é«˜åº¦çš„é¡µé¢è°ƒåº¦æ´»åŠ¨æˆä¸ºç§°ä¸ºÂ æŠ–åŠ¨ (thrashing)ï¼›å…¶è°ƒé¡µæ—¶é—´ç”šè‡³ä¼šå¤§äºæ‰§è¡Œæ—¶é—´ã€‚\nå·¥ä½œé›†æ¨¡å‹ (working set model)Â ç”¨æ¥ç¡®å®šä¸€ä¸ªè¿›ç¨‹é¢‘ç¹è®¿é—®çš„é¡µé¢ï¼Œä¿è¯è¿™äº›é¡µé¢ä¸è¢«æ¢å‡ºï¼›éœ€è¦è°ƒé¡µæ—¶ä»å‰©ä½™çš„é¡µé¢è¿›è¡Œäº¤æ¢ã€‚å¦‚æœé¢‘ç¹è®¿é—®çš„é¡µé¢æ•°å·²ç»å¤§äºäº†å½“å‰è¿›ç¨‹å¯ç”¨çš„é¡µé¢æ•°ï¼Œæ“ä½œç³»ç»Ÿå°±åº”å½“æŠŠæ•´ä¸ªè¿›ç¨‹æ¢å‡ºï¼Œä»¥é˜²æ­¢å‡ºç°æŠ–åŠ¨ç°è±¡ã€‚\n\n\nKernel Memory Allocation\n\nKernel ä¸­çš„å¾ˆå¤šæ•°æ®ç»“æ„å¤§å°åŒºåˆ†æ¯”è¾ƒå¤§ï¼Œå…¶ä¸­å¾ˆå¤šå°äºç”šè‡³è¿œå°äºä¸€ä¸ª page.å› æ­¤ï¼Œkernel çš„è®¾è®¡åº”å½“å°½å¯èƒ½èŠ‚çœå†…å­˜ï¼ŒåŠªåŠ›å‡å°‘ç¢ç‰‡ã€‚\nå°½å¯èƒ½å‡å° kernel å†…å­˜å¼€é”€çš„è€ƒè™‘æ˜¯ï¼š\n\nä¸€æ–¹é¢ï¼Œkernel æœ‰å¯èƒ½æœ‰ä¸€éƒ¨åˆ†å¸¸é©»åœ¨ç‰©ç†å†…å­˜ä¸­ï¼Œä¸å—è°ƒé¡µç³»ç»Ÿçš„æ§åˆ¶\nå¦ä¸€æ–¹é¢ï¼Œæœ‰çš„ç¡¬ä»¶è®¾å¤‡å¯èƒ½å’Œç‰©ç†å†…å­˜ç›´æ¥äº¤äº’ï¼Œå› æ­¤å¯èƒ½ä¼šéœ€è¦è¿ç»­çš„ç‰©ç†å†…å­˜ã€‚\nè¿™ä¸¤è€…å¯¹ç‰©ç†å†…å­˜çš„è¦æ±‚éƒ½æ¯”è¾ƒä¸¥æ ¼ï¼Œå› æ­¤æˆ‘ä»¬åº”å½“å°½å¯èƒ½å‡å°è¿™äº›å¼€é”€ã€‚\n\n\n\nBuddy System flashcard\n\nBuddy system ä»ç‰©ç†è¿ç»­çš„æ®µä¸Šåˆ†é…å†…å­˜ï¼›æ¯æ¬¡åˆ†é…å†…å­˜å¤§å°æ˜¯ 2 çš„å¹‚æ¬¡æ–¹ï¼Œä¾‹å¦‚è¯·æ±‚æ˜¯ 11KBï¼Œåˆ™åˆ†é… 16KBã€‚\nå½“åˆ†é…æ—¶ï¼Œä»ç‰©ç†æ®µä¸Šåˆ‡åˆ†å‡ºå¯¹åº”çš„å¤§å°ï¼Œä¾‹å¦‚ä¸‹å›¾ä½“ç°äº†åˆ†é… 21KB æ—¶çš„æƒ…å†µï¼ŒÂ ä¼šè¢«åˆ†é…ã€‚\nå½“å®ƒè¢«é‡Šæ”¾æ—¶ï¼Œä¼šÂ åˆå¹¶ (coalesce)Â ç›¸é‚»çš„å—å½¢æˆæ›´å¤§çš„å—ä¾›ä¹‹åä½¿ç”¨ã€‚\n\n\nSlab Allocation flashcard\næ ¸å¿ƒçš„åŸç†æ˜¯ï¼Œæ“ä½œç³»ç»Ÿä¸­å¾ˆå¤š object çš„å¤§å°æ˜¯å·²çŸ¥ä¸”å›ºå®šçš„[PCB/socket buffers/PTEä¹‹ç±»çš„]ã€‚å†…å­˜è¢«åˆ’åˆ†æˆè‹¥å¹²ä¸ªå›ºå®šå¤§å°çš„å—ï¼Œæ¯ä¸ªå—éƒ½è¢«åˆ†é…ç»™ä¸€ä¸ªå…·ä½“çš„ç±»å‹ã€‚å½“è¿›ç¨‹éœ€è¦åˆ†é…å†…å­˜æ—¶ï¼Œå®ƒä¼šæŸ¥è¯¢ç¼“å­˜ï¼Œå¦‚æœæ‰¾åˆ°ä¸€ä¸ªç©ºé—²çš„å—ï¼Œå°±ç›´æ¥ä½¿ç”¨è¯¥å—ï¼›å¦‚æœç¼“å­˜ä¸­æ²¡æœ‰ç©ºé—²çš„å—ï¼Œå°±ä¼šä»ç³»ç»Ÿå†…å­˜ä¸­ç”³è¯·ä¸€ä¸ªæ–°çš„å—ï¼š\n"},"è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/06.1-æ–‡ä»¶ç³»ç»Ÿ":{"slug":"è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/06.1-æ–‡ä»¶ç³»ç»Ÿ","filePath":"è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/06.1 æ–‡ä»¶ç³»ç»Ÿ.md","title":"06.1 æ–‡ä»¶ç³»ç»Ÿ","links":[],"tags":[],"content":"åœ¨å­˜å‚¨ç®¡ç†ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºäº†å¤§å®¹é‡å­˜å‚¨å’Œ I/Oï¼›è¿™ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºå¦‚ä½•ä½¿ç”¨è¿™äº›å­˜å‚¨ã€‚\nåœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬ä¸»è¦è®¨è®ºæ–‡ä»¶ç³»ç»Ÿæä¾›çš„åŠŸèƒ½ï¼›åœ¨ä¸‹ä¸€ç« ä¸­ï¼Œæˆ‘ä»¬å…·ä½“è®¨è®ºæ–‡ä»¶ç³»ç»Ÿçš„å®ç°ã€‚\næ–‡ä»¶ç³»ç»Ÿ (file system)Â æä¾›äº† disk çš„æŠ½è±¡ï¼Œç»™ç”¨æˆ·æä¾›å­˜å‚¨çš„é€»è¾‘è§†å›¾ã€‚æ–‡ä»¶ç³»ç»Ÿç”±ä¸¤ä¸ªéƒ¨åˆ†ç»„æˆï¼š\n\næ–‡ä»¶ (file)Â çš„é›†åˆï¼Œæ¯ä¸ªæ–‡ä»¶å­˜å‚¨ä¸€äº›æ•°æ®ï¼Œæ˜¯å­˜å‚¨çš„é€»è¾‘å•ä½ï¼›\nä»¥åŠÂ ç›®å½•ç»“æ„ (directory structure)ï¼Œç”¨äºç»„ç»‡ç³»ç»Ÿå†…çš„æ–‡ä»¶å¹¶æä¾›ç›¸å…³ä¿¡æ¯ï¼Œä¾‹å¦‚æä¾›æƒé™ä¿¡æ¯ä»¥å®ç°ä¸€äº›ä¿æŠ¤ã€‚\n\nFiles | æ–‡ä»¶\næ–‡ä»¶ç”±æ“ä½œç³»ç»Ÿæ˜ å°„åˆ°ç‰©ç†å­˜å‚¨è®¾å¤‡ä¸Šï¼›åœ¨ Unix ä¸­å°±æ˜¯ä¸€å—è¿ç»­çš„å­—èŠ‚ã€‚ç”±äºå‰è¿°å­˜å‚¨è®¾å¤‡é€šå¸¸æ˜¯éæ˜“å¤±æ€§çš„ï¼Œå› æ­¤æ–‡ä»¶å†…å®¹åœ¨æ–­ç”µåä¹Ÿèƒ½ä¿æŒã€‚\næ–‡ä»¶æ˜¯ç”¨æˆ·å’Œç¨‹åºç”¨æ¥å­˜å‚¨å’Œè·å–ä¿¡æ¯çš„é€”å¾„ã€‚ä»ç”¨æˆ·è§’åº¦æ¥çœ‹ï¼Œæ–‡ä»¶æ˜¯é€»è¾‘å¤–å­˜çš„æœ€å°åˆ†é…å•å…ƒï¼›ä¹Ÿå°±æ˜¯è¯´ï¼Œæ•°æ®åªæœ‰é€šè¿‡æ–‡ä»¶æ‰èƒ½å†™åˆ°å¤–å­˜ã€‚\næ–‡ä»¶æœ‰ä¸åŒçš„ç±»å‹ï¼Œä¾‹å¦‚æ•°æ®æ–‡ä»¶ã€å¯æ‰§è¡Œæ–‡ä»¶ç­‰ã€‚æ•°æ®æ–‡ä»¶åˆå¯èƒ½æ˜¯ numeric, alphabetic, alphanumeric, binary çš„ã€‚\næ–‡ä»¶å±æ€§\nä¸åŒçš„æ“ä½œç³»ç»Ÿå¯èƒ½ä¼šä¿å­˜ä¸åŒçš„æ–‡ä»¶å±æ€§ (attributes)ï¼Œä½†æ˜¯é€šå¸¸åŒ…æ‹¬ï¼š\n\nNameã€‚è¿™æ˜¯å”¯ä¸€çš„ä»¥ human-readable å½¢å¼ä¿å­˜çš„ä¿¡æ¯ã€‚\nIdentifierã€‚ä¸€ä¸ªåœ¨å½“å‰æ–‡ä»¶ç³»ç»Ÿä¸­å”¯ä¸€çš„ tagï¼ˆé€šå¸¸ä¸º numberï¼‰æ–‡ä»¶ç³»ç»Ÿç”¨å®ƒæ¥æ ‡è¯†æ–‡ä»¶ã€‚\nTypeã€‚ä¸€äº›æ–‡ä»¶ç³»ç»Ÿæ”¯æŒä¸åŒçš„æ–‡ä»¶ç±»å‹ã€‚\nLocationã€‚æ ‡è¯†æ–‡ä»¶åœ¨å“ªä¸ªè®¾å¤‡çš„å“ªä¸ªä½ç½®ã€‚\nSizeã€‚å½“å‰æ–‡ä»¶å¤§å°ï¼Œä¹Ÿå¯èƒ½åŒ…å«æ–‡ä»¶å…è®¸çš„æœ€å¤§å¤§å°ã€‚\nProtectionã€‚Access-control informationã€‚\nTimestampã€‚ä¿å­˜åˆ›å»ºæ—¶é—´ã€ä¸Šæ¬¡ä¿®æ”¹æ—¶é—´ã€ä¸Šæ¬¡ä½¿ç”¨æ—¶é—´ç­‰ã€‚\nUser identificationã€‚åˆ›å»ºè€…ã€ä¸Šæ¬¡ä¿®æ”¹è€…ã€ä¸Šæ¬¡è®¿é—®è€…ç­‰ã€‚\nä¸€äº›æ–‡ä»¶ç³»ç»Ÿè¿˜æ”¯æŒÂ extended file attributeï¼Œä¾‹å¦‚ file checksumã€‚\nè¿™äº›ä¿¡æ¯æ˜¯å‰è¿° ç›®å½•ç»“æ„ (directory structure) çš„ä¸€éƒ¨åˆ†ã€‚\n\næ–‡ä»¶æ“ä½œ\næ“ä½œç³»ç»Ÿå¯ä»¥æä¾›ç›¸å…³çš„ç³»ç»Ÿè°ƒç”¨æ¥å®Œæˆä¸€äº›åŸºæœ¬çš„æ–‡ä»¶æ“ä½œï¼Œä¾‹å¦‚ï¼š\n\nCreateã€‚åœ¨ FS ä¸­ä¸ºæ–‡ä»¶æ‰¾åˆ°ç©ºé—´ï¼Œç„¶ååœ¨ directory ä¸­åˆ›å»ºæ¡ç›®ã€‚\nRead / Writeã€‚ç»´æŠ¤ä¸€ä¸ªÂ current-file-position pointerÂ è¡¨ç¤ºå½“å‰è¯»å†™çš„ä½ç½®ï¼Œåœ¨å¯¹åº”ä½ç½®ä¸Šåšè¯»å†™æ“ä½œï¼ˆä»ç£ç›˜è¯»åˆ°å†…å­˜æˆ–è€…ç›¸åï¼‰\nRepositioning within a file (a.k.a. Seek)ã€‚å°† current-file-position pointer çš„ä½ç½®é‡æ–°å®šä½åˆ°ç»™å®šå€¼ï¼Œä¾‹å¦‚æ–‡ä»¶å¼€å¤´æˆ–ç»“å°¾ã€‚\nDeleteã€‚åœ¨ directory ä¸­æ‰¾åˆ°å¯¹åº”æ¡ç›®ï¼Œé‡Šæ”¾æ–‡ä»¶ç©ºé—´ï¼Œåˆ é™¤å¯¹åº”æ¡ç›®ã€‚\nTruncateã€‚æ¸…ç©ºæ–‡ä»¶å†…å®¹ï¼Œä½†ä¿ç•™æ–‡ä»¶å±æ€§ã€‚\n\næ–‡ä»¶æ‰“å¼€\nOpenã€‚è¿”å›ä¸€ä¸ª handler ç”¨æ¥æ‰§è¡Œå…¶ä»–æ“ä½œã€‚\nå¯èƒ½ä¼šæŠŠæ–‡ä»¶æ”¾åœ¨Â æ‰“å¼€æ–‡ä»¶è¡¨ (open-file table)Â ä¸­ä»¥ä¾¿ç´¢å¼•ï¼Œç›´åˆ°Â Close\nå¯èƒ½å…è®¸ä¸€ä¸ªæ–‡ä»¶è¢«æ‰“å¼€å¤šæ¬¡ï¼Œå› æ­¤åœ¨æ‰“å¼€æ–‡ä»¶è¡¨ä¸­å¯ä»¥ç»´æŠ¤ä¸€ä¸ªÂ file-open count\næ–‡ä»¶é”\nä¸€äº› FS ä¹Ÿä¼šæä¾›Â æ–‡ä»¶é” (file lock)Â æ¥åè°ƒæ–‡ä»¶è®¿é—®ï¼Œä¾‹å¦‚å…è®¸ä¸€ä¸ªè¿›ç¨‹é”å®šæ–‡ä»¶æ¥é¿å…å…¶ä»–æ–‡ä»¶è®¿é—®å®ƒã€‚\n\næ–‡ä»¶é”ç±»ä¼¼äºç¬¬ 7 èŠ‚ä¸­è®¨è®ºçš„ reader-writer lockã€‚æœ‰çš„ FS æä¾›ä¸¤ç§é”ï¼š\n\nå…±äº«é” (shared lock)Â ç±»ä¼¼äº reader lock\nç‹¬å é” (exclusive lock)Â ç±»ä¼¼äº writer lockã€‚æœ‰çš„ FS åªæä¾›ç‹¬å é”ã€‚\n\n\nåŒæ—¶ï¼Œæ–‡ä»¶é”ä¹Ÿæœ‰ä¸¤ç§å¯èƒ½çš„æœºåˆ¶ï¼Œç”±æ“ä½œç³»ç»Ÿå†³å®šã€‚\n\nÂ å¼ºåˆ¶é”å®š (mandatory lock)ï¼Œå³ä¸€æ—¦è¿›ç¨‹è·å–äº†ç‹¬å é”ï¼Œæ“ä½œç³»ç»Ÿå°±é˜»æ­¢ä»»ä½•å…¶ä»–è¿›ç¨‹è®¿é—®å¯¹åº”æ–‡ä»¶ï¼Œå³æ“ä½œç³»ç»Ÿæœ¬èº«ç¡®ä¿äº†å®Œæ•´æ€§ï¼›\nå»ºè®®é”å®š (advisory lock)ï¼Œå³è¿›ç¨‹å¯ä»¥è‡ªå·±å¾—çŸ¥é”çš„çŠ¶æ€ç„¶åå†³å®šè¦ä¸è¦åšæŒè®¿é—®ã€‚Windows ä½¿ç”¨å‰è€…ï¼Œè€Œ UNIX ä½¿ç”¨åè€…ã€‚\n\n\nä¹Ÿåº”å½“é‡‡å–æªæ–½ï¼Œæ¥ç¡®ä¿ä¸ä¼šå‡ºç°æ­»é”ã€‚\n\næ–‡ä»¶ç±»å‹\næ–‡ä»¶æœ‰ä¸åŒçš„ç±»å‹ã€‚æ“ä½œç³»ç»Ÿå¯ä»¥é€‰æ‹©æ˜¯å¦éœ€è¦è¯†åˆ«ä¸åŒçš„æ–‡ä»¶ç±»å‹ã€‚\n\nè¯†åˆ«ä¸åŒæ–‡ä»¶ç±»å‹çš„æ–¹å¼ä¹‹ä¸€æ˜¯Â æ–‡ä»¶æ‰©å±•å (file extension)ï¼›ä¾‹å¦‚è§„å®šåªæœ‰æ‰©å±•åæ˜¯Â .com,Â .exe,Â .shÂ çš„æ–‡ä»¶æ‰èƒ½æ‰§è¡Œã€‚\nå¦å¤–ï¼Œä¹Ÿå¯ä»¥é€šè¿‡åœ¨æ–‡ä»¶å¼€å§‹éƒ¨åˆ†æ”¾ä¸€äº› magic number æ¥è¡¨æ˜æ–‡ä»¶ç±»å‹ï¼›ä½†æ˜¯ç”±äºä¸æ˜¯æ‰€æœ‰æ–‡ä»¶éƒ½æœ‰ magic numberï¼Œå› æ­¤ç³»ç»Ÿä¸èƒ½åªåŸºäºè¿™ç§æ–¹å¼åˆ¤æ–­æ–‡ä»¶çš„ç±»å‹ã€‚\nä¹Ÿå¯ä»¥é‡‡ç”¨çš„ä¸€ç§æ–¹å¼æ˜¯ï¼Œæ“ä½œç³»ç»Ÿä¸è¯•å›¾è¯†åˆ«æ–‡ä»¶çš„ç±»å‹ï¼›å½“ç”¨æˆ·å°è¯•è¿è¡Œä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œæˆ–è€…è¯•å›¾ç”¨æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶æ—¶ï¼Œä¼šç…§å¸¸æŒ‰ç…§é¢„æœŸçš„ç¼–ç æ–¹å¼è§£æï¼›ä½†æ“ä½œç³»ç»Ÿä»¥åŠæ‰“å¼€è¿™ä¸ªæ–‡ä»¶çš„åº”ç”¨ç¨‹åºæœ¬èº«çš„å®‰å…¨è®¾è®¡ä½¿å¾—è¿™æ ·çš„æ“ä½œä¸ä¼šå¸¦æ¥å¤ªåçš„åæœã€‚\nUNIX å…è®¸æ–‡ä»¶æ‰©å±•åçš„æç¤ºï¼Œä½†æ˜¯æ‰©å±•åä¸»è¦æ˜¯å¸®åŠ©ç”¨æˆ·æ¥ç¡®å®šå†…å®¹ç±»å‹ï¼›æ“ä½œç³»ç»Ÿæœ¬èº«å¹¶ä¸å¼ºåˆ¶æ–‡ä»¶æ‰©å±•åï¼Œä¹Ÿå¹¶ä¸ä¾èµ–è¿™äº›æ‰©å±•åã€‚åº”ç”¨ç¨‹åºçš„å¼€å‘è€…å¯ä»¥é€‰æ‹©æ˜¯å¦å¿½ç•¥æ–‡ä»¶æ‰©å±•åã€‚\n\næ–‡ä»¶ç»“æ„\næ–‡ä»¶å¯ä»¥æœ‰ä¸åŒçš„ç»“æ„ï¼Œç”±æ“ä½œç³»ç»Ÿæˆ–è€…ç”¨æˆ·ç¨‹åºå®šä¹‰ã€‚\n\næœ€ç®€å•çš„æ˜¯Â æ— ç»“æ„ (no structure)Â æ–‡ä»¶ï¼Œå®ƒåªæ˜¯ a stream of bytes or wordsã€‚ä¾‹å¦‚ UNIX operating system defines all files to be simply streams of bytesã€‚\nå¦å¤–ä¹Ÿæœ‰Â simple record structureÂ æ–‡ä»¶ï¼Œä»¥ record ä¸ºå•ä½ï¼Œæ¯ä¸ª record å¯ä»¥æ˜¯å®šé•¿æˆ–è€…å˜é•¿çš„ï¼Œä¾‹å¦‚æ•°æ®åº“ã€‚\nè¿˜æœ‰Â complex structuresÂ æ–‡ä»¶ã€‚ä¾‹å¦‚ Microsoft Word æ–‡æ¡£ã€‚\n\nAccess Methods | è®¿é—®æ–¹å¼\næˆ‘ä»¬è®¨è®ºæœ‰å“ªäº›è®¿é—®æ–‡ä»¶ä¿¡æ¯çš„æ–¹å¼ã€‚\n\næœ€ç®€å•ä¹Ÿæœ€å¸¸è§çš„è®¿é—®æ–¹å¼æ˜¯Â é¡ºåºè®¿é—® (sequential access)ã€‚å°±åƒç£å¸¦é‚£æ ·ï¼Œé€å­—èŠ‚æˆ–è€…é€ record åœ°è®¿é—®ã€‚\nå¦ä¸€ç§æ–¹æ³•æ˜¯Â ç›´æ¥è®¿é—® (direct access)Â æˆ–ç§°Â ç›¸å¯¹è®¿é—® (relative access)Â æˆ–ç§°Â éšæœºè®¿é—® (random access)ã€‚å³æ”¯æŒä»¥å‡ ä¹ç›¸åŒçš„æ—¶é—´è®¿é—®ä»»æ„ä½ç½®ã€‚\nåœ¨ç›´æ¥è®¿é—®çš„æ–¹æ³•ä¹‹ä¸Šï¼Œè¿˜æœ‰å¯èƒ½æä¾›ç´¢å¼•ï¼Œå³å…ˆåœ¨ç´¢å¼•ä¸­å¾—çŸ¥æ‰€éœ€è®¿é—®çš„å†…å®¹åœ¨å“ªé‡Œï¼Œç„¶åå»è®¿é—®ã€‚ä¹Ÿæœ‰å¯èƒ½ä½¿ç”¨å¤šå±‚ç´¢å¼•è¡¨ã€‚\nä¸ºäº†é˜²æ­¢ç´¢å¼•è¡¨è¿‡å¤§ï¼Œä¹Ÿå¯èƒ½å¼•å…¥Â ç´¢å¼•é¡ºåºè®¿é—® (Indexed Sequential-Access)ï¼Œå³åƒå­—å…¸é‚£æ ·ç¡®å®šæ‰€éœ€è®¿é—®çš„å†…å®¹åœ¨å“ªä¸€å—ï¼Œå†åœ¨å¯¹åº”å—ä¸­é¡ºåºå¯»æ‰¾ã€‚\n\nDirectory Structure | ç›®å½•ç»“æ„\nå¦‚æˆ‘ä»¬ä¹‹å‰æ‰€è¯´ï¼Œdirectory ä¸­åŒ…å«äº†æ–‡ä»¶çš„å¾ˆå¤šä¿¡æ¯ï¼›\ndirectory structure åº”å½“å®ç°æ–°å»ºã€åˆ é™¤ã€æŸ¥æ‰¾ã€éå†ã€åˆ—å‡ºç›®å½•ä¸­çš„æ–‡ä»¶ç­‰åŸºæœ¬æ“ä½œã€‚\nåŒæ—¶ï¼Œè®¾è®¡ä¹Ÿåº”å½“å…¼é¡¾æ•ˆç‡ã€ä¾¿äºä½¿ç”¨ã€ä¾¿äºæŒ‰ä¸€äº›å±æ€§èšåˆç­‰è¦æ±‚ã€‚\nå•çº§ç›®å½•\næœ€ç®€å•çš„ç›®å½•ç»“æ„æ˜¯Â single-level directoryï¼Œå³å°†æ‰€æœ‰æ–‡ä»¶éƒ½åŒ…å«åœ¨åŒä¸€ç›®å½•ä¸­ï¼š\n\nè¿™ç§å®ç°æ–¹å¼çš„é—®é¢˜æ˜¯ï¼Œå½“æ–‡ä»¶æ•°é‡å¢åŠ æ—¶ï¼Œå¹¶æ²¡æœ‰æœ‰æ•ˆçš„æ–¹æ³•æ¥æŸ¥æ‰¾æˆ–è€…ç»™æ–‡ä»¶åˆ†ç»„ï¼ˆä¾‹å¦‚æ‰¾å‡ºæ‰€æœ‰çš„ Java ç¨‹åºï¼‰\nåŒæ—¶ï¼Œç”±äºæ‰€æœ‰æ–‡ä»¶ä½äºåŒä¸€ç›®å½•ä¸‹ï¼Œå› æ­¤å®ƒä»¬çš„åç§°å¿…é¡»æ˜¯å”¯ä¸€çš„ã€‚åœ¨æœ‰å¤šä¸ªç”¨æˆ·æ—¶ï¼Œè¿™ç§éœ€æ±‚æ˜¯ä¸å¤ªåˆç†çš„ã€‚\n\nä¸¤çº§ç›®å½•\n\nTwo-level directoryÂ ä¸ºæ¯ä¸ªç”¨æˆ·åˆ›å»ºè‡ªå·±çš„Â ç”¨æˆ·æ–‡ä»¶ç›®å½• (User File Directory, UFD)ï¼›\nè¿™äº› UFD èšåˆæˆä¸ºÂ ä¸»æ–‡ä»¶ç›®å½• (Master File Directory, MFD)ï¼Œå½“ç”¨æˆ·ç™»å½•æ—¶ï¼Œæ“ä½œç³»ç»Ÿä» MFD ä¸­æ‰¾åˆ°ç”¨æˆ·çš„ UFDã€‚\nè¿™ç§å®ç°æ–¹å¼ä¸€å®šç¨‹åº¦ä¸Šå‡å°‘äº†æ–‡ä»¶æ•°é‡å¤šçš„é—®é¢˜ï¼ŒåŒæ—¶ä¸åŒç”¨æˆ·ä¹Ÿå¯ä»¥åˆ†åˆ«åˆ›å»ºåŒåçš„æ–‡ä»¶äº†ã€‚ä½†æ˜¯åˆ†ç»„ä»ç„¶æ²¡æœ‰æ”¯æŒã€‚\nç”¨æˆ· 1 è®¿é—®è‡ªå·±çš„æ–‡ä»¶ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡Â testÂ çš„æ–¹å¼è®¿é—®ï¼›ä¸ºäº†è®¿é—®å…¶ä»–ç”¨æˆ·çš„æ–‡ä»¶ï¼Œéœ€è¦é€šè¿‡Â user2/dataÂ çš„æ–¹å¼è®¿é—®ã€‚è¿™æ ·çš„å®ç°æ–¹æ³•å…¶å®æ˜¯æŠŠäºŒçº§ç›®å½•è§†ä½œä¸€æ£µé«˜åº¦ä¸º 2 çš„æ ‘ã€‚\n\næ ‘å½¢ç›®å½•\nTree-Structured DirectoriesÂ æ˜¯ä¸Šé¢æ–¹æ¡ˆçš„è‡ªç„¶æ¨å¹¿ã€‚åœ¨è¿™ç§å®ç°æ–¹æ¡ˆä¸­ï¼Œç›®å½•æœ¬èº«ä¹Ÿè¢«æ”¾åœ¨çˆ¶ç›®å½•çš„ä¸€ä¸ªæ¡ç›®ä¸­ï¼›æ¯ä¸ªæ¡ç›®æœ‰ä¸€ä¸ª bit æ¥è¡¨ç¤ºè¿™ä¸ªæ¡ç›®è¡¨ç¤ºçš„æ˜¯ä¸€ä¸ªæ–‡ä»¶è¿˜æ˜¯ä¸€ä¸ªå­ç›®å½•ã€‚ç›®å½•ä¹Ÿè¢«è®¤ä¸ºæ˜¯ä¸€ç§ç‰¹æ®Šçš„æ–‡ä»¶ã€‚\n\nåœ¨æ­£å¸¸ä½¿ç”¨æ—¶ï¼Œæ¯ä¸ªè¿›ç¨‹æœ‰ä¸€ä¸ªÂ å½“å‰ç›®å½• (current directory)ï¼›å½“ç”¨æˆ·æŒ‡å®šä¸€ä¸ªæ–‡ä»¶åæ—¶ï¼Œå°±åœ¨å½“å‰ç›®å½•ä¸­å¯»æ‰¾ã€‚ç”¨æˆ·ä¹Ÿå¯ä»¥é€šè¿‡ç³»ç»Ÿè°ƒç”¨Â change_directory()Â æ¥æ›´æ”¹å½“å‰ç›®å½•ã€‚\nå¦‚æœæ‰€éœ€ç›®å½•ä¸åœ¨å½“å‰ç›®å½•ï¼Œé‚£ä¹ˆç”¨æˆ·å°±å¿…é¡»æä¾›ä¸€ä¸ªÂ è·¯å¾„å (path name)ï¼Œè¡¨ç¤ºåœ¨è¿™æ£µæ ‘ä¸Šå¦‚ä½•èµ°å¯ä»¥æ‰¾åˆ°æ‰€éœ€çš„æ–‡ä»¶ã€‚è·¯å¾„ååˆ†ä¸ºä¸¤ç§ï¼š\n\nç»å¯¹è·¯å¾„å (absolute path name)ï¼Œè¡¨ç¤ºä»æ ¹å¼€å§‹åˆ°æŒ‡å®šæ–‡ä»¶çš„è·¯å¾„ï¼Œä¾‹å¦‚Â /bin/count,Â programs/p/listï¼›\nç›¸å¯¹è·¯å¾„å (relative path name)ï¼Œè¡¨ç¤ºä»å½“å‰ç›®å½•å¼€å§‹çš„è·¯å¾„ã€‚\n\nå½“åˆ é™¤ä¸€ä¸ªç›®å½•æ—¶ï¼Œä¸€ç§è®¾è®¡æ€è·¯æ˜¯ä¸å…è®¸åˆ é™¤éç©ºçš„ç›®å½•ï¼›å¦ä¸€ç§æ˜¯ï¼Œåˆ é™¤ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ï¼ˆåŒ…æ‹¬å­ç›®å½•ï¼‰\næ— ç¯å›¾ç›®å½•\nAcyclic Graph DirectoriesÂ åœ¨ä¸Šé¢çš„æ–¹æ¡ˆçš„åŸºç¡€ä¸Šæ”¯æŒäº†ç›®å½•å…±äº«å­ç›®å½•æˆ–è€…æ–‡ä»¶ï¼š\n\nä¸€ç§å®ç°æ–¹å¼æ˜¯ï¼Œå¼•å…¥ä¸€ä¸ªåä¸ºÂ é“¾æ¥ (link)Â çš„æ–°çš„ç›®å½•æ¡ç›®ç±»å‹ï¼Œè¡¨ç¤ºå¦ä¸€ä¸ªæ–‡ä»¶æˆ–è€…å­ç›®å½•çš„æŒ‡é’ˆã€‚åœ¨éå†ç›®å½•æ ‘æ—¶ï¼Œæ“ä½œç³»ç»Ÿå¿½ç•¥é“¾æ¥ä»¥ç»´æŠ¤ç³»ç»Ÿçš„æ— ç¯ç»“æ„ã€‚\n\nè¿™ä¸ªæŒ‡é’ˆçš„å®ç°æ–¹å¼ä¹‹ä¸€æ˜¯ç”¨é“¾æ¥æ–‡ä»¶æ¥è®°å½•æŒ‡å‘æ–‡ä»¶çš„ç»å¯¹æˆ–ç›¸å¯¹è·¯å¾„ï¼Œè¿™ç§æ–¹å¼ç§°ä¸ºÂ ç¬¦å·é“¾æ¥ (symbolic link)Â æˆ–è€…Â è½¯é“¾æ¥ (soft link)ã€‚å½“è®¿é—®è¿™ç§æ–‡ä»¶æ—¶ï¼Œæ“ä½œç³»ç»Ÿé€šè¿‡è¯¥è·¯å¾„åæ¥ resolve é“¾æ¥ï¼Œä»è€Œå®šä½çœŸå®æ–‡ä»¶ã€‚\nè¿™ç§æ–¹å¼å­˜åœ¨çš„ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œå¦‚æœåˆ é™¤ä¸€ä¸ªè¢«æŸä¸ª soft link æ‰€å¼•ç”¨çš„æ–‡ä»¶ï¼Œåˆ™ä¼šç•™ä¸‹Â dangling pointerï¼Œå³é‚£äº› link ç°åœ¨æŒ‡å‘å¹¶ä¸å­˜åœ¨çš„æ–‡ä»¶ã€‚UNIX å’Œ Windows é‡‡ç”¨çš„æ–¹å¼æ˜¯ï¼Œå½“çœŸå®æ–‡ä»¶è¢«åˆ é™¤æ—¶ï¼Œå¹¶ä¸è¯•å›¾å¤„ç†è¿™äº› linkï¼›ç”¨æˆ·åœ¨è¯•å›¾è®¿é—®è¿™äº› link æ—¶ä¼šå‘ç°çœŸå®æ–‡ä»¶å·²ç»è¢«åˆ é™¤ã€‚\n\n\nå¦ä¸€ç§å®ç°æ–¹å¼æ˜¯å¤åˆ¶è¢«å¼•ç”¨æ–‡ä»¶çš„æ‰€æœ‰ä¿¡æ¯ï¼Œæ”¾åœ¨å½“å‰ç›®å½•ä¸­ã€‚\n\nç”±äºè¿™é‡Œçš„ã€Œä¿¡æ¯ã€ä¸­ä¹ŸåŒ…å«æ–‡ä»¶å­˜å‚¨åœ¨å¤–å­˜ä¸­çš„å“ªä¸ªéƒ¨åˆ†ï¼Œå› æ­¤äº‹å®ä¸Šè¿™ä¸ªæ–°çš„æ¡ç›®å’Œè¢«å¼•ç”¨çš„æ¡ç›®æŒ‡å‘çš„æ˜¯åŒä¸€ä¸ªæ–‡ä»¶ã€‚\nè¿™ç§æ–¹å¼ç§°ä¸ºÂ ç¡¬é“¾æ¥ (hard link)ã€‚è¿™ä¸ªé“¾æ¥å’ŒåŸæ–‡ä»¶æœ¬èº«ç›¸åŒä¸”ç›¸ç­‰ï¼Œå› æ­¤å¯èƒ½æ²¡æœ‰åŠæ³•åŒºåˆ†å®ƒä»¬ã€‚è¿™ç§å®ç°çš„ä¸»è¦é—®é¢˜æ˜¯ï¼Œåœ¨ä¿®æ”¹æ–‡ä»¶æ—¶è¦ç»´æŠ¤ä¸€è‡´æ€§ï¼Œå³éœ€è¦åœ¨æ‰€æœ‰åŒ…å«è¿™ä¸ªæ–‡ä»¶çš„ç›®å½•ä¸­æ›´æ–°å¯¹åº”çš„ä¿¡æ¯ã€‚\n\n\nè¿™ç§å®ç°ç»™æ¯ä¸ªæ–‡ä»¶å¼•å…¥äº†ä¸€ä¸ªÂ å¼•ç”¨è®¡æ•° (reference counter)ï¼›åœ¨æ¯ä¸ªæ–‡ä»¶è¢«åˆ›å»ºä¸€ä¸ªæ–°çš„ç¡¬é“¾æ¥æ—¶ï¼Œè¯¥è®¡æ•° +1ï¼›è€Œåˆ é™¤ä¸€ä¸ªç¡¬é“¾æ¥æˆ–åŸæ–‡ä»¶æœ¬èº«æ—¶ï¼Œè¯¥è®¡æ•° -1ã€‚å½“è®¡æ•°ä¸º 0 æ—¶ï¼Œæ–‡ä»¶å¯ä»¥åˆ é™¤ã€‚\n\nUNIX åŒæ—¶æ”¯æŒä¸Šè¿°ä¸¤ç§é“¾æ¥ã€‚ä¸ºäº†ç»´æŠ¤æ— ç¯å›¾ç»“æ„ï¼Œhard link ä¸å…è®¸å¼•ç”¨ç›®å½•ï¼Œè€Œ soft link å¯ä»¥ã€‚\n\n\n                  \n                  Hard link &amp; soft link \n                  \n                \n\nHard link æ˜¯ä¸€ä¸ª directory entry[å¤åˆ¶è¢«å¼•ç”¨æ–‡ä»¶çš„æ‰€æœ‰ä¿¡æ¯]ï¼Œè€Œ soft link æ˜¯ä¸€ä¸ª fileã€‚\nHard link ä¸èƒ½å¼•ç”¨ directoryï¼Œå› ä¸ºè¿™ä¼šå¸¦æ¥å¾ˆå¤šé—®é¢˜[æ¯”å¦‚æ­»å¾ªç¯]ï¼Œä½†æ˜¯ soft link å¯ä»¥ã€‚\n\nä¸€ä¸ªä¾‹å¤–æ˜¯ï¼Œæ¯ä¸ªç›®å½•ä¸­çš„ file nameÂ .Â æ˜¯æŒ‡å‘è‡ªå·±çš„ hard linkï¼Œè€ŒÂ ..Â æ˜¯æŒ‡å‘çˆ¶ç›®å½•çš„ hard linkã€‚è¿™ä¸ªæ—¶å€™hardlinkæ˜¯å¯ä»¥å¼•ç”¨directoryåœ°\nHard link ä¸èƒ½è·¨è¶Š file-system boundariesï¼Œä½†æ˜¯ soft link å¯ä»¥ã€‚è¿™æ˜¯å› ä¸ºï¼Œåœ¨å¤šä¸ª file-system ä¹‹é—´ï¼ŒFCB çš„æ ‡è¯†å·ä¸å†ä¸€å®šæ˜¯å”¯ä¸€çš„ã€‚\n\n\n\né€šç”¨å›¾ç›®å½•\nGeneral Graph DirectoryÂ å…è®¸ç›®å½•ä¸­æœ‰ç¯ã€‚è¿™ä¼šä½¿å¾—éå†å›¾çš„ç®—æ³•æ›´åŠ å¤æ‚ï¼Œå› ä¸ºéœ€è¦é¿å…é‡å¤éå†ä¸€äº›éƒ¨åˆ†ã€‚åŒæ—¶ä¹Ÿä¼šç»™ç¡®å®šä½•æ—¶å¯ä»¥åˆ é™¤æŸä¸ªæ–‡ä»¶æˆ–è€…ç›®å½•å¸¦æ¥éº»çƒ¦ï¼Œå› ä¸ºå¯èƒ½å­˜åœ¨çš„ç›¸äº’å¼•ç”¨æˆ–è€…è‡ªæˆ‘å¼•ç”¨ä¼šä½¿å¾—åœ¨æ²¡æœ‰å¯èƒ½å¼•ç”¨ä¸€ä¸ªç›®å½•æˆ–æ–‡ä»¶æ—¶å¼•ç”¨è®¡æ•°ä¹Ÿä¸ä¸º 0ã€‚\nä¸ºäº†è§£å†³è¿™ç§é—®é¢˜ï¼Œé€šå¸¸éœ€è¦ä½¿ç”¨Â åƒåœ¾å›æ”¶ (garbage collection)Â æ–¹æ¡ˆæ¥ç¡®å®šå“ªäº›æ–‡ä»¶å¯ä»¥åˆ é™¤ã€‚è¿™æ˜¯éå¸¸è´¹æ—¶çš„ã€‚\nFS Mounting | æ–‡ä»¶ç³»ç»ŸæŒ‚è½½\nDirectory Structure å¯ä»¥æ„å»ºåœ¨å¤šä¸ª volume ä¸Šï¼Œè¿™äº› volume å¿…é¡»å…ˆÂ æŒ‚è½½ (mount)Â åˆ°æ–‡ä»¶ç³»ç»Ÿçš„æŸä¸ªä½ç½®ï¼Œè¿™ä¸ªä½ç½®ç§°ä¸ºÂ æŒ‚è½½ç‚¹ (mount point)ã€‚\nä¾‹å¦‚ï¼Œä¸‹é¢å³å›¾å±•ç¤ºäº†å·¦å›¾çš„ volume è¢«æŒ‚è½½åˆ°Â /usersÂ ä¸‹çš„ç»“æœï¼š\nProtection\næ–‡ä»¶çš„æ‰€æœ‰è€…æˆ–è€…åˆ›å»ºè€…åº”è¯¥æœ‰æƒé™å†³å®šå“ªäº›ç”¨æˆ·æœ‰æƒé™åšå“ªäº›äº‹æƒ…ã€‚\nç»™æ¯ä¸ªæ–‡ä»¶å’Œç›®å½•ç»´æŠ¤ä¸€ä¸ªÂ Access Control List (ACL)ï¼ŒæŒ‡å®šæ¯ä¸ªç”¨æˆ·åŠå…¶å…è®¸çš„è®¿é—®ç±»å‹ã€‚ä¸ºäº†ç²¾ç®€ ACLï¼Œå¯ä»¥å°†ç”¨æˆ·åˆ†ä¸ºä¸åŒçš„ç±»å‹ã€‚\nUNIX å°†ç”¨æˆ·åˆ†ä¸ºäº†ä¸‰ç±»ï¼ˆowner0, group, others)ï¼Œå¹¶å°†æ–‡ä»¶è®¿é—®ä¹Ÿåˆ†ä¸ºäº†ä¸‰ç±» (read, write, execute)ï¼š\n\nã€‹root çš„æƒé™\n\nå½“ä¸€ä¸ªæ–‡ä»¶çš„ read æˆ– write bit not set æ—¶ï¼Œroot ç”¨æˆ·ä»ç„¶èƒ½å¤Ÿè¯»æˆ–å†™å®ƒã€‚\nå½“ä¸€ä¸ªç›®å½•çš„ execute bit å¯¹äºä¸€ä¸ªç”¨æˆ·æ‰€åœ¨çš„åˆ†ç±» not set æ—¶ï¼Œè¯¥ç”¨æˆ·ä¸èƒ½è¿›å…¥è¯¥ç›®å½•ï¼›ä½†æ˜¯ root ç”¨æˆ·å¯ä»¥ã€‚\nä½†æ˜¯ï¼Œå¦‚æœä¸€ä¸ªæ–‡ä»¶å¯¹ä¸‰ç±»ç”¨æˆ·çš„ execute bit å‡ not set æ—¶ï¼Œè¿™ä¸ªæ–‡ä»¶è¢«è®¤ä¸ºä¸æ˜¯å¯æ‰§è¡Œçš„ï¼Œå› æ­¤ root ç”¨æˆ·ä¹Ÿä¸èƒ½æ‰§è¡Œè¿™ä¸ªæ–‡ä»¶ã€‚\n"},"è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/å…¶ä»–/lab4-report":{"slug":"è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/å…¶ä»–/lab4-report","filePath":"è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/å…¶ä»–/lab4 report.md","title":"lab4 report","links":[],"tags":[],"content":"å°ç»„æˆå‘˜: é‚“é™æ€¡,è‚–æƒ æ–‡\nå‡†å¤‡å·¥ä½œ\n\n\nä»ä»“åº“æ‹‰å–æœ€æ–°çš„ä»£ç \n\n\nä¿®æ”¹Â vmlinux.ldsï¼Œå°†ç”¨æˆ·æ€ç¨‹åºÂ uappÂ åŠ è½½è‡³Â .dataÂ æ®µ\n\n\n\nä¿®æ”¹makefileç¼–è¯‘ä¸”é“¾æ¥æ–°çš„æ–‡ä»¶å¤¹\n\n\nåˆ›å»ºç”¨æˆ·æ€è¿›ç¨‹\næ›´æ–°ç»“æ„ä½“\n\næœ¬æ¬¡å®éªŒåªéœ€è¦åˆ›å»º4ä¸ªç”¨æˆ·æ€è¿›ç¨‹\nå°†ç‰¹æƒå¯„å­˜å™¨è®¾ç½®åˆ°thread_structä¸­\n\nä¸ºå¤šä¸ªç”¨æˆ·æ€è¿›ç¨‹è®¾ç½®è‡ªå·±çš„é¡µè¡¨\n\nå†…æ ¸çº¿ç¨‹å¯ä»¥å…±äº«ä¸€ä¸ªé¡µè¡¨,å¤šä¸ªç”¨æˆ·æ€è¿›ç¨‹åˆ™éœ€è¦ä¿è¯ç›¸å¯¹éš”ç¦»\n\nä¿®æ”¹task_init\nå¯¹äºæ¯ä¸ªç”¨æˆ·è¿›ç¨‹çš„åˆå§‹åŒ–:\n\nå¢åŠ ç”¨æˆ·æ€æ ‡å¿—ä½\n\nåˆå§‹åŒ–Â sepcã€sstatusã€sscratch\n\nåˆ›å»ºé¡µè¡¨å¹¶å¤åˆ¶å†…æ ¸é¡µè¡¨åˆ°åˆ›å»ºçš„é¡µè¡¨ä¸­\n\n\nå¤åˆ¶é€’å½’å‡½æ•°å…¥å£\n\nå¤åˆ¶é€’å½’å‡½æ•°å®ç°\n\nå¦‚æœæ˜¯ä¸€çº§/äºŒçº§é¡µè¡¨,å°±å¯¹é¡µè¡¨çš„æ¯ä¸€é¡¹(å…±512é¡¹)\n1. ä»æºé¡µè¡¨PTEä¸­æå–ä¸‹ä¸€çº§é¡µè¡¨çš„ç‰©ç†åœ°å€\n2. ä¸ºæ–°é¡µè¡¨åˆ†é…ä¸‹çº§é¡µè¡¨çš„ç©ºé—´,é€’å½’å¤åˆ¶ä¸‹çº§é¡µè¡¨\n3. ä¸ºæ–°é¡µè¡¨PTEè®¾ç½®å¥½å¯¹ä¸‹çº§é¡µè¡¨æŒ‡å‘\nå¦‚æœæ˜¯ä¸‰çº§é¡µè¡¨.å¤åˆ¶æºé¡µè¡¨çš„æ¯ä¸€é¡¹å³å¯.\n\n\n\n\n\nåˆ†é…ä¸€å—æ–°çš„å†…å­˜åœ°å€,æ‹·è´ uapp è¿›å».ç„¶åå°†é¡µé¢æ˜ å°„åˆ°é¡µè¡¨ä¸­\n\nå…ˆè®¡ç®—æ‰€éœ€çš„é¡µæ•°ï¼ˆuappÂ çš„å¤§å°é™¤ä»¥ PGSIZE åå‘ä¸Šå–æ•´ï¼‰\nè°ƒç”¨Â alloc_pages()Â å‡½æ•°\nå†å°†Â uappÂ memcpy è¿‡å»\n\næ˜ å°„åˆ°é¡µè¡¨ä¸­.\n\n\n\nè®¾ç½®æ ˆ-ä¸¤ä¸ª\n\nç”¨æˆ·æ€æ ˆï¼šæˆ‘ä»¬å¯ä»¥ç”³è¯·ä¸€ä¸ªç©ºçš„é¡µé¢æ¥ä½œä¸ºç”¨æˆ·æ€æ ˆï¼Œå¹¶æ˜ å°„åˆ°è¿›ç¨‹çš„é¡µè¡¨ä¸­\n\nå†…æ ¸æ€æ ˆ: åœ¨ lab3 ä¸­å·²ç»è®¾ç½®å¥½äº†ï¼Œå°±æ˜¯Â thread.sp\n\n\n\nalloc_pages:\n\nåˆ†é…ç‰©ç†é¡µå·å¹¶è½¬æ¢ä¸ºè™šæ‹Ÿåœ°å€è¿”å›.\nuapp:\nç”¨æˆ·ç¨‹åº,ç¼–è¯‘ç”Ÿæˆuapp.binçº¯äºŒè¿›åˆ¶æ–‡ä»¶,é“¾æ¥æ—¶æ”¾å…¥å†…æ ¸æ•°æ®æ®µ.ç„¶åä¸ºæ¯ä¸ªè¿›ç¨‹æ‹·è´ä¸€ä»½uapp[åˆ°æ–°åˆ†é…çš„ç‰©ç†å†…å­˜ä¸­][å¹¶ä¸”é‡æ–°æ˜ å°„åˆ°ç”¨æˆ·è¿›ç¨‹è‡ªå·±çš„è™šæ‹Ÿåœ°å€],é˜²æ­¢å†²çª.\næ¯ä¸ªç”¨æˆ·æ€è¿›ç¨‹æœ‰è‡ªå·±çš„è™šæ‹Ÿåœ°å€0x0 â†’ 0x4000000000 (USER_END)\n\nåˆ‡æ¢é€»è¾‘\nç”±å¦ä¸€ä½åŒå­¦è´Ÿè´£\nå¼‚å¸¸åˆ†å‘ä¸è°ƒè¯•\nç”±å¦ä¸€ä½åŒå­¦è´Ÿè´£\nELF è§£æä¸ç³»ç»Ÿè°ƒç”¨å®ç°\nç³»ç»Ÿè°ƒç”¨å®ç°\n\nåœ¨å‘ç”Ÿç³»ç»Ÿè°ƒç”¨å¼‚å¸¸æ—¶,è°ƒç”¨ç³»ç»Ÿè°ƒç”¨å¤„ç†å‡½æ•°\n\nè¿›å…¥ç³»ç»Ÿè°ƒç”¨å¤„ç†å‡½æ•°,æ ¹æ®ç³»ç»Ÿè°ƒç”¨å·åˆ†å‘åˆ°å„ä¸ªåˆ†å¤„ç†å‡½æ•°,ä¼ å…¥ä¸åŒçš„å‚æ•°\n\nç„¶åè®¾ç½®regsä¸­çš„è¿”å›å€¼å¹¶æ‰‹åŠ¨å°†sepc+4\n\nwrite()Â é€»è¾‘\n\ngetpid()é€»è¾‘\n\n\n\n\nELF\n\n\nsection:ç»†ç²’åº¦\n\n\nsegment:ç²—ç²’åº¦.ä¸€ä¸ªsegmenté‡Œé¢å¯èƒ½åŒ…å«å¤šä¸ªsection.æˆ‘ä»¬æŒ‰segmentä¸ºå•ä½åŠ è½½åˆ°å†…å­˜\n\n\nELF header: åŒ…å«å…¥å£åœ°å€\\program headersåœ¨æ–‡ä»¶ä¸­çš„åç§»é‡\\æœ‰å¤šå°‘ä¸ªprogram headers(éœ€è¦åŠ è½½çš„æ®µ)\n\n\nprogram header: æ¯ä¸ªprogram headeræè¿°ä¸€ä¸ªsegment\n\næ®µç±»å‹:æ˜¯å¦éœ€è¦åŠ è½½\nåœ¨æ–‡ä»¶ä¸­çš„ä½ç½®:ä»æ–‡ä»¶ç¬¬å‡ ä¸ªå­—èŠ‚å¼€å§‹\nè™šæ‹Ÿåœ°å€:åŠ è½½åˆ°å†…å­˜çš„å“ªä¸ªåœ°å€\næ–‡ä»¶é‡Œè¿™æ®µæœ‰å¤šå¤§size\nå†…å­˜é‡Œéœ€è¦å¤šå¤§ç©ºé—´\næƒé™\n\n\n\næœªåˆå§‹åŒ–æ•°æ®åœ¨æ–‡ä»¶ä¸­ä¸éœ€è¦å­˜å‚¨,åªéœ€è¦è®°å½•æœ‰å¤šå¤§\nä½†æ˜¯åœ¨å†…å­˜ä¸­å°±éœ€è¦ç¡®åˆ‡åœ°åˆ†é…å¥½ç©ºé—´.fileå¤§å°å’Œmemå¤§å°çš„çš„å·®åˆ«å°±åœ¨è¿™é‡Œ(bssæ®µ.)åŠ è½½ä¹‹åç›´æ¥æ¸…é›¶å³å¯\n\næ›´æ¢payload\n\nä¿®æ”¹task_initåˆå§‹åŒ–æ­¥éª¤\n\n\nå°†åŸæœ¬è¯»å–äºŒè¿›åˆ¶æ–‡ä»¶ç›¸å…³ä»£ç ä¿®æ”¹ä¸ºä½¿ç”¨ ELF è§£æå’ŒåŠ è½½ç¨‹åº\nåˆ†é…å®Œç”¨æˆ·æ€æ ˆå,è®¾ç½®sscratchå¯„å­˜å™¨\n\n\nELFåŠ è½½å‡½æ•°\n\nå†…æ ¸åŒºè¯»å– ELF ä¿¡æ¯[æœ¬å®éªŒä¸­æ‰€æœ‰è¿›ç¨‹å…±ç”¨ä¸€ä¸ªuappå› æ­¤æ˜¯è¯»å–ä¸€æ ·çš„ä»£ç å’Œæ•°æ®]\n\nä¸ºè¿™ä¸ªç¨‹åºçš„æ¯ä¸ª segment åˆ†é…ç‹¬ç«‹çš„ç‰©ç†å†…å­˜\n\nè®¡ç®—éœ€è¦æ˜ å°„çš„å†…å­˜å¤§å°å¹¶è®¡ç®—éœ€è¦æ˜ å°„çš„é¡µæ•°\n\næŒ‰ç…§é¡µå¯¹é½åˆ†é…ç‰©ç†å†…å­˜\n\nå°†æ®µå†…å®¹ä»ELFæ–‡ä»¶æ‹·è´åˆ°åˆ†é…çš„å†…å­˜[æ‹·è´filesize]\n\nå°†bbsæ®µç©ºé—´æ¸…é›¶[memsize-filesize]\n\nè®¾ç½®æƒé™\n\n\n\nå»ºç«‹è™šæ‹Ÿåœ°å€æ˜ å°„\n\nè®¾ç½®ç¨‹åºå…¥å£åœ°å€sepc[ELF]\n\n\n\n\nç¼–è¯‘å¹¶è¿è¡Œ\n\næ€è€ƒé¢˜\n\n\næˆ‘ä»¬åœ¨å®éªŒä¸­ä½¿ç”¨çš„ç”¨æˆ·æ€çº¿ç¨‹å’Œå†…æ ¸æ€çº¿ç¨‹çš„å¯¹åº”å…³ç³»æ˜¯æ€æ ·çš„ï¼Ÿï¼ˆä¸€å¯¹ä¸€ï¼Œä¸€å¯¹å¤šï¼Œå¤šå¯¹ä¸€è¿˜æ˜¯å¤šå¯¹å¤šï¼Œè¨€ä¹‹æœ‰ç†å³å¯ï¼‰\nå®éªŒé‡Œè°ƒåº¦çš„åŸºæœ¬å•ä½å°±æ˜¯Â task_struct.å®ƒåŒæ—¶ä¿å­˜äº†å†…æ ¸çº¿ç¨‹çš„å¯„å­˜å™¨ä¸Šä¸‹æ–‡å’Œå¯¹åº”ç”¨æˆ·æ€çš„å…³é”®å¯„å­˜å™¨.è°ƒåº¦å™¨æ¯æ¬¡åˆ‡æ¢çš„å…¶å®æ˜¯è¿™ä¸ªç»“æ„æœ¬èº«,è¿™ä¸ªç»“æ„åˆåªå¯¹åº”ä¸€ä¸ªç”¨æˆ·æ€è¿›ç¨‹.è€Œæ²¡æœ‰åœ¨å¤šä¸ªç”¨æˆ·çº¿ç¨‹ä¹‹é—´å†æ˜ å°„åŒä¸€ä¸ªå†…æ ¸çº¿ç¨‹,å› æ­¤å¯ä»¥è®¤ä¸ºæ˜¯ä¸€å¯¹ä¸€çš„å…³ç³».\n\n\nç³»ç»Ÿè°ƒç”¨è¿”å›ä¸ºä»€ä¹ˆä¸èƒ½ç›´æ¥ä¿®æ”¹å¯„å­˜å™¨ï¼Ÿ\né™·å…¥å†…æ ¸æ—¶Â _trapsÂ ä¼šæŠŠæ‰€æœ‰å¯„å­˜å™¨å¤åˆ¶åˆ°Â pt_regs,çœŸæ­£è¿”å›ç”¨æˆ·æ€æ—¶ä¼šä»Â pt_regsÂ æ¢å¤.å¦‚æœå†…æ ¸é‡Œç›´æ¥æ”¹çœŸå®å¯„å­˜å™¨,ä¸‹ä¸€æ¬¡Â sretÂ æ¢å¤åˆä¼šè¢«Â pt_regsÂ è¦†ç›–,æ‰€ä»¥å¿…é¡»å†™å›Â regsâ†’a0Â ç­‰ä¿å­˜åŒºï¼Œä¿è¯çŠ¶æ€ä¸€è‡´.\n\n\né’ˆå¯¹ç³»ç»Ÿè°ƒç”¨ï¼Œä¸ºä»€ä¹ˆè¦æ‰‹åŠ¨å°† sepc + 4ï¼Ÿ\nsepcÂ ä¿ç•™è§¦å‘å¼‚å¸¸çš„æŒ‡ä»¤åœ°å€.ecallÂ æ˜¯ä¸€æ¡Â 4 å­—èŠ‚çš„æŒ‡ä»¤,å¦‚æœä¸æ‰‹åŠ¨åŠ  4,sretÂ å›å»åè¿˜ä¼šå†æ¬¡æ‰§è¡ŒåŒä¸€æ¡Â ecall,è¿›å…¥æ­»å¾ªç¯,æ‰€ä»¥è¦æ˜¾å¼åŠ Â 4 è·³è¿‡å®ƒ.\n\n\nä¸ºä»€ä¹ˆ Phdr ä¸­ï¼Œp_fileszÂ å’ŒÂ p_memszÂ æ˜¯ä¸ä¸€æ ·å¤§çš„ï¼Œå®ƒä»¬åˆ†åˆ«è¡¨ç¤ºä»€ä¹ˆï¼Ÿ\np_fileszÂ æ˜¯ segmentÂ åœ¨ ELFÂ æ–‡ä»¶é‡ŒçœŸå®å ç”¨çš„å­—èŠ‚ï¼Œæ¯”å¦‚Â .textã€.dataï¼›p_memszÂ æ˜¯è¿›ç¨‹è¿è¡Œæ—¶éœ€è¦çš„å†…å­˜å¤§å°ï¼Œå®ƒè¿˜åŒ…å«Â .bssÂ è¿™ç§åœ¨æ–‡ä»¶é‡Œä¸å ç©ºé—´,ä½†è¿è¡Œæ—¶è¦è¢«æ¸…é›¶çš„éƒ¨åˆ†ï¼Œæ‰€ä»¥å¸¸å¸¸æ›´å¤§.åŠ è½½æ—¶è¦å…ˆæ‹·è´Â p_fileszÂ åŒºé—´,å†æŠŠÂ p_fileszÂ åˆ°Â p_memszÂ æ¸…é›¶.\n\n\nä¸ºä»€ä¹ˆå¤šä¸ªè¿›ç¨‹çš„æ ˆè™šæ‹Ÿåœ°å€å¯ä»¥ç›¸åŒï¼Ÿç”¨æˆ·æ€ç¨‹åºæœ‰æ²¡æœ‰æ–¹æ³•çŸ¥é“æ ˆæ‰€åœ¨çš„ç‰©ç†åœ°å€ï¼Ÿ\næ¯ä¸ªè¿›ç¨‹æœ‰ç§æœ‰é¡µè¡¨,æŠŠåŒä¸€ä¸ªç”¨æˆ·æ ˆè™šæ‹Ÿåœ°å€æ˜ å°„åˆ°ä¸åŒçš„ç‰©ç†é¡µ.å› ä¸ºç”¨æˆ·æ€æ— æ³•è®¿é—®é¡µè¡¨,ä¹Ÿä¸èƒ½è¯»å–ç‰©ç†åœ°å€,æ‰€ä»¥å®ƒçœ‹ä¸åˆ°çœŸå®ç‰©ç†ä½ç½®,åªèƒ½æŒ‰è™šæ‹Ÿåœ°å€ä½¿ç”¨,æ¥åšåˆ°åœ°å€ç©ºé—´éš”ç¦».\n\n\nå¿ƒå¾—ä½“ä¼š\n\nELF: ä¸€ç§å¯æ‰§è¡Œæ–‡ä»¶æ ¼å¼,é‡Œé¢é™¤äº†ä»£ç å’Œæ•°æ®ä»¥å¤–è¿˜åŒ…æ‹¬ç›®å½•[è¯´æ˜æ–‡ä»¶ç»“æ„\\å…¥å£ç‚¹\\æ®µä¿¡æ¯],ä»¥åŠé™„å½•[ç¬¦å·è¡¨,è°ƒè¯•ä¿¡æ¯ç­‰]\nçº¯äºŒè¿›åˆ¶æ–‡ä»¶: åªåŒ…å«ä»£ç å’Œæ•°æ®,æ²¡æœ‰ç›®å½•å’Œé™„å½•\nstrip: å»æ‰ELFä¸­éå¿…é¡»ä¿¡æ¯çš„è¿‡ç¨‹.ä¸€èˆ¬æ˜¯ç”¨Â objcopyÂ å°† ELF è½¬æ¢ä¸ºçº¯äºŒè¿›åˆ¶ï¼ˆ.binï¼‰\nå…ˆè¿è¡Œçº¯äºŒè¿›åˆ¶æ–‡ä»¶,å†åˆ‡æ¢æˆELFæ–‡ä»¶.æ˜¯ä¸ºäº†é€šè¿‡ç®€å•æ“ä½œéªŒè¯åŸºæœ¬æµç¨‹æ˜¯å¦æ­£å¸¸,å†åˆ‡æ¢åˆ°ELFæ”¯æŒæ›´å¤æ‚çš„åŠŸèƒ½\n\nç”¨æˆ·æ€è¿›è¡Œç³»ç»Ÿè°ƒç”¨çš„è¿‡ç¨‹\n\nç”¨æˆ·æ€è°ƒç”¨ecall\ncpuä¼šè‡ªåŠ¨åšçš„äº‹æƒ…\n\nä¿å­˜å¼‚å¸¸å‘ç”Ÿçš„PCåˆ°sepc\nè®°å½•å¼‚å¸¸åŸå› åˆ°scause\nè®°å½•æ¥è‡ªUmodeåˆ°sâ€™sâ€™tasstatus\nåˆ‡æ¢åˆ°Smode\nstvecå†™å…¥PC: è·³è½¬åˆ°_traps\n\n\ntrapsä¼šåˆ‡æ¢æ ˆ:\n\nä»ç”¨æˆ·æ ˆåˆ‡æ¢åˆ°å†…æ ¸æ ˆ\nåœ¨å†…æ ¸æ ˆä¸Šåˆ†é…ç©ºé—´[pt_regs]å¹¶ä¿å­˜å¯„å­˜å™¨\n\n\nè°ƒç”¨handler,è°ƒç”¨çš„æ—¶å€™ä¼šè¦†ç›–åŸæœ¬çš„å¯„å­˜å™¨\n\nsie: ä¸­æ–­ç±»å‹å¼€å…³.å†³å®šå“ªäº›ç»ˆç«¯ç±»å‹å¯ä»¥ä½œç”¨\nsstatus.sie: sæ€å…¨å±€å¼€å…³,å†³å®šåœ¨sæ€(å†…æ ¸æ€æ‰§è¡Œæ—¶),æ˜¯å¦å…è®¸ä¸­æ–­.\nå½“cpuåœ¨ç”¨æˆ·æ€è¿è¡Œæ—¶,ç‰¹æƒçº§çš„ä¸­æ–­æ€»æ˜¯å¯ç”¨çš„,ä¸ç®¡sstatusæ˜¯å¦‚ä½•è®¾ç½®çš„."},"è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/æ“ä½œç³»ç»ŸæœŸæœ«":{"slug":"è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/æ“ä½œç³»ç»ŸæœŸæœ«","filePath":"è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/æ“ä½œç³»ç»ŸæœŸæœ«.md","title":"æ“ä½œç³»ç»ŸæœŸæœ«","links":[],"tags":[],"content":"è®¡ç®—å¤§é¢˜\n\nè¿›ç¨‹è°ƒåº¦ç®—æ³•ï¼š\nâ—¦ é‡ç‚¹ï¼šç†Ÿç»ƒç»˜åˆ¶ FCFSã€SJFï¼ˆæŠ¢å ä¸éæŠ¢å ï¼‰ã€ä¼˜å…ˆçº§è°ƒåº¦ï¼ˆæŠ¢å ï¼‰ã€RRï¼ˆæ—¶é—´ç‰‡è½®è½¬ï¼‰ çš„ç”˜ç‰¹å›¾ã€‚\nâ—¦ è¦æ±‚ï¼šå‡†ç¡®è®¡ç®—å¹³å‡ç­‰å¾…æ—¶é—´å’Œå¹³å‡å‘¨è½¬æ—¶é—´ã€‚\nä¿¡å·é‡åŒæ­¥ï¼ˆPVæ“ä½œï¼‰ï¼š\nâ—¦ é‡ç‚¹ï¼šæŒæ¡ ç”Ÿäº§è€…-æ¶ˆè´¹è€…ã€è¯»è€…-å†™è€…ã€å“²å­¦å®¶è¿›é¤ã€åŒ»ç”Ÿçœ‹ç—…ã€ä¼šè®®å®¤ç®¡ç† ç­‰ç»å…¸æ¨¡å‹ã€‚\nâ—¦ æ³¨æ„ï¼šç†è§£ä¿¡å·é‡åˆå€¼è®¾å®šåŠ PV é¡ºåºï¼ˆç‰¹åˆ«æ˜¯åŒæ­¥ä¸äº’æ–¥ç›¸é‚»æ—¶ï¼Œå…ˆæ‰§è¡ŒåŒæ­¥ waitï¼‰ã€‚\nå†…å­˜ç®¡ç†ä¸åˆ†é¡µæ¶æ„ï¼š\nâ—¦ é‡ç‚¹ï¼šäºŒçº§é¡µè¡¨ï¼ˆç”šè‡³ä¸‰çº§ï¼‰çš„åœ°å€è½¬æ¢ï¼Œè®¡ç®—é¡µå·ï¼ˆPage Numberï¼‰ã€é¡µå†…åç§»ï¼ˆOffsetï¼‰ã€‚\nâ—¦ å…³é”®è®¡ç®—ï¼šæœ‰æ•ˆè®¿é—®æ—¶é—´ï¼ˆEATï¼‰ï¼Œéœ€è€ƒè™‘ TLB å‘½ä¸­ç‡ã€å†…å­˜è®¿é—®æ—¶é—´åŠç¼ºé¡µå¤„ç†æ—¶é—´ã€‚\næ­»é”é¿å…ï¼ˆé“¶è¡Œå®¶ç®—æ³•ï¼‰ï¼š\nâ—¦ é‡ç‚¹ï¼šæ ¹æ® Maxã€Allocation çŸ©é˜µè®¡ç®— Need çŸ©é˜µï¼Œåˆ¤æ–­ç³»ç»Ÿæ˜¯å¦å¤„äº å®‰å…¨çŠ¶æ€ï¼Œå¹¶ç»™å‡ºä¸€ä¸ªå®‰å…¨åºåˆ—ã€‚\n\nå­˜å‚¨ä¸æ–‡ä»¶\næ–‡ä»¶ç³»ç»Ÿå’Œç£ç›˜è°ƒåº¦åœ¨é€‰æ‹©é¢˜å’Œä¸­å‹è®¡ç®—é¢˜ä¸­å‡ºç°é¢‘ç‡æé«˜ã€‚\n\né¡µé¢ç½®æ¢ç®—æ³•ï¼š\nâ—¦ é‡ç‚¹ï¼šFIFOã€LRUã€OPTï¼ˆæœ€ä½³ç½®æ¢ï¼‰ çš„ç½®æ¢è¿‡ç¨‹åŠç¼ºé¡µæ•°è®¡ç®—ã€‚\nâ—¦ è€ƒç‚¹ï¼šç†è§£ Belady å¼‚å¸¸ï¼ˆFIFO ç‰¹æœ‰ï¼‰åŠ æŠ–åŠ¨ï¼ˆThrashingï¼‰ ç°è±¡ã€‚\næ–‡ä»¶åˆ†é…æ–¹å¼ä¸ç´¢å¼•ï¼š\nâ—¦ é‡ç‚¹ï¼šè®¡ç®— æ··åˆç´¢å¼•ï¼ˆå¦‚ Linux inode çš„ 12ç›´æ¥+ä¸€çº§+äºŒçº§+ä¸‰çº§ç´¢å¼•ï¼‰ èƒ½ç®¡ç†çš„æœ€å¤§æ–‡ä»¶å¤§å°ã€‚\nâ—¦ å¯¹æ¯”ï¼šè¿ç»­åˆ†é…ï¼ˆContiguousï¼‰ã€é“¾æ¥åˆ†é…ï¼ˆLinkedï¼‰ä¸ç´¢å¼•åˆ†é…ï¼ˆIndexedï¼‰çš„ä¼˜ç¼ºç‚¹ï¼ˆå¦‚ï¼šè¿ç»­åˆ†é…ä¸æ”¯æŒåŠ¨æ€å¢é•¿ï¼Œé“¾æ¥åˆ†é…ä¸æ”¯æŒéšæœºè®¿é—®ï¼‰ã€‚\nç£ç›˜è°ƒåº¦ç®—æ³•ï¼š\nâ—¦ é‡ç‚¹ï¼šSSTFï¼ˆæœ€çŸ­å¯»é“æ—¶é—´ä¼˜å…ˆï¼‰ã€SCANï¼ˆç”µæ¢¯ç®—æ³•ï¼‰ã€C-SCAN çš„ç§»åŠ¨è·ç¦»è®¡ç®—ã€‚\nâ—¦ ç‰¹æ€§ï¼šSSTF å¯èƒ½å¯¼è‡´é¥¥é¥¿ï¼Œè€Œ C-SCAN æä¾›æ›´å‡åŒ€çš„ç­‰å¾…æ—¶é—´ã€‚\n\nè¿›ç¨‹çº¿ç¨‹ linux\nç¬¬ä¸‰ä¼˜å…ˆçº§ï¼šè¿›ç¨‹ã€çº¿ç¨‹ä¸ Linux ç‰¹è‰²ï¼ˆé€‰æ‹©ä¸å¡«ç©ºï¼‰\næ­¤éƒ¨åˆ†å†…å®¹å¤šè§äºå°æµ‹å’Œå›å¿†å·çš„é€‰æ‹©é¢˜ï¼Œä¾§é‡æ¦‚å¿µç†è§£ã€‚\n\nè¿›ç¨‹ä¸çº¿ç¨‹æ¨¡å‹ï¼š\nâ—¦ è€ƒç‚¹ï¼šçº¿ç¨‹å…±äº«èµ„æºï¼ˆå †ã€å…¨å±€å˜é‡ã€ä»£ç æ®µï¼‰ï¼Œä¸å…±äº«ï¼ˆæ ˆã€å¯„å­˜å™¨ã€Thread IDï¼‰ã€‚\nâ—¦ å¤šçº¿ç¨‹æ¨¡å‹ï¼šmany-to-oneï¼ˆä¸€ä¸ªé˜»å¡å…¨éƒ¨é˜»å¡ï¼‰ã€one-to-oneã€many-to-manyã€‚\nâ—¦ ç³»ç»Ÿè°ƒç”¨ï¼šfork() åˆ›å»ºè¿›ç¨‹ï¼ˆæ³¨æ„è¿”å›å€¼ï¼Œçˆ¶è¿›ç¨‹è¿”å›å­ PIDï¼Œå­è¿›ç¨‹è¿”å› 0ï¼‰ã€exec() æ›¿æ¢è¿›ç¨‹æ˜ åƒã€‚\næ“ä½œç³»ç»Ÿç»“æ„ä¸æœºåˆ¶ï¼š\nâ—¦ è€ƒç‚¹ï¼šåŒæ¨¡å¼æ‰§è¡Œï¼ˆç”¨æˆ·æ€ vs å†…æ ¸æ€ï¼‰ï¼Œç‰¹æƒæŒ‡ä»¤çš„å®šä¹‰ï¼Œè§¦å‘çŠ¶æ€åˆ‡æ¢çš„äº‹ä»¶ï¼ˆå¼‚å¸¸ã€ä¸­æ–­ã€é™·å…¥/ç³»ç»Ÿè°ƒç”¨ï¼‰ã€‚\nâ—¦ ä¸­æ–­å¤„ç†ï¼šä¸­æ–­å‘é‡ã€DMAï¼ˆä¸ç»è¿‡ CPU ç›´æ¥äº¤æ¢æ•°æ®ï¼‰ã€è½¯ä¸­æ–­ï¼ˆTrapï¼‰ã€‚\nLinux/Windows ç‰¹è‰²ï¼š\nâ—¦ Linuxï¼štask_struct ç»“æ„ã€CFS è°ƒåº¦å™¨ã€/proc æ–‡ä»¶ç³»ç»Ÿï¼ˆä¼ªæ–‡ä»¶ç³»ç»Ÿï¼‰ã€å†…æ ¸æ¨¡å—åŠ è½½å‘½ä»¤ï¼ˆinsmod, lsmodï¼‰ [26, 20.7, 2951, 3195]ã€‚\nâ—¦ RAID çº§åˆ«ï¼šRAID 0ï¼ˆæ¡å¸¦åŒ–ï¼‰ã€RAID 1ï¼ˆé•œåƒï¼‰ã€RAID 5ï¼ˆåˆ†å¸ƒå¼å¥‡å¶æ ¡éªŒï¼Œå…¼é¡¾å®¹é‡ä¸å®¹é”™ï¼‰ã€RAID 1+0ã€‚\n\nä½é¢‘\n\næ“ä½œç³»ç»Ÿç›®æ ‡ï¼šæ–¹ä¾¿æ€§ã€æ•ˆç‡ã€‚\nå­˜å‚¨ä½“ç³»ï¼šå¯„å­˜å™¨ &gt; ç¼“å­˜ &gt; ä¸»å­˜ &gt; è¾…å­˜çš„å±‚æ¬¡ä¸é€Ÿåº¦å¯¹æ¯”ã€‚\nå¾®å†…æ ¸ä¸å®å†…æ ¸å¯¹æ¯”ï¼šå¾®å†…æ ¸æ›´æ˜“æ‰©å±•ã€æ›´å®‰å…¨ï¼Œä½†é€šä¿¡å¼€é”€å¤§ã€‚\nåœ°å€ç»‘å®šæ—¶æœºï¼šç¼–è¯‘æ—¶ã€åŠ è½½æ—¶ã€æ‰§è¡Œæ—¶ï¼ˆåŠ¨æ€é‡å®šä½ï¼‰ã€‚\n\né¢è¯•å¯¼å‘\nGo çš„æ€æ‰‹é”æ˜¯é«˜å¹¶å‘ï¼ˆGoroutineï¼‰ï¼Œè€Œç†è§£ Goroutine çš„å‰ææ˜¯ç†è§£æ“ä½œç³»ç»ŸåŸæœ¬çš„è¿›ç¨‹/çº¿ç¨‹æ¨¡å‹ã€‚\n1. è¿›ç¨‹ã€çº¿ç¨‹ä¸åç¨‹ (Process, Thread, Coroutine)\n\n\nåŸºç¡€æ¦‚å¿µï¼š è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«ï¼ˆèµ„æºåˆ†é… vs è°ƒåº¦å•ä½ï¼‰ã€‚\n\n\nä¸Šä¸‹æ–‡åˆ‡æ¢ (Context Switch)ï¼š è¿›ç¨‹åˆ‡æ¢ vs çº¿ç¨‹åˆ‡æ¢çš„å¼€é”€åŒºåˆ«ã€‚\n\nGo å…³è”ï¼š ä¸ºä»€ä¹ˆ Goroutine åˆ‡æ¢æˆæœ¬æä½ï¼ˆç”¨æˆ·æ€åˆ‡æ¢ï¼Œåªéœ€ä¿å­˜æå°‘å¯„å­˜å™¨ï¼‰ï¼Ÿ\n\n\n\nè¿›ç¨‹é—´é€šä¿¡ (IPC)ï¼š ç®¡é“ã€æ¶ˆæ¯é˜Ÿåˆ—ã€å…±äº«å†…å­˜ã€ä¿¡å·é‡ã€‚\n\nGo å…³è”ï¼š Go æ¨è â€œä¸è¦é€šè¿‡å…±äº«å†…å­˜æ¥é€šä¿¡ï¼Œè€Œè¦é€šè¿‡é€šä¿¡æ¥å…±äº«å†…å­˜â€ (Channel)ï¼Œè¿™å¯¹åº”äº†å“ªç§ IPC æ€æƒ³ï¼Ÿ\n\n\n\n2. I/O æ¨¡å‹ (å¿…è€ƒæ ¸å¿ƒ)\nè¿™æ˜¯ Go åç«¯é¢è¯•ä¸­æœ€ç¡¬æ ¸çš„éƒ¨åˆ†ï¼Œå› ä¸º Go çš„é«˜æ€§èƒ½ä¸»è¦æºäºæ­¤ã€‚\n\näº”ç§ I/O æ¨¡å‹ï¼š é˜»å¡ I/Oã€éé˜»å¡ I/Oã€I/O å¤šè·¯å¤ç”¨ã€ä¿¡å·é©±åŠ¨ I/Oã€å¼‚æ­¥ I/Oã€‚\nIO å¤šè·¯å¤ç”¨ (IO Multiplexing)ï¼š\n\nselect, poll, epoll çš„åŒºåˆ«ï¼š ä¸ºä»€ä¹ˆ epoll åœ¨é«˜å¹¶å‘ä¸‹æ€§èƒ½æ›´å¥½ï¼Ÿï¼ˆçº¢é»‘æ ‘ã€å°±ç»ªé“¾è¡¨ï¼‰ã€‚\nè§¦å‘æ¨¡å¼ï¼š æ°´å¹³è§¦å‘ (LT) vs è¾¹ç¼˜è§¦å‘ (ET)ã€‚\nGo å…³è”ï¼š Go çš„ Netpollerï¼ˆç½‘ç»œè½®è¯¢å™¨ï¼‰åº•å±‚å°±æ˜¯åŸºäº epoll (Linux) / kqueue (Mac) / IOCP (Windows) å®ç°çš„ã€‚é¢è¯•å¸¸é—®ï¼šGo å¦‚ä½•ç”¨åŒæ­¥çš„ä»£ç é€»è¾‘å®ç°äº†å¼‚æ­¥çš„ I/O æ€§èƒ½ï¼Ÿ\n\n\n\n3. å†…å­˜ç®¡ç†\n\nè™šæ‹Ÿå†…å­˜ï¼š ä»€ä¹ˆæ˜¯è™šæ‹Ÿå†…å­˜ï¼Ÿåˆ†é¡µ (Paging) å’Œåˆ†æ®µã€‚\nç”¨æˆ·æ€ vs å†…æ ¸æ€ï¼š ç³»ç»Ÿè°ƒç”¨ (System Call) ä¼šå¯¼è‡´çŠ¶æ€åˆ‡æ¢ã€‚\nå † (Heap) vs æ ˆ (Stack)ï¼š\n\nGo å…³è”ï¼š é€ƒé€¸åˆ†æ (Escape Analysis)ã€‚åœ¨ C/C++ ä¸­ä½ éœ€è¦æ‰‹åŠ¨ç®¡ç†å †å†…å­˜ï¼Œä½†åœ¨ Go ä¸­ï¼Œç¼–è¯‘å™¨å†³å®šå˜é‡æ˜¯åœ¨æ ˆä¸Šè¿˜æ˜¯å †ä¸Šã€‚ä½ éœ€è¦å¤ä¹ ä¸€ä¸‹ä»€ä¹ˆæƒ…å†µä¼šå¯¼è‡´å˜é‡â€œé€ƒé€¸â€åˆ°å †ä¸Šï¼ˆå¦‚è¿”å›å±€éƒ¨å˜é‡æŒ‡é’ˆï¼‰ã€‚\n\n\n\n4. æ­»é” (Deadlock)\n\näº§ç”Ÿæ­»é”çš„å››ä¸ªå¿…è¦æ¡ä»¶ï¼š äº’æ–¥ã€å æœ‰ä¸”ç­‰å¾…ã€ä¸å¯æŠ¢å ã€å¾ªç¯ç­‰å¾…ã€‚\nå¦‚ä½•é¢„é˜²/é¿å…ï¼š ç ´åå…¶ä¸­ä¸€ä¸ªæ¡ä»¶ã€‚\n\nGo å…³è”ï¼š RWMutex, Channel å¦‚æœä½¿ç”¨ä¸å½“ä¼šå¯¼è‡´æ­»é”ï¼ˆfatal error: all goroutines are asleep - deadlock!ï¼‰ã€‚\n\n\n"},"è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/æµç¨‹æ€»è§ˆ/01-ç³»ç»Ÿå¯åŠ¨ä¸è¿›ç¨‹åˆ›å»º":{"slug":"è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/æµç¨‹æ€»è§ˆ/01-ç³»ç»Ÿå¯åŠ¨ä¸è¿›ç¨‹åˆ›å»º","filePath":"è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/æµç¨‹æ€»è§ˆ/01 ç³»ç»Ÿå¯åŠ¨ä¸è¿›ç¨‹åˆ›å»º.md","title":"01 ç³»ç»Ÿå¯åŠ¨ä¸è¿›ç¨‹åˆ›å»º","links":["è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/01-introduction","è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/04.1-ä¸»å­˜","è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/02.2-è°ƒåº¦","è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/02.1-è¿›ç¨‹","è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/04.2-virtual-memory"],"tags":[],"content":"ç³»ç»Ÿå¯åŠ¨æµç¨‹\nä¸Šç”µä¸å¼•å¯¼\nè®¡ç®—æœºä¸Šç”µåçš„å¯åŠ¨è¿‡ç¨‹ï¼š\n\nCPUæ‰§è¡ŒROMä¸­çš„å¼•å¯¼åŠ è½½å™¨ï¼ˆbootstrap loaderï¼‰\n\nè¿™æ˜¯å¼€æœºåæ‰§è¡Œçš„ç¬¬ä¸€ä¸ªè½¯ä»¶\nä½ç½®å›ºå®šä¸”å·²çŸ¥\n\n\nå¼•å¯¼åŠ è½½å™¨å®Œæˆçš„ä»»åŠ¡\n\nç¡¬ä»¶è‡ªæ£€ï¼ˆPOSTï¼‰\nå®šä½ç£ç›˜ä¸Šçš„æ“ä½œç³»ç»Ÿå†…æ ¸é•œåƒ\nå°†å†…æ ¸åŠ è½½åˆ°ä¸»å†…å­˜ï¼ˆRAMï¼‰\nåˆ‡æ¢CPUä¸ºå†…æ ¸æ€ï¼Œå¼€å§‹æ‰§è¡Œå†…æ ¸ä»£ç \n\n\n\nå†…æ ¸åˆå§‹åŒ–\nå†…æ ¸åŠ è½½åˆ°å†…å­˜åçš„åˆå§‹åŒ–æ­¥éª¤ï¼š\nåˆå§‹åŒ–ä¸­æ–­ç³»ç»Ÿ\n\nè®¾ç½®ä¸­æ–­å‘é‡è¡¨ï¼ˆinterrupt vector tableï¼‰\n\nå»ºç«‹ä¸­æ–­å·åˆ°ä¸­æ–­å¤„ç†ç¨‹åºçš„æ˜ å°„\n\n\né…ç½®ä¸­æ–­è¯·æ±‚çº¿ï¼ˆinterrupt-request lineï¼‰\nåˆå§‹åŒ–è®¡æ—¶å™¨ï¼ˆtimerï¼‰\n\nç”¨äºæ—¶é—´ç‰‡ç®¡ç†\n\n\n\nåˆå§‹åŒ–å†…å­˜ç®¡ç†\n\nå»ºç«‹ç‰©ç†å†…å­˜çš„å¸§è¡¨ï¼ˆframe tableï¼‰\n\nè®°å½•æ¯ä¸ªç‰©ç†å¸§çš„ä½¿ç”¨æƒ…å†µ\n\n\nåˆå§‹åŒ–å†…æ ¸çš„é¡µè¡¨ç»“æ„\nè®¾ç½®å†…å­˜ä¿æŠ¤æœºåˆ¶\n\nåˆå§‹åŒ–è¿›ç¨‹ç®¡ç†\n\nåˆ›å»ºåˆå§‹çš„å†…æ ¸æ•°æ®ç»“æ„\nå‡†å¤‡å°±ç»ªé˜Ÿåˆ—ï¼ˆready queueï¼‰\nå‡†å¤‡ç­‰å¾…é˜Ÿåˆ—ï¼ˆwait queueï¼‰\n\nåˆ›å»ºç¬¬ä¸€ä¸ªç”¨æˆ·è¿›ç¨‹\nå†…æ ¸åˆå§‹åŒ–å®Œæˆåï¼Œåˆ›å»ºç¬¬ä¸€ä¸ªç”¨æˆ·è¿›ç¨‹ï¼š\n\nLinuxä¸­é€šå¸¸æ˜¯initæˆ–systemd\nè¿›ç¨‹IDï¼ˆPIDï¼‰ä¸º1\n\nåˆ›å»ºæ­¥éª¤ï¼š\n\nåˆ†é…è¿›ç¨‹æ§åˆ¶å—ï¼ˆPCBï¼‰\nå»ºç«‹è™šæ‹Ÿåœ°å€ç©ºé—´\nå»ºç«‹é¡µè¡¨æ˜ å°„\né€šè¿‡åŠ è½½å™¨ï¼ˆloaderï¼‰åŠ è½½å¯æ‰§è¡Œæ–‡ä»¶\nåˆ‡æ¢åˆ°ç”¨æˆ·æ€å¹¶å¼€å§‹æ‰§è¡Œ\n\nç¨‹åºçš„åœ°å€ç»‘å®š\nç¨‹åºä»æºä»£ç åˆ°å†…å­˜çš„å®Œæ•´è¿‡ç¨‹ã€‚\nç¼–è¯‘ã€é“¾æ¥ã€åŠ è½½\n\n\nç¼–è¯‘é˜¶æ®µï¼ˆ.c â†’ .oï¼‰\n\nç¼–è¯‘å™¨å°†æºä»£ç ä¸­çš„ç¬¦å·åœ°å€è½¬æ¢ä¸ºå¯é‡å®šä½åœ°å€\nç¬¦å·åœ°å€ï¼šå˜é‡åã€å‡½æ•°åç­‰\nå¯é‡å®šä½åœ°å€ï¼šç›¸å¯¹äºæŸä¸ªæ®µçš„åç§»\n\n\n\né“¾æ¥é˜¶æ®µï¼ˆ.o â†’ .exeï¼‰\n\né“¾æ¥å™¨å°†å¤šä¸ªç›®æ ‡æ–‡ä»¶åˆå¹¶\nç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶\nåœ°å€å˜ä¸ºç›¸å¯¹äºæ•´ä¸ªç¨‹åºçš„åœ°å€\n\n\n\nåŠ è½½é˜¶æ®µï¼ˆ.exe â†’ å†…å­˜ï¼‰\n\nåŠ è½½å™¨å°†å¯æ‰§è¡Œæ–‡ä»¶åŠ è½½åˆ°å†…å­˜\nå®Œæˆåœ°å€ç»‘å®šï¼ˆAddress Bindingï¼‰\nå¾—åˆ°ç»å¯¹ç‰©ç†åœ°å€\n\n\n\nè™šæ‹Ÿåœ°å€ç©ºé—´çš„å»ºç«‹\næ¯ä¸ªè¿›ç¨‹æ‹¥æœ‰ç‹¬ç«‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´ï¼š\nç”¨æˆ·éƒ¨åˆ†ï¼ˆUser Portionï¼‰\n\ntext sectionï¼šä»£ç æ®µ\ndata sectionï¼šå…¨å±€å˜é‡ã€é™æ€å˜é‡\nheap sectionï¼šåŠ¨æ€åˆ†é…çš„å†…å­˜ï¼ˆå †ï¼‰\nstack sectionï¼šå‡½æ•°è°ƒç”¨ã€å±€éƒ¨å˜é‡ï¼ˆæ ˆï¼‰\n\nå†…æ ¸éƒ¨åˆ†ï¼ˆKernel Portionï¼‰\n\nå­˜å‚¨PCBç­‰å†…æ ¸æ•°æ®ç»“æ„\næ‰€æœ‰è¿›ç¨‹çš„å†…æ ¸éƒ¨åˆ†æ˜ å°„åˆ°åŒä¸€å—ç‰©ç†å†…å­˜ï¼ˆå‚è§Kernel Addresses &amp; Userspace Addressesï¼‰\n\nè¿›ç¨‹åˆ›å»ºæœºåˆ¶\nforkç³»ç»Ÿè°ƒç”¨\nfork()æ˜¯ç³»ç»Ÿè°ƒç”¨ï¼Œç”¨äºåˆ›å»ºå­è¿›ç¨‹ã€‚\nforkçš„æ‰§è¡Œæµç¨‹\n\n\nè§¦å‘ç³»ç»Ÿè°ƒç”¨\n\nç”¨æˆ·ç¨‹åºè°ƒç”¨fork()\nè§¦å‘è½¯ä¸­æ–­ï¼ˆtrapï¼‰\nCPUåˆ‡æ¢åˆ°å†…æ ¸æ€\n\n\n\nå†…æ ¸åˆ›å»ºå­è¿›ç¨‹\n\nåˆ†é…æ–°çš„PCB\nå­è¿›ç¨‹è·å¾—æ–°çš„PID\nå­è¿›ç¨‹çš„PPIDæŒ‡å‘çˆ¶è¿›ç¨‹\nå¤åˆ¶çˆ¶è¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´\n\n\n\nè¿”å›ç”¨æˆ·æ€\n\nçˆ¶è¿›ç¨‹ï¼šfork()è¿”å›å­è¿›ç¨‹çš„PIDï¼ˆéé›¶å€¼ï¼‰\nå­è¿›ç¨‹ï¼šfork()è¿”å›0\nä¸¤ä¸ªè¿›ç¨‹ä»fork()åç»§ç»­æ‰§è¡Œ\n\n\n\nCopy-on-Writeæœºåˆ¶\nCopy-on-Writeï¼ˆCOWï¼‰ä¼˜åŒ–forkçš„æ€§èƒ½ï¼š\nåŸºæœ¬åŸç†\n\nforkåï¼Œçˆ¶å­è¿›ç¨‹æœ€åˆå…±äº«åŒä¸€ä»½ç‰©ç†é¡µ\né¡µè¡¨é¡¹æ ‡è®°ä¸ºåªè¯»\nå½“ä»»ä¸€è¿›ç¨‹å°è¯•å†™å…¥å…±äº«é¡µæ—¶ï¼Œè§¦å‘å†™ä¿æŠ¤å¼‚å¸¸\næ“ä½œç³»ç»Ÿæ­¤æ—¶æ‰çœŸæ­£å¤åˆ¶è¯¥é¡µ\n\nä¼˜åŠ¿\n\nèŠ‚çœå†…å­˜ç©ºé—´\næé«˜forkæ•ˆç‡\nç‰¹åˆ«é€‚ç”¨äºforkåç«‹å³execçš„åœºæ™¯\n\nexecç³»ç»Ÿè°ƒç”¨\nexec()ç”¨æ–°ç¨‹åºè¦†ç›–å½“å‰è¿›ç¨‹çš„åœ°å€ç©ºé—´ã€‚\nexecçš„æ‰§è¡Œæµç¨‹\n\nåŠ è½½æ–°çš„å¯æ‰§è¡Œæ–‡ä»¶\n\nä»ç£ç›˜è¯»å–æ–°ç¨‹åº\nè§£æå¯æ‰§è¡Œæ–‡ä»¶æ ¼å¼\n\n\nè¦†ç›–å½“å‰è™šæ‹Ÿåœ°å€ç©ºé—´\n\né‡Šæ”¾åŸæœ‰çš„é¡µè¡¨æ˜ å°„\nå»ºç«‹æ–°çš„é¡µè¡¨æ˜ å°„\n\n\né‡ç½®æ‰§è¡Œç¯å¢ƒ\n\né‡ç½®ç¨‹åºè®¡æ•°å™¨ï¼ˆPCï¼‰\nä»æ–°ç¨‹åºçš„å…¥å£ç‚¹å¼€å§‹æ‰§è¡Œ\nè¿›ç¨‹PIDä¸å˜\n\n\n\nforkä¸execçš„ç»„åˆä½¿ç”¨\nå…¸å‹ç”¨æ³•ï¼š\n\nçˆ¶è¿›ç¨‹è°ƒç”¨fork()åˆ›å»ºå­è¿›ç¨‹\nå­è¿›ç¨‹è°ƒç”¨exec()æ‰§è¡Œæ–°ç¨‹åº\nçˆ¶è¿›ç¨‹å¯é€‰æ‹©è°ƒç”¨wait()ç­‰å¾…å­è¿›ç¨‹ç»“æŸ\n\nç¤ºä¾‹åœºæ™¯ï¼š\n\nshellæ‰§è¡Œå‘½ä»¤\næœåŠ¡å™¨å¤„ç†è¯·æ±‚\n\nè¿›ç¨‹çš„ç»ˆæ­¢\nè¿›ç¨‹ç»ˆæ­¢çš„æ–¹å¼ï¼ˆå‚è§è¿›ç¨‹çš„ç»ˆæ­¢ï¼‰ï¼š\næ­£å¸¸ç»ˆæ­¢\n\nè°ƒç”¨exit()ç³»ç»Ÿè°ƒç”¨\nmainå‡½æ•°è¿”å›ï¼ˆéšå¼è°ƒç”¨exitï¼‰\n\nå¼‚å¸¸ç»ˆæ­¢\n\nä¿¡å·ç»ˆæ­¢\nå¼‚å¸¸å¯¼è‡´çš„ç»ˆæ­¢\n\nç›¸å…³æ¦‚å¿µ\n\nåƒµå°¸è¿›ç¨‹ï¼ˆzombieï¼‰ï¼šå·²ç»ˆæ­¢ä½†æœªè¢«çˆ¶è¿›ç¨‹å›æ”¶\nå­¤å„¿è¿›ç¨‹ï¼ˆorphanï¼‰ï¼šçˆ¶è¿›ç¨‹å…ˆäºå­è¿›ç¨‹ç»ˆæ­¢\n\nç›¸å…³æ¦‚å¿µ\n\n01 introduction - æ“ä½œç³»ç»Ÿæ¦‚è¿°ã€ä¸­æ–­ã€ç‰¹æƒæ¨¡å¼ã€å¼•å¯¼\n02.1 è¿›ç¨‹ - è¿›ç¨‹æ¦‚å¿µã€PCBã€è¿›ç¨‹åˆ›å»ºä¸ç»ˆæ­¢\n02.2 è°ƒåº¦ - è¿›ç¨‹çŠ¶æ€ã€å°±ç»ªé˜Ÿåˆ—ã€ç­‰å¾…é˜Ÿåˆ—\n04.1 ä¸»å­˜ - å†…å­˜ä¿æŠ¤ã€åˆ†é¡µã€é¡µè¡¨ã€å¸§è¡¨\n04.2 virtual memory - è™šæ‹Ÿåœ°å€ç©ºé—´ã€COWæœºåˆ¶\n"},"è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/æµç¨‹æ€»è§ˆ/02-å†…å­˜ç®¡ç†":{"slug":"è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/æµç¨‹æ€»è§ˆ/02-å†…å­˜ç®¡ç†","filePath":"è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/æµç¨‹æ€»è§ˆ/02 å†…å­˜ç®¡ç†.md","title":"02 å†…å­˜ç®¡ç†","links":["è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/02.1-è¿›ç¨‹","è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/04.1-ä¸»å­˜","è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/04.2-virtual-memory"],"tags":[],"content":"\n\nç‰©ç†å†…å­˜\n\né«˜åœ°å€ åŠ¨æ€åˆ†é…åŒºåŸŸ.å‰©ä¸‹çš„ç©ºé—²å†…å­˜,æ‰€æœ‰åæ¥åˆ›å»ºçš„ä¸œè¥¿éƒ½å¡åœ¨è¿™é‡Œ\n\nç”¨æˆ·è¿›ç¨‹ä»£ç (ä»ç£ç›˜è¯»è¿›æ¥çš„)\nç”¨æˆ·æ ˆ\nå†…æ ¸æ ˆ\né¡µè¡¨\nç­‰ç­‰ç­‰ éƒ½æ˜¯åŠ¨æ€ä¸”å¯èƒ½ä¸è¿ç»­çš„\n\n\nä½åœ°å€ å†…æ ¸çš„ä»£ç å’Œé™æ€æ•°æ®.\n\n_ekernel å†…æ ¸ç»“æŸ\n.bss æœªåˆå§‹åŒ–æ•°æ®(å…¨å±€å˜é‡ä¹‹ç±»çš„)\n.data æ•°æ®+uapp\n.rodata åªè¯»æ•°æ®\n.text ä»£ç \næœ€ä½çš„80000000å¼€å§‹ opensbi(2MB)\n\n\n\n\n\nè™šæ‹Ÿå†…å­˜\n\né«˜åœ°å€ æ˜ å°„åˆ°ç‰©ç†å†…å­˜çš„ä½å¤„å›ºå®šé™æ€åŒºåŸŸ.ä¹Ÿæœ‰å†…æ ¸æ ˆä¼šæ˜ å°„åˆ°ç‰©ç†å†…å­˜é«˜å¤„åŠ¨æ€åˆ†é…åŒºåŸŸ\nç©ºæ´ ä¸å¯è¾¾,åšåŒºåˆ†ç”¨\nä½åœ°å€\n\né€šè¿‡é¡µè¡¨,å¯ä»¥å°†è¿™äº›ä½çš„è™šæ‹Ÿåœ°å€,æ˜ å°„åˆ°ç‰©ç†å†…å­˜çš„é«˜å¤„åŠ¨æ€åˆ†é…åŒºåŸŸ\n\n\n\n\n\nè™šæ‹Ÿå†…å­˜æ¦‚è¿°\nåŸºæœ¬æ¦‚å¿µ\nè™šæ‹Ÿå†…å­˜çš„ä½œç”¨\n\næ¯ä¸ªè¿›ç¨‹æ‹¥æœ‰ç‹¬ç«‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´\nCPUä½¿ç”¨è™šæ‹Ÿåœ°å€ï¼Œç”±MMUï¼ˆå†…å­˜ç®¡ç†å•å…ƒï¼‰è‡ªåŠ¨è½¬æ¢ä¸ºç‰©ç†åœ°å€\nå®ç°è¿›ç¨‹é—´çš„éš”ç¦»ä¸ä¿æŠ¤\n\nè™šæ‹Ÿåœ°å€ç©ºé—´çš„ç»“æ„\n\nç”¨æˆ·ç©ºé—´ï¼ˆUser Portionï¼‰ï¼š0 ~ 3GBï¼ˆ32ä½ç³»ç»Ÿï¼‰\nå†…æ ¸ç©ºé—´ï¼ˆKernel Portionï¼‰ï¼š3GB ~ 4GBï¼ˆ32ä½ç³»ç»Ÿï¼‰\næ‰€æœ‰è¿›ç¨‹çš„å†…æ ¸ç©ºé—´æ˜ å°„åˆ°åŒä¸€å—ç‰©ç†å†…å­˜ï¼ˆå‚è§Kernel Addresses &amp; Userspace Addressesï¼‰\n\nè™šæ‹Ÿå†…å­˜çš„ä¼˜åŠ¿\n\néš”ç¦»æ€§ï¼šæ¯ä¸ªè¿›ç¨‹æ‹¥æœ‰ç‹¬ç«‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œäº’ä¸å¹²æ‰°\nçµæ´»æ€§ï¼šè¿›ç¨‹å¯ä»¥ä½¿ç”¨æ¯”ç‰©ç†å†…å­˜æ›´å¤§çš„è™šæ‹Ÿåœ°å€ç©ºé—´\næ•ˆç‡ï¼šé€šè¿‡æŒ‰éœ€åˆ†é¡µå’Œé¡µé¢ç½®æ¢ï¼Œæé«˜å†…å­˜åˆ©ç”¨ç‡\nå…±äº«æ€§ï¼šå¤šä¸ªè¿›ç¨‹å¯ä»¥å…±äº«åŒä¸€å—ç‰©ç†å†…å­˜\n\nåˆ†é¡µæœºåˆ¶\nåŸºæœ¬åŸç†\nç°ä»£æ“ä½œç³»ç»Ÿä½¿ç”¨åˆ†é¡µï¼ˆPagingï¼‰æœºåˆ¶ç®¡ç†å†…å­˜ã€‚\nç‰©ç†å†…å­˜åˆ†å¸§\n\nå°†ç‰©ç†å†…å­˜åˆ‡åˆ†ä¸ºç­‰å¤§å°çš„å¸§ï¼ˆframeï¼‰\né€šå¸¸å¤§å°ä¸º4KB\n\nè™šæ‹Ÿå†…å­˜åˆ†é¡µ\n\nå°†è™šæ‹Ÿåœ°å€ç©ºé—´åˆ‡åˆ†ä¸ºç­‰å¤§å°çš„é¡µï¼ˆpageï¼‰\nå¤§å°ä¸å¸§ç›¸åŒ\n\né¡µè¡¨æ˜ å°„\n\né€šè¿‡é¡µè¡¨å»ºç«‹é¡µåˆ°å¸§çš„æ˜ å°„å…³ç³»\né¡µè¡¨å­˜å‚¨åœ¨å†…å­˜ä¸­\nPTBRï¼ˆPage-Table Base Registerï¼‰æŒ‡å‘é¡µè¡¨åŸºåœ°å€\n\nåœ°å€è½¬æ¢è¿‡ç¨‹\nCPUç”Ÿæˆçš„è™šæ‹Ÿåœ°å€è½¬æ¢ä¸ºç‰©ç†åœ°å€ï¼š\n\nCPUç”Ÿæˆè™šæ‹Ÿåœ°å€ï¼ˆpage number + offsetï¼‰\nMMUæ ¹æ®é¡µè¡¨å°†page numberè½¬æ¢ä¸ºframe number\nç‰©ç†åœ°å€ = frame number + offset\n\nåœ°å€ç»“æ„\n\nè™šæ‹Ÿåœ°å€ = é¡µå·ï¼ˆpï¼‰ + é¡µå†…åç§»ï¼ˆdï¼‰\nç‰©ç†åœ°å€ = å¸§å·ï¼ˆfï¼‰ + é¡µå†…åç§»ï¼ˆdï¼‰\né¡µå†…åç§»åœ¨è½¬æ¢å‰åä¿æŒä¸å˜\n\né¡µè¡¨çš„ç¡¬ä»¶å®ç°\né¡µè¡¨å­˜å‚¨æ–¹å¼\nå¯„å­˜å™¨æ–¹å¼\n\nä¼˜ç‚¹ï¼šè®¿é—®é€Ÿåº¦å¿«\nç¼ºç‚¹ï¼šé¡µè¡¨å¤§å°å—é™ï¼Œä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€å¤§\né€‚ç”¨äºå°å‹é¡µè¡¨\n\nå†…å­˜æ–¹å¼\n\nPTBRæŒ‡å‘é¡µè¡¨åŸºåœ°å€\nä¼˜ç‚¹ï¼šæ”¯æŒå¤§å‹é¡µè¡¨\nç¼ºç‚¹ï¼šæ¯æ¬¡åœ°å€è½¬æ¢éœ€è¦ä¸¤æ¬¡å†…å­˜è®¿é—®\n\nTLBåŠ é€Ÿæœºåˆ¶\nTLBï¼ˆTranslation Look-aside Bufferï¼‰æ˜¯é¡µè¡¨çš„é«˜é€Ÿç¼“å­˜ï¼š\nå·¥ä½œåŸç†\n\nCPUè®¿é—®è™šæ‹Ÿåœ°å€æ—¶ï¼Œé¦–å…ˆæŸ¥è¯¢TLB\nTLBå‘½ä¸­ï¼šç›´æ¥è·å¾—ç‰©ç†åœ°å€ï¼ˆä¸€æ¬¡å†…å­˜è®¿é—®ï¼‰\nTLBæœªå‘½ä¸­ï¼šè®¿é—®å†…å­˜ä¸­çš„é¡µè¡¨ï¼ˆä¸¤æ¬¡å†…å­˜è®¿é—®ï¼‰ï¼Œå¹¶å°†ç»“æœå­˜å…¥TLB\n\nTLBç‰¹ç‚¹\n\næ”¯æŒå¹¶è¡Œæœç´¢ï¼ˆassociative memoryï¼‰\né€šå¸¸åŒ…å«64~1024ä¸ªæ¡ç›®\næ¯ä¸ªæ¡ç›®åŒ…å«ï¼špage number â†’ frame number\n\nTLBä¸è¿›ç¨‹åˆ‡æ¢\n\næ¯ä¸ªè¿›ç¨‹æœ‰è‡ªå·±çš„é¡µè¡¨ï¼Œåˆ‡æ¢æ—¶éœ€è¦å¤„ç†TLB\næ–¹æ³•1ï¼šflush TLBï¼ˆæ¸…ç©ºæ‰€æœ‰TLBæ¡ç›®ï¼‰\næ–¹æ³•2ï¼šä½¿ç”¨ASIDï¼ˆAddress-Space Identifierï¼‰\n\nTLBæ¡ç›®åŒæ—¶å­˜å‚¨ASID\nåŒ¹é…æ—¶åŒæ—¶æ£€æŸ¥page numberå’ŒASID\né¿å…é¢‘ç¹æ¸…ç©ºTLB\n\n\n\nå¤šçº§é¡µè¡¨\nä¸ºè§£å†³é¡µè¡¨å ç”¨è¿‡å¤šè¿ç»­å†…å­˜çš„é—®é¢˜ï¼Œé‡‡ç”¨å¤šçº§é¡µè¡¨ç»“æ„ã€‚\nåŸºæœ¬æ€æƒ³\n\nå¯¹é¡µè¡¨è¿›è¡Œåˆ†é¡µ\nå¤–å±‚é¡µè¡¨æŒ‡å‘å†…å±‚é¡µè¡¨\nå†…å±‚é¡µè¡¨å­˜å‚¨å®é™…çš„frame number\n\näºŒçº§é¡µè¡¨ç¤ºä¾‹\n\nè™šæ‹Ÿåœ°å€ = å¤–å±‚é¡µå·ï¼ˆp1ï¼‰ + å†…å±‚é¡µå·ï¼ˆp2ï¼‰ + é¡µå†…åç§»ï¼ˆdï¼‰\né€šè¿‡p1ç´¢å¼•å¤–å±‚é¡µè¡¨ï¼Œå¾—åˆ°å†…å±‚é¡µè¡¨åŸºåœ°å€\né€šè¿‡p2ç´¢å¼•å†…å±‚é¡µè¡¨ï¼Œå¾—åˆ°frame number\n\nä¼˜åŠ¿\n\né¡µè¡¨ä¸éœ€è¦å ç”¨è¿ç»­å†…å­˜\næœªä½¿ç”¨çš„å†…å±‚é¡µè¡¨å¯ä»¥ä¸åˆ†é…\nèŠ‚çœå†…å­˜ç©ºé—´\n\næŒ‰éœ€åˆ†é¡µ\nLazy Allocationæœºåˆ¶\næ“ä½œç³»ç»Ÿé‡‡ç”¨å»¶è¿Ÿåˆ†é…ï¼ˆLazy Allocationï¼‰ç­–ç•¥ï¼š\nåŸºæœ¬æµç¨‹\n\nè¿›ç¨‹ç”³è¯·å†…å­˜æ—¶ï¼Œæ“ä½œç³»ç»Ÿåªæ‰©å¤§è™šæ‹Ÿåœ°å€ç©ºé—´\nä¸ç«‹å³åˆ†é…ç‰©ç†å†…å­˜\nå½“è¿›ç¨‹é¦–æ¬¡è®¿é—®è¯¥è™šæ‹Ÿåœ°å€æ—¶ï¼Œè§¦å‘ç¼ºé¡µä¸­æ–­ï¼ˆpage faultï¼‰\næ“ä½œç³»ç»Ÿåœ¨ä¸­æ–­å¤„ç†ç¨‹åºä¸­åˆ†é…ç‰©ç†å†…å­˜\n\nä¼˜åŠ¿\n\nèŠ‚çœç‰©ç†å†…å­˜\næé«˜ç³»ç»Ÿå“åº”é€Ÿåº¦\nå¾ˆå¤šç”³è¯·çš„å†…å­˜å®é™…ä¸ä¼šè¢«ä½¿ç”¨\n\nç¼ºé¡µä¸­æ–­å¤„ç†æµç¨‹\nå½“è¿›ç¨‹è®¿é—®çš„è™šæ‹Ÿåœ°å€å¯¹åº”çš„é¡µé¢ä¸åœ¨ç‰©ç†å†…å­˜ä¸­ï¼š\n\n\nè§¦å‘page fault\n\nMMUåœ¨é¡µè¡¨ä¸­æŸ¥æ‰¾\nå‘ç°valid bitä¸ºinvalid\nCPUè§¦å‘page faultå¼‚å¸¸ï¼Œåˆ‡æ¢åˆ°å†…æ ¸æ€\n\n\n\næ£€æŸ¥é¡µé¢åˆæ³•æ€§\n\næ£€æŸ¥è™šæ‹Ÿåœ°å€æ˜¯å¦åœ¨è¿›ç¨‹çš„åˆæ³•åœ°å€ç©ºé—´å†…\næ£€æŸ¥è®¿é—®æƒé™ï¼ˆè¯»/å†™/æ‰§è¡Œï¼‰\néæ³•è®¿é—®åˆ™ç»ˆæ­¢è¿›ç¨‹\n\n\n\nåˆ†é…ç‰©ç†å¸§\n\nå¦‚æœæœ‰ç©ºé—²å¸§ï¼Œç›´æ¥ä½¿ç”¨\nå¦‚æœæ²¡æœ‰ç©ºé—²å¸§ï¼Œæ‰§è¡Œé¡µé¢ç½®æ¢ç®—æ³•\n\n\n\nè°ƒå…¥é¡µé¢\n\né¡µé¢åœ¨ç£ç›˜ä¸Šï¼ˆè¢«swap outï¼‰ï¼šä»backing storeè¯»å–\né¡µé¢æ˜¯é¦–æ¬¡è®¿é—®ï¼šåˆ†é…æ–°çš„é›¶é¡µ\n\n\n\næ›´æ–°é¡µè¡¨\n\nå»ºç«‹è™šæ‹Ÿé¡µåˆ°ç‰©ç†å¸§çš„æ˜ å°„\nè®¾ç½®valid bitä¸ºæœ‰æ•ˆ\næ›´æ–°TLB\n\n\n\né‡æ–°æ‰§è¡ŒæŒ‡ä»¤\n\nè¿”å›åˆ°ç”¨æˆ·æ€\né‡æ–°æ‰§è¡Œè§¦å‘page faultçš„æŒ‡ä»¤\n\n\n\né¡µé¢ç½®æ¢\nåŸºæœ¬æ¦‚å¿µ\nå½“ç‰©ç†å†…å­˜ä¸è¶³æ—¶ï¼Œéœ€è¦å°†æŸäº›é¡µé¢æ¢å‡ºåˆ°ç£ç›˜ã€‚\nç½®æ¢æµç¨‹\n\né€‰æ‹©victim frame\n\nä½¿ç”¨é¡µé¢ç½®æ¢ç®—æ³•\n\n\nå†™å›ç£ç›˜\n\nå¦‚æœé¡µé¢è¢«ä¿®æ”¹è¿‡ï¼ˆdirty bit=1ï¼‰ï¼Œå°†å…¶å†™å›ç£ç›˜\næœªä¿®æ”¹è¿‡çš„é¡µé¢å¯ä»¥ç›´æ¥ä¸¢å¼ƒ\n\n\nè°ƒå…¥æ–°é¡µé¢\n\nå°†éœ€è¦çš„é¡µé¢ä»ç£ç›˜è°ƒå…¥åˆ°victim frame\n\n\næ›´æ–°é¡µè¡¨\n\nå°†victimé¡µé¢çš„é¡µè¡¨é¡¹è®¾ç½®ä¸ºæ— æ•ˆ\nè®°å½•é¡µé¢åœ¨ç£ç›˜çš„ä½ç½®\n\n\n\né¡µé¢ç½®æ¢ç®—æ³•\nè¯¦è§é¡µé¢ç½®æ¢ç®—æ³• (page replacement algorithms)\nå¸¸è§ç®—æ³•\n\nFIFOï¼ˆFirst In First Outï¼‰ï¼šæœ€ç®€å•ï¼Œå¯èƒ½æœ‰Beladyå¼‚å¸¸\nOptimalï¼šç†è®ºæœ€ä¼˜ï¼Œå®é™…æ— æ³•å®ç°\nLRUï¼ˆLeast Recently Usedï¼‰ï¼šè¿‘ä¼¼æœ€ä¼˜ï¼Œå¼€é”€è¾ƒå¤§\nLRU-Approximationï¼šä½¿ç”¨reference bitè¿‘ä¼¼å®ç°\n\nreference bitæœºåˆ¶\n\næ¯ä¸ªé¡µé¢å…³è”ä¸€ä¸ªreference bit\né¡µé¢è¢«è®¿é—®æ—¶ç½®ä¸º1\næ“ä½œç³»ç»Ÿå®šæœŸæ¸…é›¶\nç½®æ¢æ—¶é€‰æ‹©reference bitä¸º0çš„é¡µé¢\n\nè¿›ç¨‹é—´å†…å­˜å…±äº«\nå¤šä¸ªè¿›ç¨‹å¯ä»¥å…±äº«åŒä¸€å—ç‰©ç†å†…å­˜ï¼š\nå…±äº«ä»£ç \nå‚è§Shared Pages\nåº”ç”¨åœºæ™¯\n\nå¤šä¸ªè¿›ç¨‹æ‰§è¡ŒåŒä¸€ç¨‹åºæ—¶\nå¯ä»¥å…±äº«textæ®µï¼ˆä»£ç æ®µï¼‰\n\nå®ç°æ–¹å¼\n\nä¸åŒè¿›ç¨‹çš„é¡µè¡¨ä¸­ï¼Œä¸åŒçš„è™šæ‹Ÿé¡µæ˜ å°„åˆ°åŒä¸€ç‰©ç†å¸§\n\nè¦æ±‚\n\nä»£ç å¿…é¡»æ˜¯å¯é‡å…¥çš„ï¼ˆreentrant codeï¼‰\n\nå…±äº«å†…å­˜IPC\nå‚è§è¿›ç¨‹é—´é€šä¿¡\nåº”ç”¨åœºæ™¯\n\nè¿›ç¨‹é—´é€šä¿¡ï¼ˆIPCï¼‰\né«˜æ•ˆçš„æ•°æ®å…±äº«\n\nå®ç°æ–¹å¼\n\né€šè¿‡ç³»ç»Ÿè°ƒç”¨å»ºç«‹å…±äº«å†…å­˜åŒºåŸŸ\nå¤šä¸ªè¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´æ˜ å°„åˆ°åŒä¸€ç‰©ç†å†…å­˜\n\næ³¨æ„äº‹é¡¹\n\néœ€è¦åŒæ­¥æœºåˆ¶ï¼ˆå¦‚ä¿¡å·é‡ï¼‰ä¿æŠ¤å…±äº«æ•°æ®\né¿å…race condition\n\nå†…å­˜ä¿æŠ¤\né¡µè¡¨ä¿æŠ¤ä½\nå‚è§å†…å­˜ä¿æŠ¤æœºåˆ¶Protectionå’ŒMemory Protectionå†…å­˜ä¿æŠ¤\nvalid-invalid bit\n\nvalidï¼šé¡µé¢åœ¨è¿›ç¨‹çš„åˆæ³•åœ°å€ç©ºé—´å†…\ninvalidï¼šé¡µé¢ä¸å±äºè¯¥è¿›ç¨‹ï¼Œè®¿é—®ä¼šè§¦å‘trap\n\næƒé™ä½\n\nè¯»æƒé™ï¼ˆRï¼‰\nå†™æƒé™ï¼ˆWï¼‰\næ‰§è¡Œæƒé™ï¼ˆXï¼‰\n\nä¿æŠ¤æœºåˆ¶\n\nMMUåœ¨åœ°å€è½¬æ¢æ—¶æ£€æŸ¥æƒé™\néæ³•è®¿é—®è§¦å‘å¼‚å¸¸\næ“ä½œç³»ç»Ÿå¤„ç†å¼‚å¸¸ï¼ˆé€šå¸¸ç»ˆæ­¢è¿›ç¨‹ï¼‰\n\nbaseå’Œlimitå¯„å­˜å™¨\nå‚è§å†…å­˜ä¿æŠ¤æœºåˆ¶Protection\nä¼ ç»Ÿä¿æŠ¤æ–¹å¼\n\nbaseå¯„å­˜å™¨ï¼šè¿›ç¨‹åœ°å€ç©ºé—´çš„èµ·å§‹åœ°å€\nlimitå¯„å­˜å™¨ï¼šè¿›ç¨‹åœ°å€ç©ºé—´çš„å¤§å°\næ¯æ¬¡è®¿é—®æ£€æŸ¥ï¼šbase â‰¤ åœ°å€ &lt; base + limit\n\nç›¸å…³æ¦‚å¿µ\n\n04.1 ä¸»å­˜ - å†…å­˜åˆ†é…ã€åˆ†é¡µã€é¡µè¡¨ã€TLBã€å¸§è¡¨\n04.2 virtual memory - è™šæ‹Ÿå†…å­˜ã€æŒ‰éœ€åˆ†é¡µã€é¡µé¢ç½®æ¢\n02.1 è¿›ç¨‹ - è¿›ç¨‹åœ°å€ç©ºé—´ã€è¿›ç¨‹é—´é€šä¿¡\n"},"è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/æµç¨‹æ€»è§ˆ/03-è¿›ç¨‹è°ƒåº¦":{"slug":"è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/æµç¨‹æ€»è§ˆ/03-è¿›ç¨‹è°ƒåº¦","filePath":"è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/æµç¨‹æ€»è§ˆ/03 è¿›ç¨‹è°ƒåº¦.md","title":"03 è¿›ç¨‹è°ƒåº¦","links":["è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/02.2-è°ƒåº¦","è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/01-introduction","è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/02.1-è¿›ç¨‹","è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/04.1-ä¸»å­˜","è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/02.3-çº¿ç¨‹"],"tags":[],"content":"è¿›ç¨‹çŠ¶æ€\näº”ç§åŸºæœ¬çŠ¶æ€\nè¿›ç¨‹åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ä¼šç»å†ä»¥ä¸‹è¿›ç¨‹çŠ¶æ€ï¼š\nNewï¼ˆæ–°å»ºï¼‰\n\nè¿›ç¨‹æ­£åœ¨åˆ›å»ºè¿‡ç¨‹ä¸­\nåŒ…æ‹¬ç”³è¯·PCBã€åˆ†é…åˆå§‹èµ„æºç­‰\n\nReadyï¼ˆå°±ç»ªï¼‰\n\nè¿›ç¨‹å·²å‡†å¤‡å¥½ï¼Œç­‰å¾…CPUèµ„æº\nä¸€æ—¦è·å¾—CPUå°±å¯ä»¥ç«‹å³æ‰§è¡Œ\n\nRunningï¼ˆè¿è¡Œï¼‰\n\nè¿›ç¨‹æ­£åœ¨ä½¿ç”¨CPUæ‰§è¡Œ\nå•æ ¸ç³»ç»Ÿä¸­åŒæ—¶åªæœ‰ä¸€ä¸ªè¿›ç¨‹å¤„äºRunningçŠ¶æ€\nå¤šæ ¸ç³»ç»Ÿä¸­Runningè¿›ç¨‹æ•°ä¸è¶…è¿‡æ ¸å¿ƒæ•°\n\nWaitingï¼ˆç­‰å¾…ï¼‰\n\nè¿›ç¨‹ç­‰å¾…æŸä¸ªäº‹ä»¶ï¼ˆå¦‚I/Oå®Œæˆã€ä¿¡å·ç­‰ï¼‰\nå³ä½¿æœ‰ç©ºä½™çš„CPUèµ„æºï¼Œè¯¥è¿›ç¨‹ä¹Ÿæ— æ³•ç»§ç»­\nä»Runningåˆ°Waitingé€šå¸¸æ˜¯ä¸»åŠ¨çš„\n\nTerminatedï¼ˆç»ˆæ­¢ï¼‰\n\nè¿›ç¨‹å·²ç»“æŸ\néœ€è¦é‡Šæ”¾èµ„æº\n\nçŠ¶æ€è½¬æ¢\nReady â†’ Running\n\nè¢«è°ƒåº¦å™¨é€‰ä¸­\nè·å¾—CPUèµ„æº\nç§°ä¸ºæ´¾å‘ï¼ˆdispatchï¼‰\n\nRunning â†’ Ready\n\næ—¶é—´ç‰‡ç”¨å®Œï¼ˆtimerä¸­æ–­ï¼‰\nè¢«æ›´é«˜ä¼˜å…ˆçº§è¿›ç¨‹æŠ¢å \nä»Runningåˆ°Readyæ˜¯è¢«åŠ¨çš„\n\nRunning â†’ Waiting\n\nä¸»åŠ¨ç­‰å¾…ï¼ˆç³»ç»Ÿè°ƒç”¨ã€I/Oè¯·æ±‚ï¼‰\néœ€è¦ç­‰å¾…æŸä¸ªäº‹ä»¶å‘ç”Ÿ\n\nWaiting â†’ Ready\n\nç­‰å¾…çš„äº‹ä»¶å‘ç”Ÿï¼ˆå¦‚I/Oå®Œæˆï¼‰\nè¢«ä¸­æ–­å”¤é†’\nWaitingä¸èƒ½ç›´æ¥è¿›å…¥Runningï¼Œå¿…é¡»ç»è¿‡Ready\n\né˜Ÿåˆ—ç®¡ç†\nå°±ç»ªé˜Ÿåˆ—å’Œç­‰å¾…é˜Ÿåˆ—\nå‚è§å°±ç»ªé˜Ÿåˆ—(ready queue)å’Œç­‰å¾…é˜Ÿåˆ—(wait queue)\nå°±ç»ªé˜Ÿåˆ—ï¼ˆReady Queueï¼‰\n\nå­˜æ”¾å¤„äºReadyçŠ¶æ€çš„è¿›ç¨‹\nå®é™…ä¸Šæ˜¯PCBçš„é˜Ÿåˆ—\nè°ƒåº¦å™¨ä»å°±ç»ªé˜Ÿåˆ—é€‰æ‹©è¿›ç¨‹æ‰§è¡Œ\n\nç­‰å¾…é˜Ÿåˆ—ï¼ˆWait Queueï¼‰\n\nå­˜æ”¾å¤„äºWaitingçŠ¶æ€çš„è¿›ç¨‹\næ ¹æ®ç­‰å¾…çš„äº‹ä»¶ç±»å‹å¯èƒ½æœ‰å¤šä¸ªç­‰å¾…é˜Ÿåˆ—\n\nI/Oè®¾å¤‡ç­‰å¾…é˜Ÿåˆ—\nä¿¡å·é‡ç­‰å¾…é˜Ÿåˆ—\nå…¶ä»–äº‹ä»¶ç­‰å¾…é˜Ÿåˆ—\n\n\n\né˜Ÿåˆ—æ“ä½œ\n\nå®é™…ä¸Šæ˜¯ç§»åŠ¨PCBæŒ‡é’ˆåœ¨ä¸åŒé˜Ÿåˆ—ä¹‹é—´\nç”±å†…æ ¸è´Ÿè´£ç®¡ç†\n\nè°ƒåº¦æ—¶æœº\néæŠ¢å å¼è°ƒåº¦\nå‚è§è°ƒåº¦çš„æ—¶æœº\nè§¦å‘æ¡ä»¶\n\nè¿›ç¨‹ä¸»åŠ¨é‡Šæ”¾CPU\nè¿›å…¥WaitingçŠ¶æ€ï¼ˆç³»ç»Ÿè°ƒç”¨ã€I/Oè¯·æ±‚ï¼‰\nè¿›ç¨‹ç»ˆæ­¢\n\nç‰¹ç‚¹\n\nè¿›ç¨‹è‡ªæ„¿æ”¾å¼ƒCPU\nè°ƒåº¦å¼€é”€å°\nå“åº”æ—¶é—´å¯èƒ½è¾ƒé•¿\n\næŠ¢å å¼è°ƒåº¦\nå‚è§è°ƒåº¦çš„æ—¶æœº\nè§¦å‘æ¡ä»¶\n\næ—¶é—´ç‰‡ç”¨å®Œï¼ˆtimerä¸­æ–­ï¼‰\næ›´é«˜ä¼˜å…ˆçº§çš„è¿›ç¨‹å˜ä¸ºReadyçŠ¶æ€\nå½“å‰è¿›ç¨‹è¢«ä¸­æ–­æ‰“æ–­\n\nç‰¹ç‚¹\n\nå¼ºåˆ¶æ€§è°ƒåº¦\nè°ƒåº¦å¼€é”€è¾ƒå¤§\nå“åº”æ—¶é—´æ›´çŸ­\nç°ä»£æ“ä½œç³»ç»Ÿæ™®éé‡‡ç”¨\n\nä¸Šä¸‹æ–‡åˆ‡æ¢\nåŸºæœ¬æ¦‚å¿µ\nä¸Šä¸‹æ–‡åˆ‡æ¢ï¼ˆcontext switchï¼‰æ˜¯è¿›ç¨‹åˆ‡æ¢çš„æ ¸å¿ƒæœºåˆ¶ã€‚\nä¸Šä¸‹æ–‡åŒ…å«çš„å†…å®¹\n\nCPUå¯„å­˜å™¨çš„å€¼ï¼ˆé€šç”¨å¯„å­˜å™¨ã€PCã€SPç­‰ï¼‰\nè¿›ç¨‹çŠ¶æ€ä¿¡æ¯\nå†…å­˜ç®¡ç†ä¿¡æ¯ï¼ˆé¡µè¡¨æŒ‡é’ˆç­‰ï¼‰\n\nå®Œæ•´åˆ‡æ¢æµç¨‹\nå½“è°ƒåº¦å™¨å†³å®šåˆ‡æ¢åˆ°å¦ä¸€ä¸ªè¿›ç¨‹æ—¶ï¼š\n1. ä¿å­˜å½“å‰è¿›ç¨‹çš„ä¸Šä¸‹æ–‡\n\nä¿å­˜CPUå¯„å­˜å™¨åˆ°å½“å‰è¿›ç¨‹çš„PCB\n\nç¨‹åºè®¡æ•°å™¨ï¼ˆPCï¼‰\né€šç”¨å¯„å­˜å™¨\næ ˆæŒ‡é’ˆï¼ˆSPï¼‰\n\n\nä¿å­˜è¿›ç¨‹çŠ¶æ€\nä¿å­˜å†…å­˜ç®¡ç†ä¿¡æ¯\n\n2. æ›´æ–°è¿›ç¨‹çŠ¶æ€\n\nå°†å½“å‰è¿›ç¨‹ä»RunningçŠ¶æ€æ”¹ä¸ºReadyæˆ–Waiting\nå°†å½“å‰è¿›ç¨‹çš„PCBç§»å…¥ç›¸åº”çš„é˜Ÿåˆ—\n\næ—¶é—´ç‰‡ç”¨å®Œ â†’ Ready Queue\nç­‰å¾…äº‹ä»¶ â†’ Wait Queue\n\n\n\n3. é€‰æ‹©ä¸‹ä¸€ä¸ªè¿›ç¨‹\n\nè°ƒåº¦å™¨ä»Ready Queueä¸­é€‰æ‹©\næ ¹æ®è°ƒåº¦ç®—æ³•å†³å®šï¼ˆå‚è§è°ƒåº¦ç®—æ³•ï¼‰\n\nFCFSï¼ˆFirst-Come, First-Servedï¼‰\nSJFï¼ˆShortest-Job-Firstï¼‰\nRRï¼ˆRound-Robinï¼‰\nPriority Scheduling\nå¤šçº§é˜Ÿåˆ—è°ƒåº¦\n\n\n\n4. æ¢å¤ä¸‹ä¸€ä¸ªè¿›ç¨‹çš„ä¸Šä¸‹æ–‡\n\nåŠ è½½æ–°è¿›ç¨‹çš„PCBä¸­çš„å¯„å­˜å™¨å€¼\næ¢å¤CPUçŠ¶æ€\n\nå†…å­˜ç®¡ç†æ“ä½œ\n\næ›´æ–°PTBRæŒ‡å‘æ–°è¿›ç¨‹çš„é¡µè¡¨\nä¸åŒè¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´è¢«éš”ç¦»\n\nTLBç®¡ç†ï¼ˆå‚è§TLBï¼‰\n\næ–¹æ³•1ï¼šflush TLBï¼ˆæ¸…ç©ºæ‰€æœ‰TLBæ¡ç›®ï¼‰\n\nç®€å•ä½†å¼€é”€å¤§\nä¸‹æ¬¡è®¿é—®éœ€è¦é‡æ–°åŠ è½½TLB\n\n\næ–¹æ³•2ï¼šä½¿ç”¨ASIDï¼ˆAddress-Space Identifierï¼‰\n\nTLBæ¡ç›®åŒæ—¶å­˜å‚¨ASIDå’Œpage number\nåˆ‡æ¢æ—¶ä¸éœ€è¦æ¸…ç©ºTLB\nå‡å°‘TLB miss\n\n\n\nå†…å­˜ä¿æŠ¤ï¼ˆå‚è§å†…å­˜ä¿æŠ¤æœºåˆ¶Protectionï¼‰\n\né€šè¿‡é¡µè¡¨çš„ä¿æŠ¤ä½ç¡®ä¿è¿›ç¨‹åªèƒ½è®¿é—®è‡ªå·±çš„è™šæ‹Ÿåœ°å€ç©ºé—´\nvalid-invalid bit\nè¯»å†™æ‰§è¡Œæƒé™ä½\n\n5. åˆ‡æ¢åˆ°æ–°è¿›ç¨‹\n\næ›´æ–°è¿›ç¨‹çŠ¶æ€ä¸ºRunning\nè®¾ç½®CPUçš„mode bitä¸ºç”¨æˆ·æ€\nè·³è½¬åˆ°æ–°è¿›ç¨‹çš„PCæŒ‡å‘çš„æŒ‡ä»¤ç»§ç»­æ‰§è¡Œ\n\nä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€\næ—¶é—´å¼€é”€\n\nä¿å­˜å’Œæ¢å¤å¯„å­˜å™¨\nåˆ‡æ¢é¡µè¡¨\nå¯èƒ½éœ€è¦flush TLB\næ›´æ–°å†…æ ¸æ•°æ®ç»“æ„\nå…¸å‹çš„context switchæ—¶é—´çº¦ä¸º10Î¼s\n\næ€§èƒ½å½±å“\n\né¢‘ç¹åˆ‡æ¢ä¼šé™ä½ç³»ç»Ÿæ•ˆç‡\néœ€è¦åœ¨å“åº”æ—¶é—´å’Œæ•ˆç‡ä¹‹é—´å¹³è¡¡\n\nä¸­æ–­é©±åŠ¨çš„è°ƒåº¦\nä¸­æ–­æœºåˆ¶\nç°ä»£æ“ä½œç³»ç»Ÿæ˜¯ä¸­æ–­é©±åŠ¨çš„ã€‚\nä¸­æ–­çš„ä½œç”¨\n\næä¾›è°ƒåº¦çš„æ—¶æœº\nå“åº”å¤–éƒ¨äº‹ä»¶\nå¤„ç†å¼‚å¸¸æƒ…å†µ\n\nTimerä¸­æ–­\nå‚è§è®¡æ—¶å™¨ timer\nå·¥ä½œæµç¨‹\n\nè®¡æ—¶å™¨å®šæœŸäº§ç”Ÿä¸­æ–­ï¼ˆå¦‚æ¯10msï¼‰\nCPUä¿å­˜å½“å‰ä¸Šä¸‹æ–‡ï¼Œè·³è½¬åˆ°ä¸­æ–­å¤„ç†ç¨‹åº\nä¸­æ–­å¤„ç†ç¨‹åºæ£€æŸ¥å½“å‰è¿›ç¨‹çš„æ—¶é—´ç‰‡æ˜¯å¦ç”¨å®Œ\nå¦‚æœç”¨å®Œï¼Œè§¦å‘è°ƒåº¦ï¼Œå°†å½“å‰è¿›ç¨‹åˆ‡æ¢ä¸ºReadyçŠ¶æ€\né€‰æ‹©ä¸‹ä¸€ä¸ªè¿›ç¨‹æ‰§è¡Œ\n\næ—¶é—´ç‰‡æœºåˆ¶\n\næ—¶é—´ç‰‡ï¼ˆtime quantumï¼‰ï¼šè¿›ç¨‹æ¯æ¬¡è¿è¡Œçš„æœ€é•¿æ—¶é—´\né€šå¸¸ä¸º10~100ms\nRRè°ƒåº¦ç®—æ³•çš„æ ¸å¿ƒå‚æ•°\n\nI/Oä¸­æ–­\nå·¥ä½œæµç¨‹\n\nI/Oæ“ä½œå®Œæˆæ—¶ï¼Œè®¾å¤‡æ§åˆ¶å™¨å‘èµ·ä¸­æ–­\nä¸­æ–­å¤„ç†ç¨‹åºå”¤é†’ç­‰å¾…è¯¥I/Oçš„è¿›ç¨‹\nå°†è¿›ç¨‹ä»WaitingçŠ¶æ€åˆ‡æ¢ä¸ºReadyçŠ¶æ€\nå°†è¿›ç¨‹PCBç§»å…¥Ready Queue\nå¯èƒ½è§¦å‘è°ƒåº¦\n\nç³»ç»Ÿè°ƒç”¨\nå‚è§ç³»ç»Ÿè°ƒç”¨\nå·¥ä½œæµç¨‹\n\nç”¨æˆ·ç¨‹åºè°ƒç”¨ç³»ç»Ÿè°ƒç”¨\nè§¦å‘è½¯ä¸­æ–­ï¼ˆtrapï¼‰\nåˆ‡æ¢åˆ°å†…æ ¸æ€æ‰§è¡Œç³»ç»Ÿè°ƒç”¨\nå¦‚æœç³»ç»Ÿè°ƒç”¨éœ€è¦ç­‰å¾…ï¼ˆå¦‚readï¼‰ï¼Œè¿›ç¨‹è¿›å…¥WaitingçŠ¶æ€\nè§¦å‘è°ƒåº¦\n\nè°ƒåº¦ç®—æ³•ç®€è¿°\nè¯¦è§è°ƒåº¦ç®—æ³•\nåŸºæœ¬ç®—æ³•\nFCFSï¼ˆFirst-Come, First-Servedï¼‰\n\nå…ˆæ¥å…ˆæœåŠ¡\néæŠ¢å å¼\nç®€å•ä½†å¯èƒ½å¯¼è‡´é•¿ä½œä¸šé˜»å¡çŸ­ä½œä¸š\n\nSJFï¼ˆShortest-Job-Firstï¼‰\n\næœ€çŸ­ä½œä¸šä¼˜å…ˆ\nå¯ä»¥æ˜¯æŠ¢å å¼æˆ–éæŠ¢å å¼\nç†è®ºä¸Šæœ€ä¼˜ï¼Œä½†éš¾ä»¥é¢„æµ‹è¿è¡Œæ—¶é—´\n\nRRï¼ˆRound-Robinï¼‰\n\næ—¶é—´ç‰‡è½®è½¬\næŠ¢å å¼\nå“åº”æ—¶é—´å¥½ï¼Œä½†å¹³å‡ç­‰å¾…æ—¶é—´å¯èƒ½è¾ƒé•¿\n\nPriority Scheduling\n\nä¼˜å…ˆçº§è°ƒåº¦\nå¯èƒ½å¯¼è‡´é¥¥é¥¿ï¼ˆstarvationï¼‰\nå¯é€šè¿‡agingæœºåˆ¶è§£å†³\n\nå¤šçº§é˜Ÿåˆ—è°ƒåº¦\nå‚è§Multilevel Queue Schedulingå’ŒMultilevel Feedback Queue Scheduling\nåŸºæœ¬æ€æƒ³\n\nå°†è¿›ç¨‹åˆ†ä¸ºä¸åŒç±»åˆ«\næ¯ä¸ªç±»åˆ«æœ‰è‡ªå·±çš„é˜Ÿåˆ—å’Œè°ƒåº¦ç®—æ³•\né˜Ÿåˆ—ä¹‹é—´ä¹Ÿæœ‰è°ƒåº¦ç­–ç•¥\n\nå¤šçº§åé¦ˆé˜Ÿåˆ—\n\nå…è®¸è¿›ç¨‹åœ¨é˜Ÿåˆ—ä¹‹é—´è¿ç§»\næ ¹æ®è¿›ç¨‹è¡Œä¸ºåŠ¨æ€è°ƒæ•´ä¼˜å…ˆçº§\n\nçº¿ç¨‹ä¸è°ƒåº¦\nçº¿ç¨‹æ¦‚å¿µ\nå‚è§02.3 çº¿ç¨‹\nçº¿ç¨‹çš„ç‰¹ç‚¹\n\nè½»é‡çº§è¿›ç¨‹\nå…±äº«è¿›ç¨‹çš„ä»£ç ã€æ•°æ®ã€å †\nå„è‡ªç»´æŠ¤å¯„å­˜å™¨ã€æ ˆã€PC\n\nçº¿ç¨‹ä¸è¿›ç¨‹çš„å…³ç³»\n\nè¿›ç¨‹æ˜¯èµ„æºåˆ†é…çš„åŸºæœ¬å•ä½\nçº¿ç¨‹æ˜¯CPUè°ƒåº¦çš„åŸºæœ¬å•ä½\nçº¿ç¨‹é—´åˆ‡æ¢å¼€é”€å°äºè¿›ç¨‹é—´åˆ‡æ¢\n\nçº¿ç¨‹è°ƒåº¦\nç”¨æˆ·çº§çº¿ç¨‹\n\nçº¿ç¨‹åº“åœ¨ç”¨æˆ·ç©ºé—´å®ç°\nå¯¹å†…æ ¸é€æ˜\nä¸€ä¸ªçº¿ç¨‹é˜»å¡ä¼šå¯¼è‡´æ•´ä¸ªè¿›ç¨‹é˜»å¡\n\nå†…æ ¸çº§çº¿ç¨‹\n\nå†…æ ¸ç›´æ¥æ”¯æŒçº¿ç¨‹\nå¯ä»¥åˆ©ç”¨å¤šæ ¸å¹¶è¡Œ\nä¸€ä¸ªçº¿ç¨‹é˜»å¡ä¸å½±å“è¿›ç¨‹å†…å…¶ä»–çº¿ç¨‹\n\nç›¸å…³æ¦‚å¿µ\n\n02.2 è°ƒåº¦ - è¿›ç¨‹çŠ¶æ€ã€è°ƒåº¦ç®—æ³•ã€ä¸Šä¸‹æ–‡åˆ‡æ¢\n02.3 çº¿ç¨‹ - çº¿ç¨‹æ¦‚å¿µã€ç”¨æˆ·çº§çº¿ç¨‹ã€å†…æ ¸çº§çº¿ç¨‹\n01 introduction - ä¸­æ–­æœºåˆ¶ã€è®¡æ—¶å™¨ã€ç³»ç»Ÿè°ƒç”¨\n02.1 è¿›ç¨‹ - PCBã€è¿›ç¨‹åˆ›å»ºä¸ç»ˆæ­¢\n04.1 ä¸»å­˜ - é¡µè¡¨ã€TLBã€å†…å­˜ä¿æŠ¤\n"},"è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/æµç¨‹æ€»è§ˆ/04-å®Œæ•´æµç¨‹ç¤ºä¾‹":{"slug":"è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/æµç¨‹æ€»è§ˆ/04-å®Œæ•´æµç¨‹ç¤ºä¾‹","filePath":"è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/æµç¨‹æ€»è§ˆ/04 å®Œæ•´æµç¨‹ç¤ºä¾‹.md","title":"04 å®Œæ•´æµç¨‹ç¤ºä¾‹","links":["è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/æµç¨‹æ€»è§ˆ/01-ç³»ç»Ÿå¯åŠ¨ä¸è¿›ç¨‹åˆ›å»º","03-è¿›ç¨‹è°ƒåº¦ä¸åˆ‡æ¢","è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/æµç¨‹æ€»è§ˆ/02-å†…å­˜ç®¡ç†","è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/01-introduction","è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/03.1-è¿›ç¨‹åŒæ­¥åŠå…¶å·¥å…·","è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/02.1-è¿›ç¨‹","è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/02.2-è°ƒåº¦","è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/04.1-ä¸»å­˜","è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/04.2-virtual-memory"],"tags":[],"content":"ç³»ç»Ÿå¯åŠ¨åˆ°ç¬¬ä¸€ä¸ªè¿›ç¨‹è¿è¡Œ\nå‚è€ƒï¼šç³»ç»Ÿå¯åŠ¨æµç¨‹\nå®Œæ•´æµç¨‹\n1. ä¸Šç”µä¸å¼•å¯¼\n\nCPUæ‰§è¡ŒROMä¸­çš„å¼•å¯¼åŠ è½½å™¨\nç¡¬ä»¶è‡ªæ£€ï¼ˆPOSTï¼‰\nå®šä½å¹¶åŠ è½½æ“ä½œç³»ç»Ÿå†…æ ¸åˆ°RAM\nåˆ‡æ¢åˆ°å†…æ ¸æ€\n\n2. å†…æ ¸åˆå§‹åŒ–\n\nåˆå§‹åŒ–ä¸­æ–­ç³»ç»Ÿï¼šä¸­æ–­å‘é‡è¡¨ã€ä¸­æ–­è¯·æ±‚çº¿ã€è®¡æ—¶å™¨\nåˆå§‹åŒ–å†…å­˜ç®¡ç†ï¼šå¸§è¡¨ã€å†…æ ¸é¡µè¡¨ã€å†…å­˜ä¿æŠ¤\nåˆå§‹åŒ–è¿›ç¨‹ç®¡ç†ï¼šåˆ›å»ºå°±ç»ªé˜Ÿåˆ—å’Œç­‰å¾…é˜Ÿåˆ—\n\n3. åˆ›å»ºç¬¬ä¸€ä¸ªç”¨æˆ·è¿›ç¨‹\n\nåˆ†é…PCB\nå»ºç«‹è™šæ‹Ÿåœ°å€ç©ºé—´\nå»ºç«‹é¡µè¡¨æ˜ å°„\nåŠ è½½å¯æ‰§è¡Œæ–‡ä»¶\nåˆ‡æ¢åˆ°ç”¨æˆ·æ€å¹¶å¼€å§‹æ‰§è¡Œ\n\nforkåˆ›å»ºæ–°è¿›ç¨‹\nå‚è€ƒï¼šforkç³»ç»Ÿè°ƒç”¨\nåœºæ™¯ï¼šshellæ‰§è¡Œlså‘½ä»¤\n1. shellè¿›ç¨‹è°ƒç”¨fork()\n\nè§¦å‘ç³»ç»Ÿè°ƒç”¨ï¼ŒCPUåˆ‡æ¢åˆ°å†…æ ¸æ€\nå†…æ ¸åˆ†é…æ–°çš„PCBç»™å­è¿›ç¨‹\nä½¿ç”¨COWæœºåˆ¶å…±äº«çˆ¶è¿›ç¨‹åœ°å€ç©ºé—´\nè¿”å›ï¼šçˆ¶è¿›ç¨‹å¾—åˆ°å­è¿›ç¨‹PIDï¼Œå­è¿›ç¨‹å¾—åˆ°0\n\n2. å­è¿›ç¨‹è°ƒç”¨exec(â€œlsâ€)\n\nè§¦å‘ç³»ç»Ÿè°ƒç”¨\nå†…æ ¸åŠ è½½lsç¨‹åºçš„å¯æ‰§è¡Œæ–‡ä»¶\nå»ºç«‹æ–°çš„é¡µè¡¨æ˜ å°„ï¼Œè¦†ç›–åŸæœ‰åœ°å€ç©ºé—´\nä»lsç¨‹åºå…¥å£ç‚¹å¼€å§‹æ‰§è¡Œ\n\n3. çˆ¶è¿›ç¨‹è°ƒç”¨wait()\n\nshellè¿›å…¥WaitingçŠ¶æ€\nshellçš„PCBç§»å…¥ç­‰å¾…é˜Ÿåˆ—\nCPUè°ƒåº¦å…¶ä»–è¿›ç¨‹è¿è¡Œ\n\n4. å­è¿›ç¨‹æ‰§è¡Œå®Œæ¯•\n\nlsè¿›ç¨‹è°ƒç”¨exit()\nè§¦å‘ç³»ç»Ÿè°ƒç”¨\né‡Šæ”¾èµ„æºï¼Œå”¤é†’çˆ¶è¿›ç¨‹\nshellä»Waitingå˜ä¸ºReady\n\næ—¶é—´ç‰‡ç”¨å®Œçš„è¿›ç¨‹åˆ‡æ¢\nå‚è€ƒï¼šä¸Šä¸‹æ–‡åˆ‡æ¢\nåœºæ™¯ï¼šè¿›ç¨‹Açš„æ—¶é—´ç‰‡ç”¨å®Œ\n1. Timerä¸­æ–­è§¦å‘\n\nç¡¬ä»¶è®¡æ—¶å™¨äº§ç”Ÿä¸­æ–­\nCPUä¿å­˜å½“å‰æŒ‡ä»¤çš„ä¸Šä¸‹æ–‡\nè·³è½¬åˆ°ä¸­æ–­å¤„ç†ç¨‹åºï¼ˆå†…æ ¸æ€ï¼‰\n\n2. ä¸­æ–­å¤„ç†\n\nå†…æ ¸çš„ä¸­æ–­å¤„ç†ç¨‹åºæ‰§è¡Œ\næ£€æŸ¥å‘ç°è¿›ç¨‹Açš„æ—¶é—´ç‰‡å·²ç”¨å®Œ\nå°†è¿›ç¨‹Açš„çŠ¶æ€æ”¹ä¸ºReady\nå°†è¿›ç¨‹Açš„PCBç§»å…¥Ready Queue\n\n3. è°ƒåº¦å†³ç­–\n\nè°ƒåº¦å™¨ä»Ready Queueä¸­é€‰æ‹©è¿›ç¨‹B\næ ¹æ®è°ƒåº¦ç®—æ³•ï¼ˆå¦‚RRã€Priorityç­‰ï¼‰å†³å®š\n\n4. ä¸Šä¸‹æ–‡åˆ‡æ¢\n\nä¿å­˜è¿›ç¨‹Açš„å¯„å­˜å™¨åˆ°PCB\nåŠ è½½è¿›ç¨‹Bçš„å¯„å­˜å™¨ä»PCB\nåˆ‡æ¢é¡µè¡¨ï¼šæ›´æ–°PTBR\nå¤„ç†TLBï¼šflushæˆ–ä½¿ç”¨ASID\n\n5. æ¢å¤æ‰§è¡Œ\n\nåˆ‡æ¢åˆ°ç”¨æˆ·æ€\nè·³è½¬åˆ°è¿›ç¨‹Bçš„PCæŒ‡å‘çš„æŒ‡ä»¤\nè¿›ç¨‹Bå¼€å§‹æ‰§è¡Œ\n\nç¼ºé¡µä¸­æ–­å¤„ç†\nå‚è€ƒï¼šæŒ‰éœ€åˆ†é¡µ\nåœºæ™¯ï¼šè¿›ç¨‹è®¿é—®æœªæ˜ å°„çš„è™šæ‹Ÿåœ°å€\n1. è§¦å‘page fault\n\nè¿›ç¨‹è®¿é—®æŸä¸ªè™šæ‹Ÿåœ°å€\nMMUæŸ¥é¡µè¡¨ï¼Œå‘ç°valid bitä¸ºinvalid\nCPUè§¦å‘page faultå¼‚å¸¸\nåˆ‡æ¢åˆ°å†…æ ¸æ€\n\n2. æ£€æŸ¥åˆæ³•æ€§\n\nå†…æ ¸æ£€æŸ¥åœ°å€æ˜¯å¦åœ¨è¿›ç¨‹çš„åˆæ³•åœ°å€ç©ºé—´å†…\næ£€æŸ¥è®¿é—®æƒé™ï¼ˆè¯»/å†™/æ‰§è¡Œï¼‰\nå¦‚æœéæ³•ï¼Œç»ˆæ­¢è¿›ç¨‹ï¼›å¦‚æœåˆæ³•ï¼Œç»§ç»­\n\n3. åˆ†é…ç‰©ç†å¸§\n\næ£€æŸ¥æ˜¯å¦æœ‰ç©ºé—²å¸§\nå¦‚æœæœ‰ï¼Œç›´æ¥ä½¿ç”¨\nå¦‚æœæ²¡æœ‰ï¼Œæ‰§è¡Œé¡µé¢ç½®æ¢ç®—æ³•\n\n4. è°ƒå…¥é¡µé¢\n\nå¦‚æœæ˜¯é¦–æ¬¡è®¿é—®ï¼šåˆ†é…æ–°çš„é›¶é¡µ\nå¦‚æœè¢«swap outï¼šä»ç£ç›˜è¯»å–é¡µé¢å†…å®¹\n\n5. æ›´æ–°é¡µè¡¨å’ŒTLB\n\nå»ºç«‹è™šæ‹Ÿé¡µåˆ°ç‰©ç†å¸§çš„æ˜ å°„\nè®¾ç½®valid bitä¸ºæœ‰æ•ˆ\næ›´æ–°TLB\n\n6. é‡æ–°æ‰§è¡ŒæŒ‡ä»¤\n\nè¿”å›ç”¨æˆ·æ€\né‡æ–°æ‰§è¡Œè§¦å‘page faultçš„æŒ‡ä»¤\nè¿™æ¬¡å¯ä»¥æ­£å¸¸è®¿é—®\n\né¡µé¢ç½®æ¢æµç¨‹\nå‚è€ƒï¼šé¡µé¢ç½®æ¢\nåœºæ™¯ï¼šç‰©ç†å†…å­˜ä¸è¶³æ—¶çš„å¤„ç†\n1. é€‰æ‹©victim frame\n\nä½¿ç”¨é¡µé¢ç½®æ¢ç®—æ³•ï¼ˆLRUã€FIFOç­‰ï¼‰\næ‰¾åˆ°è¦è¢«æ¢å‡ºçš„é¡µé¢\n\n2. æ£€æŸ¥dirty bit\n\nå¦‚æœdirty bitä¸º1ï¼ˆé¡µé¢è¢«ä¿®æ”¹è¿‡ï¼‰\n\néœ€è¦å°†é¡µé¢å†™å›ç£ç›˜\nI/Oæ“ä½œ\n\n\nå¦‚æœdirty bitä¸º0\n\nå¯ä»¥ç›´æ¥ä¸¢å¼ƒ\n\n\n\n3. æ›´æ–°victimé¡µé¢çš„é¡µè¡¨\n\nå°†valid bitè®¾ç½®ä¸ºinvalid\nè®°å½•é¡µé¢åœ¨ç£ç›˜çš„ä½ç½®\nä»TLBä¸­åˆ é™¤å¯¹åº”æ¡ç›®\n\n4. è°ƒå…¥æ–°é¡µé¢\n\nå°†éœ€è¦çš„é¡µé¢ä»ç£ç›˜è°ƒå…¥åˆ°victim frame\næ›´æ–°æ–°é¡µé¢çš„é¡µè¡¨é¡¹\nè®¾ç½®valid bitä¸ºæœ‰æ•ˆ\n\n5. ç»§ç»­æ‰§è¡Œ\n\nè¿”å›ç”¨æˆ·æ€\né‡æ–°æ‰§è¡Œè§¦å‘page faultçš„æŒ‡ä»¤\n\nI/Oæ“ä½œæµç¨‹\nå‚è€ƒï¼šä¸­æ–­interruptsã€ä¸­æ–­é©±åŠ¨çš„è°ƒåº¦\nåœºæ™¯ï¼šè¿›ç¨‹è¯»å–æ–‡ä»¶\n1. è¿›ç¨‹å‘èµ·I/Oè¯·æ±‚\n\nè°ƒç”¨read()ç³»ç»Ÿè°ƒç”¨\nè§¦å‘è½¯ä¸­æ–­ï¼ˆtrapï¼‰\nåˆ‡æ¢åˆ°å†…æ ¸æ€\n\n2. å†…æ ¸å¤„ç†I/Oè¯·æ±‚\n\næ£€æŸ¥æ–‡ä»¶æƒé™\nå‘èµ·I/Oæ“ä½œï¼ˆå‘è®¾å¤‡æ§åˆ¶å™¨å‘é€å‘½ä»¤ï¼‰\nå°†è¿›ç¨‹çŠ¶æ€æ”¹ä¸ºWaiting\nå°†è¿›ç¨‹PCBç§»å…¥I/Oç­‰å¾…é˜Ÿåˆ—\n\n3. CPUè°ƒåº¦å…¶ä»–è¿›ç¨‹\n\nä»Ready Queueé€‰æ‹©å…¶ä»–è¿›ç¨‹\nè¿›è¡Œä¸Šä¸‹æ–‡åˆ‡æ¢\nå…¶ä»–è¿›ç¨‹å¼€å§‹æ‰§è¡Œ\n\n4. I/Oå®Œæˆ\n\nè®¾å¤‡æ§åˆ¶å™¨å®ŒæˆI/Oæ“ä½œ\nå‘èµ·I/Oä¸­æ–­\n\n5. ä¸­æ–­å¤„ç†\n\nCPUä¿å­˜å½“å‰è¿›ç¨‹ä¸Šä¸‹æ–‡\nè·³è½¬åˆ°I/Oä¸­æ–­å¤„ç†ç¨‹åº\nå¤„ç†I/Oæ•°æ®\nå”¤é†’ç­‰å¾…è¯¥I/Oçš„è¿›ç¨‹\nå°†è¿›ç¨‹ä»Waitingæ”¹ä¸ºReady\nå°†è¿›ç¨‹PCBç§»å…¥Ready Queue\n\n6. å¯èƒ½çš„è°ƒåº¦\n\nå¦‚æœè¢«å”¤é†’çš„è¿›ç¨‹ä¼˜å…ˆçº§æ›´é«˜\nå¯èƒ½å‘ç”Ÿè¿›ç¨‹åˆ‡æ¢\n\nè¿›ç¨‹åŒæ­¥ç¤ºä¾‹\nå‚è€ƒï¼š03.1 è¿›ç¨‹åŒæ­¥åŠå…¶å·¥å…·\nåœºæ™¯ï¼šç”Ÿäº§è€…-æ¶ˆè´¹è€…é—®é¢˜\nåŸºæœ¬è®¾ç½®\n\nå…±äº«ç¼“å†²åŒºï¼ˆæœ‰ç•Œï¼‰\nä¿¡å·é‡æœºåˆ¶ä¿æŠ¤\n\nç”Ÿäº§è€…è¿›ç¨‹\n\nç­‰å¾…ç©ºé—²ä½ç½®ï¼ˆPæ“ä½œ/waitï¼‰\nå¦‚æœç¼“å†²åŒºæ»¡ï¼Œè¿›å…¥WaitingçŠ¶æ€\næœ‰ç©ºä½æ—¶è¢«å”¤é†’ï¼Œè¿›å…¥ReadyçŠ¶æ€\nè·å¾—CPUåå‘ç¼“å†²åŒºå†™å…¥æ•°æ®\né€šçŸ¥æ¶ˆè´¹è€…ï¼ˆVæ“ä½œ/signalï¼‰\nå¯èƒ½å”¤é†’ç­‰å¾…çš„æ¶ˆè´¹è€…\n\næ¶ˆè´¹è€…è¿›ç¨‹\n\nç­‰å¾…å¯ç”¨æ•°æ®ï¼ˆPæ“ä½œ/waitï¼‰\nå¦‚æœç¼“å†²åŒºç©ºï¼Œè¿›å…¥WaitingçŠ¶æ€\næœ‰æ•°æ®æ—¶è¢«å”¤é†’ï¼Œè¿›å…¥ReadyçŠ¶æ€\nè·å¾—CPUåä»ç¼“å†²åŒºè¯»å–æ•°æ®\né€šçŸ¥ç”Ÿäº§è€…ï¼ˆVæ“ä½œ/signalï¼‰\nå¯èƒ½å”¤é†’ç­‰å¾…çš„ç”Ÿäº§è€…\n\nå…³é”®æœºåˆ¶çš„è”ç³»\nè¿›ç¨‹ä¸å†…å­˜\n\nè¿›ç¨‹æ˜¯èµ„æºåˆ†é…çš„å•ä½ï¼šæ¯ä¸ªè¿›ç¨‹æ‹¥æœ‰ç‹¬ç«‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´\nå†…å­˜æ˜¯è¿›ç¨‹è¿è¡Œçš„åŸºç¡€ï¼šä»£ç ã€æ•°æ®ã€å †æ ˆéƒ½å­˜å‚¨åœ¨å†…å­˜ä¸­\né¡µè¡¨æ˜¯è¿›ç¨‹çš„â€èº«ä»½è¯â€ï¼šå»ºç«‹è™šæ‹Ÿåœ°å€åˆ°ç‰©ç†åœ°å€çš„æ˜ å°„\nPCBæ˜¯è¿›ç¨‹çš„â€æ¡£æ¡ˆâ€ï¼šè®°å½•è¿›ç¨‹çš„æ‰€æœ‰ä¿¡æ¯ï¼ŒåŒ…æ‹¬å†…å­˜ç®¡ç†ä¿¡æ¯\n\nä¸­æ–­é©±åŠ¨ç³»ç»Ÿ\n\nç¡¬ä»¶ä¸­æ–­ï¼šTimerã€I/Oè®¾å¤‡äº§ç”Ÿä¸­æ–­ï¼Œè§¦å‘è°ƒåº¦\nè½¯ä¸­æ–­ï¼šç³»ç»Ÿè°ƒç”¨ã€å¼‚å¸¸è§¦å‘ä¸­æ–­ï¼Œè¿›å…¥å†…æ ¸æ€\nä¸­æ–­å¤„ç†ï¼šå†…æ ¸å¤„ç†ä¸­æ–­ï¼Œå¯èƒ½æ”¹å˜è¿›ç¨‹çŠ¶æ€ï¼Œè§¦å‘è°ƒåº¦\n\nè°ƒåº¦ä¸åˆ‡æ¢\n\nè°ƒåº¦å†³ç­–ï¼šé€‰æ‹©å“ªä¸ªè¿›ç¨‹è¿è¡Œï¼ˆè½¯ä»¶ç­–ç•¥ï¼‰\nä¸Šä¸‹æ–‡åˆ‡æ¢ï¼šå¦‚ä½•åˆ‡æ¢è¿›ç¨‹ï¼ˆç¡¬ä»¶+è½¯ä»¶æœºåˆ¶ï¼‰\nå†…å­˜éš”ç¦»ï¼šé€šè¿‡é¡µè¡¨å’ŒMMUä¿è¯è¿›ç¨‹é—´éš”ç¦»\n\næ€§èƒ½è€ƒè™‘\næ—¶é—´å¼€é”€\n\nä¸Šä¸‹æ–‡åˆ‡æ¢ï¼šçº¦10Î¼s\nç³»ç»Ÿè°ƒç”¨ï¼šè¿›å…¥/é€€å‡ºå†…æ ¸æ€çš„å¼€é”€\nTLB missï¼šéœ€è¦è®¿é—®å†…å­˜ä¸­çš„é¡µè¡¨\nPage faultï¼šå¯èƒ½éœ€è¦ç£ç›˜I/O\n\nä¼˜åŒ–ç­–ç•¥\n\nå‡å°‘ä¸Šä¸‹æ–‡åˆ‡æ¢é¢‘ç‡ï¼šåˆç†çš„æ—¶é—´ç‰‡å¤§å°\nTLBä¼˜åŒ–ï¼šä½¿ç”¨ASIDé¿å…é¢‘ç¹flush\né¡µé¢ç½®æ¢ï¼šé€‰æ‹©åˆé€‚çš„ç®—æ³•å‡å°‘page fault\nCOWæœºåˆ¶ï¼šå»¶è¿Ÿå¤åˆ¶ï¼ŒèŠ‚çœå†…å­˜\n\nç›¸å…³æ¦‚å¿µ\n\n01 ç³»ç»Ÿå¯åŠ¨ä¸è¿›ç¨‹åˆ›å»º - ç³»ç»Ÿå¯åŠ¨ã€è¿›ç¨‹åˆ›å»ºæœºåˆ¶\n02 å†…å­˜ç®¡ç† - è™šæ‹Ÿå†…å­˜ã€åˆ†é¡µã€åœ°å€è½¬æ¢\n03 è¿›ç¨‹è°ƒåº¦ä¸åˆ‡æ¢ - è¿›ç¨‹çŠ¶æ€ã€è°ƒåº¦ã€ä¸Šä¸‹æ–‡åˆ‡æ¢\n01 introduction - æ“ä½œç³»ç»Ÿæ¦‚è¿°ã€ä¸­æ–­ã€ç³»ç»Ÿè°ƒç”¨\n02.1 è¿›ç¨‹ - è¿›ç¨‹æ¦‚å¿µã€PCB\n02.2 è°ƒåº¦ - è°ƒåº¦ç®—æ³•ã€é˜Ÿåˆ—ç®¡ç†\n04.1 ä¸»å­˜ - å†…å­˜ç®¡ç†ç»†èŠ‚\n04.2 virtual memory - è™šæ‹Ÿå†…å­˜ç»†èŠ‚\n"},"è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/æµç¨‹æ€»è§ˆ/è¿›ç¨‹ä¸å†…å­˜æµç¨‹æ€»è§ˆ":{"slug":"è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/æµç¨‹æ€»è§ˆ/è¿›ç¨‹ä¸å†…å­˜æµç¨‹æ€»è§ˆ","filePath":"è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/æµç¨‹æ€»è§ˆ/è¿›ç¨‹ä¸å†…å­˜æµç¨‹æ€»è§ˆ.md","title":"è¿›ç¨‹ä¸å†…å­˜æµç¨‹æ€»è§ˆ","links":["Public/è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/01-introduction","è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/04.1-ä¸»å­˜","è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/02.2-è°ƒåº¦","è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/02.1-è¿›ç¨‹","è¯¾ç¨‹ç¬”è®°/æ“ä½œç³»ç»Ÿ/04.2-virtual-memory"],"tags":[],"content":"è¿›ç¨‹ä¸å†…å­˜æµç¨‹æ€»è§ˆ\næœ¬æ–‡æ¡£ä»ç³»ç»Ÿä¸Šç”µå¼€å§‹ï¼Œå®Œæ•´æ¢³ç†æ“ä½œç³»ç»Ÿå¦‚ä½•å¯åŠ¨ã€åˆ›å»ºç¬¬ä¸€ä¸ªç”¨æˆ·è¿›ç¨‹ã€ç®¡ç†å†…å­˜ï¼Œä»¥åŠå¦‚ä½•è¿›è¡Œè¿›ç¨‹åˆ‡æ¢çš„æ•´ä¸ªæµç¨‹ã€‚\nä¸€ã€ç³»ç»Ÿå¯åŠ¨ï¼šä»ç¡¬ä»¶åˆ°å†…æ ¸\n1.1 ä¸Šç”µä¸å¼•å¯¼\nè®¡ç®—æœºä¸Šç”µåï¼ŒCPUé¦–å…ˆæ‰§è¡Œå­˜å‚¨åœ¨**ROMï¼ˆåªè¯»å­˜å‚¨å™¨ï¼‰**ä¸­çš„å¼•å¯¼åŠ è½½å™¨ï¼ˆbootstrap loaderï¼‰ã€‚è¿™ä¸ªç¨‹åºæ˜¯å¼€æœºåæ‰§è¡Œçš„ç¬¬ä¸€ä¸ªè½¯ä»¶ï¼Œä½ç½®å›ºå®šä¸”å·²çŸ¥ã€‚\nå¼•å¯¼åŠ è½½å™¨çš„ä»»åŠ¡ï¼š\n\nè¿›è¡Œç¡¬ä»¶è‡ªæ£€ï¼ˆPOSTï¼‰\nå®šä½ç£ç›˜ä¸Šçš„æ“ä½œç³»ç»Ÿå†…æ ¸é•œåƒ\nå°†å†…æ ¸åŠ è½½åˆ°**ä¸»å†…å­˜ï¼ˆRAMï¼‰**ä¸­\nåˆ‡æ¢CPUæ¨¡å¼ä¸ºå†…æ ¸æ€ï¼Œå¼€å§‹æ‰§è¡Œå†…æ ¸ä»£ç \n\n1.2 å†…æ ¸åˆå§‹åŒ–\nå†…æ ¸è¢«åŠ è½½åˆ°å†…å­˜åï¼Œå¼€å§‹åˆå§‹åŒ–å·¥ä½œï¼š\n\nåˆå§‹åŒ–ä¸­æ–­ç³»ç»Ÿ\n\nè®¾ç½®ä¸­æ–­å‘é‡è¡¨ï¼ˆinterrupt vector tableï¼‰ï¼Œå»ºç«‹ä¸­æ–­å·åˆ°ä¸­æ–­å¤„ç†ç¨‹åºçš„æ˜ å°„\né…ç½®ä¸­æ–­è¯·æ±‚çº¿ï¼ˆinterrupt-request lineï¼‰\nåˆå§‹åŒ–è®¡æ—¶å™¨ï¼ˆtimerï¼‰ï¼Œç”¨äºæ—¶é—´ç‰‡ç®¡ç†\n\n\nåˆå§‹åŒ–å†…å­˜ç®¡ç†\n\nå»ºç«‹ç‰©ç†å†…å­˜çš„å¸§è¡¨ï¼ˆframe tableï¼‰ï¼Œè®°å½•æ¯ä¸ªç‰©ç†å¸§çš„ä½¿ç”¨æƒ…å†µ\nåˆå§‹åŒ–å†…æ ¸çš„é¡µè¡¨ç»“æ„\nè®¾ç½®å†…å­˜ä¿æŠ¤æœºåˆ¶ï¼ˆbaseå’Œlimitå¯„å­˜å™¨ï¼Œæˆ–é¡µè¡¨ä¿æŠ¤ä½ï¼‰\n\n\nåˆå§‹åŒ–è¿›ç¨‹ç®¡ç†\n\nåˆ›å»ºåˆå§‹çš„å†…æ ¸æ•°æ®ç»“æ„\nå‡†å¤‡å°±ç»ªé˜Ÿåˆ—ï¼ˆready queueï¼‰å’Œç­‰å¾…é˜Ÿåˆ—ï¼ˆwait queueï¼‰\n\n\n\näºŒã€ç¬¬ä¸€ä¸ªç”¨æˆ·è¿›ç¨‹çš„åˆ›å»º\n2.1 å†…æ ¸æ€åˆ°ç”¨æˆ·æ€çš„è½¬æ¢\nå†…æ ¸åˆå§‹åŒ–å®Œæˆåï¼Œéœ€è¦åˆ›å»ºç¬¬ä¸€ä¸ªç”¨æˆ·è¿›ç¨‹ã€‚åœ¨Linuxç³»ç»Ÿä¸­ï¼Œè¿™ä¸ªè¿›ç¨‹é€šå¸¸æ˜¯initï¼ˆæ—§ç‰ˆï¼‰æˆ–systemdï¼ˆæ–°ç‰ˆï¼‰ï¼Œå…¶è¿›ç¨‹IDï¼ˆPIDï¼‰ä¸º1ã€‚\nåˆ›å»ºç¬¬ä¸€ä¸ªç”¨æˆ·è¿›ç¨‹çš„æ­¥éª¤ï¼š\n\nåˆ†é…è¿›ç¨‹æ§åˆ¶å—ï¼ˆPCBï¼‰\n\næ“ä½œç³»ç»Ÿä¸ºæ¯ä¸ªè¿›ç¨‹ç»´æŠ¤ä¸€ä¸ªPCBï¼ŒåŒ…å«è¿›ç¨‹çŠ¶æ€ã€ç¨‹åºè®¡æ•°å™¨ã€CPUå¯„å­˜å™¨ã€å†…å­˜ç®¡ç†ä¿¡æ¯ç­‰\nç¬¬ä¸€ä¸ªè¿›ç¨‹çš„PCBè¢«åˆå§‹åŒ–ä¸ºåˆå§‹çŠ¶æ€\n\n\nå»ºç«‹è™šæ‹Ÿåœ°å€ç©ºé—´\n\næ¯ä¸ªè¿›ç¨‹æ‹¥æœ‰ç‹¬ç«‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´\nè™šæ‹Ÿåœ°å€ç©ºé—´åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š\n\nç”¨æˆ·éƒ¨åˆ†ï¼šåŒ…å«textï¼ˆä»£ç ï¼‰ã€dataï¼ˆå…¨å±€å˜é‡ï¼‰ã€heapï¼ˆå †ï¼‰ã€stackï¼ˆæ ˆï¼‰\nå†…æ ¸éƒ¨åˆ†ï¼šå­˜å‚¨PCBç­‰å†…æ ¸æ•°æ®ç»“æ„\n\n\n\n\nå»ºç«‹é¡µè¡¨æ˜ å°„\n\nä¸ºè¿›ç¨‹åˆ›å»ºé¡µè¡¨ï¼Œå»ºç«‹è™šæ‹Ÿåœ°å€åˆ°ç‰©ç†åœ°å€çš„æ˜ å°„\nåˆå§‹æ—¶ï¼Œåªæœ‰å¿…è¦çš„é¡µé¢è¢«æ˜ å°„åˆ°ç‰©ç†å†…å­˜\né¡µè¡¨åŸºåœ°å€å­˜å‚¨åœ¨PTBRï¼ˆPage-Table Base Registerï¼‰ä¸­\n\n\nåŠ è½½å¯æ‰§è¡Œæ–‡ä»¶\n\né€šè¿‡åŠ è½½å™¨ï¼ˆloaderï¼‰å°†å¯æ‰§è¡Œæ–‡ä»¶ä»ç£ç›˜åŠ è½½åˆ°å†…å­˜\nå¯æ‰§è¡Œæ–‡ä»¶ç»å†äº†ç¼–è¯‘ï¼ˆ.c â†’ .oï¼‰ã€é“¾æ¥ï¼ˆ.o â†’ .exeï¼‰ã€åŠ è½½çš„è¿‡ç¨‹\nåŠ è½½å™¨å°†é€»è¾‘åœ°å€é€šè¿‡åœ°å€ç»‘å®šï¼ˆAddress Bindingï¼‰è½¬æ¢ä¸ºç‰©ç†åœ°å€\n\n\nåˆ‡æ¢åˆ°ç”¨æˆ·æ€\n\né€šè¿‡ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼ˆcontext switchï¼‰ï¼Œå°†CPUä»å†…æ ¸æ€åˆ‡æ¢åˆ°ç”¨æˆ·æ€\nè®¾ç½®CPUçš„mode bitä¸º1ï¼ˆç”¨æˆ·æ€ï¼‰\nè·³è½¬åˆ°ç”¨æˆ·ç¨‹åºçš„å…¥å£ç‚¹å¼€å§‹æ‰§è¡Œ\n\n\n\n2.2 åœ°å€ç»‘å®šè¿‡ç¨‹\nç¨‹åºä»æºä»£ç åˆ°å†…å­˜ä¸­çš„å®Œæ•´è¿‡ç¨‹ï¼š\n\nç¼–è¯‘é˜¶æ®µï¼šç¼–è¯‘å™¨å°†ç¬¦å·åœ°å€è½¬æ¢ä¸ºå¯é‡å®šä½åœ°å€ï¼ˆrelocatable addressï¼‰\né“¾æ¥é˜¶æ®µï¼šé“¾æ¥å™¨å°†å¤šä¸ªç›®æ ‡æ–‡ä»¶åˆå¹¶ï¼Œç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ï¼Œåœ°å€ç›¸å¯¹äºæ•´ä¸ªç¨‹åº\nåŠ è½½é˜¶æ®µï¼šåŠ è½½å™¨å°†å¯æ‰§è¡Œæ–‡ä»¶åŠ è½½åˆ°å†…å­˜ï¼Œå®Œæˆåœ°å€ç»‘å®šï¼Œå¾—åˆ°ç»å¯¹åœ°å€\n\nä¸‰ã€å†…å­˜ç®¡ç†æœºåˆ¶\n3.1 è™šæ‹Ÿå†…å­˜çš„åŸºæœ¬åŸç†\næ¯ä¸ªè¿›ç¨‹æ‹¥æœ‰ç‹¬ç«‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´ï¼ŒCPUä½¿ç”¨è™šæ‹Ÿåœ°å€ï¼Œç”±MMUï¼ˆå†…å­˜ç®¡ç†å•å…ƒï¼‰è‡ªåŠ¨è½¬æ¢ä¸ºç‰©ç†åœ°å€ã€‚\nè™šæ‹Ÿåœ°å€ç©ºé—´çš„ç»“æ„ï¼š\n\nç”¨æˆ·ç©ºé—´ï¼ˆUser Portionï¼‰ï¼š0 ~ 3GBï¼ˆ32ä½ç³»ç»Ÿï¼‰\nå†…æ ¸ç©ºé—´ï¼ˆKernel Portionï¼‰ï¼š3GB ~ 4GBï¼ˆ32ä½ç³»ç»Ÿï¼‰\næ‰€æœ‰è¿›ç¨‹çš„å†…æ ¸ç©ºé—´æ˜ å°„åˆ°åŒä¸€å—ç‰©ç†å†…å­˜\n\n3.2 åˆ†é¡µæœºåˆ¶\nç°ä»£æ“ä½œç³»ç»Ÿä½¿ç”¨åˆ†é¡µï¼ˆPagingï¼‰æœºåˆ¶ç®¡ç†å†…å­˜ï¼š\n\nç‰©ç†å†…å­˜åˆ†å¸§ï¼šå°†ç‰©ç†å†…å­˜åˆ‡åˆ†ä¸ºç­‰å¤§å°çš„å¸§ï¼ˆframeï¼‰ï¼Œé€šå¸¸ä¸º4KB\nè™šæ‹Ÿå†…å­˜åˆ†é¡µï¼šå°†è™šæ‹Ÿåœ°å€ç©ºé—´åˆ‡åˆ†ä¸ºç­‰å¤§å°çš„é¡µï¼ˆpageï¼‰ï¼Œå¤§å°ä¸å¸§ç›¸åŒ\né¡µè¡¨æ˜ å°„ï¼šé€šè¿‡é¡µè¡¨å»ºç«‹é¡µåˆ°å¸§çš„æ˜ å°„å…³ç³»\n\nåœ°å€è½¬æ¢è¿‡ç¨‹ï¼š\n\nCPUç”Ÿæˆé€»è¾‘åœ°å€ï¼ˆpage number + offsetï¼‰\nMMUæ ¹æ®é¡µè¡¨å°†page numberè½¬æ¢ä¸ºframe number\nç‰©ç†åœ°å€ = frame number + offset\n\n3.3 é¡µè¡¨çš„ç¡¬ä»¶å®ç°\né¡µè¡¨å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œé€šè¿‡PTBRæŒ‡å‘é¡µè¡¨åŸºåœ°å€ã€‚ä¸ºäº†åŠ é€Ÿåœ°å€è½¬æ¢ï¼Œä½¿ç”¨TLBï¼ˆTranslation Look-aside Bufferï¼‰ä½œä¸ºé¡µè¡¨çš„é«˜é€Ÿç¼“å­˜ï¼š\n\nCPUè®¿é—®è™šæ‹Ÿåœ°å€æ—¶ï¼Œé¦–å…ˆæŸ¥è¯¢TLB\nå¦‚æœTLBå‘½ä¸­ï¼Œç›´æ¥è·å¾—ç‰©ç†åœ°å€ï¼ˆä¸€æ¬¡å†…å­˜è®¿é—®ï¼‰\nå¦‚æœTLBæœªå‘½ä¸­ï¼Œè®¿é—®å†…å­˜ä¸­çš„é¡µè¡¨ï¼ˆä¸¤æ¬¡å†…å­˜è®¿é—®ï¼‰ï¼Œå¹¶å°†ç»“æœå­˜å…¥TLB\n\n3.4 æŒ‰éœ€åˆ†é¡µï¼ˆDemand Pagingï¼‰\næ“ä½œç³»ç»Ÿé‡‡ç”¨å»¶è¿Ÿåˆ†é…ï¼ˆLazy Allocationï¼‰ç­–ç•¥ï¼š\n\nè¿›ç¨‹ç”³è¯·å†…å­˜æ—¶ï¼Œæ“ä½œç³»ç»Ÿåªæ‰©å¤§è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œä¸ç«‹å³åˆ†é…ç‰©ç†å†…å­˜\nå½“è¿›ç¨‹é¦–æ¬¡è®¿é—®è¯¥è™šæ‹Ÿåœ°å€æ—¶ï¼Œè§¦å‘ç¼ºé¡µä¸­æ–­ï¼ˆpage faultï¼‰\næ“ä½œç³»ç»Ÿå¤„ç†ç¼ºé¡µä¸­æ–­ï¼š\n\nä»ç©ºé—²å¸§åˆ—è¡¨ä¸­æ‰¾åˆ°ç©ºé—²çš„ç‰©ç†å¸§\nå°†é¡µé¢æ˜ å°„åˆ°è¯¥ç‰©ç†å¸§\næ›´æ–°é¡µè¡¨é¡¹\né‡æ–°æ‰§è¡Œè¢«ä¸­æ–­çš„æŒ‡ä»¤\n\n\n\n3.5 é¡µé¢ç½®æ¢\nå½“ç‰©ç†å†…å­˜ä¸è¶³æ—¶ï¼Œéœ€è¦å°†æŸäº›é¡µé¢æ¢å‡ºåˆ°ç£ç›˜ï¼ˆbacking storeï¼‰ï¼š\n\né€‰æ‹©victim frameï¼šä½¿ç”¨é¡µé¢ç½®æ¢ç®—æ³•ï¼ˆå¦‚LRUï¼‰é€‰æ‹©è¦æ¢å‡ºçš„é¡µé¢\nå†™å›ç£ç›˜ï¼šå¦‚æœé¡µé¢è¢«ä¿®æ”¹è¿‡ï¼ˆdirty bit=1ï¼‰ï¼Œå°†å…¶å†™å›ç£ç›˜\nè°ƒå…¥æ–°é¡µé¢ï¼šå°†éœ€è¦çš„é¡µé¢ä»ç£ç›˜è°ƒå…¥åˆ°victim frame\næ›´æ–°é¡µè¡¨ï¼šå°†é¡µè¡¨é¡¹çš„æœ‰æ•ˆä½è®¾ç½®ä¸ºæ— æ•ˆï¼Œè®°å½•é¡µé¢åœ¨ç£ç›˜çš„ä½ç½®\n\nå½“å†æ¬¡è®¿é—®è¢«æ¢å‡ºçš„é¡µé¢æ—¶ï¼Œä¼šè§¦å‘page faultï¼Œæ“ä½œç³»ç»Ÿå°†å…¶é‡æ–°è°ƒå…¥å†…å­˜ã€‚\nå››ã€è¿›ç¨‹çš„åˆ›å»ºä¸æ‰§è¡Œ\n4.1 è¿›ç¨‹åˆ›å»ºï¼ˆforkï¼‰\nè¿›ç¨‹é€šè¿‡fork()ç³»ç»Ÿè°ƒç”¨åˆ›å»ºå­è¿›ç¨‹ï¼š\n\nç³»ç»Ÿè°ƒç”¨ï¼šç”¨æˆ·ç¨‹åºè°ƒç”¨fork()ï¼Œè§¦å‘è½¯ä¸­æ–­ï¼ˆtrapï¼‰ï¼Œåˆ‡æ¢åˆ°å†…æ ¸æ€\nåˆ›å»ºå­è¿›ç¨‹ï¼š\n\nåˆ†é…æ–°çš„PCB\nå¤åˆ¶çˆ¶è¿›ç¨‹çš„åœ°å€ç©ºé—´ï¼ˆä½¿ç”¨Copy-on-Writeï¼ˆCOWï¼‰ä¼˜åŒ–ï¼‰\nå­è¿›ç¨‹è·å¾—æ–°çš„PIDï¼ŒPPIDæŒ‡å‘çˆ¶è¿›ç¨‹\n\n\nè¿”å›ç”¨æˆ·æ€ï¼š\n\nçˆ¶è¿›ç¨‹ï¼šfork()è¿”å›å­è¿›ç¨‹çš„PID\nå­è¿›ç¨‹ï¼šfork()è¿”å›0\nä¸¤ä¸ªè¿›ç¨‹ä»fork()çš„ä¸‹ä¸€è¡Œä»£ç ç»§ç»­æ‰§è¡Œ\n\n\n\nCopy-on-Writeï¼ˆCOWï¼‰æœºåˆ¶ï¼š\n\nçˆ¶å­è¿›ç¨‹æœ€åˆå…±äº«åŒä¸€ä»½ç‰©ç†é¡µ\nå½“ä»»ä¸€è¿›ç¨‹å°è¯•å†™å…¥å…±äº«é¡µæ—¶ï¼Œæ‰çœŸæ­£å¤åˆ¶è¯¥é¡µ\nèŠ‚çœå†…å­˜ï¼Œæé«˜forkæ•ˆç‡\n\n4.2 è¿›ç¨‹æ‰§è¡Œï¼ˆexecï¼‰\nexec()ç³»ç»Ÿè°ƒç”¨ç”¨æ–°ç¨‹åºè¦†ç›–å½“å‰è¿›ç¨‹çš„åœ°å€ç©ºé—´ï¼š\n\nåŠ è½½æ–°çš„å¯æ‰§è¡Œæ–‡ä»¶åˆ°å†…å­˜\nå»ºç«‹æ–°çš„é¡µè¡¨æ˜ å°„\né‡ç½®ç¨‹åºè®¡æ•°å™¨ï¼Œä»æ–°ç¨‹åºçš„å…¥å£ç‚¹å¼€å§‹æ‰§è¡Œ\n\né€šå¸¸çš„ç”¨æ³•æ˜¯fork()åç«‹å³è°ƒç”¨exec()ï¼Œåˆ›å»ºæ–°è¿›ç¨‹å¹¶æ‰§è¡Œæ–°ç¨‹åºã€‚\näº”ã€è¿›ç¨‹è°ƒåº¦ä¸åˆ‡æ¢\n5.1 è¿›ç¨‹çŠ¶æ€\nè¿›ç¨‹åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ä¼šç»å†ä»¥ä¸‹è¿›ç¨‹çŠ¶æ€ï¼š\n\nNewï¼šè¿›ç¨‹æ­£åœ¨åˆ›å»º\nReadyï¼šè¿›ç¨‹å·²å‡†å¤‡å¥½ï¼Œç­‰å¾…CPUèµ„æº\nRunningï¼šè¿›ç¨‹æ­£åœ¨ä½¿ç”¨CPUæ‰§è¡Œ\nWaitingï¼šè¿›ç¨‹ç­‰å¾…æŸä¸ªäº‹ä»¶ï¼ˆå¦‚I/Oå®Œæˆï¼‰\nTerminatedï¼šè¿›ç¨‹å·²ç»“æŸ\n\nçŠ¶æ€è½¬æ¢è§„åˆ™ï¼š\n\nRunning â†’ Readyï¼šæ—¶é—´ç‰‡ç”¨å®Œæˆ–è¢«æŠ¢å \nRunning â†’ Waitingï¼šä¸»åŠ¨ç­‰å¾…ï¼ˆå¦‚ç³»ç»Ÿè°ƒç”¨ã€I/Oè¯·æ±‚ï¼‰\nWaiting â†’ Readyï¼šç­‰å¾…çš„äº‹ä»¶å‘ç”Ÿ\nReady â†’ Runningï¼šè¢«è°ƒåº¦å™¨é€‰ä¸­ï¼Œè·å¾—CPU\n\n5.2 è°ƒåº¦æ—¶æœº\néæŠ¢å å¼è°ƒåº¦ï¼šè¿›ç¨‹ä¸»åŠ¨é‡Šæ”¾CPUï¼ˆè¿›å…¥waitingçŠ¶æ€æˆ–ç»ˆæ­¢ï¼‰\næŠ¢å å¼è°ƒåº¦ï¼š\n\næ—¶é—´ç‰‡ç”¨å®Œï¼ˆtimerä¸­æ–­ï¼‰\næ›´é«˜ä¼˜å…ˆçº§çš„è¿›ç¨‹å˜ä¸ºreadyçŠ¶æ€\nå½“å‰è¿›ç¨‹è¢«ä¸­æ–­æ‰“æ–­\n\n5.3 ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å®Œæ•´è¿‡ç¨‹\nå½“è°ƒåº¦å™¨å†³å®šåˆ‡æ¢åˆ°å¦ä¸€ä¸ªè¿›ç¨‹æ—¶ï¼Œæ‰§è¡Œä¸Šä¸‹æ–‡åˆ‡æ¢ï¼š\n\n\nä¿å­˜å½“å‰è¿›ç¨‹çš„ä¸Šä¸‹æ–‡ï¼š\n\nä¿å­˜CPUå¯„å­˜å™¨ï¼ˆPCã€é€šç”¨å¯„å­˜å™¨ç­‰ï¼‰åˆ°å½“å‰è¿›ç¨‹çš„PCB\nä¿å­˜è¿›ç¨‹çŠ¶æ€\nä¿å­˜å†…å­˜ç®¡ç†ä¿¡æ¯ï¼ˆé¡µè¡¨æŒ‡é’ˆç­‰ï¼‰\n\n\n\næ›´æ–°è¿›ç¨‹çŠ¶æ€ï¼š\n\nå°†å½“å‰è¿›ç¨‹ä»runningçŠ¶æ€æ”¹ä¸ºreadyçŠ¶æ€ï¼ˆæˆ–è¢«æŠ¢å ï¼‰æˆ–waitingçŠ¶æ€\nå°†å½“å‰è¿›ç¨‹çš„PCBç§»å…¥ç›¸åº”çš„é˜Ÿåˆ—\n\n\n\né€‰æ‹©ä¸‹ä¸€ä¸ªè¿›ç¨‹ï¼š\n\nè°ƒåº¦å™¨ä»ready queueä¸­é€‰æ‹©ä¸‹ä¸€ä¸ªè¦è¿è¡Œçš„è¿›ç¨‹\næ ¹æ®è°ƒåº¦ç®—æ³•ï¼ˆå¦‚RRã€ä¼˜å…ˆçº§è°ƒåº¦ç­‰ï¼‰è¿›è¡Œé€‰æ‹©\n\n\n\næ¢å¤ä¸‹ä¸€ä¸ªè¿›ç¨‹çš„ä¸Šä¸‹æ–‡ï¼š\n\nåŠ è½½æ–°è¿›ç¨‹çš„PCBä¸­çš„å¯„å­˜å™¨å€¼\næ›´æ–°PTBRæŒ‡å‘æ–°è¿›ç¨‹çš„é¡µè¡¨\nå¦‚æœä½¿ç”¨TLBï¼Œéœ€è¦flush TLBæˆ–ä½¿ç”¨ASID\næ›´æ–°è¿›ç¨‹çŠ¶æ€ä¸ºrunning\n\n\n\nåˆ‡æ¢åˆ°ç”¨æˆ·æ€ï¼š\n\nè®¾ç½®CPUçš„mode bitä¸ºç”¨æˆ·æ€\nè·³è½¬åˆ°æ–°è¿›ç¨‹çš„PCæŒ‡å‘çš„æŒ‡ä»¤ç»§ç»­æ‰§è¡Œ\n\n\n\nä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€ï¼š\n\néœ€è¦ä¿å­˜å’Œæ¢å¤å¤§é‡å¯„å­˜å™¨\néœ€è¦åˆ‡æ¢é¡µè¡¨ï¼ˆå¯èƒ½flush TLBï¼‰\néœ€è¦æ›´æ–°å„ç§å†…æ ¸æ•°æ®ç»“æ„\nå…¸å‹çš„context switchæ—¶é—´çº¦ä¸º10Î¼s\n\n5.4 ä¸­æ–­é©±åŠ¨çš„è°ƒåº¦\nç°ä»£æ“ä½œç³»ç»Ÿæ˜¯ä¸­æ–­é©±åŠ¨çš„ï¼š\n\n\nTimerä¸­æ–­ï¼š\n\nè®¡æ—¶å™¨å®šæœŸäº§ç”Ÿä¸­æ–­ï¼ˆå¦‚æ¯10msï¼‰\nä¸­æ–­å¤„ç†ç¨‹åºæ£€æŸ¥å½“å‰è¿›ç¨‹çš„æ—¶é—´ç‰‡æ˜¯å¦ç”¨å®Œ\nå¦‚æœç”¨å®Œï¼Œè§¦å‘è°ƒåº¦ï¼Œå°†å½“å‰è¿›ç¨‹åˆ‡æ¢ä¸ºreadyçŠ¶æ€\n\n\n\nI/Oä¸­æ–­ï¼š\n\nå½“I/Oæ“ä½œå®Œæˆæ—¶ï¼Œè®¾å¤‡æ§åˆ¶å™¨å‘èµ·ä¸­æ–­\nä¸­æ–­å¤„ç†ç¨‹åºå”¤é†’ç­‰å¾…è¯¥I/Oçš„è¿›ç¨‹\nå°†è¿›ç¨‹ä»waitingçŠ¶æ€åˆ‡æ¢ä¸ºreadyçŠ¶æ€\n\n\n\nç³»ç»Ÿè°ƒç”¨ï¼š\n\nç”¨æˆ·ç¨‹åºè°ƒç”¨ç³»ç»Ÿè°ƒç”¨ï¼Œè§¦å‘è½¯ä¸­æ–­\nåˆ‡æ¢åˆ°å†…æ ¸æ€æ‰§è¡Œç³»ç»Ÿè°ƒç”¨\nå¦‚æœç³»ç»Ÿè°ƒç”¨éœ€è¦ç­‰å¾…ï¼ˆå¦‚readï¼‰ï¼Œè¿›ç¨‹è¿›å…¥waitingçŠ¶æ€\n\n\n\nå…­ã€å†…å­˜ä¸è¿›ç¨‹çš„ååŒå·¥ä½œ\n6.1 è¿›ç¨‹åˆ‡æ¢æ—¶çš„å†…å­˜ç®¡ç†\nè¿›ç¨‹åˆ‡æ¢æ—¶ï¼Œå†…å­˜ç®¡ç†ç›¸å…³çš„æ“ä½œï¼š\n\n\né¡µè¡¨åˆ‡æ¢ï¼š\n\næ›´æ–°PTBRæŒ‡å‘æ–°è¿›ç¨‹çš„é¡µè¡¨\nä¸åŒè¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´è¢«éš”ç¦»\n\n\n\nTLBç®¡ç†ï¼š\n\næ–¹æ³•1ï¼šflush TLBï¼ˆæ¸…ç©ºæ‰€æœ‰TLBæ¡ç›®ï¼‰\næ–¹æ³•2ï¼šä½¿ç”¨ASIDï¼ˆAddress-Space Identifierï¼‰ï¼ŒTLBåŒæ—¶åŒ¹é…page numberå’ŒASID\n\n\n\nå†…å­˜ä¿æŠ¤ï¼š\n\næ¯ä¸ªè¿›ç¨‹åªèƒ½è®¿é—®è‡ªå·±çš„è™šæ‹Ÿåœ°å€ç©ºé—´\né€šè¿‡é¡µè¡¨çš„ä¿æŠ¤ä½ï¼ˆvalid-invalid bitã€è¯»å†™æƒé™ä½ï¼‰å®ç°\n\n\n\n6.2 ç¼ºé¡µä¸­æ–­çš„å¤„ç†æµç¨‹\nå½“è¿›ç¨‹è®¿é—®çš„è™šæ‹Ÿåœ°å€å¯¹åº”çš„é¡µé¢ä¸åœ¨ç‰©ç†å†…å­˜ä¸­æ—¶ï¼š\n\nè§¦å‘page faultï¼š\n\nMMUåœ¨é¡µè¡¨ä¸­æŸ¥æ‰¾ï¼Œå‘ç°valid bitä¸ºinvalid\nCPUè§¦å‘page faultå¼‚å¸¸ï¼Œåˆ‡æ¢åˆ°å†…æ ¸æ€\n\n\næ£€æŸ¥é¡µé¢åˆæ³•æ€§ï¼š\n\næ£€æŸ¥è™šæ‹Ÿåœ°å€æ˜¯å¦åœ¨è¿›ç¨‹çš„åˆæ³•åœ°å€ç©ºé—´å†…\næ£€æŸ¥è®¿é—®æƒé™ï¼ˆè¯»/å†™/æ‰§è¡Œï¼‰\n\n\nåˆ†é…ç‰©ç†å¸§ï¼š\n\nå¦‚æœæœ‰ç©ºé—²å¸§ï¼Œç›´æ¥ä½¿ç”¨\nå¦‚æœæ²¡æœ‰ç©ºé—²å¸§ï¼Œæ‰§è¡Œé¡µé¢ç½®æ¢ç®—æ³•é€‰æ‹©victim frame\n\n\nä»ç£ç›˜è°ƒå…¥é¡µé¢ï¼š\n\nå¦‚æœé¡µé¢åœ¨ç£ç›˜ä¸Šï¼ˆè¢«swap outï¼‰ï¼Œä»backing storeè¯»å–\nå¦‚æœé¡µé¢æ˜¯é¦–æ¬¡è®¿é—®ï¼ˆlazy allocationï¼‰ï¼Œåˆ†é…æ–°çš„é›¶é¡µ\n\n\næ›´æ–°é¡µè¡¨ï¼š\n\nå»ºç«‹è™šæ‹Ÿé¡µåˆ°ç‰©ç†å¸§çš„æ˜ å°„\nè®¾ç½®valid bitä¸ºæœ‰æ•ˆ\næ›´æ–°TLB\n\n\né‡æ–°æ‰§è¡ŒæŒ‡ä»¤ï¼š\n\nè¿”å›åˆ°ç”¨æˆ·æ€\né‡æ–°æ‰§è¡Œè§¦å‘page faultçš„æŒ‡ä»¤\n\n\n\n6.3 è¿›ç¨‹é—´å†…å­˜å…±äº«\nå¤šä¸ªè¿›ç¨‹å¯ä»¥å…±äº«åŒä¸€å—ç‰©ç†å†…å­˜ï¼š\n\nå…±äº«ä»£ç ï¼š\n\nå¤šä¸ªè¿›ç¨‹æ‰§è¡ŒåŒä¸€ç¨‹åºæ—¶ï¼Œå¯ä»¥å…±äº«textæ®µ\né¡µè¡¨ä¸­ä¸åŒçš„è™šæ‹Ÿé¡µæ˜ å°„åˆ°åŒä¸€ç‰©ç†å¸§\nä»£ç å¿…é¡»æ˜¯å¯é‡å…¥çš„ï¼ˆreentrant codeï¼‰\n\n\nå…±äº«å†…å­˜ï¼ˆIPCï¼‰ï¼š\n\né€šè¿‡ç³»ç»Ÿè°ƒç”¨å»ºç«‹å…±äº«å†…å­˜åŒºåŸŸ\nå¤šä¸ªè¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´æ˜ å°„åˆ°åŒä¸€ç‰©ç†å†…å­˜\néœ€è¦åŒæ­¥æœºåˆ¶ï¼ˆå¦‚ä¿¡å·é‡ï¼‰ä¿æŠ¤å…±äº«æ•°æ®\n\n\n\nä¸ƒã€å®Œæ•´æµç¨‹ç¤ºä¾‹ï¼šä»forkåˆ°execåˆ°è°ƒåº¦\n7.1 åˆ›å»ºæ–°è¿›ç¨‹å¹¶æ‰§è¡Œæ–°ç¨‹åº\n\n\nçˆ¶è¿›ç¨‹è°ƒç”¨fork()ï¼š\n\nè§¦å‘ç³»ç»Ÿè°ƒç”¨ï¼Œåˆ‡æ¢åˆ°å†…æ ¸æ€\nå†…æ ¸åˆ›å»ºå­è¿›ç¨‹çš„PCB\nä½¿ç”¨COWæœºåˆ¶å…±äº«çˆ¶è¿›ç¨‹çš„åœ°å€ç©ºé—´\nè¿”å›ç”¨æˆ·æ€ï¼Œçˆ¶å­è¿›ç¨‹å¹¶å‘æ‰§è¡Œ\n\n\n\nå­è¿›ç¨‹è°ƒç”¨exec()ï¼š\n\nè§¦å‘ç³»ç»Ÿè°ƒç”¨ï¼Œåˆ‡æ¢åˆ°å†…æ ¸æ€\nå†…æ ¸åŠ è½½æ–°çš„å¯æ‰§è¡Œæ–‡ä»¶\nå»ºç«‹æ–°çš„é¡µè¡¨æ˜ å°„\nè¦†ç›–åŸæœ‰çš„åœ°å€ç©ºé—´\nè¿”å›ç”¨æˆ·æ€ï¼Œä»æ–°ç¨‹åºçš„å…¥å£ç‚¹å¼€å§‹æ‰§è¡Œ\n\n\n\n7.2 è¿›ç¨‹åˆ‡æ¢çš„å®Œæ•´åœºæ™¯\nå‡è®¾è¿›ç¨‹Aæ­£åœ¨è¿è¡Œï¼Œæ—¶é—´ç‰‡ç”¨å®Œï¼š\n\nTimerä¸­æ–­ï¼š\n\nç¡¬ä»¶è®¡æ—¶å™¨äº§ç”Ÿä¸­æ–­\nCPUä¿å­˜å½“å‰æŒ‡ä»¤çš„ä¸Šä¸‹æ–‡ï¼Œè·³è½¬åˆ°ä¸­æ–­å¤„ç†ç¨‹åº\n\n\nä¸­æ–­å¤„ç†ï¼š\n\nå†…æ ¸çš„ä¸­æ–­å¤„ç†ç¨‹åºæ‰§è¡Œ\næ£€æŸ¥å‘ç°è¿›ç¨‹Açš„æ—¶é—´ç‰‡å·²ç”¨å®Œ\nå°†è¿›ç¨‹Açš„çŠ¶æ€æ”¹ä¸ºreadyï¼Œç§»å…¥ready queue\n\n\nè°ƒåº¦å†³ç­–ï¼š\n\nè°ƒåº¦å™¨ä»ready queueä¸­é€‰æ‹©è¿›ç¨‹Bï¼ˆæ ¹æ®è°ƒåº¦ç®—æ³•ï¼‰\nè¿›ç¨‹Bå¯èƒ½æ˜¯ï¼š\n\nä¹‹å‰è¢«æŠ¢å çš„è¿›ç¨‹\nç­‰å¾…I/Oå®Œæˆçš„è¿›ç¨‹\næ–°åˆ›å»ºçš„è¿›ç¨‹\n\n\n\n\nä¸Šä¸‹æ–‡åˆ‡æ¢ï¼š\n\nä¿å­˜è¿›ç¨‹Açš„å¯„å­˜å™¨åˆ°PCB\nåŠ è½½è¿›ç¨‹Bçš„å¯„å­˜å™¨ä»PCB\nåˆ‡æ¢é¡µè¡¨ï¼ˆæ›´æ–°PTBRï¼‰\nFlush TLBæˆ–ä½¿ç”¨ASID\n\n\næ¢å¤æ‰§è¡Œï¼š\n\nåˆ‡æ¢åˆ°ç”¨æˆ·æ€\nè·³è½¬åˆ°è¿›ç¨‹Bçš„PCæŒ‡å‘çš„æŒ‡ä»¤\nè¿›ç¨‹Bå¼€å§‹æ‰§è¡Œ\n\n\n\n7.3 å†…å­˜ä¸è¶³æ—¶çš„å¤„ç†\nå½“ç³»ç»Ÿå†…å­˜ä¸è¶³ï¼Œæ–°è¿›ç¨‹éœ€è¦å†…å­˜æ—¶ï¼š\n\n\nè§¦å‘page faultï¼š\n\nè¿›ç¨‹è®¿é—®æœªæ˜ å°„çš„è™šæ‹Ÿåœ°å€\nMMUå‘ç°é¡µè¡¨é¡¹æ— æ•ˆ\n\n\n\næ£€æŸ¥ç©ºé—²å¸§ï¼š\n\nå¦‚æœæ²¡æœ‰ç©ºé—²å¸§ï¼Œæ‰§è¡Œé¡µé¢ç½®æ¢\n\n\n\né¡µé¢ç½®æ¢ï¼š\n\nä½¿ç”¨LRUç­‰ç®—æ³•é€‰æ‹©victim frame\nå¦‚æœvictim pageè¢«ä¿®æ”¹ï¼Œå†™å›ç£ç›˜\nå°†victim pageçš„é¡µè¡¨é¡¹æ ‡è®°ä¸ºæ— æ•ˆ\n\n\n\nè°ƒå…¥æ–°é¡µé¢ï¼š\n\nä»ç£ç›˜è¯»å–éœ€è¦çš„é¡µé¢åˆ°victim frame\næ›´æ–°é¡µè¡¨ï¼Œå»ºç«‹æ˜ å°„\næ›´æ–°TLB\n\n\n\nç»§ç»­æ‰§è¡Œï¼š\n\né‡æ–°æ‰§è¡Œè§¦å‘page faultçš„æŒ‡ä»¤\nè¿›ç¨‹ç»§ç»­æ­£å¸¸è¿è¡Œ\n\n\n\nå…«ã€æ€»ç»“ï¼šå…³é”®æœºåˆ¶çš„è”ç³»\n8.1 è¿›ç¨‹ä¸å†…å­˜çš„ç´§å¯†å…³ç³»\n\nè¿›ç¨‹æ˜¯èµ„æºåˆ†é…çš„å•ä½ï¼šæ¯ä¸ªè¿›ç¨‹æ‹¥æœ‰ç‹¬ç«‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´\nå†…å­˜æ˜¯è¿›ç¨‹è¿è¡Œçš„åŸºç¡€ï¼šè¿›ç¨‹çš„ä»£ç ã€æ•°æ®ã€å †æ ˆéƒ½å­˜å‚¨åœ¨å†…å­˜ä¸­\né¡µè¡¨æ˜¯è¿›ç¨‹çš„â€èº«ä»½è¯â€ï¼šé€šè¿‡é¡µè¡¨å®ç°è™šæ‹Ÿåœ°å€åˆ°ç‰©ç†åœ°å€çš„æ˜ å°„\nPCBæ˜¯è¿›ç¨‹çš„â€æ¡£æ¡ˆâ€ï¼šè®°å½•è¿›ç¨‹çš„æ‰€æœ‰ä¿¡æ¯ï¼ŒåŒ…æ‹¬å†…å­˜ç®¡ç†ä¿¡æ¯\n\n8.2 ä¸­æ–­é©±åŠ¨çš„ç³»ç»Ÿ\n\nç¡¬ä»¶ä¸­æ–­ï¼šTimerã€I/Oè®¾å¤‡ç­‰ç¡¬ä»¶äº§ç”Ÿä¸­æ–­ï¼Œè§¦å‘è°ƒåº¦\nè½¯ä¸­æ–­ï¼šç³»ç»Ÿè°ƒç”¨ã€å¼‚å¸¸ç­‰è½¯ä»¶äº‹ä»¶è§¦å‘ä¸­æ–­ï¼Œè¿›å…¥å†…æ ¸æ€\nä¸­æ–­å¤„ç†ï¼šå†…æ ¸å¤„ç†ä¸­æ–­ï¼Œå¯èƒ½æ”¹å˜è¿›ç¨‹çŠ¶æ€ï¼Œè§¦å‘è°ƒåº¦\n\n8.3 è™šæ‹Ÿå†…å­˜çš„ä¼˜åŠ¿\n\néš”ç¦»æ€§ï¼šæ¯ä¸ªè¿›ç¨‹æ‹¥æœ‰ç‹¬ç«‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œäº’ä¸å¹²æ‰°\nçµæ´»æ€§ï¼šè¿›ç¨‹å¯ä»¥ä½¿ç”¨æ¯”ç‰©ç†å†…å­˜æ›´å¤§çš„è™šæ‹Ÿåœ°å€ç©ºé—´\næ•ˆç‡ï¼šé€šè¿‡æŒ‰éœ€åˆ†é¡µå’Œé¡µé¢ç½®æ¢ï¼Œæé«˜å†…å­˜åˆ©ç”¨ç‡\nå…±äº«æ€§ï¼šå¤šä¸ªè¿›ç¨‹å¯ä»¥å…±äº«åŒä¸€å—ç‰©ç†å†…å­˜ï¼ˆä»£ç ã€æ•°æ®ï¼‰\n\n8.4 è¿›ç¨‹åˆ‡æ¢çš„æœ¬è´¨\nè¿›ç¨‹åˆ‡æ¢æœ¬è´¨ä¸Šæ˜¯ï¼š\n\nä¿å­˜å½“å‰æ‰§è¡Œç¯å¢ƒï¼šå¯„å­˜å™¨ã€çŠ¶æ€ã€å†…å­˜æ˜ å°„\næ¢å¤å¦ä¸€ä¸ªæ‰§è¡Œç¯å¢ƒï¼šåŠ è½½å¦ä¸€ä¸ªè¿›ç¨‹çš„ä¸Šä¸‹æ–‡\nç»§ç»­æ‰§è¡Œï¼šä»å¦ä¸€ä¸ªè¿›ç¨‹çš„æ–­ç‚¹ç»§ç»­\nè¿™ä¸€åˆ‡éƒ½ä¾èµ–äºï¼š\n\n\nä¸­æ–­æœºåˆ¶ï¼šæä¾›åˆ‡æ¢çš„æ—¶æœº\nå†…å­˜ç®¡ç†ï¼šä¿è¯è¿›ç¨‹é—´çš„éš”ç¦»å’Œæ­£ç¡®æ˜ å°„\nè°ƒåº¦ç®—æ³•ï¼šå†³å®šåˆ‡æ¢å“ªä¸ªè¿›ç¨‹\n\n\nç›¸å…³æ¦‚å¿µç´¢å¼•\n\n01 introduction - æ“ä½œç³»ç»Ÿæ¦‚è¿°ã€ä¸­æ–­ã€ç‰¹æƒæ¨¡å¼\n02.1 è¿›ç¨‹ - è¿›ç¨‹æ¦‚å¿µã€PCBã€è¿›ç¨‹åˆ›å»ºä¸ç»ˆæ­¢\n02.2 è°ƒåº¦ - è¿›ç¨‹çŠ¶æ€ã€è°ƒåº¦ç®—æ³•ã€ä¸Šä¸‹æ–‡åˆ‡æ¢\n04.1 ä¸»å­˜ - å†…å­˜åˆ†é…ã€åˆ†é¡µã€é¡µè¡¨ã€TLB\n04.2 virtual memory - è™šæ‹Ÿå†…å­˜ã€æŒ‰éœ€åˆ†é¡µã€é¡µé¢ç½®æ¢\n"},"è¯¾ç¨‹ç¬”è®°/è®¡ç®—æœºç»„æˆ/02-Instructions":{"slug":"è¯¾ç¨‹ç¬”è®°/è®¡ç®—æœºç»„æˆ/02-Instructions","filePath":"è¯¾ç¨‹ç¬”è®°/è®¡ç®—æœºç»„æˆ/02 Instructions.md","title":"02 Instructions","links":["tags/flashcard","ABI-(Application-Binary-Interface)"],"tags":["flashcard"],"content":"DECK: CS::CO\nsummary\n\n\nå¯„å­˜å™¨ registers flashcard\n\nRISC-V architecture æä¾› 32 ä¸ªæ•°æ®å¯„å­˜å™¨ï¼Œåˆ†åˆ«å‘½åä¸ºÂ x0Â ~Â x31Â ï¼Œæ¯ä¸ªå¯„å­˜å™¨çš„å¤§å°æ˜¯Â 64Â ä½ã€‚\n\nx0Â çš„å€¼æ’ä¸º 0\nPreserved on call æ„ä¸ºæ˜¯å¦ä¿è¯è°ƒç”¨å‰åè¿™äº›å¯„å­˜å™¨çš„å€¼ä¸å˜ã€‚\n\n\nä¹Ÿæä¾›ä¸€ç³»åˆ—æµ®ç‚¹æ•°å¯„å­˜å™¨Â f0Â ~Â f31ã€‚\nä¹‹æ‰€ä»¥å¯„å­˜å™¨çš„ä¸ªæ•°ä¸å¤šï¼Œæ˜¯å› ä¸ºè¿‡å¤šçš„å¯„å­˜å™¨ä¼šå¢åŠ ç”µå­ä¿¡å·çš„ä¼ æ’­è·ç¦»ï¼Œä»è€Œå¯¼è‡´æ—¶é’Ÿå‘¨æœŸçš„å»¶é•¿ã€‚\nå°†ä¸å¸¸ç”¨çš„ï¼ˆæˆ–ä¹‹åç”¨åˆ°çš„ï¼‰å˜é‡å­˜å…¥å†…å­˜çš„è¿‡ç¨‹è¢«ç§°ä¸ºæº¢å‡ºå¯„å­˜å™¨Â (Spilling Register)\nå¯„å­˜å™¨å­˜å‚¨ç©ºé—´å°ï¼Œå†…å­˜å­˜å‚¨ç©ºé—´å¤§ å› æ­¤å°è§„æ¨¡çš„æ•°æ®ä¼šæ”¾åœ¨å¯„å­˜å™¨å†…ï¼Œè€Œæ›´å¤§è§„æ¨¡çš„æ•°æ®åˆ™ä¼šå­˜å‚¨åœ¨è®¡ç®—æœºçš„å†…å­˜(memory)Â ä¸­\nå„ç§æ“ä½œä¸è¿ç®—éƒ½åªèƒ½åœ¨å¯„å­˜å™¨å†…å®Œæˆ\nå¯„å­˜å™¨æœ‰ç€æ›´å¿«çš„è¿è¡Œé€Ÿåº¦å’Œæ›´é«˜çš„ååé‡ï¼Œä½¿å¾—è®¿é—®å¯„å­˜å™¨å†…çš„æ•°æ®æ›´åŠ è¿…é€Ÿå’Œæ–¹ä¾¿ï¼Œä¸”è®¿é—®å¯„å­˜å™¨çš„èƒ½è€—æ›´ä½ï¼›è€Œè®¿é—®å†…å­˜éœ€è¦Â loadÂ å’ŒÂ storeÂ æŒ‡ä»¤ï¼Œé‚£ä¹ˆå°±éœ€è¦æ‰§è¡Œæ›´å¤šçš„æŒ‡ä»¤\n\n\nå­—èŠ‚åœ°å€ flashcard\n\n\n==åœ¨ RISC-V architecture ä¸­ï¼Œä¸€ä¸ªÂ wordÂ ä¸º 32 ä½ï¼ˆ4Bytes ï¼‰ï¼Œä¸€ä¸ªÂ doublewordÂ ä¸º 64 ä½ï¼ˆ8Bytes ï¼‰ã€‚==\nRISC-V architecture çš„åœ°å€æ˜¯ 64 ä½çš„ï¼Œåœ°å€ä¸ºå­—èŠ‚åœ°å€ï¼Œå› æ­¤æ€»å…±å¯ä»¥å¯»å€2çš„64æ¬¡æ–¹ä¸ªå­—èŠ‚ï¼Œå³2çš„61æ¬¡æ–¹ä¸ª dword ï¼Œå› ä¸ºä¸€ä¸ª dword å 3ä½ï¼ˆ8Bytesç”¨3ä¸ªå­—èŠ‚åœ°å€ä½è¡¨ç¤ºï¼‰\n\nå¦‚æœæƒ³æ“ä½œæŸä¸€ä¸ª bitï¼ˆæ¯”å¦‚æŠŠç¬¬ 3 ä¸ª bit ä» 0 æ”¹æˆ 1 ï¼‰ï¼ŒCPU å¿…é¡»ï¼š\n\nè¯»å– (Read)ï¼šå…ˆæŠŠè¿™ä¸ª bit æ‰€åœ¨çš„æ•´ä¸ªå­—èŠ‚ï¼ˆæ•´ä¸ªæˆ¿é—´ï¼‰çš„æ•°æ®ï¼ˆ8ä¸ª bitsï¼‰å…¨éƒ¨å–åˆ° CPU å¯„å­˜å™¨ä¸­ã€‚\nä¿®æ”¹ (Modify)ï¼šåœ¨ CPU å†…éƒ¨ï¼Œä½¿ç”¨ä½è¿ç®—ï¼ˆæ¯”å¦‚ OR è¿ç®—ï¼‰æ¥å•ç‹¬ä¿®æ”¹é‚£ 1 ä¸ª bitï¼Œè€Œå…¶ä»– 7 ä¸ª bit ä¿æŒä¸å˜ã€‚\nå†™å› (Write)ï¼šæŠŠä¿®æ”¹åçš„æ•´ä¸ªå­—èŠ‚ï¼ˆ8ä¸ª bitsï¼‰å†å­˜å›åˆ°åŸæ¥çš„å†…å­˜åœ°å€\n\n\n\n\n\n\nå¯»å€ flashcard\n\nåœ¨ä¸€äº› architecture ä¸­ï¼Œword çš„èµ·å§‹åœ°å€å¿…é¡»æ˜¯ word å¤§å°çš„æ•´å€æ•°ï¼Œdword ä¹Ÿä¸€æ ·ï¼Œè¿™ç§è¦æ±‚ç§°ä¸ºÂ alignment restrictionã€‚\n\nRISC-V å…è®¸ä¸å¯¹é½çš„å¯»å€ï¼Œä½†æ˜¯æ•ˆç‡ä¼šä½ã€‚\nä¸€æ¬¡åªèƒ½è¯»å‡º4å­—èŠ‚å†…å­˜ä¸­çš„ä¸€è¡Œ\n\n\nRISC-V æ”¯æŒ\n\nç«‹å³æ•°å¯»å€ (Â luiÂ )\né—´æ¥å¯»å€ (Â jalrÂ )\nåŸºå€å¯»å€ (Â 8(sp)Â )ï¼š\nPC relative å¯»å€ï¼šåˆ†æ”¯åœ°å€ä¸ºPCå’Œåˆ†æ”¯åç§»é‡ï¼ˆç«‹å³æ•°çš„2å€ï¼‰ä¹‹å’Œ\n\nå› ä¸ºæ‰€æœ‰åˆæ³•çš„æŒ‡ä»¤å¿…é¡»å­˜æ”¾åœ¨å¶æ•°å†…å­˜åœ°å€ã€æŒ‡ä»¤ï¼š16bitï¼ˆå‹ç¼©æŒ‡ä»¤ï¼‰/32bit ã€‘å› æ­¤æœ€ä½ä½å§‹ç»ˆä¸º0ï¼Œå› æ­¤ä¸ºäº†ä¼˜åŒ–ï¼ŒæŒ‡ä»¤ä¸­ä¼šç•¥å»æœ€åä¸€ä¸ª0\næŠŠå­˜å‚¨çš„ immediate è¿˜åŸæˆçœŸæ­£çš„ Branch offset\n\n\n\n\n\n\n\nå¤§å°ç«¯ flashcard\n\nRISC-V ä½¿ç”¨Â little endianÂ å°ç«¯ç¼–å€ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æˆ‘ä»¬ä» 0x1000 è¿™ä¸ªåœ°å€è¯»å‡ºä¸€ä¸ª dword æ—¶ï¼Œæˆ‘ä»¬è¯»åˆ°çš„å®é™…ä¸Šæ˜¯ 0x1000~0x1007 è¿™ 8 ä¸ªå­—èŠ‚ï¼Œå¹¶å°† 0x1000 å­˜å…¥å¯„å­˜å™¨ä½ä½ï¼Œ0x1007 å­˜å…¥é«˜ä½ã€‚\n\nå­˜å‚¨å­—èŠ‚ 0x88 å°±æ˜¯ bitï¼š10001000\nå¤§å°ç«¯åªå…³å¿ƒå­—èŠ‚çš„é¡ºåºï¼Œä¸å…³å¿ƒå­—èŠ‚å†…éƒ¨bitçš„é¡ºåº\n\n\n\n\nè¡¥ç  2â€™s complement flashcard\n\nå› æ­¤åœ¨å°†ä¸è¶³ 64 ä½çš„æ•°æ®è½½å…¥å¯„å­˜å™¨æ—¶\n\nå¦‚æœæ•°æ®æ˜¯æ— ç¬¦å·æ•°ï¼Œåªéœ€è¦ä½¿ç”¨ 0 å°†å¯„å­˜å™¨çš„å…¶ä»–éƒ¨åˆ†å¡«å…… (zero extension)\n\næŒ‡ä»¤ä¸­çš„lwuÂ ,Â lhuÂ ,Â lbuÂ ä½¿ç”¨zero extensionã€‚\n\n\nè€Œå¦‚æœæ˜¯æœ‰ç¬¦å·æ•°ï¼Œåˆ™éœ€è¦ç”¨æœ€é«˜ä½å³ç¬¦å·ä½å¡«å……å‰©ä½™éƒ¨åˆ†ï¼Œç§°ä¸ºç¬¦å·æ‰©å±• (sign extension)ã€‚\n\næŒ‡ä»¤ä¸­çš„Â lwÂ ,Â lhÂ ,Â lbÂ ä½¿ç”¨sign extension\n\n\n\n\n\nå¯¹äºè¡¥ç å…ˆçœ‹ç¬¦å·ä½ï¼Œè´Ÿæ•°çš„è¯å°±å¯¹æ•°å­—éƒ¨åˆ†åšè¡¥ç è¿˜åŸï¼Œè¿˜æ˜¯å–ååŠ ä¸€ã€‚\n1â€™scomplementæ˜¯åç ï¼Œå…ˆçœ‹ç¬¦å·ä½ï¼Œè´Ÿæ•°å°±å¯¹æ•°å­—éƒ¨åˆ†åšåç è¿˜åŸï¼Œå–åå³å¯\n\n\næŒ‡ä»¤\nè®¾è®¡å‡†åˆ™\næ­£åˆ™åŒ– simplicity favors regularity ç®€åŒ–è§„èŒƒ\nè¶Šå°è¶Šå¿« smaller is faster 32ä¸ªé€šç”¨å¯„å­˜å™¨ 32*64bit\næŒ‡ä»¤\n\nArithmetic\n\nåŠ æ³•\n\naddï¼šå¯„å­˜å™¨Â 1 +Â å¯„å­˜å™¨Â 2\n|add reg1, reg2, reg3    // (in C) reg1 = reg2 + reg3|\naddi(Add Immediate)ï¼šå¯„å­˜å™¨Â +Â å¸¸é‡\n|addi reg1, reg2, const  // (in C) reg1 = reg2 + const|\n\n\nå‡æ³•\n\nsubï¼šå¯„å­˜å™¨Â 1 -Â å¯„å­˜å™¨Â 2\n|sub reg1, reg2, reg3    // (in C) reg1 = reg2 - reg3|\n==æ³¨æ„ï¼šæ²¡æœ‰subiï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡addiä¸€ä¸ªè´Ÿå¸¸æ•°æ¥å®ç°==\n\n\n\nLogical Operations\n\n\nsll/slliï¼Œsrl/srliÂ åˆ†åˆ«ä¸ºé€»è¾‘å·¦ç§»/å³ç§»\n\nå·¦ç§»iä½ç›¸å½“äºä¹˜ä»¥2çš„iæ¬¡æ–¹ï¼Œå³ç§»iä½ç›¸å½“äºæ•´é™¤2çš„iæ¬¡æ–¹Â \né€»è¾‘å³ç§»æ—¶æœ€å·¦è¾¹è¡¥Â 0\nä¸å¸¦içš„æŒ‡ä»¤è¡¨ç¤ºæ ¹æ®å¯„å­˜å™¨çš„å€¼ç¡®å®šç§»åŠ¨ä½æ•°ï¼Œå¸¦içš„æŒ‡ä»¤è¡¨ç¤ºç”¨ç«‹å³æ•°ç¡®å®šç§»åŠ¨ä½æ•°\n|slli x11, x19, 4    // reg x11 = reg x19 &lt;&lt; 4 bits|\n\n\nsra/sraiÂ ä¸ºç®—æœ¯å³ç§»ï¼Œæœ€å·¦è¾¹è¡¥ç¬¦å·ä½\n\nBit Operations\n|and reg1, reg2, reg3    // (in C) reg1 = reg2 &amp; reg3`|\n\n|or reg1, reg2, reg3    // (in C) reg1 = reg2 | reg3`|\n\nANDã€ORã€XORÂ ä¹Ÿæœ‰ç«‹å³æ•°ç‰ˆæœ¬çš„æŒ‡ä»¤ï¼Œåˆ†åˆ«ä¸ºï¼šandiã€oriå’Œxori\n\n|xor reg1, reg2, reg3    `|\n\nRISC-VÂ ä¸­æ²¡æœ‰Â NOTÂ æŒ‡ä»¤ï¼Œå› ä¸ºå®ƒå¯ä»¥é€šè¿‡å¼‚æˆ–è¡¨ç¤ºå‡ºæ¥ï¼šä»»ä½•æ•°ä¸Â 111â€¦111Â å¼‚æˆ–çš„ç»“æœå³ä¸ºè¯¥æ•°å–ååçš„ç»“æœ\n\nMaking Decisions\nè®¡ç®—æœºä¸è®¡ç®—å™¨çš„ä¸€å¤§ä¸åŒä¹‹å¤„åœ¨äºè®¡ç®—æœºå…·å¤‡å†³ç­–çš„èƒ½åŠ›ï¼šå®ƒèƒ½å¤Ÿæ‰§è¡Œåˆ†æ”¯ï¼ˆæ¡ä»¶ï¼‰è¯­å¥ã€å¾ªç¯è¯­å¥ç­‰ã€‚\nåœ¨Â RISC-VÂ æ±‡ç¼–è¯­è¨€ä¸­ï¼Œå…³äºå†³ç­–çš„æŒ‡ä»¤æ ¼å¼å‡ä¸ºï¼šinst rs1, rs2, L1\n\nå…¶ä¸­rs1ã€rs2æ˜¯å¯„å­˜å™¨\nL1æ˜¯æ ‡ç­¾ï¼ˆè·³è½¬ä½ç½®ï¼Œä¹Ÿå¯ä»¥æ˜¯ç«‹å³æ•° immï¼Œè¡¨ç¤ºè·³è½¬åˆ° PC+imm çš„æŒ‡ä»¤ï¼‰\ninstæ˜¯æŒ‡ä»¤ï¼Œæ¯”è¾ƒçš„æ˜¯è¡¥ç å€¼ã€‚/0\n\nå…¶åˆ†ç±»å¦‚ä¸‹ï¼š\n\næ¡ä»¶åˆ†æ”¯(conditional branch)ï¼šå…ˆæ£€æµ‹å€¼ï¼Œæ ¹æ®æ£€æµ‹ç»“æœå†³å®šæ˜¯å¦å°†æ§åˆ¶æƒè½¬äº¤ç»™æ–°åœ°å€ä¸Šçš„è¯­å¥çš„ä¸€ç±»æŒ‡ä»¤\næ— æ¡ä»¶åˆ†æ”¯(unconditional branch)ï¼šæ¡ä»¶æ’ä¸ºçœŸçš„æ¡ä»¶åˆ†æ”¯ï¼Œå› æ­¤è¯¥è¯­å¥ä¸€å®šä¼šæ‰§è¡Œ\n\næœ‰ä»¥ä¸‹å‡ ç§å¯ç”¨æŒ‡ä»¤ï¼š\n\nbeq(Branch If Equal)ï¼šå¦‚æœå¯„å­˜å™¨rs1å’Œrs2çš„å€¼ç›¸ç­‰ï¼Œé‚£ä¹ˆè·³è½¬è‡³å¸¦æ ‡ç­¾L1çš„è¯­å¥\nbne(Branch If Not Equal)ï¼šå¦‚æœå¯„å­˜å™¨rs1å’Œrs2çš„å€¼ä¸ç›¸ç­‰ï¼Œé‚£ä¹ˆè·³è½¬è‡³å¸¦æ ‡ç­¾L1çš„è¯­å¥\nblt(Branch If Less Than)ï¼šå¦‚æœå¯„å­˜å™¨rs1çš„å€¼å°äºrs2çš„å€¼ï¼Œé‚£ä¹ˆè·³è½¬è‡³å¸¦æ ‡ç­¾L1çš„è¯­å¥\n\nbltuï¼šæ— ç¬¦å·ç‰ˆæœ¬ unsigned æ¯”å¦‚å­˜çš„æ˜¯åœ°å€ï¼Œå°±åªèƒ½ç”¨bltuå½“ä½œæ— ç¬¦å·æ•°æ¥æ¯”è¾ƒï¼Œå¦åˆ™ä¼šå¼•å…¥ç¬¦å·ä½ã€‚ã€å¦‚æœé«˜ä½åœ°å€ç”¨ä¸ä¸Šä¹Ÿä¸å®¹æ˜“å‡ºé”™ï¼Œå¦‚æœåœ°å€æ¯”è¾ƒå¤§å°±ä¸€å®šè¦bltuã€‘\n\n\nbge(Branch If Greater Than or Equal)ï¼šå¦‚æœå¯„å­˜å™¨rs1çš„å€¼å¤§äºç­‰äºrs2çš„å€¼ï¼Œé‚£ä¹ˆè·³è½¬è‡³å¸¦æ ‡ç­¾L1çš„è¯­å¥\n\nbgeuï¼šæ— ç¬¦å·ç‰ˆæœ¬ unsigned\n\n\n\nif\n\nif-else\n\ncase-switch\nå¯¹äºcase/switchè¯­å¥ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€å¼ æ”¾æœ‰å¯é€‰æŒ‡ä»¤åºåˆ—åœ°å€çš„è¡¨æ ¼ï¼ˆç§°ä¸ºåˆ†æ”¯åœ°å€è¡¨ï¼ŒBranch Address Tableï¼‰ï¼Œè¿™æ ·çš„è¯ç¨‹åºå°±å¯ä»¥æ ¹æ®æ¡ä»¶åˆ¤æ–­çš„ç»“æœï¼Œé€šè¿‡è¡¨æ ¼çš„ç´¢å¼•æ‰¾åˆ°åˆé€‚çš„æŒ‡ä»¤åºåˆ—ã€‚\n\n\n\nloops\n\nå¾ªç¯è®¿é—®æ•°ç»„\nwhile\n\nset on less than\nslt x5, x19, x20\n\nå¦‚æœ x19&lt;x20ï¼Œé‚£ä¹ˆå°† x5 èµ‹å€¼ä¸º 1\n\nData Transfer Instructions\nç”±äºå¯¹æ•°æ®çš„å„ç§æ“ä½œåªèƒ½åœ¨å¯„å­˜å™¨å†…å®Œæˆï¼Œè€Œæ— æ³•åœ¨å†…å­˜ä¸­å®ç°ï¼Œå› æ­¤æ•°æ®éœ€è¦å†å¯„å­˜å™¨å’Œå†…å­˜ä¹‹é—´æ¥å›ä¼ é€’ï¼Œæ¥å®Œæˆè¿™ä¸€ä¼ é€’æ“ä½œçš„æŒ‡ä»¤è¢«ç§°ä¸ºæ•°æ®ä¼ è¾“æŒ‡ä»¤\nRISC-V æœ‰ä»¥ä¸‹æ•°æ®ä¼ è¾“æŒ‡ä»¤ï¼š\n\nldï¼ˆLoad Doublewordï¼‰ï¼šåŠ è½½æŒ‡ä»¤ï¼Œå°†æ•°æ®ä»å†…å­˜æ‹·è´åˆ°å¯„å­˜å™¨å½“ä¸­\n|ld reg, offset(mem_base_addr) |\n\nreg: å¯„å­˜å™¨\nmem_base_addr: ä¸€ä¸ªä¿å­˜å†…å­˜åŸºç¡€åœ°å€çš„å¯„å­˜å™¨ï¼ˆå¯ä»¥ç†è§£ä¸ºèƒ½è®¿é—®åˆ°æ•´ä¸ªå†…å­˜çš„å¤´æŒ‡é’ˆï¼‰\noffset: åç§»é‡ï¼Œæ˜¯ä¸€ä¸ªå¸¸æ•°\nå†…å­˜æ•°æ®çš„å®é™…åœ°å€Â =Â mem_base_addr + offset\n\n\nsdï¼ˆStore Doublewordï¼‰ï¼šå­˜å‚¨æŒ‡ä»¤ï¼Œå°†å¯„å­˜å™¨çš„æ•°æ®æ‹·è´åˆ°å†…å­˜ä¸­\n|`sd reg, offset(mem_base_addr) |\n\nreg: å¯„å­˜å™¨\nmem_base_addr: å†…å­˜åŸºç¡€åœ°å€å¯„å­˜å™¨\noffset: åç§»é‡\n\n\nlbu(Load Byte Unsigned)ï¼šåŠ è½½Â 1Â å­—èŠ‚çš„æ•°æ®ï¼Œå¹¶çœ‹ä½œæ— ç¬¦å·æ•°\nlb(Load Byte)ï¼šlbuçš„æœ‰ç¬¦å·æ•°ç‰ˆæœ¬\n\n\nåœ¨ RISC æŒ‡ä»¤é›†ä¸­ï¼Œåªæœ‰ load ç³»åˆ—å’Œ store ç³»åˆ—æŒ‡ä»¤èƒ½å¤Ÿè®¿é—®å†…å­˜ã€‚\n\n\nç«‹å³æ•° Constant or Immediate Operands\n\nä¸€èˆ¬çš„åšæ³•æ˜¯å°†å¸¸æ•°ä¿å­˜åœ¨ä¸€ä¸ªå¯„å­˜å™¨å½“ä¸­ï¼Œé€šè¿‡ä¸€ä¸ªåœ°å€æŒ‡é’ˆæŒ‡å‘è¿™ä¸ªå¯„å­˜å™¨ï¼Œç„¶åé€šè¿‡Â addÂ æŒ‡ä»¤å®ç°åŠ æ³•æ“ä½œ\n|ld x9, AddrConstant4(x3) //x9 = constant 4 add x22, x22, x9|\nå®é™…ä¸Šæˆ‘ä»¬å¯ä»¥å¼•å…¥ä¸€ä¸ªæ–°çš„æ¦‚å¿µï¼šç«‹å³æ•°ï¼ˆImmediateï¼‰ï¼Œè¿™æ ·å°±é¿å…äº†åŠ è½½æŒ‡ä»¤ï¼ˆå³é€šè¿‡æ“ä½œÂ addi x22, x22, 4Â å³å¯å®ç°ï¼‰\n\nåŒæ­¥Synchronization in RISC-V\nå‡è®¾ä¸¤ä¸ªå¤„ç†å™¨åœ¨åŒä¸€ç‰‡å†…å­˜ç©ºé—´ä¸­å·¥ä½œï¼Œå¹¶ä¸”å®ƒä»¬çš„å·¥ä½œé¡ºåºä¸ºï¼šP1å†™å…¥æ•°æ®åï¼ŒP2å†è¯»å–æ•°æ®ã€‚æ²¡æœ‰åŒæ­¥ï¼ˆSynchoronizeï¼‰å¥½ï¼Œé‚£ä¹ˆå°±ä¼šäº§ç”Ÿæ•°æ®ç«äº‰ï¼ˆData Raceï¼‰çš„é—®é¢˜ï¼ˆç»“æœå–å†³äºè®¿é—®é¡ºåºï¼Œå› æ­¤è¿™ä¸ªç»“æœå°±æ˜¯ä¸ç¡®å®šçš„ï¼‰ã€‚\né¿å…è¿™ä¸€é—®é¢˜çš„æ–¹æ³•æ˜¯åŸå­è¯»å–Â /Â å†™å…¥Â (Atomic Read/Write)Â å†…å­˜æ“ä½œï¼Œè¿™ç§æ“ä½œç¡®ä¿è¯»å’Œå†™ä¹‹é—´ä¸ä¼šæœ‰ä»»ä½•è®¿é—®è¿™å—å†…å­˜ç©ºé—´çš„è¡Œä¸ºã€‚\næœ‰äº›å¤„ç†å™¨æœ‰ä¸“é—¨å®ç°åŸå­æ“ä½œçš„æŒ‡ä»¤ï¼Œæ¯”å¦‚åŸå­äº¤æ¢Â (Atomic Swap/Exchange)ï¼ˆå®ç°å¯„å­˜å™¨å’Œå†…å­˜æ•°æ®çš„äº¤æ¢ï¼‰ç­‰ã€‚è€ŒÂ RISC-VÂ æä¾›äº†ä¸€ä¸ªæŒ‡ä»¤å¯¹Â (Instruction Pair)Â lr.då’Œsc.dï¼š\n\nlr.dï¼ˆLoad-Reserved Doublewordï¼‰ï¼š\n\nlr.d rd, (rs1)Â å°†å­˜å‚¨åœ¨å¯„å­˜å™¨rs1çš„å†…å­˜åœ°å€ä¸Šçš„æ•°æ®åŠ è½½åˆ°å¯„å­˜å™¨rdä¸Šï¼ŒåŒæ—¶ä¿ç•™è¿™å—å†…å­˜åœ°å€ï¼Œé™¤sc.dçš„å…¶ä»–æŒ‡ä»¤ä¸åº”è¯¥è®¿é—®è¿™å—åœ°å€\n\n\nsc.dï¼ˆStore-Conditional Doublewordï¼‰ï¼š\n\nsc.d rd, rs1, (rs2)Â å°†å¯„å­˜å™¨rs1ä¸Šçš„æ•°æ®æ”¾å…¥å­˜å‚¨åœ¨å¯„å­˜å™¨rs2çš„å†…å­˜åœ°å€ä¸Šï¼Œå¹¶ä¸”ç”±å¯„å­˜å™¨rdæŒ‡ç¤ºè¯¥æŒ‡ä»¤æ˜¯å¦æˆåŠŸï¼šè‹¥æˆåŠŸï¼Œåˆ™rd = 0ï¼Œå¦åˆ™rdä¸ºä¸€ä¸ªéé›¶å€¼ï¼ˆè¡¨ç¤ºæœ‰å…¶ä»–æŒ‡ä»¤è®¿é—®è¿‡è¿™å—å†…å­˜ç©ºé—´ï¼‰\n\n\n\n\nå…¶ä»–\n\næ‹“å±•æŒ‡ä»¤é›†å†…å®¹ï¼š\n\nMï¼šä¸ä¹˜é™¤æ³•ç›¸å…³çš„æŒ‡ä»¤\nAï¼šåŸå­è¿ç®—ï¼ŒåŒ…æ‹¬å‰é¢æåˆ°è¿‡çš„lr.då’Œsc.dæŒ‡ä»¤ï¼Œä»¥åŠå®ƒä»¬çš„Â 32Â ä½ç‰ˆæœ¬lr.wå’Œsc.wç­‰\nFï¼šå•ç²¾åº¦æµ®ç‚¹è¿ç®—ç›¸å…³æŒ‡ä»¤\nDï¼šåŒç²¾åº¦æµ®ç‚¹è¿ç®—ç›¸å…³æŒ‡ä»¤\nCï¼šå‹ç¼©çš„æŒ‡ä»¤ï¼Œåªæœ‰Â 16Â ä½å®½\n\n\nä¼ªæŒ‡ä»¤\n\nè¿‡ç¨‹ï¼ˆProcedureï¼‰æˆ–å‡½æ•°ï¼ˆFunctionï¼‰\nè°ƒç”¨è¿‡ç¨‹Procedure Call Instructions flashcard\n\n\njalä¸jalr\n\njalræ˜¯åŸºäºã€å¯„å­˜å™¨åœ°å€+12ä½ç«‹å³æ•°åç§»é‡ã€‘\njalæ˜¯åŸºäºpcç›¸å¯¹åœ°å€ã€20ä½ç«‹å³æ•°ã€‘ï¼Œjal rdï¼Œoffset\n\n\nå¯¹äºè°ƒç”¨è€…ï¼šè°ƒç”¨æŸä¸ªç¨‹åºåœ°å€åï¼Œå°†è¿”å›åœ°å€ï¼ˆè·³è½¬çš„ä¸‹ä¸€æ¡åœ°å€PC+4ï¼‰å­˜å…¥x1ï¼ˆraï¼‰ä¸­\nå¯¹äºè¢«è°ƒç”¨è€…ï¼Œx0æ— æ³•è¢«å†™å…¥ï¼Œè¡¨ç¤ºä¸ä¿å­˜ä»»ä½•è¿”å›åœ°å€ï¼Œä»…ä½œè·³è½¬ã€‚\n\nè°ƒç”¨è¿‡ç¨‹ä¸­çš„å¯„å­˜å™¨Registers for procedure calling\nRISC-Vå¯„å­˜å™¨ flashcard\nLocal Data on the Stack\næ ˆä¸æ ˆå¸§ flashcard\nMemory Layout\nMemory Layout flashcard\nRICV-VæŒ‡ä»¤æ ¼å¼ flashcard\næŒ‡ä»¤ç¼–ç 32bit, è®°å…¶ä¸ºæœºå™¨ç ï¼ˆMachine Codeï¼‰ã€‚æˆ‘ä»¬å¯ä»¥æŠŠæ¯æ¡æŒ‡ä»¤å½“ä½œä¸€å—å—äºŒè¿›åˆ¶æ•°å­—æ„æˆçš„ç»„åˆï¼Œè€Œè¿™å•å—çš„æ•°å­—è¢«ç§°ä¸ºå­—æ®µï¼ˆFieldï¼‰ã€‚æˆ‘ä»¬ä¸ºå­—æ®µèµ‹äºˆäº†ä¸€äº›åç§°ï¼Œæ¯ä¸ªå­—æ®µæœ‰ä¸åŒçš„åŠŸèƒ½ï¼š\n\nopcodeï¼šæŒ‡ä»¤è¦åšçš„è¿ç®—ï¼Œå¯ç”¨è¿™ä¸ªå­—æ®µåŒºåˆ†å„ç§ç±»å‹çš„æŒ‡ä»¤æ ¼å¼(instruction format)\nfunct3ï¼šé¢å¤–çš„opcodeå­—æ®µ\nfunct7ï¼šé¢å¤–çš„opcodeå­—æ®µ\nrdï¼šå¯„å­˜å™¨ç›®æ ‡æ“ä½œæ•°ï¼Œä¿å­˜è¿ç®—çš„ç»“æœ\nrs1ï¼šç¬¬ä¸€ä¸ªå¯„å­˜å™¨æºæ“ä½œæ•°\nrs2ï¼šç¬¬äºŒä¸ªå¯„å­˜å™¨æºæ“ä½œæ•°\nimmediateï¼šç«‹å³æ•°ï¼Œå³å¸¸æ•°\næ ¹æ®ä¸åŒçš„ opcode æˆ‘ä»¬å¯ä»¥å°†æŒ‡ä»¤åˆ†ä¸º 6 ç§ç±»å‹ï¼Œå®ƒä»¬çš„å­—æ®µæ„æˆå¦‚ä¸‹ï¼š\n\n\nR å‹æŒ‡ä»¤ä¸€èˆ¬ç”¨äºç®—æœ¯ã€é€»è¾‘è¿ç®—\nI å‹æŒ‡ä»¤ä¸€èˆ¬ç”¨äºåŠ è½½æ“ä½œã€æ¶‰åŠç«‹å³æ•°çš„ç®—æœ¯é€»è¾‘è¿ç®—ã€jalræŒ‡ä»¤\n\nå› ä¸ºå¯„å­˜å™¨çš„å¤§å°ä¸ºÂ 64Â ä½ï¼Œä¹Ÿå°±æ˜¯è¯´å¯¹äºç§»ä½æ“ä½œÂ slliï¼Œsrliå’Œsraiï¼Œå®ƒä»¬æœ€å¤šåªèƒ½ç§»ä½Â 64Â ä½ï¼Œå› æ­¤ç§»ä½æ“ä½œä¸­immediateå­—æ®µåªæœ‰å 6 ä½èƒ½å®é™…è¢«ç”¨æ¥å­˜å‚¨ç§»ä½çš„æ­¥æ•°ï¼Œå‰Â 6Â ä½ç”¨æ¥å­˜å‚¨é¢å¤–çš„opcodeå­—æ®µï¼ˆfunct6ï¼‰\nå…³äºÂ jalrÂ æŒ‡ä»¤ï¼Œå¦‚æœè·³è½¬åœ°å€ï¼ˆç«‹å³æ•°ï¼‰è¿‡å¤§ï¼Œè¶…è¿‡äº†Â 20Â ä½ï¼Œé‚£ä¹ˆå¯ä»¥å…ˆç”¨Â luiÂ æŒ‡ä»¤å°†é«˜Â 20Â ä½æ•°å­—æ”¾å…¥ä¸´æ—¶å¯„å­˜å™¨ä¸­ï¼Œç„¶åå†ç”¨Â jalrÂ æŒ‡ä»¤è·³è½¬åˆ°åœ°å€å‰©ä½™çš„ä½ä½æ•°å­—(ä¸´æ—¶å¯„å­˜å™¨)ä¸Š\n\n\nS å‹æŒ‡ä»¤ä¸€èˆ¬ç”¨äºå­˜å‚¨æ“ä½œ\nU å‹æŒ‡ä»¤ä¸€èˆ¬ç”¨äºä¸é«˜ä½ç«‹å³æ•°ç›¸å…³çš„æ“ä½œ\n\nåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œç«‹å³æ•°ä¸ä¼šå¾ˆå¤§ï¼ˆï¼‰ï¼Œèƒ½å¤Ÿç›´æ¥å­˜åœ¨æŒ‡ä»¤ä¸­ï¼›ä½†å¦‚æœè¶…è¿‡Â 12Â ä½ï¼ŒRISC-VÂ ä¼šç”¨Â luiÂ (load upper immediate)Â æŒ‡ä»¤æ¥å¤„ç†è¿™ç±»è¾ƒå¤§çš„ç«‹å³æ•°ã€‚\nå®ƒå¯ä»¥åŠ è½½ç«‹å³æ•°çš„é«˜Â 20Â ä½ï¼Œå°†å…¶æ”¾å…¥å¯„å­˜å™¨ä¸­é—´çš„ç¬¬Â 12Â ä½åˆ°ç¬¬Â 31Â ä½ï¼Œå¯„å­˜å™¨çš„ä½Â 12Â ä½ç”¨Â 0Â å¡«å……ï¼Œé«˜Â 32Â ä½ç”¨ç¬¬Â 31Â ä½ä¸Šçš„æ•°å­—å¡«å……ã€‚\nä¾‹å¦‚ï¼Œè¦å°†Â 32Â ä½ç«‹å³æ•°èµ‹ç»™å¯„å­˜å™¨ï¼Œå¯ä»¥å…ˆç”¨luiæŒ‡ä»¤å°†é«˜Â 20Â ä½èµ‹ç»™å¯„å­˜å™¨ï¼Œä¹‹åç”¨addiÂ æŒ‡ä»¤å°†å‰©ä½™çš„Â 12Â ä½åŠ åˆ°å¯„å­˜å™¨ä¸­ã€‚\n\n\nSB å‹æŒ‡ä»¤ä¸€èˆ¬ç”¨äºæ¡ä»¶åˆ†æ”¯è¯­å¥\n\nå¯è¡¨ç¤ºçš„åœ°å€èŒƒå›´ä¸ºÂ -4096-4094ï¼Œä¸”éƒ½æ˜¯Â 2Â çš„å€æ•°ï¼ˆå› ä¸ºç«‹å³æ•°ç¬¬ä¸€ä½æ’ä¸ºÂ 0ï¼‰\n\n\nUJ å‹æŒ‡ä»¤ä¸€èˆ¬ç”¨äºæ— æ¡ä»¶åˆ†æ”¯è¯­å¥ï¼ˆjalï¼‰\n\nrdç”¨äºå­˜æ”¾é“¾æ¥åœ°å€ï¼ˆå³è¿”å›åœ°å€ï¼‰\n\n\n\n\n\nå¦å¤–ï¼Œä¸ºä»€ä¹ˆÂ SBÂ å’ŒÂ UJÂ ä¸å­˜ç«‹å³æ•°ï¼ˆä¹Ÿå°±æ˜¯åç§»ï¼‰çš„æœ€ä½ä½å‘¢ï¼Ÿï¼ˆå…³æ³¨è¡¨æ ¼ï¼Œå¯ä»¥å‘ç°åªåŒ…æ‹¬Â i[12:1]Â æˆ–è€…Â i[20:1]ï¼Œç¼ºå¤±Â i[0]ï¼‰å› ä¸ºï¼Œåç§»çš„æœ€åä¸€ä½ä¸€å®šæ˜¯ 0ï¼Œå³åœ°å€ä¸€å®šæ˜¯ 2 å­—èŠ‚å¯¹é½çš„ï¼Œå› æ­¤æ²¡æœ‰å¿…è¦ä¿å­˜ã€‚\n\n\næ•°ç»„å’ŒæŒ‡é’ˆ\näº‹å®ä¸Šï¼Œç”¨æŒ‡é’ˆè®¿é—®æ•°ç»„å…ƒç´ æ¯”ç”¨ç´¢å¼•è®¿é—®æ•°ç»„å…ƒç´ æ›´å¿«ä¸€äº›ã€‚å®ƒä»¬åˆ†åˆ«å…·æœ‰å¦‚ä¸‹ç‰¹ç‚¹ï¼š\n\næ•°ç»„ç´¢å¼•\n\néœ€è¦æ ¹æ®æ•°ç»„åŸºåœ°å€ã€å½“å‰ç´¢å¼•å’Œå…ƒç´ å¤§å°è®¡ç®—å‡ºæ•°ç»„å…ƒç´ çš„åœ°å€ï¼Œè€Œä¸”æ¯è¶Ÿå¾ªç¯éƒ½éœ€è¦æ›´æ–°å’Œé‡æ–°è®¡ç®—ï¼Œæœ‰äº›éº»çƒ¦\nè™½ç„¶ä»ç†è®ºä¸Šæ¥è¯´æ•ˆç‡ä¸é«˜ï¼Œä½†å®é™…ä¸Šç¼–è¯‘å™¨å·²ç»ä¸ºæˆ‘ä»¬åšäº†ä¸€å®šçš„ä¼˜åŒ–ï¼Œæ¯”å¦‚ç”¨ç§»ä½è¿ç®—æ›¿ä»£ä¹˜æ³•è¿ç®—ï¼Œé¿å…åœ¨å¾ªç¯å†…è¿›è¡Œæ•°ç»„åœ°å€è®¡ç®—ç­‰\n\n\næŒ‡é’ˆ\n\nå®ƒç›´æ¥æŒ‡å‘å†…å­˜åœ°å€ï¼ˆå¯ä»¥çœ‹åˆ°ï¼Œåœ¨å¾ªç¯å¼€å§‹å‰å°±å·²ç»ç®—å¥½äº†ï¼‰ï¼Œæ— éœ€å¤šä½™çš„è®¡ç®—æ­¥éª¤\n\n\n\nä¾‹å­\nRISC-V æ±‡ç¼–è¯­è¨€æ¥ç¿»è¯‘ä¸€ä¸ªç”¨Â CÂ è¯­è¨€å†™çš„å†’æ³¡æ’åºå‡½æ•°\nCÂ è¯­è¨€ç¿»è¯‘æˆæ±‡ç¼–è¯­è¨€æ­¥éª¤\n\nä¸ºç¨‹åºçš„æ¯ä¸ªå˜é‡åˆ†é…ç›¸åº”çš„å¯„å­˜å™¨\nä¸ºè¿‡ç¨‹çš„ä¸»ä½“éƒ¨åˆ†ä¹¦å†™ä»£ç \nåœ¨è¿‡ç¨‹è°ƒç”¨æœŸé—´ä¿ç•™è¦ç”¨çš„å¯„å­˜å™¨\n\nswapå‡½æ•°\nvoid swap(long long int v[], size_t k) {\n    long long int temp;\n    temp = v[k];\n    v[k] = v[k+1];\n    v[k+1] = temp;\n}\nswap:\n    slli x6, x11, 3      // reg x6 = k * 8 -ã€‹å˜æˆbyteå­—èŠ‚åœ°å€\n    add  x6, x10, x6     // reg x6 = v + (k * 8)\n    ld   x5, 0(x6)       // reg x5 (temp) = v[k]\n    ld   x7, 8(x6)       // reg x7 = v[k + 1]\n    sd   x7, 0(x6)       // v[k] = reg x7\n    sd   x5, 8(x6)       // v[k+1] = reg x5 (tmp)\n    jalr x0, 0(x1)       // return to calling routine\nsortå‡½æ•°\nvoid sort(long long int v[], size_t int n) {\n    size_t i, j;\n    for (i = 0; i &lt; n; i++) {\n        for (j = i - 1; j &gt;= 0 &amp;&amp; v[j] &gt; v[j + 1]; j--) {\n            swap(v, j);\n        }\n    }\n}\n// Saving registers\nsort:\n    addi sp, sp, -40      // make room on stack for 5 registers\n    sd   x1, 32(sp)       // save return address on stack\n    sd   x22, 24(sp)      // save x22 on stack\n    sd   x21, 16(sp)      // save x21 on stack\n    sd   x20, 8(sp)       // save x20 on stack\n    sd   x19, 0(sp)       // save x19 on stack\n \n// Procedure body\n// Move parameters\n    mv   x21, x10         // copy parameter x10 into x21\n    mv   x22, x11         // copy parameter x11 into x22\n \n// Outer loop\n    li   x19, 0           // i = 0\nfor1tst: \n    bge  x19, x22, exit1  // go to exit1 if i &gt;= n\n \n// Inner loop\n    addi x20, x19, -1     // j = i - 1\nfor2tst:\n    blt  x20, x0, exit2   // go to exit2 if j &lt; 0\n    slli x5, x20, 3       // x5 = j * 8\n    add  x5, x21, x5      // x5 = v + (j * 8)\n    ld   x6, 0(x5)        // x6 = v[j]\n    ld   x7, 8(x5)        // x7 = v[j + 1]\n    ble  x6, x7, exit2    // go to exit2 if x6 &lt; x7\n \n// Pass parameters and call\n    mv   x10, x21         // first swap parameter is v\n    mv   x11, x20         // second swap parameter is j\n    jal  x1, swap         // call swap\n \n// Inner loop\n    addi x20, x20, -1     // j for2tst\n    j for2tst             // go to for2tst\n \n// Outer loop\nexit2: \n    addi x19, x19, 1      // i++\n    j for1tst             // go to for1tst\n \n// Restoring registers\nexit1:\n    ld   x19, 0(sp)       // restore x19 from stack\n    ld   x20, 8(sp)       // restore x20 from stack\n    ld   x21, 16(sp)      // restore x21 from stack\n    ld   x22, 24(sp)      // restore x22 from stack\n    ld   x1, 32(sp)       // restore return address from stack\n    addi sp, sp, 40       // restore stack pointer\n \n// Procedure return\n    jalr x0, 0(x1)        // return to calling routine\næŒ‡ä»¤é›†æ¶æ„\nè°¬è¯¯\n\næ›´å¤šå¼ºå¤§çš„æŒ‡ä»¤ä¼šå¸¦æ¥æ›´é«˜çš„æ€§èƒ½\n\nè™½ç„¶æ›´å¼ºå¤§çš„æŒ‡ä»¤æ„å‘³ç€æ‰§è¡Œç›¸åŒåŠŸèƒ½æ‰€éœ€æŒ‡ä»¤æ•°æ›´å°‘ï¼Œä½†åŒæ—¶ä¹Ÿæ„å‘³ç€è¿™äº›æŒ‡ä»¤ä¼šæ›´åŠ å¤æ‚ï¼Œéš¾ä»¥å®ç°ï¼Œè¿™æ ·åè€Œå½±å“æ‰€æœ‰æŒ‡ä»¤çš„æ•ˆç‡\n\n\nç›´æ¥ç”¨æ±‡ç¼–è¯­è¨€ç¼–å†™çš„ç¨‹åºæ€§èƒ½æ›´é«˜\n\nåœ¨ç°ä»£çš„å¤„ç†å™¨ä¸­ï¼Œç¼–è¯‘å™¨å¯èƒ½æ¯”äººè„‘æ›´æ“…é•¿å°†é«˜çº§è¯­è¨€ä»£ç è½¬æ¢ä¸ºæ€§èƒ½æ›´ä¼˜çš„æ±‡ç¼–è¯­è¨€ä»£ç \nè€Œä¸”ï¼Œå¯¹äºäººç±»æ¥è¯´ï¼Œå› ä¸ºæ±‡ç¼–ä»£ç é‡è¾ƒå¤§ï¼Œæ‰€ä»¥ä¼šå¸¦æ¥æ›´å¤šçŠ¯é”™çš„æœºä¼šï¼Œä¸”ç¼–å†™æ•ˆç‡å®åœ¨ä¸é«˜\n\n\næŒ‡ä»¤é›†çš„å‘åå…¼å®¹æ„å‘³ç€æ— éœ€æ”¹å˜ç°æœ‰çš„æŒ‡ä»¤é›†\n\nä»¥Â x86Â ä¸ºä¾‹ï¼Œè™½ç„¶å®ƒåšåˆ°äº†å‘åå…¼å®¹ï¼Œä½†å®ƒçš„æŒ‡ä»¤æ•°è¿˜æ˜¯å‘ˆä¸Šå‡è¶‹åŠ¿\n\n\nç”¨å­—èŠ‚è¡¨ç¤ºåœ°å€çš„æœºå™¨å†…ï¼Œè¿ç»­çš„å­—åœ°å€çš„é—´è·ä¸æ˜¯Â 1 è€Œæ˜¯ 4ï¼ˆå­—èŠ‚ï¼‰\n\nä¸€ä¸ªåœ°å€åªèƒ½æ”¾ä¸€ä¸ªå­—èŠ‚\nåŒå­—åœ°å€é—´è·å°±æ˜¯8å­—èŠ‚\n\n\nä½¿ç”¨æŒ‡å‘åœ¨å®šä¹‰è¿‡ç¨‹å¤–çš„è‡ªåŠ¨å˜é‡çš„æŒ‡é’ˆ\n\nå…¸å‹ä¾‹å­ï¼šæŸä¸ªè¿‡ç¨‹è¿”å›ä¸€ä¸ªæŒ‡å‘å±€éƒ¨æ•°ç»„çš„æŒ‡é’ˆï¼Œä½†è¿™ä¸ªè¿‡ç¨‹åœ¨è¿”å›åå°±æ²¡äº†ï¼ŒåŒ…æ‹¬è¿™ä¸ªå±€éƒ¨æ•°ç»„ï¼Œå› æ­¤è¿™ä¸ªæŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªæ²¡æœ‰ä»»ä½•æ„ä¹‰çš„åœ°æ–¹ï¼Œå¦‚æœåŠ¨ç”¨è¿™ä¸ªæŒ‡é’ˆï¼Œå¾ˆå¯èƒ½ä¼šè®©æ•´ä¸ªç¨‹åºå´©æºƒ\n\n\n\næŒ‡ä»¤é›†æ¶æ„ instruction set architecture flashcard\nç›®å‰ä¸–ç•Œä¸Šä¸»æµçš„ ISA ä¸»è¦åˆ†ä¸ºä¸¤å¤§ç±»ï¼š\n\nCISC (å¤æ‚æŒ‡ä»¤é›†)ï¼šä¸€æ¡æŒ‡ä»¤å¯ä»¥å®Œæˆå¾ˆå¤æ‚çš„æ“ä½œã€‚\n\nx86 ç”µè„‘ã€ç¬”è®°æœ¬ã€æœåŠ¡å™¨\n\n\nRISC (ç²¾ç®€æŒ‡ä»¤é›†)ï¼šæŒ‡ä»¤éƒ½å¾ˆç®€å•ã€ç»Ÿä¸€ï¼Œé€šè¿‡ç»„åˆç®€å•æŒ‡ä»¤æ¥å®Œæˆå¤æ‚ä»»åŠ¡ã€‚\n\nRISC-V\nARM  æ‰‹æœº å¹³æ¿ åµŒå…¥å¼è®¾å¤‡ è‹¹æœç”µè„‘\nMIPS\nå½“ä¸‹è®¡ç®—æœºå»ºç«‹åœ¨ä¸¤ä¸ªå…³é”®åŸåˆ™ï¼ˆå³å­˜å‚¨ç¨‹åºæ¦‚å¿µï¼ŒStored-Program Conceptï¼‰ï¼š\n\n\næŒ‡ä»¤ç”¨æ•°å­—æ¥è¡¨ç¤º\nç¨‹åºå°±åƒæ•°å­—ä¸€æ ·å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œå¯ç”¨æ¥è¢«è¯»å–æˆ–å†™å…¥\n\n\nMIPS\n\n32Â ä½æŒ‡ä»¤\n32Â ä¸ªé€šç”¨å¯„å­˜å™¨ï¼Œå…¶ä¸­ä¸€ä¸ªå¯„å­˜å™¨çš„å€¼å§‹ç»ˆä¸ºÂ 0\nåªèƒ½é€šè¿‡åŠ è½½å’Œå­˜å‚¨æŒ‡ä»¤æ¥è®¿é—®å†…å­˜æ•°æ®\næ²¡æœ‰èƒ½å¤Ÿæ‰¹é‡åŠ è½½Â /Â å­˜å‚¨å¤šä¸ªå¯„å­˜å™¨çš„æŒ‡ä»¤\nå¯»å€æ¨¡å¼é€‚ç”¨äºå„ç§å¤§å°çš„æ•°æ®\n\nRISC-VÂ å’ŒÂ MIPSÂ çš„ä¸åŒä¹‹å¤„æœ‰ï¼š\n\næ¡ä»¶åˆ†æ”¯ï¼ˆé™¤äº†ç›¸ç­‰å’Œä¸ç­‰ï¼‰ï¼š\n\nRISC-VÂ ä»…ä»…æ¯”è¾ƒä¸¤ä¸ªå¯„å­˜å™¨çš„å¤§å°ï¼Œè€ŒÂ MIPS è¿˜ä¼šç”¨ä¸€ä¸ªå¯„å­˜å™¨å­˜å‚¨æ¯”è¾ƒç»“æœï¼ˆ1Â æˆ–Â 0ï¼Œå¯¹åº”çœŸå€¼ï¼‰\nMIPSÂ åªæœ‰â€œå°äºâ€åˆ†æ”¯æŒ‡ä»¤ï¼Œè¯¥æŒ‡ä»¤æœ‰ç¬¦å·æ•°ï¼ˆsltï¼‰å’Œæ— ç¬¦å·æ•°ï¼ˆsltuï¼‰ç‰ˆæœ¬\n\n\n\næŒ‡ä»¤æ ¼å¼çš„åŒºåˆ«\n\nx86\n8086Â æŒ‡ä»¤é›†ä»…æ”¯æŒå­—èŠ‚ï¼ˆ8Â ä½ï¼‰å’Œå­—ï¼ˆ16Â ä½ï¼Œæ³¨æ„Â RISC-VÂ çš„å­—æ˜¯Â 32Â ä½ï¼‰ç±»å‹çš„æ•°æ®ï¼Œè€ŒÂ 80386Â å¢åŠ äº†Â 32Â ä½åœ°å€å’Œæ•°æ®ï¼ˆåŒå­—ï¼Œæ³¨æ„Â RISC-VÂ çš„åŒå­—æ˜¯Â 64Â ä½ï¼‰ã€‚\nx86Â æŒ‡ä»¤ä¸Â RISC-VÂ çš„ä¸åŒä¹‹å¤„åœ¨äºï¼š\n\nx86Â æŒ‡ä»¤çš„ç®—æœ¯å’Œé€»è¾‘æŒ‡ä»¤ä¸­ï¼Œæœ‰ä¸€ä¸ªæ“ä½œæ•°åŒæ—¶å……å½“æºå’Œç›®æ ‡ï¼›è€ŒÂ RISC-Vï¼ˆä»¥åŠÂ MIPSï¼‰ä¼šå°†æºå¯„å­˜å™¨å’Œç›®æ ‡å¯„å­˜å™¨åŒºåˆ†å¼€æ¥\nx86Â æŒ‡ä»¤çš„å…¶ä¸­ä¸€ä¸ªæ“ä½œæ•°å¯ä»¥æ˜¯å†…å­˜ï¼Œä¸‹é¢çš„è¡¨æ ¼å±•ç¤ºäº†Â x86Â ä¸­æ‰€æœ‰å¯èƒ½çš„æ“ä½œæ•°æ­é…\n\nå¯„å­˜å™¨\n80386Â æŒ‡ä»¤é›†æœ‰Â 14Â ä¸ªå¯„å­˜å™¨ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n\nå¯»å€æ¨¡å¼\n80386 çš„å¯»å€æ¨¡å¼å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n\næŒ‡ä»¤æ ¼å¼\nä¸‹å›¾ä¸ºå…¸å‹ x86 æŒ‡ä»¤æ ¼å¼- æ¯æ¡æŒ‡ä»¤çš„å¼€å¤´ï¼ˆå·¦ä¾§ï¼‰æŒ‡æ˜äº†æŒ‡ä»¤è¦åšçš„æ“ä½œ\n\næœ‰äº›æŒ‡ä»¤å­˜åœ¨ä¸€ä¸ªÂ PostbyteÂ å­—æ®µï¼Œå®ƒç”¨æ¥æŒ‡æ˜å¯»å€æ¨¡å¼\nx86Â çš„æ•´æ•°æŒ‡ä»¤æœ‰ä»¥ä¸‹å‡ ç±»ï¼š\næ•°æ®ä¼ é€æŒ‡ä»¤\nç®—æœ¯å’Œé€»è¾‘æŒ‡ä»¤\næ§åˆ¶æµ\nå­—ç¬¦ä¸²æŒ‡ä»¤\nåˆ†åˆ«å¯¹åº”çš„å¸¸è§æŒ‡ä»¤æœ‰ï¼š\n\n\nTranslating and starting a program\nä¸€ä¸ªÂ CÂ è¯­è¨€çš„ç¨‹åºï¼ˆæºä»£ç ï¼‰è½¬åŒ–ä¸ºå­˜å‚¨åœ¨å†…å­˜ä¸­çš„ä¸€ä¸ªæ–‡ä»¶çš„è¿‡ç¨‹\n\n\nç¼–è¯‘å™¨Â (Compiler)ï¼šé«˜çº§ç¼–ç¨‹è¯­è¨€Â â†’Â æ±‡ç¼–è¯­è¨€\n\næœ‰çš„ç¼–è¯‘å™¨å…¼å…·æ±‡ç¼–å™¨çš„åŠŸèƒ½\n\n\næ±‡ç¼–å™¨Â (Assembler)ï¼š\n\nä¼ªæŒ‡ä»¤Â â†’Â æŒ‡ä»¤\n\nä¼ªæŒ‡ä»¤(Pseudo Instruction)ï¼šå¯ä»¥ç†è§£ä¸ºæ±‡ç¼–æŒ‡ä»¤çš„æ‰©å±•ï¼ˆæˆ–è€…ç¼©å†™ï¼‰ï¼Œå½¢å¼ä¸Šçœ‹ä¼¼æŒ‡ä»¤ï¼Œè€Œå®é™…ä¸Šå¹¶ä¸å­˜åœ¨è¿™ç§æŒ‡ä»¤ï¼Œä½†æ±‡ç¼–å™¨ä¼šå°†å…¶è‡ªåŠ¨è½¬åŒ–ä¸ºå®é™…å­˜åœ¨çš„æŒ‡ä»¤\n\n\nå¯æ¥å—å„ç§è¿›åˆ¶çš„æ•°\nç”¨ç¬¦å·è¡¨(symbol table)Â å­˜å‚¨æ ‡ç­¾åç§°å’Œå†…å­˜åœ°å€çš„å¯¹åº”å…³ç³»ï¼Œä¾¿äºå°†æ ‡ç­¾è½¬åŒ–ä¸ºå®é™…çš„åœ°å€\nåŸºæœ¬çš„åŠŸèƒ½ï¼šæ±‡ç¼–è¯­è¨€Â â†’Â æœºå™¨ç ï¼Œå³æ±‡ç¼–ç¨‹åºÂ â†’Â ç›®æ ‡æ–‡ä»¶(Object File)ã€‚åœ¨Â UNIXÂ ç³»ç»Ÿä¸­ï¼Œç›®æ ‡æ–‡ä»¶åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š\n\nç›®æ ‡æ–‡ä»¶å¤´Â (Object File Header)ï¼šæè¿°ç›®æ ‡æ–‡ä»¶ä¸­å…¶ä»–åŒºåŸŸçš„å¤§å°å’Œä½ç½®\næ–‡æœ¬æ®µÂ (Text Segment)ï¼šåŒ…å«æœºå™¨ç \né™æ€æ•°æ®æ®µÂ (Static Data Segment)ï¼šåŒ…å«ç¨‹åºç”Ÿå‘½å‘¨æœŸä¸­åˆ†é…çš„æ•°æ®ï¼ˆåœ¨Â UNIXÂ ä¸­è¿™ä¸ªåŒºåŸŸåŒæ—¶å­˜æ”¾é™æ€å’ŒåŠ¨æ€æ•°æ®ï¼‰\né‡å®šä½ä¿¡æ¯ (Relocation Information)ï¼šæ ¹æ®ç¨‹åºè¢«åŠ è½½è‡³å†…å­˜çš„ç»å¯¹åœ°å€æ¥åŒºåˆ†æŒ‡ä»¤å’Œæ•°æ®\nç¬¦å·è¡¨Â (Symbol Table)\nè°ƒè¯•ä¿¡æ¯Â (Debugging Information)ï¼šç®€è¦æè¿°æ¨¡å—çš„ç¼–è¯‘æƒ…å†µï¼Œä½¿è°ƒè¯•å™¨èƒ½å¤Ÿå°†æœºå™¨æŒ‡ä»¤å’ŒÂ CÂ æºæ–‡ä»¶å…³è”èµ·æ¥ï¼Œä¸”èƒ½å¤Ÿè¯»å–å…¶ä¸­çš„æ•°æ®ç»“æ„\n\n\n\n\né“¾æ¥å™¨Â (Linker)\n\nå¯¹äºå¤šæ–‡ä»¶çš„ç¼–è¯‘ï¼Œé‡‡å–çš„åšæ³•æ˜¯å…ˆç¼–è¯‘ã€æ±‡ç¼–å•ä¸ªçš„æ–‡ä»¶ï¼Œç„¶åå°†è¿™äº›æœºå™¨è¯­è¨€ç¨‹åºé“¾æ¥èµ·æ¥ï¼Œè¿™æ ·å¯ä»¥å°½å¯èƒ½å‡å°‘é‡ç¼–è¯‘å’Œé‡æ±‡ç¼–çš„æƒ…å†µ\nå·¥ä½œæµç¨‹ï¼š\n\nå°†ä»£ç å’Œæ•°æ®æ¨¡å—ä»¥ç¬¦å·åŒ–çš„å½¢å¼å­˜åœ¨å†…å­˜ä¸­\nå¼„æ¸…æ•°æ®å’ŒæŒ‡ä»¤æ ‡å¿—å¯¹åº”çš„åœ°å€\nè¡¥å……å¥½å†…éƒ¨å’Œå¤–éƒ¨çš„å¼•ç”¨\n\n\nç»é“¾æ¥å™¨åŠ å·¥åï¼Œæœ€ç»ˆç”Ÿæˆä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶Â (Executable File)ï¼Œå®ƒä¸ç›®æ ‡æ–‡ä»¶çš„åŒºåˆ«åœ¨äºåè€…å­˜åœ¨ä¸ç¡®å®šÂ (Unresolved)Â çš„å¼•ç”¨\n\n\nåŠ è½½å™¨Â (Loader)ï¼šå°†å¯æ‰§è¡Œæ–‡ä»¶æ”¾å…¥å†…å­˜æˆ–ç£ç›˜ä¸­ï¼Œå·¥ä½œæµç¨‹ä¸ºï¼š\n\nè¯»å–å¯æ‰§è¡Œæ–‡ä»¶å¤´ï¼Œå¾—åˆ°æ–‡æœ¬æ®µå’Œæ•°æ®æ®µçš„å¤§å°\nåˆ›å»ºä¸€ä¸ªæŒ‡å‘è¶³å¤Ÿå®¹çº³æ–‡æœ¬å’Œæ•°æ®çš„ç©ºé—´çš„åœ°å€\nå°†å¯æ‰§è¡Œæ–‡ä»¶çš„æŒ‡ä»¤å’Œæ•°æ®æ‹·è´åˆ°å†…å­˜ä¸­\nå°†ä¸»ç¨‹åºçš„å‚æ•°ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰æ”¾å…¥æ ˆä¸­\nå¯¹å¯„å­˜å™¨è¿›è¡Œåˆå§‹åŒ–æ“ä½œï¼Œå¹¶å°†æ ˆæŒ‡é’ˆæŒ‡å‘ç¬¬ä¸€ä¸ªç©ºé—²çš„ä½ç½®ä¸Š\nè·³è½¬åˆ°å¯åŠ¨ä¾‹ç¨‹ï¼Œå°†å‚æ•°æ‹·è´åˆ°å‚æ•°å¯„å­˜å™¨ä¸­ï¼Œå¹¶è°ƒç”¨ç¨‹åºçš„ä¸»ä¾‹ç¨‹ã€‚è®©ä¸»ä¾‹ç¨‹è¿”å›æ—¶ï¼Œå¯åŠ¨ä¾‹ç¨‹ä¸­æ­¢æ•´ä¸ªç¨‹åºï¼Œé™„å¸¦exitç³»ç»Ÿè°ƒç”¨\n\n\n\nDynamic Linking\nå‰é¢ä»‹ç»çš„é“¾æ¥æ–¹æ³•å±äºé™æ€é“¾æ¥ï¼Œè™½ç„¶å®ƒèƒ½å¿«é€Ÿè°ƒç”¨åº“å‡½æ•°ï¼Œä½†å®ƒå…·æœ‰ä»¥ä¸‹ç¼ºé™·ï¼šä¸èƒ½åŠæ—¶æ›´æ–°åº“å‡½æ•°ï¼Œä¼šä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰åº“å‡½æ•°ï¼ˆå³ä½¿å¾ˆå¤šåº“å‡½æ•°æ²¡è¢«ç”¨åˆ°ï¼‰ã€‚å› æ­¤æˆ‘ä»¬æ›´å¤šåœ°ä¼šç”¨åˆ°åŠ¨æ€é“¾æ¥åº“(Dynamically Linked Libraries, DLL)Â æ¥å…‹æœè¿™äº›ç¼ºé™·â€”â€”è¿™ç§åº“å¯ä»¥åœ¨ç¨‹åºè¿è¡Œæ—¶è¢«é“¾æ¥åˆ°ç¨‹åºé‡Œã€‚\nåŠ¨æ€é“¾æ¥åº“æœ‰å¦‚ä¸‹ç‰¹å¾ï¼š\n\néœ€è¦å¯é‡å®šä½çš„è¿‡ç¨‹ä»£ç \nèƒ½å¤Ÿé¿å…ç”±é™æ€é“¾æ¥è·å–æ‰€æœ‰åº“å‡½æ•°å¸¦æ¥çš„å ç”¨å­˜å‚¨ç©ºé—´è¿‡å¤§çš„é—®é¢˜\nèƒ½å¤Ÿè‡ªåŠ¨è·å–æœ€æ–°ç‰ˆæœ¬çš„åº“\n\nLazy Linkage\nåœ¨åŸå§‹ç‰ˆæœ¬çš„Â DLLÂ ä¸­ï¼Œç¨‹åºå’Œåº“éƒ½éœ€è¦ä¿ç•™é¢å¤–çš„ä¿¡æ¯ï¼Œç”¨äºå®šä½éå±€éƒ¨çš„è¿‡ç¨‹ï¼›åŠ è½½å™¨ä¼šè¿è¡Œä¸€ä¸ªåŠ¨æ€çš„é“¾æ¥å™¨ï¼Œä½¿ç”¨è¿™äº›é¢å¤–çš„ä¿¡æ¯æ‰¾åˆ°åˆé€‚çš„åº“å¹¶æ›´æ–°æ‰€æœ‰çš„å¤–éƒ¨å¼•ç”¨ã€‚è¿™ç§Â DLLÂ çš„ç¼ºç‚¹æ˜¯å®ƒä»ç„¶ä¼šä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰åº“å‡½æ•°ã€‚ä¸€ç§æ”¹è¿›æ–¹æ³•æ˜¯ä½¿ç”¨æ‡’è¿‡ç¨‹é“¾æ¥(Lazy Procedure Linkage)Â ç‰ˆæœ¬çš„Â DLLï¼Œå®ƒèƒ½ä¿è¯åªæœ‰å½“ç¨‹åºè°ƒç”¨åº“å‡½æ•°æ—¶ï¼Œå¯¹åº”çš„åº“æ‰ä¼šè¢«é“¾æ¥åˆ°ç¨‹åºé‡Œã€‚ä¸‹å›¾å±•ç¤ºäº†è¿™ç§ç‰ˆæœ¬çš„Â DLLï¼š\n\næ•°æ®ç±»å‹\ngo\n\nc\n\næ— è®ºæ˜¯ 32 ä½è¿˜æ˜¯ 64 ä½ç³»ç»Ÿï¼Œlong long ç±»å‹çš„å¤§å°éƒ½æ˜¯ 8 å­—èŠ‚\nlong åœ¨ 32 ä½ç³»ç»Ÿä¸Šæ˜¯ 4 å­—èŠ‚ï¼Œåœ¨ 64 ä½ç³»ç»Ÿä¸Šæ˜¯ 8 å­—èŠ‚\n"},"è¯¾ç¨‹ç¬”è®°/è®¡ç®—æœºç»„æˆ/06-IO":{"slug":"è¯¾ç¨‹ç¬”è®°/è®¡ç®—æœºç»„æˆ/06-IO","filePath":"è¯¾ç¨‹ç¬”è®°/è®¡ç®—æœºç»„æˆ/06 IO.md","title":"06 IO","links":[],"tags":[],"content":"ç¡¬ç›˜å­˜å‚¨ä¸æ€§èƒ½è®¡ç®—\nRAIDæŠ€æœ¯å¯¹æ¯”(å†—ä½™ç£ç›˜é˜µåˆ—)\n\nä¸‰ç§IOé€šä¿¡æ–¹å¼\n\nè½®è¯¢Polling cpuå‚ä¸åº¦æé«˜\nä¸­æ–­ cpuå‚ä¸åº¦ä¸­ç­‰,è®¾å¤‡å¥½äº†ä¼šé€šçŸ¥cpu ä½†æ˜¯åˆé¢‘ç¹ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€\nDMA cpuå‚ä¸åº¦æä½,ä»…åœ¨å¼€å§‹å’Œç»“æŸçš„æ—¶å€™ä»‹å…¥,æ•°æ®ç›´æ¥åœ¨IOä¸å†…å­˜é—´ä¼ è¾“.é€‚ç”¨äºç¡¬ç›˜\\ç½‘å¡ç­‰å¤§æ•°æ®é‡è®¾å¤‡\n\nDMA\nç›´æ¥å†…å­˜è®¿é—®,è®¾å¤‡æ§åˆ¶å™¨ç›´æ¥å‘/ä»å†…å­˜ä¼ è¾“æ•°æ®ï¼Œä¸éœ€è¦å¤„ç†å™¨çš„ä»‹å…¥\n\né¦–å…ˆå¤„ç†å™¨é€šè¿‡æä¾›ä¸€äº›ä¿¡æ¯æ¥è®¾ç½®Â DMAÂ æ¨¡å¼ï¼Œå…·ä½“åŒ…æ‹¬ï¼šè®¾å¤‡Â IDã€æ“ä½œã€å¾…ä¼ è¾“æ•°æ®çš„å†…å­˜æºåœ°å€å’Œç›®æ ‡åœ°å€ã€éœ€è¦ä¼ è¾“çš„å­—èŠ‚æ•°ç­‰\nDMAÂ å¼€å§‹æ‰§è¡Œæ“ä½œï¼Œå¹¶å¯¹æ€»çº¿è¿›è¡Œä»²è£ã€‚è‹¥æŸä¸ªè¯·æ±‚éœ€è¦åœ¨æ€»çº¿ä¸Šå¤šæ¬¡ä¼ è¾“æ•°æ®ï¼Œé‚£ä¹ˆÂ DMAÂ å•å…ƒç”Ÿæˆä¸‹ä¸€ä¸ªå†…å­˜çš„åœ°å€ï¼Œå¹¶å‘èµ·ä¸‹ä¸€æ¬¡ä¼ è¾“\nä¸€æ—¦Â DMAÂ ä¼ è¾“å®Œæˆï¼Œæ§åˆ¶å™¨å‘å¤„ç†å™¨å‘èµ·ä¸­æ–­ï¼Œéšåæ£€æŸ¥æ˜¯å¦å‘ç”Ÿé”™è¯¯\n\nI/O Performance Measures"},"è¯¾ç¨‹ç¬”è®°/è®¡ç®—æœºç»„æˆ/åˆ’é‡ç‚¹":{"slug":"è¯¾ç¨‹ç¬”è®°/è®¡ç®—æœºç»„æˆ/åˆ’é‡ç‚¹","filePath":"è¯¾ç¨‹ç¬”è®°/è®¡ç®—æœºç»„æˆ/åˆ’é‡ç‚¹.md","title":"åˆ’é‡ç‚¹","links":[],"tags":[],"content":"16ä¸æ€ä¹ˆè€ƒ\n2.4.5.è€ƒå¾—å¤š\nç¬¬ä¸€ç« æœ«å°¾è®¡ç®—é¢˜ç›¸å¯¹æ€§èƒ½\nç¬¬äºŒç«  è¡¨ä¼šç»™å‡ºæ¥çš„ ä½†æ˜¯è½¬æ¢ä¸€å®šä¼šè€ƒçš„ cè¯­è¨€ æ±‡ç¼– äºŒè¿›åˆ¶è½¬æ¢\nç¬¬ä¸‰ç«  æµ®ç‚¹æ•°è®¡ç®—"},"è¯¾ç¨‹ç¬”è®°/è®¡ç®—æœºç½‘ç»œ/01-Introduction":{"slug":"è¯¾ç¨‹ç¬”è®°/è®¡ç®—æœºç½‘ç»œ/01-Introduction","filePath":"è¯¾ç¨‹ç¬”è®°/è®¡ç®—æœºç½‘ç»œ/01 Introduction.md","title":"01 Introduction","links":[],"tags":[],"content":"TCP/IP ç½‘ç»œæ¨¡å‹\n**å‘é€æ–¹ï¼ˆä¸åœåœ°ç©¿è¡£/å¥—å¨ƒï¼‰\n\nChrome (åº”ç”¨å±‚) äº§ç”Ÿæ•°æ®ï¼ˆæ¯”å¦‚ â€œGET /index.htmlâ€ï¼‰ã€‚å®ƒåªç®¡å†…å®¹ï¼Œä¸çŸ¥é“æ€ä¹ˆå‘ã€‚æŠŠæ•°æ®ç›´æ¥ä¸¢ç»™ä¸‹ä¸€å±‚ ã€‚\n\næ­¤æ—¶æ‰‹é‡Œæ‹¿çš„æ˜¯ï¼šData (æ•°æ®)\n\n\næ“ä½œç³»ç»Ÿ (TCPå±‚) æ”¶åˆ° Dataã€‚å®ƒä¸ç®¡æ•°æ®æ˜¯ç½‘é¡µè¿˜æ˜¯é‚®ä»¶ï¼Œå®ƒåªè´Ÿè´£**â€œç«¯å£åˆ°ç«¯å£â€ã€‚ç»™æ•°æ®åŠ ä¸€ä¸ª TCP å¤´ï¼ˆè´´ä¸Šæºç«¯å£ã€ç›®çš„ç«¯å£ï¼‰\n\næ­¤æ—¶æ‰‹é‡Œæ‹¿çš„æ˜¯ï¼šSegment (æ®µ) ã€‚\n\n\næ“ä½œç³»ç»Ÿ (IPå±‚) æ”¶åˆ° Segmentã€‚å®ƒä¸ç®¡é‡Œé¢æ˜¯ TCP è¿˜æ˜¯ UDPï¼Œå®ƒåªè´Ÿè´£â€œä¸»æœºåˆ°ä¸»æœºâ€ã€‚ç»™ Segment åŠ ä¸€ä¸ª IP å¤´**ï¼ˆè´´ä¸ŠæºIPã€ç›®çš„IPï¼‰ã€‚\n\næ­¤æ—¶æ‰‹é‡Œæ‹¿çš„æ˜¯ï¼šPacket (åŒ…) ã€‚\n\n\nç½‘å¡ (é“¾è·¯å±‚) æ”¶åˆ° Packetã€‚å®ƒä¸ç®¡ä½ è¦å‘åˆ°ç¾å›½è¿˜æ˜¯åŒ—äº¬ï¼Œå®ƒåªè´Ÿè´£**â€œå‘ç»™ç½‘çº¿é‚£å¤´çš„ä¸‹ä¸€ç«™â€ã€‚ç»™ Packet åŠ ä¸€ä¸ª MAC å¤´ï¼ˆæºMACã€ç›®çš„MACï¼‰å†åŠ ä¸€ä¸ª FCS å°¾ï¼ˆç”¨äºä»¥åæ£€æŸ¥æ•°æ®åæ²¡åï¼‰\n\næ­¤æ—¶æ‰‹é‡Œæ‹¿çš„æ˜¯ï¼šFrame (å¸§)\n\n\n\næ¥æ”¶æ–¹ï¼ˆä¸åœåœ°å‰¥çš®ï¼‰ï¼š\n\nç½‘å¡æ”¶åˆ° Frameï¼Œæ£€æŸ¥å¸§å°¾ FCSã€‚æ²¡é—®é¢˜ï¼ŸæŠŠå¤´å’Œå°¾æ‰”æ‰ï¼Œå–å‡ºä¸­é—´çš„ Packet ç»™ IP å±‚ã€‚\næ“ä½œç³»ç»Ÿ(IPå±‚) æ”¶åˆ° Packetï¼Œæ£€æŸ¥ IP åœ°å€ã€‚æ˜¯ç»™æˆ‘çš„ï¼ŸæŠŠ IP å¤´æ‰”æ‰ï¼Œå–å‡ºä¸­é—´çš„ Segment ç»™ TCP å±‚ã€‚\næ“ä½œç³»ç»Ÿ(TCPå±‚) æ”¶åˆ° Segmentï¼Œæ£€æŸ¥ç«¯å£ã€‚æ˜¯ç»™ Chrome çš„ï¼ŸæŠŠ TCP å¤´æ‰”æ‰ï¼ŒæŠŠçº¯æ•°æ®ç»™ Chromeã€‚\n\né‡ç‚¹ï¼š æ¯ä¸€å±‚åªçœ‹è‡ªå·±çš„å¤´ï¼Œæ ¹æœ¬ä¸çœ‹ï¼ˆä¹Ÿä¸æ‡‚ï¼‰ é‡Œé¢åŒ…ç€ä»€ä¹ˆã€‚é“¾è·¯å±‚çœ‹åˆ° IP å¤´æ—¶ï¼Œå®ƒåªè§‰å¾—é‚£æ˜¯â€œæ•°æ®â€çš„ä¸€éƒ¨åˆ†ã€‚\n\næ ¸å¿ƒæ¦‚å¿µ: å°è£…ä¸è§£å°è£….\n\n\nåº”ç”¨å±‚æ•°æ®è¢« TCP è£…è¿›ç®±å­ï¼ˆSegment)\n\n\nTCP ç®±å­è¢« IP è£…è¿›é›†è£…ç®±ï¼ˆPacketï¼‰\n\n\nIP é›†è£…ç®±è¢«ç½‘å¡è£…è¿›è´§è½¦ï¼ˆFrameï¼‰\n\n\næ¯ä¸€å±‚åªè¯»è‡ªå·±é‚£ä¸€å±‚çš„â€œå¿«é€’å•â€ï¼ˆ Headerï¼‰æ ¹æœ¬ä¸çœ‹é‡Œé¢çš„å†…å®¹\n\n\n\n\n\nåº”ç”¨å±‚\n\nmessageæŠ¥æ–‡. æ ¸å¿ƒä»»åŠ¡æ˜¯å…·ä½“çš„ä¸šåŠ¡é€»è¾‘.\nä¸“æ³¨äºä¸ºç”¨æˆ·æä¾›åº”ç”¨åŠŸèƒ½ï¼Œæ¯”å¦‚ HTTPã€FTPã€Telnetã€DNSã€SMTPç­‰\nå½“ä¸¤ä¸ªä¸åŒè®¾å¤‡çš„åº”ç”¨éœ€è¦é€šä¿¡çš„æ—¶å€™ï¼Œåº”ç”¨å°±æŠŠåº”ç”¨æ•°æ®ä¼ ç»™ä¸‹ä¸€å±‚\nåº”ç”¨å±‚æ˜¯å·¥ä½œåœ¨æ“ä½œç³»ç»Ÿä¸­çš„ç”¨æˆ·æ€ï¼Œä¼ è¾“å±‚åŠä»¥ä¸‹åˆ™å·¥ä½œåœ¨å†…æ ¸æ€\n\n\n\nä¼ è¾“å±‚\n\nå…³å¿ƒsegment æ®µ.è¿›ç¨‹åˆ°è¿›ç¨‹(ç«¯å£),æ¯”å¦‚chromeåˆ°å¯¹æ–¹æœåŠ¡å™¨çš„nginx\nåªæœ‰è¿™ä¸€å±‚åœ¨çœŸæ­£è´Ÿè´£æ•°æ®ä¸ä¸¢ä¸ä¹±.ipåªç®¡å‘,ä¸¢äº†ä¸ç®¡,å¦‚æœipæŠŠåŒ…å¼„ä¸¢äº† tcpè´Ÿè´£é‡ä¼ .\n\n\n\nç½‘ç»œå±‚\n\nå…³å¿ƒpacket,åŒ…/åˆ†ç»„.ç«¯åˆ°ç«¯(å®é™…çš„è®¾å¤‡é—´ä¼ è¾“çš„åŠŸèƒ½)\næ ¸å¿ƒä»»åŠ¡æ˜¯è·¯ç”±å’Œå¯»å€(ipåœ°å€).ipåè®®è´Ÿè´£æŠŠæ•°æ®åŒ…ä»ä¸€ä¸ªç½‘æ®µè·³åˆ°å¦ä¸€ä¸ªç½‘æ®µ\nipåœ°å€è®¡ç®—\\è·¯ç”±ç®—æ³•\\ipåè®®\nipåœ°å€: ç½‘ç»œå·æ ‡è¯†å­ç½‘.ä¸»æœºå·è´Ÿè´£æ ‡è¯†åŒä¸€ä¸ªå­ç½‘ä¸‹çš„ä¸åŒä¸»æœº\nipåœ°å€å’Œå­ç½‘æ©ç è¿›è¡ŒæŒ‰ä½ä¸å°±å¯ä»¥å¾—åˆ°ç½‘ç»œå·.\n\n\n\næ•°æ®é“¾è·¯å±‚(äº¤æ¢æœºé€šè¿‡è‡ªå­¦ä¹ çŸ¥é“å“ªä¸ªmacåœ°å€åœ¨å“ªä¸ªå£)\n\nå…³å¿ƒframe å¸§ã€‚ç›¸é‚»èŠ‚ç‚¹ä¹‹é—´ï¼ˆäº¤æ¢æœºæ‹¿åˆ°frame,ä¼šæ ¹æ®macå¤´è¿›è¡Œè½¬å‘.)(ç½‘å¡åªè®¤è¯†macåœ°å€)(è·¯ç”±å™¨æ”¶åˆ°frame,å°±æ‹†å¼€ç»™ç½‘ç»œå±‚çœ‹ipç¡®è®¤,ç„¶åé‡æ–°ç»„è£…ä¸€ä¸ªframeåŠ ä¸Šæ–°çš„macåœ°å€,ç»™äºŒå±‚å»å‘é€)\næ ¸å¿ƒä»»åŠ¡æ˜¯åœ¨ç›´æ¥ç›¸è¿çš„ä¸¤ä¸ªè®¾å¤‡ä¹‹é—´ï¼Œä¿è¯æ•°æ®å¯ä»¥é€è¿‡å»ï¼Œåˆ«æ’è½¦ã€‚\nè¿™é‡Œçš„çº é”™å°±æ˜¯è´Ÿè´£è¿™æ®µè·¯ä¸Šä¸å‡ºé”™ï¼ˆCRCæ ¡éªŒã€æµ·æ˜ç ä¹‹ç±»çš„ï¼‰\né˜²æ’è½¦ï¼š CSMA\\CDæ£€æµ‹\n\n\næ•°æ®é“¾è·¯å±‚çš„äº¤æ¢æœºæä¸å®šï¼ˆå› ä¸ºå®ƒåªè®¤è¯†å±€åŸŸç½‘å†…çš„ MACï¼‰å®ƒåªèƒ½æŠŠåŒ…äº¤ç»™ç½‘ç»œå±‚çš„è·¯ç”±å™¨(å¤„ç†ä¸åŒå­ç½‘)\n\n\n\n\n\n\næ³¨æ„è·¯ç”±å™¨é‡Œé¢ä¹Ÿæ˜¯ä¼šç»å†ï¼šç‰©ç†å±‚ -&gt; é“¾è·¯å±‚ -&gt; ç½‘ç»œå±‚ (å¤„ç†/å†³ç­–) -&gt; é“¾è·¯å±‚ -&gt; ç‰©ç†å±‚è¿™ä¹ˆä¸€ä¸ªè¿‡ç¨‹. äº¤æ¢æœºæ˜¯å¤„ç†åˆ°é“¾è·¯å±‚,ä¸åˆ°è¾¾ç½‘ç»œå±‚\n\n\nç‰©ç†å±‚\n\nåªå…³å¿ƒbitã€‚\næ ¸å¿ƒä»»åŠ¡æ˜¯æ€ä¹ˆæŠŠ01å˜æˆç”µä¿¡å·å‘é€å‡ºå»ã€‚çœ¼é‡Œæ²¡æœ‰åŒ…ï¼Œåªæœ‰ç”µæµ\n\n\n\né”®å…¥ç½‘å€åˆ°ç½‘é¡µæ˜¾ç¤ºï¼ŒæœŸé—´å‘ç”Ÿäº†ä»€ä¹ˆ\nåº”ç”¨å±‚ HTTP\n\n\n\nURLè§£æ\næ‰€ä»¥å›¾ä¸­çš„é•¿é•¿çš„ URL å®é™…ä¸Šæ˜¯è¯·æ±‚æœåŠ¡å™¨é‡Œçš„æ–‡ä»¶èµ„æºã€‚\nå½“æ²¡æœ‰è·¯å¾„åçš„æ—¶å€™,å°±è®¿é—®æ ¹ç›®å½•ä¸‹äº‹å…ˆè®¾ç½®çš„é»˜è®¤æ–‡ä»¶.\nå¯¹Â URLÂ è¿›è¡Œè§£æä¹‹åï¼Œæµè§ˆå™¨ç¡®å®šäº† Web æœåŠ¡å™¨å’Œæ–‡ä»¶åï¼Œæ¥ä¸‹æ¥å°±æ˜¯æ ¹æ®è¿™äº›ä¿¡æ¯æ¥ç”Ÿæˆ HTTP è¯·æ±‚æ¶ˆæ¯äº†ã€‚\nç”ŸæˆHTTPè¯·æ±‚ä¿¡æ¯\n\n\nçœŸå®åœ°å€æŸ¥è¯¢â€”DNS\n\n\né€šè¿‡æµè§ˆå™¨è§£æURLå¹¶ç”ŸæˆHTTPæ¶ˆæ¯å,éœ€è¦å§”æ‰˜æ“ä½œç³»ç»Ÿå°†æ¶ˆæ¯å‘é€ç»™WebæœåŠ¡å™¨.åœ¨è¿™ä¹‹å‰,éœ€è¦æŸ¥è¯¢æœåŠ¡å™¨åŸŸåå¯¹åº”çš„IPåœ°å€.\n\n\nDNSæœåŠ¡å™¨å°±ä¸“é—¨ä¿å­˜äº†WebæœåŠ¡å™¨åŸŸåä¸IPçš„å¯¹åº”å…³ç³»\n\n\nDNS ä¸­çš„åŸŸåéƒ½æ˜¯ç”¨å¥ç‚¹æ¥åˆ†éš”çš„ï¼Œæ¯”å¦‚Â www.server.comï¼Œè¿™é‡Œçš„å¥ç‚¹ä»£è¡¨äº†ä¸åŒå±‚æ¬¡ä¹‹é—´çš„ç•Œé™ã€‚\n\n\nåœ¨åŸŸåä¸­ï¼Œè¶Šé å³çš„ä½ç½®è¡¨ç¤ºå…¶å±‚çº§è¶Šé«˜ã€‚\n\n\nå®é™…ä¸ŠåŸŸåæœ€åè¿˜æœ‰ä¸€ä¸ªç‚¹ï¼Œæ¯”å¦‚Â www.server.com.ï¼Œè¿™ä¸ªæœ€åçš„ä¸€ä¸ªç‚¹ä»£è¡¨æ ¹åŸŸåã€‚\n\n\nä¹Ÿå°±æ˜¯ï¼Œ.Â æ ¹åŸŸæ˜¯åœ¨æœ€é¡¶å±‚ï¼Œå®ƒçš„ä¸‹ä¸€å±‚å°±æ˜¯Â .comÂ é¡¶çº§åŸŸï¼Œå†ä¸‹é¢æ˜¯Â server.comã€‚\n\n\n\næ ¹åŸŸçš„ DNS æœåŠ¡å™¨ä¿¡æ¯ä¿å­˜åœ¨äº’è”ç½‘ä¸­æ‰€æœ‰çš„ DNS æœåŠ¡å™¨ä¸­ã€‚è¿™æ ·ä¸€æ¥ï¼Œä»»ä½• DNS æœåŠ¡å™¨å°±éƒ½å¯ä»¥æ‰¾åˆ°å¹¶è®¿é—®æ ¹åŸŸ DNS æœåŠ¡å™¨äº†ã€‚å› æ­¤ï¼Œå®¢æˆ·ç«¯åªè¦èƒ½å¤Ÿæ‰¾åˆ°ä»»æ„ä¸€å° DNS æœåŠ¡å™¨ï¼Œå°±å¯ä»¥é€šè¿‡å®ƒæ‰¾åˆ°æ ¹åŸŸ DNS æœåŠ¡å™¨ï¼Œç„¶åå†ä¸€è·¯é¡ºè—¤æ‘¸ç“œæ‰¾åˆ°ä½äºä¸‹å±‚çš„æŸå°ç›®æ ‡ DNS æœåŠ¡å™¨ã€‚\nåŸŸåè§£æçš„å·¥ä½œæµç¨‹\n\nå®¢æˆ·ç«¯é¦–å…ˆä¼šå‘å‡ºä¸€ä¸ª DNS è¯·æ±‚ï¼Œé—® www.server.com çš„ IP æ˜¯å•¥ï¼Œå¹¶å‘ç»™æœ¬åœ° DNS æœåŠ¡å™¨ï¼ˆä¹Ÿå°±æ˜¯å®¢æˆ·ç«¯çš„ TCP/IP è®¾ç½®ä¸­å¡«å†™çš„ DNS æœåŠ¡å™¨åœ°å€ï¼‰\næœ¬åœ°åŸŸåæœåŠ¡å™¨æ”¶åˆ°å®¢æˆ·ç«¯çš„è¯·æ±‚åï¼Œå¦‚æœç¼“å­˜é‡Œçš„è¡¨æ ¼èƒ½æ‰¾åˆ° www.server.comï¼Œåˆ™å®ƒç›´æ¥è¿”å› IP åœ°å€ã€‚å¦‚æœæ²¡æœ‰ï¼Œæœ¬åœ° DNS ä¼šå»é—®å®ƒçš„æ ¹åŸŸåæœåŠ¡å™¨ï¼šâ€œè€å¤§ï¼Œ èƒ½å‘Šè¯‰æˆ‘ www.server.com çš„ IP åœ°å€å—ï¼Ÿâ€ æ ¹åŸŸåæœåŠ¡å™¨æ˜¯æœ€é«˜å±‚æ¬¡çš„ï¼Œå®ƒä¸ç›´æ¥ç”¨äºåŸŸåè§£æï¼Œä½†èƒ½æŒ‡æ˜ä¸€æ¡é“è·¯ã€‚\næ ¹ DNS æ”¶åˆ°æ¥è‡ªæœ¬åœ° DNS çš„è¯·æ±‚åï¼Œå‘ç°åç½®æ˜¯ .comï¼Œè¯´ï¼šâ€œwww.server.com è¿™ä¸ªåŸŸåå½’ .com åŒºåŸŸç®¡ç†â€ï¼Œæˆ‘ç»™ä½  .com é¡¶çº§åŸŸåæœåŠ¡å™¨åœ°å€ç»™ä½ ï¼Œä½ å»é—®é—®å®ƒå§ã€‚â€\næœ¬åœ° DNS æ”¶åˆ°é¡¶çº§åŸŸåæœåŠ¡å™¨çš„åœ°å€åï¼Œå‘èµ·è¯·æ±‚é—®â€œè€äºŒï¼Œ ä½ èƒ½å‘Šè¯‰æˆ‘ www.server.com çš„ IP åœ°å€å—ï¼Ÿâ€\né¡¶çº§åŸŸåæœåŠ¡å™¨è¯´ï¼šâ€œæˆ‘ç»™ä½ è´Ÿè´£ www.server.com åŒºåŸŸçš„æƒå¨ DNS æœåŠ¡å™¨çš„åœ°å€ï¼Œä½ å»é—®å®ƒåº”è¯¥èƒ½é—®åˆ°â€ã€‚\næœ¬åœ° DNS äºæ˜¯è½¬å‘é—®æƒå¨ DNS æœåŠ¡å™¨ï¼šâ€œè€ä¸‰ï¼Œwww.server.comå¯¹åº”çš„IPæ˜¯å•¥å‘€ï¼Ÿâ€ server.com çš„æƒå¨ DNS æœåŠ¡å™¨ï¼Œå®ƒæ˜¯åŸŸåè§£æç»“æœçš„åŸå‡ºå¤„ã€‚ä¸ºå•¥å«æƒå¨å‘¢ï¼Ÿå°±æ˜¯æˆ‘çš„åŸŸåæˆ‘åšä¸»ã€‚\næƒå¨ DNS æœåŠ¡å™¨æŸ¥è¯¢åå°†å¯¹åº”çš„ IP åœ°å€ X.X.X.X å‘Šè¯‰æœ¬åœ° DNSã€‚\næœ¬åœ° DNS å†å°† IP åœ°å€è¿”å›å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯å’Œç›®æ ‡å»ºç«‹è¿æ¥ã€‚\n\n\næµè§ˆå™¨ä¼šå…ˆçœ‹è‡ªèº«æœ‰æ²¡æœ‰å¯¹è¿™ä¸ªåŸŸåçš„ç¼“å­˜ï¼Œå¦‚æœæœ‰ï¼Œå°±ç›´æ¥è¿”å›ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå°±å»é—®æ“ä½œç³»ç»Ÿï¼Œæ“ä½œç³»ç»Ÿä¹Ÿä¼šå»çœ‹è‡ªå·±çš„ç¼“å­˜ï¼Œå¦‚æœæœ‰ï¼Œå°±ç›´æ¥è¿”å›ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå†å» hosts æ–‡ä»¶çœ‹ï¼Œä¹Ÿæ²¡æœ‰ï¼Œæ‰ä¼šå»é—®ã€Œæœ¬åœ° DNS æœåŠ¡å™¨ã€\n\nåè®®æ ˆ\nè·å–åˆ°IPä¹‹å, å°†HTTPçš„ä¼ è¾“å·¥ä½œäº¤ç»™æ“ä½œç³»ç»Ÿä¸­çš„åè®®æ ˆ\n\nåº”ç”¨ç¨‹åºï¼ˆæµè§ˆå™¨ï¼‰é€šè¿‡è°ƒç”¨ Socket åº“ï¼Œæ¥å§”æ‰˜åè®®æ ˆå·¥ä½œã€‚\n\nåè®®æ ˆçš„ä¸ŠåŠéƒ¨åˆ†æœ‰ä¸¤å—ï¼Œåˆ†åˆ«æ˜¯è´Ÿè´£æ”¶å‘æ•°æ®çš„ TCP å’Œ UDP åè®®ï¼Œè¿™ä¸¤ä¸ªä¼ è¾“åè®®ä¼šæ¥å—åº”ç”¨å±‚çš„å§”æ‰˜æ‰§è¡Œæ”¶å‘æ•°æ®çš„æ“ä½œã€‚\nåè®®æ ˆçš„ä¸‹é¢ä¸€åŠæ˜¯ç”¨ IP åè®®æ§åˆ¶ç½‘ç»œåŒ…æ”¶å‘æ“ä½œï¼Œåœ¨äº’è”ç½‘ä¸Šä¼ æ•°æ®æ—¶ï¼Œæ•°æ®ä¼šè¢«åˆ‡åˆ†æˆä¸€å—å—çš„ç½‘ç»œåŒ…ï¼Œè€Œå°†ç½‘ç»œåŒ…å‘é€ç»™å¯¹æ–¹çš„æ“ä½œå°±æ˜¯ç”± IP è´Ÿè´£çš„ã€‚\n\nARPÂ ç”¨äºæ ¹æ® IP åœ°å€æŸ¥è¯¢ç›¸åº”çš„ä»¥å¤ªç½‘ MAC åœ°å€ã€‚è¦ä¹ˆæ˜¯[ ä»¥å¤ªç½‘å¤´ | IP å¤´ | TCP å¤´/udp/icmp| æ•°æ® ] è¦ä¹ˆæ˜¯[ ä»¥å¤ªç½‘å¤´ (Type=0806) | ARP å¤´ | æ•°æ® ] å°±æ˜¯è¯´arpå’Œipæ˜¯å¹³çº§çš„\n\n\n\n\nå› ä¸ºarpå°±æ˜¯å› ä¸ºåªçŸ¥é“ipä¸çŸ¥é“mac æ‰€ä»¥éœ€è¦é—®.æ‰€ä»¥ç»•è¿‡ipå±‚ä½œä¸ºä»¥å¤ªç½‘è´Ÿè½½å‘å‡ºå»,é—®æŸä¸ªipå¯¹åº”çš„mac\n\n\nIP ä¸‹é¢çš„ç½‘å¡é©±åŠ¨ç¨‹åºè´Ÿè´£æ§åˆ¶ç½‘å¡ç¡¬ä»¶ï¼Œè€Œæœ€ä¸‹é¢çš„ç½‘å¡åˆ™è´Ÿè´£å®Œæˆå®é™…çš„æ”¶å‘æ“ä½œï¼Œä¹Ÿå°±æ˜¯å¯¹ç½‘çº¿ä¸­çš„ä¿¡å·æ‰§è¡Œå‘é€å’Œæ¥æ”¶æ“ä½œã€‚å°±æ˜¯ä¸»è¦è´Ÿè´£æ•°æ®é“¾è·¯å±‚å’Œç‰©ç†å±‚\n\nå¯é ä¼ è¾“TCP\n\nTCPå»ºç«‹è¿æ¥:ä¸‰æ¬¡æ¡æ‰‹\næ‰€è°“çš„ã€Œè¿æ¥ã€ï¼Œåªæ˜¯åŒæ–¹è®¡ç®—æœºé‡Œç»´æŠ¤ä¸€ä¸ªçŠ¶æ€æœºï¼Œåœ¨è¿æ¥å»ºç«‹çš„è¿‡ç¨‹ä¸­ï¼ŒåŒæ–¹çš„çŠ¶æ€å˜åŒ–æ—¶åºå›¾å°±åƒè¿™æ ·ã€‚\n\nä¸€å¼€å§‹ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½å¤„äºÂ CLOSEDÂ çŠ¶æ€ã€‚å…ˆæ˜¯æœåŠ¡ç«¯ä¸»åŠ¨ç›‘å¬æŸä¸ªç«¯å£ï¼Œå¤„äºÂ LISTENÂ çŠ¶æ€ã€‚\nç„¶åå®¢æˆ·ç«¯ä¸»åŠ¨å‘èµ·è¿æ¥Â SYNï¼Œä¹‹åå¤„äºÂ SYN-SENTÂ çŠ¶æ€ã€‚\næœåŠ¡ç«¯æ”¶åˆ°å‘èµ·çš„è¿æ¥ï¼Œè¿”å›Â SYNï¼Œå¹¶ä¸”Â ACKÂ å®¢æˆ·ç«¯çš„Â SYNï¼Œä¹‹åå¤„äºÂ SYN-RCVDÂ çŠ¶æ€ã€‚\nå®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡ç«¯å‘é€çš„Â SYNÂ å’ŒÂ ACKÂ ä¹‹åï¼Œå‘é€å¯¹Â SYNÂ ç¡®è®¤çš„Â ACKï¼Œä¹‹åå¤„äºÂ ESTABLISHEDÂ çŠ¶æ€ï¼Œå› ä¸ºå®ƒä¸€å‘ä¸€æ”¶æˆåŠŸäº†ã€‚\næœåŠ¡ç«¯æ”¶åˆ°Â ACKÂ çš„Â ACKÂ ä¹‹åï¼Œå¤„äºÂ ESTABLISHEDÂ çŠ¶æ€ï¼Œå› ä¸ºå®ƒä¹Ÿä¸€å‘ä¸€æ”¶äº†ã€‚\næ‰€ä»¥ä¸‰æ¬¡æ¡æ‰‹ç›®çš„æ˜¯ä¿è¯åŒæ–¹éƒ½æœ‰å‘é€å’Œæ¥æ”¶çš„èƒ½åŠ›ã€‚\n\næŸ¥çœ‹TCPçš„è¿æ¥çŠ¶æ€ï¼Œåœ¨linuxå¯ä»¥ç”¨netstat -naptå‘½ä»¤æŸ¥çœ‹\nå¦‚æœ HTTP è¯·æ±‚æ¶ˆæ¯æ¯”è¾ƒé•¿ï¼Œè¶…è¿‡äº†Â MSSÂ çš„é•¿åº¦ï¼Œè¿™æ—¶ TCP å°±éœ€è¦æŠŠ HTTP çš„æ•°æ®æ‹†è§£æˆä¸€å—å—çš„æ•°æ®å‘é€ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§å‘é€æ‰€æœ‰æ•°æ®ã€‚\n\n\n\nMTUï¼šä¸€ä¸ªç½‘ç»œåŒ…çš„æœ€å¤§é•¿åº¦ï¼Œä»¥å¤ªç½‘ä¸­ä¸€èˆ¬ä¸ºÂ 1500Â å­—èŠ‚ã€‚\n\n\nMSSï¼šé™¤å» IP å’Œ TCP å¤´éƒ¨ä¹‹åï¼Œä¸€ä¸ªç½‘ç»œåŒ…æ‰€èƒ½å®¹çº³çš„ TCP æ•°æ®çš„æœ€å¤§é•¿åº¦ã€‚\n\n\nTCP åè®®é‡Œé¢ä¼šæœ‰ä¸¤ä¸ªç«¯å£ï¼Œä¸€ä¸ªæ˜¯æµè§ˆå™¨ç›‘å¬çš„ç«¯å£ï¼ˆé€šå¸¸æ˜¯éšæœºç”Ÿæˆçš„ï¼‰ï¼Œä¸€ä¸ªæ˜¯ Web æœåŠ¡å™¨ç›‘å¬çš„ç«¯å£ï¼ˆHTTP é»˜è®¤ç«¯å£å·æ˜¯Â 80ï¼Œ HTTPS é»˜è®¤ç«¯å£å·æ˜¯Â 443ï¼‰ã€‚\n\n\n\nç»è¿‡ç½‘ç»œå±‚å’Œä¼ è¾“å±‚ä¹‹åå°±æ˜¯è¿™ä¸ªæ ·å­äº†\nipå°†æ•°æ®å°è£…æˆç½‘ç»œåŒ…ï¼šç½‘ç»œå±‚\n\n\næºåœ°å€IPï¼Œå³æ˜¯å®¢æˆ·ç«¯è¾“å‡ºçš„ IP åœ°å€ï¼›\nç›®æ ‡åœ°å€ï¼Œå³é€šè¿‡ DNS åŸŸåè§£æå¾—åˆ°çš„ Web æœåŠ¡å™¨ IPã€‚\nå› ä¸º HTTP æ˜¯ç»è¿‡ TCP ä¼ è¾“çš„ï¼Œæ‰€ä»¥åœ¨ IP åŒ…å¤´çš„åè®®å·ï¼Œè¦å¡«å†™ä¸ºÂ 06ï¼ˆåå…­è¿›åˆ¶ï¼‰ï¼Œè¡¨ç¤ºåè®®ä¸º TCPã€‚è¿™æ ·æ‰çŸ¥é“æ‹†å¼€ä¹‹åçš„æ–‡ä»¶å±äºtcp\n\nTCP: [ IP å¤´ | TCP å¤´ | æ•°æ® ]\nUDP: [ IP å¤´ | UDP å¤´ | æ•°æ® ]\nICMP: [ IP å¤´ | ICMP å¤´ | æ•°æ® ]  ä½†æ˜¯å®é™…ä¸Š icmpå±äºç½‘ç»œå±‚,tcp/udpå±äºä¼ è¾“å±‚ icmpå°±æ˜¯æŠ¥é”™,æ˜¯ç”±ä¸­é—´çš„è·¯ç”±å™¨å‘å›ç»™æºä¸»æœºçš„,ä¸éœ€è¦ä»€ä¹ˆç«¯å£ä»€ä¹ˆçš„,ä½†æ˜¯å› ä¸ºæ˜¯è·¯ç”±å™¨å‘çš„,æ‰€ä»¥è¢«å°è£…è¿›ä¸€ä¸ªipåŒ….è€Œä¸”å‘icmpä¸€èˆ¬éƒ½æ˜¯tcpè¿æ¥æ–­æ‰äº†,é‚£å¦‚æœè¿˜ç”¨tcpå‘é‚£è‚¯å®šä¸è¡Œçš„.\nç½‘ç»œå±‚åè®®: icmp/ip/arp ä½†æ˜¯imcpä¸€èˆ¬æ˜¯åŒ…è£¹åœ¨ipå¤´é‡Œé¢çš„.arpå¤´åˆ™æ˜¯æ›¿ä»£ipå¤´\n\n\n\n\nå½“å­˜åœ¨å¤šä¸ªç½‘å¡çš„æ—¶å€™,å°±éœ€è¦åˆ¤æ–­åº”è¯¥å†™å“ªä¸ªä½œä¸ºæºipåœ°å€,å°±æ˜¯å†³å®šåº”è¯¥ç”¨å“ªä¸ªç½‘å¡æ¥å‘é€åŒ….è¿™æ—¶å€™å°±éœ€è¦æ ¹æ®è·¯ç”±è¡¨è§„åˆ™æ¥åˆ¤æ–­.\nåœ¨ Linux æ“ä½œç³»ç»Ÿï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Â route -nÂ å‘½ä»¤æŸ¥çœ‹å½“å‰ç³»ç»Ÿçš„è·¯ç”±è¡¨ã€‚\n\nç¬¬ä¸‰æ¡ç›®æ¯”è¾ƒç‰¹æ®Šï¼Œå®ƒç›®æ ‡åœ°å€å’Œå­ç½‘æ©ç éƒ½æ˜¯Â 0.0.0.0ï¼Œè¿™è¡¨ç¤ºé»˜è®¤ç½‘å…³ï¼Œå¦‚æœå…¶ä»–æ‰€æœ‰æ¡ç›®éƒ½æ— æ³•åŒ¹é…ï¼Œå°±ä¼šè‡ªåŠ¨åŒ¹é…è¿™ä¸€è¡Œã€‚å¹¶ä¸”åç»­å°±æŠŠåŒ…å‘ç»™è·¯ç”±å™¨ï¼ŒGatewayÂ å³æ˜¯è·¯ç”±å™¨çš„ IP åœ°å€ã€‚\n\n\nmac\nå®é™…ä¸Šæ˜¯ç”±æ“ä½œç³»ç»ŸCPUæ¥å¡«å†™çš„\n\nä¸€èˆ¬åœ¨ TCP/IP é€šä¿¡é‡Œï¼ŒMAC åŒ…å¤´çš„åè®®ç±»å‹åªä½¿ç”¨ï¼š\n\n0800Â ï¼š IP åè®®\n0806Â ï¼š ARP åè®®\n//è¿™å°±æ˜¯ç½‘ç»œå±‚åè®®\n\nå‘é€æ–¹çš„ MAC åœ°å€è·å–æ¯”è¾ƒç®€å•ï¼ŒMAC åœ°å€æ˜¯åœ¨ç½‘å¡ç”Ÿäº§æ—¶å†™å…¥åˆ° ROM é‡Œçš„ï¼Œåªè¦å°†è¿™ä¸ªå€¼è¯»å–å‡ºæ¥å†™å…¥åˆ° MAC å¤´éƒ¨å°±å¯ä»¥äº†ã€‚\næ¥æ”¶æ–¹çš„ MAC åœ°å€å°±æœ‰ç‚¹å¤æ‚äº†ï¼Œ\nå¾—å…ˆææ¸…æ¥šåº”è¯¥æŠŠåŒ…å‘ç»™è°ï¼Œéœ€è¦æŸ¥ä¸€ä¸‹è·¯ç”±è¡¨ã€‚\n\n\nå¦‚æœåœ¨ä¸€ä¸ªå±€åŸŸç½‘,é‚£ä¹ˆç›´æ¥å‘åˆ°ipå°±å¯ä»¥äº†\nå¦‚æœä¸åœ¨å°±ä¼šåŒ¹é…åˆ°æœ€åä¸€ä¸ªæ¡ç›® å‘é€åˆ°é»˜è®¤ç½‘å…³åšè½¬å‘.\n\nçŸ¥é“å‘é€ç»™è°ä¹‹å,è¦å¦‚ä½•è·å–å¯¹æ–¹çš„macåœ°å€å‘¢?æ­¤æ—¶å°±éœ€è¦Â ARPÂ åè®®å¸®æˆ‘ä»¬æ‰¾åˆ°è·¯ç”±å™¨çš„ MAC åœ°å€ã€‚\n\nARP åè®®ä¼šåœ¨ä»¥å¤ªç½‘ä¸­ä»¥å¹¿æ’­çš„å½¢å¼ï¼Œå¯¹ä»¥å¤ªç½‘æ‰€æœ‰çš„è®¾å¤‡å–Šå‡ºï¼šâ€œè¿™ä¸ª IP åœ°å€æ˜¯è°çš„ï¼Ÿè¯·æŠŠä½ çš„ MAC åœ°å€å‘Šè¯‰æˆ‘â€ã€‚\nç„¶åå°±ä¼šæœ‰äººå›ç­”ï¼šâ€œè¿™ä¸ª IP åœ°å€æ˜¯æˆ‘çš„ï¼Œæˆ‘çš„ MAC åœ°å€æ˜¯ XXXXâ€ã€‚\nå¦‚æœå¯¹æ–¹å’Œè‡ªå·±å¤„äºåŒä¸€ä¸ªå­ç½‘ä¸­ï¼Œé‚£ä¹ˆé€šè¿‡ä¸Šé¢çš„æ“ä½œå°±å¯ä»¥å¾—åˆ°å¯¹æ–¹çš„ MAC åœ°å€ã€‚ç„¶åï¼Œæˆ‘ä»¬å°†è¿™ä¸ª MAC åœ°å€å†™å…¥ MAC å¤´éƒ¨ï¼ŒMAC å¤´éƒ¨å°±å®Œæˆäº†ã€‚\nåœ¨åç»­æ“ä½œç³»ç»Ÿä¼šæŠŠæœ¬æ¬¡æŸ¥è¯¢ç»“æœæ”¾åˆ°ä¸€å—å«åšÂ ARP ç¼“å­˜çš„å†…å­˜ç©ºé—´ç•™ç€ä»¥åç”¨ï¼Œä¸è¿‡ç¼“å­˜çš„æ—¶é—´å°±å‡ åˆ†é’Ÿã€‚\nä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨å‘åŒ…æ—¶ï¼š\n\nå…ˆæŸ¥è¯¢ ARP ç¼“å­˜ï¼Œå¦‚æœå…¶ä¸­å·²ç»ä¿å­˜äº†å¯¹æ–¹çš„ MAC åœ°å€ï¼Œå°±ä¸éœ€è¦å‘é€ ARP æŸ¥è¯¢ï¼Œç›´æ¥ä½¿ç”¨ ARP ç¼“å­˜ä¸­çš„åœ°å€ã€‚\nè€Œå½“ ARP ç¼“å­˜ä¸­ä¸å­˜åœ¨å¯¹æ–¹ MAC åœ°å€æ—¶ï¼Œåˆ™å‘é€ ARP å¹¿æ’­æŸ¥è¯¢ã€‚\nåœ¨ Linux ç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Â arp -aÂ å‘½ä»¤æ¥æŸ¥çœ‹ ARP ç¼“å­˜çš„å†…å®¹ã€‚\n\næœ€ç»ˆç”Ÿæˆçš„æŠ¥æ–‡é•¿è¿™ä¸ªæ ·å­\n\nç½‘å¡\nç½‘ç»œåŒ…åªæ˜¯å­˜æ”¾åœ¨å†…å­˜ä¸­çš„ä¸€ä¸²äºŒè¿›åˆ¶æ•°å­—ä¿¡æ¯ï¼Œæ²¡æœ‰åŠæ³•ç›´æ¥å‘é€ç»™å¯¹æ–¹ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦å°†æ•°å­—ä¿¡æ¯è½¬æ¢ä¸ºç”µä¿¡å·ï¼Œæ‰èƒ½åœ¨ç½‘çº¿ä¸Šä¼ è¾“ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™æ‰æ˜¯çœŸæ­£çš„æ•°æ®å‘é€è¿‡ç¨‹ã€‚\nè´Ÿè´£æ‰§è¡Œè¿™ä¸€æ“ä½œçš„æ˜¯ç½‘å¡ï¼Œè¦æ§åˆ¶ç½‘å¡è¿˜éœ€è¦é ç½‘å¡é©±åŠ¨ç¨‹åºã€‚\nç½‘å¡é©±åŠ¨è·å–ç½‘ç»œåŒ…ä¹‹åï¼Œä¼šå°†å…¶å¤åˆ¶åˆ°ç½‘å¡å†…çš„ç¼“å­˜åŒºä¸­ï¼Œæ¥ç€ä¼šåœ¨å…¶å¼€å¤´åŠ ä¸ŠæŠ¥å¤´å’Œèµ·å§‹å¸§åˆ†ç•Œç¬¦ï¼Œåœ¨æœ«å°¾åŠ ä¸Šç”¨äºæ£€æµ‹é”™è¯¯çš„å¸§æ ¡éªŒåºåˆ—ã€‚\n\n\nèµ·å§‹å¸§åˆ†ç•Œç¬¦æ˜¯ä¸€ä¸ªç”¨æ¥è¡¨ç¤ºåŒ…èµ·å§‹ä½ç½®çš„æ ‡è®°\næœ«å°¾çš„Â FCSï¼ˆå¸§æ ¡éªŒåºåˆ—ï¼‰ç”¨æ¥æ£€æŸ¥åŒ…ä¼ è¾“è¿‡ç¨‹æ˜¯å¦æœ‰æŸå\n\næœ€åç½‘å¡ä¼šå°†åŒ…è½¬ä¸ºç”µä¿¡å·ï¼Œé€šè¿‡ç½‘çº¿å‘é€å‡ºå»ã€‚\näº¤æ¢æœº\näº¤æ¢æœºçš„è®¾è®¡æ˜¯å°†ç½‘ç»œåŒ…åŸæ ·è½¬å‘åˆ°ç›®çš„åœ°ã€‚äº¤æ¢æœºå·¥ä½œåœ¨ MAC å±‚ï¼Œä¹Ÿç§°ä¸ºäºŒå±‚ç½‘ç»œè®¾å¤‡ã€‚\nmacå±‚:ï¼ˆä»‹è´¨è®¿é—®æ§åˆ¶å±‚ï¼‰æ˜¯æ•°æ®é“¾è·¯å±‚çš„ä¸€ä¸ªâ€œå­å±‚â€ã€‚\nåŒ…æ¥æ”¶\né¦–å…ˆï¼Œç”µä¿¡å·åˆ°è¾¾ç½‘çº¿æ¥å£ï¼Œäº¤æ¢æœºé‡Œçš„æ¨¡å—è¿›è¡Œæ¥æ”¶ï¼Œæ¥ä¸‹æ¥äº¤æ¢æœºé‡Œçš„æ¨¡å—å°†ç”µä¿¡å·è½¬æ¢ä¸ºæ•°å­—ä¿¡å·ã€‚\nç„¶åé€šè¿‡åŒ…æœ«å°¾çš„Â FCSÂ æ ¡éªŒé”™è¯¯ï¼Œå¦‚æœæ²¡é—®é¢˜åˆ™æ”¾åˆ°ç¼“å†²åŒºã€‚è¿™éƒ¨åˆ†æ“ä½œåŸºæœ¬å’Œè®¡ç®—æœºçš„ç½‘å¡ç›¸åŒï¼Œä½†äº¤æ¢æœºçš„å·¥ä½œæ–¹å¼å’Œç½‘å¡ä¸åŒã€‚\nè®¡ç®—æœºçš„ç½‘å¡æœ¬èº«å…·æœ‰ MAC åœ°å€ï¼Œå¹¶é€šè¿‡æ ¸å¯¹æ”¶åˆ°çš„åŒ…çš„æ¥æ”¶æ–¹ MAC åœ°å€åˆ¤æ–­æ˜¯ä¸æ˜¯å‘ç»™è‡ªå·±çš„ï¼Œå¦‚æœä¸æ˜¯å‘ç»™è‡ªå·±çš„åˆ™ä¸¢å¼ƒï¼›ç›¸å¯¹åœ°ï¼Œäº¤æ¢æœºçš„ç«¯å£ä¸æ ¸å¯¹æ¥æ”¶æ–¹ MAC åœ°å€ï¼Œè€Œæ˜¯ç›´æ¥æ¥æ”¶æ‰€æœ‰çš„åŒ…å¹¶å­˜æ”¾åˆ°ç¼“å†²åŒºä¸­ã€‚å› æ­¤ï¼Œå’Œç½‘å¡ä¸åŒï¼Œäº¤æ¢æœºçš„ç«¯å£ä¸å…·æœ‰ MAC åœ°å€ã€‚\nå°†åŒ…å­˜å…¥ç¼“å†²åŒºåï¼Œæ¥ä¸‹æ¥éœ€è¦æŸ¥è¯¢ä¸€ä¸‹è¿™ä¸ªåŒ…çš„æ¥æ”¶æ–¹ MAC åœ°å€æ˜¯å¦å·²ç»åœ¨ MAC åœ°å€è¡¨ä¸­æœ‰è®°å½•äº†ã€‚\näº¤æ¢æœºçš„ MAC åœ°å€è¡¨ä¸»è¦åŒ…å«ä¸¤ä¸ªä¿¡æ¯ï¼š\n\nä¸€ä¸ªæ˜¯è®¾å¤‡çš„ MAC åœ°å€ï¼Œ\nå¦ä¸€ä¸ªæ˜¯è¯¥è®¾å¤‡è¿æ¥åœ¨äº¤æ¢æœºçš„å“ªä¸ªç«¯å£ä¸Šã€‚\n\nä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœæ”¶åˆ°çš„åŒ…çš„æ¥æ”¶æ–¹ MAC åœ°å€ä¸ºÂ 00-02-B3-1C-9C-F9ï¼Œåˆ™ä¸å›¾ä¸­è¡¨ä¸­çš„ç¬¬ 3 è¡ŒåŒ¹é…ï¼Œæ ¹æ®ç«¯å£åˆ—çš„ä¿¡æ¯ï¼Œå¯çŸ¥è¿™ä¸ªåœ°å€ä½äºÂ 3Â å·ç«¯å£ä¸Šï¼Œç„¶åå°±å¯ä»¥é€šè¿‡äº¤æ¢ç”µè·¯å°†åŒ…å‘é€åˆ°ç›¸åº”çš„ç«¯å£äº†ã€‚\næ‰€ä»¥ï¼Œäº¤æ¢æœºæ ¹æ® MAC åœ°å€è¡¨æŸ¥æ‰¾ MAC åœ°å€ï¼Œç„¶åå°†ä¿¡å·å‘é€åˆ°ç›¸åº”çš„ç«¯å£ã€‚\n\nå¦‚æœMACåœ°å€è¡¨æŸ¥æ‰¾ä¸åˆ°æŒ‡å®šçš„MACåœ°å€\nåªèƒ½å°†åŒ…è½¬å‘åˆ°é™¤äº†æºç«¯å£ä¹‹å¤–çš„æ‰€æœ‰ç«¯å£ä¸Šï¼Œæ— è®ºè¯¥è®¾å¤‡è¿æ¥åœ¨å“ªä¸ªç«¯å£ä¸Šéƒ½èƒ½æ”¶åˆ°è¿™ä¸ªåŒ…ã€‚\nè¿™æ ·åšä¸ä¼šäº§ç”Ÿä»€ä¹ˆé—®é¢˜ï¼Œå› ä¸ºä»¥å¤ªç½‘çš„è®¾è®¡æœ¬æ¥å°±æ˜¯å°†åŒ…å‘é€åˆ°æ•´ä¸ªç½‘ç»œçš„ï¼Œç„¶ååªæœ‰ç›¸åº”çš„æ¥æ”¶è€…æ‰æ¥æ”¶åŒ…ï¼Œè€Œå…¶ä»–è®¾å¤‡åˆ™ä¼šå¿½ç•¥è¿™ä¸ªåŒ…ã€‚\nå‘é€äº†åŒ…ä¹‹åç›®æ ‡è®¾å¤‡ä¼šä½œå‡ºå“åº”ï¼Œåªè¦è¿”å›äº†å“åº”åŒ…ï¼Œäº¤æ¢æœºå°±å¯ä»¥å°†å®ƒçš„åœ°å€å†™å…¥ MAC åœ°å€è¡¨ï¼Œä¸‹æ¬¡ä¹Ÿå°±ä¸éœ€è¦æŠŠåŒ…å‘åˆ°æ‰€æœ‰ç«¯å£äº†ã€‚\næ­¤å¤–ï¼Œå¦‚æœæ¥æ”¶æ–¹ MAC åœ°å€æ˜¯ä¸€ä¸ªå¹¿æ’­åœ°å€ï¼Œé‚£ä¹ˆäº¤æ¢æœºä¼šå°†åŒ…å‘é€åˆ°é™¤æºç«¯å£ä¹‹å¤–çš„æ‰€æœ‰ç«¯å£ã€‚\nä»¥ä¸‹ä¸¤ä¸ªå±äºå¹¿æ’­åœ°å€ï¼š\n\nMAC åœ°å€ä¸­çš„Â FF:FF:FF:FF:FF:FF\nIP åœ°å€ä¸­çš„Â 255.255.255.255\n\nè·¯ç”±å™¨\nç½‘ç»œåŒ…ç»è¿‡äº¤æ¢æœºä¹‹åï¼Œç°åœ¨åˆ°è¾¾äº†è·¯ç”±å™¨ï¼Œå¹¶åœ¨æ­¤è¢«è½¬å‘åˆ°ä¸‹ä¸€ä¸ªè·¯ç”±å™¨æˆ–ç›®æ ‡è®¾å¤‡ã€‚\nè¿™ä¸€æ­¥è½¬å‘çš„å·¥ä½œåŸç†å’Œäº¤æ¢æœºç±»ä¼¼ï¼Œä¹Ÿæ˜¯é€šè¿‡æŸ¥è¡¨åˆ¤æ–­åŒ…è½¬å‘çš„ç›®æ ‡ã€‚\nä¸è¿‡åœ¨å…·ä½“çš„æ“ä½œè¿‡ç¨‹ä¸Šï¼Œè·¯ç”±å™¨å’Œäº¤æ¢æœºæ˜¯æœ‰åŒºåˆ«çš„ã€‚\n\nå› ä¸ºè·¯ç”±å™¨æ˜¯åŸºäº IP è®¾è®¡çš„ï¼Œä¿—ç§°ä¸‰å±‚ç½‘ç»œè®¾å¤‡ï¼Œè·¯ç”±å™¨çš„å„ä¸ªç«¯å£éƒ½å…·æœ‰ MAC åœ°å€å’Œ IP åœ°å€ï¼›\nè€Œäº¤æ¢æœºæ˜¯åŸºäºä»¥å¤ªç½‘è®¾è®¡çš„ï¼Œä¿—ç§°äºŒå±‚ç½‘ç»œè®¾å¤‡ï¼Œäº¤æ¢æœºçš„ç«¯å£ä¸å…·æœ‰ MAC åœ°å€ã€‚\n\nåŸºæœ¬åŸç†\n\nè·¯ç”±å™¨çš„ç«¯å£å…·æœ‰ MAC åœ°å€ï¼Œå› æ­¤å®ƒå°±èƒ½å¤Ÿæˆä¸ºä»¥å¤ªç½‘çš„å‘é€æ–¹å’Œæ¥æ”¶æ–¹ï¼›åŒæ—¶è¿˜å…·æœ‰ IP åœ°å€ï¼Œä»è¿™ä¸ªæ„ä¹‰ä¸Šæ¥è¯´ï¼Œå®ƒå’Œè®¡ç®—æœºçš„ç½‘å¡æ˜¯ä¸€æ ·çš„ã€‚\nå½“è½¬å‘åŒ…æ—¶ï¼Œé¦–å…ˆè·¯ç”±å™¨ç«¯å£ä¼šæ¥æ”¶å‘ç»™è‡ªå·±çš„ä»¥å¤ªç½‘åŒ…ï¼Œç„¶åè·¯ç”±è¡¨æŸ¥è¯¢è½¬å‘ç›®æ ‡ï¼Œå†ç”±ç›¸åº”çš„ç«¯å£ä½œä¸ºå‘é€æ–¹å°†ä»¥å¤ªç½‘åŒ…å‘é€å‡ºå»ã€‚\n\nåŒ…æ¥æ”¶\n\né¦–å…ˆï¼Œç”µä¿¡å·åˆ°è¾¾ç½‘çº¿æ¥å£éƒ¨åˆ†ï¼Œè·¯ç”±å™¨ä¸­çš„æ¨¡å—ä¼šå°†ç”µä¿¡å·è½¬æˆæ•°å­—ä¿¡å·ï¼Œç„¶åé€šè¿‡åŒ…æœ«å°¾çš„Â FCSÂ è¿›è¡Œé”™è¯¯æ ¡éªŒã€‚\nå¦‚æœæ²¡é—®é¢˜åˆ™æ£€æŸ¥ MAC å¤´éƒ¨ä¸­çš„æ¥æ”¶æ–¹ MAC åœ°å€ï¼Œçœ‹çœ‹æ˜¯ä¸æ˜¯å‘ç»™è‡ªå·±çš„åŒ…ï¼Œå¦‚æœæ˜¯å°±æ”¾åˆ°æ¥æ”¶ç¼“å†²åŒºä¸­ï¼Œå¦åˆ™å°±ä¸¢å¼ƒè¿™ä¸ªåŒ…ã€‚\næ€»çš„æ¥è¯´ï¼Œè·¯ç”±å™¨çš„ç«¯å£éƒ½å…·æœ‰ MAC åœ°å€ï¼Œåªæ¥æ”¶ä¸è‡ªèº«åœ°å€åŒ¹é…çš„åŒ…ï¼Œé‡åˆ°ä¸åŒ¹é…çš„åŒ…åˆ™ç›´æ¥ä¸¢å¼ƒ\n\næŸ¥è·¯ç”±è¡¨\n\nå®ŒæˆåŒ…æ¥æ”¶æ“ä½œä¹‹åï¼Œè·¯ç”±å™¨å°±ä¼šå»æ‰åŒ…å¼€å¤´çš„ MAC å¤´éƒ¨ã€‚\nMAC å¤´éƒ¨çš„ä½œç”¨å°±æ˜¯å°†åŒ…é€è¾¾è·¯ç”±å™¨ï¼Œå…¶ä¸­çš„æ¥æ”¶æ–¹ MAC åœ°å€å°±æ˜¯è·¯ç”±å™¨ç«¯å£çš„ MAC åœ°å€ã€‚å› æ­¤ï¼Œå½“åŒ…åˆ°è¾¾è·¯ç”±å™¨ä¹‹åï¼ŒMAC å¤´éƒ¨çš„ä»»åŠ¡å°±å®Œæˆäº†ï¼Œäºæ˜¯ MAC å¤´éƒ¨å°±ä¼šè¢«ä¸¢å¼ƒã€‚\næ¥ä¸‹æ¥ï¼Œè·¯ç”±å™¨ä¼šæ ¹æ® MAC å¤´éƒ¨åæ–¹çš„Â IPÂ å¤´éƒ¨ä¸­çš„å†…å®¹è¿›è¡ŒåŒ…çš„è½¬å‘æ“ä½œã€‚\nè½¬å‘æ“ä½œåˆ†ä¸ºå‡ ä¸ªé˜¶æ®µ\n\n\né¦–å…ˆæ˜¯æŸ¥è¯¢è·¯ç”±è¡¨åˆ¤æ–­è½¬å‘ç›®æ ‡ã€‚\n\nè¿›å…¥åŒ…çš„å‘é€å·¥ä½œ\né¦–å…ˆéœ€è¦æ ¹æ®è·¯ç”±è¡¨çš„ç½‘å…³åˆ—åˆ¤æ–­å¯¹æ–¹çš„åœ°å€\næ ¹æ®è·¯ç”±è¡¨çš„ç½‘å…³åˆ—åˆ¤æ–­å¯¹æ–¹çš„åœ°å€\n\n\nå¦‚æœç½‘å…³æ˜¯ä¸€ä¸ª IP åœ°å€ï¼Œåˆ™è¿™ä¸ªIP åœ°å€å°±æ˜¯æˆ‘ä»¬è¦è½¬å‘åˆ°çš„ç›®æ ‡åœ°å€ï¼Œè¿˜æœªæŠµè¾¾ç»ˆç‚¹ï¼Œè¿˜éœ€ç»§ç»­éœ€è¦è·¯ç”±å™¨è½¬å‘ã€‚\nå¦‚æœç½‘å…³ä¸ºç©ºï¼Œåˆ™ IP å¤´éƒ¨ä¸­çš„æ¥æ”¶æ–¹ IP åœ°å€å°±æ˜¯è¦è½¬å‘åˆ°çš„ç›®æ ‡åœ°å€ï¼Œä¹Ÿæ˜¯å°±ç»ˆäºæ‰¾åˆ° IP åŒ…å¤´é‡Œçš„ç›®æ ‡åœ°å€äº†ï¼Œè¯´æ˜å·²æŠµè¾¾ç»ˆç‚¹ã€‚\n\nçŸ¥é“IPåœ°å€ä¹‹å,å°±éœ€è¦é€šè¿‡ARPåè®®æ ¹æ®IPåœ°å€æ¥æŸ¥è¯¢MACåœ°å€,å¹¶å°†æŸ¥è¯¢çš„ç»“æœä½œä¸ºæ¥æ”¶æ–¹çš„MACåœ°å€.\nè·¯ç”±å™¨ä¹Ÿæœ‰ARPç¼“å­˜,æ‰€ä»¥ä¼šå…ˆåœ¨ARPç¼“å­˜ä¸­æŸ¥è¯¢,å¦‚æœæ‰¾ä¸åˆ°åˆ™å‘é€ARPæŸ¥è¯¢è¯·æ±‚\n\nå‘é€æ–¹MACåœ°å€å°±å¡«å†™è¾“å‡ºç«¯å£çš„MACåœ°å€.è¿˜æœ‰ä¸€ä¸ªä»¥å¤ªç±»å‹å­—æ®µå¡«å†™IPåè®®\nç½‘ç»œåŒ…å®Œæˆä¹‹åå°±è½¬æ¢æˆç”µä¿¡å·é€šè¿‡ç«¯å£å‘é€å‡ºå»,ç„¶åé€šè¿‡äº¤æ¢æœºåˆ°è¾¾ä¸‹ä¸€ä¸ªè·¯ç”±å™¨,ç»è¿‡å±‚å±‚è·¯ç”±è½¬å‘,å°±å¯ä»¥åˆ°è¾¾æœ€ç»ˆçš„ç›®çš„åœ°.è¿™ä¹‹é—´,æºipåœ°å€å’Œç›®æ ‡ipåœ°å€æ˜¯ä¸ä¼šå‘ç”Ÿå˜åŒ–çš„,ä¸€ç›´å˜åŒ–çš„æ˜¯MACåœ°å€\n\næœåŠ¡å™¨\n\n\næ•°æ®åŒ…æŠµè¾¾æœåŠ¡å™¨åï¼ŒæœåŠ¡å™¨ä¼šå…ˆæ‰’å¼€æ•°æ®åŒ…çš„ MAC å¤´éƒ¨ï¼ŒæŸ¥çœ‹æ˜¯å¦å’ŒæœåŠ¡å™¨è‡ªå·±çš„ MAC åœ°å€ç¬¦åˆï¼Œç¬¦åˆå°±å°†åŒ…æ”¶èµ·æ¥ã€‚\næ¥ç€ç»§ç»­æ‰’å¼€æ•°æ®åŒ…çš„ IP å¤´ï¼Œå‘ç° IP åœ°å€ç¬¦åˆï¼Œæ ¹æ® IP å¤´ä¸­åè®®é¡¹ï¼ŒçŸ¥é“è‡ªå·±ä¸Šå±‚æ˜¯ TCP åè®®ã€‚\näºæ˜¯ï¼Œæ‰’å¼€ TCP çš„å¤´ï¼Œé‡Œé¢æœ‰åºåˆ—å·ï¼Œéœ€è¦çœ‹ä¸€çœ‹è¿™ä¸ªåºåˆ—åŒ…æ˜¯ä¸æ˜¯æˆ‘æƒ³è¦çš„ï¼Œå¦‚æœæ˜¯å°±æ”¾å…¥ç¼“å­˜ä¸­ç„¶åè¿”å›ä¸€ä¸ª ACKï¼Œå¦‚æœä¸æ˜¯å°±ä¸¢å¼ƒã€‚TCPå¤´éƒ¨é‡Œé¢è¿˜æœ‰ç«¯å£å·ï¼Œ HTTP çš„æœåŠ¡å™¨æ­£åœ¨ç›‘å¬è¿™ä¸ªç«¯å£å·ã€‚\näºæ˜¯ï¼ŒæœåŠ¡å™¨è‡ªç„¶å°±çŸ¥é“æ˜¯ HTTP è¿›ç¨‹æƒ³è¦è¿™ä¸ªåŒ…ï¼Œäºæ˜¯å°±å°†åŒ…å‘ç»™ HTTP è¿›ç¨‹ã€‚\næœåŠ¡å™¨çš„ HTTP è¿›ç¨‹çœ‹åˆ°ï¼ŒåŸæ¥è¿™ä¸ªè¯·æ±‚æ˜¯è¦è®¿é—®ä¸€ä¸ªé¡µé¢ï¼Œäºæ˜¯å°±æŠŠè¿™ä¸ªç½‘é¡µå°è£…åœ¨ HTTP å“åº”æŠ¥æ–‡é‡Œã€‚\nHTTP å“åº”æŠ¥æ–‡ä¹Ÿéœ€è¦ç©¿ä¸Š TCPã€IPã€MAC å¤´éƒ¨ï¼Œä¸è¿‡è¿™æ¬¡æ˜¯æºåœ°å€æ˜¯æœåŠ¡å™¨ IP åœ°å€ï¼Œç›®çš„åœ°å€æ˜¯å®¢æˆ·ç«¯ IP åœ°å€ã€‚\nç©¿å¥½å¤´éƒ¨è¡£æœåï¼Œä»ç½‘å¡å‡ºå»ï¼Œäº¤ç”±äº¤æ¢æœºè½¬å‘åˆ°å‡ºåŸçš„è·¯ç”±å™¨ï¼Œè·¯ç”±å™¨å°±æŠŠå“åº”æ•°æ®åŒ…å‘åˆ°äº†ä¸‹ä¸€ä¸ªè·¯ç”±å™¨ï¼Œå°±è¿™æ ·è·³å•Šè·³ã€‚\næœ€åè·³åˆ°äº†å®¢æˆ·ç«¯çš„åŸé—¨æŠŠå®ˆçš„è·¯ç”±å™¨ï¼Œè·¯ç”±å™¨æ‰’å¼€ IP å¤´éƒ¨å‘ç°æ˜¯è¦æ‰¾åŸå†…çš„äººï¼Œäºæ˜¯åˆæŠŠåŒ…å‘ç»™äº†åŸå†…çš„äº¤æ¢æœºï¼Œå†ç”±äº¤æ¢æœºè½¬å‘åˆ°å®¢æˆ·ç«¯ã€‚\nå®¢æˆ·ç«¯æ”¶åˆ°äº†æœåŠ¡å™¨çš„å“åº”æ•°æ®åŒ…åï¼ŒåŒæ ·ä¹Ÿéå¸¸çš„é«˜å…´ï¼Œå®¢æˆ·èƒ½æ‹†å¿«é€’äº†ï¼\näºæ˜¯ï¼Œå®¢æˆ·ç«¯å¼€å§‹æ‰’çš®ï¼ŒæŠŠæ”¶åˆ°çš„æ•°æ®åŒ…çš„çš®æ‰’å‰© HTTP å“åº”æŠ¥æ–‡åï¼Œäº¤ç»™æµè§ˆå™¨å»æ¸²æŸ“é¡µé¢ï¼Œä¸€ä»½ç‰¹åˆ«çš„æ•°æ®åŒ…å¿«é€’ï¼Œå°±è¿™æ ·æ˜¾ç¤ºå‡ºæ¥äº†ï¼\næœ€åï¼Œå®¢æˆ·ç«¯è¦ç¦»å¼€äº†ï¼Œå‘æœåŠ¡å™¨å‘èµ·äº† TCP å››æ¬¡æŒ¥æ‰‹ï¼Œè‡³æ­¤åŒæ–¹çš„è¿æ¥å°±æ–­å¼€äº†ã€‚\n"},"è¯¾ç¨‹ç¬”è®°/è®¡ç®—æœºç½‘ç»œ/02-ç‰©ç†å±‚-the-physical-layer":{"slug":"è¯¾ç¨‹ç¬”è®°/è®¡ç®—æœºç½‘ç»œ/02-ç‰©ç†å±‚-the-physical-layer","filePath":"è¯¾ç¨‹ç¬”è®°/è®¡ç®—æœºç½‘ç»œ/02 ç‰©ç†å±‚ the physical layer.md","title":"ç‰©ç†å±‚ the physical layer","links":["tags/flashcard"],"tags":["flashcard"],"content":"DECK: CS::CN\nç‰©ç†å±‚çš„ä¸»è¦ä»»åŠ¡\n\nç½‘ç»œä¸­ç¡¬ä»¶è®¾å¤‡å’Œä¼ è¾“ä»‹è´¨çš„ç§ç±»ç¹å¤šï¼Œé€šä¿¡æ–¹å¼ä¹Ÿå„ä¸ç›¸åŒã€‚ç‰©ç†å±‚åº”å°½å¯èƒ½å±è”½è¿™äº›å·®å¼‚ï¼Œè®©æ•°æ®é“¾è·¯å±‚æ„Ÿè§‰ä¸åˆ°è¿™äº›å·®å¼‚ã€‚\n\nå‘é€æ–¹çš„æ•°æ®é“¾è·¯å±‚å°†éœ€è¦å‘é€çš„å¸§äº¤ç»™ç‰©ç†å±‚\nä¼ è¾“åæ¥æ”¶æ–¹çš„ç‰©ç†å±‚å°†è¿™äº›å¸§ä¼ é€’ç»™æ¥æ”¶æ–¹çš„æ•°æ®é“¾è·¯å±‚ã€‚\nå…·ä½“åœ°è¯´ï¼Œç‰©ç†å±‚ç¡®å®šä¸ä¼ è¾“åª’ä½“æ¥å£æœ‰å…³çš„ä¸€äº›ç‰¹æ€§ï¼š\n\n\næœºæ¢°ç‰¹æ€§ï¼šæŒ‡æ˜æ¥å£æ‰€ç”¨æ¥çº¿å™¨çš„å½¢çŠ¶å’Œå°ºå¯¸ã€å¼•çº¿æ•°ç›®å’Œæ’åˆ—ã€å›ºå®šå’Œé”å®šè£…ç½®ç­‰ã€‚\nç”µæ°”ç‰¹æ€§ï¼šæŒ‡æ˜åœ¨æ¥å£ç”µç¼†çš„å„æ¡çº¿ä¸Šå‡ºç°çš„ç”µå‹çš„èŒƒå›´ã€‚\nåŠŸèƒ½ç‰¹æ€§ï¼šè§„å®šç‰©ç†æ¥å£ä¸Šå„æ¡ä¿¡å·çº¿çš„åŠŸèƒ½åˆ†é…å’Œç¡®åˆ‡å®šä¹‰ï¼ˆå„æ¡çº¿ä¸Šå‡ºç°å„ç§ç”µå‹è¡¨ç¤ºä½•ç§æ„ä¹‰ï¼‰ã€‚\nè§„ç¨‹ç‰¹æ€§ / è¿‡ç¨‹ç‰¹æ€§ï¼šå®šä¹‰äº†å„ä¿¡å·çº¿çš„å·¥ä½œé¡ºåºå’Œæ—¶åºï¼Œä½¿å¾—æ¯”ç‰¹æµä¼ è¾“å¾—ä»¥å®Œæˆã€‚\n\n2 åŸºæœ¬æ¦‚å¿µ\n\næ•°æ®æ˜¯éœ€è¦ä¼ é€çš„ä¿¡æ¯ï¼Œä¿¡å·æ˜¯æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­çš„å­˜åœ¨å½¢å¼ã€‚\n\n2.1 link/channel/data rate/baud rate\né“¾è·¯å’Œä¿¡é“ flashcard\n\n(ç‰©ç†) é“¾è·¯ linkï¼›æ‰¿è½½ä¿¡å·çš„ physical path\nä¸€æ¡ç‰©ç†é“¾è·¯å¯ä»¥é€šé€šè¿‡åˆ†æ—¶ã€åˆ†é¢‘ç­‰æ–¹å¼å®¹çº³å¤šä¸ª ä¿¡é“ channel (ä¹Ÿç§°ä¸ºé€»è¾‘é“¾è·¯)ï¼Œæ¯æ¡ä¿¡é“å¯¹åº”ç€ä¸€ä¸ªå‘é€æ–¹å’Œä¸€ä¸ªæ¥æ”¶æ–¹ã€‚\n\n\næ¯”ç‰¹ç‡ bit rate flashcard\n\nä¹Ÿå¯ä»¥å«data rateæ•°æ®ç‡ - å•ä½æ—¶é—´å†…ä¼ è¾“çš„ä¿¡æ¯ä¸­ bit çš„æ•°ç›®ï¼Œå³ (æ•°æ®é‡ / æ—¶é—´)ã€‚\n\nå•ä½æ˜¯ b/s Kb/s Mb/s Gb/s\nä¹Ÿå¯ä»¥å†™æˆ bps Kbps Mbps Gbps\næ³¨æ„æ˜¯ bit/s ä¸æ˜¯ Byte/s\nå°±ç®—å®é™…å‘é€çš„æ¯”ç‰¹æ¯”æ•°æ®å¤šã€è­¬å¦‚ç”¨1111è¡¨ç¤º1 ã€‘ï¼Œä½†æ˜¯data rateä¸å˜.ä¹Ÿå°±æ˜¯è¯´å†—ä½™çš„æ¯”ç‰¹æˆ‘ä»¬ä¸ç®—åœ¨å†…\n\n\n\n\nsymbol rate flashcard\n\nç å…ƒ / ç¬¦å· symbol - ç”¨ä¸€ä¸ªæ•°å­—è„‰å†²è¡¨ç¤ºçš„ä¸€ä¸ª k è¿›åˆ¶æ•°å­—ã€‚å°±æ˜¯ä¸€æ¬¡é‡‡æ ·å¾—åˆ°çš„ç»“æœï¼Œå¯èƒ½åŒ…å«ä¸åŒæ•°é‡çš„bitã€‚\n\næ¯”å¦‚å‡è®¾ç”µå¹³æœ‰4æ¡£åˆ†åˆ«ç¼–ç 00ï¼Œ01ï¼Œ10ï¼Œ11ï¼Œé‚£ä¹ˆä¸€æ¬¡é‡‡æ ·å°±æ˜¯2bitæ•°æ®ã€‚é‚£ä¹ˆåˆ†è¾¨8ä¸ªç”µå‹çš„è¯ä¸€æ¬¡é‡‡æ ·çš„ç»“æœå°±æœ‰3bitã€‚\n\n\nsymbol rate / baud rate - å•ä½æ—¶é—´å†…ä¼ è¾“çš„ symbol æ•°ç›®ï¼Œå³å•ä½æ—¶é—´å†…å¯èƒ½å‘ç”Ÿçš„ä¿¡å·å˜åŒ–æ¬¡æ•°ã€‚å°±æ˜¯å•ä½æ—¶é—´é‡‡æ ·æ¬¡æ•°ã€‚symbol/secondå°±æ˜¯baud\n\n\nä¾‹å¦‚ä¸€ä¸ªå››è¿›åˆ¶ç å…ƒï¼ˆ0123ï¼Œå››ä¸ªï¼‰å¯ä»¥æºå¸¦2bitï¼ˆlog24ï¼‰ä¿¡æ¯ï¼Œé‚£ä¹ˆå¦‚æœæ•°æ®ç‡æ˜¯64kb/sï¼Œé‚£ä¹ˆsymbolrateæ˜¯32kbaudï¼ˆå› ä¸º2bit/symbolï¼‰ã€‚å½“ç„¶ä¹Ÿå­˜åœ¨0.5bit/symbolçš„æƒ…å†µã€‚\n\n\n2.2 å¸¦å®½\nå¸¦å®½ç›¸å…³åŸç†/è°æ³¢æ‹Ÿåˆæ–¹æ³¢ flashcard\n\n\nç”¨ä¸€ä¸ªä¸€å€åŸºé¢‘çš„è°æ³¢ï¼ˆå‚…é‡Œå¶åˆ†é‡ï¼‰æ‹Ÿåˆæ–¹æ³¢\nç”¨ä¸€ä¸ªä¸€å€åŸºé¢‘å’Œä¸€ä¸ªäºŒå€åŸºé¢‘çš„è°æ³¢æ‹Ÿåˆ\nç”¨ä¸€ä¸ªä¸€å€åŸºé¢‘å’Œä¸€ä¸ªäºŒå€åŸºé¢‘å’Œä¸€ä¸ªå››å€åŸºé¢‘çš„è°æ³¢æ‹Ÿåˆ\nâ€¦â€¦\nè°æ³¢è¶Šå¤šï¼Œæ‹Ÿåˆæ–¹æ³¢è¶ŠæˆåŠŸã€‚ä½†æ˜¯ç‰©ç†åª’ä½“æœ‰é™åˆ¶ï¼šæˆªæ­¢é¢‘ç‡fcï¼Œè¶…è¿‡è¿™ä¸ªé¢‘ç‡çš„æ³¢ä¼šæœ‰ä¸åŒçš„å‡å¼±ã€‚æ‰€ä»¥åªèƒ½ä½¿ç”¨0-fcé¢‘ç‡ã€å¸¦å®½/é¢‘å¸¦å®½åº¦ã€‘\n\nå‘¨æœŸï¼šbï¼ˆéœ€è¦ä¼ è¾“b bitä¿¡å·ï¼‰/rï¼ˆdata rateï¼‰\né¢‘ç‡ï¼šr/b å‘¨æœŸçš„å€’æ•°\né‚£ä¹ˆN*r/bâ‡fc Nä¸ºå¯ä»¥æ¥å—çš„è°æ³¢ä¸ªæ•°ï¼ŒNå€åŸºé¢‘ä¸èƒ½å¤§äºæˆªæ­¢é¢‘ç‡ã€‚å¯ä»¥å¾—åˆ°Nâ‡b*fc/rã€‚\nå› ä¸ºNè¶Šå¤§ï¼Œä¿¡å·è´¨é‡è¶Šå¥½ï¼Œæ‰€ä»¥rè¿‡å¤§æ—¶ä¿¡å·è´¨é‡å°±ä¼šä¸å¥½ã€‚å› æ­¤åœ¨ä¿¡å·è´¨é‡æœ‰ä¸€å®šè¦æ±‚çš„æƒ…å†µä¸‹ï¼Œå¸¦å®½è¶Šå¤§ï¼Œæ•°æ®ç‡å°±è¶Šå¤§ã€‚å› æ­¤æ•°æ®ç‡çš„æœ€å¤§å€¼ä¹Ÿå¯ä»¥ç§°ä¸ºå¸¦å®½\n\n\n\n\nå¸¦å®½çš„è¾¨æ flashcard\n\n(æ•°å­—) å¸¦å®½ (digital) bandwidthï¼šæœ€å¤§å¯èƒ½çš„ data rateï¼Œç”¨æ¥è¡¨ç¤ºé€šä¿¡çº¿è·¯ä¼ è¾“æ•°æ®çš„èƒ½åŠ›ï¼Œé¢‘å¸¦å®½åº¦è¶Šå¤§ï¼Œæ•°æ®ç‡è¶Šå¤§ï¼Œå› æ­¤æŠŠæ•°æ®ç‡æœ€å¤§å€¼ä¹Ÿå«åšå¸¦å®½ã€‚å•ä½ä¸ data rate ä¸€è‡´ã€‚\n(æ¨¡æ‹Ÿ) å¸¦å®½ (analog) bandwidthï¼šä¿¡é“çš„é¢‘å¸¦å®½åº¦ï¼Œå•ä½æ˜¯ Hzã€‚å¸¦å®½æ˜¯ä¼ è¾“ä»‹è´¨çš„ä¸€ç§ç‰©ç†ç‰¹æ€§ï¼Œæ»¤æ³¢å™¨å¯ä»¥é€šè¿‡è¿‡æ»¤æ‰æŸäº›é¢‘ç‡çš„ä¿¡å·æ¥è¿›ä¸€æ­¥é™åˆ¶ä¿¡å·çš„å¸¦å®½ã€‚\n\nå¸¦å®½æŒ‡çš„æ˜¯ä¸€æ®µé¢‘ç‡èŒƒå›´ï¼Œå®ƒå¹¶ä¸è¦æ±‚è¿™æ®µé¢‘ç‡ä¸€å®šä» 0 å¼€å§‹ï¼›äº‹å®ä¸Šå¯¹äºæ— çº¿ä¿¡é“æ¥è¯´ï¼Œå‘é€ä½é¢‘ç‡çš„ä¿¡å·ä¹Ÿæ˜¯ä¸å¯èƒ½çš„ï¼Œå› ä¸ºæ³¢é•¿ä¼šå¾ˆå¤§ï¼Œå¤©çº¿é•¿åº¦è¦è·Ÿæ³¢é•¿ä¸€æ ·é•¿ã€‚\n\næˆ‘ä»¬ç§°ä¹‹å‰æ‰€è¯´çš„é¢‘ç‡ä¸º 0âˆ¼B Hz çš„ä¿¡å·ä¸ºåŸºå¸¦ä¿¡å· (baseband signal)\nè€Œå°†å…¶æ¬ç§»åˆ° Sâˆ¼S+B Hz çš„ä¿¡å·ä¸ºé€šå¸¦ä¿¡å· (passband signal)ã€‚\n\n\n\n\n\n\n2.3 é‡‡æ ·å®šç†\nNyquistâ€™s theorem å¥ˆå¥æ–¯ç‰¹å®šç† flashcard\n\næ¡ä»¶ï¼šåœ¨ç†æƒ³ (æ— å™ªå£°) ä½é€š (å¸¦å®½æœ‰é™) ä¿¡é“ä¸­\n\nã€æœ‰å™ªå£°ä¹Ÿå¯ä»¥é€‚ç”¨ã€‘ï¼Œå› ä¸ºæå‡ºçš„æ˜¯ç†è®ºä¸Šé™ï¼Œæœ‰å™ªå£°åªä¼šæ›´ä½\n\n\næé™ç å…ƒä¼ è¾“é€Ÿç‡ï¼ˆé‡‡æ ·é¢‘ç‡ï¼‰æ˜¯ 2W Baudï¼Œå…¶ä¸­ W æ˜¯ç†æƒ³ä½é€šä¿¡é“çš„ (æ¨¡æ‹Ÿ) å¸¦å®½ï¼Œå¤§äºè¿™ä¸ªæé™ç å…ƒé€Ÿç‡ä¹Ÿé‡‡ä¸å‡ºæ›´å¤šäº†å°±æµªè´¹äº†ã€‚\n\nè‹¥ç”¨ V è¡¨ç¤ºæ¯ä¸ªç å…ƒç¦»æ•£ç”µå¹³çš„æ•°ç›® (å³å…¶å¯ä»¥å–å€¼çš„ç¦»æ•£å€¼çš„ä¸ªæ•°ï¼›å³å…¶è¿›åˆ¶æ•°)ï¼Œåˆ™æé™æ•°æ®é€Ÿç‡ä¸º 2W logâ‚‚(V) (b/s)ã€‚\n8çº§ç”µå¹³ï¼Œç”¨log28ä¸ªbitå¯ä»¥è¡¨ç¤ºä¸€ä¸ªsymbolï¼Œå³3bit/symbol\n\n\n\n\nShannonâ€™s theorem é¦™å†œå®šç† flashcard\n\næ¡ä»¶ï¼šåœ¨å—é«˜æ–¯ç™½å™ªå£°å¹²æ‰°çš„ä¿¡é“ä¸­\nç”¨ W è¡¨ç¤ºä¿¡é“çš„ (æ¨¡æ‹Ÿ) å¸¦å®½ï¼ŒS è¡¨ç¤ºä¿¡å·å¹³å‡åŠŸç‡ï¼ŒN è¡¨ç¤ºé«˜æ–¯å™ªå£°åŠŸç‡ï¼Œåˆ™æé™æ•°æ®é€Ÿç‡æ˜¯ W logâ‚‚(1 + S/N) (b/s)ã€‚\n\nä¿¡å™ªæ¯” Signal-to-Noise Ratio, SNRï¼šå…¬å¼ä¸­çš„ S/N å°±æ˜¯ä¿¡å™ªæ¯”ï¼Œæ²¡æœ‰å•ä½ï¼›ä½†ä¸ºäº†æ–¹ä¾¿è¡¨ç¤ºæ›´å¤§çš„èŒƒå›´ï¼Œä¹Ÿç”¨ 10lg(S/N) è¡¨ç¤ºä¿¡å™ªæ¯”ï¼Œå•ä½ä¸ºåˆ†è´ dBï¼ˆæ¯”å¦‚ç”¨50åˆ†è´æ¥è¡¨ç¤º10çš„äº”æ¬¡æ–¹çš„ä¿¡å™ªæ¯”ï¼‰ã€‚å°±æ˜¯è¯´å¦‚æœçœ‹åˆ°åˆ†è´å•ä½çš„ä¿¡å™ªæ¯”éœ€è¦è¿›è¡Œæ¢ç®—ä¹‹åè¿˜åŸæˆæ™®é€šä¿¡å™ªæ¯”ä»£å…¥å…¬å¼.\n\n\n\n\n\n\n                  \n                  æ±‚æé™æ•°æ®é€Ÿç‡ä¾‹é¢˜ flashcard\n                  \n                \n\n\nå¯¹äºç»™å‡ºäº† V (ä¿¡å·ç”µå¹³æ•°) çš„æƒ…å†µï¼Œæ— è®ºæ˜¯å¦è¯´æ˜æ— å™ªå£°éƒ½åº”ä½¿ç”¨ Nyquistâ€™s theorem ç¡®å®š data rate çš„ä¸€ä¸ªä¸Šç•Œã€‚\nå¯¹äºç»™å‡ºäº† SNR (ä¿¡å™ªæ¯”) çš„æƒ…å†µï¼Œä¹Ÿåº”æ ¹æ® Shannonâ€™s theorem ç¡®å®šå¦ä¸€ä¸ªä¸Šç•Œã€‚\n\nç¤ºä¾‹ä¸€ï¼šç”µè¯ç³»ç»Ÿ\nç”µè¯ç³»ç»Ÿçš„å…¸å‹å‚æ•°æ˜¯ä¿¡é“å¸¦å®½ä¸º 3000Hzï¼Œä¿¡å™ªæ¯”ä¸º 30dBï¼Œåˆ™è¯¥ç³»ç»Ÿçš„æœ€å¤§æ•°æ®ä¼ è¾“é€Ÿç‡ä¸ºï¼š 3kÃ—log2â€‹(1+10^(30/10))Â b/sâ‰ˆ30kb/s\nç¤ºä¾‹äºŒï¼šç»“åˆä¸¤ç§å®šç†\näºŒè¿›åˆ¶ä¿¡å·åœ¨ä¿¡å™ªæ¯”ä¸º 127:1 çš„ 4kHz ä¿¡é“ä¸Šä¼ è¾“ï¼Œæ±‚æœ€å¤§æ•°æ®ä¼ è¾“é€Ÿç‡ã€‚ã€2è¿›åˆ¶ä¿¡å·å¯ä»¥ç†è§£æˆ2å…ƒä¿¡å·ã€‘\n\næ ¹æ® Nyquistâ€™s theoremï¼Œæœ€å¤§æ•°æ®é€Ÿç‡ä¸º2Ã—4kÃ—log2â€‹(2)Â b/s=8kb/s\næ ¹æ® Shannonâ€™s theoremï¼Œæœ€å¤§æ•°æ®é€Ÿç‡ä¸º4kÃ—log2â€‹(1+127)Â b/s=28kb/s\nç»“è®ºï¼š äºŒè€…å‡ä¸ºä¸Šç•Œï¼Œåº”å–å…¶ä¸­è¾ƒå°çš„ä¸€ä¸ªï¼Œå› æ­¤è¯¥ä¿¡é“çš„æœ€å¤§æ•°æ®ä¼ è¾“é€Ÿç‡ä¸º 8kb/sã€‚\n\nç¤ºä¾‹ä¸‰ æ— æ„ä¹‰ä¿¡æ¯\n\nä¸€æ¡æ— å™ªå£°çš„ 8kHz ä¿¡é“ï¼Œæ¯ä¸ªä¿¡å·åŒ…å« 8 çº§ï¼Œæ¯ç§’é‡‡æ · 24k æ¬¡ï¼Œé‚£ä¹ˆå¯ä»¥è·å¾—çš„æœ€å¤§ä¼ è¾“é€Ÿç‡æ˜¯ï¼Ÿ\n\næ— å™ªå£° - Nyquist, data rate = 2 * 8kHz * logâ‚‚(8) bit/symbol = 48kbps\nâ€œé¢˜ç›®ä¸­ç»™å‡ºçš„æ¯ç§’é‡‡æ · 24k æ¬¡æ˜¯æ— æ„ä¹‰çš„ï¼Œå› ä¸ºè¶…è¿‡äº†æ³¢ç‰¹ç‡çš„ä¸Šé™ 2W = 16 kBaudï¼Œæ‰€ä»¥ 72kbps æ˜¯é”™è¯¯ç­”æ¡ˆâ€\n\n\n\nç¤ºä¾‹å›› ä¸ä¹˜2çš„æƒ…å†µ\n\nä¸€ä¸ªä¿¡é“æ¯ 1/8s é‡‡æ ·ä¸€æ¬¡ï¼Œä¼ è¾“ä¿¡å·å…±æœ‰ 16 ä¸­å˜åŒ–çŠ¶æ€ï¼Œæœ€å¤§æ•°æ®ä¼ è¾“é€Ÿç‡æ˜¯ï¼Ÿã€æœ€å¤§é‡‡æ ·æ˜¯å¸¦å®½çš„2å€ï¼Œè¿™é‡Œå·²ç»å‘Šè¯‰æˆ‘ä»¬é‡‡æ ·é¢‘ç‡äº†å°±ä¸ä¹˜2äº†ã€‘\n\n8Baud * logâ‚‚(16) bit/symbol = 32bps\n\n\n\n\n\n\n\n3 ä¿¡æ¯äº¤äº’æ–¹å¼ flashcard\n\nå•å·¥é“¾è·¯ simplex link - 1æ¡ä¿¡é“ï¼Œå›ºå®šå•å‘é€šä¿¡ã€‚ã€ å¹¿æ’­ã€‘\nåŠåŒå·¥é“¾è·¯ half-duplex link - 2æ¡ä¿¡é“ï¼ŒåŒå‘å¯é€šä¿¡ä½†ä¸èƒ½åŒæ—¶ã€‚ã€ å¯¹è®²æœºã€‘\nå…¨åŒå·¥é“¾è·¯ full-duplex link - 2æ¡ä¿¡é“ï¼Œä¸¤è¾¹å¯ä»¥åŒæ—¶æ”¶å‘ã€‚ã€ æ‰“ç”µè¯ã€‘\n\næ³¨æ„2æ¡ channel ä¸ä¸€å®šéœ€è¦2æ¡ç‰©ç†é“¾è·¯ï¼Œä¸€æ¡é€šè¿‡ä¸€äº›å¤ç”¨æ–¹å¼æˆ–è€…åŒå‘ä¼ è¾“ä¹Ÿå¯ä»¥å®ç°ã€‚\n\n\n\n\n4 ä¼ è¾“ä»‹è´¨ / ä¼ è¾“åª’ä½“ flashcard\nTransmission mediaï¼Œæ•°æ®ä¼ è¾“ç³»ç»Ÿä¸­å‘é€è®¾å¤‡å’Œæ¥æ”¶è®¾å¤‡ä¹‹é—´çš„ç‰©ç†é€šè·¯ã€‚\n\nå¯¼å‘ä¼ è¾“ä»‹è´¨ Guided trans media\n\nåŒç»çº¿ twisted pairï¼šç»åˆä»¥ã€å‡å°‘ç›¸é‚»å¯¼çº¿çš„ç”µç£å¹²æ‰°ã€‘ã€‚\n\nåœ¨åŒç»çº¿å¤–åŠ ä¸€å±‚é‡‘å±ä¸ç¼–ç»‡çš„å±è”½å±‚ï¼Œå¯ä»¥è¿›ä¸€æ­¥ã€æé«˜æŠ—ç”µç£å¹²æ‰°çš„èƒ½åŠ› ã€‘ï¼Œç§°ä¸ºå±è”½åŒç»çº¿ STP, Shielded Twisted Pair\næ²¡æœ‰å±è”½å±‚çš„ç§°ä¸ºéå±è”½åŒç»çº¿ UTP, Unshielded Twisted Pairã€‚\n\n\nåŒè½´ç”µç¼† coaxial cable\nå…‰çº¤ fiber optics\n\n\néå¯¼å‘ä¼ è¾“ä»‹è´¨ / æ— çº¿ä¼ è¾“ Wireless transmission\n\næ— çº¿ç”µæ³¢ Radioï¼šæœ‰è¾ƒå¼ºçš„ç©¿é€èƒ½åŠ›ï¼Œä¸éœ€å¯¹å‡†æŸä¸ªæ–¹å‘ï¼›æ— çº¿æ‰‹æœºé€šä¿¡ã€WLAN (wireless local area network) ç­‰ã€‚\nå¾®æ³¢ã€çº¢å¤–çº¿ã€æ¿€å…‰ï¼šæœ‰å¾ˆå¼ºçš„æ–¹å‘æ€§ï¼Œç›´çº¿ä¼ æ’­ã€‚\n\n\n\n\n5 æ•°å­—è°ƒåˆ¶ / æ•°å­—æ•°æ®åˆ°æ¨¡æ‹Ÿä¿¡å·\næ•°æ®ä¸ä»£è¡¨å®ƒä»¬çš„ä¿¡å·ä¹‹é—´çš„è½¬æ¢è¿‡ç¨‹ç§°ä¸ºæ•°å­—è°ƒåˆ¶ digital modulationã€‚\n5.1 åŸºå¸¦ä¼ è¾“ Baseband Transmission flashcard\n\nç›´æ¥å°†æ•°æ®è½¬æ¢ä¸ºæ•°å­—ä¿¡å·ï¼Œæ•°å­—ä¿¡å·æ˜¯ç¦»æ•£çš„ï¼Œå ç”¨ä¼ è¾“ä»‹è´¨ä¸Šçš„å…¨éƒ¨é¢‘ç‡ï¼Œç”¨äºæœ‰çº¿ä»‹è´¨ (å…‰çº¤ä¸æ˜¯åŸºå¸¦ä¼ è¾“) ã€ç¼–ç ã€‘\n\n**Non-Return to\n\n\nZero\n- ç”¨æ­£ç”µå‹ / æœ‰å…‰è¡¨ç¤º 1ï¼Œè´Ÿç”µå‹ / æ²¡æœ‰å…‰è¡¨ç¤º 0ã€‚\n- é—®é¢˜æ˜¯å¦‚æœ 0 å’Œ 1 äº¤æ›¿ï¼Œæ¥æ”¶ç«¯å¯ä»¥åœ¨æ¯ä¸€æ¬¡å˜åŒ–æ—¶æ ¡å‡†ï¼›ä½†æ˜¯å¦‚æœä¸€ç›´æ˜¯ 0 æˆ–è€… 1 çš„è¯è¿‡ä¸€æ®µæ—¶é—´å¯èƒ½å°±æ•°é”™äº†ä¼šå¤±å»åŒæ­¥ã€‚\n\nManchester (ä»¥å¤ªç½‘ Ethernet çš„ç¼–ç æ–¹å¼)\n\nç”¨ä¸€ä¸ªé«˜å’Œä¸€ä¸ªä½è¡¨ç¤º1ï¼Œä¸€ä¸ªä½ä¸€ä¸ªé«˜è¡¨ç¤º0 (å®é™…ä¸Šå°±æ˜¯ä¸ä¸€ä¸ªæ—¶é’Ÿä¿¡å·åšäº† XORï¼Œå¦‚å›¾)ã€‚è§£å†³äº†æ—¶é’Ÿä¿¡å·çš„é—®é¢˜ï¼Œå³æ¯ä¸ªç å…ƒä¸­é—´ä¸€å®šæœ‰ç”µå¹³è·³å˜ã€‚\né—®é¢˜æ˜¯å¸¦å®½å¼€é”€å¢å¤§äº†â€”å€ã€‚\n\n\nNRZI NRZ Invert (USB 2.0 çš„ç¼–ç æ–¹å¼)ï¼š\n\nç”¨ä¿¡å·ç¿»è½¬è¡¨ç¤º 1ï¼Œä¿¡å·ä¸å˜è¡¨ç¤º 0ã€‚æ²¡æœ‰å¸¦å®½å¼€é”€çš„å¢åŠ ï¼›\nè§£å†³äº†ä¸€é•¿ä¸²éƒ½æ˜¯ 1 çš„é—®é¢˜ï¼›ä½†æ˜¯å¦‚æœä¸€é•¿ä¸²éƒ½æ˜¯ 0 è¿˜æ˜¯ä¸è¡Œã€‚\n\n\n4B/5B mappingï¼š\n\næŠŠ4bitçš„dataé‡æ–°æ˜ å°„åˆ°ä¸€å¥—æ–°çš„5bitç¼–ç \nç»è¿‡è®¾è®¡çš„æ–°ç¼–ç ä¿è¯æ˜ å°„ç»“æœæœ€å¤šåªä¼šå‡ºç°è¿ç»­ 3 ä¸ª 0ï¼Œå°±èƒ½è§£å†³NRZI NRZ Invertçš„é—®é¢˜ã€‚è™½ç„¶å¢åŠ äº† 25% çš„å¼€é”€ï¼Œä½†æ˜¯æ¯” Manchester å¥½ä¸€äº›ã€‚\n\n\næ‰°é¢‘/å€’é¢‘ scramblingï¼š\n\nå°è¯•è§£å†³ä¸€é•¿ä¸² 0 å’Œ 1 çš„é—®é¢˜ã€‚å‘é€æ•°æ®ä¹‹å‰ï¼Œç”¨ä¸€ä¸ªä¼ªéšæœºåºåˆ— XOR æ•°æ®ï¼Œæ¥æ”¶å™¨ç”¨åŒæ ·çš„åºåˆ— XOR åå¾—åˆ°ç»“æœã€‚\nä½†æ˜¯å…¶å®ä¸å¤ªé è°±å¦‚æœä¿¡å·å’Œxoræ•°æ®ä¸€æ¨¡ä¸€æ ·çš„è¯å¼‚æˆ–å®Œå…¨æ˜¯0ï¼Œè€Œä¸”å®¹æ˜“è¢«æˆªè·\n\n\nåŒæç¼–ç  bipolar encoding / AMI, Alternate Mark Inversionï¼š\n\nè¿™ç§ç¼–ç æ–¹å¼å…³æ³¨ä¿¡å·çš„å¹³è¡¡æ€§ï¼›çŸ­æ—¶é—´å†…æ­£ç”µå‹å’Œè´Ÿç”µå‹ä¸€æ ·å¤šçš„ä¿¡å·ç§°ä¸ºå¹³è¡¡ä¿¡å· balanced signalã€‚è¿™æ ·çš„ä¿¡å·å‡å€¼ä¸º0ï¼Œå³æ²¡æœ‰ç›´æµåˆ†é‡ï¼›ç”±äºä¼ è¾“ä»‹è´¨çš„ç‰©ç†æ€§è´¨ï¼Œæ²¡æœ‰ç›´æµåˆ†é‡æ˜¯ä¸€ä¸ªä¼˜ç‚¹ã€‚\nè¿™ç§ç¼–ç æ–¹å¼ç”¨ +1 æˆ–è€… -1 è¡¨ç¤º 1ï¼Œæ¯æ¬¡çš„ 1 ä¸å‰ä¸€æ¬¡çš„ 1 è¡¨ç¤ºæ³•ç›¸åï¼Œä¿è¯æœ€å¤šåªå·® 1 ä¸ªï¼›ç”¨ 0 è¡¨ç¤º 0ã€‚\n\n\n8B/10B ç¼–ç æ¨¡å¼ï¼š\n\nåŒæ—¶è€ƒè™‘è¿™äº›é—®é¢˜ï¼Œé€šè¿‡æ˜ å°„ä¿è¯æ²¡æœ‰è¶…è¿‡ 5 ä¸ªè¿ç»­çš„ 0 æˆ–  1ï¼ŒåŒæ—¶ä¿æŒ 0 å’Œ 1 æ•°ç›®ç›¸å¯¹å‡ç­‰ï¼›å…¶é¢å¤–å¸¦å®½æ¶ˆè€—ä¹Ÿåªæœ‰ 25%\n\n\n\n5.2 é€šå¸¦ä¼ è¾“ Passband Transmission flashcard\né€šè¿‡è°ƒèŠ‚è½½æ³¢ä¿¡å·çš„å¹…å€¼ã€ç›¸ä½æˆ–é¢‘ç‡æ¥è¿è½½æ•°æ®ï¼Œå æ®è½½æ³¢ä¿¡å·é¢‘ç‡ä¸ºä¸­å¿ƒçš„ä¸€æ®µé¢‘å¸¦ï¼Œç”¨äºæ— çº¿å’Œå…‰çº¤ä¿¡é“ã€‚ã€ è°ƒåˆ¶ã€‘\n\n\nå¹…ç§»é”®æ§ ASK, Amplitude Shift Keyingï¼š\n\né€šè¿‡ä¸¤ä¸ªä¸åŒçš„æŒ¯å¹…åˆ†åˆ«è¡¨ç¤º 0 å’Œ 1ï¼›å¯ä»¥ç”¨æ›´å¤šçš„å¹…å€¼ç­‰çº§è¡¨ç¤ºæ›´å¤šçš„ä¿¡æ¯ã€‚\n\n\né¢‘ç§»é”®æ§ FSK, Frequency Shift Keyingï¼š\n\nç±»ä¼¼åœ°ï¼Œé€šè¿‡ä¸åŒé¢‘ç‡è¡¨ç¤ºä¸åŒçš„ç å…ƒã€‚\n\n\nç›¸ç§»é”®æ§ PSK, Phase Shift Keyingï¼š\n\nå°†è½½æ³¢æ³¢å½¢åç§»â€”å®šçš„ç›¸ä½ã€‚\n\näºŒè¿›åˆ¶ç›¸ç§»é”®æ§ BPSK, Binary PSKï¼šå°†æ³¢å½¢åç§» 0Â° å’Œ 180Â°ã€‚\næ­£äº¤ç›¸ç§»é”®æ§ QPSK, Quadrature PSKï¼šå°†æ³¢å½¢åç§» 45Â°, 135Â°, 225Â° å’Œ 315Â°ã€‚\n\n\n\n\n\nå åŠ ç»¼åˆ\n\næ˜Ÿåº§å›¾ constellation diagramï¼šä¸ºäº†è®©æ¯ä¸ªç å…ƒä¼ è¾“æ›´å¤š bit çš„ä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥å°†è¿™äº›æ–¹å¼ç»¼åˆèµ·æ¥ä½¿ç”¨ã€‚ä¸‹é¢çš„æ˜Ÿåº§å›¾ç”¨é»‘ç‚¹è¡¨ç¤ºä¸€ä¸ªåˆæ³•çš„æŒ¯å¹…å’Œç›¸ä½çš„ç»„åˆï¼Œæ¯ä¸€ä¸ªsymbolå¯èƒ½æ˜¯è¿™nä¸ªé»‘ç‚¹ä¸­çš„ä¸€ä¸ª\n\nå…¶ä¸­æ¯ä¸ªé»‘ç‚¹åˆ°åŸç‚¹çš„è·ç¦»è¡¨ç¤ºæŒ¯å¹…ï¼Œ\nå’Œ x è½´æ­£æ–¹å‘æ‰€æˆè§’åº¦è¡¨ç¤ºç›¸ä½åç§»ã€‚\n\n\næ­£äº¤è°ƒå¹… QAM, Quadrature Amplitude Modulationï¼šä¸Šå›¾ (a) å³ä¸ºå‰è¿° QPSKï¼Œè€Œåé¢ä¸¤ä¸ªå›¾æ˜¯ QAM ã€æ­£äº¤ç›¸ç§»é”®æ§xè°ƒå¹…ã€‘çš„ä¸¤ä¸ªå®ä¾‹ï¼Œå®ƒä»¬çš„æ¯ä¸ª symbol åˆ†åˆ«æºå¸¦ 4 bit å’Œ 6 bit çš„ä¿¡æ¯ã€‚\nGray codeï¼šä¸ºæ˜Ÿåº§å›¾åˆ†é…æ¯ä¸ªé»‘ç‚¹ä»£è¡¨çš„ bit æ—¶ï¼Œéœ€è¦è€ƒè™‘å°‘é‡çš„çªå‘å™ªéŸ³ä¸ä¼šå¯¼è‡´å¾ˆå¤š bit å‡ºé”™ã€‚å¯ä»¥ä½¿ç”¨ Gray code è§£å†³è¿™ä¸€é—®é¢˜ï¼ˆç›¸é‚»ç‚¹çš„ bit ç ä»…ç›¸å·®ä¸€ä½ï¼‰ã€‚\n\n\n6 å¤šè·¯å¤ç”¨\né¢‘åˆ†å¤ç”¨ FDM, Frequency Division Multiplexing flashcard\nç»è¿‡è°ƒåˆ¶åï¼Œè¦ä¼ è¾“çš„ä¿¡å·æ‰€å å¸¦å®½æ˜¯æœ‰é™çš„ï¼›è€Œçº¿è·¯å¯ä½¿ç”¨çš„å¸¦å®½è¿œå¤§äºè¿™ä¸€å®½åº¦ã€‚\næˆ‘ä»¬å¯ä»¥å¯¹å¤šè·¯ä¿¡å·é‡‡ç”¨ä¸åŒé¢‘ç‡è¿›è¡Œè°ƒåˆ¶ï¼Œä½¿å¾—è°ƒåˆ¶åå„è·¯ä¿¡å·é¢‘ç‡ä¸åŒï¼Œä¸ä¼šäº’ç›¸å¹²æ‰°ï¼›å³å°†ä¿¡é“å¸¦å®½åˆ†å‰²ä¸ºå¤šç§ä¸åŒé¢‘å¸¦çš„å­ä¿¡é“ï¼Œå®ç°å¤šè·¯å¤ç”¨ã€‚\n\næ¯ä¸ªé¢‘å¸¦ä¹‹é—´ä¿ç•™è¶³å¤Ÿå®½çš„è·ç¦»ï¼Œä¿è¯ç›¸é‚»çš„é¢‘å¸¦ä¸ä¼šç›¸äº’é‡å ã€‚è¿™ä¸€éƒ¨åˆ†ä¿æŠ¤é—´éš™ç§°ä¸ºä¿æŠ¤é¢‘å¸¦ guard bandã€‚ \næ­£äº¤é¢‘åˆ†å¤ç”¨ OFDM, Orthogonal FDMï¼šåŸºæœ¬æ€æƒ³æ˜¯ï¼šæ¯ä¸ªå­è½½æ³¢ç›¸äº’æ­£äº¤ï¼›å³æ¯ä¸ªå­è½½æ³¢åœ¨å…¶å­è½½æ³¢çš„ä¸­å¿ƒé¢‘ç‡å¤„èƒ½é‡ä¸º0ã€‚è¿™æ ·åœ¨æ¯ä¸ªå­è½½æ³¢ä¸­å¿ƒé¢‘ç‡å¤„å–æ ·ï¼Œå°±ä¸ä¼šè¢«å…¶ä»–å­è½½æ³¢å¹²æ‰°äº†ã€‚è¿™æ ·çš„æ–¹å¼ä¸éœ€è¦ guard bandï¼Œä¸”é¢‘å¸¦åˆ©ç”¨ç‡å¾ˆé«˜ã€‚\n\n\næ—¶åˆ†å¤ç”¨ TDM, Time Division Multiplexing flashcard\næ¯ä¸ªç”¨æˆ·å‘¨æœŸæ€§åœ°è½®æµå·¥ä½œï¼Œæ¯æ¬¡åœ¨ä¸€ä¸ªéå¸¸çŸ­çš„æ—¶é—´å†…è·å¾—æ•´ä¸ªå¸¦å®½ã€‚ç±»ä¼¼äºé¢‘åˆ†å¤ç”¨ï¼Œæ—¶åˆ†å¤ç”¨ä¹Ÿå¯èƒ½ä¼šéœ€è¦å¢åŠ ä¿æŠ¤æ—¶é—´ guard timeï¼Œä¿è¯ä¸é‡å \n\n\nTDM çš„è°ƒåº¦æ–¹å¼æ˜¯æœºæ¢°çš„ï¼Œä¸€ç§åŠ¨æ€æŒ‰éœ€åˆ†é…æ—¶é—´ç‰‡çš„æ–¹å¼æ˜¯ç»Ÿè®¡æ—¶åˆ†å¤ç”¨ STDM, Statistical TDMã€‚ä½†æ˜¯éœ€è¦é¢å¤–çš„ä¿¡æ¯æ¥æ ‡è¯†å¯èƒ½æ•ˆç‡åè€Œä¼šå˜ä½\n\n\nç åˆ†å¤ç”¨ CDM, Code Division Multiplexing/ç åˆ†å¤šå€CDMA, Code Division Multiple Access#flashcard flashcard\n\n\nè‹¥å¹²ç”± 1 æˆ– -1 ç»„æˆçš„åºåˆ—S, SË‰ è¡¨ç¤ºå…¶åç  (åºåˆ—ä¸­çš„æ¯ä¸ªæ•°å–å…¶ç›¸åæ•°)ã€‚\nå¯¹äºä»»æ„ä¸¤ä¸ªåºåˆ— S å’Œ Tï¼Œå…¶å½’ä¸€åŒ–å†…ç§¯ (normalized inner product) =å†…ç§¯ï¼ˆå¯¹åº”ä½ç½®ç›¸ä¹˜çš„ç§¯ç›¸åŠ ï¼‰/mï¼Œå…¶ä¸­ m æ˜¯åºåˆ—çš„é•¿åº¦ï¼Œæ­¤å¤„ä¸º 8ã€‚\n\nå®¹æ˜“ç†è§£ï¼Œæœ‰ Sâ‹…S=1ï¼ŒSâ‹…SË‰=âˆ’1ã€‚è‹¥ Sâ‹…T=0ï¼Œæˆ‘ä»¬ç§°è¿™ä¸¤ä¸ªåºåˆ—æ˜¯æ­£äº¤ (orthogonal) çš„ï¼› æ˜¾ç„¶æ­¤æ—¶ SË‰â‹…T=Sâ‹…TË‰=SË‰â‹…TË‰=0ã€‚æ ¹æ®è¿™ä¸€å®šä¹‰ï¼Œå›¾ä¸­ (a) çš„ 4 ä¸ªåºåˆ—ABCDæ˜¯ä¸¤ä¸¤æ­£äº¤çš„ã€‚\n\n\nç°åœ¨æˆ‘ä»¬å°è¯•åˆ©ç”¨è¿™äº›åºåˆ—å‘é€ä¿¡å·ã€‚æ¯ä¸ªå‘é€ç«¯ï¼ˆABCDï¼‰è¢«åˆ†é…äº†ä¸€ä¸ªåºåˆ—ï¼›\n\næ¯ä¸€ä¸ªå‘¨æœŸä¸­ï¼Œå‘é€ç«¯å¯ä»¥é€‰æ‹©å‘é€ 1 (é€šè¿‡å‘é€è¿™ä¸ªåºåˆ—)ï¼Œæˆ–è€…å‘é€ 0 (é€šè¿‡å‘é€è¿™ä¸ªåºåˆ—çš„åç )ï¼Œæˆ–è€…ä»€ä¹ˆéƒ½ä¸å‘é€ã€‚å½“å¤šä¸ªç«™åŒæ—¶å‘é€æ—¶ï¼Œå®ƒä»¬å‘é€çš„ä¿¡å·ä¼šå åŠ èµ·æ¥ï¼›\nä½†æ˜¯ç”±äºåºåˆ—çš„æ­£äº¤æ€§ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ¯ä¸ªç«™å‘é€çš„ä¿¡æ¯å•ç‹¬è§£ç å‡ºæ¥ã€‚å‡è®¾åœ¨æŸä¸€ä¸ªå‘¨æœŸä¸­ï¼ŒA å’Œ D å‘é€äº† 0ï¼ŒB å‘é€äº† 1ï¼ŒC ä»€ä¹ˆéƒ½æ²¡æœ‰å‘é€ï¼Œé‚£ä¹ˆå åŠ å‡ºçš„ä¿¡å·å°±å½¢å¦‚ S=AË‰+B+DË‰=(1,âˆ’1,3,âˆ’1,1,3,âˆ’1,âˆ’1)ã€‚æˆ‘ä»¬å°†è¿™ä¸ªä¿¡å·ä¸ B ä½œå½’ä¸€åŒ–å†…ç§¯ï¼š\nSâ‹…B=8âˆ’1+1+3+1+1+3âˆ’1+1â€‹=1\n\n\nå³ B å‘é€çš„æ˜¯ 1ã€‚å¦‚æœä¸ C ä½œå½’ä¸€åŒ–å†…ç§¯ï¼Œåˆ™ç»“æœä¸º 0ï¼Œè¡¨ç¤º C ä»€ä¹ˆéƒ½æ²¡æœ‰å‘é€ã€‚å¦‚æœä¸ A æˆ– D åšå½’ä¸€åŒ–å†…ç§¯ï¼Œåˆ™ç»“æœä¸º -1ï¼Œè¡¨ç¤ºå‘é€çš„æ˜¯åç  (å³ 0)ã€‚è¿™æ˜¯å› ä¸ºï¼Œå½’ä¸€åŒ–å†…ç§¯æ»¡è¶³åˆ†é…å¾‹ï¼ŒSâ‹…D=(AË‰+B+DË‰)â‹…D=AË‰â‹…D+Bâ‹…D+DË‰â‹…Dï¼Œè€Œå‰ä¸¤é¡¹ç”±äºæ­£äº¤æ€§ä¸º 0ï¼Œç¬¬ä¸‰é¡¹ä¸º -1ï¼Œå› æ­¤æœ€ç»ˆç»“æœä¸º -1ï¼›å…¶ä»–çš„æƒ…å†µä¹Ÿæ˜¯ç±»ä¼¼çš„ã€‚\nä¸‹é¢å›é¡¾æˆ‘ä»¬åšäº†ä»€ä¹ˆã€‚æˆ‘ä»¬==åœ¨åŸæœ¬éœ€è¦å‘é€ 1ä¸ª bit çš„æ—¶é—´å‘é€äº† m ä¸ª bit ç»„æˆçš„åºåˆ—==ï¼Œè¿™æ ·çš„åºåˆ—å¯ä»¥æœ‰ m ä¸ªä¸”ä¸¤ä¸¤æ­£äº¤ (è€ƒè™‘æ­£äº¤çŸ©é˜µ)ï¼Œ==ä»è€Œæ»¡è¶³ m ä¸ªå‘é€æ–¹åŒæ—¶äº’ä¸å¹²æ‰°åœ°ä¼ è¾“çš„éœ€è¦==ã€‚åŒæ—¶ç”±äºæˆ‘ä»¬åœ¨å•ä½æ—¶é—´å†…ä¼ è¾“çš„ bit æ•°æ˜¯åŸæ¥çš„ m å€ï¼Œå› æ­¤==æ‰€éœ€è¦çš„å¸¦å®½ä¹Ÿæ˜¯åŸæ¥çš„ m å€==ã€‚å¦‚æ­¤æˆ‘ä»¬å°†ä¸€ä¸ªçª„å¸¦ä¿¡å·æ‰©å±•åˆ°äº†ä¸€ä¸ªå¾ˆå®½çš„é¢‘å¸¦ä¸Šï¼Œè¿™æ ·æ›´èƒ½å®¹å¿å¹²æ‰°ï¼ŒåŒæ—¶å…è®¸å¤šä¸ªç”¨æˆ·å…±äº«åŒä¸€ä¸ªé¢‘å¸¦ã€‚\n\n\n7 å…¬å…±ç”µè¯äº¤æ¢ç½‘ç»œ The Public Switched Telephone Network, PSTN flashcard\n\n\n7.1 æœ¬åœ°å›è·¯ Local Loop flashcard\n\nè°ƒåˆ¶è§£è°ƒå™¨ modem: è°ƒåˆ¶å™¨ modulator å’Œ è§£è°ƒå™¨ demodulator çš„ç¼©å†™ï¼Œæ•°å­—ä¿¡æ¯å’Œæ¨¡æ‹Ÿä¿¡å·æµä¹‹é—´çš„è½¬æ¢ã€‚\néå¯¹ç§°ç”¨æˆ·çº¿ ADSL Asymmetric Digital Subscriber Line: ä½¿ç”¨ FDMã€‚åœ¨è¿‡å»ï¼Œæ•´ä¸ªç”µè¯ç³»ç»Ÿä¸­çš„ä¼ è¾“éƒ½æ˜¯æ¨¡æ‹Ÿçš„ï¼Œå®é™…çš„è¯­éŸ³ä¿¡å·ä»¥ç”µå‹çš„å½¢å¼ä»æºç«¯ä¼ è¾“åˆ°æ¥æ”¶æ–¹ã€‚\n\n\n7.2 ä¸­ç»§çº¿ Trunk flashcard\n\nç¼–ç è§£ç å™¨ codec: coder-decoderï¼Œæ¨¡æ‹Ÿä¿¡å·è½¬ä¸ºæ•°å­—ä¿¡å·ï¼Œä½¿ç”¨è„‰å†²ç¼–ç è°ƒåˆ¶ PCM, Pulse Code Modulationã€‚\næ³¢åˆ†å¤ç”¨ WDM, Wavelength Division Multiplexingï¼šæ„Ÿè§‰å’Œé¢‘åˆ†å¤ç”¨å·®ä¸å¤šï¼Œæ¯•ç«Ÿé¢‘ç‡å’Œæ³¢é•¿æ²¡å•¥åŒºåˆ«ã€‚å¯èƒ½ FDM ç”¨æ¥è¯´ç”µï¼ŒWDM ç”¨æ¥è¯´å…‰è¿™ä¸ªæ ·å­ã€‚\n\n\n7.3 äº¤æ¢ Switching flashcard\n\n\nç”µè·¯äº¤æ¢ Circuit Switching:\n\nå…ˆå»ºç«‹è¿æ¥ï¼Œç„¶åç›´æ¥å‘ï¼Œæœ€åé‡Šæ”¾è¿æ¥ï¼›è¿‡ç¨‹ä¸­è·¯å¾„è¢«ç‹¬å ã€‚è·¯å¾„çš„ç»“ç‚¹æ”¶åˆ°å°±ç«‹åˆ»å‘ç»™ä¸‹ä¸€ä¸ªç»“ç‚¹ï¼Œä¸å‚¨å­˜ã€‚\n\n\næŠ¥æ–‡äº¤æ¢ Message Switching\n\nä¸éœ€è¦å»ºç«‹è¿æ¥ã€‚æŠ¥æ–‡æºå¸¦ç›®çš„åœ°å€å’Œæºåœ°å€ï¼Œé€”ä¸­æ¯ä¸ªç»“ç‚¹åœ¨æ”¶åˆ°æ•´ä¸ª message ä»¥åå†æ‰¾ä¸‹ä¸€æ¡è·¯è¿›è¡Œä¼ è¾“ã€‚\nè¿™æ ·å¯ä»¥åŠ¨æ€é€‰æ‹©åˆé€‚ç©ºé—²çš„çº¿è·¯ï¼Œå¢åŠ çº¿è·¯çš„å¯é æ€§å’Œåˆ©ç”¨ç‡ã€‚ä½†æ˜¯ä¼šå¼•èµ·è½¬å‘æ—¶å»¶ï¼Œå¹¶éœ€è¦ç¼“å­˜ç©ºé—´ã€‚\n\n\nåˆ†ç»„äº¤æ¢ / åŒ…äº¤æ¢ Packet Switching\n\nå°†æŠ¥æ–‡åˆç†åˆ†å—ï¼Œå¢åŠ æºå¸¦åˆ†ç»„ç¼–å·ç­‰ä¿¡æ¯ã€‚\nåœ¨æŠ¥æ–‡äº¤æ¢çš„åŸºç¡€ä¸Šï¼Œç¼©çŸ­äº†æ—¶å»¶ï¼Œå‡å°‘äº†æœŸæœ›çš„å‡ºé”™é‡å‘æ•°æ®é‡ï¼ŒåŒæ—¶ç”±äº packet çš„é•¿åº¦æœ‰æ‰€é™åˆ¶ï¼Œå­˜å‚¨ç®¡ç†ä¹Ÿæ–¹ä¾¿äº†å¾ˆå¤šï¼›åŠ¨æ€å¯»æ‰¾çº¿è·¯æ—¶å„ä¸ª packet ä¹Ÿå¯ä»¥é€‰æ‹©ä¸åŒè·¯å¾„ (å› æ­¤ï¼Œpacket çš„æ•°æ®ä¸ä¸€å®šæŒ‰åºåˆ°è¾¾)ã€‚é—®é¢˜æ˜¯é¢å¤–ä¿¡æ¯é‡è¿›ä¸€æ­¥å¢åŠ ï¼Œä¸”å‘é€å‰å’Œæ¥æ”¶åçš„å·¥ä½œé‡ä¹Ÿä¼šå¢åŠ ã€‚\n\n\n"},"è¯¾ç¨‹ç¬”è®°/è®¡ç®—æœºç½‘ç»œ/03-æ•°æ®é“¾è·¯å±‚-the-link-layer":{"slug":"è¯¾ç¨‹ç¬”è®°/è®¡ç®—æœºç½‘ç»œ/03-æ•°æ®é“¾è·¯å±‚-the-link-layer","filePath":"è¯¾ç¨‹ç¬”è®°/è®¡ç®—æœºç½‘ç»œ/03 æ•°æ®é“¾è·¯å±‚ the link layer.md","title":"æ•°æ®é“¾è·¯å±‚ the link layer","links":[],"tags":[],"content":"åªå…³å¿ƒç‚¹åˆ°ç‚¹\næ•°æ®é“¾è·¯å±‚çš„åŠŸèƒ½\nä¸»è¦ä»»åŠ¡\n\nå‘é€æ–¹çš„ç½‘ç»œå±‚å°†æ•°æ®åŒ…å‘ç»™æ•°æ®é“¾è·¯å±‚ï¼Œæ•°æ®é“¾è·¯å±‚é€šè¿‡ç‰©ç†å±‚æä¾›çš„æœåŠ¡å°†æ•°æ®ä¼ è¾“ç»™æ¥æ”¶æ–¹çš„æ•°æ®é“¾è·¯å±‚ï¼Œæ¥æ”¶æ–¹çš„æ•°æ®é“¾è·¯å±‚å†å°†æ•°æ®æä¾›ç»™ç½‘ç»œå±‚ã€‚\nåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ•°æ®é“¾è·¯å±‚éœ€è¦è€ƒè™‘çš„é—®é¢˜æœ‰ï¼š\n\nç‰©ç†å±‚ä¼ è¾“çš„æ˜¯æ¯”ç‰¹æµï¼Œå› æ­¤éœ€è¦åŒºåˆ†ä¸åŒçš„æ•°æ®åŒ…çš„ç•Œé™\nä¼ è¾“è¿‡ç¨‹ä¸­å¯èƒ½å‘ç”Ÿçš„é”™è¯¯\nå‘é€æ–¹å’Œæ¥æ”¶æ–¹å¤„ç†æ•°æ®é€Ÿç‡çš„ä¸åŒ\n\n\n\n\nä¸ºäº†æ–¹ä¾¿è§£å†³è¿™äº›é—®é¢˜ï¼Œæ•°æ®é“¾è·¯å±‚å°†ç½‘ç»œå±‚æä¾›çš„æ¯ä¸ªæ•°æ®åŒ…é€šè¿‡ä¸€äº›å¢åŠ å’Œä¿®æ”¹å°è£…æˆ å¸§ frameï¼ˆä¹Ÿæœ‰å¯èƒ½æ‹†åˆ†å¹¶å°è£…æˆå¤šä¸ªå¸§ï¼‰ï¼Œåœ¨æ¥æ”¶æ–¹çš„æ•°æ®é“¾è·¯å±‚ï¼Œè¿™äº›ä¿®æ”¹è¢«è¿˜åŸã€‚\n\nå¤´éƒ¨ å°¾éƒ¨ä¿¡æ¯\npayload fieldå°±æ˜¯packetå…·ä½“çš„å†…å®¹\n\n\néœ€è¦è¯´æ˜çš„æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥æƒ³è±¡åœ¨ä¸¤ä¸ª host ä¹‹é—´çš„æ•°æ®é“¾è·¯å±‚ç›´æ¥é€šä¿¡ã€‚è¿™æ˜¯å› ä¸ºï¼Œæ•°æ®é“¾è·¯å±‚æ— éœ€å…³å¿ƒç‰©ç†å±‚æ˜¯æ€ä¹ˆä¼ è¾“è¿™äº›ä¿¡æ¯çš„ï¼›è¿™ç§â€œä¸å…³å¿ƒâ€ä¹Ÿæ˜¯æœ‰å¥½å¤„çš„ï¼Œå› ä¸ºè¿™è¯´æ˜ç‰©ç†å±‚ä¿è¯å®ç°æ–¹å¼çš„ä»»ä½•ä¿®æ”¹ä¸ä¼šå½±å“åˆ°æ•°æ®é“¾è·¯å±‚ã€‚\n\næ•°æ®é“¾è·¯å±‚åœ¨å“ªé‡Œå®ç°\n\nè·¯ç”±å™¨routerä¸­çš„çº¿è·¯å¡line card\nå¤§éƒ¨åˆ†åœ¨ä¸»æœºhostçš„ç¡¬ä»¶hardwareä¸Šï¼Œä¸€éƒ¨åˆ†åœ¨ software that runs on the hostâ€™s CPU\nåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œé“¾è·¯å±‚ç”±ç½‘ç»œé€‚é…å™¨network adapterå®ç°ï¼Œæœ‰æ—¶ä¹Ÿç§°ä¸ºç½‘ç»œæ¥å£å¡network interface cardï¼ˆNIC ï¼‰ã€‚\n\nç½‘ç»œé€‚é…å™¨çš„æ ¸å¿ƒæ˜¯é“¾è·¯å±‚æ§åˆ¶å™¨ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªå•ç‹¬çš„ä¸“ç”¨èŠ¯ç‰‡ï¼Œè´Ÿè´£å®ç°è®¸å¤šé“¾è·¯å±‚æœåŠ¡ï¼ˆå¸§ã€é“¾è·¯è®¿é—®ã€æµé‡æ§åˆ¶ã€å·®é”™æ£€æµ‹ç­‰ï¼‰ã€‚\n\n\n\næä¾›ç»™ç½‘ç»œå±‚çš„æœåŠ¡\næ£€é”™åœ¨å“ªä¸ªå±‚éƒ½å¯ä»¥åš,ä½†æ˜¯è¶Šæ™šåšæˆæœ¬è¶Šå¤§.ä½†æ˜¯è¿‡æ—©æ£€é”™æœ¬èº«ä¹Ÿæœ‰ä¸€ä¸ªæˆæœ¬.æ‰€ä»¥å°±è¦å¹³è¡¡æ—©æ™š.\nå› æ­¤æ•°æ®é“¾è·¯å±‚å¯ä»¥æ ¹æ®éœ€è¦è®¾è®¡ä¸åŒçš„åè®®ï¼Œæä¾›çš„å…·ä½“æœåŠ¡æ ¹æ®ä¸åŒçš„åè®®æœ‰æ‰€å·®å¼‚ã€‚\n\nç‰©ç†å±‚æä¾›ç»™æ•°æ®é“¾è·¯å±‚çš„æœåŠ¡æ˜¯å•ä¸€çš„ï¼šå°†å‘é€æ–¹æ•°æ®é“¾è·¯å±‚å‘æ¥çš„å¸§æƒ³åŠæ³•å‘é€ç»™æ¥æ”¶æ–¹çš„æ•°æ®é“¾è·¯å±‚\n\né€šå¸¸ï¼Œæ•°æ®é“¾è·¯å±‚å¯èƒ½ä¼šæä¾›å¦‚ä¸‹ 3 ç§æœåŠ¡ä¹‹ä¸€ï¼š\næ— ç¡®è®¤çš„æ— è¿æ¥æœåŠ¡\nUnacknowledged Connectless Service\nè¿™ç§æœåŠ¡ä¸ä¼šå°è¯•å¯¹ä¸¢å¸§æƒ…å†µè¿›è¡Œæ£€æŸ¥ï¼Œå› æ­¤ä¹Ÿä¸å¯èƒ½è¯•å›¾å¯¹ä¸¢å¤±çš„æ•°æ®è¿›è¡Œæ¢å¤ã€‚è¿™ç§æœåŠ¡é€‚åˆé”™è¯¯ç‡å¾ˆä½çš„æƒ…å†µï¼ˆå¦‚å…‰çº¤ä¼ è¾“ï¼‰ï¼Œæˆ–è€…å³æ—¶é€šè®¯ã€ç›´æ’­ç­‰å¯¹å³æ—¶æ€§è¦æ±‚å¾ˆé«˜ï¼Œä¸”å¶å°”çš„ä¸¢å¤±å’Œé”™è¯¯å…³ç³»ä¸å¤§çš„æƒ…å†µã€‚\næœ‰ç¡®è®¤çš„æ— è¿æ¥æœåŠ¡\nAcknowledged Connectless Service\nè¿™ç§æœåŠ¡å‘é€çš„æ¯ä¸€å¸§éœ€è¦å•ç‹¬ç¡®è®¤ï¼›å¦‚æœå‘é€æ–¹å‘é€ä¸€ä¸ªå¸§ååœ¨æŒ‡å®šçš„æ—¶é—´å†…è¿˜æ²¡æœ‰å¾—åˆ°ç¡®è®¤ï¼Œåˆ™é‡æ–°å‘é€è¯¥å¸§ã€‚é€‚ç”¨äºä¸å¯é ä¿¡é“ï¼Œæ¯”å¦‚æ— çº¿ç³»ç»Ÿï¼ˆ802.11 WiFiï¼‰ã€‚\næœ‰ç¡®è®¤çš„é¢å‘è¿æ¥æœåŠ¡\nAcknowledged Connect-Oriented Service\nè¿™ç§æœåŠ¡åœ¨ä¼ è¾“æ•°æ®å‰åœ¨å‘é€æ–¹å’Œæ¥æ”¶æ–¹ä¹‹é—´å»ºç«‹ä¸€ä¸ªè¿æ¥ï¼Œä¿è¯æ¯ä¸ªå¸§éƒ½æŒ‰åºã€ä¸é‡å¤åœ°è¢«æ¥æ”¶æ–¹æ¥æ”¶ï¼Œä¼ è¾“ç»“æŸåè¿æ¥å’Œç»´æŠ¤è¿æ¥çš„èµ„æºè¢«é‡Šæ”¾ã€‚ä¸ºäº†ä¿è¯æ­£ç¡®æ€§ï¼ŒåŒæ–¹éœ€è¦ç»´æŠ¤ä¸€äº›å˜é‡å’Œè®¡æ•°å™¨ï¼Œè®°å½•å“ªäº›å¸§å·²ç»æ”¶åˆ°ï¼Œå“ªäº›è¿˜æ²¡æœ‰æ”¶åˆ°ã€‚é€‚ç”¨äºé•¿è·ç¦»ä¸”ä¸å¯é çš„é“¾è·¯ï¼Œå¦‚å«æ˜Ÿä¿¡é“å’Œé•¿é€”ç”µè¯ç”µè·¯ã€‚\næˆå¸§\n\næˆå¸§ Framing çš„æ ¸å¿ƒä»»åŠ¡æ˜¯è®¾è®¡ä¸€ç§æ–¹æ¡ˆå°†æ¯”ç‰¹æµåˆ’åˆ†ä¸ºå¸§\n\nä½¿å¾—æ¥æ”¶æ–¹å¾ˆå®¹æ˜“æ‰¾åˆ°æ¯ä¸ªå¸§çš„å¼€å§‹ï¼Œä»è€Œå°†æ¯”ç‰¹æµè¿˜åŸæˆä¸€ä¸ªä¸ªå¸§ï¼›\nåŒæ—¶ä¸èƒ½å ç”¨å¤ªå¤šå¸¦å®½ã€‚\næˆ‘ä»¬è€ƒå¯Ÿ 4 ç§å®šç•Œæ–¹å¼ã€‚\n\n\n\nå­—èŠ‚è®¡æ•°æ³• byte count\n\n\nå¦‚å›¾æ‰€ç¤ºï¼Œè¿™ç§æ–¹å¼åœ¨æ¯ä¸ª frame çš„å¼€å¤´ç”¨ä¸€ä¸ª byte ä¿å­˜è¿™ä¸ª frame çš„ byte æ•°ç›®ã€‚\nä½†æ˜¯å½“è¿™ä¸ªè®¡æ•°å€¼å‡ºç°é”™è¯¯æ—¶ï¼Œå³ä½¿æ¥æ”¶æ–¹é€šè¿‡é”™è¯¯æ£€éªŒå‘ç°äº†é”™è¯¯ï¼Œä¹Ÿå†ä¹Ÿæ— æ³•çŸ¥é“ä¸‹ä¸€å¸§çš„å¼€å§‹ä½ç½®ï¼ˆå¤±å»åŒæ­¥ get out of syncï¼‰ã€‚å› æ­¤ï¼Œå­—èŠ‚è®¡æ•°æ³•ä¸€èˆ¬ä¸ä¼šè¢«é‡‡ç”¨ã€‚\n\næ ‡å¿—å­—èŠ‚æ³• Flag bytes\n\n\nè¿™ç§æ–¹å¼ç”¨ä¸€ä¸ªå›ºå®šçš„ç‰¹æ®Šå­—èŠ‚æ ‡æ˜å¸§çš„å¤´éƒ¨å’Œå°¾éƒ¨ï¼Œå¦‚ä¸Šå›¾ (a)ã€‚è¿™ä¸ªå­—èŠ‚ç§°ä¸º flag byte (FLAG)ã€‚\nå½“ä¼ è¾“çš„æ•°æ®å†…éƒ¨å‡ºç° FLAG æ—¶ï¼Œç”¨ä¸€ä¸ªè½¬ä¹‰å­—èŠ‚ escape byte (ESC) åœ¨å…¶å‰é¢è¿›è¡Œæ ‡è¯†ï¼›åŒæ—¶éœ€è¦å‘é€ ESC æœ¬èº«æ—¶ä¹Ÿåœ¨å…¶å‰é¢å¢åŠ ä¸€ä¸ª ESCï¼Œå¦‚ä¸Šå›¾ (b)ã€‚è¿™ç§æŠ€æœ¯ä¹Ÿç§°ä¸º å­—èŠ‚å¡«å…… byte stuffingã€‚\nä½†æ˜¯å¦‚æœè¦å‘çš„æ•°æ®å…¨éƒ½æ˜¯esc,é‚£å°±ä¼šæœ‰ç™¾åˆ†ä¹‹ç™¾çš„overhead\n\næ ‡å¿—æ¯”ç‰¹æ³• Flag bits\n\n\nè€ƒè™‘åˆ°å¸§çš„åˆ’åˆ†ä¹Ÿå¯ä»¥æ˜¯æ¯”ç‰¹çº§çš„ï¼Œè¿™ç§æ ‡å¿—å’Œå¡«å……ä¹Ÿå¯ä»¥ç²¾ç¡®åˆ°æ¯”ç‰¹çº§ã€‚ä¾‹å¦‚ HDLC çš„æ ‡å¿—æ–¹å¼æ˜¯ï¼šæ¯ä¸ªå¸§çš„å¼€å§‹å’Œç»“æŸç”¨åºåˆ— 01111110 (0x7E è¿ç»­çš„6ä¸ª1) æ ‡è¯†\nåŒæ—¶å‘é€æ–¹çš„æ•°æ®é“¾è·¯å±‚åœ¨æ•°æ®ä¸­æ¯å‘ç°è¿ç»­çš„ 5 ä¸ª 1ï¼Œå‘é€æ—¶å°±åœ¨å…¶åé¢æ·»åŠ ä¸€ä¸ª 0ï¼›æ¥æ”¶æ–¹çš„æ•°æ®é“¾è·¯å±‚åœ¨å‘ç° 111110 æ—¶å°†æœ€åä¸€ä¸ª 0 èˆå¼ƒã€‚è¿™ç§æŠ€æœ¯ç§°ä¸º æ¯”ç‰¹å¡«å…… bit stuffingã€‚\nå³ä½¿å‘çš„å…¨æ˜¯1ä¹Ÿåªæœ‰ç™¾åˆ†ä¹‹äºŒåçš„overhead\nä¸å¤ªå¥½ç”¨è½¯ä»¶(å­—èŠ‚å•ä½)å®ç°,ä½†æ˜¯ç”¨ç¡¬ä»¶å¥½å®ç°\n\nç‰©ç†å±‚ç¼–ç è¿ç¦æ³• Physical layer coding violations\n\nå¯¹äº 4B/5B ç¼–ç æ–¹å¼æˆ–è€… Manchester ç¼–ç ï¼Œæœ‰ç›¸å½“ä¸€éƒ¨åˆ†ä¿¡å·ç»„åˆæ˜¯ä¸å¯èƒ½å‡ºç°çš„ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™æ ·çš„ä¿¡å·ç»„åˆä½œä¸ºå¸§çš„å¼€å§‹å’Œç»“æŸã€‚ç›¸å¯¹äºä¸Šé¢ä¸¤ç§å¡«å……æ–¹æ³•ï¼Œè¿™ç§æ–¹æ³•ä¸å†éœ€è¦å¡«å……æ•°æ®ã€‚IEEE 802 æ ‡å‡†å°±é‡‡ç”¨äº†è¿™ç§æ–¹æ³•ã€‚\nè¿ååˆ†å±‚åŸåˆ™:ä¸‹å±‚æ”¹å˜å®ç°ç»†èŠ‚,ä¸èƒ½å½±å“ä¸Šå±‚è°ƒç”¨.ä½†æ˜¯è¿™ä¸ªæ–¹æ³•çš„è¯å¦‚æœä¸‹å±‚ä¿®æ”¹äº†ç¼–ç æ–¹å¼å°±ä¸è¡Œäº†.ä½†æ˜¯æ€§èƒ½å®åœ¨ä¼˜è¶Šæ‰€ä»¥è¿˜ç®—å¸¸ç”¨\n\næ£€é”™å’Œçº é”™\n\nä¿¡å·åœ¨ä¼ è¾“ä¸­æœ‰å¯èƒ½å‡ºç°é”™è¯¯æˆ–è€…ä¸¢å¤±ã€‚\nç¡®è®¤:å¦‚æœæˆ‘ä»¬éœ€è¦æ’é™¤ä¸¢å¤±çš„æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥åœ¨åè®®ä¸­è¦æ±‚æ¥æ”¶æ–¹åœ¨æ”¶åˆ°å¸§åå‘å›ä¸€ä¸ªç¡®è®¤ï¼›å‘é€æ–¹å¾—åˆ°ç¡®è®¤åæ‰å¯ä»¥å‘ä¸‹ä¸€å¸§ï¼Œå¦‚æœä¸€æ®µæ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°ç¡®è®¤åˆ™éœ€é‡æ–°å‘é€ã€‚\næ£€é”™ä¸çº é”™:å¦‚æœæˆ‘ä»¬éœ€è¦æ’é™¤é”™è¯¯çš„æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•ç›´æ¥å¯¹é”™è¯¯è¿›è¡Œæ¢å¤[æ¯”å¦‚wifi]ï¼›ä¹Ÿå¯ä»¥å°è¯•åªæ£€æŸ¥é”™è¯¯ï¼Œå¦‚æœå‘ç°é”™è¯¯åˆ™è¦æ±‚å‘é€æ–¹é‡ä¼ ã€‚\næ— è®ºæ˜¯çº é”™ç è¿˜æ˜¯æ£€é”™ç éƒ½æ— æ³•å¤„ç†æ‰€æœ‰å¯èƒ½çš„é”™è¯¯ï¼Œå› ä¸ºæä¾›ä¿æŠ¤çš„å†—ä½™ä½ä¸æ•°æ®ä¿¡æ¯ä½ä¸€æ ·ï¼Œæœ‰å¯èƒ½è¢«æ¥æ”¶æˆé”™è¯¯ã€‚\n\nåŸºæœ¬å®šä¹‰å’ŒåŸç†\ncodewordç å­—\nå¦‚æœæƒ³è¦æ£€æŸ¥ä¸€ä¸²æ•°æ®æ˜¯å¦å‡ºç°è¿‡é”™è¯¯ï¼Œæˆ‘ä»¬æ˜¾ç„¶éœ€è¦ä¸€äº›é¢å¤–çš„ä¿¡æ¯ã€‚\n\nå¦‚æœä¸€å¸§æœ‰ m ä¸ªæ•°æ®ä½å­˜å‚¨ä¿¡æ¯\næœ‰ r ä¸ªå†—ä½™ä½ (redundant / check bits) ç”¨æ¥æ ¡éªŒ\né‚£ä¹ˆè¿™ä¸ªåŒ…å«äº†æ•°æ®ä½å’Œå†—ä½™ä½çš„ n = m + r ä½æ•°æ®å—å°±ç§°ä¸ºä¸€ä¸ª n ä½ ç å­— codewordã€‚\n\ncode rate ç ç‡\n\nç ç‡ code rate ä¸º codeword ä¸­æ•°æ®ä½æ‰€å çš„æ¯”ä¾‹ï¼Œå³ m/nã€‚é€šå¸¸åœ¨è¶Šé«˜è´¨é‡çš„ä¿¡é“ä¸Šè®¾è®¡çš„ code rate è¶Šé«˜ï¼Œå› ä¸ºç›¸æ¯”äºæœ‰å™ªå£°çš„ä¿¡é“ï¼Œé«˜è´¨é‡çš„ä¿¡é“é€šå¸¸éœ€è¦æ›´å°‘çš„å†—ä½™ä½ç”¨æ¥æ£€é”™æˆ–çº é”™ã€‚\næ¯”å¦‚å…‰çº¤è¿™ç§å¯èƒ½åªéœ€è¦å¥‡å¶æ ¡éªŒå°±èƒ½æ£€æŸ¥å‡ºæ¥\n\nHamming distance dæµ·æ˜è·ç¦»\n\nä¸¤ä¸ªç­‰é•¿çš„ç å­—ä¸­ä¸ç›¸åŒçš„ä½çš„ä¸ªæ•°ç§°ä¸ºè¿™ä¸¤ä¸ªç å­—çš„ æµ·æ˜è·ç¦» Hamming distance dï¼Œä»£è¡¨ä¸€ä¸ªç å­—éœ€è¦å‡ºç° d ä¸ª 1bit çš„é”™è¯¯æ‰ä¼šå˜æˆå¦ä¸€ä¸ªç å­—ã€‚\n\n\nå¦‚æœæˆ‘ä»¬æƒ³å¯é åœ°æ£€æµ‹å¯èƒ½çš„ e ä¸ªé”™è¯¯ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæµ·æ˜è·ç¦»ä¸º e + 1 çš„ç¼–ç æ–¹æ¡ˆï¼ˆå³ï¼Œä»»æ„ä¸¤ä¸ªåˆæ³•ç å­—ä¹‹é—´çš„è·ç¦»ä¸å°äº e + 1ï¼‰ã€‚**\n\nå› ä¸ºè¿™æ ·ä»»æ„ e ä¸ªé”™è¯¯ä¸å¯èƒ½å°†ä¸€ä¸ªåˆæ³•ç å­—å˜æˆå¦ä¸€ä¸ªåˆæ³•ç å­—**ï¼›\nå½“æˆ‘ä»¬å‘ç°ä¸€ä¸ªéæ³•ç å­—æ—¶ï¼Œæˆ‘ä»¬å°±çŸ¥é“å‡ºç°äº†é”™è¯¯ã€‚\n\n\nå¦‚æœæˆ‘ä»¬æƒ³å¯é åœ°çº æ­£å¯èƒ½çš„ e ä¸ªé”™è¯¯ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæµ·æ˜è·ç¦»ä¸º 2e + 1 çš„ç¼–ç æ–¹æ¡ˆã€‚\n\nå› ä¸ºè¿™æ ·ä»»æ„çš„ e ä¸ªé”™è¯¯å‘ç”Ÿåï¼ŒåŸæ¥çš„ç å­—ä»ç„¶æ˜¯ç¦»ç°åœ¨çš„ç å­—è·ç¦»æœ€è¿‘çš„é‚£ä¸€ä¸ªã€‚\n\n\n\n\næµ·æ˜è·ç¦»ä¸º3çš„ç¼–ç æ–¹æ¡ˆ,å¯ä¸å¯ä»¥çº æ­£1ä¸ªå¯èƒ½é”™è¯¯çš„åŒæ—¶æ£€æµ‹å¯èƒ½çš„2ä¸ªé”™è¯¯? ä¸èƒ½\n\nå…¶ä»–æ¦‚å¿µ\nçº é”™ç æ–¹æ¡ˆçš„ä¸åŒç‰¹å¾:\n\n\nå—ç  block code æ˜¯æŒ‡ r ä¸ªæ ¡éªŒä½æ˜¯ç”± m ä¸ªæ•°æ®ä½æŒ‰å—å¤„ç†å¾—åˆ°çš„,ä¸€æ¬¡æ€§æ‹¿åˆ°mä¸ªæ•°æ®,è¾“å‡ºnä¸ªç å­—.\n\n\nç³»ç»Ÿç  systematic code æ˜¯æŒ‡æ•°æ®ä½å’Œæ ¡éªŒä½æ˜¯åˆ†å¼€è€Œæ²¡æœ‰äº¤å‰çš„ï¼›åœ¨æœ€ç»ˆçš„nä½ç å­—ä¸­,æ•°æ®æœ¬èº«æ˜¯ä¸è¢«æ”¹å˜çš„\n\n\nçº¿æ€§ç  linear code æ ¡éªŒä½æ˜¯å¯¹æ•°æ®ä½åšçº¿æ€§ç»„åˆå¾—åˆ°çš„\næ¯”å¦‚æ±‰æ˜ç å°±åŒæ—¶æ»¡è¶³ä¸Šè¿°ä¸‰ç§ç‰¹å¾.\n\n\nç°å®ä¸­å¸¸è§çš„é”™è¯¯æœ‰ä¸¤ç§ã€‚\n\n\n\nç¬¬ä¸€ç§æ˜¯å¶ç°çš„é—®é¢˜å¯¼è‡´å•ä¸ªæ¯”ç‰¹é”™è¯¯ï¼›\nå¦ä¸€ç§æ˜¯çªå‘çš„é—®é¢˜å¯¼è‡´ä¸€æ®µä¿¡æ¯å‘ç”Ÿé”™è¯¯ï¼ˆä¸ä¸€å®šæ¯ä¸ªæ¯”ç‰¹éƒ½å‘ç”Ÿé”™è¯¯ï¼‰ã€‚\nå…¶ä»–ç±»å‹é”™è¯¯ \n\nçº é”™ç \n\né™¤äº†å·ç§¯ç æ˜¯çº¿æ€§ç ä¸æ˜¯å—ç ä»¥å¤–ï¼Œå…¶ä»–ä¸‰ç§ç¼–ç éƒ½æ˜¯çº¿æ€§å—ç ã€‚\nçº é”™ç å¹¿æ³›è¿ç”¨äºæ— çº¿é“¾è·¯ã€‚æ— çº¿é“¾è·¯å®¹æ˜“å‡ºé”™ï¼Œå¦‚æœæ²¡æœ‰çº é”™ç å¾ˆå¯èƒ½è·å¾—ä¸åˆ°ä»»ä½•å®Œå…¨æ­£ç¡®çš„ä¿¡æ¯ã€‚å¦å¤–å¯¹äºå•å·¥ä¿¡é“(å¹¿æ’­ç«™)çš„æƒ…å†µï¼Œæ¥æ”¶æ–¹å¦‚æœæ£€æµ‹åˆ°äº†é”™è¯¯ä¹Ÿæ²¡æœ‰åŠæ³•å‘å›ä¸€ä¸ªé‡å‘è¯·æ±‚ï¼Œå› æ­¤ä¹Ÿé€‚ç”¨çº é”™ç ã€‚\n\næµ·æ˜ç  Hamming codes\n\nå‡è®¾æˆ‘ä»¬éœ€è¦è®¾è®¡ä¸€ç§ç¼–ç æ–¹æ¡ˆï¼Œæ¯ä¸ªç å­—æœ‰ m ä¸ªä¿¡æ¯ä½å’Œ r ä¸ªå†—ä½™ä½ï¼Œå¹¶ä¸”èƒ½å¤Ÿçº æ­£æ‰€æœ‰çš„ 1bit é”™è¯¯ã€‚åŠ èµ·æ¥åº”è¯¥æ˜¯nä½(m+r)\né‚£ä¹ˆå¯¹äº 2^m ç§åˆæ³•çš„ä¿¡æ¯(å› ä¸ºmä½ä¿¡æ¯)ï¼Œæ¯ä¸ªä¿¡æ¯éƒ½åº”å”¯ä¸€å¯¹åº” n ä¸ªéæ³•ç å­—ï¼Œå®ƒä»¬ä¸è¯¥ä¿¡æ¯çš„è·ç¦»ä¸º 1ã€‚\n\nnç§é”™è¯¯æƒ…å†µ+è‡ªå·±æœ¬èº«1ç§åˆæ³•æƒ…å†µ=n+1ç§æƒ…å†µ,æ˜¯å½’ç»™åˆæ³•ä¿¡æ¯ç®¡è¾–.å› ä¸º1bité”™è¯¯,æ‰€ä»¥è·ç¦»ä¸º1\nå¦‚æœ2ä½:\nè¦æ³¨æ„çš„æ˜¯,æ˜¯ä¸€ä¸²ç å­—è¡¨ç¤ºä¸€ä¸ªä¿¡æ¯,è€Œä¸æ˜¯ä¸€ä¸ªä½è¡¨ç¤ºä¸€ä¸ªä¿¡æ¯.\n\n\nå› æ­¤è¿™é‡Œå°±å…±æœ‰ (n+1)2^m ç§æƒ…å†µï¼Œå› æ­¤æœ‰ (n+1)2^mâ‰¤2^nï¼Œäº¦å³ (m+r+1)â‰¤2^rã€‚åœ¨ m ç»™å®šçš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸€ä¸ç­‰å¼ç¡®å®š r çš„ä¸‹ç•Œ[è‡³å°‘è¦å¤šå°‘ä¸ªå†—ä½™ä½æ‰èƒ½å¤Ÿæ»¡è¶³æ¡ä»¶]ã€‚æµ·æ˜ç ç»™å‡ºäº†è¿™ä¸€ä¸‹ç•Œçš„ä¸€ä¸ªè·å¾—æ–¹å¼ã€‚ç¼–ç æ–¹å¼è§ä¸‹å›¾ã€‚\n\n2çš„å¹‚æ¬¡æ–¹ä½ç½®ä¸Šæœ‰1çš„æ•°è¿›è¡Œå¼‚æˆ–,æ­£å¥½å¾—åˆ°1101.å†è·Ÿé2çš„å¹‚æ¬¡æ–¹ä½ç½®çš„æ•°å­—å¼‚æˆ–,ä¸€å®šå¾—åˆ°0[è‡ªå·±å¼‚æˆ–è‡ªå·±]\nå¦‚æœä¸æ˜¯0,ç–‘æƒ‘å¾—åˆ°çš„ç»“æœå°±æ˜¯é”™è¯¯çš„å“ªä¸€ä½.è°ç¿»è½¬äº†,å¼‚æˆ–çš„æ—¶å€™å°±ä¼šéœ²å‡ºé©¬è„š\n\nä¸€èˆ¬è§åˆ°çš„æ˜¯å¶æ ¡éªŒæµ·æ˜ç ,å¥‡æ ¡éªŒæµ·æ˜ç å°±æ˜¯å¼‚æˆ–å®Œä¹‹ååä¸€ä¸‹å†å¡«åˆ°2çš„å¹‚æ¬¡æ–¹ä½ç½®\nå·ç§¯ç  convolutional codes\n\n\n\nå·ç§¯ç çš„è¾“å‡ºç”±å½“å‰è¾“å…¥å’Œä¹‹å‰è‹¥å¹²ä½è¾“å…¥å†³å®šï¼Œå½±å“å½“å‰è¾“å‡ºçš„æ­¤å‰è¾“å…¥ä½æ•°ç§°ä¸º çº¦æŸé•¿åº¦ constraint lengthã€‚\n\n\nå¦‚å›¾è¿™ç§å·ç§¯ç çš„çº¦æŸé•¿åº¦ä¸º 6[å°±æ˜¯å›¾ä¸Šçš„s1~6]ï¼Œæ¯ä¸ªè¾“å‡º bit ä¼šå¸¦æ¥ 2 bits çš„è¾“å‡ºï¼Œ\n\nå…¶ä¸­ç¬¬ä¸€ä¸ªæ˜¯ç¬¬ 0, 2, 3, 5, 6 ä½çš„æ¨¡äºŒåŠ æ³•[å°±æ˜¯å¼‚æˆ–]ï¼ˆ0 æŒ‡è¾“å…¥ä½ï¼Œ16 æŒ‡ S1S6 çš„å€¼ï¼‰ï¼Œ\nç¬¬äºŒä¸ªæ˜¯ç¬¬ 0, 1, 2, 3, 6 ä½çš„æ¨¡äºŒåŠ æ³•ã€‚\n\n\n\næ¯”å¦‚è¾“å…¥åºåˆ—ä¸º 111ï¼Œè¾“å…¥ç¬¬ä¸€ä¸ª 1 æ—¶ 06 ä½æ˜¯ 1000000ï¼Œå› æ­¤è¾“å‡ºæ˜¯ 11ï¼Œç„¶å S1S6 å³ç§»ä¸€ä½å˜æˆ 100000ï¼›è¾“å…¥ç¬¬äºŒä¸ª 1 æ—¶ä¸º 1100000ï¼Œå› æ­¤è¾“å‡ºæ˜¯ 10ï¼›è¾“å…¥ç¬¬ä¸‰ä¸ª 1 æ—¶ä¸º 1110000ï¼Œå› æ­¤è¾“å‡ºæ˜¯ 01ã€‚å› æ­¤ç¼–ç åä¸º 111001ã€‚\n\n\nä¸€ä¸ªè¾“å…¥ç å¯ä»¥å¾—åˆ°ä¸¤ä¸ªè¾“å‡ºç»“æœ,3bitå¯ä»¥å¾—åˆ°6bitçš„å†—ä½™æ•°æ®.\n\n\nå·ç§¯ç çš„è§£ç æ˜¯é€šè¿‡æœ€å¤§ä¼¼ç„¶æ³•ã€‚åœ¨æ‰€æœ‰å¯èƒ½çš„è¾“å‡ºåºåˆ—ä¸­æ‰¾å‡ºä¸æ¥æ”¶åˆ°çš„åºåˆ—æœ€ç›¸è¿‘çš„é‚£ä¸€ä¸ªï¼Œè§£ç ä¸ºè¿™ä¸ªåºåˆ—å¯¹åº”çš„è¾“å…¥åºåˆ—ã€‚\n\n\n\n\n\né‡Œæ‰€ç½—é—¨ç  Reed-Solomon codes\nä½å¯†åº¦å¥‡å¶æ ¡éªŒç  LDPC, Low-Density Parity Check\næ£€é”™ç \n\nå…‰çº¤å’Œé«˜å“è´¨é“œçº¿çš„é”™è¯¯ç‡è¾ƒä½ï¼Œå› æ­¤å¯¹å¶ç°çš„é”™è¯¯è¿›è¡Œæ£€é”™å’Œé‡ä¼ æ›´åŠ æœ‰æ•ˆã€‚ä¸‹é¢ä»‹ç»ä¸‰ç§æ£€é”™ç ï¼Œå®ƒä»¬éƒ½æ˜¯çº¿æ€§çš„ç³»ç»Ÿå—ç ã€‚\n\nå¥‡å¶æ ¡éªŒä½ parity bit\n\nn-1 ä½ä¿¡æ¯ï¼Œ1 ä½å†—ä½™ã€‚\n\nå¥‡æ ¡éªŒç ï¼šåœ¨åŠ ä¸Šè¯¥ä½å ,1çš„ä¸ªæ•°ä¸ºå¥‡æ•°ï¼›\nå¶æ ¡éªŒç :  åœ¨åŠ ä¸Šè¯¥ä½å,1çš„ä¸ªæ•°åˆ™ä¸ºå¶æ•°ã€‚\n\n\näº¤é”™æ ¡éªŒ interleaving æŠ€æœ¯å¯ä»¥ä¸€å®šç¨‹åº¦ä¸Šé˜²æ­¢çªå‘çš„è‹¥å¹²æ¯”ç‰¹èŒƒå›´å†…[å¦‚æœå‘ç”Ÿå¶æ•°ä¸ªåè½¬,å°±æ£€æµ‹ä¸å‡ºæ¥äº†]çš„é”™è¯¯ã€‚å°†æ•°æ®å—ä½œä¸º k è¡Œ n åˆ—å¤„ç†ï¼Œæ¯åˆ—è®¡ç®—ä¸€ä¸ª parity bit åé™„åœ¨æ•°æ®å—æœ€åå‘é€ã€‚è¿™æ ·é™¤éçªå‘é”™è¯¯æŒç»­ n ä¸ª bit ä»¥ä¸Šï¼Œå¦åˆ™ä»ç„¶å¯ä»¥è¢«æ£€æµ‹å‡ºæ¥ã€‚\næ¨ªç€å‘,ç«–ç€éªŒ,å¯ä»¥é¿å…ä¸€è¡Œè¿ç»­é”™è¯¯.è¿™é‡Œè€ƒè™‘çš„æ˜¯å•æ¬¡å¹²æ‰°,ä¸è€ƒè™‘ä¸€ä¸ªé”™äº†ä¹‹åéš”äº†nä¸ªåˆé”™ä¸€ä¸ªçš„è¿™ç§æƒ…å†µ\n\næ ¡éªŒå’Œ checksum\n\nå¯¹æ•°æ®è¿›è¡Œä¸€äº›æ±‚å’Œè¿ç®—ã€‚ç„¶åå¾—åˆ°ç»“æœå,åˆ°é‚£è¾¹çœ‹çœ‹ç»“æœè¿˜ä¸€ä¸ä¸€æ ·.\n\nå¥‡å¶æ ¡éªŒä½ä¹Ÿå¯ä»¥çœ‹åšæ ¡éªŒå’Œçš„ä¸€ä¸ªä¾‹å­ã€‚\n\n\nå¦ä¸€ä¸ªå®é™…ä¾‹å­æ˜¯ Internet Checksumã€‚è§„åˆ™æ˜¯ï¼š\n\né¦–å…ˆå°†æ•°æ®åˆ†å‰²æˆ 16 bit çš„è‹¥å¹²æ®µï¼ˆæœ€åä¸€æ®µä¸è¶³ 16 bit åˆ™åœ¨æœ«å°¾è¡¥ 0ï¼‰ï¼›\nç„¶åå°†è¿™äº›æ®µç›¸åŠ ï¼Œæœ€é«˜ä½è¿›ä½ wrap around[æœ€é«˜ä½çš„è¿›ä½å†åŠ å›æœ€ä½ä½]\næœ€åå°†ç»“æœæŒ‰ä½å–å (?) ä½œä¸ºæ ¡éªŒã€‚\næ£€æŸ¥æ—¶å†æ¬¡è®¡ç®—æ•°æ®ä¹‹å’Œï¼ŒåŠ ä¸Šæ ¡éªŒï¼Œå¦‚æœç»“æœä¸ä¸ºå…¨ 1 åˆ™å‘ç”Ÿè¿‡é”™è¯¯ã€‚[å–åä¹‹ååŠ ä¸ŠåŸæ•°å­—,å½“ç„¶å…¨ä¸º1äº†] [å¦‚æœä¼ è¾“è¿‡ç¨‹ä¸­å“ªä¸ªä½ç¿»è½¬äº†,é‚£ä¹ˆå½“ç„¶ç ´åäº†å®Œç¾çš„äº’è¡¥]\n\n\nè§£é‡Š wrap-around carry bit (src)\n\n1001+1100=10101=0101+1=0110\n0110+1010=0001\n0001+0011=0100 è¿™ä¸ªå¾—åˆ°çš„å°±å«checksum,ä½†æ˜¯æ”¾åˆ°å¸§é‡Œå»ç”¨çš„æ—¶å€™éœ€è¦å–å\n\nå¾ªç¯å†—ä½™ç  CRC, Cyclic Redundancy Code\n\nåˆç§° å¤šé¡¹å¼ç  polynomial codeï¼Œè®¡ç®—æ–¹å¼è§ä¸‹å›¾ã€‚å…¶ä¸­ G(x) æ˜¯å‘é€æ–¹å’Œæ¥æ”¶æ–¹é¢„å…ˆå•†å®šçš„ä¸€ä¸ªå¤šé¡¹å¼ï¼Œç§°ä¸º ç”Ÿæˆå¤šé¡¹å¼ generator polynomialï¼Œå…¶æœ€é«˜ä½å’Œæœ€ä½ä½ä¸€å®šæ˜¯ 1ã€‚\n\nå°†é™¤æ•°è½¬æ¢æˆå¤šé¡¹å¼,nä½é™¤æ•°,æœ€é«˜æ¬¡é¡¹å°±æ˜¯n-1,ç„¶åç»™è¢«é™¤æ•°æœ«å°¾æ·»ä¸Šn-1ä¸ª0.ç„¶åæ­£å¼å¼€å§‹é™¤æ³•ä¹‹å,åŠ æ³•å’Œå‡æ³•å…¨éƒ½è§†ä¸ºå¼‚æˆ–è¿›è¡Œè®¡ç®—.\n\n\nç”±äºæ¨¡ 2 é™¤æ³•çš„ä¸€äº›æ€§è´¨ï¼Œè¿™ç§æ–¹æ³•æœ‰ä¼˜ç§€çš„æ£€æµ‹èƒ½åŠ›ï¼Œå…·ä½“å¯ä»¥å‚çœ‹ä¸­æ–‡è¯¾æœ¬ 166~167 é¡µã€‚\n\n\n\n                  \n                  ä¾‹é¢˜ \n                  \n                \n\n\nä¸€ä¸ªæ¯”ç‰¹æµ 10011101 ä½¿ç”¨æ–‡ä¸­æè¿°çš„æ ‡å‡† CRC æ–¹æ³•è¿›è¡Œä¼ è¾“ã€‚ç”Ÿæˆå¤šé¡¹å¼ä¸º x^3 + 1ã€‚\nå±•ç¤ºå®é™…ä¼ è¾“çš„æ¯”ç‰¹ä¸²ã€‚\nå‡è®¾åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ï¼Œä»å·¦è¾¹æ•°çš„ç¬¬ 3 ä¸ªæ¯”ç‰¹å‘ç”Ÿäº†åè½¬ï¼ˆ0å˜1ï¼Œæˆ–1å˜0ï¼‰ã€‚è¯æ˜æ¥æ”¶ç«¯èƒ½æ£€æµ‹å‡ºè¿™ä¸ªé”™è¯¯ã€‚\nç»™å‡ºä¸€ä¸ªæ¥æ”¶ç«¯æ— æ³•æ£€æµ‹åˆ°çš„æ¯”ç‰¹é”™è¯¯ç¤ºä¾‹ã€‚\n\n\n\nå®é™…ä¼ è¾“çš„æ¯”ç‰¹ä¸² = åŸå§‹æ•°æ® + ä½™æ•° = 10011101 + 100 = 10011101100.\n\nä¹Ÿå°±æ˜¯è¯´ æœ€ç»ˆçš„æ¯”ç‰¹ä¸²æ˜¯å¯ä»¥æ•´é™¤é™¤æ•°çš„.é‚£ä¹ˆå‘ç”Ÿäº†é”™è¯¯ä¹‹åè‡ªç„¶ä¸èƒ½æ•´é™¤.\n\n\nå¦‚æœæ¯”ç‰¹ä¸²é”™è¯¯çš„éƒ¨åˆ†æ­£å¥½å¯ä»¥ç¬¦åˆæ•´æ•°å€é™¤æ•°,é‚£å°±ä¸èƒ½è¢«æ£€æµ‹å‡ºæ¥\n\n\n\næµé‡æ§åˆ¶ä¸ä¸€äº›åŸºæœ¬åè®®\nè€ƒè™‘å•å·¥åœç­‰åè®®:å•å·¥simplex,åœç­‰stop and wait\nè¿™é‡Œçš„å•å·¥æ˜¯åªå‘æ¶ˆæ¯,é‚£è¾¹å¾€å›å‘ä¸€ä¸ªç¡®è®¤,å‘é€æ–¹å¾—åˆ°ç¡®è®¤åæ‰ä¼šå‘ä¸‹ä¸€ä¸ªå¸§.\nä¸€äº›å•å·¥åè®®\nä¸€ä¸ªä¹Œæ‰˜é‚¦å¼çš„å•å·¥åè®®\nA Utopian Simplex Protocol\n\nå‘é€æ–¹ä¸æ–­åœ°ä»ç½‘ç»œå±‚è·å–æ•°æ®åŒ…å¹¶æ„é€ ä¸€ä¸ªå¸§ï¼Œé€šè¿‡ç‰©ç†å±‚å‘é€è¯¥å¸§ï¼›\næ¥æ”¶æ–¹ä¸æ–­ç­‰å¾…å”¯ä¸€å¯èƒ½çš„äº‹ä»¶ FRAME_ARRIVAL å‘ç”Ÿï¼Œå°†è¯¥å¸§ä»ç‰©ç†å±‚å–å¾—ï¼Œå¤„ç†åå°†æ•°æ®éƒ¨åˆ†å‘é€ç»™ç½‘ç»œå±‚ã€‚è¿™ç§æ–¹æ¡ˆçš„é—®é¢˜æ˜¯ï¼Œå¦‚æœå‘é€æ–¹å‘é€å¸§çš„é€Ÿåº¦å¤§äºæ¥æ”¶æ–¹å¤„ç†çš„é€Ÿåº¦ï¼Œæ¥æ”¶æ–¹å°±ä¼šè¢«æ·¹æ²¡ (flood)ã€‚\n\næ— é”™ä¿¡é“ä¸Šçš„å•å·¥åœ-ç­‰åè®®\nA Simplex Stop-and-Wait Protocol for an Error-Free Channel\n\næ¥æ”¶æ–¹æ¯å½“æ¥æ”¶ä¸€ä¸ªå¸§å¹¶å¤„ç†å®Œæˆåï¼Œå‘å›ä¸€ä¸ªç¡®è®¤å¸§ï¼›\nå‘é€æ–¹åœ¨æ”¶åˆ°ç¡®è®¤å¸§åï¼ˆä¸éœ€è¦å¤„ç†ï¼Œå› ä¸ºæ­¤æ—¶å”¯ä¸€çš„å¯èƒ½å°±æ˜¯ç¡®è®¤å¸§ï¼‰ï¼Œåˆ™å¯ä»¥å‘é€ä¸‹ä¸€å¸§ã€‚è¿™ç§åè®®åœ¨æ•°æ®ä¼ è¾“ä¸Šæ˜¯å•å·¥[å‘â€æ•°æ®æ¶ˆæ¯â€ç¡®å®æ˜¯å•å‘çš„]çš„ï¼Œä½†æ˜¯æ¥æ”¶æ–¹éœ€è¦å‘å›æ¶ˆæ¯ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨åŠåŒå·¥ä¿¡é“ã€‚\nè¿™ç§æ–¹æ¡ˆçš„å®é™…é—®é¢˜åœ¨äºï¼Œæ²¡æœ‰è€ƒè™‘å‡ºç°é”™è¯¯çš„æƒ…å†µã€‚\n\næœ‰é”™ä¿¡é“ä¸Šçš„å•å·¥åœ-ç­‰åè®®\nA Simplex Stop-and-Wait Protocol for a Noisy Channel\nè¿™ç§åè®®åœ¨ä¸Šä¸€ç§çš„åŸºç¡€ä¸Šè€ƒè™‘ 3 ç§å¯èƒ½çš„é”™è¯¯\n\næ¥æ”¶åˆ°çš„å¸§æ£€å‡ºé”™è¯¯\n\nä¸ºäº†è§£å†³ç¬¬ 1 ç§é”™è¯¯ï¼Œæˆ‘ä»¬å¼•å…¥ä¸€ä¸ªæ–°çš„äº‹ä»¶ CKSUM_ERR è¡¨ç¤ºæ ¡éªŒå’Œæœ‰è¯¯ï¼›\nå› è€Œæ¥æ”¶æ–¹åœ¨æ”¶åˆ°ä¸€ä¸ªå¸§ååº”å½“æ ¡éªŒæ­£ç¡®æ€§ï¼Œå‘å›ä¸€ä¸ªè¡¨ç¤ºæ­£ç¡®æˆ–è€…é”™è¯¯çš„ç¡®è®¤å¸§ï¼›\nå¦‚æœæ£€å‡ºé”™è¯¯ï¼Œåˆ™ç›´æ¥æŠ›å¼ƒè¯¥å¸§ç­‰å¾…é‡ä¼ ã€‚å¦‚æœå‘é€æ–¹æ”¶åˆ°äº†è¡¨ç¤ºé”™è¯¯çš„ç¡®è®¤å¸§å¯¼è‡´äº‹ä»¶ CKSUM_ERR å‘ç”Ÿï¼Œé‚£ä¹ˆå‘é€æ–¹å°†é‡æ–°å‘é€ä¸Šä¸€å¸§ã€‚\n\n\nå‘é€æ–¹å‘é€çš„å¸§å®Œå…¨ä¸¢å¤±\n\nå¯¹äºç¬¬ 2 ç§é”™è¯¯ï¼Œæ¥æ”¶æ–¹å®Œå…¨æ²¡æœ‰æ¥åˆ°ä¸€ä¸ªå¸§ï¼Œå› è€Œä¹Ÿä¸å¯èƒ½å¯¹æ­¤ä½œå‡ºç¡®è®¤ã€‚\nä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œå‘é€æ–¹æ¯æ¬¡å‘é€ä¸€ä¸ªå¸§åå¯åŠ¨æˆ–é‡ç½®ä¸€ä¸ªè®¡æ—¶å™¨ï¼Œè¿™ä¸ªè®¡æ—¶å™¨çš„æ—¶é—´åº”å½“é•¿äºé¢„æœŸæ­£å¸¸æƒ…å†µä¸‹æ”¶åˆ°ç¡®è®¤å¸§çš„æ—¶é—´ã€‚\nå¦‚æœè®¡æ—¶å™¨è¶…æ—¶å‘é€æ–¹ä»æœªæ”¶åˆ°ç¡®è®¤å¸§ï¼ˆäº‹ä»¶ TIMEOUTï¼‰ï¼Œé‚£ä¹ˆç¬¬ 2 ç§é”™è¯¯æœ‰å¯èƒ½å‘ç”Ÿï¼Œæ­¤æ—¶å‘é€æ–¹ä¼šå°†ï¼ˆç¼“å­˜ä¸‹æ¥çš„ï¼‰åˆšåˆšå‘å‡ºå»çš„é‚£ä¸€å¸§é‡æ–°å‘å‡ºä¸€æ¬¡ã€‚\nç›´è‡³å‘é€æ–¹æ”¶åˆ°ä¸€ä¸ªç§¯æçš„ç¡®è®¤å¸§ï¼Œæ­¤æ—¶å‘é€æ–¹å†åŠ è½½ä¸‹ä¸€å¸§ï¼Œä¸Šä¸€å¸§çš„ç¼“å­˜å³å¯ä»¥è¢«è¦†ç›–æ‰ã€‚\n\n\næ¥æ”¶æ–¹çš„ç¡®è®¤å¸§ä¸¢å¤±\n\nä½†æ˜¯éœ€è¦è€ƒè™‘çš„æ˜¯ï¼Œé™¤äº†ç¬¬ 2 ç§é”™è¯¯ï¼Œè¿™ç§é—®é¢˜ä¹Ÿå¯èƒ½å¯¼è‡´å‘é€æ–¹æ²¡æœ‰æ”¶åˆ°ç¡®è®¤å¸§ï¼Œå› æ­¤å¯èƒ½ä¼šå°†ä¸€ä¸ªæ­£ç¡®æ”¶åˆ°ï¼ˆæ²¡æœ‰è¢«æŠ›å¼ƒï¼‰çš„å¸§é‡å‘ï¼Œå¯¼è‡´æ¥æ”¶æ–¹æ”¶åˆ°ä¸¤ä¸ªè¯¥å¸§ï¼›å¦‚æœä¸åŠ é™åˆ¶ï¼Œæ¥æ”¶æ–¹çš„ç½‘ç»œå±‚åˆ™å¯èƒ½æ”¶åˆ°é‡å¤ä¸¤æ¬¡çš„è¯¥æ•°æ®æ®µï¼Œå¼•èµ·é”™è¯¯ã€‚\næˆ‘ä»¬éœ€è¦é˜²æ­¢è¿™ç§é‡å¤çš„å‘ç”Ÿã€‚è€ƒè™‘åˆ°å‘é€æ–¹å‘é€ç¬¬ i + 1 å¸§çš„å……è¦æ¡ä»¶æ˜¯ç¬¬ i å¸§å·²ç»æ”¶åˆ°äº†æ­£ç¡®çš„ç¡®è®¤ï¼Œè€Œè¿™ä¸€ç¡®è®¤çš„å¿…è¦æ¡ä»¶æ˜¯æ¥æ”¶æ–¹å·²ç»æ­£ç¡®æ”¶åˆ°äº†ç¬¬ i å¸§ã€‚å› æ­¤æˆ‘ä»¬åªéœ€è®°å½•æ¯ä¸€å¸§åºå·çš„å¥‡å¶æ€§ï¼Œå¹¶å°†å…¶åŒ…å«åœ¨å¸§å¤´ä¸­ï¼ˆç§°ä¸ºå­—æ®µ seq ï¼‰ã€‚\nå¦‚æœæ¥æ”¶æ–¹æ¥æ”¶åˆ°äº†é¢„æœŸçš„ï¼ˆä¸å‰ä¸€å¸§ç›¸åçš„ï¼‰å¥‡å¶æ ‡è®°ï¼Œé‚£ä¹ˆå°±å°†å…¶ä¿å­˜ï¼›å¦åˆ™å°±è¯´æ˜å‰ä¸€å¸§è¢«é‡å¤å‘é€äº†ï¼Œæ­¤æ—¶åˆ™ç›´æ¥æŠ›å¼ƒè¯¥å¸§ï¼ŒåŒæ—¶å‘å›ä¸€ä¸ªç¡®è®¤ï¼ˆä½œä¸ºå¯¹å‰ä¸€ä¸ªä¸¢å¤±ç¡®è®¤å¸§çš„è¡¥å……ï¼‰ã€‚\n\n\n\n\nè¿™ç§åœ¨æ¥æ”¶åˆ°è‚¯å®šç¡®è®¤ä¹‹å‰å®šæ—¶é‡ä¼ çš„åè®®ä¹Ÿç§°ä¸º è‡ªåŠ¨é‡å¤è¯·æ±‚ ARQ, Automatic Repeat reQuest æˆ– å¸¦é‡ä¼ çš„è‚¯å®šç¡®è®¤ PAR, Positive Acknowledgement with Retransmissionã€‚\n\næå¸¦ç¡®è®¤ piggybacking\n\néœ€è¦æ³¨æ„çš„ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œå‰é¢ä¸¤ç§å¸¦æœ‰ç¡®è®¤çš„åè®®éƒ½éœ€è¦ä½¿ç”¨åŠåŒå·¥ä¼ è¾“ï¼Œè€Œè¿™ç§ä¼ è¾“å’Œå…¨åŒå·¥ä¼ è¾“ä¸€æ ·éƒ½éœ€è¦å¾€è¿”ä¸¤æ¡ä¿¡é“ï¼›å› æ­¤å®é™…ä¸ŠåŒä¸€æ¡é“¾è·¯æœ€å¥½ç”¨æ¥å¾€è¿”ä¼ è¾“æ•°æ®ã€‚è¿™ç§æƒ…å†µä¸‹ï¼ŒæŸä¸€å¸§çš„æ¥æ”¶æ–¹å°±å¯ä»¥æŠŠè¯¥å¸§çš„ç¡®è®¤åŒ…å«åœ¨å®ƒå‘å›çš„å¦ä¸€å¸§çš„å¸§å¤´ä¸­ï¼Œè¿™ç§æ–¹å¼å°±ç§°ä¸ºæå¸¦ç¡®è®¤[é©®è¿]ã€‚\næå¸¦ç¡®è®¤å¼•å…¥çš„å¦ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œéœ€è¦å‘å›ç¡®è®¤çš„é‚£ä¸€æ–¹å¹¶ä¸çŸ¥é“ç½‘ç»œå±‚ä»€ä¹ˆæ—¶å€™ä¼šè®©å®ƒå‘é€ä¸‹ä¸€ä¸ªæ•°æ®åŒ…ï¼Œä»¥ä¾¿å®ƒå°†ç¡®è®¤åŒ…å«åœ¨å…¶å¸§å¤´ä¸­ï¼ˆç§°ä¸ºå­—æ®µ ackï¼‰ã€‚[æ‰“ä¸åˆ°è½¦]\n\nä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå‘å›ç¡®è®¤çš„é‚£ä¸€æ–¹ä¹Ÿå¯ä»¥è®¾ç½®ä¸€ä¸ªè®¡æ—¶å™¨ï¼Œåœ¨è®¡æ—¶å™¨ç»“æŸå‰å¦‚æœç½‘ç»œå±‚äº¤ä»˜äº†ä¸€ä¸ªæ•°æ®åŒ…è®©å®ƒå‘é€ï¼Œé‚£ä¹ˆå°±å°†ç¡®è®¤åŒ…å«åœ¨å…¶ä¸­ï¼›å¦åˆ™å°±ç›´æ¥å‘é€ä¸€ä¸ªå•ç‹¬çš„ç¡®è®¤å¸§ã€‚\n\n\nä¸€ä¸ªæå¸¦ç¡®è®¤çš„åŒå·¥åœ-ç­‰åè®®\n\næ”¶åˆ°0 å°±å‘ä¸€ä¸ªack0è¡¨ç¤ºå¸Œæœ›ä¸‹ä¸€ä¸ªæ˜¯1\n\n\n\næ»‘åŠ¨çª—å£åè®® Sliding Window Protocols\nåŸºæœ¬æ€æƒ³\n\nåœ¨ç°å®ä¸–ç•Œä¸­ï¼Œå¸§é€å¾€æ¥æ”¶æ–¹é€”ä¸­å’Œç¡®è®¤å¸§è¿”å›å‘é€æ–¹çš„æ—¶é—´[ä¸¤ä¸ªç°è‰²]å¯èƒ½æ¯”å‘å‡ºä¸€ä¸ªå¸§[ä»…æŒ‡æ¨ä¸Šä¼ é€å¸¦çš„è¿‡ç¨‹,ç»¿è‰²]çš„æ—¶é—´é•¿å‡ºå¾ˆå¤š\n\nè¿™ä¼šå¯¼è‡´å¸¦å®½çš„åˆ©ç”¨ç‡å¾ˆä½ã€‚å› æ­¤æˆ‘ä»¬å¼•å‡ºæ»‘åŠ¨çª—å£åè®®ã€‚\n\n\n\næ»‘åŠ¨çª—å£åè®®çš„åŸºæœ¬æ€æƒ³\n\nå‘é€çª—å£ sending windowä»»æ„æ—¶åˆ»å‘é€æ–¹ç»´æŠ¤ä¸€ç»„å…è®¸å‘é€çš„å¸§çš„åºå·ï¼ˆåŒæ ·ç”¨ seq å­—æ®µä¿å­˜ï¼Œä½†è¿™æ—¶å¯èƒ½ä¸æ­¢ 1 ä¸ª bitï¼‰\næ¥æ”¶çª—å£ receiving windowæ¥æ”¶æ–¹ç»´æŠ¤ä¸€ç»„å…è®¸æ¥æ”¶çš„å¸§çš„åºå·.\nè¿™ä¸¤ä¸ªçª—å£çš„å¤§å°ä¸å¿…ç›¸åŒï¼Œä½†æ˜¯æ˜¯å›ºå®šçš„ã€‚\n\n\nå‘é€æ–¹ä¸€ä¸ªæ¯æ”¶åˆ°ç¡®è®¤å¸§ï¼Œå°±å°†å‘é€çª—å£å‘å‰æ»‘åŠ¨ä¸€ä¸ªä½ç½®ï¼›å¦‚æœæ²¡æœ‰å¯ä»¥å‘é€çš„å¸§ï¼ˆå³å‘é€äº†çª—å£å¤§å°é‚£ä¹ˆå¤šçš„å¸§ä½†æ˜¯è¿˜æ²¡æœ‰æ”¶åˆ°ç¡®è®¤ï¼‰å°±åœæ­¢å‘é€ï¼ˆå®šæ—¶é‡å‘ï¼‰\næ¥æ”¶æ–¹æ¯æ”¶åˆ°ä¸€ä¸ªå¸§ï¼Œå¦‚æœåœ¨æ¥æ”¶çª—å£å†…åˆ™æ¥æ”¶ï¼Œå¦åˆ™ä¸¢å¼ƒã€‚\näº‹å®ä¸Šï¼Œstop-and-wait åè®®å°±å¯ä»¥è§†ä¸ºæ˜¯å‘é€å’Œæ¥æ”¶çª—å£å¤§å°å‡ä¸º 1 çš„æ»‘åŠ¨çª—å£åè®®ã€‚\néœ€è¦å†æ¬¡æ³¨æ„çš„æ˜¯ï¼Œæ¥æ”¶æ–¹çš„æ•°æ®é“¾è·¯å±‚éœ€è¦å°½å¯èƒ½å°†æ•°æ®åŒ…æŒ‰æ­£ç¡®çš„é¡ºåºä¼ é€’ç»™ç½‘ç»œå±‚ã€‚\nå…³äºçª—å£å¤§å°çš„ç†è®ºåˆ†æï¼ˆæ›´æ­£ï¼šACK 0 åº”å½“æ˜¯ ACK 1ï¼‰\n\næ ¹æ®ä¸Šé¢çš„ç†è®ºåˆ†æï¼Œæˆ‘ä»¬å®šä¹‰ é“¾è·¯åˆ©ç”¨ç‡ Line Utilization = Frame Length / (Frame Length + 2 * Bandwidth * Propagation Delay)æ›´å¸¸è§çš„è¡¨è¿°æ˜¯ Line Utilization = Frame Length / (Frame Length + Bandwidth * Round-Trip Delay)ã€‚\nè¿›ä¸€æ­¥æˆ‘ä»¬å®šä¹‰ é“¾è·¯ååç‡ Throughput = Utilization * Sending Data Rate\n\nå›é€€ N åè®® GBN, Go-Back-N\n\nå›é€€ N åè®®æ˜¯ä¸€ç§æ»‘åŠ¨çª—å£åè®®ï¼›å…¶ä¸­ N ä»£è¡¨ sending window çš„å¤§å°ï¼Œè€Œè¿™ç§åè®®ä¸­ receiving window çš„å¤§å°å§‹ç»ˆä¸º 1ã€‚å½“å½“å‰ sending window çš„ç¬¬ä¸€å¸§çš„è®¡æ—¶å™¨ï¼ˆå®é™…ä¸Šæ¯ä¸€å¸§å‘å‡ºåéƒ½å¯åŠ¨ä¸€ä¸ªç‹¬ç«‹çš„è®¡æ—¶å™¨ï¼‰è¶…æ—¶ä»æœªå¾—åˆ° ACK æ—¶ï¼Œå›é€€ N ä½åˆ° sending window çš„å¼€å¤´é‡æ–°å‘é€è¿™ N å¸§ï¼›è€Œç”±äº receiving window çš„å¤§å°æ˜¯ 1ï¼Œå› æ­¤æå‰åˆ°è¾¾çš„å¸§éƒ½ä¼šè¢«æŠ›å¼ƒã€‚å¦‚ä¸‹å›¾ã€‚\n\nå¦å¤–å¼•å…¥ä¸€ç§ç¡®è®¤æ–¹å¼ï¼šç´¯è®¡ç¡®è®¤ cumulative acknowledgementï¼Œè¿™ç§ç¡®è®¤æ–¹å¼ä¸ºï¼šå½“æ¥æ”¶æ–¹å‘å› ACK n çš„ç¡®è®¤ï¼Œå…¶ä¸­è¡¨ç¤º n å’Œ n ä¹‹å‰çš„æ‰€æœ‰å¸§éƒ½å·²ç»æ”¶åˆ°ï¼›å¦‚æœ n ä¹‹å‰æœ‰ä»»ä½•æ²¡æœ‰æ”¶åˆ°çš„å¸§ï¼Œåˆ™ ACK n ä¸ä¼šè¢«å‘å‡ºã€‚\nè€ƒè™‘ GBN ä¸­ seq æ®µ bit æ•°å’Œ N çš„å…³ç³»ã€‚å¦‚æœ seq çš„å–å€¼ä¸º 0~MAX_SEQï¼Œå³å…±æœ‰ 1 + MAX_SEQ = 2^size_in_bit(seq) ç§å–å€¼ï¼Œé‚£ä¹ˆ N æœ€å¤§ä¸º MAX_SEQ è€Œä¸èƒ½æ˜¯ 1 + MAX_SEQã€‚\n\nè€ƒè™‘è¿™æ ·çš„ä¸€ä¸ªæƒ…å†µã€‚å‡å¦‚ MAX_SEQ æ˜¯ 7ï¼Œè€Œ N (i.e. sending window size) æ˜¯ 8ï¼›å‘é€æ–¹ä¸€æ¬¡æ€§å‘å‡ºäº† 0~7 è¿™ 8 ä¸ªå¸§ï¼Œè€Œæ¥æ”¶æ–¹å‘å›çš„ 8 ä¸ªç¡®è®¤å¸§å…¨éƒ¨ä¸¢å¤±äº†ï¼›é‚£ä¹ˆå‘é€æ–¹è®¤ä¸ºå¾—è¶…æ—¶é‡ä¼ 0å·å¸§,æ¥æ”¶æ–¹è®¤ä¸ºåˆšæ‰éƒ½ç¡®è®¤äº†,è¦ç­‰å…¨æ–°çš„0å·å¸§\næ¥ç€å‘é€æ–¹é‡å‘äº†è¿™äº›å¸§ï¼Œè€Œæ­¤æ—¶æ¥æ”¶æ–¹ä»¥ä¸ºè¿™æ˜¯å…¨æ–°çš„ 8 ä¸ªå¸§ï¼Œå¯¼è‡´äº†ä¼ é€’ç»™ç½‘ç»œå±‚çš„æ•°æ®å‡ºç°äº†é‡å¤ã€‚å› æ­¤ N ä¸èƒ½æ˜¯ 8ã€‚\n\n\n\né€‰æ‹©é‡ä¼ åè®® SR, Selective Repeat\n\nå¦‚æœé”™è¯¯å¾ˆå°‘å‘ç”Ÿï¼Œé‚£ä¹ˆ GBN æ˜¯ä¸€ä¸ªè‰¯å¥½çš„ç­–ç•¥ï¼›è€Œå½“é”™è¯¯é¢‘ç¹å‘ç”Ÿï¼ŒGBN çš„é‡å‘æ–¹å¼ä¼šæµªè´¹å¤§é‡çš„å¸¦å®½ã€‚GBN åè®®å¯ä»¥æœ‰ä¸¤ç§æ€è·¯çš„ä¼˜åŒ–ã€‚\n\n\nå½“æ¥æ”¶æ–¹å‘ç°äº†å‘æ¥çš„å¸§æœ‰é”™è¯¯æˆ–è€…ä¸æ˜¯æ‰€æœŸå¾…çš„é‚£ä¸ªå¸§æ—¶ï¼Œå‘é€ä¸€ä¸ªå¦å®šçš„ç¡®è®¤ä¿¡æ¯ NAK, Negative Acknowledgement å¹¶è¯´æ˜æƒ³è¦çš„ä¸‹ä¸€å¸§ï¼Œè¿™æ ·å¯ä»¥ä¸ç”¨ç­‰åˆ° timeout å†å›é€€é‡å‘ï¼›\nå¢å¤§ receiving window sizeï¼Œè¿™æ ·å½“é”™è¯¯å‘ç”Ÿæ—¶å¯ä»¥å…ˆç¼“å­˜ä¸€éƒ¨åˆ†å‘æ¥çš„åé¢çš„å¸§ï¼Œè¿™æ ·å‘é€æ–¹åªéœ€é‡å‘ NAK çš„å¸§å³å¯ã€‚\n\n\nç»¼åˆä¸Šè¿°ä¸¤ç§ä¼˜åŒ–å’Œç´¯è®¡ç¡®è®¤çš„ä¸€ä¸ªä¾‹å­å¦‚ä¸‹ï¼›è¿™å°±æ˜¯ é€‰æ‹©é‡ä¼ åè®®ã€‚\n\né€‰æ‹©é‡ä¼ åè®®å¯¹æ¯ä¸€å¸§åªå‘é€ä¸€ä¸ª NAKï¼Œé˜²æ­¢ä¸€æ¬¡æ€§å‘é€å¤§é‡ç›¸åŒ NAK çš„æƒ…å†µã€‚ä½†æ˜¯ï¼Œè¿™ä¹Ÿæœ‰å¯èƒ½å¸¦æ¥é—®é¢˜ã€‚è§£å†³æ–¹æ³•: å½“æ¥æ”¶æ–¹æ”¶åˆ°â€œéé¢„æœŸâ€çš„å¸§ï¼ˆæ¯”å¦‚æˆ‘è¦ 7ï¼Œä½ ç»™æˆ‘ 0ï¼‰ï¼Œå¹¶ä¸”å‘ç°è‡ªå·±å·²ç»å‘è¿‡ NAK äº†ï¼Œå®ƒå°±å¯åŠ¨ä¸€ä¸ª è¾…åŠ©è®¡æ—¶å™¨ã€‚å¦‚æœè®¡æ—¶å™¨æ—¶é—´åˆ°äº†ï¼ˆExpiresï¼‰ï¼Œè¿˜æ²¡æ”¶åˆ° 7ï¼Œæ¥æ”¶æ–¹å°±ä¼šå¼ºåˆ¶å†å‘ä¸€æ¬¡ ACK/NAKã€‚\næ¥æ”¶çª—å£çš„å¤§å°ä¸èƒ½å¤§äº (MAX_SEQ + 1) / 2ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œé€‰æ‹©é‡ä¼ åè®®çš„æ¥æ”¶çª—å£å’Œå‘é€çª—å£çš„å¤§å°æ˜¯ä¸€æ ·çš„ã€‚å¦‚æœçª—å£è·¨åº¦å¤ªå¤§,å°±ä¼šæŠŠæ—§å¸§å½“ä½œä¸‹ä¸€è½®çš„æ–°å¸§ç¼“å­˜èµ·æ¥,å¯¼è‡´æ•°æ®é”™ä¹±,æ‰€ä»¥SRå¤§å°å¿…é¡»å‡åŠ,ä¿è¯æ–°æ—§åºå·åœ¨çª—å£ä¸­ç»å¯¹ä¸ä¼šé‡å .\n\nç‚¹å¯¹ç‚¹ä¼ è¾“åè®®å®ä¾‹\né«˜çº§æ•°æ®é“¾è·¯æ§åˆ¶ HDLC, High-Level Data Link Control\n\nHDLC æ˜¯ä¸€ç§ bit-oriented protocolï¼Œä½¿ç”¨å…¨åŒå·¥é€šä¿¡ï¼›æœ‰é¡ºåºç¼–å·å’Œæ ¡éªŒï¼Œä¼ è¾“å¯é æ€§é«˜ã€‚å…¶å¸§ç»“æ„å¦‚ä¸‹å›¾\n\næ¯ä¸ªå¸§çš„å¼€å§‹å’Œç»“æŸç”¨åºåˆ— 01111110 (0x7E) æ ‡è¯†ã€‚\nåŒæ—¶å‘é€æ–¹çš„æ•°æ®é“¾è·¯å±‚åœ¨æ•°æ®ä¸­æ¯å‘ç°è¿ç»­çš„ 5 ä¸ª 1ï¼Œå‘é€æ—¶å°±åœ¨å…¶åé¢æ·»åŠ ä¸€ä¸ª 0ï¼›\næ¥æ”¶æ–¹çš„æ•°æ®é“¾è·¯å±‚åœ¨å‘ç° 111110 æ—¶å°†æœ€åä¸€ä¸ª 0 èˆå¼ƒã€‚\nè¿™æ ·æ•´ä¸ªå¸§ä¸­åªä¼šæœ‰å¤´å’Œå°¾çš„ FLAG æœ‰ 01111110 è¿™æ ·çš„åºåˆ—äº†ã€‚\nå½“é“¾è·¯ä¸Šæ²¡æœ‰éœ€è¦ä¼ è¾“çš„å†…å®¹æ—¶ï¼ŒHDLC ä¹Ÿä¼šé€šè¿‡ä¸æ–­å‘é€å½¢å¼ä¸º 01111110 çš„å¸§ä»¥ä¿æŒåŒæ–¹çš„åŒæ­¥ã€‚ï¼ˆå®é™…ä¸Šï¼ŒHDLC æœ€å¼€å§‹æ˜¯ä½œä¸º SDLC, Synchronous Data Link Control è¢«æå‡ºçš„ã€‚ï¼‰\næŒ‰ç…§ Control å­—æ®µçš„å‰ 2 ä¸ª bit å¯ä»¥å°† HDLC å¸§åˆ’åˆ†ä¸º 3 ç±»ï¼š\n\nä¿¡æ¯å¸§ Information frameï¼Œç¬¬ 1 ä½æ˜¯ 0ï¼Œç”¨æ¥æ‰¿è½½æ­£å¸¸çš„ä¿¡æ¯ï¼›\nç®¡ç†å¸§ Supervisory frameï¼Œå‰ä¸¤ä½æ˜¯ 10ï¼Œç”¨æ¥è¿›è¡Œæµé‡æ§åˆ¶å’Œå·®é”™æ§åˆ¶ï¼Œå¦‚å•ç‹¬çš„ ACKã€NAK ç­‰ï¼›è¿™ç§å¸§æ²¡æœ‰ Information å­—æ®µï¼›\næ— ç¼–å·å¸§ Un-numbered frameï¼Œå‰ä¸¤ä½æ˜¯ 11ï¼Œç”¨æ¥è¿›è¡Œå…¶ä»–çš„åŠŸèƒ½ï¼Œå¦‚é“¾è·¯ç®¡ç†ç­‰ã€‚\n\n\nFCS æ˜¯æ ¹æ® Address, Control å’Œ Information å­—æ®µè®¡ç®— CRC çš„ç»“æœã€‚\n\nç‚¹å¯¹ç‚¹åè®® PPP, Point-to-Point Protocol\n\nPPP æ˜¯ä¸€ç§ byte-oriented protocolã€‚HDLC æä¾›äº†å¯é çš„æ•°æ®ä¼ è¾“ï¼›è€Œ PPP é€šå¸¸ä¸ç¼–å·ã€æä¾›ä¸€ç§æ— è¿æ¥æ— ç¡®è®¤çš„æœåŠ¡ã€‚\nPPP åè®®æœ‰ 3 ä¸ªç»„æˆéƒ¨åˆ†ï¼š\n\n\nä¸€ç§æˆå¸§æ–¹æ³•ã€‚\né“¾è·¯æ§åˆ¶åè®® LCP, Link Control Protocolï¼Œç”¨äºå¯åŠ¨ã€æµ‹è¯•ã€é…ç½®ï¼ˆåå•†å‚æ•°ï¼‰ã€å…³é—­é“¾è·¯ã€‚\nç½‘ç»œæ§åˆ¶åè®® NCP, Network Control Protocolã€‚\n\nPPP æ˜¯ç”± SLIP å‘å±•è€Œæ¥çš„ï¼›\nSLIP çš„é—®é¢˜åœ¨äºå®ƒåªèƒ½ç”¨äºä¼ é€ IP Packetï¼›\nPPP åˆ™æ”¯æŒå¯¹äºç½‘ç»œå±‚è¿è¡Œå…¶ä»–åè®®ä»¥åŠä¸¤ç«¯ç½‘ç»œå±‚è¿è¡Œçš„åè®®ä¸åŒçš„æƒ…å†µä¸‹ä»ä½¿ç”¨ PPP è¿›è¡Œä¼ è¾“ã€‚\nå¯¹äºæ¯ä¸€ä¸ªæ”¯æŒçš„ç½‘è·¯å±‚åè®®ï¼Œéƒ½æœ‰ä¸€ä¸ªç›¸åº”çš„ NCP è¿›è¡Œé…ç½®ã€‚å…¶å¸§ç»“æ„å¦‚ä¸‹ï¼š\n\n\nå‰åçš„ FLAG éƒ½æ²¿ç”¨ HDLC çš„ 0x7Eï¼Œä½†å¡«å……æ–¹å¼æœ‰æ‰€ä¸åŒã€‚PPP æ˜¯ byte-oriented çš„ï¼Œå› æ­¤ä½¿ç”¨ byte stuffingã€‚\nåœ¨æ•°æ®ä¸­å‘ç°çš„ 0x7E å°†è¢«æ›¿æ¢ä¸º 0x7D 0x5E ä¸¤ä¸ªå­—èŠ‚ï¼›\nè€Œ 0x7D å°†è¢«æ›¿æ¢ä¸º 0x7D 0x5Dã€‚è¿™æ ·å¯ä»¥ä¿è¯å”¯ä¸€å‡ºç° 0x7E çš„åœ°æ–¹å°±æ˜¯å¸§çš„å¼€å§‹å’Œç»“æŸã€‚\nAddress æ®µå§‹ç»ˆä¸º 0xFFï¼Œè¡¨ç¤ºå¹¿æ’­ï¼Œå³æ‰€æœ‰è®¡ç®—æœºéƒ½æ¥æ”¶ï¼›\nControl çš„å€¼ä¸º 0x03ï¼Œè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªæ— ç¼–å·å¸§ï¼›ç”±äºè¿™ä¸¤ä¸ªå­—æ®µçš„å€¼å§‹ç»ˆä¸ºå®šå€¼ï¼Œå› æ­¤å¯ä»¥é€šè¿‡ LCP åå•†çœç•¥è¿™ä¸¤ä¸ªå­—æ®µã€‚\nProtocol åŒ…å«å…³äº LCP å’Œ NCP çš„ä¿¡æ¯ï¼Œé»˜è®¤ 2 byteï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡ LCP åå•†ä¸º 1 byteï¼›\nInformation çš„é»˜è®¤é•¿åº¦æ˜¯ 1500 byteï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥é€šè¿‡ LCP åå•†ï¼Œå¯èƒ½åˆ©ç”¨ Padding è¿›è¡Œå¡«å……ä»¥æ»¡è¶³é•¿åº¦è¦æ±‚ï¼›\nFrame Check Sequence é»˜è®¤ 2 byteï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥åå•†ä½¿ç”¨ 4 byteï¼Œä¹Ÿæ˜¯ CRCã€‚\n\nPPP åè®®åœ¨ç”¨äºä¸åŒé“¾è·¯ä¸Šæ—¶å¯èƒ½ä¹Ÿæœ‰ä¸åŒçš„æˆå¸§æ–¹å¼ã€‚ä¾‹å¦‚ PPP ç”¨äº SONET ç­‰åŒæ­¥é“¾è·¯æ—¶ä¼šä½¿ç”¨ HDLC é‚£æ ·çš„ bit stuffing è€Œä¸æ˜¯ byte stuffingï¼›ç”¨äº SONET æ—¶è¿˜éœ€è¦è¿›è¡Œé“¾è·¯çš„å»ºç«‹ä»¥åŠæ‰°ç  (scrambling)ã€‚\n\n"},"è¯¾ç¨‹ç¬”è®°/è®¡ç®—æœºç½‘ç»œ/04-ä»‹è´¨è®¿é—®æ§åˆ¶å­å±‚MAC,-Medium-Access-Control-Sublayer":{"slug":"è¯¾ç¨‹ç¬”è®°/è®¡ç®—æœºç½‘ç»œ/04-ä»‹è´¨è®¿é—®æ§åˆ¶å­å±‚MAC,-Medium-Access-Control-Sublayer","filePath":"è¯¾ç¨‹ç¬”è®°/è®¡ç®—æœºç½‘ç»œ/04 ä»‹è´¨è®¿é—®æ§åˆ¶å­å±‚MAC, Medium Access Control Sublayer.md","title":"ä»‹è´¨è®¿é—®æ§åˆ¶å­å±‚MAC, Medium Access Control Sublayer","links":[],"tags":[],"content":"å¹¿æ’­ä¿¡é“ä¼ è¾“åè®®\nMAC å­å±‚\n\næˆ‘ä»¬è®¨è®ºè¿‡çš„åè®®éƒ½æ˜¯é’ˆå¯¹ ç‚¹å¯¹ç‚¹è¿æ¥ point-to-point connections çš„ï¼›ä½†æ˜¯åœ¨ LAN ç­‰åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ å¹¿æ’­ä¿¡é“ broadcast channelsã€‚\n\nä¹Ÿç§°ä¸º å¤šè·¯è®¿é—®ä¿¡é“ multiaccess channel æˆ– éšæœºè®¿é—®ä¿¡é“ random access channelã€‚\nå¯¹äºå¹¿æ’­ä¿¡é“ï¼Œå…³é”®çš„é—®é¢˜æ˜¯ä¿è¯åœ¨å¤šæ–¹äº‰ç”¨ä¿¡é“æ—¶ç¡®å®šè°å¯ä»¥ä½¿ç”¨ä¿¡é“ï¼Œä»è€Œè®©ä»–ä»¬éƒ½æˆåŠŸå‘é€ä¿¡æ¯ã€‚ç”¨æ¥ç¡®å®šå¤šè·¯è®¿é—®ä¿¡é“çš„ä¸‹ä¸€ä¸ªä½¿ç”¨è€…çš„åè®®å±äº Link Layer çš„ä¸€ä¸ªå­å±‚ ä»‹è´¨è®¿é—®æ§åˆ¶å­å±‚ MAC, Medium Access Control Sublayerã€‚æˆ‘ä»¬å…³æ³¨ä½è´Ÿè½½æƒ…å†µä¸‹çš„å»¶è¿Ÿä»¥åŠé«˜è´Ÿè½½æƒ…å†µä¸‹çš„é“¾è·¯åˆ©ç”¨ç‡ã€‚\n\n\nOSI ä¸ƒå±‚æ¨¡å‹å°† Data Link Layer åˆ†ä¸ºäº† LLC (Logical Link Control) å’Œ MAC ä¸¤ä¸ªå­å±‚ï¼š\n\nå°†ä¿¡é“åˆ†é…é—®é¢˜å½¢å¼åŒ–ï¼Œæˆ‘ä»¬æå‡ºä¸‹é¢ 5 ä¸ªå…³é”®å‡è®¾ï¼š\n\nIndependent Trafficï¼Œæ¯ä¸ªç«™ä¸­å¸§çš„åˆ°è¾¾ç‡ç›¸äº’ç‹¬ç«‹ï¼›æ¯ä¸ªå¸§å‘é€å‡ºå»å‰è¯¥ç«™é˜»å¡ã€‚\nSingle Channelï¼Œæ‰€æœ‰çš„é€šä¿¡éƒ½å‘ç”Ÿåœ¨åŒä¸€ä¸ªä¿¡é“ä¸Šï¼›æ‰€æœ‰çš„ç«™éƒ½èƒ½åœ¨è¿™ä¸ªä¿¡é“ä¸Šå‘é€å’Œæ¥å—æ•°æ®ã€‚\nObservable Collisionï¼Œæ‰€æœ‰çš„ç«™éƒ½èƒ½æ£€æµ‹åˆ°å†²çªäº‹ä»¶çš„å‘ç”Ÿã€‚\nContinuous or Slotted Timeï¼Œå¯ä»¥çº¦å®šä»»ä½•æ—¶å€™éƒ½å¯ä»¥å¼€å§‹ä¼ è¾“å¸§ï¼Œæˆ–è€…å°†æ—¶é—´åˆ†æ§½ï¼Œè§„å®šåªèƒ½åœ¨æ—¶é—´æ§½å¼€å§‹æ—¶å¼€å§‹ä¼ è¾“å¸§ã€‚\nCarrier Sense or No Carrier Senseï¼Œå¯ä»¥è®©ç«™åœ¨å‘é€å‰ä¾¦å¬è½½æ³¢ï¼Œå¦‚æœä¿¡é“å¿™å°±æš‚ç¼“ä¼ è¾“é˜²æ­¢å†²çªã€‚\n\n\n\nStatic FDM / TDM\n\nN å˜åŒ–æ—¶å¾ˆéº»çƒ¦ï¼›ä¸å˜åŒ–ä¹Ÿå¾ˆæµªè´¹\n\nALOHA, Additive Links On-line Hawaii Area\nPure ALOHA\n\nåŸºæœ¬æ€æƒ³å¾ˆç®€å•ï¼šæ¯ä¸ªç”¨æˆ·æœ‰æ•°æ®éœ€è¦å‘é€æ—¶å°±ä¼ è¾“ã€‚é—®é¢˜åœ¨äºï¼Œå½“ä¸¤ä¸ªç”¨æˆ·å‘é€çš„ä¿¡å·å‘ç”Ÿé‡å ï¼ˆç§°ä¸º å†²çª collisionï¼‰æ—¶ï¼Œå†²çªçš„å¸§å°±ä¼šæŸåã€‚ALOHA è¦æ±‚å‘é€æ–¹å¯ä»¥çŸ¥é“æ‰€å‘é€çš„ä¿¡å·æ˜¯å¦å‘ç”Ÿäº†å†²çªã€‚è¿™ç§é‡‡ç”¨äº†å¯èƒ½å¼•èµ·å†²çªçš„å…±äº«ä¿¡é“æ–¹æ³•çš„ç³»ç»Ÿç§°ä¸º ç«äº‰ç³»ç»Ÿ contention systemã€‚\nåœ¨ ALOHA æœ€åˆçš„åº”ç”¨åœºæ™¯ä¸­ï¼Œä¸­å¤®è®¡ç®—æœºä¼šå°†å—åˆ°çš„å¸§å¹¿æ’­å‘å›ï¼Œå‘é€æ–¹ä¾¦å¬å‘å›çš„å¸§å°±å¯ä»¥çŸ¥é“æœ‰æ²¡æœ‰å‘ç”Ÿå†²çªã€‚åœ¨å…¶ä»–ç³»ç»Ÿä¸­ï¼Œå‘é€æ–¹å¯ä»¥ç›´æ¥ä¾¦å¬å‘é€çš„å¸§æ˜¯å¦å‘ç”Ÿè¿‡å†²çªï¼›æˆ–è€…ç­‰å¾…æ¥æ”¶æ–¹å‘å› ACK æˆ– NAKã€‚\nå½“å‘é€æ–¹ä¾¦æµ‹åˆ°å†²çªã€æ”¶åˆ°ä¸€ä¸ª NAK æˆ–è€…ä¸€æ®µæ—¶é—´æ²¡æœ‰æ”¶åˆ°å›å¤æ—¶ï¼Œå®ƒåœ¨ç­‰å¾…ä¸€æ®µ éšæœº æ—¶é—´åå†æ¬¡å‘é€è¯¥å¸§ã€‚å¦‚æœç­‰å¾…æ—¶é—´ä¸æ˜¯éšæœºçš„ï¼Œé‚£ä¹ˆå‘ç”Ÿå†²çªçš„å¸§ä¼šä¸€æ¬¡åˆä¸€æ¬¡å‘ç”Ÿå†²çªã€‚\n\næœ€å¥½æƒ…å†µä¸‹ï¼ŒPure ALOHA çš„ä¿¡é“åˆ©ç”¨ç‡æœŸæœ›çº¦ä¸º 1/2e â‰ˆ 18%ï¼Œè¿™æ˜¯å¾ˆä½çš„ã€‚\n\nSlotted ALOHA\n\nåœ¨è¿™ç§ä¼˜åŒ–äº†çš„åè®®ä¸­ï¼Œæ—¶é—´è¢«åˆ†æˆäº†ç¦»æ•£çš„ slotï¼Œç”¨æˆ·åªèƒ½åœ¨æ¯ä¸ª slot çš„å¼€å§‹æ—¶åˆ»æ‰èƒ½å‘é€å¸§ã€‚æ¯æ¬¡ä¼ è¾“å¸§çš„ç”¨æ—¶å¿…é¡»å°äºæˆ–ç­‰äºä¸€ä¸ª slot çš„é•¿åº¦ã€‚\né˜´å½±è¡¨ç¤ºå†²çª (src)\nè¿™ç§æ–¹å¼å¯ä»¥è¾¾åˆ°çš„æœ€ä½³åˆ©ç”¨ç‡æ˜¯ 1/e â‰ˆ 36%ã€‚\nè½½æ³¢ä¾¦å¬å¤šè·¯è®¿é—® CSMA, Carrier Sense Multiple Access\n\n1-persistent CSMA\n\næ¯ä¸ªç«™ç‚¹éœ€è¦å‘é€æ•°æ®æ—¶ï¼Œé¦–å…ˆä¾¦å¬ä¿¡é“ï¼šå¦‚æœä¿¡é“ç©ºé—²åˆ™ç«‹å³å‘é€æ•°æ®ï¼›å¦‚æœä¿¡é“å¿™ï¼Œåˆ™ä¸æ–­ä¾¦å¬ç›´è‡³ä¿¡é“ç©ºé—²æ—¶å‘é€æ•°æ®ã€‚å¦‚æœå†²çªï¼ˆæ¯”å¦‚ä¸€æ®µæ—¶é—´å†…æ²¡æ”¶åˆ° ACK æˆ–è€…æ”¶åˆ°äº† NAKï¼‰ï¼Œåˆ™éšæœºç­‰å¾…ä¸€æ®µæ—¶é—´åé‡å¤ä¸Šè¿°ç­–ç•¥ã€‚\né—®é¢˜ï¼š\n\né¦–å…ˆï¼Œå¦‚æœä¿¡é“å¿™æ—¶ä¸¤ä¸ªç«™ç‚¹åŒæ—¶ä¾¦å¬ï¼Œä¿¡é“ç©ºé—²çš„æ—¶å€™ä¸¤ä¸ªä¿¡é“å°±ä¼šåŒæ—¶è¯•å›¾å‘é€ï¼Œä»è€Œå‡ºç°å†²çªã€‚\nå¦å¤–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è€ƒè™‘ä¿¡é“ä¸Šçš„ä¼ æ’­å»¶æ—¶ propagation delayï¼šå¦‚æœ A å·²ç»å¼€å§‹å‘é€æ•°æ®ï¼Œä½†æ˜¯æ•°æ®æš‚æ—¶æ²¡æœ‰ä¼ æ’­åˆ° Bï¼Œæ­¤æ—¶ B ä¾¦å¬åˆ°çš„ä¿¡é“æ˜¯ç©ºé—²å¹¶å¼€å§‹å‘é€æ•°æ®ï¼Œä¹Ÿä¼šå¼•èµ·å†²çªã€‚\n\n\nï¼ˆå³ä¾¿å¦‚æ­¤ï¼Œè¿™ç§æ–¹æ¡ˆçš„ä¿¡é“åˆ©ç”¨ç‡ä¹Ÿæ¯” ALOHA å¥½ï¼‰\n\nnonpersistent CSMA\n\nè¿™ç§æ–¹å¼çš„å…³é”®åŒºåˆ«æ˜¯ï¼šå¦‚æœä¾¦å¬åˆ°ä¿¡é“å¿™ï¼Œåˆ™æ”¾å¼ƒä¾¦å¬ï¼Œç­‰å¾…ä¸€æ®µéšæœºæ—¶é•¿åå†è¿›è¡Œä¾¦å¬ï¼Œç›´åˆ°ä¾¦å¬åˆ°ä¿¡é“ç©ºé—²å¹¶æˆåŠŸå‘é€ã€‚\n\np-persistent CSMA\n\nè¿™ç§æ–¹å¼ç”¨äº slotted channelsã€‚å½“ç«™ç‚¹éœ€è¦å‘é€æ•°æ®æ—¶ä¾¦å¬ä¿¡é“ï¼šå¦‚æœä¿¡é“å¿™ï¼Œåˆ°ä¸‹ä¸€ä¸ª slot å†ä¾¦å¬ï¼›å¦‚æœä¿¡é“ç©ºé—²ï¼Œåˆ™ä»¥ p çš„æ¦‚ç‡å‘é€æ•°æ®ï¼Œä»¥ 1-p çš„æ¦‚ç‡åˆ°ä¸‹ä¸€ä¸ª slot å†ä¾¦å¬ã€‚\n\nCSMA/CD, CSMA with Collision Detection\n\n\nå‰è¿°å‡ ç§ CSMA å¯¹å†²çªçš„å‘ç°éƒ½æ˜¯é€šè¿‡ç¡®è®¤å¸§è¿›è¡Œçš„ï¼Œå¯¹äºé“¾è·¯è¿‡é•¿çš„æƒ…å†µï¼Œç­‰å¾…çš„æ—¶é—´å¯èƒ½è¾ƒé•¿ã€‚æˆ‘ä»¬è€ƒè™‘å¯¹ä¿¡é“ä¸æ–­ä¾¦å¬å®ç°å†²çªçš„æ£€æµ‹ï¼Œè¿™è¦æ±‚è¿”å›çš„ä¿¡å·ä¸èƒ½æ¯”å‘å‡ºçš„ä¿¡å·å¼±å¤ªå¤šï¼ˆå¦‚æ— çº¿ä¼ è¾“å°±ä¸è¡Œï¼‰ï¼Œè€Œä¸”å†²çªå¿…é¡»åœ¨å‘é€è¿‡ç¨‹ä¸­å°±å¯ä»¥è¢«æ£€æŸ¥åˆ°ã€‚å¦‚æœä¸€ä¸ªç«™æ£€æµ‹åˆ°å†²çªï¼Œå®ƒä¼šç«‹å³åœæ­¢ä¼ è¾“ï¼Œå¹¶ç­‰å¾…ä¸€ä¸ªéšæœºæ—¶é—´åå†å°è¯•å‘é€ã€‚\n\n\nè€ƒå¯Ÿå†²çªæ£€æŸ¥èŠ±è´¹çš„æœ€é•¿å¯èƒ½æ—¶é—´ï¼šåœ¨ CDMA ä¸­ï¼Œå†²çªçš„å¯èƒ½æ€§æ˜¯æŸä¸ªç«™å¼€å§‹å‘é€å‰è¿›è¡Œä¾¦å¬æ—¶ï¼Œå¦ä¸€ä¸ªç«™è™½ç„¶å·²ç»å¼€å§‹å‘é€ï¼Œä½†æ˜¯ä¿¡å·å°šæœªä¼ æ’­åˆ°è¿™ä¸ªç«™ã€‚å› æ­¤å¦‚æœæœ€è¿œçš„ä¸¤ä¸ªç«™ä¹‹é—´ä¼ æ’­ç”¨æ—¶æ˜¯ tï¼Œé‚£ä¹ˆä¸€ä¸ªç«™å‘é€å 0~t ç§’å†…å†²çªæ‰æœ‰å¯èƒ½ä¼šå‘ç”Ÿï¼›è€Œè¿™ä¸ªå†²çªä¼šèŠ±è´¹åŒæ ·å¤šçš„æ—¶é—´ä¼ æ’­å›å»ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä¸€ä¸ªç«™å‘é€ä¿¡æ¯å 2t æ—¶é—´ä»ç„¶æ²¡æœ‰ä¾¦æµ‹åˆ°å†²çªï¼Œé‚£ä¹ˆå®ƒå‘é€çš„è¿™ä¸€å¸§å°±ä¸å†å¯èƒ½å‡ºç°å†²çªäº†ã€‚\n\n\næ— å†²çªåè®® collision-free protocols\n\n\nåŸºæœ¬ä½å›¾åè®® Basic Bit-map Protocol\n\n\n\n\n\nè¿™ç§åœ¨å‘é€æ•°æ®ä¹‹å‰å…ˆå¹¿æ’­å‘é€æ„æ„¿çš„åè®®ç§°ä¸º é¢„ç•™åè®® reservation protocolã€‚\n\n\nä»¤ç‰Œç¯åè®® Token Ring Protocol\n\n\n\n\n\näºŒè¿›åˆ¶å€’è®¡æ•°åè®® Binary Countdown Protocol\n\n\n\n\n\næœ‰é™ç«äº‰åè®® limited-contention protocols\n\n\nè‡ªé€‚åº”æ ‘éå†åè®®The Adaptive Tree Walk Protocol\n\n\nä»¥å¤ªç½‘\nç»å…¸ä»¥å¤ªç½‘ Classic Ethernet\n\nä¸€ä¸ª 10Mbps çš„ä»¥å¤ªç½‘æ ‡å‡†åœ¨ 1978 å¹´è¢«åˆ¶å®šå‡ºæ¥ï¼Œç§°ä¸º DIX standardã€‚1983 å¹´å®ƒè¢«ä¿®è®¢å¹¶æˆä¸ºäº† IEEE 802.3 æ ‡å‡†ã€‚\nç‰©ç†å±‚ \nä¸Šå›¾æ˜¾ç¤ºäº†ç»å…¸ä»¥å¤ªç½‘çš„ ç‰©ç†å±‚ã€‚ä»¥å¤ªç½‘çš„æ¯ä¸ªç‰ˆæœ¬éƒ½æœ‰ç”µç¼†é•¿åº¦çš„é™åˆ¶ï¼›è¶…è¿‡è¿™ä¸ªé™åˆ¶çš„ç½‘ç»œå¯ä»¥ç”¨ ä¸­ç»§å™¨ repeater å°†å¤šæ¡çº¿ç¼†è¿æ¥èµ·æ¥ã€‚ä½†æ˜¯æ”¶å‘å™¨ transceiver ä¹‹é—´ä»ç„¶æœ‰æœ€å¤§è·ç¦» 2.5 km å’Œæœ€å¤§ç»è¿‡ä¸­ç»§å™¨æ•°ç›® 4 ä¸ªçš„é™åˆ¶ã€‚åœ¨è¿™äº›ç”µç¼†ä¸Šï¼Œä¿¡æ¯çš„å‘é€é‡‡ç”¨ Manchester ç¼–ç ã€‚\n\né›†çº¿å™¨ Hub\n\n\nä¼ ç»Ÿçš„æ¥çº¿æ¨¡å¼ä¸å¤ªæ–¹ä¾¿è®¾å¤‡çš„å¢å‡ï¼›å‡ºç°æ–­è£‚ç­‰æƒ…å†µä¹Ÿå¾ˆéš¾å®šä½ã€‚å› æ­¤äººä»¬å¼€å‘å‡ºäº†ä¸€ç§è®¾å¤‡ Hubï¼Œè¿™ç§è®¾å¤‡æœ‰å¾ˆå¤šæ¥å£ï¼Œæ¯ä¸ªæ¥å£ä¹‹é—´ç®€å•åœ°è¿æ¥èµ·æ¥ï¼Œè¿™æ ·ä»»ä½•ä¸€ä¸ªæ¥å£å‘é€æ¥çš„å¸§ä¼šè¢«ä¼ æ’­åˆ°å…¶ä»–æ‰€æœ‰ç«¯å£ã€‚ç«¯å£çš„è®¾ç½®ä¹Ÿæ–¹ä¾¿äº†è®¾å¤‡å¢å‡å’Œå®šä½é—®é¢˜ã€‚\nä¹‹æ‰€ä»¥è¯´ Hub æ˜¯ä¸€ä¸ªç‰©ç†å±‚è®¾å¤‡ï¼Œå°±æ˜¯å› ä¸ºå®ƒä¸ä¼šè¯•å›¾ç†è§£å’Œä½¿ç”¨ä»»ä½•æ•°æ®é“¾è·¯å±‚ä»¥åŠæ›´é«˜å±‚æ·»åŠ çš„ä¿¡æ¯ï¼›æ¯”å¦‚å®ƒå¹¶ä¸çŸ¥é“è¿™ä¸ªå¸§æ˜¯ä»è°å‘ç»™è°çš„ã€‚å®ƒåšçš„äº‹æƒ…å°±åªæ˜¯å®Œæˆè½¬å‘ï¼ˆå®é™…ä¸Šï¼Œåªæ˜¯ä¿¡å·çš„ä¼ æ’­ï¼‰è€Œå·²ã€‚ ä¹Ÿæ­£å› ä¸º Hub å®é™…å‘æŒ¥çš„ä½œç”¨åªæ˜¯ä¿¡å·çš„ä¼ æ’­ï¼Œå› æ­¤ Hub å¹¶æ²¡æœ‰ç¼“å­˜ï¼›å„ä¸ªç«¯å£ä¸Šçš„çº¿è·¯ä¹Ÿå¿…é¡»ä»¥åŒæ ·çš„é€Ÿåº¦è¿è¡Œã€‚\n\nä¼ è¾“åè®®\n\nä»¥å¤ªç½‘æ˜¯æ— è¿æ¥çš„ï¼Œä¹Ÿå¹¶ä¸æä¾›ç¡®è®¤ï¼Œä½¿ç”¨ 1-persistent CSMA/CD ç®—æ³•è¿›è¡Œä¼ è¾“ï¼›å®ƒé€šè¿‡ä¾¦å¬æœ‰æ²¡æœ‰å†²çªæ¥åˆ¤æ–­æ˜¯å¦å‘é€æˆåŠŸã€‚å¦‚æœç«™ä¾¦å¬åˆ°äº†å†²çªï¼Œåˆ™å‘ä¸€ä¸ªçŸ­çš„å†²çªåŠ å¼ºä¿¡å· (short jam signal) ç¡®ä¿å¦ä¸€ä¸ªå‘é€ç«™ä¹Ÿå¬åˆ°äº†å†²çªï¼›å¦‚æœæ²¡æœ‰ä¾¦å¬åˆ°å†²çªåˆ™å‡è®¾è¿™ä¸ªå¸§å‘é€æˆåŠŸã€‚ä¼ è¾“è¿‡ç¨‹ä¸­å‘ç”Ÿçš„é”™è¯¯åªä¼šé€šè¿‡æ ¡éªŒå’Œæ£€å‡ºå¹¶ç”±é«˜å±‚è´Ÿè´£æ¢å¤ã€‚\nè€ƒè™‘è¿™ç§å†²çªä¾¦å¬çš„å¯é æ€§ã€‚å‡è®¾ä¸¤ä¸ªæœ€è¿œçš„ç«™ A, B ä¹‹é—´éœ€è¦çš„ä¼ æ’­æ—¶é—´ä¸º Ï„ï¼ŒA ç«™å¼€å§‹å‘é€ä¸€ä¸ªå¸§åçš„ Ï„-Îµ æ—¶é—´ï¼Œå³å³å°†åˆ°è¾¾ B ç«™æ—¶ï¼ŒB å‘é€äº†ä¸€ä¸ªå¸§å¹¶äº§ç”Ÿäº†å†²çªï¼›è¿™ä¸ªå†²çªåœ¨ 2Ï„-2Îµ æ—¶é—´è¢« A ä¾¦å¬åˆ°ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬å¿…é¡»ä¿è¯ 2Ï„-2Îµ æ—¶é—´æ—¶ A è¿˜æ²¡æœ‰å‘é€å®Œè¿™ä¸ªå¸§ï¼›å¦åˆ™å¦‚æœå®ƒå°±æœ‰å¯èƒ½å·²ç»å‘é€å®Œå‰ä¸€ä¸ªå¸§å¹¶å¼€å§‹å‘é€ä¸‹ä¸€ä¸ªå¸§ï¼Œå¹¶ä¸”ä¼šä¸çŸ¥é“è¿™ä¸ªå†²çªä¿¡å·ä»£è¡¨å“ªä¸€å¸§å‘ç”Ÿäº†å†²çªã€‚å³ï¼Œæˆ‘ä»¬éœ€è¦è®©å¸§æ—¶é—´ä¸ä½äº 2Ï„ã€‚æ ¹æ®ç‰©ç†å±‚ä¸­æˆ‘ä»¬è§„èŒƒçš„ 2.5kmã€4 ä¸ªä¸­ç»§å™¨çš„æœ€å¤§é™åˆ¶ï¼Œå¾€è¿”æ—¶é—´ 2Ï„ å¤§çº¦æ˜¯ 50Î¼sï¼›åœ¨ 10Mbps çš„é€Ÿç‡ä¸‹å¯ä»¥å‘é€ 500bitã€‚è€ƒè™‘ä¸€ä¸ªå®‰å…¨ä½™é‡ï¼Œæˆ‘ä»¬è§„å®šæœ€å°å¸§æ—¶é—´ä¸º 51.2Î¼sï¼Œæœ€å°å¸§é•¿ä¸º 512bitï¼Œå³ 64 å­—èŠ‚ã€‚ï¼ˆè¿™ä¸ªæ¨å¯¼è¿‡ç¨‹æ¢ä¸ªå‚æ•°å¯ä»¥è€ƒè®¡ç®—é¢˜ï¼‰\nä»¥å¤ªç½‘é€šè¿‡ äºŒè¿›åˆ¶æŒ‡æ•°åé€€ binary exponential backoff ç®—æ³•ç¡®å®šæ¯æ¬¡å†²çªåçš„ç­‰å¾…æ—¶é—´ã€‚æˆ‘ä»¬å°†æ—¶é—´æŒ‰ç…§ 51.2Î¼s åˆ†å—ï¼›åœ¨ç¬¬ i = 1 ~ 15 æ¬¡å†²çªå‘ç”Ÿåï¼Œç«™ç­‰å¾… 0 ~ min((2^i-1), 1023) ä¸ªæ—¶é—´æ§½åå†æ¬¡å°è¯•å‘é€ï¼›åœ¨å‘ç”Ÿ 16 æ¬¡å†²çªåï¼Œå®ƒæ”¾å¼ƒå‘é€å¹¶ç»™ä¸Šå±‚è¿”å›ä¸€ä¸ªå¤±è´¥æŠ¥å‘Šï¼›é«˜å±‚åè®®è´Ÿè´£è¿›ä¸€æ­¥çš„æ¢å¤å·¥ä½œã€‚è¿™ç§ç®—æ³•çš„è€ƒé‡æ˜¯ï¼Œå¦‚æœç­‰å¾…æ—¶é—´çš„ä¸Šé™è¾ƒä½ï¼Œé‚£ä¹ˆå¤šä¸ªç«™å‘ç”Ÿå†²çªçš„æ—¶å€™å¾ˆå¯èƒ½å†æ¬¡å‘ç”Ÿå†²çªï¼›è€Œå¦‚æœä¸Šé™è¾ƒé«˜ï¼Œåˆ™å¾ˆæœ‰å¯èƒ½å‘ç”Ÿå¾ˆå¤šæ— æ„ä¹‰çš„å»¶è¿Ÿã€‚è¿™ç§ç®—æ³•å¯ä»¥ä¿è¯ï¼šå¦‚æœåªæœ‰å°‘é‡ç«™å‘ç”Ÿå†²çªï¼Œåˆ™å¯ä»¥ä¿è¯è¾ƒä½çš„å»¶è¿Ÿï¼›å½“è®¸å¤šç«™å‘ç”Ÿå†²çªæ—¶ï¼Œå®ƒä¹Ÿå¯ä»¥ä¿è¯åœ¨ä¸€ä¸ªç›¸å¯¹åˆç†çš„æ—¶é—´å†…è§£å†³å†²çªã€‚\n\nå¸§ç»“æ„ \n\n\nåœ¨ MAC å­å±‚ï¼Œæ ‡å‡†è§„å®šäº†ä»¥å¤ªç½‘çš„å¸§ç»“æ„ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºã€‚å¯ä»¥çœ‹åˆ°ï¼ŒDIX å’Œ IEEE 802.3 æ˜¯ç•¥æœ‰åŒºåˆ«çš„ã€‚\n\n\nå‰ 8 ä¸ªå­—èŠ‚æ˜¯å‰å¯¼ç  Preambleï¼Œå…¶ä¸­å‰ 7 ä¸ªå­—èŠ‚æ˜¯ 10101010 ç”¨æ¥åŒæ­¥ï¼Œç¬¬ 8 ä¸ªå­—èŠ‚æ˜¯ 10101011 (SOF, Start of Frame) æç¤ºå¸§çš„å¼€å§‹ã€‚\n\n\nDest addr å‘é€å‡ºå»çš„ç¬¬ä¸€ä¸ª bit æ˜¯ 0 è¡¨ç¤º å•æ’­ unicastingï¼Œ1 è¡¨ç¤º ç»„æ’­ multicastingï¼›å…¨ 1 è¡¨ç¤º å¹¿æ’­ boardcastingã€‚\n\n\nSrc addr æ˜¯å…¨çƒå”¯ä¸€çš„ï¼›ç”± IEEE ç»Ÿä¸€åˆ†é…ã€‚å‰ 3 ä¸ªå­—èŠ‚ç§°ä¸º OUI, Organizationally Unique Identifierï¼Œåˆ†é…ç»™ç½‘ç»œè®¾å¤‡åˆ¶é€ å•†ï¼›ç½‘ç»œè®¾å¤‡åˆ¶é€ å•†å†åˆ†é…åˆ°ç½‘ç»œè®¾å¤‡ï¼Œå¹¶å†™å…¥ ç½‘ç»œæ¥å£å¡ NIC, Network Interface Cardï¼Œå³ç½‘å¡ã€‚\n\n\næ¥ä¸‹æ¥çš„ 2 ä¸ªå­—èŠ‚ï¼Œåœ¨ DIX ä¸­è¡¨ç¤ºç±»å‹ï¼Œå› ä¸ºæ¥æ”¶æ–¹çš„æ“ä½œç³»ç»Ÿéœ€è¦çŸ¥é“ç”¨å“ªä¸ªç½‘ç»œå±‚åè®®æ¥å¤„ç†æ•°æ®åŒ…ï¼›è€Œåœ¨ IEEE 802.3 ä¸­è¿™ä¸¤ä¸ªå­—èŠ‚å­˜å‚¨ Data çš„é•¿åº¦ï¼ˆåœ¨ DIX ä¸­ï¼Œè¿™ä¸ªé•¿åº¦åªèƒ½ä¿å­˜åœ¨ Data ä¸­ï¼›ä½†è¿™è¿åäº†åˆ†å±‚çš„æ€æƒ³ï¼‰ï¼Œå…·ä½“çš„ç±»å‹åˆ™å­˜å‚¨åœ¨ Data ä¸­çš„ é€»è¾‘é“¾è·¯æ§åˆ¶ LLC, Logical Link Control åè®®å¤´ ä¸­ã€‚ä½†æ˜¯å®é™…ä¸Šåœ¨ IEEE 802.3 æå‡ºæ—¶ï¼ŒDIX è®¾å¤‡å·²ç»åœ¨ä½¿ç”¨äº†ï¼›å› æ­¤æœ€ç»ˆé€‰æ‹©äº†å…¼å®¹ï¼šå€¼ä¸å¤§äº 0x600 çš„å­—æ®µè§£é‡Šä¸º Lengthï¼Œè€Œå¤§äº 0x600 åˆ™è§£é‡Šä¸º Typeã€‚\n\n\næ¥ä¸‹æ¥æ˜¯ Data æ®µã€‚åœ¨æŒ‡å®š DIX æ ‡å‡†æ—¶ï¼Œè€ƒè™‘åˆ°å†…å­˜å¾ˆè´µï¼Œæ‰€ä»¥è®¾ç½®äº† 1500 å­—èŠ‚çš„ä¸Šé™ï¼ˆå› æ­¤æœ€å¤§å¸§é•¿æ˜¯ 1518 å­—èŠ‚ï¼‰ã€‚ä¸‹é¢æ˜¯ Paddingï¼Œå³å¡«å……ã€‚å¡«å……æ˜¯ä¸ºäº†ä¿è¯å¸§é•¿åº¦ï¼ˆä¸ç®— preambleï¼‰ä¸å°‘äº 64 ä¸ªå­—èŠ‚ï¼›è¿™ä¸€è§„å®šçš„åŸå› åœ¨å‰é¢å·²ç»è®¨è®ºè¿‡äº†ã€‚\n\n\næœ€åä¸€ä¸ªå­—æ®µæ˜¯æ ¡éªŒå’Œï¼Œå®ƒä½¿ç”¨çš„å°±æ˜¯ 32 ä½çš„ CRCã€‚\n\n\n10Base2, 10Base5 ç”¨çš„æ˜¯åŒè½´ç”µç¼†ï¼›Base æŒ‡åŸºå¸¦ä¼ è¾“ï¼Œå‰é¢çš„æ•°å­—è¡¨ç¤ºæ˜¯å¤šå°‘ Mbpsï¼ˆé™¤äº† 10GBaseT è¿™æ ·çš„è¡¨ç¤º 10Gbpsï¼‰ï¼›BaseT æˆ–è€… BaseCï¼ˆæ¯”å¦‚ 100BaseT4, 1000BaseCXï¼‰å·®ä¸å¤šéƒ½æ˜¯åŒç»çº¿ï¼›å…¶ä»–çš„å·®ä¸å¤šéƒ½æ˜¯å…‰çº¤\n\n\nç½‘æ¡¥ bridge\nå¼•å‡º\n\n\nå‡å¦‚ç°åœ¨æœ‰è‹¥å¹²ä¸ª LANï¼Œä¾‹å¦‚ä¸€ä¸ªå¤§å­¦çš„å¤šä¸ªå­¦é™¢ï¼Œåˆ†åˆ«å‘æŒ¥å…¶æ•ˆç”¨ã€‚ä½†æ˜¯æ­¤æ—¶ï¼Œè¿™å‡ ä¸ª LAN å¸Œæœ›ç›¸äº’ä¹‹é—´æœ‰ä¸€äº›ä¿¡æ¯äº¤æµã€‚æœ€ç®€å•çš„è§£å†³åŠæ³•å°±æ˜¯å†ç”¨ä¸€æ ¹ç”µç¼†è¿æ¥è¿™äº› LANï¼›ä½†æ˜¯è¿™ç§åšæ³•æœ‰è‹¥å¹²é—®é¢˜ï¼š\n\n\né¦–å…ˆï¼Œæ¯ä¸ªåŸæ¥çš„ LAN ä¸­å¯èƒ½åŒ…å«å¤§é‡äº¤æµäºè‡ªå·±å­¦é™¢å†…çš„ä¿¡æ¯ï¼Œåªæœ‰å¾ˆå°‘çš„ä¸€éƒ¨åˆ†éœ€è¦ä¸å…¶ä»– LAN äº¤æµã€‚å¦‚æœç®€å•åœ°å°†è¿™äº› LAN è¿æ¥åœ¨ä¸€èµ·ï¼Œé‚£ä¹ˆæ¯ä¸ªä¿¡æ¯éƒ½ä¼šè¢«å¹¿æ’­åˆ°æ‰€æœ‰ LANï¼Œè¿™ä¼šæå¤§ç¨‹åº¦ä¸Šå¢åŠ ç½‘ç»œçš„è´Ÿè½½ï¼ŒåŒæ—¶ä¹Ÿå¸¦æ¥äº†å®‰å…¨æ€§é—®é¢˜ã€‚\n\n\nå…¶æ¬¡ï¼ŒIEEE 802.3 çš„é™åˆ¶å†³å®šäº†æœ€é•¿çš„çº¿è·¯é•¿åº¦æ˜¯ 2.5kmï¼›è€Œå¦‚æœè¿™äº› LAN çš„ç‰©ç†åœ°å€ç›¸è·è¾ƒè¿œï¼Œæˆ‘ä»¬å°±ä¸èƒ½å°†å…¶ç›´æ¥è¿æ¥èµ·æ¥ã€‚\n\n\nè€Œä¸”ï¼ŒåŸå…ˆçš„å„ä¸ª LAN ä¹Ÿæœ‰å¯èƒ½ä½¿ç”¨ç€ä¸åŒè¿è¡Œé€Ÿåº¦çš„çº¿è·¯ï¼Œç”šè‡³æ˜¯ä¸åŒçš„ç½‘ç»œç±»å‹ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œç›´æ¥å°†å…¶è¿æ¥æ˜¯æ— æ³•æ­£å¸¸å·¥ä½œçš„ã€‚\n\n\nè§£å†³è¿™äº›é—®é¢˜çš„ä¸€ä¸ªä¸é”™çš„æ€è·¯æ˜¯ï¼Œä»ç„¶ä¿æŒè¿™äº› LAN ç›¸äº’éš”ç¦»çš„çŠ¶æ€ï¼Œä½†æ˜¯ç»™å®ƒä»¬æä¾›é€”å¾„å‘å…¶ä»– LAN å‘é€æ¶ˆæ¯ã€‚è¿™ä¸ªé€”å¾„åº”å½“è¶³å¤Ÿç®€å•ï¼›LAN å†…éƒ¨çš„ä¿¡æ¯äº¤æµä¸åº”æ„ŸçŸ¥åˆ°æœ‰æ²¡æœ‰è¿™ä¸ªé€”å¾„ä¹‹é—´çš„åŒºåˆ«ã€‚ä¸ºæ­¤ï¼Œäººä»¬å¼€å‘å‡ºäº† ç½‘æ¡¥ bridgeã€‚\n\n\nå·¥ä½œåŸç†\n\n\nç½‘æ¡¥å·¥ä½œåœ¨ æ··æ‚æ¨¡å¼ promiscuous mode ä¸‹ï¼›ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒæ•è·æ‰€æœ‰å‘ç»™å®ƒçš„æ•°æ®ã€‚å¦‚æœå‘é€æ–¹å’Œæ¥æ”¶æ–¹è¿æ¥åœ¨ç½‘æ¡¥çš„åŒä¸€ä¸ªç«¯å£ä¸Šï¼Œé‚£ä¹ˆç½‘æ¡¥ç«‹åˆ»ä¸¢å¼ƒè¯¥åŒ…ï¼ˆå¦‚ A å‘ç»™ Cï¼‰ï¼›å¦‚æœä¸åœ¨ä¸€ä¸ªç«¯å£ï¼Œé‚£ä¹ˆç½‘æ¡¥å°†è¿™ä¸ªå¸§ä»æ¥æ”¶æ–¹å¯¹åº”çš„ç«¯å£è½¬å‘å‡ºå»ã€‚\nè¿™ç§è½¬å‘çš„å‰ææ˜¯ï¼Œç½‘æ¡¥åº”å½“çŸ¥é“æ¯ä¸€ä¸ªç«™ç‚¹è¿æ¥åœ¨å“ªä¸ªç«¯å£ã€‚å› æ­¤ï¼Œç½‘æ¡¥ä¸­é…å¤‡äº†ä¸€ä¸ªå“ˆå¸Œè¡¨ï¼ŒåŒ…å«äº†æ¯ä¸€ä¸ªå¯èƒ½çš„ç›®çš„ç«™ç‚¹ä»¥åŠå®ƒå¯¹åº”çš„ç«¯å£ã€‚å½“ç½‘æ¡¥çš„æŸä¸ªç«¯å£æ¥æ”¶åˆ°ä¸€ä¸ªå¸§ï¼Œå®ƒæŸ¥çœ‹è¿™ä¸ªå¸§çš„å‘é€ç«™ç‚¹ï¼Œè¿™æ ·å®ƒå°±å¾—çŸ¥é€šè¿‡è¿™ä¸ªç«¯å£èƒ½å¤Ÿè”ç³»åˆ°è¿™ä¸ªç«™ç‚¹ï¼ˆè¿™ç§è‡ªå­¦ä¹ æ–¹æ³•ç§°ä¸º åå‘å­¦ä¹ æ³• backward learningï¼‰ã€‚åŒæ—¶ï¼Œå®ƒæ£€æŸ¥è¿™ä¸ªå¸§çš„ç›®çš„ç«™ç‚¹æ˜¯å¦åœ¨è¡¨ä¸­ï¼›å¦‚æœåœ¨ï¼Œåˆ™å¦‚å‰è¿°é‚£æ ·è½¬å‘æˆ–ä¸¢å¼ƒï¼›å¦‚æœä¸åœ¨ï¼Œåˆ™ç½‘æ¡¥ä½¿ç”¨ flooding algorithmï¼Œå°†è¿™ä¸€å¸§å‘é€ç»™é™¤äº†å‘é€ç«¯å£ä»¥å¤–çš„æ‰€æœ‰ç«¯å£ã€‚\n\nå½“æœºå™¨æˆ–ç½‘æ¡¥è¢«æ‰“å¼€ã€å…³é—­æˆ–ç§»åŠ¨æ—¶ï¼Œç½‘ç»œçš„æ‹“æ‰‘ç»“æ„ä¼šå‘ç”Ÿå˜åŒ–ã€‚ä¸ºäº†å¤„ç†è¿™ç§åŠ¨æ€çš„æ‹“æ‰‘ç»“æ„ï¼Œè¡¨ä¸­è¿˜ä¿å­˜äº†è¿™ä¸€é¡¹äº§ç”Ÿæˆ–æ›´æ–°çš„æ—¶é—´ï¼ˆäº¦å³è¿™ä¸€å¸§åˆ°è¾¾çš„æ—¶é—´ï¼‰ã€‚ç½‘æ¡¥ä¸­è¿˜æœ‰ä¸€ä¸ªè¿›ç¨‹å®šæœŸæ‰«æè¿™ä¸ªè¡¨ï¼Œå¹¶å°†é‚£äº›æ—¶é—´å€¼åœ¨å‡ åˆ†é’Ÿä»¥å‰çš„è¡¨é¡¹æ¸…é™¤ã€‚\næŸ¥æ‰¾å’Œæ›´æ–°è¡¨é¡¹çš„å·¥ä½œåœ¨æ¯ä¸ªå¸§åˆ°æ¥æ—¶éƒ½éœ€è¦è¿›è¡Œä¸€æ¬¡ï¼›å› æ­¤ç½‘æ¡¥ä½¿ç”¨äº†ä¸“ç”¨çš„å¤§è§„æ¨¡é›†æˆç”µè·¯èŠ¯ç‰‡å®Œæˆè¿™ä¸€å·¥ä½œï¼Œæ¯æ¬¡åªéœ€è¦å‡ å¾®ç§’å°±èƒ½å®Œæˆã€‚ç½‘æ¡¥ä¸€çœ‹åˆ°ç›®çš„ MAC åœ°å€å°±çŸ¥é“å¦‚ä½•è½¬å‘å¸§ï¼›å› æ­¤ä¸€æ—¦å…¶çœ‹åˆ°ç›®çš„åœ°å€å­—æ®µå°±å¯ä»¥å¼€å§‹è½¬å‘ï¼Œæ­¤æ—¶å¸§çš„å…¶ä½™éƒ¨åˆ†å¯èƒ½è¿˜åœ¨è¾“å…¥ã€‚è¿™ç§æ–¹å¼é™ä½äº†å¸§é€šè¿‡ç½‘æ¡¥çš„å»¶è¿Ÿï¼Œä¹Ÿé™ä½äº†ç½‘æ¡¥éœ€è¦ç¼“å†²çš„å¸§æ•°ã€‚è¿™ç§è½¬å‘æ–¹å¼ç§°ä¸º ç›´é€šå¼äº¤æ¢ cut-through switching æˆ– è™«å­”è·¯ç”± wormhole routingã€‚\nä¸åŒç±»å‹çš„çº¿ç¼†éƒ½å¯ä»¥è¿æ¥åˆ°ä¸€ä¸ªç½‘æ¡¥ä¸Šï¼›å„ä¸ªç«¯å£ä¸Šçš„çº¿è·¯å¯ä»¥ä»¥ä¸åŒçš„é€Ÿåº¦è¿è¡Œï¼Œç”šè‡³å¯ä»¥æ˜¯ä¸åŒçš„ç½‘ç»œç±»å‹ã€‚ç½‘æ¡¥å†…éƒ¨æœ‰ç¼“å­˜ï¼Œå¦‚æœéœ€è¦å‘é€çš„ä¿¡é“å¿™ï¼Œæˆ–è€…å…¶é€Ÿåº¦æ…¢äºå‘é€æ–¹çš„é€Ÿåº¦ï¼Œç½‘æ¡¥å°±ä¼šç¼“å­˜è¿™äº›å¸§ï¼Œç­‰åˆ°åˆé€‚çš„æ—¶æœºå†å‘é€ã€‚å½“ç„¶ï¼Œç½‘æ¡¥ä¹Ÿæœ‰å¯èƒ½å› ä¸ºç¼“å†²ç©ºé—´è€—å°½è€Œä¸å¾—ä¸ä¸¢å¼ƒå¸§ã€‚\n\nä¸ºäº†æé«˜æ•ˆç‡ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è®©ç½‘æ¡¥çš„æ¯ä¸ªæ¥å£ç‹¬ç«‹åœ°è¿æ¥ä¸€ä¸ªç«™ç‚¹ï¼›ä¸Šå›¾å±•ç¤ºäº†é™¤äº†ä»æœ‰ä¸€ä¸ª Hub ä»¥å¤–å…¶ä»–çš„ç«™ç‚¹éƒ½ç›´æ¥è¿æ¥åœ¨äº†ç½‘æ¡¥ä¸Šã€‚å¯¹äºæ¯ä¸ªç«¯å£ï¼Œå¦‚æœå®ƒè¿æ¥çš„æ˜¯å…¨åŒå·¥çš„ç‚¹åˆ°ç‚¹é“¾è·¯ï¼Œé‚£ä¹ˆå®ƒå°±ä¸å†éœ€è¦ CSMA/CD ç­‰å†²çªå¤„ç†ç®—æ³•ï¼Œå› ä¸ºå®ƒä¸ä¼šå‘ç”Ÿå†²çªã€‚\n\nå†—ä½™é“¾è·¯ redundant links / parallel links\n\n\n\n\n\nä¸ºäº†æé«˜å¯é æ€§ï¼Œç½‘æ¡¥ä¹‹é—´å¯ä»¥ä½¿ç”¨å†—ä½™é“¾è·¯ï¼Œé˜²æ­¢åœ¨ä¸€æ¡é“¾è·¯å‡ºç°æ•…éšœæ—¶ä¸¤è¾¹ä¸ä¼šæ— æ³•è”ç³»ã€‚\n\n\nä½†æ˜¯ï¼Œè¿™æ ·çš„å†—ä½™å¼•å…¥äº†æ‹“æ‰‘ç¯è·¯ã€‚è€ƒè™‘è¿™æ ·çš„æƒ…å½¢ï¼šå¦‚ä¸Šå›¾ï¼Œåˆšå¼€å§‹ï¼ŒB1 å’Œ B2 çš„å“ˆå¸Œè¡¨éƒ½æ˜¯ç©ºçš„ã€‚æ­¤æ—¶ A ç»™ B1 å‘é€äº†ä¸€å¸§ F0ï¼ŒB1 å°†å¸§ä»å®ƒçš„æ‰€æœ‰ç«¯å£å‘é€äº†å‡ºå»ï¼Œä½†æ˜¯ç”±äºå®ƒåˆ° B2 æœ‰ä¸¤æ¡é“¾è·¯ï¼Œå› æ­¤å®ƒåœ¨è¿™ä¸¤æ¡é“¾è·¯ä¸Šåˆ†åˆ«å‘é€äº†å¸§ F1 å’Œ F2ã€‚æ­¤æ—¶ B2 æ”¶åˆ°äº†è¿™ä¸¤ä¸ªå¸§ï¼Œå¹¶ä¸çŸ¥é“è¿™ä¸¤ä¸ªå¸§æ˜¯åŒä¸€ä¸ªå¸§çš„å‰¯æœ¬ï¼Œå› æ­¤å®ƒåˆ†åˆ«å¯¹è¿™ä¸¤ä¸ªå¸§è¿›è¡Œ floodingï¼›è¿™æ ·å°±ä¼šå¯¼è‡´ F1 çš„å‰¯æœ¬ä» F2 çš„é“¾è·¯è¢«å‘å› B1ï¼ŒF2 çš„å‰¯æœ¬ä» F1 çš„é“¾è·¯å‘å› B1ï¼Œä»æ­¤é€ æˆè¿™ä¸ªå¾ªç¯æ— çº¿è¿›è¡Œä¸‹å»ã€‚\n\n\nè§£å†³è¿™ç§é—®é¢˜çš„æ–¹æ³•æ˜¯ç”Ÿæˆæ ‘ç®—æ³• Spanning Tree Algorithmï¼›æˆ‘ä»¬é€šè¿‡ä¸ä½¿ç”¨ä¸€äº›é“¾è·¯è®©å›¾ç®€åŒ–æˆä¸€ä¸ªæ— ç¯çš„è¿é€šç»“æ„ï¼Œå³ç”Ÿæˆæ ‘ã€‚\n\n\n\n\n\nè¿™ç§ç®—æ³•çš„æµç¨‹æ˜¯è¿™æ ·çš„ï¼šæ¯ä¸ªç½‘æ¡¥å‘¨æœŸæ€§åœ°ä»å®ƒçš„æ‰€æœ‰ç«¯å£å¹¿æ’­ä¸€ä¸ªé…ç½®ä¿¡æ¯ configuration messageï¼ŒåŒæ—¶å¤„ç†æ¥è‡ªå…¶ä»–ç½‘æ¡¥çš„ä¿¡æ¯ã€‚è¿™äº›ä¿¡æ¯ä¸ä¼šè¢«è½¬å‘ã€‚é¦–å…ˆï¼Œå…¨ä½“ç½‘æ¡¥å¿…é¡»é€‰æ‹©ä¸€ä¸ªç½‘æ¡¥ä½œä¸ºç”Ÿæˆæ ‘çš„æ ¹ã€‚è¿™ä¸€é€‰æ‹©æ˜¯é€šè¿‡åœ¨è‡ªå·±çš„é…ç½®æ¶ˆæ¯ä¸­åŒ…å«ä¸€ä¸ªåŸºäº MAC åœ°å€çš„æ ‡è¯†ç¬¦ï¼›ç½‘æ¡¥é€‰æ‹©å…·æœ‰æœ€ä½æ ‡è¯†ç¬¦çš„ç½‘æ¡¥ä½œä¸ºç”Ÿæˆæ ‘çš„æ ¹ï¼›é€šè¿‡è¶³å¤Ÿçš„æ¶ˆæ¯äº¤æ¢ï¼Œæ‰€æœ‰ç½‘æ¡¥éƒ½å°†åŒæ„è¿™ä¸ªæ ¹ã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬é€‰æ‹©æ‰€æœ‰ä¸æ ¹ç›´æ¥è¿æ¥çš„ç½‘æ¡¥ï¼Œå®ƒä»¬åˆ°æ ¹çš„æœ€çŸ­è·¯å¾„éƒ½æ˜¯ä¸€è·³ã€‚æ­¤åï¼Œæˆ‘ä»¬æ¯æ¬¡é€‰æ‹©ä¸Šä¸€æ¬¡é€‰å‡ºçš„ç½‘æ¡¥é€šè¿‡ä¸€è·³å¯ä»¥åˆ°è¾¾çš„æœªè¢«é€‰ä¸­çš„æ‰€æœ‰ç½‘æ¡¥ï¼Œç›´åˆ°å…¨éƒ¨ç½‘æ¡¥éƒ½è¢«é€‰ä¸­ã€‚å¦‚æœè¿‡ç¨‹ä¸­ä¸¤ä¸ªæˆ–å¤šä¸ªç½‘æ¡¥éƒ½è¯•å›¾æ‰©å±•åˆ°ä¸€ä¸ªæ–°çš„ç½‘æ¡¥ï¼Œé‚£ä¹ˆå…¶ä¸­æ ‡è¯†ç¬¦æœ€ä½çš„é‚£ä¸ªç½‘æ¡¥è·å¾—è¿™ä¸ªæ–°çš„ç½‘æ¡¥çš„æ‰©å±•æƒã€‚åœ¨è¿‡ç¨‹ä¸­ï¼Œç½‘æ¡¥åœ¨å®ƒä»¬çš„é…ç½®ä¿¡æ¯ä¸­è¿˜ä¼šåŒ…æ‹¬ä¸æ ¹çš„è·ç¦»ã€‚æ¯ä¸ªç½‘æ¡¥è®°ä½å®ƒæ‰¾åˆ°çš„åˆ°æ ¹çš„æœ€çŸ­è·¯å¾„ï¼Œç„¶åå…³é—­ä¸å±äºè¿™æ¡è·¯å¾„çš„ç«¯å£ã€‚\n\n\nåœ¨ç½‘ç»œæ­£å¸¸æ“ä½œæœŸé—´ï¼Œè¯¥ç®—æ³•ä»éœ€è¦ç»§ç»­è¿è¡Œï¼Œä»¥ä¾¿è‡ªåŠ¨æ£€æŸ¥æ‹“æ‰‘ç»“æ„çš„å˜åŒ–ï¼Œå¹¶æ›´æ–°ç”Ÿæˆæ ‘ã€‚ç”Ÿæˆæ ‘ç®—æ³•éšåè¢«æ ‡å‡†åŒ–ä¸º IEEE 802.1Dã€‚\n\n\nè®¨è®º\n\n\n\n\n\nè€ƒå¯Ÿä¸Šå›¾è¿™ç§æƒ…å†µå‘ç”Ÿå†²çªçš„å¯èƒ½ã€‚å®¹æ˜“å‘ç°ï¼Œæ­¤æ—¶ ABC ä¸‰ä¸ªç«™ä»¥åŠç½‘æ¡¥çš„ç«¯å£ 1 ä¹‹é—´æ˜¯æœ‰å¯èƒ½äº’ç›¸å†²çªçš„ï¼›DEFG å’Œç½‘æ¡¥çš„ç«¯å£ 2 ä¹‹é—´ä¹Ÿå¯èƒ½å†²çªã€‚ä½†æ˜¯ï¼Œç”±äºç½‘æ¡¥çš„è½¬å‘ä½œç”¨ï¼Œè¿™äº›ç«™è¢«éš”ç¦»ä¸ºå·¦å³ä¸¤è¾¹ï¼Œå®ƒä»¬ä¹‹é—´ä¸ä¼šå‘ç”Ÿå†²çªã€‚æˆ‘ä»¬ç§°å¯èƒ½ä¼šç›¸äº’å†²çªçš„èŠ‚ç‚¹çš„é›†åˆç§°ä¸º å†²çªåŸŸ collision domainã€‚å¯ä»¥çœ‹åˆ°ï¼Œç½‘æ¡¥ä¹Ÿæœ‰éš”ç¦»å†²çªåŸŸçš„ä½œç”¨ï¼›è¿æ¥åœ¨ç½‘æ¡¥åŒä¸€ç«¯å£ä¸Šçš„æ‰€æœ‰ç«™å±äºä¸€ä¸ªå†²çªåŸŸã€‚\n\n\nç½‘æ¡¥å·¥ä½œåœ¨æ•°æ®é“¾è·¯å±‚ã€‚è¿™ä¹ˆè¯´çš„åŸå› æ˜¯ï¼Œç½‘æ¡¥ä¼šæŸ¥çœ‹ MAC å­å±‚çš„æºå’Œç›®çš„åœ°å€ä¿¡æ¯ï¼Œä½†ä¸ä¼šæŸ¥çœ‹æ›´é«˜å±‚çš„ä¿¡æ¯ã€‚ä¹‹æ‰€ä»¥æˆ‘ä»¬è¯´ä¸åŒçš„è®¾å¤‡å·¥ä½œåœ¨ä¸åŒçš„å±‚ä¸Šï¼Œå°±æ˜¯å› ä¸ºè¿™äº›è®¾å¤‡æ ¹æ®ä¸åŒçš„ä¿¡æ¯å†³å®šå¦‚ä½•äº¤æ¢ã€‚ä¸‹å›¾æ˜¾ç¤ºäº†ç½‘æ¡¥ä¸Šçš„åè®®æ ˆå¤„ç†ã€‚\n\n\n\n\n\nç½‘æ¡¥æœ€åˆè¢«ç”¨æ¥è¿æ¥ä¸åŒç§ç±»çš„å±€åŸŸç½‘ï¼Œä¾‹å¦‚å°†ä¸€ä¸ªä»¥å¤ªç½‘å’Œä¸€ä¸ªä»¤ç‰Œç¯ç½‘è¿æ¥åœ¨ä¸€èµ·ã€‚ä½†æ˜¯ï¼Œç”±äºä¸åŒå±€åŸŸç½‘ä¹‹é—´çš„å·®å¼‚ï¼Œè¿™äº›å·¥ä½œå¹¶ä¸éƒ½èƒ½å®Œç¾åœ°å®Œæˆã€‚ä¸åŒçš„å¸§æ ¼å¼éœ€è¦é‡æ–°å¤„ç†ï¼Œä¼šå¼•å…¥é¢å¤–çš„ç”¨æ—¶å’Œæ–°çš„é”™è¯¯å¯èƒ½ã€‚æœ‰äº›å¸§ä¹Ÿå¯èƒ½è¿‡å¤§æ— æ³•è½¬å‘å› è€Œä¸å¾—ä¸ä¸¢å¼ƒã€‚æœ‰çš„å±€åŸŸç½‘å¦‚ WLAN æä¾›äº†ä¸€äº›å®‰å…¨æœºåˆ¶å’ŒæœåŠ¡è´¨é‡ï¼Œä½†ä»¥å¤ªç½‘ç­‰å±€åŸŸç½‘å¹¶æ²¡æœ‰è¿™äº›æ¦‚å¿µï¼›å› æ­¤è¿™äº›æœŸå¾…ä¹Ÿä¸èƒ½å¾—åˆ°ä¿è¯ã€‚å› æ­¤ï¼Œçº¿ä»£ç½‘æ¡¥ä¸€èˆ¬éƒ½å·¥ä½œåœ¨ä¸€ç§ç½‘ç»œç±»å‹ä¸Šï¼Œè¿æ¥ä¸åŒç±»å‹ç½‘ç»œçš„è´£ä»»äº¤ç»™è·¯ç”±å™¨æ¥å®Œæˆã€‚\n\n\n\n\n\näº¤æ¢æœºæ€§èƒ½ä¸Šçš„ä¼˜è¶Šæ€§ï¼Œé™¤äº†åœ¨éš”ç¦»å†²çªåŸŸç”šè‡³åœ¨ç‚¹å¯¹ç‚¹ã€å…¨åŒå·¥çš„æƒ…å†µä¸‹æ¶ˆé™¤å†²çªçš„å¯èƒ½ä¹‹å¤–ï¼Œä¹Ÿåœ¨äºå…¶è¾ƒé«˜çš„å¹¶å‘æ€§ã€‚ç«¯å£ 1 å‘ç«¯å£ 2 å‘é€çš„å¸§å’Œç«¯å£ 3 å‘ç«¯å£ 4 å‘é€çš„å¸§å¯ä»¥è¢«äº’ä¸å½±å“åœ°å¹¶è¡Œå‘é€å‡ºå»ï¼›è¿™æ˜¯é›†çº¿å™¨æ‰€ä¸èƒ½åšåˆ°çš„ã€‚\n\n\näº¤æ¢å¼ä»¥å¤ªç½‘ Switched Ethernet\n\näº¤æ¢æœº switch æ˜¯ç°ä»£ç½‘æ¡¥çš„å¦ä¸€ä¸ªç§°å‘¼ï¼›å®ƒæ˜¯äº¤æ¢å¼ä»¥å¤ªç½‘çš„æ ¸å¿ƒã€‚ç°åœ¨çš„ä»¥å¤ªç½‘äº¤æ¢æœºéƒ½æ˜¯å…¨åŒå·¥ã€ç‚¹å¯¹ç‚¹çš„ï¼Œå› æ­¤å†²çªä¸å¯èƒ½å‘ç”Ÿï¼Œä¹Ÿä¸å†éœ€è¦ CSMA/CD ç®—æ³•äº†ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œä»¥å¤ªç½‘äº¤æ¢æœºä»ç„¶å¯ä»¥è¿æ¥é›†çº¿å™¨ï¼Œé›†çº¿å™¨çš„å„ä¸ªç«¯å£å¸Œæœ›å‘é€çš„æ¶ˆæ¯é€šè¿‡ç«äº‰åé€è¾¾ä»¥å¤ªç½‘äº¤æ¢æœºï¼›ä½†ä»¥å¤ªç½‘å¯¹æ­¤å¹¶ä¸éœ€è¦çŸ¥æƒ…ã€‚ä¸è¿‡ç”±äºäº¤æ¢æœºçš„ä»·æ ¼åœ¨ä¸æ–­ä¸‹é™ï¼Œä¼ ç»Ÿçš„é›†çº¿å™¨ä¹Ÿæ¸æ¸æˆä¸ºå†å²ã€‚\n\n\nVLAN, Virtual Local Area Network\n\nåœ¨å…³äºç½‘æ¡¥çš„è®¨è®ºä¸­ï¼Œæˆ‘ä»¬è®¨è®ºäº†åŒä¸€ç»„ç»‡çš„å¤šä¸ª LAN äº’ç›¸è¿æ¥çš„å¿…è¦æ€§ã€‚å¦å¤–æˆ‘ä»¬ä¹Ÿåº”æ³¨æ„åˆ°ï¼ŒåŒä¸€ç»„ç»‡çš„å¤šä¸ª LAN ä¹Ÿå¯èƒ½å‘æŒ¥ä¸åŒçš„ä½œç”¨å› è€Œæœ‰ä¸åŒçš„éœ€æ±‚ã€‚ä¾‹å¦‚ï¼Œä» å®‰å…¨æ€§ å‡ºå‘ï¼Œæœ‰çš„ LAN éƒ¨ç½²ç€ Web æœåŠ¡å™¨ä¾›å…¶ä»–è®¡ç®—æœºè®¿é—®ï¼Œä½†æœ‰çš„ LAN å­˜å‚¨ç€ä¸åº”æµä¼ åˆ°ç»„ç»‡å¤–çš„ä¿¡æ¯ï¼›åˆå¦‚ä¸åŒçš„ LAN å¯èƒ½æœ‰ä¸åŒçš„ è´Ÿè½½ï¼Œä½†è¯¸å¦‚ç”¨äºå®æ—¶é€šè®¯çš„ LAN å¯èƒ½ä¸æ„¿æ„åˆ†äº«å®ƒçš„å¸¦å®½ç­‰ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åœ¨ä¸€ä¸ªç»„ç»‡ä¸­ä¹Ÿæƒ³è¦ç»´æŠ¤è‹¥å¹²ä¸åŒçš„ LANã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬å¸Œæœ›å°†ç‰©ç†æ‹“æ‰‘ä¸é€»è¾‘æ‹“æ‰‘åˆ†ç¦»å¼€ï¼Œè¿™æ ·å°±èƒ½é¿å…ç”±äºäººäº‹å˜åŠ¨æˆ–è€…æŸä¸ªå‘˜å·¥æ›´æ¢åŠå…¬å®¤ç­‰æƒ…å†µä¸‹å¯¼è‡´éœ€è¦é¢‘ç¹æ›´æ”¹çº¿è·¯çš„ç‰©ç†ç»“æ„ç­‰æƒ…å†µï¼Œæé«˜ç½‘ç»œçš„çµæ´»æ€§ã€‚å› æ­¤æˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿæœ‰ä¸€ç§æŠ€æœ¯ï¼Œé€šè¿‡é€»è¾‘è€Œä¸æ˜¯ç‰©ç†çš„å±‚é¢åˆ’åˆ† LANã€‚å› æ­¤æˆ‘ä»¬æå‡º VLANã€‚\n\nVLAN åŸºäº VLAN-aware switchesï¼Œæˆ‘ä»¬ç”¨ä¸åŒçš„é¢œè‰²æ ‡è¯†ä¸åŒçš„ VLANï¼Œä¾‹å¦‚åœ¨ä¸Šé¢è¿™ä¸ªå›¾ä¸­æœ‰ç™½è‰² W å’Œç°è‰² G ä¸¤ä¸ª VLANã€‚å½“ä¸€ä¸ªæ¥è‡ªç°è‰²ç«¯å£çš„å¸§å‘é€ç»™äº¤æ¢æœºæ—¶ï¼Œå®ƒå°†è¿™ä¸€å¸§è½¬å‘ç»™æ‰€æœ‰æ ‡è®°ä¸º G çš„ç«¯å£ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸€ä¸ªç«¯å£å¯èƒ½è¢«æ ‡è®°ä¸ºå¤šä¸ªé¢œè‰²ã€‚è¿™æ ·ç®€å•çš„æ€è·¯å¯èƒ½å¸¦æ¥ä¸€äº›é—®é¢˜ã€‚ä¾‹å¦‚ï¼Œæ¥è‡ªå›¾ä¸­ Hub çš„å¸§è¿æ¥åœ¨ B2 ä¸€ä¸ªæ ‡ä¸º GW çš„ç«¯å£ï¼Œé‚£ä¹ˆäº¤æ¢æœºåº”å½“å¦‚ä½•è½¬å‘è¿™ä¸€å¸§ï¼Ÿç±»ä¼¼åœ°ï¼Œå¦‚æœ B1 æ”¶åˆ°äº†æ¥è‡ª B2 çš„ä¸€ä¸ªå¸§ï¼Œåˆåº”è¯¥å¦‚ä½•è½¬å‘ï¼Ÿæˆ‘ä»¬å¯ä»¥è®¤è¯†åˆ°ï¼Œä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œæˆ‘ä»¬å¿…é¡»ä¼ é€’ä¸€äº›é™„åŠ çš„ä¿¡æ¯ã€‚\næˆ‘ä»¬å¸Œæœ› VLAN ä½¿ç”¨åœ¨ä»¥å¤ªç½‘ä¸Šï¼Œä½†æ˜¯ä»¥å¤ªç½‘çš„å¸§ç»“æ„æ²¡æœ‰ä»€ä¹ˆç©ºé—²çš„å­—æ®µå¯ä¾›æˆ‘ä»¬é™„åŠ ä¸€ä¸ªå¸§çš„ VLAN ä¿¡æ¯ã€‚å› æ­¤ä¸€ä¸ªæ–°çš„å¸§ç»“æ„è¢«æå‡ºäº†ï¼Œå‘è¡¨äº IEEE 802.1Q æ ‡å‡†ä¸­ï¼›åŒæ—¶ä¸ºäº†é€‚åº”è¿™ä¸ªå¸§ç»“æ„ï¼Œå¸§é•¿çš„ä¸Šé™è¢«è°ƒæ•´åˆ°äº† 1522 å­—èŠ‚ï¼š\n\nåœ¨è®¨è®ºè¿™ä¸ªå¸§ç»“æ„çš„ç»†èŠ‚ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦æ˜ç¡®çš„æ˜¯ï¼Œåœ¨è¿™ç§æ ‡å‡†ä¸‹ VLAN-aware çš„å’Œä¼ ç»Ÿçš„äº¤æ¢æœºå’Œè®¡ç®—æœºå¯ä»¥æ¯”è¾ƒå¥½åœ°å¹¶å­˜ã€‚è¿™ä¸€ç‰¹æ€§çš„å®ç°æ–¹å¼æ˜¯ï¼Œåœ¨ä»»ä¸€è·¯å¾„ä¸Šçš„é¦–ä¸ª VLAN-aware è®¾å¤‡è´Ÿè´£æ·»åŠ ä¸Š VLAN çš„é¢å¤–å­—æ®µï¼Œè·¯å¾„ä¸Šæœ€åä¸€ä¸ªè¿™æ ·çš„è®¾å¤‡è´Ÿè´£å°†é¢å¤–å­—æ®µåˆ é™¤ã€‚å› æ­¤ï¼Œåªæœ‰ VLAN-aware çš„è®¾å¤‡ä¼šçœ‹åˆ°è¿™äº›é¢å¤–çš„å­—æ®µï¼š\n\n\n\nVLAN protocol ID (2 Bytes), always has the value 0x81002. VLAN Identifier (12 bits), the color(Pri 5 bits, CFI 1 bit ä¸ VLAN æ— å…³)\n\n\né¢œè‰²æŒ‰ç«¯å£ä¸ºå•ä½åˆ’åˆ†ã€‚With 802.1Q, frames are colored depending on the port on which they are received. For this method to work, all machines on a port must belong to the same VLAN, which reduces flexibility.\nç”¨é«˜å±‚åè®®å†³å®šé¢œè‰²ã€‚Additionally, the bridge can use the higher-layer protocol to select the color. In this way, frames arriving on a port might be placed in different VLANs depending on whether they carry IP packets or PPP frames.\nå…¶ä»–ä¾‹å­ï¼šç”¨ MAC åœ°å€å†³å®šé¢œè‰²ã€‚Other methods are possible, but they are not supported by 802.1Q. As one example, the MAC address can be used to select the VLAN color. This might be useful for frames coming in from a nearby 802.11 LAN in which laptops send frames via different ports as they move. One MAC address would then be mapped to a fixed VLAN regardless of which port it entered the LAN on.\nQ: è®¡ç½‘æ•™æç¬¬å››ç« ä¸­è®²è§£çš„VLANæ˜¯ä¸æ˜¯å°±æ˜¯å®ç°äº†ä¸€ç§ç»„æ’­çš„æ•ˆæœï¼Ÿé‚£ä¸ºä»€ä¹ˆä¸ç”¨ç»„æ’­MACåœ°å€å®ç°å‘¢ï¼Ÿåˆï¼ŒMACåœ°å€çš„ç»„æ’­æ˜¯æ€ä¹ˆå®ç°çš„ï¼ŸA: (by @é™ˆå®‡) VLAN å’Œç»„æ’­ MAC åœ°å€æ˜¯å‡ºäºå®Œå…¨ä¸åŒçš„ç›®çš„è€Œè®¾è®¡çš„ã€‚VLANï¼šç”±äº¤æ¢æœºæ§åˆ¶ï¼Œå°†å±äºä¸åŒ VLAN çš„ä¸»æœºè¿›è¡Œ ç½‘ç»œéš”ç¦»ï¼Œæ‰€æœ‰æ•°æ®åŒ…åªåœ¨ VLAN å†…éƒ¨äº’é€šï¼Œä¸åŒçš„ VLAN ä¹‹é—´çš„æ•°æ®åŒ…æ˜¯ä¸äº’é€šçš„ã€‚ç»„æ’­ MAC åœ°å€ï¼šè™½ç„¶åä¹‰ä¸Šåˆ’åˆ†äº†ä¸åŒçš„ç»„ï¼Œä½†å¸¦æœ‰ç»„æ’­ MAC åœ°å€çš„åŒ…å®é™…ä¸Šä¼šè¢«è½¬å‘ç»™åŒä¸€å†…ç½‘ä¸‹ æ‰€æœ‰ä¸»æœºï¼Œæ— è®ºå®ƒä»¬æ˜¯å¦å±äºè¿™ä¸ªç»„ã€‚æ‰€æœ‰çš„ä¸»æœºéœ€è¦ è‡ªå·±å†³å®šæ”¶ä¸æ”¶è¿™äº›åŒ…ã€‚è¿™å°±æ— æ³•é˜²æ­¢æœ‰äººæ•…æ„çªƒå¬ä¸å±äºè‡ªå·±çš„åŒ…ï¼Œä¹Ÿæ— æ³•é˜²æ­¢æœ‰äººå‘å…¶å®ƒç»„æ¶æ„å‘é€æ•°æ®åŒ…ï¼Œå…¶å®‰å…¨æ€§ä¸å¦‚ VLANã€‚å› æ­¤ï¼ŒVLAN ä¸æ˜¯ç»„æ’­ï¼ŒVLAN çš„ç›®çš„æ˜¯éš”ç¦»å’Œå®‰å…¨æ€§ï¼Œè€Œä¸æ˜¯ä¸ºäº†æ›´æ–¹ä¾¿åœ°åœ¨ç»„å†…ä¼ è¾“æ•°æ®ã€‚ç»„æ’­ä¹Ÿä¸èƒ½ä»£æ›¿ VLANã€‚\n\nWLAN\n\n\nä¸€äº›é—®é¢˜\n\n\næ— çº¿é€šä¿¡ç³»ç»Ÿé€šå¸¸ä¸èƒ½æ£€æµ‹å‡ºæ­£åœ¨å‘ç”Ÿçš„å†²çªï¼Œå› ä¸ºå®ƒæ”¶åˆ°çš„ä¿¡å·æ¯”å‘å‡ºçš„ä¿¡å·å¾®å¼±å¾—å¤šã€‚æ— çº¿é€šä¿¡ç³»ç»Ÿçš„ä¼ è¾“èŒƒå›´ä¹Ÿæœ‰é™ï¼Œå› æ­¤ä¸€ä¸ªç«™å‘å‡ºçš„ä¿¡å·å¯èƒ½ä¸èƒ½åˆ°è¾¾å…¶ä»–æ‰€æœ‰ç«™ï¼›è¿™ä¹Ÿä¼šå¼•èµ·ä¸‹é¢ä¸¤ç§é—®é¢˜ï¼š\n\n\néšè—ç»ˆç«¯é—®é¢˜ hidden terminal problemå¦‚ä¸‹å›¾ (a)ï¼Œå¦‚ C æƒ³è¦ç»™ B å‘é€æ•°æ®ï¼Œå®é™…ä¸Šæ­¤æ—¶ A æ­£åœ¨ç»™ B å‘é€æ•°æ®ï¼›ä½†ç”±äº C åœ¨ A çš„æ— çº¿ä¼ æ’­è·ç¦»ä¹‹å¤–ï¼Œå¹¶æ²¡æœ‰ç›‘å¬åˆ° A å‘é€çš„ä¿¡å·ï¼Œå› æ­¤å®ƒå‘é€å‡ºæ•°æ®å¹¶åœ¨ B å¤„ä¸ A çš„æ•°æ®å†²çªï¼ŒåŒæ–¹å‘é€å¤±è´¥ã€‚The problem of a station not being able to detect a potential competitor for the medium because the competitor is too far away.\n\n\næš´éœ²ç»ˆç«¯é—®é¢˜ exposed terminal problemå¦‚ä¸‹å›¾ (b)ï¼ŒB æ­£åœ¨ç»™ A å‘é€æ¶ˆæ¯ï¼›æ­¤æ—¶ C è¯•å›¾ç»™ D å‘é€æ¶ˆæ¯ï¼Œä½†æ˜¯å®ƒä¾¦å¬åˆ°äº†æ¥è‡ª B çš„ä¿¡å·ï¼Œè®¤ä¸ºæ­¤æ—¶åº”è¯¥ç­‰å¾…ã€‚è€Œäº‹å®ä¸Šï¼Œæ­¤æ—¶ C ç»™ D å‘é€ä¿¡å·å¹¶ä¸ä¼šå—åˆ°å¹²æ‰°ï¼›å› æ­¤è¿™ç§ç­‰å¾…å¼•å‘äº†æ— æ„ä¹‰çš„æ—¶å»¶ã€‚\n\n\n\n\n\nè¿™ä¸¤ä¸ªé—®é¢˜çš„æ ¹æœ¬åŸå› åœ¨äºï¼Œå‘é€ç«¯åªèƒ½çŸ¥é“å‘é€å¤„æ˜¯å¦æœ‰å…¶ä»–æ— çº¿ç”µä¿¡å·ï¼›ä½†æ˜¯å®é™…ä¸Šå½±å“ä¿¡å·æ¥å—ç»“æœçš„æ˜¯æ¥æ”¶ç«¯é™„è¿‘æœ‰æ— å…¶ä»–æ— çº¿ç”µä¿¡å·å¹²æ‰°ã€‚åœ¨æœ‰çº¿é€šä¿¡ä¸­ï¼Œç”±äºä¸å­˜åœ¨ä¼ æ’­èŒƒå›´è¿™ä¸ªé™åˆ¶ï¼Œè¿™ä¸¤ä¸ªæ¦‚å¿µæ˜¯ç­‰åŒçš„ï¼›ä½†æ˜¯åœ¨æ— çº¿é€šä¿¡ä¸­åªè¦æ¥æ”¶æ–¹äº’ä¸å¹²æ‰°ï¼Œå¤šä¸ªä¼ è¾“å¯ä»¥åŒæ—¶å‘ç”Ÿã€‚æˆ‘ä»¬ä¹Ÿåº”å½“åˆ©ç”¨è¿™ç§å¹¶å‘æ€§ã€‚\n\n\nå†²çªé¿å…å¤šè·¯è®¿é—® MACA, Multiple Access with Collision Avoidance\n\nA æƒ³è¦ç»™ B å‘é€æ•°æ®å‰ï¼Œå…ˆå‘é€ä¸€ä¸ª RTS, Request to Sendï¼Œå¹¶åœ¨å…¶ä¸­åŒ…å«ç›®æ ‡ B å’Œæƒ³è¦å‘é€çš„æ•°æ®å¸§çš„é•¿åº¦ï¼›B åœ¨æ”¶åˆ°è¿™ä¸ª RTS åï¼Œå›å¤ä¸€ä¸ª CTS, Clear to Sendï¼Œå…¶ä¸­ä¹ŸåŒ…å«ä» RTS ä¸­å¾—çŸ¥çš„è¿™ä¸ªé•¿åº¦ï¼›A åœ¨æ”¶åˆ° CTS åå¼€å§‹ä¼ è¾“ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒA çš„ä¼ æ’­èŒƒå›´å†…çš„æ‰€æœ‰ç«™éƒ½ä¼šå¬åˆ°è¿™ä¸ª RTSï¼›å¬åˆ° RTS çš„ç«™å°±ä¼šå¾—çŸ¥ï¼šå®ƒä»¬ç¦» A è¶³å¤Ÿè¿‘ï¼Œå› æ­¤ä¸ºäº†é¿å…ä¸ A æ”¶åˆ°çš„ CTS å‘ç”Ÿå†²çªï¼Œå®ƒå¿…é¡»ä¿æŒæ²‰é»˜ï¼Œç›´åˆ° A å¼€å§‹å‘é€ä¿¡æ¯ã€‚åŒæ ·çš„ï¼Œå¬åˆ° CTS çš„æ‰€æœ‰ç«™éƒ½å°†ä¼šçŸ¥é“ï¼šåœ¨æœªæ¥çš„ä¸€æ®µæ—¶é—´ï¼ˆå¯ä»¥ä» CTS ä¸­çš„é•¿åº¦æ¨æµ‹ï¼‰å†…ï¼Œå®ƒä»¬å¿…é¡»ä¿æŒæ²‰é»˜ï¼Œå¦åˆ™å°±ä¼šä¸ B æ”¶åˆ°çš„ä¿¡æ¯å‘ç”Ÿå†²çªã€‚\n\n\nIEEE 802.11\n\n\nArchitecture, Protocol Stack &amp; Phy Layer\n\n\n\n\n\n\n\n\nU-NIIï¼šæ— éœ€è®¸å¯çš„å›½å®¶ä¿¡æ¯åŸºç¡€å»ºè®¾\n\n\nä½¿ç”¨çš„é¢‘å¸¦ã€‚All of the 802.11 techniques use short-range radios to transmit signals in either the 2.4-GHz or the 5-GHz ISM (Industrial, Scientific, Medical) frequency bands, which are unlicensed and hence freely available to any transmitter willing to meet some restrictions, such as radiated power of at most 1 W (though 50 mW is more typical for wireless LAN radios).The 2.4-GHz band tends to be more crowded than the 5-GHz band, so 5 GHz can be better for some applications even though it has shorter range due to the higher frequency.\n\n\né€Ÿç‡è‡ªé€‚åº”ã€‚All of the transmission methods also define multiple rates. The idea is that different rates can be used depending on the current conditions. If the wireless signal is weak, a low rate can be used. If the signal is clear, the highest rate can be used. This adjustment is called rate adaptation. Since the rates vary by a factor of 10 or more, good rate adaptation is important for good performance. Of course, since it is not needed for interoperability, the standards do not say how rate adaptation should be done. é€Ÿç‡è¶Šä½å°±å¯ä»¥ç”¨è¶Šå¥½çš„è°ƒåˆ¶æ–¹æ³•ã€‚\n\n\nMAC Sublayer Protocol\nCSMA/CA\n\næ— çº¿ç”µå‡ ä¹æ€»æ˜¯åŠåŒå·¥çš„ï¼Œæ‰€ä»¥åšä¸åˆ°é”™è¯¯æ£€æµ‹ã€‚å› æ­¤ï¼Œ802.11 å°è¯•ä½¿ç”¨åè®® CSMA/CA (CSMA with Collision Avoidance) æ¥é¿å…å†²çªã€‚This protocol is conceptually similar to Ethernetâ€™s CSMA/CD, with channel sensing before sending and exponential back off after collisions. However, a station that has a frame to send starts with a random backoff (except in the case that it has not used the channel recently and the channel is idle)\nå‘é€å‰ä¾¦å¬ã€‚The station waits until the channel is idle, by sensing that there is no signal for a short period of time (called the DIFS), and counts down idle slots, pausing when frames are sent.\nç¡®è®¤ã€‚If the frame gets through, the destination immediately sends a short acknowledgement. Lack of an acknowledgement is inferred to indicate an error, whether a collision or otherwise.\n\nå’Œä»¥å¤ªç½‘çš„åŒºåˆ«ã€‚1. ä»¥åé€€å¼€å§‹ã€‚ Starting backoffs early helps to avoid collisions. This avoidance is worthwhile because collisions are expensive, as the entire frame is transmitted even if one occurs.2. Acknowledgements are used to infer collisions because collisions cannot be detected.\nThis mode of operation is called DCF (Distributed Coordination Function) åˆ†å¸ƒå¼åè°ƒ because each station acts independently, without any kind of central control. The standard also includes an optional mode of operation called PCF (Point Coordination Function) in which the access point controls all activity in its cell. However, PCF is not used in practice because there is normally no way to prevent stations in another nearby network from transmitting competing traffic.\n\nVirtual channel sensing\n\n802.11 defines channel sensing to consist of both physical sensing and virtual sensing. Physical sensing simply checks the medium to see if there is a valid signal. With virtual sensing, each station keeps a logical record of when the channel is in use by tracking the NAV (Network Allocation Vector). Each frame carries a NAV field that says how long the sequence of which this frame is part will take to complete. Stations that overhear this frame know that the channel will be busy for the period indicated by the NAV, regardless of whether they can sense a physical signal.\n\nHowever, while RTS/CTS sounds good in theory, it is one of those designs that has proved to be of little value in practice.1. It does not help for short frames or for the AP.2. It does not help with exposed terminals as MACA did, only with hidden terminals. å› ä¸ºè¦ç­‰åˆ° ACK ç»“æŸã€‚Most often there are few hidden terminals, and CSMA/CA already helps them by slowing down stations that transmit unsuccessfully\n\nä¸€äº›å…¶ä»–æœºåˆ¶\n\n\nReliabilityæ— çº¿ç½‘ç»œç¯å¢ƒå˜ˆæ‚ï¼Œéœ€è¦å¢åŠ ä¼ è¾“æˆåŠŸçš„æ¦‚ç‡\n\n\nlower the transmission rateSlower rates use more robust modulations that are more likely to be received correctly for a given signal-to-noise ratio. If too many frames are lost, a station can lower the rate. If frames are delivered with little loss, a station can occasionally test a higher rate to see if it should be used. (Rate adaption)\n\n\nsend shorter frameså¦‚æœæ¯ä¸ª bit å‡ºé”™æ¦‚ç‡ä¸€è‡´ï¼Œå¸§è¶ŠçŸ­åˆ™æ— é”™å‘é€çš„æ¦‚ç‡è¶Šå¤§1. reducing the maximum size of the message that is accepted from the network layer2. 802.11 allows frames to be split into smaller pieces, called fragments, each with its own checksum. The fragment size is not fixed by the standard, but is a parameter that can be adjusted by the AP. The fragments are individually numbered and acknowledged using a stop-and-wait protocol. Once the channel has been acquired, multiple fragments are sent as a burst. They go one after the other with an acknowledgement (and possibly retransmissions) in between, until either the whole frame has been successfully sent or the transmission time reaches the maximum allowed.\n\n\nSaving Powerç§»åŠ¨æ— çº¿è®¾å¤‡éœ€è¦è€ƒè™‘ç”µæ± çš„å¯¿å‘½\n\n\nBeacon Frames. Beacons are periodic broadcasts by the AP (e.g., every 100 msec). The frames advertise the presence of the AP to clients and carry system parameters, such as the identifier of the AP, the time, how long until the next beacon, and security settings. Clients can set a power-management bit in frames that they send to the AP to tell it that they are entering power-save mode. In this mode, the client can doze and the AP will buffer traffic intended for it. To check for incoming traffic, the client wakes up for every beacon, and checks a traffic map that is sent as part of the beacon. This map tells the client if there is buffered traffic. If so, the client sends a poll message to the AP, which then sends the buffered traffic. The client can then go back to sleep until the next beacon is sent.\n\n\nAPSD (Automatic Power Save Delivery). The AP buffers frames and sends them to a client just after the client sends frames to the AP. The client can then go to sleep until it has more traffic to send (and receive). This mechanism works well for applications such as VoIP that have frequent traffic in both directions. For example, a VoIP (Voice over Internet Protocol) wireless phone might use it to send and receive frames every 20 msec, much more frequently than the beacon interval of 100 msec, while dozing in between.\n\n\nQuality of Service\n\n\nWhen the VoIP traffic competes with peer-to-peer traffic, the VoIP traffic will suffer. It will be delayed due to contention with the high-bandwidth peer-to-peer traffic, even though the VoIP bandwidth is low. These delays are likely to degrade the voice calls. To prevent this degradation, we would like to let the VoIP traffic go ahead of the peer-to-peer traffic, as it is of higher priority.æ‰©å±•äº† 802.11ï¼Œä½œä¸º 802.11e è¢«å¼•å…¥ã€‚\n\n\n\n\n\nSIFS, Short InterFrame Spacing - ACK/RTS/CTS/Burst of fragmentsAIFS, Arbitration IFS - ç‰¹åˆ«è®¾å®šçš„è¾ƒé«˜æˆ–è€…è¾ƒä½ä¼˜å…ˆçº§ï¼ˆä¸€èˆ¬æœ‰å››ä¸ªï¼‰DIFS, DCF (Distributed Coordination Function) IFS - RegularEIFS, Extended IFS - Bad frame recovery\n\n\nTXOP, Transmission Opportunity\n\n\nThe original CSMA/CA mechanism let stations send one frame at a time. This design was fine until the range of rates increased. With 802.11a/g, one station might be sending at 6 Mbps and another station be sending at 54 Mbps. They each get to send one frame, but the 6-Mbps station takes nine times as long (ignoring fixed overheads) as the 54-Mbps station to send its frame. This disparity has the unfortunate side effect of slowing down a fast sender who is competing with a slow sender to roughly the rate of the slow sender. For example, again ignoring fixed overheads, when sending alone the 6-Mbps and 54-Mbps senders will get their own rates, but when sending together they will both get 5.4 Mbps on average. It is a stiff penalty for the fast sender. This issue is known as the rate anomaly.\n\n\nWith transmission opportunities, each station gets an equal amount of airtime, not an equal number of frames. Stations that send at a higher rate for their airtime will get higher throughput.\n\n\nFrame Structure\n\n\n\n\n\nFrame Control- Protocol Version, temp. 00- Type, Data (Fig., 10) / Control / Management- Subtype, e.g. RTS / CTS- To / From DS (Distributed System)- More frag., More fragments- Retry, retransmission- Power management: sender is going into power-saving mode- More data, More frames- Protected, frame body has been encrypted- Order, higher layer expects the sequence of frames to arrive strictly in order\n\n\nDuration - NAV (Î¼s), used in all types of frames.Address - 1. Receiver Addr, 2. Transmitter Addr, 3. Destination Addr.Sequence - 4 for fragments and 12 for frames.Data - the payload, up to 2312 bytes. The first bytes of this payload are in a format known as LLC (Logical Link Control). This layer is the glue that identifies the higher-layer protocol (e.g., IP) to which the payloads should be passed.Check sequence - 32 bit CRC\n\n\n(src)\n\n\nManagement Frame çš„æ ¼å¼ä¸æ­¤ç›¸åŒï¼›Control Frame åªæœ‰ Frame Ctrl, Duration, Address1, CRC å­—æ®µã€‚\n\n\nServices\n\n\næš‚æ—¶æ‡’å¾—å­¦â€¦â€¦\n\n"},"è¯¾ç¨‹ç¬”è®°/è®¡ç®—æœºç½‘ç»œ/05-ç½‘ç»œå±‚":{"slug":"è¯¾ç¨‹ç¬”è®°/è®¡ç®—æœºç½‘ç»œ/05-ç½‘ç»œå±‚","filePath":"è¯¾ç¨‹ç¬”è®°/è®¡ç®—æœºç½‘ç»œ/05 ç½‘ç»œå±‚.md","title":"ç½‘ç»œå±‚","links":[],"tags":[],"content":"ç½‘ç»œå±‚ Network Layer\nä¸»è¦ä»»åŠ¡\né“¾è·¯å±‚å®Œæˆçš„æ˜¯åœ¨ä¸€ä¸ªç½‘ç»œä¸­å¦‚ä½•å°†å¸§ä»ä¸€ä¸ªç»“ç‚¹ä¼ è¾“ç»™å¦ä¸€ä¸ªç»“ç‚¹ï¼›æˆ–è€…è¯´æ˜¯ä»çº¿è·¯çš„ä¸€è¾¹ä¼ é€’åˆ°å¦ä¸€è¾¹ã€‚è€Œç½‘ç»œå±‚åˆ™è€ƒè™‘å¦‚ä½•å°†æ•°æ®åŒ…ä»å‘é€æ–¹ä¸€è·¯é€åˆ°æ¥æ”¶æ–¹[host to host]ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ•°æ®åŒ…å¯èƒ½ä¼šè·¨è¶Šä¸åŒçš„ç½‘ç»œï¼ˆè¿™ä¹Ÿæ˜¯ inter-net çš„åå­—æ¥æºï¼‰ã€‚\n\nä½¿ç”¨ä¸€äº›ä¸­é—´è®¾å¤‡ï¼ˆæˆ–ç§°ä¸­é—´ç³»ç»Ÿã€ä¸­ç»§ç³»ç»Ÿï¼‰å¯ä»¥å°†ä¸¤ä¸ªè®¡ç®—æœºç½‘ç»œè¿æ¥èµ·æ¥ã€‚\n\næˆ‘ä»¬ä¹‹å‰å­¦åˆ°çš„ç‰©ç†å±‚çš„ä¸­ç»§å™¨ (Repeater)ã€é›†çº¿å™¨ (Hub)ï¼Œä»¥åŠé“¾è·¯å±‚çš„ç½‘æ¡¥ (Bridge)ã€äº¤æ¢æœº (Switch) éƒ½å±äºä¸­é—´è®¾å¤‡ã€‚\næˆ‘ä»¬ä¹‹å‰ä¹Ÿæåˆ°ï¼Œè™½ç„¶ç½‘æ¡¥æœ€åˆè®¾è®¡è¢«ç”¨æ¥å¤„ç†å¼‚æ„ç½‘ç»œä¹‹é—´çš„äº’è”ï¼Œä½†æœ€ç»ˆè¿™éƒ¨åˆ†ä»»åŠ¡è¢«ç•™ç»™äº†ç½‘ç»œå±‚ï¼›å³ï¼Œæˆ‘ä»¬è®¤ä¸ºä¸Šè¿°è®¾å¤‡åªæ˜¯æ‰©å¤§äº†ç½‘ç»œï¼Œå¹¶æ²¡æœ‰è¿æ¥ä¸åŒçš„ç½‘ç»œã€‚\n\n\nå› æ­¤æˆ‘ä»¬å¼•å…¥ç½‘è·¯å±‚çš„ä¸­é—´è®¾å¤‡ï¼šè·¯ç”±å™¨ (Router)\n\nå®ƒè´Ÿè´£è¿æ¥ä¸åŒçš„ç½‘ç»œï¼Œä¸ºåˆ°æ¥çš„è·¨ç½‘ç»œçš„æ•°æ®åŒ…æ ¹æ®å…¶ç›®çš„åœ°æ‰¾åˆ°ä¸€æ¡è·¯å¾„ï¼Œå¹¶å¯¹åº”åœ°å°†å…¶è½¬å‘ã€‚\n\n\nåœ¨æ›´é«˜å±‚è¿˜æœ‰ç½‘å…³ (Gateway) è¿™ä¸€ä¸­é—´è®¾å¤‡ã€‚ç”±äºä¸€äº›å†å²åŸå› ï¼Œè·¯ç”±å™¨æœ‰æ—¶ä¹Ÿè¢«ç§°ä¸ºç½‘å…³ã€‚\n\næˆ‘ä»¬è¯´ï¼Œç½‘ç»œå±‚æ˜¯å¤„ç†ç«¯åˆ°ç«¯æ•°æ®ä¼ è¾“çš„æœ€åº•å±‚ã€‚è¿™æ˜¯å› ä¸ºï¼Œé“¾è·¯å±‚è€ƒè™‘çš„åªæ˜¯å°†æ•°æ®ä»ç½‘ç»œä¸Šçš„ä¸€ä¸ªç»“ç‚¹å‘ç»™å¦ä¸€ä¸ªç»“ç‚¹ï¼Œè€Œæˆ‘ä»¬å®é™…ä¸Šéœ€è¦åšçš„æ˜¯å°†ä¸€ä¸ªè¿›ç¨‹çš„æ•°æ®ä¼ é€’ç»™å¦ä¸€ä¸ªè¿›ç¨‹ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå‘é€æ–¹ H1 ä¸Šçš„è¿›ç¨‹ P1 å°†ä¿¡æ¯ä¼ é€’ç»™ ISPï¼ˆç½‘ç»œåº”ç”¨æä¾›å•†ï¼‰æä¾›çš„è®¾å¤‡ Aï¼ŒISP çš„è·¯ç”±å™¨ä¸ºæ•°æ®åŒ…æ‰¾åˆ°ä¸€æ¡é€šè·¯å¹¶è½¬å‘ç»™æ¥æ”¶æ–¹çš„è·¯ç”±å™¨ Fï¼Œæœ€ç»ˆç”±æ¥æ”¶æ–¹ H2 çš„è¿›ç¨‹ P2 æ¥å—ã€‚ç½‘ç»œå±‚é¦–å…ˆå®Œæˆäº†ä»ä¸»æœºåˆ°ä¸»æœºçš„æ•°æ®ä¼ è¾“ã€‚\nå…·ä½“çš„è¿‡ç¨‹æ˜¯ï¼Œ A host with a packet to send transmits it to the nearest router, either on its own LAN or over a point-to-point link to the ISP. The packet is stored there until it has fully arrived and the link has finished its processing by verifying the checksum. Then it is forwarded to the next router along the path until it reaches the destination host. This mechanism is store-and-forward packet switching.\né™¤äº†å°†å¼‚æ„ç½‘ç»œäº’è”ã€é€šè¿‡è·¯ç”±å’Œè½¬å‘å®ç°ä»»æ„ç½‘ç»œç»“ç‚¹é—´çš„æ•°æ®ä¼ è¾“ä»¥å¤–ï¼Œç½‘ç»œå±‚è¿˜å…³æ³¨æ‹¥å¡æ§åˆ¶ (congestion control) å’ŒæœåŠ¡è´¨é‡ (quality of service) ç­‰è¯é¢˜ã€‚\næä¾›ç»™ä¼ è¾“å±‚çš„æœåŠ¡\næ­£å¦‚åœ¨æ•°æ®é“¾è·¯å±‚ä¸­è®¨è®ºçš„é‚£æ ·ï¼Œæˆ‘ä»¬åœ¨ç½‘ç»œå±‚ä¹Ÿéœ€è¦è€ƒè™‘æä¾›é¢å‘è¿æ¥çš„è¿˜æ˜¯æ— è¿æ¥çš„æœåŠ¡ã€‚\n\nä»¥ Internet community ä¸ºä»£è¡¨çš„ä¸€æ–¹è®¤ä¸ºï¼Œæ— è®ºå¦‚ä½•è®¾è®¡ç½‘è·¯ï¼Œæœ¬è´¨ä¸Šå®ƒå°±æ˜¯ä¸å¯é çš„ï¼Œå› æ­¤ç½‘ç»œæœåŠ¡åº”è¯¥æ˜¯æ— è¿æ¥çš„ã€‚\nä»¥ç”µè¯å…¬å¸ä¸ºä»£è¡¨çš„å¦ä¸€æ–¹è®¤ä¸ºï¼Œç½‘ç»œåº”è¯¥æä¾›å¯é çš„é¢å‘è¿æ¥çš„æœåŠ¡ã€‚\nå®é™…ä¸Šï¼Œæ— è¿æ¥æœåŠ¡è·å¾—äº†æˆåŠŸã€‚ä½†æ˜¯ Internet ä¹Ÿæ¸æ¸æœç€é¢å‘è¿æ¥çš„ç‰¹æ€§è¿›åŒ–ï¼Œå› ä¸ºæœåŠ¡è´¨é‡å˜å¾—è¶Šæ¥è¶Šé‡è¦äº†ã€‚ä¸æ­¤ç›¸å…³çš„ä¸¤ä¸ªé¢å‘è¿æ¥æŠ€æœ¯çš„ä¾‹å­æ˜¯ MPLS å’Œ VLANã€‚æˆ‘ä»¬åœ¨é“¾è·¯å±‚å·²ç»è®¨è®ºè¿‡äº† VLANï¼Œåœ¨ç½‘ç»œå±‚ä¸­æˆ‘ä»¬ä¼šè®¨è®º MPLSã€‚\n\nä½†æ— è®ºå¦‚ä½•ï¼Œæä¾›ç»™ä¼ è¾“å±‚çš„æœåŠ¡åº”å½“å±è”½ä¸åŒçš„è·¯ç”±å™¨æŠ€æœ¯ï¼Œä»¥åŠç½‘ç»œä¸Šçš„è·¯ç”±å™¨æ•°é‡ã€ç±»å‹å’Œæ‹“æ‰‘å…³ç³»ã€‚ä¼ è¾“å±‚å¯ç”¨çš„ç½‘ç»œåœ°å€ä¹Ÿåº”å½“æœ‰ä¸€å¥—å¯ä»¥è·¨è¶Š LAN ç”šè‡³ WAN çš„ç»Ÿä¸€ç¼–å€æ–¹æ¡ˆã€‚\næ— è¿æ¥æœåŠ¡çš„å®ç°ï¼šæ•°æ®æŠ¥ç½‘ç»œ datagram network\n\næˆ‘ä»¬åœ¨ç‰©ç†å±‚è®¨è®ºäº†ä¸‰ç§ä¸åŒçš„äº¤æ¢æ–¹å¼ï¼ŒåŒ…äº¤æ¢ packet switching æ˜¯å…¶ä¸­ä¸€ç§ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬è¿›ä¸€æ­¥è€ƒå¯ŸåŒ…äº¤æ¢çš„å®ç°æ–¹å¼ã€‚æˆ‘ä»¬å°†æ¯ä¸ªæ•°æ®åŒ…ç‹¬ç«‹æ³¨å…¥ç½‘ç»œä¸­ï¼Œå¹¶ä¸”ä¸ºæ¯ä¸ªæ•°æ®åŒ…ç‹¬ç«‹è·¯ç”±ï¼ˆå³ï¼Œä¸ºæ¯ä¸ªæ•°æ®åŒ…åˆ†åˆ«è¿›è¡Œä¸€æ¬¡å¯»è·¯ï¼‰ã€‚åœ¨è¿™ç§æ–¹å¼ä¸­ï¼Œæˆ‘ä»¬ç§°æ•°æ®åŒ…ä¸º æ•°æ®æŠ¥ datagramï¼Œè¿™ç§ç½‘ç»œç§°ä¸º æ•°æ®æŠ¥ç½‘ç»œ datagram networkã€‚\nè¿™ç§æ–¹å¼ä¸­ï¼Œæ¯ä¸ªæ•°æ®æŠ¥çš„é¦–éƒ¨éœ€è¦ä¿å­˜å…¶ç›®çš„åœ°å€ï¼›æ¯ä¸ªè·¯ç”±å™¨æ ¹æ®è¯¥åœ°å€è¿›è¡Œå¯»è·¯ã€‚\n\n\né¢å‘è¿æ¥æœåŠ¡çš„å®ç°ï¼šè™šç”µè·¯ç½‘ç»œ virtual-circuit network\n\nè™šç”µè·¯ç½‘ç»œä¹Ÿæ˜¯åŒ…äº¤æ¢çš„ä¸€ç§å®ç°æ–¹å¼ã€‚è™šç”µè·¯ä¸å¸Œæœ›ç»™æ¯ä¸ªæ•°æ®åŒ…é€‰æ‹©ä¸€æ¡è·¯å¾„ï¼Œè€Œå¸Œæœ›å»ºç«‹ä¸€ä¸ªè¿æ¥ï¼Œé€‰æ‹©ä¸€æ¡å›ºå®šçš„è·¯å¾„ï¼›æ‰€æœ‰éœ€è¦ä»è¿™ä¸ªè¿æ¥ä¸Šé€šè¿‡çš„æµé‡éƒ½ä½¿ç”¨è¿™æ¡è·¯å¾„ã€‚\nè™šç”µè·¯ä¹‹æ‰€ä»¥æ˜¯â€œè™šâ€çš„ï¼Œæ˜¯å› ä¸ºè¿™æ¡ç”µè·¯ä¸æ˜¯ä¸“ç”¨çš„ï¼Œåªæ˜¯é€»è¾‘ä¸Šçš„ã€‚ä¸€æ¡é“¾è·¯ä¸Šå¯èƒ½æœ‰å¤šä¸ªè™šç”µè·¯é€šè¿‡ï¼Œä¸€å¯¹ host ä¹‹é—´ä¹Ÿå¯èƒ½å­˜åœ¨å¤šæ¡ä¸åŒçš„è™šç”µè·¯ã€‚\nå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæ¯ä¸ªè¿æ¥æœ‰ä¸€ä¸ªè¿æ¥æ ‡è¯†ç¬¦ connection identifierï¼›è·¯ç”±å™¨ A çš„è¡¨ä¸­çš„ç¬¬ä¸€è¡Œè¡¨ç¤ºï¼šå¦‚æœæœ‰ä¸€ä¸ªæ¥è‡ª H1 çš„ã€æ ‡è¯†ç¬¦ä¸º 1 çš„åŒ…ï¼Œé‚£ä¹ˆ A å°†å…¶è½¬å‘ç»™ Cï¼Œä¸”æ ‡è¯†ç¬¦ä¸º 1ã€‚è¿™ç§æ–¹å¼ä¸­ï¼Œæ¯ä¸ªæ•°æ®æŠ¥ä¸éœ€è¦ä¿å­˜ç›®çš„åœ°å€ï¼Œè€Œæ˜¯ä¿å­˜ connection identifierã€‚\n\n\nMPLS (MultiProtocol Label Switching)\n\n\n\næ•°æ®æŠ¥ç½‘ç»œå’Œè™šç”µè·¯ç½‘ç»œçš„æ¯”è¾ƒ\n\n\nOne trade-off is setup time versus address parsing time. Using virtual circuits requires a setup phase, which takes time and consumes resources. However, once this price is paid, figuring out what to do with a data packet in a virtual-circuit network is easy: the router just uses the circuit number to index into a table to find out where the packet goes. In a datagram network, no setup is needed but a more complicated lookup procedure is required to locate the entry for the destination.\nA related issue is that the destination addresses used in datagram networks are longer than circuit numbers used in virtual-circuit networks because they have a global meaning. If the packets tend to be fairly short, including a full destination address in every packet may represent a significant amount of overhead, and hence a waste of bandwidth.\nVirtual circuits have some advantages in guaranteeing quality of service and avoiding congestion within the network because resources (e.g., buffers, bandwidth, and CPU cycles) can be reserved in advance, when the connection is established. Once the packets start arriving, the necessary bandwidth and router capacity will be there. With a datagram network, congestion avoidance is more difficult.\näº‹åŠ¡å¤„ç†ç³»ç»Ÿé€‚åˆæ•°æ®æŠ¥ï¼Œé•¿æœŸçš„æµé‡è¿æ¥é€‚åˆè™šç”µè·¯ï¼ˆæ‰‹å·¥å»ºç«‹ï¼ŒæŒç»­ä½¿ç”¨ï¼‰ã€‚\nVirtual circuits also have a vulnerabilityï¼ˆè„†å¼±æ€§ï¼‰ problem. If a router crashes and loses its memory, even if it comes back up a second later, all the virtual circuits passing through it will have to be aborted. In contrast, if a datagram router goes down, only those users whose packets were queued in the router at the time need suffer (and probably not even then since the sender is likely to retransmit them shortly). The loss of a communication line is fatal to virtual circuits using it, but can easily be compensated for if datagrams are used.\nDatagrams also allow the routers to balance the traffic throughout the network, since routes can be changed partway through a long sequence of packet transmissions.\n\nè·¯ç”±ç®—æ³•\nè·¯ç”±å™¨çš„åŠŸèƒ½æ˜¯ è·¯ç”± routing å’Œ è½¬å‘ forwardingã€‚è·¯ç”±æ˜¯æŒ‡æ ¹æ®ç‰¹å®šçš„è·¯ç”±ç®—æ³•æ„é€ å‡ºè·¯ç”±è¡¨ï¼ŒåŒæ—¶ä¸æ–­è¿›è¡Œæ›´æ–°ç»´æŠ¤ï¼›è€Œè½¬å‘æ˜¯æŒ‡æ ¹æ®åˆ°æ¥çš„æ•°æ®åŒ…çš„å†…å®¹æŸ¥è¯¢è·¯ç”±è¡¨å¹¶ä»åˆé€‚çš„ç«¯å£è½¬å‘å‡ºå»ã€‚\nè·¯ç”±ç®—æ³•\n\n\nè™šç”µè·¯ç½‘ç»œåªåœ¨å»ºç«‹ä¸€æ¡æ–°çš„è™šç”µè·¯æ—¶æ‰éœ€è¦åšè·¯ç”±å†³ç­–ï¼Œå› æ­¤è¿™ç§æƒ…å½¢ä¹Ÿç§°ä¸º ä¼šè¯è·¯ç”± session routingã€‚\n\n\nè·¯ç”±ç®—æ³•å¯ä»¥æŒ‰æ˜¯å¦æ ¹æ®å½“å‰ç½‘ç»œçš„æµé‡å’Œæ‹“æ‰‘ç»“æ„è°ƒæ•´è·¯ç”±å†³ç­–åˆ†ä¸ºä¸¤å¤§ç±»\n\n\né™æ€è·¯ç”± static routing / éé€‚åº”æ€§ç®—æ³• nonadaptive algorithmã€‚ç®€ä¾¿ï¼Œå¼€é”€è¾ƒå°ï¼Œåœ¨æ‹“æ‰‘å˜åŒ–ä¸å¤§ã€è·¯ç”±é€‰æ‹©éå¸¸æ¸…æ¥šçš„åœºåˆå¾ˆæœ‰ç”¨ï¼›ä½†æ— æ³•å“åº”æ•…éšœã€‚\n\n\nåŠ¨æ€è·¯ç”± dynamic routing / é€‚åº”æ€§ç®—æ³• adaptive algorithmã€‚èƒ½å¤Ÿæ”¹å–„ç½‘ç»œæ€§èƒ½ï¼Œæœ‰åŠ©äºæµé‡æ§åˆ¶ï¼Œæ”¶åˆ°æ•…éšœçš„å½±å“è¾ƒå°ã€‚ä½†æ˜¯ç®—æ³•è¾ƒä¸ºå¤æ‚ï¼Œä¼šå¢åŠ ç½‘ç»œè´Ÿæ‹…ã€‚å¦å¤–å¦‚æœå˜åŒ–å¤ªå¿«å®¹æ˜“å¼•èµ·éœ‡è¡ï¼Œå˜åŒ–è¿‡æ…¢ä¼šå½±å“è·¯ç”±çš„ä¸€è‡´æ€§ã€‚åœ¨ where they get their information (e.g., locally, from adjacent routers, or from all routers), when they change the routes (e.g., when the topology changes, or every Î”T seconds as the load changes), and what metricï¼ˆåº¦é‡æ ‡å‡†ï¼‰is used for optimization (e.g., distance, number of hops, or estimated transit time) ç­‰æ–¹é¢æœ‰å¤šç§é€‰æ‹©ã€‚\n\n\nSink tree is not necessarily unique\n\n\nShortest Path\n\n\nDijkstraâ€™s Algorithm\n\n\nFlooding\n\nDistance Vector Routing / Bellman-Ford Routing\n\n\nThe settling of routes to best paths across the network is called convergence (æ”¶æ•›). Although Distance Vector Routing converges to the correct answer, it may do so slowly. In particular, it reacts rapidly to good news, but leisurely to bad news.\n(a) After init, A started; (b) After init, A halted\nAt the first packet exchange, B does not hear anything from A. Fortunately, C says â€œDo not worry; I have a path to A of length 2.â€ Little does B suspect that Câ€™s path runs through B itself. â€¦However, none of these heuristics work well in practice despite the colorful names. The core of the problem is that when X tells Y that it has a path somewhere, Y has no way of knowing whether it itself is on the path.\nProblems: 1. å‘çš„ä¸œè¥¿å¤ªé•¿äº†ï¼Œå å¸¦å®½ï¼› 2. converge å¤ªæ…¢äº†\n\nLink State Routing\n\nåŸºæœ¬è¿‡ç¨‹ï¼šä¸é‚»å±…äº¤æµï¼Œäº†è§£å…¶ç½‘ç»œåœ°å€å’Œäº¤æµæˆæœ¬ï¼›å°†è¿™äº›ä¿¡æ¯æ„é€ æˆæ•°æ®åŒ…ï¼Œå‘ç»™å…¶ä»–æ‰€æœ‰è·¯ç”±å™¨ï¼Œä¹Ÿæ¥æ”¶å…¶ä»–è·¯ç”±å™¨çš„æ•°æ®åŒ…ï¼›æ ¹æ®è¿™äº›æ•°æ®åŒ…åœ¨æœ¬åœ°æ„é€ å‡ºæ•´ä¸ªç½‘ç»œçš„æ‹“æ‰‘ï¼Œå¹¶ç”¨ Dijkstraâ€™s algorithm ç®—å‡ºåˆ°æ¯ä¸ªç»“ç‚¹çš„æœ€çŸ­è·¯ã€‚\n\nUse an artificial node N. One designated router on the LAN is selected to play the role of N in the routing protocol\n\n\n\n\n\n\n\n\nHierarchical Routing\n\næ‹¥å¡æ§åˆ¶\næœåŠ¡è´¨é‡\nç½‘ç»œäº’è”\nä¸åŒåè®®çš„è·¯ç”±ç­–ç•¥\n\nå…·ä½“å¦‚ä½•åœ¨å¼‚æ„ç½‘ç»œä¹‹é—´è½¬å‘å‘¢ï¼Ÿæœ‰ä¸‹é¢ä¸¤ç§æ€è·¯ï¼š\n\n\n\nPacket Fragmentation\n\nEach network imposes some maximum packet size: MTU, Maximum Transmission Unit. ç”±äºè·¯ç”±ï¼Œæºç«¯å¾ˆéš¾å¾—çŸ¥è·¯å¾„ä¸Šçš„ MTUã€‚\n\né—®é¢˜ï¼š(a) æ‹†åˆ†é‡ç»„å’Œé‡å¤å·¥ä½œã€ä¸èƒ½åˆ†åˆ«è·¯ç”±ï¼Œä»¥åŠ (b) åˆ¤æ–­ç»“å°¾ã€é¢å¤–å¼€é”€ã€é”™è¯¯ç‡æå‡ã€‚Nontransparent fragmentation:\n\n\n\nInternet Protocol\nIPv4\n\n\nHeader (20-byte fixed + options) + Body / Payload\n\n\nHeader æ ¼å¼\n\n\n\nä¼ è¾“é¡ºåºã€‚ The bits are transmitted from left to right and top to bottom, with the high-order bit of the Version field going first. (This is a â€œbig-endianâ€ network byte order. On little-endian machines, such as Intel x86 computers, a software conversion is required on both transmission and reception.) In retrospect, little endian would have been a better choice, but at the time IP was designed, no one knew it would come to dominate computing.\n\n\nVersion - 4 (0100) for IPv4\n\n\nIHL (Internet Header Length) - 4 bits, 5~15, in 32-bit words. E.g. IHL = 5 è¡¨ç¤ºå¤´éƒ¨æœ‰ 5*32 bits = 20 Bytesï¼Œå³ Option å­—æ®µé•¿åº¦ä¸º 0ã€‚å› æ­¤ Option å­—æ®µæœ€å¤š 40 Bytes\n\n\nTotal length - 16 bits, in Byte, Head + Body, â‡65536\n\n\nIdentification - 16 bits, all the fragments of a packet contain the same Identification value.\n\n\nUnused DF (Donâ€™t Fragment) - can be used in path MTU discovery MF (More Fragments) - 0 for the last fragment\n\n\nFragment offset - All fragments except the last one in a datagram must be a multiple of 8 bytes\n\n\nTTL - è®¾è®¡ä¸ºæŒ‰ç§’è®¡ï¼Œç°åœ¨æŒ‰ hop è®¡ã€‚When it hits zero, the packet is discarded and a warning packet is sent back to the source host. This feature prevents packets from wandering around forever, something that otherwise might happen if the routing tables ever become corrupted\n\n\n\n\n\nChecksum - ä¹‹å‰è®¨è®ºè¿‡çš„ Internet Checksumï¼Œ16 bits åˆ’åˆ†ã€‚æ³¨æ„æ¯ä¸€è·³å TTL éƒ½ä¼šå˜æ‰€ä»¥ the Header checksum is assumed to be zero upon arrival ç„¶åé‡æ–°ç®—ä¸€éã€‚\n\n\n\n\n\nThe Options field was designed to provide an escape to allow subsequent versions of the protocol 1) to include information not present in the original design, 2) to permit experimenters to try out new ideas, and to 3) avoid allocating header bits to information that is rarely needed. The options are of variable length. Each begins with a 1-byte code identifying the option. Some options are followed by a 1-byte option length field, and then one or more data bytes. The Options field is padded out to a multiple of 4 bytes.\n\n\n\n\n\nIPv4 åœ°å€\n\n\nInternet ä¸Šçš„æ¯ä¸ª host å’Œ router éƒ½æœ‰ IP åœ°å€ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ¯ä¸ª IP åœ°å€æŒ‡å‘çš„ä¸æ˜¯ä¸€å°æœºå™¨ï¼Œè€Œæ˜¯ä¸€ä¸ª network interfaceï¼›ä¾‹å¦‚ router æœ‰å¤šä¸ªæ¥å£ï¼Œå› æ­¤æ¯ä¸ªæ¥å£éƒ½æœ‰ä¸€ä¸ª IP åœ°å€ã€‚\n\n\nIP åœ°å€å…·æœ‰å±‚æ¬¡æ€§ã€‚Each 32-bit address is comprised of a variable-length network portion in the top bits and a host portion in the bottom bits. The network portion has the same value for all hosts on a single network, such as an Ethernet LAN. This means that a network corresponds to a contiguous block of IP address space. This block is called a prefix.Subnet mask. Since the prefix length cannot be inferred from the IP address alone, routing protocols must carry the prefixes to routers. Sometimes prefixes are simply described by their length, as in a â€œ/16â€ which is pronounced â€œslash 16â€.IP addresses are written in dotted decimal notation.\n\n\n\n\n\n\n\n\nClassful Addressing\n\n\n\n\n\n\n\n\n0.0.0.0ï¼šAs source addr when booting, this host doesnâ€™t know its IP addr and trying to acquire one (DHCP); As dest addr / socket listening: all, including 127...127...: Loopback. Not actually on the link.\n\n\nSubnet\n\n\n\n\n\n\n\n\nOutside the network, the subnetting is not visible, so allocating a new subnet does not require contacting ICANN or changing any external databases.\n\n\nCIDR, Classless Inter-Domain Routing\n\n\n\n\n\n\n\n\nNAT\n\n\n\n\n\n\n\n\n\n\n\nIPv6\n\n\n\n\nInternet Control Protocols\n\n\nIn addition to IP, which is used for data transfer, the Internet has several companion control protocols that are used in the network layer.\n\n\nARP\n\n\n\n\n\nDHCP\n\n\n\n\n\nICMP\n\n\n\n\n\nè·¯ç”±åè®®\näº’è”ç½‘è·¯ç”±\n\né—®é¢˜ï¼šä¸åŒçš„è·¯ç”±ç®—æ³•ã€ä¸åŒçš„åº¦é‡æ–¹å¼ã€å¯¹å¤–ä¿æŠ¤ç½‘ç»œå†…éƒ¨ç»†èŠ‚ã€å¤ªå¤§\n\nWithin each network (OR AS, Autonomous System), an intradomain or interior gateway protocol is used for routing. (â€œGatewayâ€ is an older term for â€œrouterâ€.) Across the networks that make up the internet, an interdomain or exterior gateway protocol is used. The networks may all use different intradomain protocols, but they must use the same interdomain protocol.\n\nRIP, Routing Information Protocol\n\nä¸€ç§ Interior Gateway Protocolï¼ŒåŸºäº Distance Vector Routingï¼Œç”¨ hop è®¡é‡è·ç¦»ã€‚è§„å®šä¸€æ¡è·¯å¾„æœ€å¤šåŒ…å« 15 ä¸ª routerï¼ˆå³ 15 ä¸ª hopï¼‰ï¼Œä»è€Œé˜²æ­¢ç¯è·¯ï¼›å¯è§åªé€‚ç”¨äºå°å‹ç½‘ç»œã€‚æ¯ 30s åœ¨ ç›¸é‚» çš„è·¯ç”±å™¨ä¹‹é—´äº¤æ¢ä¸€æ¬¡ä¿¡æ¯ï¼Œå³è‡ªå·±å½“å‰çš„è·¯ç”±è¡¨ï¼Œä»¥ç»´æŠ¤è·¯ç”±è¡¨ã€‚\næ˜¯ä¸€ä¸ªåº”ç”¨å±‚åè®®ï¼Œéœ€è¦å€ŸåŠ© UDPï¼Œç«¯å£å·æ˜¯ 520ã€‚\n\nOSPF, Open Shortest Path First\n\nä¹Ÿæ˜¯ä¸€ç§ Interior Gateway Protocolï¼Œç›´æ¥ä½¿ç”¨ IP Packet å‘é€ï¼Œprotocol å­—æ®µå€¼ä¸º 89ã€‚Open æ˜¯æŒ‡è¯¥åè®®å‘å¸ƒåœ¨å…¬å¼€æ–‡çŒ®ä¸­ã€‚\næ”¯æŒæ ¹æ® IP Packet çš„ä¸åŒ services ä½¿ç”¨ä¸åŒçš„è·¯ç”±æ–¹å¼ï¼Œä»è€Œæ›´å¥½åœ°ä¼ è¾“å®æ—¶æµé‡ã€‚ æ”¯æŒå¤šç§è·ç¦»åº¦é‡ï¼Œæ”¯æŒå¤šè·¯å¾„ä¹‹é—´çš„è´Ÿè½½å¹³è¡¡ï¼Œæ”¯æŒå±‚æ¬¡ç³»ç»Ÿï¼Œæä¾›ä¸€å®šå®‰å…¨æ€§ï¼Œæ”¯æŒéš§é“ã€‚\næ¯ä¸ª AS å†…éƒ¨ä¹Ÿæœ‰å±‚æ¬¡ç»“æ„ï¼šæœ‰ä¸€ä¸ª Backbone Areaï¼›å…¶ä»–ä»»æ„ä¸¤ä¸ªåŒºåŸŸä¹‹é—´å¯ä»¥é€šè¿‡ Backbone Area äº’è¾¾ã€‚\nåŸºäº Link State Routingã€‚\n\n\nBGP, Border Gateway Protocol\n\nInternet ä½¿ç”¨çš„ Exterior Gateway Protocolã€‚æ¯ä¸ª AS éœ€è¦é€‰æ‹©è‡³å°‘ä¸€ä¸ª router ä½œä¸ºå‘è¨€äººã€‚åŸºäº Distance Vector Routingï¼›ä½†å®é™…ä¸Šä¸ä¸€å®šæ˜¯æœ€ä¼˜çš„ï¼Œå› ä¸ºè€ƒè™‘ä¼˜å…ˆä½¿ç”¨å¯¹ç­‰ç½‘ç»œä»¥åŠå„ç§é™åˆ¶ç­‰å®é™…çš„æ”¿ç­–åŸå› ï¼ŒåŒæ—¶ç½‘ç»œå¤ªå¤§ä¹Ÿä¸ä¸€å®šèƒ½æ‰¾åˆ°æœ€ä½³ã€‚å¦å¤–è¿˜ç»´æŠ¤åˆ°ç›®çš„åœ°çš„è·¯å¾„ï¼Œå› æ­¤å« Path Vector Protocolã€‚\nåº”ç”¨å±‚åè®®ï¼ŒåŸºäº TCPï¼Œç«¯å£å· 179ã€‚\n\nIP ç»„æ’­\nç§»åŠ¨ IP\nICMP çš„ ROUTER ADVERTISEMENT/SOLICITATION æ¶ˆæ¯ä½¿å¾—ä¸»æœºå¯ä»¥æ‰¾åˆ°é™„è¿‘çš„è·¯ç”±å™¨ã€‚å½“ä¸»æœºå‘ç°è·¯ç”±å™¨ä¸ä¸€æ ·çš„æ—¶å€™ï¼Œå°±çŸ¥é“è‡ªå·±è·‘äº†ã€‚\nä¸»æœºåœ¨æ–°çš„ç½‘ç»œ (foreign / remote agent) é€šè¿‡ DHCP è·å¾—ä¸€ä¸ªæ–°çš„ IP åœ°å€ï¼Œç„¶åå‘Šè¯‰è‡ªå·±çš„è€å®¶ (home agent) è‡ªå·±ç°åœ¨åœ¨å“ªã€‚\nHome agent éœ€è¦æ‹¦æˆªå‘ç»™è¿™ä¸ªè·‘è·¯äº†çš„ä¸»æœºçš„åŒ…ï¼Œæ–¹æ³•æ˜¯å½“è·¯ç”±å™¨é€šè¿‡ ARP è¯¢é—®è·‘è·¯ä¸»æœºæŒæœ‰çš„ IP å¯¹åº”ä»€ä¹ˆ MAC åœ°å€æ—¶ï¼Œå›ç­”è‡ªå·±çš„ MAC åœ°å€ã€‚è¿™å°±æ˜¯ ARP agentã€‚ä¸ºäº†å¿«é€Ÿæ›´æ–°ï¼Œhome agent ä¹Ÿå¯ä»¥å‘ Gratuitous ARPï¼ˆæ— æ•… ARPï¼‰ï¼Œé—®è·‘è·¯ä¸»æœºçš„ IP å¯¹åº”çš„ MAC å¹¶è‡ªå·±å›ç­”ã€‚\nå‰©ä¸‹çš„æ­¥éª¤å¦‚ä¸‹å›¾ï¼š"},"è¯¾ç¨‹ç¬”è®°/è®¡ç®—æœºç½‘ç»œ/06-ä¼ è¾“å±‚-Transport-Layer":{"slug":"è¯¾ç¨‹ç¬”è®°/è®¡ç®—æœºç½‘ç»œ/06-ä¼ è¾“å±‚-Transport-Layer","filePath":"è¯¾ç¨‹ç¬”è®°/è®¡ç®—æœºç½‘ç»œ/06 ä¼ è¾“å±‚ Transport Layer.md","title":"ä¼ è¾“å±‚ Transport Layer","links":["tags/å¾…è§£å†³"],"tags":["å¾…è§£å†³"],"content":"ä¼ è¾“å±‚çš„åŠŸèƒ½\n\nä¼ è¾“å±‚æä¾›ç«¯åˆ°ç«¯çš„é€šä¿¡ï¼›ä¹Ÿæä¾›é¢å‘è¿æ¥å’Œæ— è¿æ¥çš„ä¸¤ç§æœåŠ¡ã€‚\nä¹Ÿæœ‰è§‚ç‚¹è®¤ä¸ºï¼Œç½‘ç»œå±‚æä¾›çš„å¹¶ä¸æ˜¯çœŸæ­£çš„ç«¯åˆ°ç«¯ï¼ˆå³ï¼Œè¿›ç¨‹åˆ°è¿›ç¨‹ï¼‰çš„æœåŠ¡ï¼Œè€Œåªæ˜¯ä¸»æœºåˆ°ä¸»æœºçš„æœåŠ¡ï¼Œå› ä¸ºå®ƒå¹¶æ²¡æœ‰åŠæ³•æ‰¾åˆ°ç›®æ ‡çš„è¿›ç¨‹ã€‚\nä½†ä¼ è¾“å±‚é€šè¿‡ç«¯å£æ¥æ ‡è¯†åº”ç”¨è¿›ç¨‹ï¼Œä»è€ŒçœŸæ­£å®ç°è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡ã€‚\n\nåœ¨ç½‘ç»œå±‚å·²ç»æœ‰äº†é¢å‘è¿æ¥å’Œæ— è¿æ¥çš„ä¸¤ç§é€šä¿¡æ–¹å¼çš„æƒ…å†µä¸‹ï¼Œä¸ºä»€ä¹ˆä¼ è¾“å±‚è¿˜è¦æä¾›è¿™ä¸¤ç§æœåŠ¡å‘¢ï¼Ÿ\n\nå› ä¸ºç½‘ç»œå±‚æä¾›çš„æœåŠ¡æ›´å¤šæ˜¯ç”± ISP å†³å®šçš„ï¼›ä¸»è¦è¿è¡Œåœ¨è·¯ç”±å™¨ä¸Š\nä½†ä¼ è¾“å±‚çš„ä»£ç è¿è¡Œåœ¨ç”¨æˆ·è‡ªå·±çš„æœºå™¨ä¸Šï¼Œå› æ­¤ç”¨æˆ·å¯ä»¥åœ¨è¿™ä¸€å±‚é€‰æ‹©åè®®æ¥æé«˜ç½‘ç»œçš„æœåŠ¡è´¨é‡ã€‚\n\nä¼ è¾“å±‚æ˜¯é¢å‘é€šä¿¡éƒ¨åˆ†çš„æœ€é«˜å±‚ï¼Œèµ·ç€æ‰¿ä¸Šå¯ä¸‹çš„ä½œç”¨ã€‚æ¯ä¸ªä¼ è¾“æœåŠ¡ä¼šç»™ç”¨æˆ·æä¾›ä¸€ç»„æ¥å£ï¼Œç”¨æˆ·ï¼ˆæˆ–è€…è¯´åº”ç”¨ï¼‰åªéœ€è¦è°ƒç”¨è¿™äº›æ¥å£å°±èƒ½è°ƒç”¨ç›¸åº”çš„åŠŸèƒ½äº†ã€‚ä¼ è¾“æœåŠ¡ä¹‹äºç½‘ç»œæœåŠ¡å°±åƒç¼–ç¨‹è¯­è¨€ä¹‹äºæ±‡ç¼–è¯­è¨€ï¼šå½“åˆ‡æ¢ä¸åŒçš„ç½‘ç»œæœåŠ¡æ—¶ï¼Œåªéœ€è¦åˆ‡æ¢ä¸€ç§ä¼ è¾“æœåŠ¡åˆ°ç½‘ç»œæœåŠ¡çš„åº“å°±å¥½äº†ï¼›å°±åƒåœ¨æ–°çš„æ¶æ„ä¸Šè¿è¡ŒåŸæ¥çš„ C è¯­è¨€ç¨‹åºæ—¶ï¼Œåªéœ€è¦æ¢ä¸€ä¸ªç¼–è¯‘å™¨å°±å¥½ã€‚åŒæ—¶ï¼Œç½‘ç»œæœåŠ¡å°±åƒæ±‡ç¼–è¯­è¨€ä¸€æ ·è¢«ç”¨çš„æ¯”è¾ƒå°‘ï¼›ä½†ä¼ è¾“æœåŠ¡å°±åƒé«˜çº§è¯­è¨€ä¸€æ ·ä¼šè¢«å¾ˆå¤šç¨‹åºå‘˜ä½¿ç”¨ã€‚å› æ­¤ï¼Œä¼ è¾“æœåŠ¡çš„æ¥å£ä¸€å®šè¦æ›´åŠ æ–¹ä¾¿ã€ç®€å•ã€‚\næ€ä¹ˆå®ç°ç«¯åˆ°ç«¯çš„é€šä¿¡å‘¢ï¼ŸSAP: Service Access Point. Transport SAP å³ Portï¼Œç”¨æ¥æŒ‡å®šè¿›ç¨‹ï¼Œæœ‰ 16bitï¼Œå¯ä»¥è¡¨ç¤º 65536 ä¸ªä¸åŒçš„ç«¯å£å·ã€‚\nä¼ è¾“å±‚ä¼ è¾“çš„å•ä½ç§°ä¸º segmentã€‚\n\nUDP\nUDP, User Datagram Protocol æ˜¯ä¸€ä¸ªæ— è¿æ¥çš„éå¯é ä¼ è¾“å±‚åè®®ã€‚\nå®ƒåœ¨ IP ä¹‹ä¸Šåªæä¾› 2 ä¸ªé™„åŠ æœåŠ¡ï¼š\n\nå¤šè·¯å¤ç”¨\nå¯¹æ•°æ®çš„é”™è¯¯æ£€æŸ¥ï¼ˆIP åªæ£€æŸ¥å¤´éƒ¨çš„é”™è¯¯ï¼‰ã€‚\n\n\nå®ƒä¸è¿›è¡Œæµé‡æ§åˆ¶ã€æ‹¥å¡æ§åˆ¶å’Œé‡ä¼ ï¼Œæ‰€æœ‰ç»´æŠ¤å¯é æ€§çš„å·¥ä½œç”±åº”ç”¨å±‚å®Œæˆï¼›å®ƒåªæ˜¯æä¾›ä¸€ä¸ªä¸ IP åè®®çš„æ¥å£ã€‚\n\n\n\nUDP length æ˜¯åŒ…å« UDP Header (8 Bytes) å’Œæ•°æ®åœ¨å†…çš„æ€»å­—èŠ‚æ•°ã€‚æœ€å°æ˜¯ 8ï¼Œå³åªæœ‰å¤´éƒ¨ï¼›æœ€å¤§æ˜¯ 65515ï¼Œè¿™æ˜¯ IP çš„é™åˆ¶ã€‚\n\n\nUDP checksum æ˜¯å¯é€‰çš„ï¼›å¦‚æœä¸æƒ³æ£€æŸ¥å°±å†™å…¨ 0ã€‚å…¶ç®—æ³•ä¸ IP checksum ç±»ä¼¼ï¼Œå…·ä½“å‚ä¸è¿ç®—çš„åŒ…å«ä¸€ä¸ª 12 Bytes çš„ IPv4 pseudoheaderã€UDP checksum æš‚æ—¶ç½®é›¶çš„ UDP header ä»¥åŠæ•°æ®éƒ¨åˆ†ã€‚\n\nå¦‚æœæ•°æ®éƒ¨åˆ†çš„é•¿åº¦ä¸æ˜¯ 16 bits çš„æ•´å€æ•°ï¼Œåˆ™åœ¨æœ«å°¾è¡¥ 0 ç”¨äºè®¡ç®—ï¼›ä½†è¡¥çš„ 0 ä¸ä¼šè¢«å‘é€å‡ºå»ã€‚\n\n\n\n\n\né¦–éƒ¨\nä¼ªé¦–éƒ¨\n\n\n\n\nå…¶ä¸­ï¼ŒIPv4 pseudoheader ä¸­çš„é•¿åº¦æ˜¯å’Œ UDP header ä¸­çš„é•¿åº¦ä¸€è‡´çš„ã€‚åŒæ—¶ä¹Ÿå¯ä»¥çœ‹åˆ°ï¼ŒUDP åœ¨è®¡ç®—æ—¶æ˜¯ç”¨åˆ°äº†å‘é€æ–¹å’Œæ¥æ”¶æ–¹çš„ IPv4 åœ°å€çš„ï¼›è¿™æœ‰è¿åˆ†å±‚åŸåˆ™ã€‚å½“ç„¶ï¼Œpseudoheader ä¹Ÿæœ‰å¯¹åº”çš„ IPv6 ç‰ˆæœ¬ã€‚\n\n\nUDP é€‚åˆä¸€æ¬¡æ€§ä¼ è¾“è¾ƒå°‘æ•°æ®çš„ç½‘ç»œåº”ç”¨ï¼Œä¹Ÿé€‚åˆé‚£äº›å¯é æ€§ä¸é‚£ä¹ˆé‡è¦ä½†ä¸èƒ½å®¹å¿å»¶è¿Ÿçš„åº”ç”¨ã€‚\n\nDNSåŸŸåç³»ç»Ÿ\nSSDPç®€å•æœåŠ¡å‘ç°åè®®\n\nRTP å®æ—¶ä¼ è¾“åè®®[ä¸æ€ä¹ˆè€ƒ]\n\nRFC3550\nå®ƒæ˜¯ä¸€ç§ä¼ è¾“åè®®ï¼Œåªæ˜¯ç¢°å·§åœ¨åº”ç”¨å±‚å®ç°\n\nä»¥æ•°æ®åŒ…å½¢å¼ä¼ è¾“éŸ³é¢‘å’Œè§†é¢‘\n\nå°†å¤šä¸ªå®æ—¶æ•°æ®æµå¤ç”¨åˆ°å•ä¸ª UDP æ•°æ®åŒ…æµä¸­ã€‚UDP æµå¯ä»¥å‘é€åˆ°å•ä¸ªç›®çš„åœ°ï¼ˆå•æ’­ï¼‰æˆ–å¤šä¸ªç›®çš„åœ°ï¼ˆå¤šæ’­ï¼‰ã€‚\n\n\næ¥æ”¶æ–¹åœ¨æ­£ç¡®çš„æ—¶é—´æ’­æ”¾éŸ³é¢‘å’Œè§†é¢‘\n\n\nä¸ä¿è¯ä¼ é€’ï¼Œæ•°æ®åŒ…å¯èƒ½ä¼šä¸¢å¤±ã€å»¶è¿Ÿã€æŸåç­‰ã€‚RTP æµä¸­å‘é€çš„æ¯ä¸ªæ•°æ®åŒ…çš„ç¼–å·éƒ½æ¯”å…¶å‰é©±æ•°æ®åŒ…é«˜ä¸€ä¸ª\n\nç›®çš„åœ°ç¡®å®šæœ‰æ•°æ®åŒ…ä¸¢å¤±,å¯ä»¥è·³è¿‡ï¼ˆè§†é¢‘å¸§ï¼‰æˆ–æ’å€¼ï¼ˆéŸ³é¢‘æ•°æ®ï¼‰[æ²¡æœ‰ç¡®è®¤æœºåˆ¶]\n\n\næ¯ä¸ª RTP è´Ÿè½½å¯èƒ½åŒ…å«å¤šä¸ªæ ·æœ¬ï¼Œå®ƒä»¬å¯ä»¥æŒ‰åº”ç”¨ç¨‹åºéœ€è¦çš„ä»»ä½•æ–¹å¼è¿›è¡Œç¼–ç ã€‚æä¾›ä¸€ä¸ªå¤´å­—æ®µæ¥æŒ‡å®šç¼–ç æ–¹.\nä¸ºæ¯ä¸ªæ•°æ®åŒ…ä¸­çš„ç¬¬ä¸€ä¸ªæ ·æœ¬å…³è”ä¸€ä¸ªæ—¶é—´æˆ³ã€‚è¿™ä¸ªæœºåˆ¶å…è®¸ç›®çš„ç«¯è¿›è¡Œå°‘é‡ç¼“å†²ï¼Œå¹¶åœ¨æµå¼€å§‹åçš„æ­£ç¡®æ¯«ç§’æ•°åæ’­æ”¾æ¯ä¸ªæ ·æœ¬ã€‚\n\nå‡å°‘ç½‘ç»œå»¶è¿Ÿå˜åŒ–çš„å½±å“\nåŒæ­¥å¤šä¸ªæµ\n\n\n\n3ä¸ª32bits ä»¥åŠä¸€äº›å¯èƒ½çš„æ‰©å±•\n\nRTCP å®æ—¶ä¼ è¾“æ§åˆ¶åè®®\nRTPçš„é…å¥—åè®®\n\nç”¨äºå¤„ç†åé¦ˆ\\åŒæ­¥å’Œç”¨æˆ·ç•Œé¢\nä¸ä¼ è¾“ä»»ä½•åª’ä½“æ ·æœ¬\n\nTCP\nTCP, Transmission Control Protocol æ˜¯ä¸ºäº†åœ¨ä¸å¯é çš„ IP å±‚ä¸Šå®ç°å¯é ç«¯åˆ°ç«¯ä¼ è¾“è®¾è®¡çš„ã€‚\nå®ƒæ˜¯é¢å‘è¿æ¥çš„ï¼Œä¸”åªæ”¯æŒä¸€å¯¹ä¸€çš„é€šä¿¡ï¼ˆè€Œ UDP æ”¯æŒä¸€å¯¹å¤šã€å¤šå¯¹ä¸€ã€å¤šå¯¹å¤šï¼‰ï¼Œæä¾›å…¨åŒå·¥ç‚¹åˆ°ç‚¹é€šä¿¡ï¼Œè§£å†³ä¼ è¾“çš„å¯é ã€æœ‰åºã€æ— ä¸¢å¤±ã€ä¸é‡å¤ã€‚\n\nTCP æ˜¯é¢å‘å­—èŠ‚æµçš„ï¼Œè€Œ UDP æ˜¯é¢å‘æŠ¥æ–‡çš„ã€‚è¿™å°±æ˜¯è¯´ï¼ŒUDP Segment çš„é•¿åº¦ç”±åº”ç”¨ç¨‹åºä¼ æ¥çš„æ•°æ®å†³å®šï¼Œè€Œ TCP åªå°†åº”ç”¨ç¨‹åºä¼ æ¥çš„æ•°æ®è§†ä¸ºæ— ç»“æ„çš„å­—èŠ‚æµï¼Œsegment çš„é•¿åº¦ç”±åè®®åŠ¨æ€å†³å®šã€‚\nè®¾è®¡å®—æ—¨æ˜¯åŠ¨æ€é€‚åº”äº’è”ç½‘çš„ç‰¹æ€§[å·®å¼‚å¾ˆå¤§çš„æ‹“æ‰‘ã€å¸¦å®½ã€å»¶è¿Ÿã€æ•°æ®åŒ…å¤§å°å’Œå…¶ä»–å‚æ•°]ï¼Œå¹¶åœ¨é¢å¯¹å¤šç§æ•…éšœæ—¶å…·æœ‰å¼ºå¤§çš„é²æ£’æ€§ã€‚\n\nä¸»è¦çš„:RFC2018/2581/3168\nåŸºæœ¬TCPåè®®:å…·æœ‰åŠ¨æ€çª—å£å¤§å°çš„æ»‘åŠ¨çª—å£åè®®\nTCP æœåŠ¡æ˜¯ç”±å‘é€æ–¹å’Œæ¥æ”¶æ–¹åˆ›å»ºçš„ç«¯ç‚¹ï¼ˆç§°ä¸ºsocketsï¼‰è·å¾—çš„ã€‚\n\nEach socket has a socket number (address) consisting of\nthe IP addressing of the host and a 16-bit number local to\nthat host, called a port\n\nConnections are identified by the socket identifiers at both\nends, that is, (socket1, socket2)\n\nTCP Segment\né™åˆ¶segentå¤§å°çš„ä¸¤ä¸ªæ¡ä»¶\n\næ¯ä¸ªæ®µåŒ…æ‹¬å¤´éƒ¨å¿…é¡»é€‚é…65515å­—èŠ‚ipè´Ÿè½½(65535-20IPå¤´)\næ¯ä¸ªé“¾è·¯éƒ½æœ‰ä¸€ä¸ªMTUæœ€å¤§ä¼ è¾“å•å…ƒ\n\nTCP çš„ä¸€ä¸ªå…³é”®ç‰¹æ€§ï¼Œä¹Ÿæ˜¯ä¸»å¯¼è¯¥åè®®è®¾è®¡çš„ç‰¹æ€§ï¼Œæ˜¯ TCP è¿æ¥ä¸Šçš„æ¯ä¸ªå­—èŠ‚éƒ½æœ‰è‡ªå·±çš„ 32 ä½åºåˆ—å·ã€‚\n\nåºåˆ—å·ç©ºé—´æ˜¯åŸºäºå­—èŠ‚çš„ï¼Œè€Œä¸æ˜¯åŸºäºæ®µçš„\næ²¡æœ‰ä»»ä½•æ•°æ®çš„æ®µæ˜¯åˆæ³•çš„ï¼Œé€šå¸¸ç”¨äºç¡®è®¤å’Œæ§åˆ¶æ¶ˆæ¯ã€‚\n\nsource portå’Œdestination port è¿æ¥è¯†åˆ«å™¨æ˜¯ä¸€ä¸ªäº”å…ƒç»„,åŒ…æ‹¬åè®®[TCP]\\æºip\\æºç«¯å£\\ç›®çš„ip\\ç›®çš„ç«¯å£\nSequence number - 4B\n\nTCP æ˜¯é¢å‘å­—èŠ‚æµçš„ï¼Œå› æ­¤å®ƒçš„ seq# æ˜¯ä»¥å­—èŠ‚è®¡æ•°çš„ã€‚ä¾‹å¦‚ä¸€ä¸ª segment çš„ seq# æ˜¯ 301ï¼Œæ•°æ®é•¿åº¦æ˜¯ 100Bï¼Œé‚£ä¹ˆè¿™ä¸ª segment å°±åŒ…å«äº†ç¬¬ 301~400 ä¸ªå­—èŠ‚ï¼Œä¸‹ä¸€ä¸ª segment çš„ seq# å°±æ˜¯ 401ã€‚\n\n\nAck number - 4B\n\næœŸæœ›æ”¶åˆ°çš„ä¸‹ä¸€ä¸ª segment çš„ seq#ã€‚ä¾‹å¦‚æ”¶åˆ°äº†ä¸Šé¢è¯´çš„é‚£ä¸ª segmentï¼Œé‚£å‘å›å»çš„ segment çš„ ack# å°±åº”è¯¥æ˜¯ 401ã€‚\næ˜¯ä¸€ä¸ªcumulatie acknowledgementç´¯ç§¯ç¡®è®¤,å› ä¸ºç”¨ä¸€ä¸ªæ•°å­—æ¦‚æ‹¬äº†æ¥æ”¶åˆ°çš„æ•°æ®\n\nCarries highest in-order sequence number\nNormally a steady advance\n\n\n\n\nTCP header length - 4bits\n\nä»¥ 32 bits / 4 Bytes è®¡æ•°ã€‚ç”±äº header æœ‰å˜é•¿çš„ offset å­—æ®µï¼Œå› æ­¤ header çš„é•¿åº¦ä¹Ÿæ˜¯å¯å˜çš„ã€‚è¿™ä¸€å­—æ®µä¹Ÿè¢«ç§°ä½œ data offsetï¼Œå› ä¸ºå®ƒä½œä¸º header çš„é•¿åº¦åŒæ—¶ä¹Ÿè¡¨ç¤ºäº† segment ä¸­çš„æ•°æ®æ˜¯ä»å“ªé‡Œå¼€å§‹çš„ï¼›è¿™ä¸ª offset ä¸ IP datagram fragments ä¸­çš„ offset ä¸ä¸€æ ·ã€‚[é‡Œé¢æ˜¯å­—çš„length æ¯”å¦‚8å­—,å®é™…ä¸Šå°±æ˜¯8*4=32Bytes]\n\n\nReserved - 4bits\n\nè®¾è®¡æ—¶ç”¨äºåœ¨å‘ç°åè®®å‡ºç°è®¾è®¡é—®é¢˜åè¡¥å……ä½¿ç”¨ï¼›æœ¬æ¥æœ‰ 6 ä½ï¼Œåªç”¨æ‰äº† 2 ä½ï¼Œè¯´æ˜è®¾è®¡çš„ä¸é”™ã€‚ç›®å‰åº”å½“ç½® 0ã€‚\n\n\nCWR, Congestion Window Reduced; ECE - Explicit Congestion Notification Echoï¼š\n\nå½“ TCP æ¥æ”¶ç«¯å¾—çŸ¥ç½‘ç»œæ‹¥å¡[è¡¨ç°ä¸ºä¸¢åŒ…]åï¼Œå°±è®¾ç½® ECN-Echo (ECE) ä»è€Œæ˜¾å¼å‘ŠçŸ¥å‘é€ç«¯ç½‘ç»œæ‹¥å¡ï¼Œéœ€è¦æ”¾æ…¢å‘é€é€Ÿç‡ï¼›\nå½“ TCP å‘é€ç«¯æ”¶åˆ° ECE åå°±è®¾ç½® CWR ä»è€Œå‘Šè¯‰æ¥æ”¶ç«¯å·²ç»æ”¾æ…¢é€Ÿç‡äº†ï¼Œä¸éœ€è¦å†å‘ ECE äº†[ä¸€ç›´å‘é€ç›´åˆ°æ¥æ”¶åˆ°CWRå·²è¢«è®¾ç½®ä¸ºæ­¢]ã€‚\n\n\nURG, URGent bitã€‚\n\nå¯ä»¥çœ‹åˆ°åé¢è¿˜æœ‰ä¸€ä¸ª 16 bits çš„ Urgent pointer å­—æ®µï¼Œåªæœ‰åœ¨ URG = 1 æ—¶è¯¥å­—æ®µæ‰æœ‰æ•ˆã€‚æ­¤æ—¶è¡¨ç¤ºè¯¥ segment ä¸­æœ‰ç´§æ€¥æ•°æ®ï¼Œç´§æ€¥æŒ‡é’ˆç”¨äºæŒ‡ç¤ºä»å½“å‰åºåˆ—å·[å­—èŠ‚æµ]å¼€å§‹çš„å­—èŠ‚åç§»é‡ï¼Œç´§æ€¥æ•°æ®ä½äºè¯¥ä½ç½®èŒƒå›´ã€‚\n\nä¾‹å¦‚ï¼Œå‡è®¾å½“å‰åºåˆ—å·ä¸º 1000ï¼Œå¦‚æœç´§æ€¥æŒ‡é’ˆ=10ï¼Œé‚£ä¹ˆæ­¤å­—èŠ‚æµä¸­ç´§æ€¥æ•°æ®çš„ç«¯ç‚¹æ˜¯ 1000+10=1010\n\n\nå½“ç´§æ€¥æ•°æ®åœ¨ç›®çš„åœ°è¢«æ¥æ”¶æ—¶ï¼Œæ¥æ”¶åº”ç”¨ç¨‹åºä¼šè¢«ä¸­æ–­ï¼Œä»¥ä¾¿å®ƒå¯ä»¥åœæ­¢æ­£åœ¨è¿›è¡Œçš„ä»»ä½•æ“ä½œï¼Œè¯»å–æ•°æ®æµä»¥æŸ¥æ‰¾ç´§æ€¥æ•°æ®ã€‚\nç´§æ€¥æ•°æ®çš„ç»“å°¾è¢«æ ‡è®°ï¼Œä»¥ä¾¿åº”ç”¨ç¨‹åºçŸ¥é“ä½•æ—¶ç»“æŸã€‚ç´§æ€¥æ•°æ®çš„å¼€å§‹æ²¡æœ‰è¢«æ ‡è®°ã€‚åº”ç”¨ç¨‹åºéœ€è¦è‡ªå·±åˆ¤æ–­ã€‚\n\n\nACKã€‚\n\nACK = 1 æ—¶ ack# å­—æ®µæ‰æœ‰æ•ˆ,=0æ—¶ç¡®è®¤å­—å·å­—æ®µä¼šè¢«å¿½ç•¥ã€‚TCP è§„å®šå»ºç«‹è¿æ¥åæ‰€æœ‰ segment çš„ ACK éƒ½æ˜¯ 1ã€‚\n\n\nPSH, pushã€‚\n\nPSH = 1 è¡¨ç¤ºæ¥æ”¶ç«¯åœ¨æ¥æ”¶åˆ° segment ååº”å½“å°½å¿«äº¤ä»˜ç»™åº”ç”¨ç¨‹åºï¼Œè€Œå¹¶ä¸æ˜¯ç­‰åˆ°ç¼“å†²åŒºæ»¡åå†å‘ä¸Šäº¤ä»˜ã€‚\n\n\nRST, resetã€‚\n\nRST = 1 è¡¨ç¤º TCP è¿æ¥ä¸­å‘ç”Ÿä¸¥é‡å·®é”™ï¼Œä¾‹å¦‚ä¸»æœºå´©æºƒç­‰ï¼Œéœ€è¦é‡ç½®è¿æ¥ã€‚ä¹Ÿç”¨äºæ‹’ç»æ— æ•ˆæ®µæˆ–æ‹’ç»å°è¯•å»ºç«‹è¿æ¥\n\n\nSYN, synchronizeã€‚\n\nSYN = 1 è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªè¿æ¥è¯·æ±‚æˆ–è€…è¿æ¥æ¥å— segmentã€‚\n\nSYN = 1, ACK = 0[è¡¨ç¤º32ä½ackæ²¡æœ‰æ„ä¹‰] è¯´æ˜è¿™æ˜¯ä¸€ä¸ªè¿æ¥request segment\nSYN = 1, ACK = 1 è¯´æ˜è¿™æ˜¯ä¸€ä¸ªè¿æ¥reply segmentã€‚\n\n\n\n\nFIN, finishã€‚\n\nFIN = 1 è¡¨ç¤ºå‘é€æ–¹æ•°æ®å·²ç»å‘é€å®Œæ¯•ï¼Œè¦æ±‚é‡Šæ”¾ä¼ è¾“è¿æ¥ã€‚SYNå’ŒFINçš„segmentéƒ½ä¼šæœ‰åºåˆ—å·,å› æ­¤èƒ½å¤Ÿä¿è¯ä»¥æ­£ç¡®çš„é¡ºåºè¿›è¡Œå¤„ç†\n\n\nWindow sizeï¼Œ2 Byte\n\nè¡¨ç¤ºå…è®¸å¯¹æ–¹å‘é€çš„æ•°æ®é‡ï¼ˆTCP æ˜¯å…¨åŒå·¥çš„ï¼‰ã€‚ä¾‹å¦‚ ack# æ˜¯ 701ï¼Œwindow size æ˜¯ 1000ï¼Œå°±è¯´æ˜å…è®¸å¯¹æ–¹å‘é€ 701~1700 è¿™äº›å­—èŠ‚ã€‚\n\nWindow size å¯ä»¥ä¸º 0ï¼Œè¡¨ç¤ºç°åœ¨ä¸æƒ³è¦ï¼›\nä¹‹åæƒ³è¦æ¢å¤æ—¶åªéœ€è¦å‘é€ä¸€ä¸ªåŒæ · ack# ä½†æ˜¯ window size ä¸ä¸º 0 çš„ segment å°±è¡Œäº†ã€‚\n\n\n\n\nChecksumï¼Œ2 Byteï¼Œè®¡ç®—æ–¹æ³•å’Œ UDP çš„ä¸€æ ·å¯¹æŠ¥å¤´ã€æ•°æ®å’Œæ¦‚å¿µä¸Šçš„ä¼ªæŠ¥å¤´è¿›è¡Œæ ¡éªŒï¼Œåªæ˜¯éœ€è¦æŠŠ UDP åè®®å· 17 æ”¹ä¸º TCP åè®®å· 6,ä¸”æ ¡éªŒå’Œæ˜¯å¼ºåˆ¶æ€§çš„\nOptionsï¼Œ0~40 Bytesï¼Œé€‰é¡¹é•¿åº¦å¯å˜ï¼Œæœ€é•¿å¯æ‰©å±•åˆ° 40 å­—èŠ‚ä»¥å®¹çº³å¯ä»¥æŒ‡å®šçš„æœ€é•¿ TCP å¤´.\n\nå¿…é¡»æ˜¯ 4 Bytes çš„å€æ•°ï¼Œä¸è¶³çš„ç”¨ 0 è¡¥å……ã€‚\nå…è®¸ä¸»æœºè§„å®š MSS, Maximum Segment Sizeï¼Œå³å…è®¸å¯¹æ–¹å‘æ¥çš„ TCP segment ä¸­ æ•°æ® éƒ¨åˆ†çš„æœ€å¤§é•¿åº¦ã€‚å¦åˆ™é»˜è®¤ä¸º536å­—èŠ‚çš„è´Ÿè½½,å³536+20çš„TCPsegment\nwindow scale optionå…è®¸å‘é€æ–¹å’Œæ¥æ”¶æ–¹åœ¨è¿æ¥å¼€å§‹æ—¶åå•†window scale factor\ntimestamp option æºå¸¦ç”±å‘é€æ–¹å‘é€å¹¶ç”±æ¥æ”¶æ–¹å›æ˜¾çš„æ—¶é—´æˆ³\nsack é€‰æ‹©æ€§ç¡®è®¤é€‰é¡¹ è¡¥å……åºå·ç¡®è®¤\n\n\n\nTCP Connection\nexample\n\n\n\n\n\næ³¨æ„seqè·Ÿå­—èŠ‚æµåºåˆ—å·æœ‰å…³,seqä»£è¡¨çš„èµ·å§‹å­—ç¬¦ä¹Ÿè¦åŒ…æ‹¬è¿›å».å¦‚æœå‘é€çš„æ˜¯nodataçš„\nå¼€å¤´çš„syn segmentæ˜¯å seqçš„\n\n\nEstablishment\n\nä¸‰æ¬¡æ¡æ‰‹å…¶å®å°±æ˜¯åŒæ–¹äº¤æ¢ ISN çš„è¿‡ç¨‹\nè¿‡ç¨‹\n\n\nSYN segment ä¸èƒ½æºå¸¦æ•°æ®,åªæœ‰æŠ¥å¤´ï¼ˆå³å‰ä¸¤æ¬¡æ¡æ‰‹ï¼‰ï¼Œä½†æ˜¯è¦æ¶ˆè€—æ‰ 1 ä¸ª seq,ä»¥ä¾¿äºæ˜ç¡®åœ°è¢«ç¡®è®¤ã€‚\n\nrequest å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€è¯·æ±‚æ®µ\n\nåˆå§‹åºåˆ—å·[æ¯ä¸ªä¸»æœºé€‰æ‹©çš„åˆå§‹åºåˆ—å·ä¼šå¾ªç¯ä½¿ç”¨ä½†æ˜¯å‘¨æœŸå¾ˆé•¿.è¿™ä¸ªè§„åˆ™æ˜¯ä¸ºäº†é˜²æ­¢å»¶è¿Ÿçš„é‡å¤æ•°æ®åŒ…]\n\nå› ä¸ºæ˜¯æ¯ä¸ªä¸»æœºå•ç‹¬ç”Ÿæˆçš„æ‰€ä»¥ä¸¤è¾¹çš„åºåˆ—å·æ²¡æœ‰ä»»ä½•å…³ç³»\n\n\nsynä½ä¸º1 æŒ‡ç¤ºè¯¥segmentåŒ…å«å®¢æˆ·ç«¯ä½¿ç”¨çš„åˆå§‹åºåˆ—å·\næœ€å¤§æ®µå¤§å°:åŒ…å«åœ¨optionå­—æ®µä¸­ [æœ€å¤§æ•°æ®å—é™åˆ¶]\næ¥æ”¶çª—å£å¤§å°:åŒ…å«åœ¨çª—å£å¤§å°å­—æ®µä¸­[æœªç¡®è®¤æ•°æ®é™åˆ¶]\n\n\nreply æœåŠ¡å™¨å‘é€åº”ç­”æ®µæ¥å“åº”å®¢æˆ·ç«¯\n\nå‰å››æ¡åŒä¸Š\n\n\nç¡®è®¤å·,å®¢æˆ·ç«¯å‘é€çš„requestæ®µä¸­çš„åˆå§‹åºåˆ—å·+1ä½œä¸ºåºåˆ—å·,è¡¨ç¤ºæœåŠ¡å™¨æœŸæœ›ä»å®¢æˆ·ç«¯æ¥æ”¶çš„ä¸‹ä¸€ä¸ªæ•°æ®å­—èŠ‚çš„åºåˆ—å·\nackä½ç½®1 å‘å®¢æˆ·ç«¯æ ‡åå½“å‰æ®µä¸­çš„ç¡®è®¤å·å­—æ®µæ˜¯æœ‰æ•ˆçš„\n\n\n\n\næ¥æ”¶replyæ®µä¹‹å\n\né€šè¿‡å‘é€çº¯ç¡®è®¤æ¥ç¡®è®¤æœåŠ¡å™¨çš„å“åº”[ä¸å¿…è¦,å› ä¸ºå¦‚æœå®¢æˆ·ç«¯ç«‹å³å‘é€æ•°æ®åŒ…,é‚£ä¹ˆå°±è§†ä¸ºå·²ç»è¢«ç¡®è®¤,å…¨åŒå·¥è¿æ¥å·²å»ºç«‹,æ‰€ä»¥å…¶å®å®é™…ä¸Šå¿…è¦çš„æ˜¯2æ¬¡æ¡æ‰‹]\n\n\n\n\nå¯¹äºé™¤è¯·æ±‚æ®µä»¥å¤–çš„æ‰€æœ‰æ®µ,ackä½å§‹ç»ˆç½®ä¸º1\n\nSYN flood attack\n\nç”±äºæœåŠ¡ç«¯åœ¨ç¬¬ 2 æ¬¡æ¡æ‰‹æ—¶åˆ†é…äº†èµ„æºï¼Œå› æ­¤æœ‰å¯èƒ½å—åˆ° SYN æ³›æ´ªæ”»å‡»\n\n[å‘replyåŒ…çš„æ—¶å€™éœ€è¦è®°ä½è‡ªå·±å‘å‡ºå»çš„seq,ä»¥ä¾¿äºåé¢æ£€æŸ¥ackæ˜¯å¦ç­‰äºseq+1.]å› æ­¤æ¶æ„å‘é€è€…å¯ä»¥é€šè¿‡å‘é€ä¸€è¿ä¸² SYN æ®µå¹¶ä¸”ä»ä¸å®Œæˆè¿æ¥æ¥å ç”¨ä¸»æœºä¸Šçš„èµ„æº\n\nè§£å†³åŠæ³•:ç”¨SYN cookies é€šè¿‡åŠ å¯†ç®—æ³•,ç”¨è‡ªèº«çš„ä¸€äº›ä¿¡æ¯ç”Ÿæˆåºåˆ—å·.é‚£ä¹ˆåºåˆ—å·+1è¢«è¿”å›çš„æ—¶å€™,å°±å¯ä»¥é€šè¿‡ç›¸åŒçš„åŠ å¯†ç®—æ³•ç”Ÿæˆæ­£ç¡®çš„åºåˆ—å·å†æ¥å¯¹æ¯”.\n\n\n\n\n\nå¦‚ä½•å¯»æ‰¾ç›¸å…³å­—æ®µ\n\n\n\nåœ¨wiresharké‡Œå¯ä»¥æ‰¾åˆ°ipå¤´çš„totallengthä¸º34â†’æ¢ç®—10è¿›åˆ¶52=ipå¤´20 tcpå¤´32  å¾…è§£å†³\n\n\n\n\n\n\n\n\n\n\n\nRelease\n\n\n2-army problemï¼šç†è®ºä¸Šæ— æ³•ä¿è¯ä¸€å®šèƒ½æˆåŠŸé‡Šæ”¾è¿æ¥ã€‚\nå‡è®¾å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¹‹é—´å·²ç»å»ºç«‹äº†è‰¯å¥½çš„TCPè¿æ¥,å®¢æˆ·ç«¯æƒ³è¦ç»ˆæ­¢è¿æ¥\n\nä¸ºäº†ç»ˆæ­¢è¿æ¥\n\nå®¢æˆ·ç«¯å‘æœåŠ¡å•å‘é€FIN segment FINä½è®¾ä¸º1\nå®¢æˆ·ç«¯è¿›å…¥FIN_WAIT_1çŠ¶æ€\nå®¢æˆ·ç«¯ç­‰å¾…æ¥è‡ªæœåŠ¡ç«¯çš„ç¡®è®¤\n\n\næ¥æ”¶åˆ°FIN segmentä¹‹å\n\næœåŠ¡å™¨é‡Šæ”¾å…¶æ¥æ”¶ç¼“å†²åŒº\næœåŠ¡ç«¯å‘å®¢æˆ·ç«¯å‘é€ç¡®è®¤\næœåŠ¡å™¨è¿›å…¥CLOSE_WAITçŠ¶æ€\n\n\nå®¢æˆ·ç«¯æ”¶åˆ°ç¡®è®¤åè¿›å…¥FIN_WAIT_2çŠ¶æ€\n\nå®¢æˆ·ç«¯åˆ°æœåŠ¡ç«¯çš„è¿æ¥å·²ç»ˆæ­¢,å³å•å‘è¿æ¥å·²å…³é—­\nç”±äºæœåŠ¡å™¨ç¼“å†²åŒºå·²é‡Šæ”¾,å®¢æˆ·ç«¯æ— æ³•å‘æœåŠ¡å™¨å‘é€äººæ©èµ«æ•°æ®\nä»ç„¶å¯ä»¥ä»å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€çº¯ç¡®è®¤(æ— æ•°æ®)\næœåŠ¡å™¨åˆ°å®¢æˆ·ç«¯çš„è¿æ¥ä»ç„¶æ‰“å¼€,æœåŠ¡å™¨å¯ä»¥å‘å®¢æˆ·ç«¯å‘é€æ•°æ®å’Œç¡®è®¤ä¿¡æ¯\n\n\næœåŠ¡å™¨æƒ³è¦å…³é—­ä¸å®¢æˆ·ç«¯çš„è¿æ¥\n\næœåŠ¡å™¨å‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªFIN segment\nç­‰å¾…ç¡®è®¤\n\n\næ¥æ”¶åˆ°FIN segmentä¹‹å\n\nå®¢æˆ·ç«¯é‡Šæ”¾å…¶æ¥æ”¶ç¼“å†²åŒº\nå®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€çº¯ç¡®è®¤(ä¸å¿…é¡»)\nå®¢æˆ·ç«¯è¿›å…¥TIME_WAITçŠ¶æ€\n\nå…è®¸å®¢æˆ·ç«¯åœ¨æœ€ç»ˆçš„ç¡®è®¤ä¸¢å¤±æ—¶é‡æ–°å‘é€,ç­‰å¾…ç»“æŸå,è¿æ¥å°±è¢«æ­£å¼å…³é—­\n\n\n\n\n\n\n\nå»ºæ¨¡\n\n\nTCP connection management finite state machine. The heavy solid line is the normal path for a client. The heavy dashed line is the normal path for a server. The light lines are unusual events. Each transition is labeled with the event causing it and the action resulting from it, separated by a slash.\n\nå¯é ä¼ è¾“æœºåˆ¶\nTCP Timer Management\nRTO\n\nè¶…æ—¶é‡ä¼ theRTOã€‚TCP å‘é€æ–¹ç»´æŠ¤ä¸€ä¸ª Time-Out Timerï¼Œå¦‚æœè¶…è¿‡è¶…æ—¶é‡ä¼ æ—¶é—´ RTO, Retransmission Time-Out å°±é‡æ–°å‘é€è¿™ä¸ª segmentã€‚å€¼å¾—è®¨è®ºçš„é—®é¢˜æ˜¯ RTO çš„è®¾ç½®ï¼ŒTCP é¢ä¸´ç€ä¸€ä¸ªæ ¹æœ¬ä¸åŒçš„ç¯å¢ƒã€‚TCP ç¡®è®¤è¿”å›æ‰€éœ€æ—¶é—´çš„æ¦‚ç‡åˆ†å¸ƒæ›´å¤§ä¸”æ›´å…·å˜å¼‚æ€§,å› æ­¤RTOçš„è®¾ç½®å’Œä¼ è¾“å±‚çš„ä¸åŒã€‚\n\n[ä½¿ç”¨åŠ¨æ€ç®—æ³•ï¼Œæ ¹æ®å¯¹ç½‘ç»œæ€§èƒ½çš„æŒç»­æµ‹é‡ï¼Œä¸æ–­è°ƒæ•´è¶…æ—¶é—´éš”.]è¿™é‡Œçš„ç®—æ³•è¦ç”¨åŸºæœ¬å››åˆ™è¿ç®—,å¯ä»¥ç”¨ç§»ä½å¯„å­˜å™¨è¿›è¡Œå®ç°,å¾ˆæ•ˆç‡.\n\nå…ˆç®—ä¸€ä¸ªSRTT,ç”¨å†å²å€¼å’Œå½“å‰å€¼åšä¸€ä¸ªçº¿æ€§åŠ æƒå’Œ,åšä¸€ä¸ªä¼°è®¡çš„smoothRTT\nå†ç®—ä¸€ä¸ªRTTVARå«å¾€è¿”æ—¶é—´å˜å¼‚,ç”¨RTTVARå’ŒSRTTç®—ä¸€ä¸ªRTO,ç„¶åæŠŠè¿™ä¸ªRTOå’Œ1secå–æœ€å°å€¼\nkarnç®—æ³•: ä¸å¯¹ä»»ä½•å·²è¢«é‡ä¼ çš„segmentsæ›´æ–°ä¼°è®¡å€¼.æ­¤å¤–,æ¯æ¬¡è¿ç»­é‡ä¼ çš„æ—¶å€™è¶…æ—¶æ—¶é—´éƒ½ä¼šåŠ å€ç›´åˆ°ç¬¬ä¸€æ¬¡æˆåŠŸé€šè¿‡ä¸ºæ­¢\n\n\n\n\n\nthe persistent timer\næ¥æ”¶æ–¹å‘é€ä¸€ä¸ªçª—å£å¤§å°ä¸º 0 çš„ç¡®è®¤ï¼Œå‘Šè¯‰å‘é€æ–¹ç­‰å¾…ã€‚ä¹‹åï¼Œæ¥æ”¶æ–¹æ›´æ–°çª—å£ï¼Œä½†æ˜¯åŒ…å«æ›´æ–°çš„æ•°æ®åŒ…ä¸¢å¤±äº†ã€‚ç°åœ¨å‘é€æ–¹å’Œæ¥æ”¶æ–¹å„è‡ªç­‰å¾…å¯¹æ–¹åšäº›ä»€ä¹ˆã€‚\n\nå½“æŒä¹…è®¡æ—¶å™¨è¶…æ—¶æ—¶ï¼Œå‘é€æ–¹å‘æ¥æ”¶æ–¹å‘é€ä¸€ä¸ªæ¢æµ‹ã€‚å¯¹æ¢æµ‹çš„å“åº”ç»™å‡ºçª—å£å¤§å°ã€‚\n\nå¦‚æœä»ç„¶ä¸º0,å†æ¬¡è®¾ç½®æŒä¹…è®¡æ—¶å™¨\nå¦‚æœéé›¶å°±å¯ä»¥å‘é€æ•°æ®\n\n\n\nthe keepalive timer\nå½“è¿æ¥é•¿æ—¶é—´ç©ºé—²æ—¶ï¼Œä¿æ´»è®¡æ—¶å™¨å¯èƒ½ä¼šè§¦å‘ï¼Œä½¿ä¸€æ–¹æ£€æŸ¥å¦ä¸€æ–¹æ˜¯å¦ä»ç„¶å­˜åœ¨\nthe TIMEWAIT timer\nåœ¨å…³é—­æ—¶çš„timewaitçŠ¶æ€ä¸­ä½¿ç”¨.è¿è¡Œçš„æ—¶é—´æ˜¯ twice the maximum packet lifetime,ä»¥ç¡®ä¿å½“è¿æ¥å…³é—­æ—¶,åˆ›å»ºçš„æ‰€æœ‰æ•°æ®åŒ…éƒ½å·²ç»æ¶ˆå¤±\næµé‡æ§åˆ¶/æ»‘åŠ¨çª—å£\n\n\n\nçª—å£æ¢æµ‹ä½¿ç”¨çš„è®¡æ—¶å™¨æ˜¯ persistence timerã€‚\n\nThe Silly Window Syndrome\nå½“æ•°æ®ä»¥å¤§å—å½¢å¼ä¼ é€’ç»™å‘é€ TCP å®ä½“ï¼Œä½†æ¥æ”¶ç«¯çš„äº¤äº’å¼åº”ç”¨ç¨‹åºæ¯æ¬¡åªè¯»å– 1 ä¸ªå­—èŠ‚æ—¶ï¼Œå°±ä¼šå‡ºç°æ­¤é—®é¢˜\n\n\nNagleâ€™s Algorithm\n\nå‡å°‘æ¥æ”¶æ–¹å¯¹ç½‘ç»œé€ æˆçš„è´Ÿè½½\nå‡å°‘å‘é€å¤šä¸ªçŸ­æ•°æ®åŒ…çš„å‘é€æ–¹ä½¿ç”¨çš„å¸¦å®½\nå‘ä¸€å—å¹¶ç¼“å†²å…¶ä½™æ‰€æœ‰æ•°æ®,ç›´åˆ°ç¬¬ä¸€å—è¢«ç¡®è®¤ä¹‹å,åœ¨ä¸€ä¸ªtcpæ®µä¸­å‘é€æ‰€æœ‰ç¼“å†²æ•°æ®,å¹¶å¼€å§‹ç¼“å†²ç›´åˆ°ä¸‹ä¸€ä¸ªæ®µè¢«ç¡®è®¤\nä½†æ˜¯ä¸é€‚åˆäº¤äº’å¼æ¸¸æˆè€Œä¸”å¯èƒ½ä¼šå’Œå»¶è¿Ÿç¡®è®¤ç›¸äº’ä½œç”¨å¯¼è‡´æ­»é”\n\n\n\nClarkâ€™s Solution\n\nå¼ºåˆ¶æ¥æ”¶å™¨ç­‰å¾…ï¼Œç›´åˆ°æœ‰è¶³å¤Ÿçš„å¯ç”¨ç©ºé—´ï¼Œç„¶åé€šå‘Šè¯¥ç©ºé—´\nè¿™ä¸¤ç§è§£å†³æ–¹æ¡ˆéƒ½æ˜¯æœ‰æ•ˆçš„ï¼Œå¯ä»¥ä¸€èµ·ä½¿ç”¨ã€‚ç›®æ ‡æ˜¯ä½¿å‘é€æ–¹ä¸å‘é€å°æ®µï¼Œæ¥æ”¶æ–¹ä¹Ÿä¸è¯·æ±‚å°æ®µã€‚\n\n\n\nä¹±åºåˆ°è¾¾é—®é¢˜\n\næ¥æ”¶æ–¹å°†ç¼“å†²æ•°æ®ï¼Œç›´åˆ°èƒ½å¤ŸæŒ‰é¡ºåºå°†å…¶ä¼ é€’ç»™åº”ç”¨å±‚ã€‚\nåªæœ‰å½“å·²æ”¶åˆ°ç¡®è®¤å­—èŠ‚ä¹‹å‰çš„æ‰€æœ‰æ•°æ®æ—¶ï¼Œæ‰èƒ½å‘é€ç¡®è®¤[cumulative acknowledgementç´¯ç§¯ç¡®è®¤]\n\nå¦‚æœæ¥æ”¶æ–¹æ”¶åˆ°segments0124567,å¯ä»¥ç¡®è®¤sement2ä¸­æœ€åä¸€ä¸ªå­—èŠ‚åŠå…¶ä¹‹å‰çš„æ‰€æœ‰å†…å®¹.\nå½“å‘é€æ–¹timesoutä¹‹å,ä¼šé‡æ–°ä¼ è¾“æ®µ3.å› ä¸ºæ¥æ”¶æ–¹å·²ç»ç¼“å†²äº†4~7,æ‰€ä»¥æ”¶åˆ°3ä¹‹å,å®ƒå¯ä»¥ç¡®è®¤åˆ†æ®µ7æœ«å°¾çš„æ‰€æœ‰å­—èŠ‚.\n\n\n\næ‹¥å¡æ§åˆ¶\n\n\nç½‘ç»œå±‚åœ¨è·¯ç”±å™¨é˜Ÿåˆ—å¢é•¿è¿‡å¤§æ—¶æ£€æµ‹åˆ°æ‹¥å¡ï¼Œå¹¶å°è¯•å¯¹å…¶è¿›è¡Œç®¡ç†ï¼Œè‡³å°‘é€šè¿‡ä¸¢å¼ƒæ•°æ®åŒ…æ¥ç®¡ç†ã€‚\n\n\nä¼ è¾“å±‚è´Ÿè´£ä»ç½‘ç»œå±‚æ¥æ”¶æ‹¥å¡åé¦ˆï¼Œå¹¶å‡æ…¢å…¶å‘ç½‘ç»œå‘é€çš„æµé‡é€Ÿç‡ã€‚\n\nåœ¨äº’è”ç½‘ä¸­ï¼ŒTCP åœ¨æ§åˆ¶æ‹¥å¡ä»¥åŠå¯é ä¼ è¾“ä¸­éƒ½æ‰®æ¼”ä¸»è¦è§’è‰²ã€‚\n\n\n\nTCP æ‹¥å¡æ§åˆ¶åŸºäº AIMD (Additive Increase Multiplicative Decrease) æ§åˆ¶å¾‹ä½¿ç”¨çª—å£æœºåˆ¶ï¼Œä»¥packet lossä½œä¸ºäºŒè¿›åˆ¶ä¿¡å·ã€‚\n\n\nTCP ç»´æŠ¤ä¸€ä¸ªæ‹¥å¡çª—å£congestion window (the sending windowï¼‰å’Œä¸€ä¸ªæµé‡æ§åˆ¶çª—å£ï¼ˆæ¥æ”¶çª—å£ï¼‰\n\næ‹¥å¡çª—å£ï¼ˆå‘é€çª—å£ï¼‰çš„å¤§å°æ˜¯æŒ‡å‘é€è€…åœ¨ä»»ä½•æ—¶åˆ»å¯ä»¥åœ¨ç½‘ç»œä¸­ä¼ è¾“çš„å­—èŠ‚æ•°ã€‚\n\næ‹¥å¡çª—å£ä»…ä¸ºå‘é€è€…æ‰€çŸ¥ï¼Œä¸é€šè¿‡é“¾è·¯ä¼ è¾“ã€‚\nThe corresponding rate æ˜¯çª—å£å¤§å°(ä¸¤ä¸ªçª—å£å–æœ€å°) é™¤ä»¥è¿æ¥çš„å¾€è¿”æ—¶é—´ã€‚\nTCP æ ¹æ® AIMD è§„åˆ™è°ƒæ•´æ‹¥å¡çª—å£çš„å¤§å°\n\n\næµé‡æ§åˆ¶çª—å£(æ¥æ”¶çª—å£)\n\næŒ‡å®šæ¥æ”¶å™¨å¯ä»¥ç¼“å†²çš„å­—èŠ‚æ•°ã€‚æ¥æ”¶å™¨é€šè¿‡ TCP å¤´å‘å‘é€å™¨æŒ‡ç¤ºå…¶çª—å£å¤§å°(window size)ã€‚\nä¸¤ä¸ªçª—å£å¹¶è¡Œè·Ÿè¸ªï¼Œå¯ä»¥å‘é€çš„å­—èŠ‚æ•°æ˜¯ä¸¤ä¸ªçª—å£ä¸­è¾ƒå°çš„é‚£ä¸ªã€‚æ¢å¥è¯è¯´ï¼Œå‘é€å™¨å¤„æœªç¡®è®¤æ•°æ®çš„æ•°é‡ â‰¤ min(æ¥æ”¶å™¨çª—å£å¤§å°ï¼Œæ‹¥å¡çª—å£å¤§å°)\nå¦‚æœæ‹¥å¡çª—å£æˆ–æµé‡æ§åˆ¶çª—å£æš‚æ—¶æ»¡äº†ï¼ŒTCP å°†åœæ­¢å‘é€æ•°æ®ã€‚\n\n\næ‰€æœ‰äº’è”ç½‘ TCP ç®—æ³•éƒ½å‡è®¾ä¸¢åŒ…æ˜¯ç”±æ‹¥å¡å¼•èµ·çš„ï¼Œå¹¶é€šè¿‡ç›‘æµ‹è¶…æ—¶æ¥åˆ¤æ–­ã€‚ä½†æ˜¯ï¼Œä½¿ç”¨ä¸¢åŒ…ä½œä¸ºæ‹¥å¡ä¿¡å·å–å†³äºä¼ è¾“é”™è¯¯ç›¸å¯¹è¾ƒå°‘\n\nå¯¹äºæ— çº¿ä¼ è¾“é“¾è·¯æ¥è¯´,é€šå¸¸ä¸æˆç«‹,ä¸¢åŒ…ä¸€èˆ¬æ˜¯ä¼ è¾“é”™è¯¯å¯¼è‡´çš„\nå¤§å¤šæ•°ç”µçº¿å’Œå…‰çº¤çš„æ¯”ç‰¹é”™è¯¯ç‡è¾ƒä½\n\n\n\n\n\nä¸¤ä¸ªé‡è¦é—®é¢˜\n\nå‘é€æ–¹å°†ä½¿ç”¨çš„æ•°æ®åŒ…ä¼ è¾“é€Ÿç‡\n\nAck clock to estimate RTT\n\n\næ‹¥å¡çª—å£çš„å¤§å°so that we can take the most advantage of the network path while at the same time will not induce clog quickly\n\nslow start\n\n\n\n\n\nAck clock\nç¡®è®¤è¿”å›åˆ°å‘é€æ–¹çš„é€Ÿç‡å¤§çº¦ä¸æ•°æ®åŒ…èƒ½å¤Ÿåœ¨è·¯å¾„ä¸­æœ€æ…¢é“¾è·¯ä¸Šå‘é€çš„é€Ÿç‡ç›¸åŒ[å°±æ˜¯æœ€ç“¶é¢ˆçš„é‚£ä¸€æ®µ]ã€‚è¿™æ­£å¥½æ˜¯å‘é€æ–¹æƒ³è¦ä½¿ç”¨çš„é€Ÿç‡ã€‚\n\næ…¢å¼€å§‹å’Œæ‹¥å¡é¿å…\næ•´ä¸ªæ€æƒ³æ˜¯è®© TCP è¿æ¥çš„æ‹¥å¡çª—å£é•¿æ—¶é—´ä¿æŒåœ¨æœ€ä¼˜å€¼é™„è¿‘â€”â€”æ—¢ä¸ä¼šå°åˆ°å¯¼è‡´ååé‡è¿‡ä½ï¼Œä¹Ÿä¸ä¼šå¤§åˆ°å¼•èµ·æ‹¥å¡ã€‚\n\n\nå‘é€æ–¹çš„çª—å£å¤§å°éœ€è¦è€ƒè™‘ä¸¤æ–¹é¢å› ç´ \n\næ¥æ”¶æ–¹ç¼“å†²åŒºå‰©ä½™å¤§å°ï¼Œå³åè®®ä¸­å‘å›çš„ rwndï¼›\nç½‘ç»œçš„æ‹¥å¡æƒ…å†µï¼Œå‘é€æ–¹åº”å½“æ ¹æ®æ‹¥å¡æƒ…å†µç»´æŠ¤ä¸€ä¸ªæ‹¥å¡çª—å£ cwndã€‚\n\n\nå‘é€æ–¹çš„çª—å£å¤§å°åº”å–è¿™äºŒè€…ä¹‹é—´çš„è¾ƒå°å€¼ã€‚ä¸‹é¢è®¨è®º cwnd çš„ç®—æ³•ã€‚\n\nåˆå§‹ cwnd ä¸º 1ï¼ˆå•ä½ä¸º KB æˆ–è€… MSS, Maximum Segment Sizeï¼‰\næ¯æ”¶åˆ°ä¸€ä¸ªACK,å°±å¢åŠ ä¸€ä¸ªæ•°æ®åŒ…,ä¹Ÿå°±æ˜¯ä¸€ä¸ªå˜ä¸¤ä¸ª[æŒ‡æ•°å¢é•¿]\næŒ‡æ•°å¢é•¿åˆ°å°äºç­‰äº ssthreshï¼ˆslow start thresholdï¼‰åå¼€å§‹ä¸¤è€…æ¯æ¬¡å…±åŒ +1[åˆ°è¾¾é˜ˆå€¼ä¹‹åè½¬å˜ä¸ºçº¿æ€§å¢é•¿]æœ€åˆï¼Œæ…¢å¯åŠ¨é˜ˆå€¼è¢«ä»»æ„è®¾ç½®ä¸ºè¾ƒé«˜çš„å€¼ï¼Œå³æµé‡æ§åˆ¶çª—å£çš„å¤§å°ï¼Œä»¥ä¾¿ä¸ä¼šé™åˆ¶è¿æ¥ã€‚\nç›´åˆ°å‘ç°æ‹¥å¡æ—¶(å‘ç°ä¸¢åŒ…) cwnd = 1, ssthresh *= 0.5,ç„¶åé‡æ–°å¼€å§‹.\nå°† cwnd ç½®ä¸º 1 çš„è€ƒé‡æ˜¯è®©ç½‘ç»œè¿…é€Ÿæ¶ˆåŒ–æ‰æ‹¥å¡åœ¨ç½‘ç»œä¸­çš„æ•°æ®åŒ…ã€‚\n\n\n\nå¿«é‡ä¼ å’Œå¿«æ¢å¤\n\n\nDuplicate ACKnowledgementsé‡å¤ç¡®è®¤\n\nä¼šæç¤ºæ•°æ®æœªåˆ°è¾¾çš„æƒ…å†µ.\n\n\nå¿«é‡ä¼ [TCP Tahoe ç‰ˆæœ¬]å’Œå¿«æ¢å¤[TCP Renoç‰ˆæœ¬=TCP Tahoe+å¿«æ¢å¤]æ˜¯å¯¹å‰è¿°ç®—æ³•çš„ä¼˜åŒ–ã€‚\n\nå¿«é€Ÿé‡ä¼ : æ­¤æ—¶å‘é€æ–¹å¯ä»¥ä¸å¿…ç­‰å¾…è¶…æ—¶è€Œæ˜¯ä¸€æ—¦æ”¶åˆ° 3 ä¸ªé‡å¤ ACKï¼Œå‘é€æ–¹ç«‹åˆ»é‡ä¼  2 å· segment\n\næ…¢å¯åŠ¨é˜ˆå€¼ä»è®¾ç½®ä¸ºå½“å‰æ‹¥å¡çª—å£çš„ä¸€åŠã€‚é€šè¿‡å°†æ‹¥å¡çª—å£è®¾ç½®ä¸ºä¸€ä¸ªæ•°æ®åŒ…å¯ä»¥é‡æ–°å¯åŠ¨æ…¢å¯åŠ¨ã€‚\n\n\nåœ¨å¿«æ¢å¤ç®—æ³•ä¸­ï¼Œæˆ‘ä»¬å‘ç° 3 ä¸ªå†—ä½™ ACK æ—¶ä¼šé‡‡å– cwnd *= 0.5ï¼Œssthresh *= 0.5 çš„æ–¹å¼ï¼Œè€Œä¸æ˜¯å°† cwnd ç½®ä¸º 1ã€‚\n\nå¯¹æ¯ä¸ªé¢å¤–çš„é‡å¤ç¡®è®¤ç»§ç»­å‘é€ä¸€ä¸ªæ–°æ•°æ®åŒ…ï¼ˆå‡è£…è¿›ä¸€æ­¥çš„é‡å¤ ACK æ˜¯é¢„æœŸçš„ ACKï¼‰\nä¸ºæ­¤ï¼Œå¯¹é‡å¤ ACK è¿›è¡Œè®¡æ•°ï¼ˆåŒ…æ‹¬è§¦å‘å¿«é€Ÿé‡ä¼ çš„ä¸‰ä¸ª ACKï¼‰ï¼Œç›´åˆ°ç½‘ç»œä¸­çš„æ•°æ®åŒ…æ•°é‡ä¸‹é™åˆ°æ–°çš„é˜ˆå€¼[ä¸‹é™åˆ°æ–°é˜ˆå€¼ä¹‹å‰åœæ­¢å‘é€æ–°æ•°æ®åŒ…,ä¸‹é™åˆ°æ–°é˜ˆå€¼ä¹‹åå¯ä»¥æ¯æ”¶åˆ°ä¸€ä¸ªé‡å¤ç¡®è®¤å°±å‘é€ä¸€ä¸ªæ–°çš„æ•°æ®åŒ…]\n\nå½“ ACK è·³è·ƒæ—¶åè°ƒè§†å›¾é‡‡å–è¿™ä¸€ç­–ç•¥çš„è€ƒé‡æ˜¯ï¼Œæ—¢ç„¶å‘é€æ–¹è¿˜èƒ½æ”¶åˆ°å†—ä½™çš„ ACKï¼Œé‚£ä¹ˆè¯´æ˜ç½‘ç»œè¿˜æ²¡é‚£ä¹ˆæ‹¥å¡ã€‚\n\n\nå¿«é€Ÿé‡ä¼ ä¹‹åçš„ä¸€ä¸ªRTT,ä¸¢å¤±çš„æ•°æ®åŒ…å°†è¢«ç¡®è®¤,é‚£ä¹ˆé‡å¤ç¡®è®¤æµåœæ­¢,é€€å‡ºå¿«é€Ÿæ¢å¤æ¨¡å¼.æ‹¥å¡çª—å£å°†è¢«è®¾ç½®ä¸ºæ–°çš„æ…¢å¯åŠ¨çª—å£å¹¶çº¿æ€§å¢é•¿.\nTCP é¿å…ä½¿ç”¨æ…¢å¯åŠ¨ï¼Œé™¤éåœ¨è¿æ¥é¦–æ¬¡å¯åŠ¨æ—¶å’Œå‘ç”Ÿè¶…æ—¶æ—¶ã€‚\n\n\n\n\n\n\nå…¶ä»–\nSACK (Selective ACKnowledgements):\n\nlists up to three ranges of bytes that have been received. With this information, the sender can more directly decide which packets to retransmit and track the packets in flight to implement the congestion window.\nWith SACK, TCP can recover more easily from situations in which multiple packets are lost at roughly the same time, since the TCP sender knows which packets have not been received.\n[RFC2883 and RFC3517]\n\nECN (Explicit Congestion Notification)\n\nECN is an IP layer mechanism to é€šçŸ¥ä¸»æœºç½‘ç»œæ‹¥å¡æƒ…å†µ\nThe use of ECN is enabled for a TCP connection when both the sender and receiver indicate that they are capable of using ECN by setting theECE and CWR bits during the connection establishment.\n\nThe TCP receiver uses the ECE (ECN-Echo) flag to signal the TCP sender to tell it to slow down when the TCP receiver gets a congestion indication from the network.\nThe sender tells the receiver that it has heard the signal by using the CWR (Congestion Window Reduced) flag, so that the TCP receiver knows the sender has slowed down and can stop sending the ECN-Echo.\n\n\nIf ECN is used, routers that support ECN will set a congestion signal on packets that can carry ECN flags when congestion is approaching, instead of dropping those packets after congestion has occurred.\nECN requires both host and router support. [RFC 3168]\n\nå…¶ä»–å…¶ä»–: bbråŸºäºæ‹¥å¡çš„æ‹¥å¡æ§åˆ¶\n\n\nå½“ç“¶é¢ˆç¼“å†²åŒºå¾ˆå¤§æ—¶ï¼ŒåŸºäºä¸¢åŒ…çš„æ‹¥å¡æ§åˆ¶ä¼šå°†å…¶ä¿æŒæ»¡æ»¡çŠ¶æ€ï¼Œå¯¼è‡´ç¼“å†²åŒºè†¨èƒ€ buffer bloatã€‚\n\nå»¶è¿Ÿæ‹¥å¡äº‹ä»¶å¯¹å‘é€æ–¹çš„å½±å“ï¼ˆå½“é•¿ç½‘ç»œè·¯å¾„ä¸­çš„ç½‘ç»œè®¾å¤‡å…·æœ‰è¿‡å¤§çš„ç¼“å†²åŒºæ—¶ï¼Œå…·æœ‰å¤§æ‹¥å¡çª—å£çš„ TCP å‘é€æ–¹å¯ä»¥ä»¥è¿œè¶…ç½‘ç»œå®¹é‡çš„é€Ÿç‡å‘é€æ•°æ®ï¼Œç›´åˆ°æ”¶åˆ°ä¸¢åŒ…ä¿¡å·æ‰ä¼šåšå‡ºååº”ï¼‰ã€‚\n\n\nå½“ç“¶é¢ˆç¼“å†²åŒºè¾ƒå°æ—¶ï¼ŒåŸºäºä¸¢åŒ…çš„æ‹¥å¡æ§åˆ¶ä¼šé”™è¯¯åœ°å°†ä¸¢åŒ…è§£é‡Šä¸ºæ‹¥å¡ä¿¡å·ï¼Œå¯¼è‡´ååé‡å¾ˆä½ã€‚\n\næ›¿ä»£æ–¹æ¡ˆ:\né¦–å…ˆç†è§£ç½‘ç»œæ‹¥å¡åœ¨ä½•å¤„äº§ç”Ÿä»¥åŠå¦‚ä½•äº§ç”Ÿ\n\nåœ¨ä»»ä½•æ—¶é—´ï¼Œä¸€æ¡å…¨åŒå·¥ TCP è¿æ¥åœ¨æ¯ä¸ªæ–¹å‘ä¸Šæ°å¥½æœ‰ä¸€æ¡æœ€æ…¢çš„é“¾è·¯æˆ–ç“¶é¢ˆã€‚\n\nç“¶é¢ˆå†³å®šäº†è¿æ¥çš„æœ€å¤§æ•°æ®ä¼ è¾“é€Ÿç‡\nå®ƒæ˜¯æŒä¹…é˜Ÿåˆ—å½¢æˆçš„åœ°æ–¹\n\n\nä» TCP çš„è§’åº¦æ¥çœ‹ï¼Œä¸€æ¡ä»»æ„å¤æ‚çš„è·¯å¾„è¡¨ç°ä¸ºå…·æœ‰ç›¸åŒ RTT å’Œç“¶é¢ˆé€Ÿç‡çš„å•æ¡é“¾è·¯ã€‚\n\nä¸¤ä¸ªç‰©ç†çº¦æŸï¼ŒRTpropï¼ˆå¾€è¿”ä¼ æ’­å»¶è¿Ÿï¼‰å’Œ BtlBwï¼ˆç“¶é¢ˆå¸¦å®½ï¼‰é™åˆ¶äº†ä¼ è¾“æ€§èƒ½ã€‚\n\nå¦‚æœç½‘ç»œè·¯å¾„æ˜¯ä¸€æ¡ç‰©ç†ç®¡é“ï¼ŒRTprop å°±æ˜¯å®ƒçš„é•¿åº¦ï¼ŒBtlBW å°±æ˜¯å®ƒçš„æœ€å°ç›´å¾„ã€‚\n\n\n\n\n"},"è¯¾ç¨‹ç¬”è®°/è®¡ç®—æœºç½‘ç»œ/07-åº”ç”¨å±‚":{"slug":"è¯¾ç¨‹ç¬”è®°/è®¡ç®—æœºç½‘ç»œ/07-åº”ç”¨å±‚","filePath":"è¯¾ç¨‹ç¬”è®°/è®¡ç®—æœºç½‘ç»œ/07 åº”ç”¨å±‚.md","title":"åº”ç”¨å±‚","links":[],"tags":[],"content":"åº”ç”¨å±‚æ¦‚è¿°\n\nç½‘ç»œåº”ç”¨ä¸ä»…ä»…æ˜¯åº”ç”¨å±‚åè®®.åŒ…æ‹¬\n\nå®¢æˆ·ç«¯\n\nä¸»åŠ¨ä¸æœåŠ¡å™¨å»ºç«‹è”ç³»connect()\nå‘æœåŠ¡å™¨è¯·æ±‚æœåŠ¡\n\n\næœåŠ¡å™¨ç«¯\nåº”ç”¨å±‚åè®®\n\nåº”ç”¨ç¨‹åºéœ€è¦å“ªç§è¿è¾“æœåŠ¡åº”å‚è€ƒçš„å‚æ•°\n\nData Loss\n\nå®¹é”™loss-tolerant æ¯”å¦‚éŸ³é¢‘è§†é¢‘\næ–‡ä»¶ä¼ è¾“\\telnetç­‰åˆ™éœ€è¦ç™¾åˆ†ç™¾å¯é \n\n\nå¸¦å®½bandwidth\n\nå¤šåª’ä½“éœ€è¦æœ€å¤§å¸¦å®½\nelastic: å¼¹æ€§ å¯ä»¥ä½¿ç”¨ä»»ä½•å¯ç”¨çš„å¸¦å®½\n\n\nTiming\n\nè¯­éŸ³é€šè¯ç­‰éœ€è¦ä½å»¶è¿Ÿæ‰èƒ½æœ‰æ•ˆå·¥ä½œ\n\n\n\n\n\né‡è¦çš„åº”ç”¨å±‚åè®®\nDNS åŸŸåç³»ç»Ÿ\nç†è®ºä¸Šè¯´ï¼Œåªè¦æˆ‘ä»¬è®°ä½éœ€è¦è®¿é—®çš„èµ„æºéƒ¨ç½²åœ¨å“ªä¸ª IP åœ°å€ä¸Šï¼Œæˆ‘ä»¬å°±å¯ä»¥å€Ÿæ­¤ä½¿ç”¨åˆ°å¯¹åº”çš„æœåŠ¡ã€‚\n\nä½†æ˜¯å¦‚æœæœåŠ¡æ›´æ¢äº†ä¸€ä¸ªä¸»æœºéƒ¨ç½²ï¼ŒæœåŠ¡æä¾›æ–¹å°±éœ€è¦å°† IP åœ°å€é€šçŸ¥åˆ°æ¯ä¸€ä¸ªäººï¼›\nåŒæ—¶äººä»¬ä¹Ÿå€¾å‘äºä½¿ç”¨æ›´å…·æœ‰æ„ä¹‰çš„å­—ç¬¦ä¸²è€Œä¸æ˜¯ IP åœ°å€æ¥è®°å¿†ã€‚\nå› æ­¤äººä»¬å¸Œæœ›å»ºç«‹ä¸€ä¸ªä»ä¾¿äºè®°å¿†çš„ä¸»æœºåå’Œ IP åœ°å€ä¹‹é—´çš„æ˜ å°„è§£å†³è¿™äº›é—®é¢˜ã€‚å› æ­¤æˆ‘ä»¬å¼•å…¥äº† DNS, Domain Name Systemã€‚\n\n\næœ¬è´¨æ˜¯åŸºäºåŸŸåçš„åˆ†å±‚å‘½åæ–¹æ¡ˆå’Œåˆ†å¸ƒå¼æ•°æ®åº“\nå°†åç§°æ˜ å°„åˆ°IPåœ°å€,åº”ç”¨ç¨‹åºéœ€è¦è°ƒç”¨ä¸€ä¸ªç§°ä¸ºthe resolverå¹¶å°†åç§°ä½œä¸ºå‚æ•°ä¼ é€’ç»™å®ƒ\næŸ¥è¯¢å’Œå“åº”æ¶ˆæ¯ä½œä¸ºUDPæ•°æ®åŒ…å‘é€\n\nä¸ºä»€ä¹ˆä¸æ˜¯ä¸­å¿ƒå¼\nâ€¢ Single point of failure å•ç‚¹æ•…éšœ\nâ€¢ Traffic volume æµé‡å®¹é‡\nâ€¢ Distant name server means slow response è¿œè·ç¦»åç§°æœåŠ¡å™¨å¯¼è‡´å“åº”ç¼“æ…¢\nâ€¢ Scalability å¯æ‹“å±•æ€§\nå±‚çº§ç»“æ„:\nmappingsåˆ†å¸ƒåœ¨dnsæœåŠ¡å™¨ä¸­,dnsæœåŠ¡å™¨åˆ†ä¸ºä¸‰ç§\n\næ ¹dnsæœåŠ¡å™¨\n\n13ä¸ªé€»è¾‘æ ¹dnsæœåŠ¡å™¨a.root-servers.net to m.root-servers.net\n\næ¯ä¸ªæœåŠ¡å™¨å®é™…ä¸Šæ˜¯æœåŠ¡å™¨é›†ç¾¤\næ‰€æœ‰åŸŸåæœåŠ¡å™¨éƒ½éœ€è¦æ ¹æœåŠ¡å™¨çš„ipåœ°å€\né€šè¿‡name.caé…ç½®æ–‡ä»¶å¤„ç†\n\n\næœ‰1959(root-servers.org 2025.12.9) ä¸ªåˆ†å¸ƒå¼æœåŠ¡å™¨instances\n\nMost servers are reached by IP anycast.(é€šè¿‡IP anycastå…±äº«åŒä¸€ä¸ªipåœ°å€)\nåœ¨ä»»æ’­è·¯ç”±ä¸­ï¼Œæ•°æ®åŒ…è¢«ä¼ é€’åˆ°ç›®æ ‡åœ°å€çš„æœ€è¿‘å®ä¾‹ã€‚\næœåŠ¡å™¨å¯é€šè¿‡ IPv4 å’Œ IPv6 è®¿é—®\n\n\n\n\né¡¶çº§åŸŸåTLD dnsæœåŠ¡å™¨\nauthoritative DNS server\n\nThe DNS Name Space\né¡¶çº§åŸŸååˆ†æˆä¸¤ç±»: generic(é€šç”¨) and countries(å›½å®¶).\n\nDNS Zones\n\n\nDomain Resource Records èµ„æºè®°å½•\næ¯ä¸ªåŸŸï¼Œæ— è®ºæ˜¯å•ä¸ªä¸»æœºè¿˜æ˜¯é¡¶çº§åŸŸï¼Œéƒ½å¯ä»¥æœ‰ä¸€ç»„ä¸ä¹‹å…³è”çš„èµ„æºè®°å½•ã€‚è¿™äº›è®°å½•æ„æˆäº†DNSæ•°æ®åº“\nå•ä¸ªä¸»æœº:æœ€å¸¸è§çš„èµ„æºè®°å½•æ˜¯å®ƒçš„ipåœ°å€\nå½“è§£æå™¨å‘DNSæä¾›ä¸€ä¸ªåŸŸåæ—¶,è¿”å›çš„æ˜¯ä¸è¯¥åŸŸåå…³è”çš„èµ„æºè®°å½•\nDNSçš„ä¸»è¦åŠŸèƒ½æ˜¯å°†åŸŸåæ˜ å°„åˆ°èµ„æºè®°å½•\nèµ„æºè®°å½•æ˜¯äº”å…ƒç»„\nDomain_name Time_to_live Class Type Value\n\nåŸŸå è¡¨ç¤ºè¯¥è®°å½•é€‚ç”¨çš„åŸŸ,æ¯ä¸ªåŸŸå­˜åœ¨è®¸å¤šè®°å½•,æ•°æ®åº“çš„æ¯ä¸ªå‰¯æœ¬ä¿å­˜å…³äºå¤šä¸ªåŸŸçš„ä¿¡æ¯  the primary search key\nttl æŒ‡ç¤ºè®°å½•çš„ç¨³å®šæ€§\nç±»å­—æ®µ å¯¹äºäº’è”ç½‘ä¿¡æ¯æ€»æ˜¯IN\nç±»å‹å­—æ®µ\nSOA è®°å½•æä¾›äº†å…³äºåç§°æœåŠ¡å™¨åŒºåŸŸä¿¡æ¯çš„ä¸»è¦æ¥æºçš„åç§°ã€‚\n\nPTR æŒ‡å‘å¦ä¸€ä¸ªåç§°ã€‚å®ƒå‡ ä¹æ€»æ˜¯ç”¨äºå°†åç§°ä¸ IP åœ°å€ç›¸å…³è”ï¼Œä»¥å…è®¸æŸ¥æ‰¾ IP åœ°å€å¹¶è¿”å›ç›¸åº”è®¡ç®—æœºçš„åç§°ã€‚  -åå‘æŸ¥è¯¢\nMX record, it specifies the name of the host prepared to accept email for the specific domain\nSRV æ˜¯ä¸€ç§è¾ƒæ–°çš„è®°å½•ç±»å‹ï¼Œå…è®¸åœ¨åŸŸä¸­è¯†åˆ«ç”¨äºç»™å®šæœåŠ¡çš„ä¸»æœºã€‚è¯¥è®°å½•æ˜¯å¯¹ MX è®°å½•çš„ä¸€èˆ¬åŒ–ï¼ŒMX è®°å½•æ‰§è¡Œç›¸åŒçš„ä»»åŠ¡ä½†ä»…ç”¨äºé‚®ä»¶æœåŠ¡å™¨ã€‚\nSPFï¼ˆå‘ä»¶äººç­–ç•¥æ¡†æ¶ï¼‰ä¹Ÿæ˜¯ä¸€ç§è¾ƒæ–°çš„è®°å½•ç±»å‹ã€‚å®ƒå…è®¸åŸŸç¼–ç å…³äºåŸŸä¸­å“ªäº›æœºå™¨å°†å‘äº’è”ç½‘å…¶ä½™éƒ¨åˆ†å‘é€é‚®ä»¶çš„ä¿¡æ¯ã€‚è¿™æœ‰åŠ©äºæ¥æ”¶æœºå™¨æ£€æŸ¥é‚®ä»¶æ˜¯å¦æœ‰æ•ˆã€‚\n\n\nDNS Resolution\nDNS åè®®è®©ä¸»æœºèƒ½å¤Ÿå°†ä»»ä½•ä¸»æœºåï¼ˆåŸŸåï¼‰è§£æä¸º IP åœ°å€\nå¦‚æœæœªçŸ¥ï¼Œå¯ä»¥ä»æ ¹åç§°æœåŠ¡å™¨å¼€å§‹å¹¶é€çº§æŸ¥è¯¢å„ä¸ªåŒºåŸŸ\né€’å½’æŸ¥è¯¢:\n\né€’å½’ DNS æŸ¥è¯¢æ˜¯æŒ‡ DNS è§£æå™¨ï¼ˆé€šå¸¸æ˜¯å®¢æˆ·ç«¯ DNS æœåŠ¡å™¨ï¼‰è¦æ±‚å¦ä¸€ä¸ª DNS æœåŠ¡å™¨å¤„ç†æ•´ä¸ªè§£æè¿‡ç¨‹çš„æŸ¥è¯¢ã€‚å®¢æˆ·ç«¯ DNS æœåŠ¡å™¨å‘é€’å½’ DNS æœåŠ¡å™¨å‘é€å•ä¸ªæŸ¥è¯¢ï¼Œå¹¶ç­‰å¾…æœ€ç»ˆç­”æ¡ˆã€‚\nå®ƒç®€åŒ–äº†å®¢æˆ·ç«¯ DNS è§£æå™¨çš„æµç¨‹ã€‚è§£æå™¨åªéœ€å‘é€ä¸€ä¸ªæŸ¥è¯¢å¹¶ç­‰å¾…å“åº”ï¼Œæ— éœ€å¤„ç†è½¬å‘æˆ–è¿›è¡Œå¤šä¸ªè¯·æ±‚ã€‚â€“ å®ƒå¯ä»¥æ½œåœ¨åœ°æä¾›æ›´å¿«çš„å“åº”ï¼Œå› ä¸ºé€’å½’ DNS æœåŠ¡å™¨å¯ä»¥é€šè¿‡ä½¿ç”¨å…¶ç¼“å­˜æ¥ä¼˜åŒ–æŸ¥è¯¢è¿‡ç¨‹ã€‚å¦‚æœå®ƒä¹‹å‰å·²ç»è§£æè¿‡è¯¥åŸŸåæˆ–å…¶ç¼“å­˜ä¸­æœ‰ç›¸å…³ä¿¡æ¯ï¼Œå®ƒå¯ä»¥æ›´å¿«åœ°è¿”å›ç­”æ¡ˆã€‚\nå¦‚æœé€’å½’ DNS æœåŠ¡å™¨æ”¶åˆ°å¤§é‡è¯·æ±‚ï¼Œç‰¹åˆ«æ˜¯å½“å®ƒä»¬å¿…é¡»ä¸ºæ¯ä¸ªæŸ¥è¯¢æ‰§è¡Œå®Œæ•´çš„è§£æè¿‡ç¨‹æ—¶ï¼Œå¯èƒ½ä¼šè¢«è¿‡è½½ã€‚\né€’å½’ DNS æœåŠ¡å™¨å­˜åœ¨å®‰å…¨é£é™©ã€‚å¦‚æœæ¶æ„è¡Œä¸ºè€…èƒ½å¤Ÿæ§åˆ¶é€’å½’ DNS æœåŠ¡å™¨ï¼Œä»–ä»¬å¯ä»¥æ“çºµ DNS è§£æç»“æœï¼Œå¯¼è‡´ç½‘ç»œé’“é±¼æˆ–å°†ç”¨æˆ·é‡å®šå‘åˆ°æ¶æ„ç½‘ç«™ç­‰é—®é¢˜\n\nè¿­ä»£æŸ¥è¯¢:\n\nè¿­ä»£ DNS æŸ¥è¯¢æ˜¯ DNS è§£æå™¨ï¼ˆé€šå¸¸æ˜¯å®¢æˆ·ç«¯ DNS æœåŠ¡å™¨ï¼‰å‘ä¸åŒçš„ DNS æœåŠ¡å™¨è¿›è¡Œä¸€ç³»åˆ—è¯·æ±‚ï¼Œç›´åˆ°è·å¾—æ‰€éœ€ç­”æ¡ˆçš„è¿‡ç¨‹ã€‚å½“ DNS è§£æå™¨å‘é€è¿­ä»£æŸ¥è¯¢æ—¶ï¼Œå®ƒä»æ ¹ DNS æœåŠ¡å™¨å¼€å§‹ã€‚\nå‡è®¾æœ¬åœ° DNS è§£æå™¨æƒ³è¦è§£æåŸŸåâ€www. cs.washington.eduâ€ã€‚\n\n\næœ¬åœ° DNS æœåŠ¡å™¨é¦–å…ˆè”ç³»æ ¹ DNS æœåŠ¡å™¨ã€‚ä½†æ ¹ DNS æœåŠ¡å™¨ä¸ç›´æ¥çŸ¥é“www.cs.washington.eduçš„ IP åœ°å€ï¼Œä½†å®ƒçŸ¥é“é¡¶çº§åŸŸï¼ˆTLDï¼‰æœåŠ¡å™¨çš„ IP åœ°å€ï¼ˆå¦‚.edu æœåŠ¡å™¨ï¼‰ã€‚å› æ­¤ï¼Œå®ƒç”¨ç›¸å…³ TLD æœåŠ¡å™¨çš„ IP åœ°å€å“åº”æœ¬åœ° DNS è§£æå™¨ã€‚\næœ¬åœ° DNS è§£æå™¨éšåè”ç³» TLD æœåŠ¡å™¨ã€‚TLD æœåŠ¡å™¨ä¾æ¬¡æä¾›åŸŸåâ€washtington.eduâ€çš„æƒå¨ DNS æœåŠ¡å™¨çš„ IP åœ°å€ã€‚\næœ€åï¼Œæœ¬åœ° DNS è§£æå™¨è”ç³»æƒå¨ DNS æœåŠ¡å™¨ï¼Œè¯¥æœåŠ¡å™¨æä¾›â€www .cs.washington.eduâ€çš„ IP åœ°å€ã€‚\n\n\nå®ƒå‡å°‘äº†å¯¹æ ¹æœåŠ¡å™¨å’Œ TLD æœåŠ¡å™¨ä¹‹å¤–çš„ DNS æœåŠ¡å™¨çš„è´Ÿè½½ï¼Œå› ä¸ºæœ¬åœ° DNS è§£æå™¨åœ¨éµå¾ªè½¬ä»‹æ–¹é¢å®Œæˆäº†å¤§éƒ¨åˆ†å·¥ä½œã€‚æœ¬åœ° DNS æœåŠ¡å™¨å¯ä»¥åœ¨ä¸€ä¸ªå®¢æˆ·ç«¯æ± ä¸Šè¿›è¡Œç¼“å­˜ä»¥è·å¾—æ›´å¥½çš„æ€§èƒ½\nè¯¥è¿‡ç¨‹å¯èƒ½ä¼šè¾ƒæ…¢ï¼Œå› ä¸ºè§£æå™¨å¿…é¡»å‘å‡ºå¤šä¸ªè¯·æ±‚å¹¶ç­‰å¾…æ¥è‡ªä¸åŒæœåŠ¡å™¨çš„å“åº”ã€‚æ­¤å¤–ï¼Œè¿‡ç¨‹ä¸­çš„æ¯ä¸€æ­¥éƒ½å¯èƒ½å¼•å…¥é¢å¤–çš„å»¶è¿Ÿã€‚\n\n\n\n\n\nFTP\nç”¨äºå‘è¿œç¨‹ä¸»æœºä¼ è¾“æ–‡ä»¶æˆ–ä»è¿œç¨‹ä¸»æœºæ¥æ”¶æ–‡ä»¶ã€‚ç™¾åˆ†ä¹‹ç™¾å¯é ä¼ è¾“\n\nâ€“ 1) ç”¨æˆ·é¦–å…ˆæä¾›è¿œç¨‹ä¸»æœºçš„ä¸»æœºåï¼Œå¯¼è‡´æœ¬åœ°ä¸»æœºä¸­çš„ FTP å®¢æˆ·ç«¯è¿›ç¨‹ä¸è¿œç¨‹ä¸»æœºä¸­çš„ FTP æœåŠ¡å™¨è¿›ç¨‹å»ºç«‹ TCP è¿æ¥ã€‚\nâ€“ 2) ç”¨æˆ·éšåæä¾›ç”¨æˆ·æ ‡è¯†å’Œå¯†ç ï¼Œè¿™äº›ä¿¡æ¯é€šè¿‡ TCP è¿æ¥ä»¥ FTP å‘½ä»¤çš„å½¢å¼å‘é€ã€‚\nâ€“ 3) ä¸€æ—¦æœåŠ¡å™¨æˆæƒç”¨æˆ·ï¼Œç”¨æˆ·å°±å¯ä»¥å°†å­˜å‚¨åœ¨æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªæ–‡ä»¶å¤åˆ¶åˆ°è¿œç¨‹æ–‡ä»¶ç³»ç»Ÿä¸­ï¼ˆæˆ–åä¹‹ï¼‰ã€‚\nFTP ä½¿ç”¨ä¸¤æ¡å¹¶è¡Œçš„ TCP è¿æ¥æ¥ä¼ è¾“æ–‡ä»¶ï¼Œä¸€æ¡æ§åˆ¶è¿æ¥å’Œä¸€æ¡æ•°æ®è¿æ¥ã€‚\n\næ§åˆ¶è¿æ¥ç”¨äºåœ¨ä¸¤å°ä¸»æœºä¹‹é—´å‘é€æ§åˆ¶ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç”¨æˆ·è¯†åˆ«ã€å¯†ç ã€æ›´æ”¹è¿œç¨‹ç›®å½•çš„å‘½ä»¤ï¼Œä»¥åŠâ€ä¸Šä¼ â€å’Œâ€ä¸‹è½½â€æ–‡ä»¶çš„å‘½ä»¤ã€‚\n\nFTP è¢«ç§°ä¸ºå¸¦å¤–å‘é€å…¶æ§åˆ¶ä¿¡æ¯ã€‚ï¼ˆæ­£å› ä¸ºè¿™ä¸ªæ§åˆ¶è¿æ¥ï¼ˆç‹¬ç«‹çš„ï¼‰ï¼ŒFTP æ˜¯â€å¸¦å¤–â€çš„ã€‚\nä»å®¢æˆ·ç«¯åˆ°æœåŠ¡å™¨çš„å‘½ä»¤å’Œä»æœåŠ¡å™¨åˆ°å®¢æˆ·ç«¯çš„åº”ç­”é€šè¿‡æ§åˆ¶è¿æ¥ä»¥ 7 ä½ ASCII æ ¼å¼å‘é€ã€‚\n\n\næ•°æ®è¿æ¥ç”¨äºå®é™…å‘é€æ–‡ä»¶\n\nEmail\nä¸€ç§å¼‚æ­¥é€šä¿¡åª’ä»‹,åŒ…æ‹¬\nâ€“ ç”¨æˆ·ä»£ç†ï¼ˆå®¢æˆ·ç«¯ï¼Œä¾‹å¦‚ Outlookã€Gmail ç½‘ç»œç•Œé¢ï¼‰\nâ€“ æ¶ˆæ¯ä¼ è¾“ä»£ç†ï¼ˆé‚®ä»¶æœåŠ¡å™¨ï¼‰\nâ€“ ç®€å•é‚®ä»¶ä¼ è¾“åè®®ï¼šSMTP\n\nSMTP\nâ€“ RFC 5321\nâ€“ å®ƒåˆ©ç”¨ TCP çš„å¯é æ•°æ®ä¼ è¾“æœåŠ¡å°†é‚®ä»¶ä»å‘é€æ–¹é‚®ä»¶æœåŠ¡å™¨ä¼ è¾“åˆ°æ¥æ”¶æ–¹é‚®ä»¶æœåŠ¡å™¨ã€‚\nâ€“ ä¸å¤§å¤šæ•°åº”ç”¨å±‚åè®®ä¸€æ ·ï¼ŒSMTP æœ‰ä¸¤ä¸ªæ–¹é¢ï¼šå®¢æˆ·ç«¯æ–¹é¢åœ¨å‘é€æ–¹é‚®ä»¶æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼ŒæœåŠ¡å™¨ç«¯æ–¹é¢åœ¨æ¥æ”¶æ–¹é‚®ä»¶æœåŠ¡å™¨ä¸Šæ‰§è¡Œã€‚\n\né¦–å…ˆï¼Œå®¢æˆ·ç«¯ SMTPï¼ˆè¿è¡Œåœ¨å‘é€é‚®ä»¶æœåŠ¡å™¨ä¸»æœºä¸Šï¼‰é€šè¿‡ TCP å»ºç«‹è¿æ¥åˆ°æœåŠ¡å™¨ SMTPï¼ˆè¿è¡Œåœ¨æ¥æ”¶é‚®ä»¶æœåŠ¡å™¨ä¸»æœºä¸Šï¼‰çš„ 25 ç«¯å£ã€‚\n\nå¦‚æœæœåŠ¡å™¨å®•æœºï¼Œå®¢æˆ·ç«¯ç¨åé‡è¯•ã€‚\n\n\nä¸€æ—¦è¿™ä¸ªè¿æ¥å»ºç«‹ï¼ŒæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯è¿›è¡Œåº”ç”¨å±‚æ¡æ‰‹\n\nåœ¨ SMTP æ¡æ‰‹é˜¶æ®µï¼ŒSMTP å®¢æˆ·ç«¯æŒ‡ç¤ºå‘ä»¶äººçš„ç”µå­é‚®ä»¶åœ°å€å’Œæ”¶ä»¶äººçš„ç”µå­é‚®ä»¶åœ°å€ã€‚\n\n\nä¸€æ—¦ SMTP å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç›¸äº’ä»‹ç»åï¼Œå®¢æˆ·ç«¯å°±ä¼šå‘é€æ¶ˆæ¯\n\nå¦‚æœå®¢æˆ·ç«¯æœ‰å…¶ä»–æ¶ˆæ¯è¦å‘é€åˆ°æœåŠ¡å™¨ï¼Œåˆ™ä¼šåœ¨åŒä¸€ TCP è¿æ¥ä¸Šé‡å¤æ­¤è¿‡ç¨‹ã€‚\n\n\nå¦åˆ™ï¼Œå®ƒæŒ‡ç¤º TCP å…³é—­è¿æ¥ã€‚\n\nEmail Message Format\nâ€“ ä¿¡å°å°è£…äº†æ¶ˆæ¯ã€‚å®ƒåŒ…å«ä¼ è¾“æ¶ˆæ¯æ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯ï¼Œä¾‹å¦‚ç›®æ ‡åœ°å€ã€ä¼˜å…ˆçº§å’Œå®‰å…¨çº§åˆ«ã€‚æ¶ˆæ¯ä¼ è¾“ä»£ç†ä½¿ç”¨ä¿¡å°è¿›è¡Œè·¯ç”±ï¼Œå°±åƒé‚®å±€æ‰€åšçš„é‚£æ ·ã€‚\nâ€“ ä¿¡å°å†…çš„æ¶ˆæ¯ç”±ä¸¤ä¸ªç‹¬ç«‹éƒ¨åˆ†ç»„æˆï¼šå¤´éƒ¨å’Œæ­£æ–‡\nRFC\nMIME\n\nHTTP\nThe HyperText Transfer Protocolè¶…æ–‡æœ¬ä¼ è¾“åè®®\n\nWeb çš„åº”ç”¨å±‚åè®®ï¼Œæ˜¯ Web çš„æ ¸å¿ƒã€‚\næ˜¯ä¸€ä¸ªç®€å•çš„è¯·æ±‚-å“åº”åè®®ï¼Œé€šå¸¸è¿è¡Œåœ¨ TCP ä¸Šã€‚\nHTTP ä¸ Web é¡µé¢å¦‚ä½•è¢«å®¢æˆ·ç«¯è§£é‡Šæ²¡æœ‰ä»»ä½•å…³ç³»ã€‚\n\nWeb é¡µé¢å¦‚ä½•è¢«å®¢æˆ·ç«¯è§£é‡Š: æµè§ˆå™¨\n\n\n\nç½‘é¡µï¼ˆä¹Ÿç§°ä¸ºæ–‡æ¡£ï¼‰ç”±å¯¹è±¡ç»„æˆã€‚å¯¹è±¡å°±æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œå¦‚ HTML æ–‡ä»¶ã€JPEG å›¾åƒã€Java å°ç¨‹åºæˆ–è§†é¢‘å‰ªè¾‘ï¼Œå¯ä»¥é€šè¿‡å•ä¸ª URL è®¿é—®ã€‚\n\n\nDomain names can be either absolute or relative. An absolute domain name always ends with a period (i.e. dot) (e.g., eng.cisco.com.), whereas a relative one does not. Relative names have to be interpreted in some context to uniquely determine their true meaning. In both cases, a named domain refers to a specific node in the tree and all the nodes under it.\nTo create a new domain, permission is required of the domain in which it will be included. Once a new domain has been created and registered, it can create subdomains without getting permission from anybody higher up the tree.\n\nName Servers\n\n\n\néƒ½ç”¨ recursive query ä¼šå¯¼è‡´ root name server è´Ÿè½½è¿‡å¤§ã€‚\næ•´ä¸ª Internet ä¾èµ–äº root name serverï¼Œå› æ­¤å®é™…ä¸Šå®ƒä»¬èƒ½åŠ›è¶…å¼ºä¸”æœ‰å¤šä»½å†—ä½™ï¼›query packet é€šè¿‡ anycast æ‰¾åˆ°å…¶ä¸­ä¹‹ä¸€ã€‚\nName server æœ‰ç¼“å­˜ã€‚ä¸Šé¢çš„ä¾‹å­å±•ç¤ºçš„æ˜¯æ²¡æœ‰ç¼“å­˜çš„æƒ…å†µï¼›äº‹å®ä¸Šéƒ¨åˆ† name server å¯èƒ½å·²ç»å°†å†…å®¹ç¼“å­˜èµ·æ¥ã€‚ç”±äºç¼“å­˜ä¸ä¸€å®šç¡®ä¿æ­£ç¡®ï¼Œå› æ­¤ name server ä¸Šçš„ records ä¹Ÿæ˜¯æœ‰æ—¶é™çš„ã€‚\nDNS çš„ query å’Œ response é‡‡ç”¨ UDP å‘é€ï¼›DNS name server ä½¿ç”¨ 53 å·ç«¯å£ã€‚å¦‚æœå¾ˆçŸ­çš„æ—¶é—´å†…æ²¡æœ‰æ”¶åˆ° responseï¼ŒDNS client å°±é‡æ–°å‘ä¸€ä¸ªï¼›å¦‚æœé‡å¤è‹¥å¹²æ¬¡ä»ç„¶å¤±è´¥ï¼Œå°±å°è¯•å¦ä¸€å° name serverã€‚\n\nDomain Resource Records\n\n\n\n\n\nEmail\nArchitecture and Services\n\n\n\n\n\nUA, User Agent: ä¹Ÿå« Email Readerï¼Œæ˜¯ä¸€ä¸ª programï¼Œç»™ç”¨æˆ·çœ‹çš„ã€‚\n\n\nMessage Transfer Agent: è´Ÿè´£å‘é€å’Œæ¥æ”¶é‚®ä»¶ï¼ŒåŒæ—¶å‘å‘é€æ–¹æŠ¥å‘Šå‘é€æƒ…å†µã€‚æœ‰å¯èƒ½åœ¨ ISP ä¸Šã€‚\n\n\næ”¶å‘è¿‡ç¨‹\n\n\nå‘é€æ–¹ç”¨ UA ç¼–è¾‘å¥½äº†ä»¥åé€šè¿‡ SMTPï¼ˆåé¢è®¨è®ºï¼‰ç»™ Message Transfer Agent\n\n\né‚®ä»¶è¿›å…¥ MTA çš„ç¼“å­˜\n\n\nSMTP client process å®šæœŸæ‰«æ MTA ç¼“å­˜ï¼Œå‘ç°äº†ä»¥åä¸æ¥æ”¶ç«¯ SMTP server process å»ºç«‹ TCP è¿æ¥ï¼ˆå¯èƒ½éœ€è¦å…ˆ DNSï¼‰ï¼Œç«¯å£å·ä¸º 25\n\n\nTCP è¿æ¥å»ºç«‹å¥½äº†ä»¥å SMTP å¼€å§‹å‘é€é‚®ä»¶ï¼Œå‘å®Œäº†ä»¥å SMTP å…³é—­ TCP è¿æ¥\n\n\næ¥æ”¶ç«¯ MTA ä¸­çš„ SMTP è¿›ç¨‹æ”¶åˆ°é‚®ä»¶åå°±æ”¾åˆ°æ”¶ä¿¡äººçš„ç”¨æˆ·é‚®ç®±\n\n\næ”¶ä¿¡äººæ‰“ç®—æ”¶ä¿¡æ—¶ï¼Œè°ƒå– UAï¼Œé€šè¿‡ POP3 / IMAPï¼ˆåé¢è®¨è®ºï¼‰å–å›é‚®ä»¶\n\n\nMessage Formats\n\n\n\n\nSMTP, Simple Mail Transfer Protocol\n\n\nSMTP æ˜¯ä¸€ç§ ASCII åè®®ï¼Œè¿™æ ·æ–¹ä¾¿è°ƒè¯•ã€‚\n\nPOP3, Post Office Protocol 3\n\nTCP, port = 110\nä¸‹è½½å¹¶ä¿ç•™ or ä¸‹è½½å¹¶åˆ é™¤\n\nIMAP, Internet Message Access Protocol\n\nPOP3 çš„æ”¹è¿›ç‰ˆï¼›TCP, port = 143\n\nWWW\nArchitecture Overview\n\nWeb = World Wide Webï¼Œç”± Web pages ç»„æˆã€‚è§‚çœ‹å®ƒä»¬çš„ç¨‹åºæ˜¯ browser\nURL, Uniform Resource Locatorï¼Œ://:/ä¾‹å¦‚ www.yuque.com/xianyuxuan ä¸­ http è¯´æ˜äº†è®¿é—®è¿™ä¸ªé¡µé¢çš„æ–¹å¼ï¼Œwww.yuque.com ç»è¿‡ DNS è§£æåå¯ä»¥å¾—åˆ° IP åœ°å€ï¼Œxianyuxuan è¯´æ˜äº†å…·ä½“è¦çœ‹çš„æ˜¯è¿™ä¸ªä¸»æœºä¸Šçš„ä»€ä¹ˆã€‚\n\n\nHTTP, HyperText Transfer Protocol\n\nTCP, port = 80ï¼ŒASCII åè®®ã€‚æ¯”è¾ƒé€šç”¨ï¼Œä¸é™äº webã€‚\nHTTP request å¯ä»¥åœ¨ TCP ç¬¬ä¸‰æ¬¡æ¡æ‰‹å°±å¸¦ä¸Š\n\n\n\n\nFTP\nFile Transfer Protocolã€‚å…è®¸å®¢æˆ·æŒ‡æ˜æ–‡ä»¶çš„ç±»å‹å’Œæ ¼å¼ï¼Œå› æ­¤å¯ä»¥åœ¨ä¸åŒæ¶æ„ã€æ“ä½œç³»ç»Ÿä¹‹é—´çš„æ–‡ä»¶ä¼ è¾“ï¼›å…è®¸æ–‡ä»¶å…·æœ‰å­˜å–æƒé™ï¼Œæä¾›ä¸åŒç”¨æˆ·çš„æƒé™ï¼Œå› æ­¤å¯ä»¥å®ç°è¿œç¨‹æ–‡ä»¶ç®¡ç†å’Œæ–‡ä»¶å…±äº«ã€‚\nserver listen port 21, client TCP è¿æ¥ä¹‹ã€‚éšåå»ºç«‹æ•°æ®è¿æ¥ï¼Œæœ‰ 2 ç§æ–¹å¼\n\nä¸»åŠ¨æ¨¡å¼ POSTï¼šclient å¼€ä¸ªç«¯å£ Nï¼ˆä¸€èˆ¬æ˜¯ ctrl çš„ç«¯å£ + 1ï¼‰ï¼Œç»™ server å‘ POST Nï¼Œserver ç”¨ port 20 è¿æ¥ Nã€‚é—®é¢˜åœ¨äºå¦‚æœ client æœ‰ NAT ä¹‹ç±»çš„å¯èƒ½è¿ä¸ä¸Šã€‚\nè¢«åŠ¨æ¨¡å¼ PASVï¼šclient ç»™ server å‘ PASVï¼Œserver å¼€ä¸€ä¸ªéšæœºç«¯å£å¹¶ä¸”å‘Šè¯‰ clientï¼Œclient è¿è¿™ä¸ªç«¯å£ã€‚é—®é¢˜åœ¨äºé…ç½®å¤æ‚è€Œä¸”ä¸åˆ©äºå®‰å…¨ã€‚\n\nå…³äº OSI 7å±‚æ¨¡å‹\nOSI 7å±‚æ¨¡å‹ä¸­çš„ ä¼šè¯å±‚ Session Layer, è¡¨ç¤ºå±‚ Presentation Layer ä»¥åŠ åº”ç”¨å±‚ Application Layer å¯¹åº”äº†äº”å±‚åè®®ä½“ç³»ç»“æ„ä¸­çš„åº”ç”¨å±‚ã€‚\nSession Layer è´Ÿè´£ç®¡ç†ç«¯åˆ°ç«¯çš„ä¼šè¯ï¼Œå…·ä½“åŒ…æ‹¬ä¼šè¯çš„å»ºç«‹ã€ç®¡ç†å’Œä¸­æ­¢ã€‚ä¼šè¯æä¾›åŒæ­¥ã€checkpoint æ¢å¤ç­‰åŠŸèƒ½ã€‚\nPresentation Layer è´Ÿè´£å°†ä¸åŒæœºå™¨çš„ä¸åŒç¼–ç å’Œè¡¨ç¤ºæ–¹å¼è¿›è¡ŒæŠ½è±¡ã€ç»Ÿä¸€ï¼›åŒæ—¶ä¹Ÿæä¾›æ•°æ®å‹ç¼©ã€åŠ å¯†ç­‰åŠŸèƒ½ã€‚\nApplication Layer å°±æ˜¯æœ¬èŠ‚ä»‹ç»çš„ç”¨æˆ·ç•Œé¢ä»¥åŠä½¿ç”¨çš„å„ç§åè®®ã€‚"},"è¯¾ç¨‹ç¬”è®°/è®¡ç®—æœºç½‘ç»œ/HTTPä¸“é¡¹":{"slug":"è¯¾ç¨‹ç¬”è®°/è®¡ç®—æœºç½‘ç»œ/HTTPä¸“é¡¹","filePath":"è¯¾ç¨‹ç¬”è®°/è®¡ç®—æœºç½‘ç»œ/HTTPä¸“é¡¹.md","title":"HTTPä¸“é¡¹","links":[],"tags":[],"content":"HTTP æ˜¯ä¸€ä¸ªåœ¨è®¡ç®—æœºä¸–ç•Œé‡Œä¸“é—¨åœ¨ã€Œä¸¤ç‚¹ã€ä¹‹é—´ã€Œä¼ è¾“ã€æ–‡å­—ã€å›¾ç‰‡ã€éŸ³é¢‘ã€è§†é¢‘ç­‰ã€Œè¶…æ–‡æœ¬ã€æ•°æ®çš„ã€Œçº¦å®šå’Œè§„èŒƒã€ã€‚\nå¸¸è§çŠ¶æ€ç :\n1xx :æç¤ºä¿¡æ¯\n2xx: æˆåŠŸå¤„ç†äº†å®¢æˆ·ç«¯è¯·æ±‚\n3xx: é‡å®šå‘\n4xx: å®¢æˆ·ç«¯é”™è¯¯\n5xx: æœåŠ¡å™¨é”™è¯¯\ngetå’Œpost"},"è¯¾ç¨‹ç¬”è®°/è®¡ç®—æœºç½‘ç»œ/Lab/lab7-ç½‘ç»œåº”ç”¨åè®®-and-Socketç¼–ç¨‹æ¥å£":{"slug":"è¯¾ç¨‹ç¬”è®°/è®¡ç®—æœºç½‘ç»œ/Lab/lab7-ç½‘ç»œåº”ç”¨åè®®-and-Socketç¼–ç¨‹æ¥å£","filePath":"è¯¾ç¨‹ç¬”è®°/è®¡ç®—æœºç½‘ç»œ/Lab/lab7 ç½‘ç»œåº”ç”¨åè®®&Socketç¼–ç¨‹æ¥å£.md","title":"lab7 ç½‘ç»œåº”ç”¨åè®®&Socketç¼–ç¨‹æ¥å£","links":[],"tags":[],"content":"åŸºæœ¬çš„ç½‘ç»œåº”ç”¨è½¯ä»¶\nè‡ªå®šä¹‰çš„åè®®è§„èŒƒ\nSocketç¼–ç¨‹æ¥å£\nå®¢æˆ·ç«¯\næœåŠ¡ç«¯\nç¨‹åºç•Œé¢ï¼šå‘½ä»¤è¡Œæˆ–è€…æœ€ç®€å•çš„çª—ä½“\n\nIP åœ°å€ï¼šIPv4 (32 bits) or IPv6 (128 bits) åœ°å€ï¼Œä¸€å°è®¡ç®—æœºå¯ä»¥æ‹¥æœ‰ä¸€ä¸ªç‹¬ç«‹çš„IP åœ°å€ï¼›ä¸€ä¸ªå±€åŸŸç½‘ä¹Ÿå¯ä»¥æ‹¥æœ‰ä¸€ä¸ªç‹¬ç«‹çš„IP åœ°å€ï¼ˆå¯¹å¤–å°±å¥½åƒåªæœ‰ä¸€å°è®¡ç®—æœºï¼‰ã€‚\nMAC åœ°å€(48 bits)ï¼šæ¯ä¸ªç½‘å¡çš„MAC åœ°å€åœ¨å…¨ä¸–ç•Œéƒ½æ˜¯ç‹¬ä¸€æ— äºŒçš„ã€‚å¤šæ•°ç°å®çš„æƒ…å†µæ˜¯ï¼Œä¸€ä¸ªå±€åŸŸç½‘å¾€å¾€æ‰èƒ½æ‹¥æœ‰ä¸€ä¸ªç‹¬ç«‹çš„IPåœ°å€ï¼›æ¢å¥è¯è¯´ï¼ŒIP åœ°å€åªèƒ½å®šä½åˆ°ä¸€ä¸ªå±€åŸŸç½‘ï¼Œæ— æ³•å®šä½åˆ°å…·ä½“çš„ä¸€å°è®¡ç®—æœºã€‚\n\næ•°æ®åŒ…ä¸­é™¤äº†ä¼šé™„å¸¦å¯¹æ–¹çš„IP åœ°å€ï¼Œè¿˜ä¼šé™„å¸¦å¯¹æ–¹çš„MAC åœ°å€ï¼Œå½“æ•°æ®åŒ…è¾¾åˆ°å±€åŸŸç½‘ä»¥åï¼Œè·¯ç”±å™¨/äº¤æ¢æœºä¼šæ ¹æ®æ•°æ®åŒ…ä¸­çš„MAC åœ°å€æ‰¾åˆ°å¯¹åº”çš„è®¡ç®—æœºï¼Œç„¶åæŠŠæ•°æ®åŒ…è½¬äº¤ç»™å®ƒï¼Œè¿™æ ·å°±å®Œæˆäº†æ•°æ®çš„ä¼ é€’ã€‚\n\n\nç«¯å£å·(16 bits)ï¼šä¸€å°è®¡ç®—æœºå¯ä»¥åŒæ—¶æä¾›å¤šç§ç½‘ç»œæœåŠ¡ï¼Œä¾‹å¦‚Web æœåŠ¡ï¼ˆç½‘ç«™ï¼‰ã€FTP æœåŠ¡ï¼ˆæ–‡ä»¶ä¼ è¾“æœåŠ¡ï¼‰ã€SMTP æœåŠ¡ï¼ˆé‚®ç®±æœåŠ¡ï¼‰ç­‰ï¼Œä»…æœ‰IP åœ°å€å’ŒMAC åœ°å€ï¼Œè®¡ç®—æœºè™½ç„¶å¯ä»¥æ­£ç¡®æ¥æ”¶åˆ°æ•°æ®åŒ…ï¼Œä½†æ˜¯å´ä¸çŸ¥é“è¦å°†æ•°æ®åŒ…äº¤ç»™å“ªä¸ªç½‘ç»œåº”ç”¨ç¨‹åºæ¥å¤„ç†ã€‚ä¸ºäº†åŒºåˆ†ä¸åŒçš„ç½‘ç»œåº”ç”¨ç¨‹åºï¼Œè®¡ç®—æœºä¼šä¸ºæ¯ä¸ªç½‘ç»œç¨‹åºåˆ†é…ä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„ç«¯å£å·ï¼ˆPort Numberï¼‰ã€‚ç«¯å£ï¼ˆPortï¼‰æ˜¯ä¸€ä¸ªè™šæ‹Ÿçš„ã€é€»è¾‘ä¸Šçš„æ¦‚å¿µã€‚å¯ä»¥å°†æŸå°è®¡ç®—æœºçœ‹æˆæ˜¯ä¸€ä¸ªå±…æ°‘æ¥¼ï¼Œè€Œæ¯ä¸ªç½‘ç»œåº”ç”¨ç¨‹åºæ˜¯å±…ä½åœ¨è¿™ä¸ªæ¥¼çš„å±…æ°‘ï¼Œä¸ºäº†èƒ½æŠŠä¿¡ä»¶æŠ•é€åˆ°å®¶ï¼Œå¿…é¡»åœ¨æŠ•é€åœ°å€ä¸Šå†™æ˜æˆ¿é—´å·ã€‚\n\næ³¨æ„ä¸€èˆ¬0-1023ç«¯å£æ˜¯åˆ†é…ç»™ä¸€äº›ç‰¹å®šçš„ç½‘ç»œåº”ç”¨æœåŠ¡ï¼Œå¦‚\n\nhttp (TCP) æœåŠ¡çš„ç«¯å£å·æ˜¯80ï¼Œhttps(TCP)æœåŠ¡çš„ç«¯å£å·æ˜¯443\nDNS(UDP)æœåŠ¡çš„ç«¯å£å·æ˜¯53\nFTP æœåŠ¡çš„ç«¯å£å·æ˜¯21\nSMTP æœåŠ¡çš„ç«¯å£å·æ˜¯25 (POP3 ï£§101)\n\n\næˆ‘ä»¬å®éªŒä¸­ç«¯å£å·è¯·é€‰æ‹©1024-65535ä¹‹é—´çš„æ•°å€¼ï¼ˆä»¥è‡ªå·±å­¦å·çš„åå››ä½ä½œä¸ºæœåŠ¡å™¨ç«¯çš„ç›‘å¬ç«¯å£å·ï¼Œå¦‚æœåå››ä½ä¸­çš„ç¬¬ä¸€ä½ä¸ºé›¶ï¼Œåˆ™é‡‡ç”¨1XXXXï¼‰ã€‚\n\n\n\nsocket\nsocket çš„åŸæ„æ˜¯â€œæ’åº§â€ï¼Œåœ¨è®¡ç®—æœºé€šä¿¡é¢†åŸŸï¼Œsocket è¢«ç¿»è¯‘ä¸ºâ€œå¥—æ¥å­—â€ï¼Œå®ƒæ˜¯è®¡ç®—æœºä¹‹é—´è¿›è¡Œé€šä¿¡çš„ä¸€ç§çº¦å®šæˆ–ä¸€ç§æ–¹å¼ã€‚é€šè¿‡socket è¿™ç§çº¦å®šï¼Œä¸€å°è®¡ç®—æœºå¯ä»¥æ¥æ”¶å…¶ä»–è®¡ç®—æœºçš„æ•°æ®ï¼Œä¹Ÿå¯ä»¥å‘å…¶ä»–è®¡ç®—æœºå‘é€æ•°æ®ã€‚\n\n\n                  \n                  UNIX/Linux ä¸­çš„socket æ˜¯ä»€ä¹ˆï¼Ÿ \n                  \n                \n\n\nåœ¨UNIX/Linux ç³»ç»Ÿä¸­ï¼Œä¸ºäº†ç»Ÿä¸€å¯¹å„ç§ç¡¬ä»¶çš„æ“ä½œï¼Œç®€åŒ–æ¥å£ï¼Œä¸åŒçš„ç¡¬ä»¶è®¾å¤‡ä¹Ÿéƒ½è¢«çœ‹æˆä¸€ä¸ªæ–‡ä»¶ã€‚å¯¹è¿™äº›æ–‡ä»¶çš„æ“ä½œï¼Œç­‰åŒäºå¯¹ç£ç›˜ä¸Šæ™®é€šæ–‡ä»¶çš„æ“ä½œã€‚\n\né€šå¸¸ç”¨0 æ¥è¡¨ç¤ºæ ‡å‡†è¾“å…¥æ–‡ä»¶ï¼ˆstdinï¼‰ï¼Œå®ƒå¯¹åº”çš„ç¡¬ä»¶è®¾å¤‡å°±æ˜¯é”®ç›˜ï¼›\né€šå¸¸ç”¨1 æ¥è¡¨ç¤ºæ ‡å‡†è¾“å‡ºæ–‡ä»¶ï¼ˆstdoutï¼‰ï¼Œå®ƒå¯¹åº”çš„ç¡¬ä»¶è®¾å¤‡å°±æ˜¯æ˜¾ç¤ºå™¨ã€‚\n\n\nä¸ºäº†è¡¨ç¤ºå’ŒåŒºåˆ†å·²ç»æ‰“å¼€çš„æ–‡ä»¶ï¼ŒUNIX/Linux ä¼šç»™æ¯ä¸ªæ–‡ä»¶åˆ†é…ä¸€ä¸ªIDï¼Œè¿™ä¸ªID å°±æ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œè¢«ç§°ä¸ºæ–‡ä»¶æè¿°ç¬¦ï¼ˆFile Descriptorï¼‰ã€‚\nç½‘ç»œè¿æ¥ä¹Ÿæ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œå®ƒä¹Ÿæœ‰æ–‡ä»¶æè¿°ç¬¦ï¼\næˆ‘ä»¬å¯ä»¥é€šè¿‡socket() å‡½æ•°æ¥åˆ›å»ºä¸€ä¸ªç½‘ç»œè¿æ¥ï¼Œæˆ–è€…è¯´æ‰“å¼€ä¸€ä¸ªç½‘ç»œæ–‡ä»¶ï¼Œsocket() çš„è¿”å›å€¼å°±æ˜¯æ–‡ä»¶æè¿°ç¬¦ã€‚\n\næœ‰äº†æ–‡ä»¶æè¿°ç¬¦ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨æ™®é€šçš„æ–‡ä»¶æ“ä½œå‡½æ•°æ¥ä¼ è¾“æ•°æ®äº†\nç”¨read() è¯»å–ä»è¿œç¨‹è®¡ç®—æœºä¼ æ¥çš„æ•°æ®ï¼›\nç”¨write() å‘è¿œç¨‹è®¡ç®—æœºå†™å…¥æ•°æ®ã€‚\n\n\n\n\n\n\n\n                  \n                  Window ç³»ç»Ÿä¸­çš„socket æ˜¯ä»€ä¹ˆï¼Ÿ \n                  \n                \n\n\nWindows ä¹Ÿæœ‰ç±»ä¼¼â€œæ–‡ä»¶æè¿°ç¬¦â€çš„æ¦‚å¿µï¼Œä½†é€šå¸¸è¢«ç§°ä¸ºâ€œæ–‡ä»¶å¥æŸ„â€ã€‚\nä¸UNIX/Linux ä¸åŒçš„æ˜¯ï¼ŒWindows ä¼šåŒºåˆ†socket å’Œæ–‡ä»¶ï¼ŒWindows å°±æŠŠsocket å½“åšä¸€ä¸ªç½‘ç»œè¿æ¥æ¥å¯¹å¾…ï¼Œå› æ­¤éœ€è¦è°ƒç”¨ä¸“é—¨é’ˆå¯¹socket è€Œè®¾è®¡çš„æ•°æ®ä¼ è¾“å‡½æ•°ï¼Œé’ˆå¯¹æ™®é€šæ–‡ä»¶çš„è¾“å…¥è¾“å‡ºå‡½æ•°å°±æ— æ•ˆäº†ã€‚\n\n\n\nsocketçš„ç§ç±»\næµæ ¼å¼å¥—æ¥å­—ï¼ˆSOCK_STREAMï¼‰\n\næ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ä¸ä¼šæ¶ˆå¤±ï¼›\næ•°æ®æ˜¯æŒ‰ç…§é¡ºåºä¼ è¾“çš„ï¼›\næ•°æ®çš„å‘é€å’Œæ¥æ”¶ä¸æ˜¯åŒæ­¥çš„(æµæ ¼å¼å¥—æ¥å­—çš„å†…éƒ¨æœ‰ä¸€ä¸ªç¼“å†²åŒºï¼ˆæ˜¯ä¸€ä¸ªå­—ç¬¦æ•°ç»„ï¼‰ï¼Œé€šè¿‡socket ä¼ è¾“çš„æ•°æ®å°†ä¿å­˜åˆ°è¿™ä¸ªç¼“å†²åŒºã€‚æ¥æ”¶ç«¯åœ¨æ”¶åˆ°æ•°æ®åå¹¶ä¸ä¸€å®šç«‹å³è¯»å–ï¼Œåªè¦æ•°æ®ä¸è¶…è¿‡ç¼“å†²åŒºçš„å®¹é‡ï¼Œæ¥æ”¶ç«¯æœ‰å¯èƒ½åœ¨ç¼“å†²åŒºè¢«å¡«æ»¡ä»¥åä¸€æ¬¡æ€§åœ°è¯»å–ï¼Œä¹Ÿå¯èƒ½åˆ†æˆå¥½å‡ æ¬¡è¯»å–ã€‚)\nExample: HTTP (TCP)\n\n\næ•°æ®æŠ¥æ ¼å¼å¥—æ¥å­—ï¼ˆSOCK_DGRAMï¼‰\nè®¡ç®—æœºåªç®¡ä¼ è¾“æ•°æ®ï¼Œä¸ä½œæ•°æ®æ ¡éªŒï¼Œå¦‚æœæ•°æ®åœ¨ä¼ è¾“ä¸­æŸåï¼Œæˆ–è€…æ²¡æœ‰åˆ°è¾¾å¦ä¸€å°è®¡ç®—æœºï¼Œæ˜¯æ²¡æœ‰åŠæ³•è¡¥æ•‘çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ•°æ®é”™äº†å°±é”™äº†ï¼Œæ— æ³•é‡ä¼ ã€‚\n\nå¼ºè°ƒå¿«é€Ÿä¼ è¾“è€Œéä¼ è¾“é¡ºåºï¼›\nä¼ è¾“çš„æ•°æ®å¯èƒ½ä¸¢å¤±ä¹Ÿå¯èƒ½æŸæ¯ï¼›\né™åˆ¶æ¯æ¬¡ä¼ è¾“çš„æ•°æ®å¤§å°ï¼›\næ•°æ®çš„å‘é€å’Œæ¥æ”¶æ˜¯åŒæ­¥çš„\nExample: QQè§†é¢‘å’Œè¯­éŸ³èŠå¤©(UDP)\n\næˆ‘ä»¬æ‰€è¯´çš„socketç¼–ç¨‹ï¼Œæ˜¯åœ¨ä¼ è¾“å±‚çš„åŸºç¡€ä¸Šï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨TCP/UDP åè®®ã€‚ä½†æ˜¯å®éªŒè¦æ±‚TCP\nConstructing Message\nByte Ordering\n\nDifferent machines / OSâ€™s use different word orderings\n\nLittle-endian: lower bytes first\nBig-endian: higher bytes first\n\n\n\næ³¨æ„ä¸åŒç±»å‹çš„ä¸»æœºå­—èŠ‚é¡ºåºä¸åŒï¼ˆä½†æ˜¯ç½‘ç»œä¼ è¾“è¿‡ç¨‹ä¸­éƒ½æ˜¯å¤§ç«¯çš„é¡ºåºï¼‰ä¸ºäº†å¯ç§»æ¤æ€§ï¼Œéœ€è¦ä½¿ç”¨å››ä¸ªå‡½æ•°ï¼š\n\nsï¼š16bitsçš„port numbers\nlï¼š32bitsçš„port numbers\nAlignment &amp; Padding\nå¯¹é½å’Œç½®é›¶\nAlignmentï¼šæŠŠæ•°æ®æ”¾ç½®åœ¨å†…å­˜ä¸­åœ°å€ç­‰äºå­—èŠ‚å€æ•°çš„ä½ç½®ï¼Œè¿™æ ·å¯ä»¥æé«˜ç³»ç»Ÿæ€§èƒ½\nPaddingï¼šå¡«å……æ’å…¥é¢å¤–å­—èŠ‚\n\nFraming &amp; Parsing\nFraming\nParsing\nå…·ä½“çš„ç¼–ç¨‹\nMany network applications consists of a pair programs â€”â€”a client program and a server program â€”â€”residing in two different end systemsï¼ˆweb or ftpï¼‰\nç¨‹åºæ‰§è¡Œæ—¶ä¼šåˆ›å»ºä¸€ä¸ªå®¢æˆ·ç«¯è¿›ç¨‹å’Œä¸€ä¸ªæœåŠ¡å™¨è¿›ç¨‹ï¼Œè¿™äº›è¿›ç¨‹é€šè¿‡ä»å¥—æ¥å­—è¯»å–å’Œå‘å¥—æ¥å­—å†™å…¥æ¥ç›¸äº’é€šä¿¡ã€‚\n\nå†³å®šå“ªç§ä¼ è¾“å±‚åè®® TCP/UDP\n\n\nTCPæ˜¯é¢å‘é“¾æ¥çš„ï¼Œæä¾›ä¸€ä¸ªå¯é çš„å­—èŠ‚æµä¿¡é“ï¼ˆTCPæ˜¯å†…é©»åœ¨æ“ä½œç³»ç»Ÿé‡Œé¢ï¼Œæˆ‘ä»¬è¦å†™çš„æ˜¯ç½‘ç»œå±‚çš„åè®®ï¼‰\n\n\nUDPæ˜¯é¢å‘æ— é“¾æ¥çš„ï¼Œå°†ç‹¬ç«‹çš„æ•°æ®åŒ…ä»ä¸€ä¸ªç«¯ç³»ç»Ÿå‘é€åˆ°å¦ä¸€ä¸ªç«¯ç³»ç»Ÿï¼Œä¸ä¿è¯ä»»ä½•äº¤ä»˜æ€§\n\n\n\n\nTCPæ•°æ®æŠ¥ç»“æ„\nâ€¢ 1) åºå·ï¼šSeqï¼ˆSequence Numberï¼‰åºå·å 32ä½ï¼Œç”¨æ¥æ ‡è¯†ä»è®¡ç®—æœºAå‘é€åˆ°è®¡ç®—æœºBçš„æ•°æ®åŒ…çš„åºå·ï¼Œè®¡ç®—æœºå‘é€æ•°æ®æ—¶å¯¹æ­¤è¿›è¡Œæ ‡è®°ã€‚æ¯å‘ä¸€ä¸ªå­—èŠ‚éƒ½æœ‰ä¸€ä¸ªç‹¬ç«‹çš„åºå·\nâ€¢ 2) ç¡®è®¤å·ï¼šAckï¼ˆAcknowledge Numberï¼‰ç¡®è®¤å·å 32ä½ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯éƒ½å¯ä»¥å‘é€ï¼ŒAck = Seq + 1ã€‚ç¡®è®¤è¢«æ¥æ”¶\nâ€¢ 3) æ ‡å¿—ä½ï¼šæ¯ä¸ªæ ‡å¿—ä½å ç”¨1Bitï¼Œå…±æœ‰6ä¸ªï¼Œåˆ†åˆ«ä¸º URGã€ACKã€PSHã€RSTã€SYNã€FINï¼Œå…·ä½“å«ä¹‰å¦‚ä¸‹ï¼š\nâ€“ URG ç´§æ€¥æŒ‡é’ˆï¼ˆurgent pointerï¼‰æœ‰æ•ˆã€‚\nâ€“ ACK ç¡®è®¤åºå·æœ‰æ•ˆï¼ˆ1 ï¼‰ã€‚\nâ€“ PSH æ¥æ”¶æ–¹åº”è¯¥å°½å¿«å°†è¿™ä¸ªæŠ¥æ–‡äº¤ç»™åº”ç”¨å±‚ã€‚\nâ€“ RST é‡ç½®è¿æ¥ã€‚\nâ€“ SYN å»ºç«‹ä¸€ä¸ªæ–°è¿æ¥ï¼ˆ1 ï¼‰ã€‚\nâ€“ FIN æ–­å¼€ä¸€ä¸ªè¿æ¥ã€‚\n\n\nTCPä¸‰æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥\n\næ•°æ®åœ¨ä¼ è¾“å‰è¦å»ºç«‹è¿æ¥ ï¼ˆconnect() å‡½æ•°ï¼Œä¸ºäº†ä¿è¯ipåœ°å€ã€ç«¯å£ã€ç‰©ç†é“¾è·¯æ­£ç¡®ï¼‰ï¼Œä¼ è¾“å®Œæ¯•åè¿˜è¦æ–­å¼€è¿æ¥ã€‚\nTCPå»ºç«‹è¿æ¥æ—¶è¦ä¼ è¾“ä¸‰ä¸ªæ•°æ®åŒ…ï¼Œä¿—ç§°ä¸‰æ¬¡æ¡æ‰‹ï¼ˆThree-wayHandshakingï¼‰ã€‚å¯ä»¥å½¢è±¡çš„æ¯”å–»ä¸ºä¸‹é¢çš„å¯¹è¯ï¼š\n\n[Shake1] å¥—æ¥å­—Aï¼šâ€œä½ å¥½ï¼Œå¥—æ¥å­—Bï¼Œæˆ‘è¿™é‡Œæœ‰æ•°æ®è¦ä¼ é€ç»™ä½ ï¼Œå»ºç«‹è¿æ¥å§ã€‚â€\n[Shake2] å¥—æ¥å­—Bï¼šâ€œå¥½çš„ï¼Œæˆ‘è¿™è¾¹å·²å‡†å¤‡å°±ç»ªã€‚â€\n[Shake3] å¥—æ¥å­—Aï¼šâ€œè°¢è°¢ä½ å—ç†æˆ‘çš„è¯·æ±‚ã€‚â€\n\n\n\nå»ºç«‹è¿æ¥æ—¶éœ€è¦è¿›è¡Œä¸‰æ¬¡æ¡æ‰‹\n\nå»ºç«‹é“¾æ¥æˆåŠŸåè¿›è¡Œæ•°æ®ä¼ è¾“\n\nå½“æ•°æ®åŒ…åœ¨ä¼ è¾“çš„è¿‡ç¨‹ä¸­å‘ç”Ÿä¸¢å¤±çš„æ—¶å€™ï¼Œä¼šè¿›è¡Œé‡ä¼ ã€‚å¦‚ä½•å‘ç°ä¸¢å¤±çš„å‘¢ï¼ŸRTTï¼šround trip time\nTCPå››æ¬¡æ¡æ‰‹æ–­å¼€è¿æ¥\nå»ºç«‹è¿æ¥éå¸¸é‡è¦ï¼Œå®ƒæ˜¯æ•°æ®æ­£ç¡®ä¼ è¾“çš„å‰æï¼›æ–­å¼€è¿æ¥åŒæ ·é‡è¦ï¼Œå®ƒè®©è®¡ç®—æœºé‡Šæ”¾ä¸å†ä½¿ç”¨çš„èµ„æºã€‚å¦‚æœè¿æ¥ä¸èƒ½æ­£å¸¸æ–­å¼€ï¼Œä¸ä»…ä¼šé€ æˆæ•°æ®ä¼ è¾“é”™è¯¯ï¼Œè¿˜ä¼šå¯¼è‡´å¥—æ¥å­—ä¸èƒ½å…³é—­ï¼ŒæŒç»­å ç”¨èµ„æºï¼Œå¦‚æœå¹¶å‘é‡é«˜ï¼ŒæœåŠ¡å™¨å‹åŠ›å ªå¿§ã€‚\nå»ºç«‹è¿æ¥éœ€è¦ä¸‰æ¬¡æ¡æ‰‹ï¼Œæ–­å¼€è¿æ¥éœ€è¦å››æ¬¡æ¡æ‰‹ï¼Œå¯ä»¥å½¢è±¡çš„æ¯”å–»ä¸ºä¸‹é¢çš„å¯¹è¯ï¼š\n\n\n[Shake 1] å¥—æ¥å­—Aï¼šâ€œä»»åŠ¡å¤„ç†å®Œæ¯•ï¼Œæˆ‘å¸Œæœ›æ–­å¼€è¿æ¥ã€‚â€\n\n\n[Shake 2] å¥—æ¥å­—Bï¼šâ€œå“¦ï¼Œæ˜¯å—ï¼Ÿè¯·ç¨ç­‰ï¼Œæˆ‘å‡†å¤‡ä¸€ä¸‹ã€‚â€\n\n\nç­‰å¾…ç‰‡åˆ»åâ€¦â€¦\n\n\n[Shake 3] å¥—æ¥å­—Bï¼šâ€œæˆ‘å‡†å¤‡å¥½äº†ï¼Œå¯ä»¥æ–­å¼€è¿æ¥äº†ã€‚â€\n\n\n[Shake 4] å¥—æ¥å­—Aï¼šâ€œå¥½çš„ï¼Œè°¢è°¢åˆä½œã€‚â€\n\n5000å’Œ7000æ²¡å…³è”\nç¬¬äºŒä¸ªfinåŒ…ï¼šseqå€¼+1äº†ï¼Œä½†æ˜¯ackå€¼æ²¡æœ‰è¿›è¡Œå˜åŒ–ã€‚å› ä¸ºå®¢æˆ·ç«¯åœ¨ackå’ŒfinåŒ…ä¹‹é—´æ²¡æœ‰å‘å‡ºæ–°çš„æ•°æ®åŒ…ç»™æœåŠ¡å™¨ç«¯ã€‚åœ¨è¿™ä¸ªåŒ…é‡Œfinä¼šç½®1ã€‚\nç¬¬äºŒä¸ªackåŒ…ï¼šåœ¨ä¸Šä¸€ä¸ªfinåŒ…çš„seqåŸºç¡€ä¸Š7001+1\n\n\nå®¢æˆ·ç«¯æœ€åä¸€æ¬¡å‘é€ ACKåŒ…åè¿›å…¥ TIME_WAIT çŠ¶æ€ï¼Œè€Œä¸æ˜¯ç›´æ¥è¿›å…¥ CLOSED çŠ¶æ€å…³é—­è¿æ¥ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ\n\nTCP æ˜¯é¢å‘è¿æ¥çš„ä¼ è¾“æ–¹å¼ï¼Œå¿…é¡»ä¿è¯æ•°æ®èƒ½å¤Ÿæ­£ç¡®åˆ°è¾¾ç›®æ ‡æœºå™¨ï¼Œä¸èƒ½ä¸¢å¤±æˆ–å‡ºé”™ï¼Œè€Œç½‘ç»œæ˜¯åŠ¨æ€ã€ä¸ç¨³å®šçš„ï¼Œæ•°æ®éšæ—¶å¯èƒ½è¢«ä¼šæ¯åæˆ–ä¸¢å¼ƒï¼Œæ‰€ä»¥æœºå™¨Aæ¯æ¬¡å‘æœºå™¨Bå‘é€æ•°æ®åŒ…åï¼Œéƒ½è¦æ±‚æœºå™¨Bâ€œç¡®è®¤â€ ï¼Œå›ä¼ ACKåŒ…ï¼Œå‘Šè¯‰æœºå™¨Aæˆ‘æ”¶åˆ°äº†ï¼Œè¿™æ ·æœºå™¨Aæ‰èƒ½çŸ¥é“æ•°æ®ä¼ é€æˆåŠŸäº†ã€‚å¦‚æœæœºå™¨Bæ²¡æœ‰å›ä¼ ACKåŒ…ï¼Œæœºå™¨Aä¼šé‡æ–°å‘é€ï¼Œç›´åˆ°æœºå™¨Bå›ä¼ ACKåŒ…ã€‚\n\n\n\nå®¢æˆ·ç«¯æœ€åä¸€æ¬¡å‘æœåŠ¡å™¨å›ä¼ ACKåŒ…æ—¶ï¼Œæœ‰å¯èƒ½ä¼šå› ä¸ºç½‘ç»œé—®é¢˜å¯¼è‡´æœåŠ¡å™¨æ”¶ä¸åˆ°ï¼ŒæœåŠ¡å™¨ä¼šå†æ¬¡å‘é€ FIN åŒ…ï¼Œå¦‚æœè¿™æ—¶å®¢æˆ·ç«¯å®Œå…¨å…³é—­äº†è¿æ¥ï¼Œé‚£ä¹ˆæœåŠ¡å™¨æ— è®ºå¦‚ä½•ä¹Ÿæ”¶ä¸åˆ°ACKåŒ…äº†ï¼Œæ‰€ä»¥å®¢æˆ·ç«¯éœ€è¦ç­‰å¾…ç‰‡åˆ»ã€ç¡®è®¤å¯¹æ–¹æ”¶åˆ°ACKåŒ…åæ‰èƒ½è¿›å…¥CLOSEDçŠ¶æ€ã€‚é‚£ä¹ˆï¼Œè¦ç­‰å¾…å¤šä¹…å‘¢ï¼Ÿï¼ˆå°±æ˜¯è¯´ç»è¿‡ä¸€æ®µæ—¶é—´æ²¡å‘å‡ºæœ‰é—®é¢˜çš„ä¿¡å·ï¼Œæ‰èƒ½ç¡®è®¤æ²¡é—®é¢˜ï¼‰\n\næ•°æ®åŒ…åœ¨ç½‘ç»œä¸­æ˜¯æœ‰ç”Ÿå­˜æ—¶é—´çš„ï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´è¿˜æœªåˆ°è¾¾ç›®æ ‡ä¸»æœºå°±ä¼šè¢«ä¸¢å¼ƒï¼Œå¹¶é€šçŸ¥æºä¸»æœºã€‚è¿™ç§°ä¸ºæŠ¥æ–‡æœ€å¤§ç”Ÿå­˜æ—¶é—´ï¼ˆMSLï¼ŒMaximum Segment Lifetimeï¼‰ã€‚TIME_WAIT è¦ç­‰å¾… 2MSLæ‰ä¼šè¿›å…¥ CLOSED çŠ¶æ€ã€‚ACK åŒ…åˆ°è¾¾æœåŠ¡å™¨éœ€è¦ MSL æ—¶é—´ï¼ŒæœåŠ¡å™¨é‡ä¼  FIN åŒ…ä¹Ÿéœ€è¦ MSL æ—¶é—´ï¼Œ2MSL æ˜¯æ•°æ®åŒ…å¾€è¿”çš„æœ€å¤§æ—¶é—´ï¼Œå¦‚æœ 2MSL åè¿˜æœªæ”¶åˆ°æœåŠ¡å™¨é‡ä¼ çš„ FIN åŒ…ï¼Œå°±è¯´æ˜æœåŠ¡å™¨å·²ç»æ”¶åˆ°äº† ACK åŒ…ã€‚\n\nå¦‚æœfinåŒ…ä¹Ÿæ²¡é€åˆ°å‘¢ï¼Ÿå®é™…ä¸Šï¼Œackæ²¡è¾¾åˆ°æœåŠ¡å™¨ç«¯çš„è¯ï¼Œä¼šé€šçŸ¥å®¢æˆ·ç«¯é‡å‘çš„ï¼Œä¹Ÿå°±ä¸ä¼šæœ‰æœåŠ¡å™¨å‘é€finåŒ…çš„é—®é¢˜äº†ã€‚\n\n\n\n\n\n\nlinuxçš„socketä¾‹å­\n\nå‡½æ•°åå’Œæˆ‘ä»¬ç”¨çš„å¯èƒ½æœ‰æ‰€ä¸åŒ\nsocketï¼šå¼€æ´\nbindï¼šç»™é—¨æ´å®‰é—¨ç‰Œå·ï¼Œæ‰èƒ½æ­£å¸¸æ”¶å‘é‚®ä»¶\nlistenï¼šæœåŠ¡å™¨ç«¯ä½¿ç”¨çš„\nacceptï¼šæœåŠ¡å™¨ä½¿ç”¨çš„\nconnectï¼šå®¢æˆ·ç«¯ä½¿ç”¨çš„\nsendï¼šéƒ½æœ‰çš„\nreceiveï¼šéƒ½æœ‰çš„\ncloseï¼šéƒ½æœ‰çš„\n\n\nåœ¨ Linux ä¸‹ä½¿ç”¨ &lt;sys/socket.h&gt; å¤´æ–‡ä»¶ä¸­ socket() å‡½æ•°æ¥åˆ›å»ºå¥—æ¥å­—\n\n\nåŸå‹ä¸ºï¼šint socket(int af, int type, int protocol);ã€å› ä¸ºlinuxæŠŠç½‘ç»œè¿æ¥å½“æˆæ–‡ä»¶æ¥å¤„ç†ã€‘\n\nafä¸ºåœ°å€æ—ï¼ˆAddress Familyï¼‰ï¼Œä¹Ÿå°±æ˜¯ IP åœ°å€ç±»å‹ã€‚\n\nAF_INETè¡¨ç¤ºIPv4 åœ°å€ (INETæ˜¯â€œInternetâ€çš„ç®€å†™)\nAF_INET6è¡¨ç¤ºIPv6åœ°å€\nAF_UNIX (local channel, similar to pipes)\nAF_ISO (ISO protocols)\n\n\ntype ä¸ºæ•°æ®ä¼ è¾“æ–¹å¼/å¥—æ¥å­—ç±»å‹\n\nSOCK_STREAMï¼ˆæµæ ¼å¼å¥—æ¥å­—/é¢å‘è¿æ¥çš„å¥—æ¥å­— ~ TCPï¼‰\nSOCK_DGRAMï¼ˆæ•°æ®æŠ¥å¥—æ¥å­—/æ— è¿æ¥çš„å¥—æ¥å­— ~ UDPï¼‰\n\n\nprotocol è¡¨ç¤ºä¼ è¾“åè®®ï¼Œå¸¸ç”¨çš„æœ‰IPPROTO_TCP å’Œ IPPROTO_UDPï¼Œåˆ†åˆ«è¡¨ç¤º TCP ä¼ è¾“åè®®å’Œ UDP ä¼ è¾“åè®®ã€‚Usually set to 0 (i.e., use default protocol). æœ‰å¯èƒ½å¤šç§åè®®ä½¿ç”¨åŒä¸€ç§æ•°æ®ä¼ è¾“æ–¹å¼ï¼Œæ‰€ä»¥åœ¨socketç¼–ç¨‹ä¸­ï¼Œéœ€è¦åŒæ—¶æŒ‡æ˜æ•°æ®ä¼ è¾“æ–¹å¼å’Œåè®®ã€‚ï¼ˆ æä¾›é¢å‘è¿æ¥çš„æœåŠ¡ï¼Œä½†æ˜¯æœ‰å¤šä¸ªåè®®æ¥æ”¯æ’‘é¢å‘è¿æ¥çš„æœåŠ¡)\n\n\n\nåƒ connect()ã€accept() å’Œ bind() è¿™æ ·çš„å¥—æ¥å­—å‡½æ•°éœ€è¦ä½¿ç”¨ä¸“é—¨å®šä¹‰çš„åœ°å€ç»“æ„æ¥ä¿å­˜ IP åœ°å€ã€ç«¯å£å·å’Œåè®®ç±»å‹ã€‚\n\n\nå›°éš¾åœ¨äºä½ å¯ä»¥ä½¿ç”¨å¥—æ¥å­—ç”¨ä¸åŒçš„åè®®æ¥ç¼–å†™ç½‘ç»œåº”ç”¨ç¨‹åºã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ IPv4ã€IPv6ã€æœ¬åœ° Unix ç­‰ã€‚é—®é¢˜åœ¨äºï¼šæ¯ç§ä¸åŒçš„åè®®éƒ½ä½¿ç”¨ä¸åŒçš„åœ°å€ç»“æ„æ¥ä¿å­˜å…¶å¯»å€ä¿¡æ¯ï¼Œä½†å®ƒä»¬éƒ½ä½¿ç”¨ç›¸åŒçš„å‡½æ•° connect()ã€accept() å’Œ bind() ç­‰ã€‚\n\n\nå› æ­¤æ”¹æˆä¸€ä¸ªé€šç”¨çš„åœ°å€ç»“æ„å†ç»™è¿™äº›å‡½æ•°ç”¨\n\n\n\nstruct sockaddr\nstruct sockaddr{\nsa_family_t sin_family; //åœ°å€æ—(Address Family)ï¼Œä¹Ÿå°±æ˜¯åœ°å€ç±»å‹\nchar sa_data[14]; //IPåœ°å€å’Œç«¯å£å·\n};\n\nå¿…é¡»ä¼ é€’ç»™æ‰€æœ‰éœ€è¦åœ°å€ç»“æ„çš„ socket å‡½æ•°çš„åœ°å€ç»“æ„ã€‚\nå¼ºåˆ¶åœ°å€è½¬æ¢\n\nIPv4 address structure: struct sockaddr_in\nstruct sockaddr_in{\nsa_family_t sin_family; //åœ°å€æ—(Address Family)ï¼Œä¹Ÿå°±æ˜¯åœ°å€ç±»å‹\nuint16_t sin_port; //16ä½çš„ç«¯å£å·\nstruct in_addr sin_addr; //32ä½IPåœ°å€\nchar sin_zero[8]; //ä¸ä½¿ç”¨ï¼Œä¸€èˆ¬ç”¨0å¡«å……\n};\n \nstruct in_addr{\nin_addr_t s_addr; //32ä½çš„IPåœ°å€\n};\n\n\nsockaddræ˜¯ä¸€ç§é€šç”¨çš„ç»“æ„ä½“ï¼Œå¯ä»¥ç”¨æ¥ä¿å­˜å¤šç§ç±»å‹çš„IPåœ°å€å’Œç«¯å£å·ï¼Œè€Œ sockaddr_inæ˜¯ä¸“é—¨ç”¨æ¥ä¿å­˜ IPv4 åœ°å€çš„ç»“æ„ä½“ã€‚\n\nconnect(), bind()å’Œaccept()å‡½æ•°ä¸­ç¬¬äºŒä¸ªå‚æ•°çš„ç±»å‹ä¸º sockaddr\n\n\nsockaddrå’Œ sockaddr_inçš„é•¿åº¦ç›¸åŒï¼Œéƒ½æ˜¯16å­—èŠ‚ï¼Œsockaddrå°†IPåœ°å€å’Œç«¯å£å·åˆå¹¶åˆ°ä¸€èµ·ï¼Œç”¨ä¸€ä¸ªæˆå‘˜ sa_dataè¡¨ç¤ºã€‚è¦æƒ³ç»™ sa_dataèµ‹å€¼ï¼Œå¿…é¡»åŒæ—¶æŒ‡æ˜IPåœ°å€å’Œç«¯å£å·ï¼Œä¾‹å¦‚â€œ127.0.0.1:80â€ï¼Œé—æ†¾çš„æ˜¯ï¼Œæ²¡æœ‰ç›¸å…³å‡½æ•°å°†è¿™ä¸ªå­—ç¬¦ä¸²è½¬æ¢æˆéœ€è¦çš„å½¢å¼ï¼Œä¹Ÿå°±å¾ˆéš¾ç»™ sockaddrç±»å‹çš„å˜é‡èµ‹å€¼ï¼Œæ‰€ä»¥ä½¿ç”¨ sockaddr_inæ¥ä»£æ›¿ã€‚è¿™ä¸¤ä¸ªç»“æ„ä½“çš„é•¿åº¦ç›¸åŒï¼Œå¼ºåˆ¶è½¬æ¢ç±»å‹æ—¶ä¸ä¼šä¸¢å¤±å­—èŠ‚ï¼Œä¹Ÿæ²¡æœ‰å¤šä½™çš„å­—èŠ‚\n\nåœ¨æœåŠ¡å™¨ç«¯å»ºç«‹ä¸€ä¸ªsocket\n\nsocketï¼ˆï¼‰ åˆ›å»ºå¥—æ¥å­—\nbindï¼ˆï¼‰å°†å¥—æ¥å­—ç»‘å®šåˆ°ä¸€ä¸ªåœ°å€ï¼Œå¯¹äº Internet ä¸Šçš„æœåŠ¡å™¨å¥—æ¥å­—ï¼Œåœ°å€ç”±ä¸»æœºä¸Šçš„ç«¯å£å·ç»„æˆã€‚\nlistenï¼ˆï¼‰è°ƒç”¨ç›‘å¬è¿æ¥\nacceptï¼ˆï¼‰æ¥å—è¿æ¥ã€‚é€šå¸¸æ˜¯å µå¡åœ°ï¼Œç›´åˆ°æœ‰ä¸€ä¸ªå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨å»ºç«‹è¿æ¥\nå‘é€å’Œæ¥å—æ•°æ®\n\nç®€åŒ–ç‰ˆï¼š\n#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;arpa/inet.h&gt;\n#include &lt;sys/socket.h&gt;\n#include &lt;netinet/in.h&gt;\nint main(){\n//åˆ›å»ºå¥—æ¥å­—ï¼Œit just creates interface\nint serv_sock = socket(AF_INET, SOCK_STREAM, IPPROTO_TCP); //å¦‚æœserv_sock&lt; 0, åˆ™åˆ›å»ºå¤±è´¥ï¼Œæœ€å¥½æœ‰æ£€æŸ¥\n//å°†å¥—æ¥å­—å’ŒIPã€ç«¯å£ç»‘å®š\nstruct sockaddr_in serv_addr; //IPv4åœ°å€ç»“æ„ä½“\nmemset(&amp;serv_addr, 0, sizeof(serv_addr)); //æ¯ä¸ªå­—èŠ‚éƒ½ç”¨0å¡«å……\nserv_addr.sin_family = AF_INET;//ä½¿ç”¨IPv4åœ°å€\nserv_addr.sin_addr.s_addr = inet_addr(â€œ127.0.0.1â€);//æœåŠ¡å™¨IPåœ°å€(è¿™é‡Œä½¿ç”¨çš„æ˜¯æœ¬æœºåœ°å€ï¼Œã€æœ€å¥½ç”¨è¿™ä¸ªå› ä¸ºå¯èƒ½æœ¬æœºæœ‰å¾ˆå¤šä¸ªç½‘å¡è¦å¤šä¸ªå¥—æ¥å­—ï¼Œè¿™ä¸ªçš„è¯ä¸€ä¸ªå¥—æ¥å­—å°±å¯ä»¥ã€‘INADDR_ANY)\nserv_addr.sin_port = htons(1234); //ç«¯å£//å¯ç§»æ¤æ€§æ¯”è¾ƒå¥½\nbind(serv_sock, (struct sockaddr*)&amp;serv_addr, sizeof(serv_addr)); //è¿™é‡Œåœ°å€å¼ºåˆ¶è½¬æ¢\n//è¿›å…¥ç›‘å¬çŠ¶æ€ï¼Œç­‰å¾…ç”¨æˆ·å‘èµ·è¯·æ±‚\nlisten(serv_sock, 20); //20è¡¨ç¤ºæœåŠ¡å™¨ç«¯å¯å®¹çº³é˜Ÿåˆ—é•¿åº¦ï¼Œå¯ä»¥æœ‰20ä¸ªclientsç­‰å¾…è¿æ¥\n//æ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚\nstruct sockaddr_in clnt_addr;\nsocklen_t clnt_addr_size = sizeof(clnt_addr);\nint clnt_sock = accept(serv_sock, (struct sockaddr*)&amp;clnt_addr, &amp;clnt_addr_size);\n//å‘å®¢æˆ·ç«¯å‘é€æ•°æ®\nchar str[] = â€œHello Client!&quot;;\nwrite(clnt_sock, str, sizeof(str));\n//å…³é—­å¥—æ¥å­—\nclose(clnt_sock); close(serv_sock); return 0;\n}\nserv_sock ä¸€ç›´ç›‘å¬\nclnt_sock ç”¨äºæ¥æ”¶\néœ€è¦åœ¨è¿™ä¸ªæ¨¡æ¿ä¸Šå¢åŠ åšä¸€äº›åˆ›å»ºå¤±è´¥çš„æ£€æŸ¥\naccept\nint clnt_sock = accept(serv_sock, (struct sockaddr*)&amp;clnt_addr, &amp;clnt_addr_size);\n\naccept() è¿”å›ä¸€ä¸ªæ–°çš„å¥—æ¥å­—æ–‡ä»¶æè¿°ç¬¦ï¼Œç”¨äºä¸å®¢æˆ·ç«¯è¿›è¡Œè¯»å†™ã€‚åŸæœ‰çš„æ–‡ä»¶æè¿°ç¬¦é€šå¸¸ç”¨äºç›‘å¬æ–°çš„ä¼ å…¥è¿æ¥ã€‚\nå®ƒä»æœåŠ¡å™¨è¯¥å¥—æ¥å­—çš„é˜Ÿåˆ—ä¸­å‡ºé˜Ÿä¸‹ä¸€ä¸ªè¿æ¥è¯·æ±‚ã€‚å¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œè¯¥å‡½æ•°å°†é˜»å¡ç›´åˆ°æœ‰è¿æ¥è¯·æ±‚åˆ°è¾¾ã€‚\næ³¨æ„è¯¥å‡½æ•°çš„æœ€åä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªæŒ‡é’ˆã€‚ä½ ä¸æ˜¯åœ¨æŒ‡å®šé•¿åº¦ï¼Œå†…æ ¸ä¼šæŒ‡å®šå¹¶å°†å€¼è¿”å›ç»™ä½ çš„åº”ç”¨ï¼ŒåŒæ ·å¯¹äº clnt_addr ä¹Ÿæ˜¯å¦‚æ­¤ã€‚åœ¨ä¸å®¢æˆ·ç«¯å»ºç«‹è¿æ¥åï¼Œå¿…é¡»å°†å®¢æˆ·ç«¯çš„åœ°å€æä¾›ç»™ä½ çš„æœåŠ¡å™¨ï¼Œå¦åˆ™ä½ å¦‚ä½•å‘å®¢æˆ·ç«¯å‘é€å“åº”ï¼Ÿå› æ­¤ï¼Œaccept å‡½æ•°è°ƒç”¨ä¼šä¸ºä½ å¡«å……åœ°å€ç»“æ„å’Œåœ°å€ç»“æ„çš„é•¿åº¦ä»¥ä¾›ä½¿ç”¨ã€‚ã€\nå½“æœåŠ¡å™¨æ¥æ”¶åˆ°ï¼ˆæ¥å—ï¼‰å®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚æ—¶ â‡’ å®ƒä¼šæ´¾ç”Ÿï¼ˆforksï¼‰å‡ºè‡ªèº«çš„å‰¯æœ¬å¹¶è®©å­è¿›ç¨‹å¤„ç†è¯¥å®¢æˆ·ç«¯ã€‚ï¼ˆç¡®ä¿ä½ è®°ä½è¿™äº›æ“ä½œç³»ç»Ÿæ¦‚å¿µï¼‰å› æ­¤åœ¨æœåŠ¡å™¨æœºå™¨ä¸Šï¼Œç›‘å¬å¥—æ¥å­—ä¸å·²è¿æ¥å¥—æ¥å­—æ˜¯ä¸åŒçš„ã€‚\n\nwrite() and read()\nintwrite(int file_descriptor, const void *buf, size_t message_length);\nintread(int file_descriptor, char *buffer, size_t buffer_length);\n\nwrite() å‡½æ•°çš„è¿”å›å€¼æ˜¯å†™å…¥çš„å­—èŠ‚æ•°ï¼Œå¤±è´¥æ—¶è¿”å› âˆ’1\nè¿™ä¸ªå‡½æ•°æ‰€åšçš„æ˜¯å°†æ•°æ®ä»ä½ çš„åº”ç”¨ç¨‹åºä¼ è¾“åˆ°æœ¬æœºå†…æ ¸ä¸­çš„ä¸€ä¸ªç¼“å†²åŒºï¼Œå®ƒå¹¶ä¸ç›´æ¥é€šè¿‡ç½‘ç»œå‘é€æ•°æ®ã€‚TCP å®Œå…¨æ§åˆ¶æ•°æ®çš„å‘é€ï¼Œè¿™åœ¨å†…æ ¸å†…éƒ¨å®ç°ã€‚\nread() å‡½æ•°è¿”å›çš„æ˜¯è¯»å–çš„å­—èŠ‚æ•°ï¼Œå¯èƒ½å°äºç¼“å†²åŒºé•¿åº¦ã€‚å¤±è´¥æ—¶è¿”å› âˆ’1ã€‚\nread() ä»…å°†æ•°æ®ä»å†…æ ¸ä¸­çš„ç¼“å†²åŒºä¼ è¾“åˆ°ä½ çš„åº”ç”¨ç¨‹åºï¼Œä½ å¹¶ä¸æ˜¯ç›´æ¥ä»è¿œç¨‹ä¸»æœºè¯»å–å­—èŠ‚æµï¼Œè€Œæ˜¯ç”± TCP æ¥æ§åˆ¶å¹¶ä¸ºä½ çš„åº”ç”¨ç¼“å†²æ•°æ®ã€‚\n\n\n\næŠŠipåœ°å€è½¬åŒ–ä¸ºç”¨äºç½‘ç»œä¼ è¾“çš„äºŒè¿›åˆ¶æ•°å€¼\n\nintinet_aton(constchar cp, structin_addrinp);\ninet_aton() è½¬æ¢ç½‘ç»œä¸»æœºåœ°å€ip(å¦‚192.168.1.10)ä¸ºäºŒè¿›åˆ¶æ•°å€¼ï¼Œå¹¶å­˜å‚¨åœ¨structin_addrç»“æ„ä¸­ï¼Œå³ç¬¬äºŒä¸ªå‚æ•°*inp, å‡½æ•°è¿”å›éé›¶å€¼è¡¨ç¤ºcpä¸»æœºåœ°å€æœ‰æ•ˆï¼Œè¿”å›0è¡¨ç¤ºä¸»æœºåœ°å€æ— æ•ˆã€‚\nè¿™ä¸ªè½¬æ¢å®Œåä¸èƒ½ç”¨äºç½‘ç»œä¼ è¾“ï¼Œè¿˜éœ€è¦è°ƒç”¨htonlå‡½æ•°æ‰èƒ½å°†ä¸»æœºå­—èŠ‚é¡ºåºè½¬åŒ–ä¸ºç½‘ç»œå­—èŠ‚é¡ºåºã€‚\n\n\nå°†ç½‘ç»œä¼ è¾“çš„äºŒè¿›åˆ¶æ•°å€¼è½¬åŒ–ä¸ºæˆç‚¹åˆ†åè¿›åˆ¶çš„ipåœ°å€\n\nchar *inet_ntoa(structin_addrin);\ninet_ntoaå‡½æ•°è½¬æ¢ç½‘ç»œå­—èŠ‚æ’åºçš„åœ°å€ä¸ºæ ‡å‡†çš„ASCIIä»¥ç‚¹åˆ†å¼€çš„åœ°å€,è¯¥å‡½æ•°è¿”å›æŒ‡å‘ç‚¹åˆ†å¼€çš„å­—ç¬¦ä¸²åœ°å€ï¼ˆå¦‚192.168.1.10)çš„æŒ‡é’ˆï¼Œè¯¥å­—ç¬¦ä¸²çš„ç©ºé—´ä¸ºé™æ€åˆ†é…çš„ï¼Œè¿™æ„å‘³ç€åœ¨ç¬¬äºŒæ¬¡è°ƒç”¨è¯¥å‡½æ•°æ—¶ï¼Œä¸Šä¸€æ¬¡è°ƒç”¨å°†ä¼šè¢«é‡å†™ï¼ˆå¤ç›–ï¼‰ï¼Œæ‰€ä»¥å¦‚æœéœ€è¦ä¿å­˜è¯¥ä¸²æœ€å¥½å¤åˆ¶å‡ºæ¥è‡ªå·±ç®¡ç†ï¼\n\n\n\nåœ¨å®¢æˆ·ç«¯å»ºç«‹ä¸€ä¸ªå¥—æ¥å­—\n\nä½¿ç”¨ socket() ç³»ç»Ÿè°ƒç”¨åˆ›å»ºä¸€ä¸ªå¥—æ¥å­—\nä½¿ç”¨ connect() ç³»ç»Ÿè°ƒç”¨å°†å¥—æ¥å­—è¿æ¥åˆ°æœåŠ¡å™¨åœ°å€\nå‘é€å’Œæ¥æ”¶æ•°æ®ã€‚æœ‰å¤šç§æ–¹æ³•å¯ä»¥å®ç°ï¼Œä½†æœ€ç®€å•çš„æ˜¯ä½¿ç”¨ read() å’Œ write() ç³»ç»Ÿè°ƒç”¨ã€‚\n\n\næ³¨æ„ï¼Œå®¢æˆ·ç«¯éœ€è¦çŸ¥é“æœåŠ¡å™¨çš„å­˜åœ¨ä»¥åŠæœåŠ¡å™¨çš„åœ°å€ï¼Œä½†æœåŠ¡å™¨åœ¨è¿æ¥å»ºç«‹ä¹‹å‰æ— éœ€çŸ¥é“å®¢æˆ·ç«¯çš„åœ°å€ï¼ˆç”šè‡³æ— éœ€çŸ¥é“å®¢æˆ·ç«¯çš„å­˜åœ¨ï¼‰ã€‚ã€ å› ä¸ºacceptä¼šè‡ªåŠ¨è¯»å…¥ä¸æœåŠ¡ç«¯å»ºç«‹è¿æ¥çš„å®¢æˆ·ç«¯åœ°å€ä¿¡æ¯çš„ã€‘\nå¦è¯·æ³¨æ„ï¼Œä¸€æ—¦è¿æ¥å»ºç«‹ï¼ŒåŒæ–¹éƒ½å¯ä»¥å‘é€å’Œæ¥æ”¶ä¿¡æ¯ã€‚\n\n#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;arpa/inet.h&gt;\n#include &lt;sys/socket.h&gt;\nint main(){\n//åˆ›å»ºå¥—æ¥å­—\nint sock = socket(AF_INET, SOCK_STREAM, 0);\n//å‘æœåŠ¡å™¨ï¼ˆç‰¹å®šçš„IPå’Œç«¯å£ï¼‰å‘èµ·è¯·æ±‚\nstruct sockaddr_in serv_addr;\nmemset(&amp;serv_addr, 0, sizeof(serv_addr)); //æ¯ä¸ªå­—èŠ‚éƒ½ç”¨0å¡«å……\nserv_addr.sin_family = AF_INET; //ä½¿ç”¨IPv4åœ°å€\nserv_addr.sin_addr.s_addr = inet_addr(â€œ127.0.0.1â€);//æœåŠ¡å™¨IPåœ°å€(è¿™é‡Œæ˜¯æœ¬æœºåœ°å€)\nserv_addr.sin_port = htons(1234); //ç«¯å£\n//connect()å‡½æ•°æ‰§è¡ŒTCPä¸‰æ¬¡æ¡æ‰‹å»ºç«‹è”æ¥\nconnect(sock, (struct sockaddr*)&amp;serv_addr, sizeof(serv_addr));\n//è¯»å–æœåŠ¡å™¨ä¼ å›çš„æ•°æ®\nchar buffer[40];\nread(sock, buffer, sizeof(buffer)-1);\nprintf(&quot;Message form server: %s\\n&quot;, buffer);\n//å…³é—­å¥—æ¥å­—\nclose(sock); return 0;\n}\nwindowsçš„socketä¾‹å­\n//Windows ä¸æŠŠå¥—æ¥å­—ä½œä¸ºæ™®é€šæ–‡ä»¶å¯¹å¾…ï¼Œè€Œæ˜¯è¿”å› SOCKET ç±»å‹çš„å¥æŸ„ã€‚\nSOCKETsocket(int af, int type, int protocol);\n \n//Linuxä¸‹socketå‡½æ•°\nintsocket(intaf, inttype, intprotocol);\nGeneric:\nstructSOCKADDR{\nunsigned short sa_family;\nchar sa_data[14];\n};\nIPv4 address struct:\nstructsockaddr_in{\nshort sin_family;\nunsigned short sin_port;\nstructin_addrsin_addr;\nchar sin_zero[8];\n};\nstructin_addr{\nunion {\nstruct{unsigned char s_b1, s_b2, s_b3, s_b4;} S_un_b;\nstruct{unsigned short s_w1, s_w2;} S_un_w;\nunsigned long S_addr;\n} S_un;\n};\n//includeéƒ¨åˆ†\n//Windows ä¸‹çš„ socket ç¨‹åºä¾èµ– Winsock.dll æˆ– ws2_32.dllï¼Œå¿…é¡»æå‰åŠ è½½ã€‚\n#include &lt;stdio.h&gt;\n#include &lt;winsock2.h&gt;\n#pragma comment (lib, &quot;ws2_32.lib&quot;) //åŠ è½½ ws2_32.dll\nç»¿è‰²æ˜¯ä¸linuxä¸åŒçš„éƒ¨åˆ†\n\n\n\nå…¨æµç¨‹å›é¡¾\n\n\nCommunication via sockets necessitates existence of the 4-tuple:\n\nLocal IP address\nLocal Port#\nForeign IP address\nForeign Port#\n\n\nServer\n\nPassively waits for and responds to clients\nPassive socket è¢«åŠ¨å¥—æ¥å­—\n\n\nClient\n\nInitiates the communication\nMust know the address and the port of the server\nActive socket ä¸»åŠ¨å¥—æ¥å­—\n\n\n\n\næœåŠ¡å™¨å…ˆæ‰§è¡Œå¹¶ç­‰å¾…æ¥æ”¶\nå®¢æˆ·ç«¯åæ‰§è¡Œå¹¶ä¸”å‘æœåŠ¡å™¨å‘é€ç¬¬ä¸€ä¸ªç½‘ç»œæ•°æ®åŒ…\nå»ºç«‹è¿æ¥ä¹‹åï¼Œå®¢æˆ·ç«¯æˆ–è€…æœåŠ¡å™¨éƒ½å¯ä»¥å‘é€å’Œæ¥æ”¶æ•°æ®\n\nå…³äºå®éªŒ\n\næ¯å¢åŠ ä¸€ä¸ªåŠŸèƒ½å°±è°ƒè¯•ä¸€æ¬¡\n\n\nzjucomp.net/docs/Coding/toolchain\nä¸è¦ä½¿ç”¨å®šé•¿çš„æ•°æ®æŠ¥ï¼Œåè®®çš„å®šç•Œé—®é¢˜è¦è‡ªå·±æ€è€ƒ\nå®éªŒæŠ¥å‘Šï¼šä¸€äº›æ§åˆ¶ç›¸å…³çš„ å®¢æˆ·ç«¯æœ‰èœå•é€‰é¡¹ï¼ŒæœåŠ¡ç«¯æ²¡æœ‰èœå•é€‰é¡¹çš„è¯éœ€è¦è€ƒè™‘\n"},"è¯¾ç¨‹ç¬”è®°/è®¡ç®—æœºç½‘ç»œ/Lab/lab8":{"slug":"è¯¾ç¨‹ç¬”è®°/è®¡ç®—æœºç½‘ç»œ/Lab/lab8","filePath":"è¯¾ç¨‹ç¬”è®°/è®¡ç®—æœºç½‘ç»œ/Lab/lab8.md","title":"lab8","links":[],"tags":[],"content":"URIè§£æä¸æ˜ å°„\n\nç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦URIï¼ˆUniform Resource Identifierï¼‰ä¸ºäº’è”ç½‘ä¸Šçš„èµ„æºæä¾›äº†ä¸€ç§æ ‡å‡†åŒ–çš„å‘½åå’Œå®šä½æœºåˆ¶ï¼Œæå¤§åœ°ä¾¿åˆ©äº†èµ„æºçš„å‘ç°ä¸è®¿é—®è¿‡ç¨‹\nURIæ˜¯ä¸€ç§ç”¨äºå”¯ä¸€åœ°æ ‡è¯†äº’è”ç½‘ä¸Šèµ„æºçš„å­—ç¬¦ä¸²ï¼Œå®ƒå¯ä»¥æŒ‡å‘ä»»ä½•ç±»å‹çš„èµ„æºï¼ŒåŒ…æ‹¬æ–‡æ¡£ã€å›¾ç‰‡ã€è§†é¢‘æµã€æœåŠ¡å…¥å£ç‚¹ç­‰ï¼ŒURIçš„è®¾è®¡ç›®çš„æ˜¯ä¸ºäº†ç¡®ä¿æ¯ä¸ªèµ„æºåœ¨å…¨çƒèŒƒå›´å†…éƒ½èƒ½è¢«å”¯ä¸€è¯†åˆ«ï¼Œæ ¹æ®å…¶åŠŸèƒ½å’Œç»“æ„çš„ä¸åŒï¼ŒURIä¸­å¯ä»¥è¿›ä¸€æ­¥åˆ’åˆ†ä¸ºURLå’ŒURNä¸¤ç§ç±»å‹ï¼š\n\nç»Ÿä¸€èµ„æºå®šä½ç¬¦URLï¼ˆUniform Resource Locatorï¼‰\næœ€å¸¸è§çš„URIå½¢å¼ï¼Œæä¾›äº†è®¿é—®ç‰¹å®šèµ„æºçš„è·¯å¾„å’Œæ–¹æ³•ï¼ŒURLä¸ä»…å‘Šè¯‰è®¡ç®—æœºèµ„æºæ˜¯ä»€ä¹ˆï¼Œæ›´é‡è¦çš„æ˜¯è¯´æ˜äº†å¦‚ä½•æ‰¾åˆ°å¹¶è·å–è¿™ä¸ªèµ„æºï¼Œä¸€ä¸ªå…¸å‹çš„URLç»“æ„æ˜¯ï¼šscheme://host[:port]/path?query#fragment\n\nschemeï¼šæŒ‡å®šè®¿é—®èµ„æºæ—¶ä½¿ç”¨çš„åè®®ç±»å‹ï¼Œå¦‚HTTPã€HTTPSã€FTPç­‰\nhostï¼šèµ„æºæ‰€åœ¨çš„ä¸»æœºåæˆ–IPåœ°å€:\n\nå¯ä»¥æ˜¯ä¸€ä¸ªåŸŸå,ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªipåœ°å€.æ€»ä¹‹èƒŒåå¯¹åº”ä¸€å°è¿è¡Œç€webæœåŠ¡å™¨çš„æœºå™¨.\n\n\nportï¼šå¯é€‰å­—æ®µï¼ŒæŒ‡å®šä¸»æœºä¸Šçš„ç«¯å£å·ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œä¸åŒçš„åè®®ä¼šä½¿ç”¨ä¸åŒçš„ç«¯å£ï¼Œä¾‹å¦‚HTTPé»˜è®¤ä½¿ç”¨80ç«¯å£ï¼ŒHTTPSä½¿ç”¨443ç«¯å£\npathï¼šèµ„æºåœ¨æœåŠ¡å™¨ä¸Šçš„å…·ä½“ä½ç½®ï¼Œå¦‚path/to/file\nqueryï¼šå¯é€‰å­—æ®µï¼Œç”¨äºä¼ é€’ç»™æœåŠ¡å™¨çš„æŸ¥è¯¢å‚æ•°ï¼Œé€šå¸¸ä»¥é”®å€¼å¯¹çš„å½¢å¼å‡ºç°ï¼Œå¦‚key1=value1&amp;key2=value2\nfragmentï¼šå¯é€‰å­—æ®µï¼Œç”¨äºæŒ‡ç¤ºé¡µé¢å†…éƒ¨çš„ä¸€ä¸ªç‰¹å®šéƒ¨åˆ†æˆ–å…ƒç´ ï¼Œé€šå¸¸ç”¨äºé¡µé¢å†…çš„å¯¼èˆªï¼Œæ¯”å¦‚é€šè¿‡zjucomp.net/docs/Lab8_page#51-uriè§£æä¸æ˜ å°„Â è®¿é—®æœ¬æ–‡æ¡£æ—¶ï¼Œå¯ä»¥ç›´æ¥è·³è½¬åˆ°ç¬¬5éƒ¨åˆ†\n\nURLåˆå¯ä»¥åˆ†ä¸ºç»å¯¹URLå’Œç›¸å¯¹URLï¼Œè¿™å’Œç»å¯¹è·¯å¾„/ç›¸å¯¹è·¯å¾„çš„å·®åˆ«éå¸¸ç›¸ä¼¼ï¼Œç»å¯¹URLæŒ‡å‘ç‰¹å®šä¸»æœºä¸Šä¸€ä¸ªç‰¹å®šçš„èµ„æºï¼Œè€Œç›¸å¯¹URLå¯¹äºä¸åŒçš„ä¸»æœºå¯èƒ½å¯¹åº”ä¸åŒçš„èµ„æºï¼Œæˆ‘ä»¬åœ¨è§£æè¯·æ±‚è¡Œä¸­çš„URIæ—¶ï¼Œå®é™…ä¸Šå¾—åˆ°çš„æ˜¯ä¸€ä¸ªç›¸å¯¹URL\nç»Ÿä¸€èµ„æºåç§°URNï¼ˆUniform Resource Nameï¼‰\nURNæ›´å…³æ³¨äºèµ„æºçš„èº«ä»½æ ‡è¯†è€Œéç‰©ç†ä½ç½®ï¼Œæ—¨åœ¨æä¾›ä¸€ç§æŒä¹…ä¸å˜çš„åå­—ç©ºé—´ï¼Œå³ä½¿èµ„æºçš„å®é™…ä½ç½®å‘ç”Ÿå˜åŒ–ï¼Œå…¶URNä»ç„¶ä¿æŒä¸å˜ï¼Œå®ƒçš„æ ¼å¼é€šå¸¸ä¸ºï¼š&lt;nns&gt;:&lt;specifics&gt;\n\nnnsï¼šå‘½åç©ºé—´æ ‡è¯†ç¬¦ï¼Œç”¨äºå®šä¹‰URNæ‰€å±çš„å‘½åç©ºé—´\nspecificsï¼šå‘½åç©ºé—´å†…çš„å…·ä½“æ ‡è¯†ç¬¦ï¼Œç”¨äºå”¯ä¸€ç¡®å®šèµ„æº\n\nä½ å¯èƒ½ä¼šé—®ï¼Œæ—¢ç„¶å¾—åˆ°çš„ç›¸å¯¹URLå’Œç›¸å¯¹è·¯å¾„è¿™ä¹ˆç›¸ä¼¼ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä¸å¯ä»¥ç›´æ¥æŠŠèµ„æºå’ŒæœåŠ¡ç«¯ç¨‹åºçš„ç›¸å¯¹è·¯å¾„å½“ä½œç›¸å¯¹URLç”¨æ¥è¯·æ±‚å¯¹åº”çš„èµ„æºå‘¢ï¼Ÿç­”æ¡ˆæ˜¯â€œå¯ä»¥ï¼Œä½†æœ€å¥½ä¸è¦â€\nå°½ç®¡è¿™æ ·çš„å‘½åæ–¹å¼éå¸¸ç®€å•ç›´æ¥ï¼Œå¯ä»¥æå¤§é™ä½æä¾›èµ„æºè®¿é—®çš„éš¾åº¦ï¼Œä½†è¿™åŒæ—¶ä¹Ÿå¸¦æ¥äº†å®‰å…¨é£é™©ï¼Œé€šè¿‡å¯¹æœåŠ¡å™¨çš„çˆ†ç ´æ‰«æï¼Œè„šæœ¬å°å­ä»¬å¯ä»¥æ‘¸ç´¢å‡ºæœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶ç»“æ„ï¼Œä»è€Œé’ˆå¯¹æ€§åœ°é€‰æ‹©æ½œåœ¨æ¼æ´è¿›è¡Œæ¸—é€ï¼Œå¸¦æ¥è¾ƒå¤§çš„å®‰å…¨é£é™©ï¼Œå› æ­¤ï¼Œä¸ºäº†ä¿æŠ¤æœåŠ¡å™¨çš„å®‰å…¨ï¼Œé¿å…æ³„éœ²ä¸å¿…è¦çš„ä¿¡æ¯ï¼Œé€šå¸¸ä¸å»ºè®®ç›´æ¥å°†æœåŠ¡ç«¯ç¨‹åºçš„ç›¸å¯¹è·¯å¾„ä½œä¸ºç›¸å¯¹URLæ¥ä½¿ç”¨\næ ¹æ®ä½ ç¼–å†™çš„ç¨‹åºè¿è¡Œæ•ˆæœï¼Œåˆ†åˆ«è§£ç­”ä»¥ä¸‹é—®é¢˜ï¼š\n\n\nHTTP åè®®æ˜¯æ€æ ·å¯¹å¤´éƒ¨å’Œä½“éƒ¨è¿›è¡Œåˆ†éš”çš„ï¼Ÿ\n\n\nÂ  Â HTTP åè®®ä½¿ç”¨è¿ç»­çš„ä¸¤ä¸ªå›è½¦æ¢è¡Œç¬¦(\\r\\n\\r\\n)ä½œä¸ºå¤´éƒ¨ï¼ˆHeaderï¼‰å’Œä½“éƒ¨ï¼ˆBodyï¼‰çš„åˆ†éš”æ ‡å¿—ã€‚\n\n\næµè§ˆå™¨æ˜¯æ ¹æ®æ–‡ä»¶çš„æ‰©å±•åè¿˜æ˜¯æ ¹æ®å¤´éƒ¨çš„å“ªä¸ªå­—æ®µåˆ¤æ–­æ–‡ä»¶ç±»å‹çš„ï¼Ÿ\n\n\nÂ  Â æµè§ˆå™¨ä¸»è¦æ ¹æ® HTTP å“åº”å¤´éƒ¨ä¸­çš„ Content-Type å­—æ®µæ¥åˆ¤æ–­æ–‡ä»¶ç±»å‹ï¼ŒæœåŠ¡å™¨ä¼šç»´æŠ¤ä¸€ä¸ª MIME_TYPES æ˜ å°„è¡¨, å°†æ–‡ä»¶æ‰©å±•åï¼ˆå¦‚ .html, .jpgï¼‰æ˜ å°„ä¸ºæ ‡å‡†çš„ MIME ç±»å‹\n\n\nHTTP åè®®çš„å¤´éƒ¨æ˜¯ä¸æ˜¯ä¸€å®šæ˜¯æ–‡æœ¬æ ¼å¼ï¼Ÿä½“éƒ¨å‘¢ï¼Ÿ\n\n\nÂ  HTTP åè®®çš„å¤´éƒ¨ï¼ˆHeaderï¼‰ä¸€å®šæ˜¯æ–‡æœ¬æ ¼å¼ï¼ˆASCII ç¼–ç ï¼‰ã€‚ä½“éƒ¨ï¼ˆBodyï¼‰åˆ™ä¸ä¸€å®šæ˜¯æ–‡æœ¬æ ¼å¼ï¼Œå®ƒå¯ä»¥æ˜¯æ–‡æœ¬ï¼ˆå¦‚ HTML, JSONï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯äºŒè¿›åˆ¶æ•°æ®ï¼ˆå¦‚å›¾ç‰‡, è§†é¢‘ï¼‰ã€‚\n\n\nPOST æ–¹æ³•ä¼ é€’çš„æ•°æ®æ˜¯æ”¾åœ¨å¤´éƒ¨è¿˜æ˜¯ä½“éƒ¨ï¼Ÿä¸¤ä¸ªå­—æ®µæ˜¯ç”¨ä»€ä¹ˆç¬¦å·è¿æ¥èµ·æ¥çš„ï¼Ÿ\n\n\nÂ  POST æ–¹æ³•ä¼ é€’çš„æ•°æ®é€šå¸¸æ”¾åœ¨ HTTP è¯·æ±‚çš„ä½“éƒ¨ï¼ˆBodyï¼‰ä¸­ã€‚å¤šä¸ªå­—æ®µä¹‹é—´ä½¿ç”¨ &amp; ç¬¦å·è¿æ¥ã€‚\nåœ¨ Windows ä½¿ç”¨ Wireshark æ— æ³•ç›‘å¬åˆ° WSL å†…éƒ¨çš„æœ¬åœ°å›ç¯æµé‡,æ‰€ä»¥å­¦ä¹ ä½¿ç”¨äº† Linux åŸç”Ÿçš„ tcpdump å·¥å…·ï¼Œé€šè¿‡å‘½ä»¤å°†æµé‡ä¿å­˜ä¸ºæŠ“åŒ…æ–‡ä»¶ï¼Œå†å¯¼å…¥ Windows çš„ Wireshark è¿›è¡Œåˆ†æã€‚\n2. å¿ƒå¾—ä½“ä¼šï¼š\n\n\næ·±å…¥ç†è§£ HTTP åè®®ï¼š é€šè¿‡äº²æ‰‹å®ç°è§£æå™¨ï¼Œå¯¹ HTTP åè®®çš„æ— çŠ¶æ€æ€§ã€è¯·æ±‚/å“åº”æ ¼å¼ã€çŠ¶æ€ç çš„å«ä¹‰æœ‰äº†æ›´æ·±åˆ»çš„ç†è§£ï¼Œç‰¹åˆ«æ˜¯ Content-Type å’Œ Content-Length è¿™ä¸¤ä¸ªå¤´éƒ¨å­—æ®µçš„é‡è¦æ€§ã€‚\n\n\nSocket ç¼–ç¨‹å®è·µï¼š å·©å›ºäº†å¯¹ socket, bind, listen, accept ç­‰ API çš„ç†è§£ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨å¤šçº¿ç¨‹ï¼ˆstd::threadï¼‰æ¥å¤„ç†å¹¶å‘è¿æ¥ã€‚\n\n\nä»£ç å¥å£®æ€§ï¼š è®¤è¯†åˆ°ç½‘ç»œç¼–ç¨‹ä¸­é˜²å¾¡æ€§ç¼–ç¨‹çš„é‡è¦æ€§ï¼Œä¾‹å¦‚å¤„ç†æ¶æ„é•¿è¯·æ±‚ã€éæ³•è·¯å¾„è®¿é—®ç­‰æƒ…å†µã€‚\n\n"},"è¯¾ç¨‹ç¬”è®°/è®¡ç®—æœºç½‘ç»œ/TCPä¸“é¡¹":{"slug":"è¯¾ç¨‹ç¬”è®°/è®¡ç®—æœºç½‘ç»œ/TCPä¸“é¡¹","filePath":"è¯¾ç¨‹ç¬”è®°/è®¡ç®—æœºç½‘ç»œ/TCPä¸“é¡¹.md","title":"TCPä¸“é¡¹","links":[],"tags":[],"content":"åŸºæœ¬è®¤è¯†\nTCPæŠ¥æ–‡æ ¼å¼\n\n\nåºåˆ—å·: åœ¨å»ºç«‹è¿æ¥æ—¶,ç”±è®¡ç®—æœºç”Ÿæˆçš„éšæœºæ•°ä½œä¸ºåˆå§‹å€¼,é€šè¿‡SYNåŒ…ä¼ ç»™æ¥æ”¶ç«¯ä¸»æœº,æ¯å‘é€ä¸€æ¬¡æ•°æ®å°±å¯¹è¯¥å­—èŠ‚æ•°+1,ç”¨æ¥è§£å†³ç½‘ç»œåŒ…ä¹±åºé—®é¢˜\nç¡®è®¤åº”ç­”å·ï¼šæŒ‡ä¸‹ä¸€æ¬¡ã€ŒæœŸæœ›ã€æ”¶åˆ°çš„æ•°æ®çš„åºåˆ—å·ï¼Œå‘é€ç«¯æ”¶åˆ°è¿™ä¸ªç¡®è®¤åº”ç­”ä»¥åå¯ä»¥è®¤ä¸ºåœ¨è¿™ä¸ªåºå·ä»¥å‰çš„æ•°æ®éƒ½å·²ç»è¢«æ­£å¸¸æ¥æ”¶ã€‚ç”¨æ¥è§£å†³ä¸¢åŒ…çš„é—®é¢˜ã€‚\næ§åˆ¶ä½ï¼š æ ‡å¿—ä¿¡æ¯\n\nACKï¼šè¯¥ä½ä¸ºÂ 1Â æ—¶ï¼Œã€Œ ç¡®è®¤åº”ç­”å·ã€çš„å­—æ®µå˜ä¸ºæœ‰æ•ˆï¼ŒTCP è§„å®šé™¤äº†æœ€åˆå»ºç«‹è¿æ¥æ—¶çš„Â SYNÂ åŒ…ä¹‹å¤–è¯¥ä½å¿…é¡»è®¾ç½®ä¸ºÂ 1Â ã€‚\nRSTï¼šè¯¥ä½ä¸ºÂ 1Â æ—¶ï¼Œè¡¨ç¤º TCP è¿æ¥ä¸­å‡ºç°å¼‚å¸¸å¿…é¡»å¼ºåˆ¶æ–­å¼€è¿æ¥ã€‚\nSYNï¼šè¯¥ä½ä¸ºÂ 1Â æ—¶ï¼Œè¡¨ç¤ºå¸Œæœ›å»ºç«‹è¿æ¥ï¼Œå¹¶åœ¨å…¶ã€Œåºåˆ—å·ã€çš„å­—æ®µè¿›è¡Œåºåˆ—å·åˆå§‹å€¼çš„è®¾å®šã€‚\nFINï¼šè¯¥ä½ä¸ºÂ 1Â æ—¶ï¼Œè¡¨ç¤ºä»Šåä¸ä¼šå†æœ‰æ•°æ®å‘é€ï¼Œå¸Œæœ›æ–­å¼€è¿æ¥ã€‚å½“é€šä¿¡ç»“æŸå¸Œæœ›æ–­å¼€è¿æ¥æ—¶ï¼Œé€šä¿¡åŒæ–¹çš„ä¸»æœºä¹‹é—´å°±å¯ä»¥ç›¸äº’äº¤æ¢Â FINÂ ä½ä¸º 1 çš„ TCP æ®µã€‚\n\n\n\nä¸ºä»€ä¹ˆéœ€è¦ TCP åè®®ï¼Ÿ TCP å·¥ä½œåœ¨å“ªä¸€å±‚ï¼Ÿ\nIPÂ å±‚æ˜¯ã€Œä¸å¯é ã€çš„ï¼Œå®ƒä¸ä¿è¯ç½‘ç»œåŒ…çš„äº¤ä»˜ã€ä¸ä¿è¯ç½‘ç»œåŒ…çš„æŒ‰åºäº¤ä»˜ã€ä¹Ÿä¸ä¿è¯ç½‘ç»œåŒ…ä¸­çš„æ•°æ®çš„å®Œæ•´æ€§ã€‚\nå¦‚æœéœ€è¦ä¿éšœç½‘ç»œæ•°æ®åŒ…çš„å¯é æ€§ï¼Œé‚£ä¹ˆå°±éœ€è¦ç”±ä¸Šå±‚ï¼ˆä¼ è¾“å±‚ï¼‰çš„Â TCPÂ åè®®æ¥è´Ÿè´£ã€‚\nå› ä¸º TCP æ˜¯ä¸€ä¸ªå·¥ä½œåœ¨ä¼ è¾“å±‚çš„å¯é æ•°æ®ä¼ è¾“çš„æœåŠ¡ï¼Œå®ƒèƒ½ç¡®ä¿æ¥æ”¶ç«¯æ¥æ”¶çš„ç½‘ç»œåŒ…æ˜¯æ— æŸåã€æ— é—´éš”ã€éå†—ä½™å’ŒæŒ‰åºçš„ã€‚\nä»€ä¹ˆæ˜¯TCP\nTCP æ˜¯é¢å‘è¿æ¥çš„ã€å¯é çš„ã€åŸºäºå­—èŠ‚æµçš„ä¼ è¾“å±‚é€šä¿¡åè®®ã€‚\n\né¢å‘è¿æ¥ï¼šä¸€å®šæ˜¯ã€Œä¸€å¯¹ä¸€ã€æ‰èƒ½è¿æ¥ï¼Œä¸èƒ½åƒ UDP åè®®å¯ä»¥ä¸€ä¸ªä¸»æœºåŒæ—¶å‘å¤šä¸ªä¸»æœºå‘é€æ¶ˆæ¯ï¼Œä¹Ÿå°±æ˜¯ä¸€å¯¹å¤šæ˜¯æ— æ³•åšåˆ°çš„ï¼›\nå¯é çš„ï¼šæ— è®ºçš„ç½‘ç»œé“¾è·¯ä¸­å‡ºç°äº†æ€æ ·çš„é“¾è·¯å˜åŒ–ï¼ŒTCP éƒ½å¯ä»¥ä¿è¯ä¸€ä¸ªæŠ¥æ–‡ä¸€å®šèƒ½å¤Ÿåˆ°è¾¾æ¥æ”¶ç«¯ï¼›\nå­—èŠ‚æµï¼šç”¨æˆ·æ¶ˆæ¯é€šè¿‡ TCP åè®®ä¼ è¾“æ—¶ï¼Œæ¶ˆæ¯å¯èƒ½ä¼šè¢«æ“ä½œç³»ç»Ÿã€Œåˆ†ç»„ã€æˆå¤šä¸ªçš„ TCP æŠ¥æ–‡ï¼Œå¦‚æœæ¥æ”¶æ–¹çš„ç¨‹åºå¦‚æœä¸çŸ¥é“ã€Œæ¶ˆæ¯çš„è¾¹ç•Œã€ï¼Œæ˜¯æ— æ³•è¯»å‡ºä¸€ä¸ªæœ‰æ•ˆçš„ç”¨æˆ·æ¶ˆæ¯çš„ã€‚å¹¶ä¸” TCP æŠ¥æ–‡æ˜¯ã€Œæœ‰åºçš„ã€ï¼Œå½“ã€Œå‰ä¸€ä¸ªã€TCP æŠ¥æ–‡æ²¡æœ‰æ”¶åˆ°çš„æ—¶å€™ï¼Œå³ä½¿å®ƒå…ˆæ”¶åˆ°äº†åé¢çš„ TCP æŠ¥æ–‡ï¼Œé‚£ä¹ˆä¹Ÿä¸èƒ½æ‰”ç»™åº”ç”¨å±‚å»å¤„ç†ï¼ŒåŒæ—¶å¯¹ã€Œé‡å¤ã€çš„ TCP æŠ¥æ–‡ä¼šè‡ªåŠ¨ä¸¢å¼ƒ\n\nä»€ä¹ˆæ˜¯TCPè¿æ¥\nç”¨äºä¿è¯å¯é æ€§å’Œæµé‡æ§åˆ¶ç»´æŠ¤çš„æŸäº›çŠ¶æ€ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯çš„ç»„åˆï¼ŒåŒ…æ‹¬ Socketã€åºåˆ—å·å’Œçª—å£å¤§å°ç§°ä¸ºè¿æ¥ã€‚\n\næ‰€ä»¥æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œå»ºç«‹ä¸€ä¸ª TCP è¿æ¥æ˜¯éœ€è¦å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯è¾¾æˆä¸Šè¿°ä¸‰ä¸ªä¿¡æ¯çš„å…±è¯†ã€‚\n\nSocketï¼šç”± IP åœ°å€å’Œç«¯å£å·ç»„æˆ\nåºåˆ—å·ï¼šç”¨æ¥è§£å†³ä¹±åºé—®é¢˜ç­‰\nçª—å£å¤§å°ï¼šç”¨æ¥åšæµé‡æ§åˆ¶\n\nå¦‚ä½•å”¯ä¸€ç¡®å®šä¸€ä¸ªTCPè¿æ¥\nTCP å››å…ƒç»„å¯ä»¥å”¯ä¸€çš„ç¡®å®šä¸€ä¸ªè¿æ¥ï¼Œå››å…ƒç»„åŒ…æ‹¬å¦‚ä¸‹ï¼š\n\næºåœ°å€\næºç«¯å£\nç›®çš„åœ°å€\nç›®çš„ç«¯å£\næºåœ°å€å’Œç›®çš„åœ°å€çš„å­—æ®µï¼ˆ32 ä½ï¼‰æ˜¯åœ¨ IP å¤´éƒ¨ä¸­ï¼Œä½œç”¨æ˜¯é€šè¿‡ IP åè®®å‘é€æŠ¥æ–‡ç»™å¯¹æ–¹ä¸»æœºã€‚\næºç«¯å£å’Œç›®çš„ç«¯å£çš„å­—æ®µï¼ˆ16 ä½ï¼‰æ˜¯åœ¨ TCP å¤´éƒ¨ä¸­ï¼Œä½œç”¨æ˜¯å‘Šè¯‰ TCP åè®®åº”è¯¥æŠŠæŠ¥æ–‡å‘ç»™å“ªä¸ªè¿›ç¨‹ã€‚\n\næœåŠ¡ç«¯é€šå¸¸å›ºå®šåœ¨æŸä¸ªæœ¬åœ°ç«¯å£ä¸Šç›‘å¬ï¼Œç­‰å¾…å®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ã€‚\nå®¢æˆ·ç«¯ IP å’Œç«¯å£æ˜¯å¯å˜çš„ï¼Œå…¶ç†è®ºå€¼è®¡ç®—å…¬å¼å¦‚ä¸‹:æœ€å¤§TCPè¿æ¥æ•°=å®¢æˆ·ç«¯ipæ•°*å®¢æˆ·ç«¯ç«¯å£æ•°\nå¯¹IPv4,IPæ•°æœ€å¤šä¸º2çš„32æ¬¡æ–¹,ç«¯å£æ•°æœ€å¤šä¸º2çš„16æ¬¡æ–¹.æ‰€ä»¥æ€»å…±æ˜¯2çš„48æ¬¡æ–¹\nä½†æ˜¯æœåŠ¡ç«¯æœ€å¤§å¹¶å‘TCPè¿æ¥æ•°å®é™…ä¸Šæ˜¯å­˜åœ¨ä¸Šé™çš„,å¹¶ä¸èƒ½è¾¾åˆ°ç†è®ºæœ€å¤§å€¼.\n\næ–‡ä»¶æè¿°ç¬¦é™åˆ¶ï¼Œæ¯ä¸ª TCP è¿æ¥éƒ½æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œå¦‚æœæ–‡ä»¶æè¿°ç¬¦è¢«å æ»¡äº†ï¼Œä¼šå‘ç”Ÿ Too many open filesã€‚Linux å¯¹å¯æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦çš„æ•°é‡åˆ†åˆ«ä½œäº†ä¸‰ä¸ªæ–¹é¢çš„é™åˆ¶ï¼š\n\nç³»ç»Ÿçº§ï¼šå½“å‰ç³»ç»Ÿå¯æ‰“å¼€çš„æœ€å¤§æ•°é‡ï¼Œé€šè¿‡Â cat /proc/sys/fs/file-maxÂ æŸ¥çœ‹ï¼›\nç”¨æˆ·çº§ï¼šæŒ‡å®šç”¨æˆ·å¯æ‰“å¼€çš„æœ€å¤§æ•°é‡ï¼Œé€šè¿‡Â cat /etc/security/limits.confÂ æŸ¥çœ‹ï¼›\nè¿›ç¨‹çº§ï¼šå•ä¸ªè¿›ç¨‹å¯æ‰“å¼€çš„æœ€å¤§æ•°é‡ï¼Œé€šè¿‡Â cat /proc/sys/fs/nr_openÂ æŸ¥çœ‹ï¼›\n\n\nå†…å­˜é™åˆ¶ï¼Œæ¯ä¸ª TCP è¿æ¥éƒ½è¦å ç”¨ä¸€å®šå†…å­˜ï¼Œæ“ä½œç³»ç»Ÿçš„å†…å­˜æ˜¯æœ‰é™çš„ï¼Œå¦‚æœå†…å­˜èµ„æºè¢«å æ»¡åï¼Œä¼šå‘ç”Ÿ OOMã€‚\n\nUDPå’ŒTCPçš„åŒºåˆ«\nUDP ä¸æä¾›å¤æ‚çš„æ§åˆ¶æœºåˆ¶ï¼Œåˆ©ç”¨ IP æä¾›é¢å‘ã€Œæ— è¿æ¥ã€çš„é€šä¿¡æœåŠ¡ã€‚\nUDP åè®®çœŸçš„éå¸¸ç®€ï¼Œå¤´éƒ¨åªæœ‰Â 8Â ä¸ªå­—èŠ‚ï¼ˆ64 ä½ï¼‰ï¼ŒUDP çš„å¤´éƒ¨æ ¼å¼å¦‚ä¸‹\n\nç›®æ ‡å’Œæºç«¯å£ï¼šä¸»è¦æ˜¯å‘Šè¯‰ UDP åè®®åº”è¯¥æŠŠæŠ¥æ–‡å‘ç»™å“ªä¸ªè¿›ç¨‹ã€‚\nåŒ…é•¿åº¦ï¼šè¯¥å­—æ®µä¿å­˜äº† UDP é¦–éƒ¨çš„é•¿åº¦è·Ÿæ•°æ®çš„é•¿åº¦ä¹‹å’Œã€‚\næ ¡éªŒå’Œï¼šæ ¡éªŒå’Œæ˜¯ä¸ºäº†æä¾›å¯é çš„ UDP é¦–éƒ¨å’Œæ•°æ®è€Œè®¾è®¡ï¼Œé˜²æ­¢æ”¶åˆ°åœ¨ç½‘ç»œä¼ è¾“ä¸­å—æŸçš„ UDP åŒ…ã€‚\n\nTCP å’Œ UDP åŒºåˆ«ï¼š\n1. è¿æ¥\n\nTCP æ˜¯é¢å‘è¿æ¥çš„ä¼ è¾“å±‚åè®®ï¼Œä¼ è¾“æ•°æ®å‰å…ˆè¦å»ºç«‹è¿æ¥ã€‚\nUDP æ˜¯ä¸éœ€è¦è¿æ¥ï¼Œå³åˆ»ä¼ è¾“æ•°æ®ã€‚\n2. æœåŠ¡å¯¹è±¡\nTCP æ˜¯ä¸€å¯¹ä¸€çš„ä¸¤ç‚¹æœåŠ¡ï¼Œå³ä¸€æ¡è¿æ¥åªæœ‰ä¸¤ä¸ªç«¯ç‚¹ã€‚\nUDP æ”¯æŒä¸€å¯¹ä¸€ã€ä¸€å¯¹å¤šã€å¤šå¯¹å¤šçš„äº¤äº’é€šä¿¡\n3. å¯é æ€§\nTCP æ˜¯å¯é äº¤ä»˜æ•°æ®çš„ï¼Œæ•°æ®å¯ä»¥æ— å·®é”™ã€ä¸ä¸¢å¤±ã€ä¸é‡å¤ã€æŒ‰åºåˆ°è¾¾ã€‚\nUDP æ˜¯å°½æœ€å¤§åŠªåŠ›äº¤ä»˜ï¼Œä¸ä¿è¯å¯é äº¤ä»˜æ•°æ®ã€‚ä½†æ˜¯æˆ‘ä»¬å¯ä»¥åŸºäº UDP ä¼ è¾“åè®®å®ç°ä¸€ä¸ªå¯é çš„ä¼ è¾“åè®®ï¼Œæ¯”å¦‚ QUIC åè®®\n4. æ‹¥å¡æ§åˆ¶ã€æµé‡æ§åˆ¶\nTCP æœ‰æ‹¥å¡æ§åˆ¶å’Œæµé‡æ§åˆ¶æœºåˆ¶ï¼Œä¿è¯æ•°æ®ä¼ è¾“çš„å®‰å…¨æ€§ã€‚\nUDP åˆ™æ²¡æœ‰ï¼Œå³ä½¿ç½‘ç»œéå¸¸æ‹¥å µäº†ï¼Œä¹Ÿä¸ä¼šå½±å“ UDP çš„å‘é€é€Ÿç‡ã€‚\n5. é¦–éƒ¨å¼€é”€\nTCP é¦–éƒ¨é•¿åº¦è¾ƒé•¿ï¼Œä¼šæœ‰ä¸€å®šçš„å¼€é”€ï¼Œé¦–éƒ¨åœ¨æ²¡æœ‰ä½¿ç”¨ã€Œé€‰é¡¹ã€å­—æ®µæ—¶æ˜¯Â 20Â ä¸ªå­—èŠ‚ï¼Œå¦‚æœä½¿ç”¨äº†ã€Œé€‰é¡¹ã€å­—æ®µåˆ™ä¼šå˜é•¿çš„ã€‚\nUDP é¦–éƒ¨åªæœ‰ 8 ä¸ªå­—èŠ‚ï¼Œå¹¶ä¸”æ˜¯å›ºå®šä¸å˜çš„ï¼Œå¼€é”€è¾ƒå°ã€‚\n6. ä¼ è¾“æ–¹å¼\nTCP æ˜¯æµå¼ä¼ è¾“ï¼Œæ²¡æœ‰è¾¹ç•Œï¼Œä½†ä¿è¯é¡ºåºå’Œå¯é ã€‚[åœ¨é€»è¾‘ä¸Š,å¯èƒ½å‘ç”Ÿç²˜åŒ…æˆ–æ‹†åŒ…,å‘é€æ¬¡æ•°ä¸æ¥æ”¶æ¬¡æ•°æ— å…³,ç¨‹åºå‘˜å¿…é¡»è‡ªå·±è§„å®šæ¶ˆæ¯ç»“æŸç¬¦æ¥åŒºåˆ†æ¶ˆæ¯]\nUDP æ˜¯ä¸€ä¸ªåŒ…ä¸€ä¸ªåŒ…çš„å‘é€ï¼Œæ˜¯æœ‰è¾¹ç•Œçš„ï¼Œä½†å¯èƒ½ä¼šä¸¢åŒ…å’Œä¹±åºã€‚\n\n7. åˆ†ç‰‡ä¸åŒ\n\nTCP çš„æ•°æ®å¤§å°å¦‚æœå¤§äº MSS å¤§å°ï¼Œåˆ™ä¼šåœ¨ä¼ è¾“å±‚è¿›è¡Œåˆ†ç‰‡ï¼Œç›®æ ‡ä¸»æœºæ”¶åˆ°åï¼Œä¹ŸåŒæ ·åœ¨ä¼ è¾“å±‚ç»„è£… TCP æ•°æ®åŒ…ï¼Œå¦‚æœä¸­é€”ä¸¢å¤±äº†ä¸€ä¸ªåˆ†ç‰‡ï¼Œåªéœ€è¦ä¼ è¾“ä¸¢å¤±çš„è¿™ä¸ªåˆ†ç‰‡ã€‚\nUDP çš„æ•°æ®å¤§å°å¦‚æœå¤§äº MTU å¤§å°ï¼Œåˆ™ä¼šåœ¨ IP å±‚è¿›è¡Œåˆ†ç‰‡ï¼Œç›®æ ‡ä¸»æœºæ”¶åˆ°åï¼Œåœ¨ IP å±‚ç»„è£…å®Œæ•°æ®ï¼Œæ¥ç€å†ä¼ ç»™ä¼ è¾“å±‚ã€‚\n\nTCP å’Œ UDP åº”ç”¨åœºæ™¯ï¼š\nç”±äº TCP æ˜¯é¢å‘è¿æ¥ï¼Œèƒ½ä¿è¯æ•°æ®çš„å¯é æ€§äº¤ä»˜ï¼Œå› æ­¤ç»å¸¸ç”¨äºï¼š\n\nFTPÂ æ–‡ä»¶ä¼ è¾“ï¼›\nHTTP / HTTPSï¼›\n\nç”±äº UDP é¢å‘æ— è¿æ¥ï¼Œå®ƒå¯ä»¥éšæ—¶å‘é€æ•°æ®ï¼Œå†åŠ ä¸Š UDP æœ¬èº«çš„å¤„ç†æ—¢ç®€å•åˆé«˜æ•ˆï¼Œå› æ­¤ç»å¸¸ç”¨äºï¼š\n\nåŒ…æ€»é‡è¾ƒå°‘çš„é€šä¿¡ï¼Œå¦‚Â DNSÂ ã€SNMPÂ ç­‰ï¼›\nè§†é¢‘ã€éŸ³é¢‘ç­‰å¤šåª’ä½“é€šä¿¡ï¼›\nå¹¿æ’­é€šä¿¡ï¼›\n\n\nä¸ºä»€ä¹ˆ UDP å¤´éƒ¨æ²¡æœ‰ã€Œé¦–éƒ¨é•¿åº¦ã€å­—æ®µï¼Œè€Œ TCP å¤´éƒ¨æœ‰ã€Œé¦–éƒ¨é•¿åº¦ã€å­—æ®µå‘¢ï¼Ÿ\nåŸå› æ˜¯ TCP æœ‰å¯å˜é•¿çš„ã€Œé€‰é¡¹ã€å­—æ®µï¼Œè€Œ UDP å¤´éƒ¨é•¿åº¦åˆ™æ˜¯ä¸ä¼šå˜åŒ–çš„ï¼Œæ— éœ€å¤šä¸€ä¸ªå­—æ®µå»è®°å½• UDP çš„é¦–éƒ¨é•¿åº¦ã€‚\n\n\nä¸ºä»€ä¹ˆ UDP å¤´éƒ¨æœ‰ã€ŒåŒ…é•¿åº¦ã€å­—æ®µï¼Œè€Œ TCP å¤´éƒ¨åˆ™æ²¡æœ‰ã€ŒåŒ…é•¿åº¦ã€å­—æ®µå‘¢ï¼Ÿ\n\nå…ˆè¯´è¯´ TCP æ˜¯å¦‚ä½•è®¡ç®—è´Ÿè½½æ•°æ®é•¿åº¦ï¼š\n\nå…¶ä¸­ IP æ€»é•¿åº¦ å’Œ IP é¦–éƒ¨é•¿åº¦ï¼Œåœ¨ IP é¦–éƒ¨æ ¼å¼æ˜¯å·²çŸ¥çš„ã€‚TCP é¦–éƒ¨é•¿åº¦ï¼Œåˆ™æ˜¯åœ¨ TCP é¦–éƒ¨æ ¼å¼å·²çŸ¥çš„ï¼Œæ‰€ä»¥å°±å¯ä»¥æ±‚å¾— TCP æ•°æ®çš„é•¿åº¦ã€‚\nå¤§å®¶è¿™æ—¶å°±å¥‡æ€ªäº†é—®ï¼šâ€œUDP ä¹Ÿæ˜¯åŸºäº IP å±‚çš„å‘€ï¼Œé‚£ UDP çš„æ•°æ®é•¿åº¦ä¹Ÿå¯ä»¥é€šè¿‡è¿™ä¸ªå…¬å¼è®¡ç®—å‘€ï¼Ÿ ä¸ºä½•è¿˜è¦æœ‰ã€ŒåŒ…é•¿åº¦ã€å‘¢ï¼Ÿâ€\nè¿™ä¹ˆä¸€é—®ï¼Œç¡®å®æ„Ÿè§‰ UDP çš„ã€ŒåŒ…é•¿åº¦ã€æ˜¯å†—ä½™çš„ã€‚\næˆ‘æŸ¥é˜…äº†å¾ˆå¤šèµ„æ–™ï¼Œæˆ‘è§‰å¾—æœ‰ä¸¤ä¸ªæ¯”è¾ƒé è°±çš„è¯´æ³•ï¼š\n\nç¬¬ä¸€ç§è¯´æ³•ï¼šå› ä¸ºä¸ºäº†ç½‘ç»œè®¾å¤‡ç¡¬ä»¶è®¾è®¡å’Œå¤„ç†æ–¹ä¾¿ï¼Œé¦–éƒ¨é•¿åº¦éœ€è¦æ˜¯Â 4Â å­—èŠ‚çš„æ•´æ•°å€ã€‚å¦‚æœå»æ‰ UDP çš„ã€ŒåŒ…é•¿åº¦ã€å­—æ®µï¼Œé‚£ UDP é¦–éƒ¨é•¿åº¦å°±ä¸æ˜¯Â 4Â å­—èŠ‚çš„æ•´æ•°å€äº†ï¼Œæ‰€ä»¥æˆ‘è§‰å¾—è¿™å¯èƒ½æ˜¯ä¸ºäº†è¡¥å…¨ UDP é¦–éƒ¨é•¿åº¦æ˜¯Â 4Â å­—èŠ‚çš„æ•´æ•°å€ï¼Œæ‰è¡¥å……äº†ã€ŒåŒ…é•¿åº¦ã€å­—æ®µã€‚\nç¬¬äºŒç§è¯´æ³•ï¼šå¦‚ä»Šçš„ UDP åè®®æ˜¯åŸºäº IP åè®®å‘å±•çš„ï¼Œè€Œå½“å¹´å¯èƒ½å¹¶éå¦‚æ­¤ï¼Œä¾èµ–çš„å¯èƒ½æ˜¯åˆ«çš„ä¸æä¾›è‡ªèº«æŠ¥æ–‡é•¿åº¦æˆ–é¦–éƒ¨é•¿åº¦çš„ç½‘ç»œå±‚åè®®ï¼Œå› æ­¤ UDP æŠ¥æ–‡é¦–éƒ¨éœ€è¦æœ‰é•¿åº¦å­—æ®µä»¥ä¾›è®¡ç®—ã€‚\n\nTCP å’Œ UDP å¯ä»¥ä½¿ç”¨åŒä¸€ä¸ªç«¯å£å—ï¼Ÿ\nç­”æ¡ˆï¼šå¯ä»¥çš„ã€‚\nåœ¨æ•°æ®é“¾è·¯å±‚ä¸­ï¼Œé€šè¿‡ MAC åœ°å€æ¥å¯»æ‰¾å±€åŸŸç½‘ä¸­çš„ä¸»æœºã€‚åœ¨ç½‘é™…å±‚ä¸­ï¼Œé€šè¿‡ IP åœ°å€æ¥å¯»æ‰¾ç½‘ç»œä¸­äº’è¿çš„ä¸»æœºæˆ–è·¯ç”±å™¨ã€‚åœ¨ä¼ è¾“å±‚ä¸­ï¼Œéœ€è¦é€šè¿‡ç«¯å£è¿›è¡Œå¯»å€ï¼Œæ¥è¯†åˆ«åŒä¸€è®¡ç®—æœºä¸­åŒæ—¶é€šä¿¡çš„ä¸åŒåº”ç”¨ç¨‹åºã€‚\næ‰€ä»¥ï¼Œä¼ è¾“å±‚çš„ã€Œç«¯å£å·ã€çš„ä½œç”¨ï¼Œæ˜¯ä¸ºäº†åŒºåˆ†åŒä¸€ä¸ªä¸»æœºä¸Šä¸åŒåº”ç”¨ç¨‹åºçš„æ•°æ®åŒ…ã€‚\nä¼ è¾“å±‚æœ‰ä¸¤ä¸ªä¼ è¾“åè®®åˆ†åˆ«æ˜¯ TCP å’Œ UDPï¼Œåœ¨å†…æ ¸ä¸­æ˜¯ä¸¤ä¸ªå®Œå…¨ç‹¬ç«‹çš„è½¯ä»¶æ¨¡å—ã€‚\nå½“ä¸»æœºæ”¶åˆ°æ•°æ®åŒ…åï¼Œå¯ä»¥åœ¨ IP åŒ…å¤´çš„ã€Œåè®®å·ã€å­—æ®µçŸ¥é“è¯¥æ•°æ®åŒ…æ˜¯ TCP/UDPï¼Œæ‰€ä»¥å¯ä»¥æ ¹æ®è¿™ä¸ªä¿¡æ¯ç¡®å®šé€ç»™å“ªä¸ªæ¨¡å—ï¼ˆTCP/UDPï¼‰å¤„ç†ï¼Œé€ç»™ TCP/UDP æ¨¡å—çš„æŠ¥æ–‡æ ¹æ®ã€Œç«¯å£å·ã€ç¡®å®šé€ç»™å“ªä¸ªåº”ç”¨ç¨‹åºå¤„ç†ã€‚\n\nå› æ­¤ï¼ŒTCP/UDP å„è‡ªçš„ç«¯å£å·ä¹Ÿç›¸äº’ç‹¬ç«‹ï¼Œå¦‚ TCP æœ‰ä¸€ä¸ª 80 å·ç«¯å£ï¼ŒUDP ä¹Ÿå¯ä»¥æœ‰ä¸€ä¸ª 80 å·ç«¯å£ï¼ŒäºŒè€…å¹¶ä¸å†²çªã€‚\nå…³äºç«¯å£çš„çŸ¥è¯†ç‚¹ï¼Œè¿˜æ˜¯æŒºå¤šå¯ä»¥è®²çš„ï¼Œæ¯”å¦‚è¿˜å¯ä»¥ç‰µæ‰¯åˆ°è¿™å‡ ä¸ªé—®é¢˜ï¼š\n\nå¤šä¸ª TCP æœåŠ¡è¿›ç¨‹å¯ä»¥åŒæ—¶ç»‘å®šåŒä¸€ä¸ªç«¯å£å—ï¼Ÿ\né‡å¯ TCP æœåŠ¡è¿›ç¨‹æ—¶ï¼Œä¸ºä»€ä¹ˆä¼šå‡ºç°â€œAddress in useâ€çš„æŠ¥é”™ä¿¡æ¯ï¼Ÿåˆè¯¥æ€ä¹ˆé¿å…ï¼Ÿ\nå®¢æˆ·ç«¯çš„ç«¯å£å¯ä»¥é‡å¤ä½¿ç”¨å—ï¼Ÿ\nå®¢æˆ·ç«¯ TCP è¿æ¥ TIME_WAIT çŠ¶æ€è¿‡å¤šï¼Œä¼šå¯¼è‡´ç«¯å£èµ„æºè€—å°½è€Œæ— æ³•å»ºç«‹æ–°çš„è¿æ¥å—ï¼Ÿ\n\nä¸Šé¢è¿™äº›é—®é¢˜ï¼Œå¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« ï¼šTCP å’Œ UDP å¯ä»¥ä½¿ç”¨åŒä¸€ä¸ªç«¯å£å—ï¼Ÿ\nTCPè¿æ¥å»ºç«‹\nä¸‰æ¬¡æ¡æ‰‹\nTCP æ˜¯é¢å‘è¿æ¥çš„åè®®ï¼Œæ‰€ä»¥ä½¿ç”¨ TCP å‰å¿…é¡»å…ˆå»ºç«‹è¿æ¥ï¼Œè€Œå»ºç«‹è¿æ¥æ˜¯é€šè¿‡ä¸‰æ¬¡æ¡æ‰‹æ¥è¿›è¡Œçš„ã€‚ä¸‰æ¬¡æ¡æ‰‹çš„è¿‡ç¨‹å¦‚ä¸‹å›¾ï¼š\n\n\nä¸€å¼€å§‹,å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½å¤„äºcloseçŠ¶æ€,å…ˆæ˜¯æœåŠ¡ç«¯ä¸»åŠ¨ç›‘å¬æŸä¸ªç«¯å£,å¤„äºlistençŠ¶æ€\nå®¢æˆ·ç«¯ä¼šéšæœºåˆå§‹åŒ–åºåˆ—å·client_isn,ç„¶åSYNç½®1,ç»„æˆä¸€ä¸ªSYNæŠ¥æ–‡,å‘é€ç»™æœåŠ¡ç«¯,è¡¨ç¤ºå‘èµ·è¿æ¥.è¯¥æŠ¥æ–‡ä¸åŒ…å«åº”ç”¨å±‚æ•°æ®\n\nå‘é€æŠ¥æ–‡å,å®¢æˆ·ç«¯å¤„äºSYN-SENTçŠ¶æ€\n\n\næœåŠ¡ç«¯æ”¶åˆ°å®¢æˆ·ç«¯çš„SYNæŠ¥æ–‡ä¹‹å,æœåŠ¡ç«¯ä¹Ÿéšæœºåˆå§‹åŒ–è‡ªå·±çš„åºåˆ—å·(server-isn),ç¡®è®¤åº”ç­”å·ä½ç½®å¡«å…¥client_isn+1,ç„¶åACKå’ŒSYNéƒ½ç½®1:è¡¨ç¤ºç¡®è®¤åº”ç­”ä½æœ‰æ•ˆ&amp;&amp;å¸Œæœ›å»ºç«‹è¿æ¥.ç„¶åæŠŠæŠ¥æ–‡å‘é€ç»™å®¢æˆ·ç«¯,è¯¥æŠ¥æ–‡ä¹Ÿä¸åŒ…å«åº”ç”¨å±‚æ•°æ®,ä¹‹åæœåŠ¡ç«¯å¤„äºSYN-RCVDçŠ¶æ€\nå®¢æˆ·ç«¯ä¸Šæ”¶åˆ°æœåŠ¡ç«¯æŠ¥æ–‡ä¹‹åï¼Œè¿˜éœ€è¦å‘æœåŠ¡ç«¯å›åº”æœ€åä¸€ä¸ªåº”ç­”æŠ¥æ–‡,é¦–å…ˆè¯¥åº”ç­”æŠ¥æ–‡TCPé¦–éƒ¨ACKæ ‡å¿—ä½ç½®ä¸º1,å…¶æ¬¡,ç¡®è®¤åº”ç­”å·å­—æ®µå¡«å…¥server_isn+1.ç„¶åå‘é€.è¿™æ¬¡æŠ¥æ–‡å¯ä»¥æºå¸¦å®¢æˆ·ç«¯åˆ°æœåŠ¡ç«¯çš„æ•°æ®äº†,ä¹‹åå®¢æˆ·ç«¯å¤„äºestablishedçŠ¶æ€\næœåŠ¡ç«¯æ”¶åˆ°ä¹‹å,ä¹Ÿè¿›å…¥establishedçŠ¶æ€.æ­¤æ—¶è¿æ¥å»ºç«‹å®Œæˆ,å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å¯ä»¥ç›¸äº’å‘é€æ•°æ®äº†\n\nç¬¬ä¸‰æ¬¡æ¡æ‰‹æ˜¯å¯ä»¥æºå¸¦æ•°æ®çš„ï¼Œå‰ä¸¤æ¬¡æ¡æ‰‹æ˜¯ä¸å¯ä»¥æºå¸¦æ•°æ®çš„\nåªæœ‰ç¬¬ä¸€ä¸ªæŠ¥æ–‡ä¸éœ€è¦ackç½®1,å…¶ä»–éƒ½éœ€è¦ç½®1.synæ˜¯å‰ä¸¤ä¸ªæŠ¥æ–‡éœ€è¦ç½®1.\n\n\n                  \n                  ä¸ºä»€ä¹ˆæ˜¯ä¸‰æ¬¡æ¡æ‰‹ \n                  \n                \n\né‡è¦çš„æ˜¯ä¸ºä»€ä¹ˆä¸‰æ¬¡æ¡æ‰‹æ‰å¯ä»¥åˆå§‹åŒ– Socketã€åºåˆ—å·å’Œçª—å£å¤§å°å¹¶å»ºç«‹ TCP è¿æ¥ã€‚\n\né¿å…å†å²è¿æ¥\nå¦‚æœæ”¶åˆ°äº†è¿‡æœŸçš„æ—§è¯·æ±‚,å†è¿”å›ä¸€ä¸ªåŒ…ç¡®è®¤æ˜¯å¦æ˜¯æ­£ç¡®çš„(ç”¨client_isn+1),å®¢æˆ·ç«¯å‘ç°æ˜¯é”™è¯¯çš„ä¹‹å,å°±ä¼šå‘ä¸€ä¸ªå–æ¶ˆæŒ‡ä»¤,è¿æ¥å°±ä¸ä¼šæˆç«‹\né˜²æ­¢èµ„æºæµªè´¹\nå¦‚æœSYNåœ¨ç½‘ç»œä¸­é˜»å¡äº†,å®¢æˆ·ç«¯æ²¡æ”¶åˆ°ACKæŠ¥æ–‡å°±ä¼šä¸€ç›´é‡å¤å‘é€SYN,ç„¶åæœåŠ¡å™¨æ”¶åˆ°äº†å¤šä¸ªè¯·æ±‚,ä¼šé—®æ˜¯å¦ç¡®è®¤è¦è¿æ¥,åªæœ‰ç¡®è®¤ä¹‹åæ‰ä¼šåˆ†é…èµ„æº.ä¸ç„¶çš„è¯å°±ä¼šæ ¹æ®å¤šä¸ªSYNå»ºç«‹å¤šä¸ªè¿æ¥,æµªè´¹èµ„æº.\nåŒæ­¥åºåˆ—å·\nå¿…é¡»éƒ½çŸ¥é“å¯¹æ–¹çš„èµ·å§‹åºåˆ—å·,äº¤æµæ‰ä¸ä¼šä¹±\nèµ·å§‹åºåˆ—å·-ç¡®è®¤.èµ·å§‹åºåˆ—å·-ç¡®è®¤ è¿™æ ·ä¸‰æ¬¡.\n\n\n\næŸ¥çœ‹TCPçŠ¶æ€\nTCP çš„è¿æ¥çŠ¶æ€æŸ¥çœ‹ï¼Œåœ¨ Linux å¯ä»¥é€šè¿‡Â netstat -naptÂ å‘½ä»¤æŸ¥çœ‹ã€‚\n\nä¸ºä»€ä¹ˆæ¯æ¬¡å»ºç«‹ TCP è¿æ¥æ—¶ï¼Œåˆå§‹åŒ–çš„åºåˆ—å·éƒ½è¦æ±‚ä¸ä¸€æ ·å‘¢ï¼Ÿ\nä¸»è¦åŸå› æœ‰ä¸¤ä¸ªæ–¹é¢ï¼š\n\n\nä¸ºäº†é˜²æ­¢å†å²æŠ¥æ–‡è¢«ä¸‹ä¸€ä¸ªç›¸åŒå››å…ƒç»„çš„è¿æ¥æ¥æ”¶ï¼ˆä¸»è¦æ–¹é¢ï¼‰\n\n\nä¸ºäº†å®‰å…¨æ€§ï¼Œé˜²æ­¢é»‘å®¢ä¼ªé€ çš„ç›¸åŒåºåˆ—å·çš„ TCP æŠ¥æ–‡è¢«å¯¹æ–¹æ¥æ”¶ï¼›\n\n\nå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å»ºç«‹ä¸€ä¸ª TCP è¿æ¥ï¼Œåœ¨å®¢æˆ·ç«¯å‘é€æ•°æ®åŒ…è¢«ç½‘ç»œé˜»å¡äº†ï¼Œç„¶åè¶…æ—¶é‡ä¼ äº†è¿™ä¸ªæ•°æ®åŒ…ï¼Œè€Œæ­¤æ—¶æœåŠ¡ç«¯è®¾å¤‡æ–­ç”µé‡å¯äº†ï¼Œä¹‹å‰ä¸å®¢æˆ·ç«¯å»ºç«‹çš„è¿æ¥å°±æ¶ˆå¤±äº†ï¼Œäºæ˜¯åœ¨æ”¶åˆ°å®¢æˆ·ç«¯çš„æ•°æ®åŒ…çš„æ—¶å€™å°±ä¼šå‘é€ RST æŠ¥æ–‡ã€‚\n\n\nç´§æ¥ç€ï¼Œå®¢æˆ·ç«¯åˆä¸æœåŠ¡ç«¯å»ºç«‹äº†ä¸ä¸Šä¸€ä¸ªè¿æ¥ç›¸åŒå››å…ƒç»„çš„è¿æ¥ï¼›\n\n\nåœ¨æ–°è¿æ¥å»ºç«‹å®Œæˆåï¼Œä¸Šä¸€ä¸ªè¿æ¥ä¸­è¢«ç½‘ç»œé˜»å¡çš„æ•°æ®åŒ…æ­£å¥½æŠµè¾¾äº†æœåŠ¡ç«¯ï¼Œåˆšå¥½è¯¥æ•°æ®åŒ…çš„åºåˆ—å·æ­£å¥½æ˜¯åœ¨æœåŠ¡ç«¯çš„æ¥æ”¶çª—å£å†…ï¼Œæ‰€ä»¥è¯¥æ•°æ®åŒ…ä¼šè¢«æœåŠ¡ç«¯æ­£å¸¸æ¥æ”¶ï¼Œå°±ä¼šé€ æˆæ•°æ®é”™ä¹±ã€‚\n\n\n\nè¿™é‡Œçš„æ ¸å¿ƒåœ¨äº ä¸€ä¸ªæ•°æ®åŒ…è¢«é˜»å¡äº† ä»¥è‡³äºå‘å‡ºçš„æ—¶å€™,ä»–è¿˜åœ¨ä¸Šä¸€ä¸ªè¿æ¥é‡Œ,è¢«æ”¶åˆ°çš„æ—¶å€™,å·²ç»æ˜¯ä¸‹ä¸€ä¸ªæ–°çš„è¿æ¥äº†.\n\nåˆå§‹åºåˆ—å· ISN æ˜¯å¦‚ä½•éšæœºäº§ç”Ÿçš„ï¼Ÿ\nèµ·å§‹Â ISNÂ æ˜¯åŸºäºæ—¶é’Ÿçš„ï¼Œæ¯ 4 å¾®ç§’ + 1ï¼Œè½¬ä¸€åœˆè¦ 4.55 ä¸ªå°æ—¶ã€‚\nRFC793 æåˆ°åˆå§‹åŒ–åºåˆ—å· ISN éšæœºç”Ÿæˆç®—æ³•ï¼šISN = M + F(localhost, localport, remotehost, remoteport)ã€‚\n\nMÂ æ˜¯ä¸€ä¸ªè®¡æ—¶å™¨ï¼Œè¿™ä¸ªè®¡æ—¶å™¨æ¯éš” 4 å¾®ç§’åŠ  1ã€‚\nFÂ æ˜¯ä¸€ä¸ª Hash ç®—æ³•ï¼Œæ ¹æ®æº IPã€ç›®çš„ IPã€æºç«¯å£ã€ç›®çš„ç«¯å£ç”Ÿæˆä¸€ä¸ªéšæœºæ•°å€¼ã€‚è¦ä¿è¯ Hash ç®—æ³•ä¸èƒ½è¢«å¤–éƒ¨è½»æ˜“æ¨ç®—å¾—å‡ºï¼Œç”¨ MD5 ç®—æ³•æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¥½çš„é€‰æ‹©ã€‚\nå¯ä»¥çœ‹åˆ°ï¼Œéšæœºæ•°æ˜¯ä¼šåŸºäºæ—¶é’Ÿè®¡æ—¶å™¨é€’å¢çš„ï¼ŒåŸºæœ¬ä¸å¯èƒ½ä¼šéšæœºæˆä¸€æ ·çš„åˆå§‹åŒ–åºåˆ—å·ã€‚\n\n\nå°±æ˜¯æ ¹æ®æ—¶é—´å’Œå››å…ƒç»„ç”Ÿæˆçš„.\n\næ—¢ç„¶ IP å±‚ä¼šåˆ†ç‰‡ï¼Œä¸ºä»€ä¹ˆ TCP å±‚è¿˜éœ€è¦ MSS å‘¢ï¼Ÿ\næˆ‘ä»¬å…ˆæ¥è®¤è¯†ä¸‹ MTU å’Œ MSS\n\n\nMTUï¼šä¸€ä¸ªç½‘ç»œåŒ…çš„æœ€å¤§é•¿åº¦ï¼Œä»¥å¤ªç½‘ä¸­ä¸€èˆ¬ä¸ºÂ 1500Â å­—èŠ‚ï¼›\nMSSï¼šé™¤å» IP å’Œ TCP å¤´éƒ¨ä¹‹åï¼Œä¸€ä¸ªç½‘ç»œåŒ…æ‰€èƒ½å®¹çº³çš„ TCP æ•°æ®çš„æœ€å¤§é•¿åº¦ï¼›\n\nå¦‚æœåœ¨ TCP çš„æ•´ä¸ªæŠ¥æ–‡ï¼ˆå¤´éƒ¨ + æ•°æ®ï¼‰äº¤ç»™ IP å±‚è¿›è¡Œåˆ†ç‰‡ï¼Œä¼šæœ‰ä»€ä¹ˆå¼‚å¸¸å‘¢ï¼Ÿ\nå½“ IP å±‚æœ‰ä¸€ä¸ªè¶…è¿‡Â MTUÂ å¤§å°çš„æ•°æ®ï¼ˆTCP å¤´éƒ¨ + TCP æ•°æ®ï¼‰è¦å‘é€[è¿™é‡Œæ˜¯è¯´,ç®—ä¸Šè‡ªå·±çš„ipå¤´ä¹‹å]ï¼Œé‚£ä¹ˆ IP å±‚å°±è¦è¿›è¡Œåˆ†ç‰‡ï¼ŒæŠŠæ•°æ®åˆ†ç‰‡æˆè‹¥å¹²ç‰‡ï¼Œä¿è¯æ¯ä¸€ä¸ªåˆ†ç‰‡éƒ½å°äº MTUã€‚æŠŠä¸€ä»½ IP æ•°æ®æŠ¥è¿›è¡Œåˆ†ç‰‡ä»¥åï¼Œç”±ç›®æ ‡ä¸»æœºçš„ IP å±‚æ¥è¿›è¡Œé‡æ–°ç»„è£…åï¼Œå†äº¤ç»™ä¸Šä¸€å±‚ TCP ä¼ è¾“å±‚ã€‚\nè¿™çœ‹èµ·æ¥äº•ç„¶æœ‰åºï¼Œä½†è¿™å­˜åœ¨éšæ‚£çš„ï¼Œé‚£ä¹ˆå½“å¦‚æœä¸€ä¸ª IP åˆ†ç‰‡ä¸¢å¤±ï¼Œæ•´ä¸ª IP æŠ¥æ–‡çš„æ‰€æœ‰åˆ†ç‰‡éƒ½å¾—é‡ä¼ ã€‚\nå› ä¸º IP å±‚æœ¬èº«æ²¡æœ‰è¶…æ—¶é‡ä¼ æœºåˆ¶ï¼Œå®ƒç”±ä¼ è¾“å±‚çš„ TCP æ¥è´Ÿè´£è¶…æ—¶å’Œé‡ä¼ ã€‚\nå½“æŸä¸€ä¸ª IP åˆ†ç‰‡ä¸¢å¤±åï¼Œæ¥æ”¶æ–¹çš„ IP å±‚å°±æ— æ³•ç»„è£…æˆä¸€ä¸ªå®Œæ•´çš„ TCP æŠ¥æ–‡ï¼ˆå¤´éƒ¨ + æ•°æ®ï¼‰ï¼Œä¹Ÿå°±æ— æ³•å°†æ•°æ®æŠ¥æ–‡é€åˆ° TCP å±‚ï¼Œæ‰€ä»¥æ¥æ”¶æ–¹ä¸ä¼šå“åº” ACK ç»™å‘é€æ–¹ï¼Œå› ä¸ºå‘é€æ–¹è¿Ÿè¿Ÿæ”¶ä¸åˆ° ACK ç¡®è®¤æŠ¥æ–‡ï¼Œæ‰€ä»¥ä¼šè§¦å‘è¶…æ—¶é‡ä¼ ï¼Œå°±ä¼šé‡å‘ã€Œæ•´ä¸ª TCP æŠ¥æ–‡ï¼ˆå¤´éƒ¨ + æ•°æ®ï¼‰ã€ã€‚\nå› æ­¤ï¼Œå¯ä»¥å¾—çŸ¥ç”± IP å±‚è¿›è¡Œåˆ†ç‰‡ä¼ è¾“ï¼Œæ˜¯éå¸¸æ²¡æœ‰æ•ˆç‡çš„ã€‚\næ‰€ä»¥ï¼Œä¸ºäº†è¾¾åˆ°æœ€ä½³çš„ä¼ è¾“æ•ˆèƒ½ TCP åè®®åœ¨å»ºç«‹è¿æ¥çš„æ—¶å€™é€šå¸¸è¦åå•†åŒæ–¹çš„ MSS å€¼ï¼Œå½“ TCP å±‚å‘ç°æ•°æ®è¶…è¿‡ MSS æ—¶ï¼Œåˆ™å°±å…ˆä¼šè¿›è¡Œåˆ†ç‰‡ï¼Œå½“ç„¶ç”±å®ƒå½¢æˆçš„ IP åŒ…çš„é•¿åº¦ä¹Ÿå°±ä¸ä¼šå¤§äº MTU ï¼Œè‡ªç„¶ä¹Ÿå°±ä¸ç”¨ IP åˆ†ç‰‡äº†ã€‚\nå‘é€æ–¹ä¼šæŒ‰ç…§æŒ‰ç…§æ¥æ”¶æ–¹å‘ŠçŸ¥è¿‡æ¥çš„mssæ¥å‘é€.ç»è¿‡ TCP å±‚åˆ†ç‰‡åï¼Œå¦‚æœä¸€ä¸ª TCP åˆ†ç‰‡ä¸¢å¤±åï¼Œè¿›è¡Œé‡å‘æ—¶ä¹Ÿæ˜¯ä»¥ MSS ä¸ºå•ä½ï¼Œè€Œä¸ç”¨é‡ä¼ æ‰€æœ‰çš„åˆ†ç‰‡ï¼Œå¤§å¤§å¢åŠ äº†é‡ä¼ çš„æ•ˆç‡ã€‚\næ¡æ‰‹ä¸¢å¤±äº†ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ\nè°çš„æ•°æ®åŒ…æ²¡è¢«ç¡®è®¤,è°å°±è´Ÿè´£é‡ä¼ .\n1.ç¬¬ä¸€æ¬¡æ¡æ‰‹ä¸¢å¤±äº†,é‚£ä¹ˆå‡ºå‘è¶…æ—¶é‡ä¼ .è¾¾åˆ°æœ€å¤§é‡ä¼ æ¬¡æ•°ä¹‹å,æ”¾å¼ƒè¿æ¥.\n2.ç¬¬äºŒæ¬¡æ¡æ‰‹ä¸¢å¤±äº†,å› ä¸ºåŒæ—¶ä¹Ÿæ˜¯å¯¹ç¬¬ä¸€æ¬¡æ¡æ‰‹çš„ç¡®è®¤,æ‰€ä»¥ä¸¤è¾¹çš„éƒ½ä¼šé‡ä¼ .åŒæ ·æ˜¯è¾¾åˆ°æœ€å¤§é‡ä¼ æ¬¡æ•°ä¹‹åæ”¾å¼ƒ\n3.ç¬¬ä¸‰æ¬¡æ¡æ‰‹ä¸¢å¤±,ä½†æ˜¯ACKæŠ¥æ–‡æœ¬èº«ä¸ä¼šé‡ä¼ .å› ä¸ºæœåŠ¡ç«¯è¿˜åœ¨ç­‰ACK,è¶…æ—¶æœªæ”¶åˆ°,ä¼šä»¥ä¸ºæ˜¯ç¬¬äºŒæ¬¡æ¡æ‰‹å‘çš„æŠ¥æ–‡å¯¹æ–¹æ²¡æœ‰æ”¶åˆ°,æ‰€ä»¥ä¼šé‡ä¼ SYN-ACK,ç„¶åå®¢æˆ·ç«¯æ”¶åˆ°ä¹‹å,çŸ¥é“è‡ªå·±ä¸Šä¸€æ¬¡å‘çš„ACKä¸¢äº†,äºæ˜¯å†æ¬¡å‘é€ACK,ä¹Ÿæ˜¯çœ‹æœåŠ¡ç«¯çš„æœ€å¤§é‡ä¼ æ¬¡æ•°\nä»€ä¹ˆæ˜¯ SYN æ”»å‡»ï¼Ÿå¦‚ä½•é¿å… SYN æ”»å‡»ï¼Ÿ\næˆ‘ä»¬éƒ½çŸ¥é“ TCP è¿æ¥å»ºç«‹æ˜¯éœ€è¦ä¸‰æ¬¡æ¡æ‰‹ï¼Œå‡è®¾æ”»å‡»è€…çŸ­æ—¶é—´ä¼ªé€ ä¸åŒ IP åœ°å€çš„Â SYNÂ æŠ¥æ–‡ï¼ŒæœåŠ¡ç«¯æ¯æ¥æ”¶åˆ°ä¸€ä¸ªÂ SYNÂ æŠ¥æ–‡ï¼Œå°±è¿›å…¥SYN_RCVDÂ çŠ¶æ€ï¼Œä½†æœåŠ¡ç«¯å‘é€å‡ºå»çš„Â ACK + SYNÂ æŠ¥æ–‡ï¼Œæ— æ³•å¾—åˆ°æœªçŸ¥ IP ä¸»æœºçš„Â ACKÂ åº”ç­”ï¼Œä¹…è€Œä¹…ä¹‹å°±ä¼šå æ»¡æœåŠ¡ç«¯çš„åŠè¿æ¥é˜Ÿåˆ—ï¼Œä½¿å¾—æœåŠ¡ç«¯ä¸èƒ½ä¸ºæ­£å¸¸ç”¨æˆ·æœåŠ¡ã€‚\nåœ¨ TCP ä¸‰æ¬¡æ¡æ‰‹çš„æ—¶å€™ï¼ŒLinux å†…æ ¸ä¼šç»´æŠ¤ä¸¤ä¸ªé˜Ÿåˆ—ï¼Œåˆ†åˆ«æ˜¯ï¼š\n\nåŠè¿æ¥é˜Ÿåˆ—ï¼Œä¹Ÿç§° SYN é˜Ÿåˆ—ï¼›\nå…¨è¿æ¥é˜Ÿåˆ—ï¼Œä¹Ÿç§° accept é˜Ÿåˆ—ï¼›\næˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹ Linux å†…æ ¸çš„Â SYNÂ é˜Ÿåˆ—ï¼ˆåŠè¿æ¥é˜Ÿåˆ—ï¼‰ä¸Â AccpetÂ é˜Ÿåˆ—ï¼ˆå…¨è¿æ¥é˜Ÿåˆ—ï¼‰æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ\næ­£å¸¸æµç¨‹ï¼š\nå½“æœåŠ¡ç«¯æ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„ SYN æŠ¥æ–‡æ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ªåŠè¿æ¥çš„å¯¹è±¡ï¼Œç„¶åå°†å…¶åŠ å…¥åˆ°å†…æ ¸çš„ã€Œ SYN é˜Ÿåˆ—ã€ï¼›\næ¥ç€å‘é€ SYN + ACK ç»™å®¢æˆ·ç«¯ï¼Œç­‰å¾…å®¢æˆ·ç«¯å›åº” ACK æŠ¥æ–‡ï¼›\næœåŠ¡ç«¯æ¥æ”¶åˆ° ACK æŠ¥æ–‡åï¼Œä»ã€Œ SYN é˜Ÿåˆ—ã€å–å‡ºä¸€ä¸ªåŠè¿æ¥å¯¹è±¡ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªæ–°çš„è¿æ¥å¯¹è±¡æ”¾å…¥åˆ°ã€Œ Accept é˜Ÿåˆ—ã€ï¼›\nåº”ç”¨é€šè¿‡è°ƒç”¨Â accpet()Â socket æ¥å£ï¼Œä»ã€Œ Accept é˜Ÿåˆ—ã€å–å‡ºè¿æ¥å¯¹è±¡ã€‚\n\nä¸ç®¡æ˜¯åŠè¿æ¥é˜Ÿåˆ—è¿˜æ˜¯å…¨è¿æ¥é˜Ÿåˆ—ï¼Œéƒ½æœ‰æœ€å¤§é•¿åº¦é™åˆ¶ï¼Œè¶…è¿‡é™åˆ¶æ—¶ï¼Œé»˜è®¤æƒ…å†µéƒ½ä¼šä¸¢å¼ƒæŠ¥æ–‡ã€‚\nSYN æ”»å‡»æ–¹å¼æœ€ç›´æ¥çš„è¡¨ç°å°±ä¼šæŠŠ TCP åŠè¿æ¥é˜Ÿåˆ—æ‰“æ»¡ï¼Œè¿™æ ·å½“ TCP åŠè¿æ¥é˜Ÿåˆ—æ»¡äº†ï¼Œåç»­å†åœ¨æ”¶åˆ° SYN æŠ¥æ–‡å°±ä¼šä¸¢å¼ƒï¼Œå¯¼è‡´å®¢æˆ·ç«¯æ— æ³•å’ŒæœåŠ¡ç«¯å»ºç«‹è¿æ¥ã€‚\né¿å… SYN æ”»å‡»æ–¹å¼ï¼Œå¯ä»¥æœ‰ä»¥ä¸‹å››ç§æ–¹æ³•ï¼š\n\nè°ƒå¤§ netdev_max_backlogï¼›\nå¢å¤§ TCP åŠè¿æ¥é˜Ÿåˆ—ï¼›\nå¼€å¯ tcp_syncookiesï¼›\nå‡å°‘ SYN+ACK é‡ä¼ æ¬¡æ•°\n\n\næ–¹å¼ä¸€ï¼šè°ƒå¤§ netdev_max_backlog\n\nå½“ç½‘å¡æ¥æ”¶æ•°æ®åŒ…çš„é€Ÿåº¦å¤§äºå†…æ ¸å¤„ç†çš„é€Ÿåº¦æ—¶ï¼Œä¼šæœ‰ä¸€ä¸ªé˜Ÿåˆ—ä¿å­˜è¿™äº›æ•°æ®åŒ…ã€‚æ§åˆ¶è¯¥é˜Ÿåˆ—çš„æœ€å¤§å€¼å¦‚ä¸‹å‚æ•°ï¼Œé»˜è®¤å€¼æ˜¯ 1000ï¼Œæˆ‘ä»¬è¦é€‚å½“è°ƒå¤§è¯¥å‚æ•°çš„å€¼ï¼Œæ¯”å¦‚è®¾ç½®ä¸º 10000ï¼š\nnet.core.netdev_max_backlog = 10000\n\n\næ–¹å¼äºŒï¼šå¢å¤§ TCP åŠè¿æ¥é˜Ÿåˆ—\n\nå¢å¤§ TCP åŠè¿æ¥é˜Ÿåˆ—ï¼Œè¦åŒæ—¶å¢å¤§ä¸‹é¢è¿™ä¸‰ä¸ªå‚æ•°ï¼š\n\nå¢å¤§ net.ipv4.tcp_max_syn_backlog\nå¢å¤§ listen() å‡½æ•°ä¸­çš„ backlog\nå¢å¤§ net.core.somaxconn\n\n\næ–¹å¼ä¸‰ï¼šå¼€å¯ net.ipv4.tcp_syncookies\nå¼€å¯ syncookies åŠŸèƒ½å°±å¯ä»¥åœ¨ä¸ä½¿ç”¨ SYN åŠè¿æ¥é˜Ÿåˆ—çš„æƒ…å†µä¸‹æˆåŠŸå»ºç«‹è¿æ¥ï¼Œç›¸å½“äºç»•è¿‡äº† SYN åŠè¿æ¥æ¥å»ºç«‹è¿æ¥ã€‚\n\n\nå…·ä½“è¿‡ç¨‹ï¼š\n\nå½“ ã€Œ SYN é˜Ÿåˆ—ã€æ»¡ä¹‹åï¼Œåç»­æœåŠ¡ç«¯æ”¶åˆ° SYN åŒ…ï¼Œä¸ä¼šä¸¢å¼ƒï¼Œè€Œæ˜¯æ ¹æ®ç®—æ³•ï¼Œè®¡ç®—å‡ºä¸€ä¸ªÂ cookieÂ å€¼ï¼›\nå°† cookie å€¼æ”¾åˆ°ç¬¬äºŒæ¬¡æ¡æ‰‹æŠ¥æ–‡çš„ã€Œåºåˆ—å·ã€é‡Œï¼Œç„¶åæœåŠ¡ç«¯å›ç¬¬äºŒæ¬¡æ¡æ‰‹ç»™å®¢æˆ·ç«¯ï¼›\næœåŠ¡ç«¯æ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„åº”ç­”æŠ¥æ–‡æ—¶ï¼ŒæœåŠ¡ç«¯ä¼šæ£€æŸ¥è¿™ä¸ª ACK åŒ…çš„åˆæ³•æ€§ã€‚å¦‚æœåˆæ³•ï¼Œå°†è¯¥è¿æ¥å¯¹è±¡æ”¾å…¥åˆ°ã€Œ Accept é˜Ÿåˆ—ã€ã€‚\næœ€ååº”ç”¨ç¨‹åºé€šè¿‡è°ƒç”¨Â accpet()Â æ¥å£ï¼Œä»ã€Œ Accept é˜Ÿåˆ—ã€å–å‡ºçš„è¿æ¥ã€‚\n\nå¯ä»¥çœ‹åˆ°ï¼Œå½“å¼€å¯äº† tcp_syncookies äº†ï¼Œå³ä½¿å—åˆ° SYN æ”»å‡»è€Œå¯¼è‡´ SYN é˜Ÿåˆ—æ»¡æ—¶ï¼Œä¹Ÿèƒ½ä¿è¯æ­£å¸¸çš„è¿æ¥æˆåŠŸå»ºç«‹ã€‚\nnet.ipv4.tcp_syncookies å‚æ•°ä¸»è¦æœ‰ä»¥ä¸‹ä¸‰ä¸ªå€¼ï¼š\n\n0 å€¼ï¼Œè¡¨ç¤ºå…³é—­è¯¥åŠŸèƒ½ï¼›\n1 å€¼ï¼Œè¡¨ç¤ºä»…å½“ SYN åŠè¿æ¥é˜Ÿåˆ—æ”¾ä¸ä¸‹æ—¶ï¼Œå†å¯ç”¨å®ƒï¼›\n2 å€¼ï¼Œè¡¨ç¤ºæ— æ¡ä»¶å¼€å¯åŠŸèƒ½ï¼›\n\né‚£ä¹ˆåœ¨åº”å¯¹ SYN æ”»å‡»æ—¶ï¼Œåªéœ€è¦è®¾ç½®ä¸º 1 å³å¯ã€‚\n$ echo 1 &gt; /proc/sys/net/ipv4/tcp_syncookies\n\n\næ–¹å¼å››ï¼šå‡å°‘ SYN+ACK é‡ä¼ æ¬¡æ•°\n\nå½“æœåŠ¡ç«¯å—åˆ° SYN æ”»å‡»æ—¶ï¼Œå°±ä¼šæœ‰å¤§é‡å¤„äº SYN_REVC çŠ¶æ€çš„ TCP è¿æ¥ï¼Œå¤„äºè¿™ä¸ªçŠ¶æ€çš„ TCP ä¼šé‡ä¼  SYN+ACK ï¼Œå½“é‡ä¼ è¶…è¿‡æ¬¡æ•°è¾¾åˆ°ä¸Šé™åï¼Œå°±ä¼šæ–­å¼€è¿æ¥ã€‚\né‚£ä¹ˆé’ˆå¯¹ SYN æ”»å‡»çš„åœºæ™¯ï¼Œæˆ‘ä»¬å¯ä»¥å‡å°‘ SYN-ACK çš„é‡ä¼ æ¬¡æ•°ï¼Œä»¥åŠ å¿«å¤„äº SYN_REVC çŠ¶æ€çš„ TCP è¿æ¥æ–­å¼€ã€‚\nSYN-ACK æŠ¥æ–‡çš„æœ€å¤§é‡ä¼ æ¬¡æ•°ç”±Â tcp_synack_retrieså†…æ ¸å‚æ•°å†³å®šï¼ˆé»˜è®¤å€¼æ˜¯ 5 æ¬¡ï¼‰ï¼Œæ¯”å¦‚å°† tcp_synack_retries å‡å°‘åˆ° 2 æ¬¡ï¼š\nè¿æ¥æ–­å¼€å››æ¬¡æŒ¥æ‰‹\nåŒæ–¹éƒ½å¯ä»¥ä¸»åŠ¨æ–­å¼€è¿æ¥ï¼Œæ–­å¼€è¿æ¥åä¸»æœºä¸­çš„ã€Œèµ„æºã€å°†è¢«é‡Šæ”¾ï¼Œå››æ¬¡æŒ¥æ‰‹çš„è¿‡ç¨‹å¦‚ä¸‹å›¾ï¼š\n\n\nå®¢æˆ·ç«¯æ‰“ç®—å…³é—­è¿æ¥ï¼Œæ­¤æ—¶ä¼šå‘é€ä¸€ä¸ª TCP é¦–éƒ¨Â FINÂ æ ‡å¿—ä½è¢«ç½®ä¸ºÂ 1Â çš„æŠ¥æ–‡ï¼Œä¹Ÿå³Â FINÂ æŠ¥æ–‡ï¼Œä¹‹åå®¢æˆ·ç«¯è¿›å…¥Â FIN_WAIT_1Â çŠ¶æ€ã€‚\næœåŠ¡ç«¯æ”¶åˆ°è¯¥æŠ¥æ–‡åï¼Œå°±å‘å®¢æˆ·ç«¯å‘é€Â ACKÂ åº”ç­”æŠ¥æ–‡ï¼Œæ¥ç€æœåŠ¡ç«¯è¿›å…¥Â CLOSE_WAITÂ çŠ¶æ€ã€‚\nå®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡ç«¯çš„Â ACKÂ åº”ç­”æŠ¥æ–‡åï¼Œä¹‹åè¿›å…¥Â FIN_WAIT_2Â çŠ¶æ€ã€‚\nç­‰å¾…æœåŠ¡ç«¯å¤„ç†å®Œæ•°æ®åï¼Œä¹Ÿå‘å®¢æˆ·ç«¯å‘é€Â FINÂ æŠ¥æ–‡ï¼Œä¹‹åæœåŠ¡ç«¯è¿›å…¥Â LAST_ACKÂ çŠ¶æ€ã€‚\nå®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡ç«¯çš„Â FINÂ æŠ¥æ–‡åï¼Œå›ä¸€ä¸ªÂ ACKÂ åº”ç­”æŠ¥æ–‡ï¼Œä¹‹åè¿›å…¥Â TIME_WAITÂ çŠ¶æ€\næœåŠ¡ç«¯æ”¶åˆ°äº†Â ACKÂ åº”ç­”æŠ¥æ–‡åï¼Œå°±è¿›å…¥äº†Â CLOSEÂ çŠ¶æ€ï¼Œè‡³æ­¤æœåŠ¡ç«¯å·²ç»å®Œæˆè¿æ¥çš„å…³é—­ã€‚\nå®¢æˆ·ç«¯åœ¨ç»è¿‡Â 2MSLÂ ä¸€æ®µæ—¶é—´åï¼Œè‡ªåŠ¨è¿›å…¥Â CLOSEÂ çŠ¶æ€ï¼Œè‡³æ­¤å®¢æˆ·ç«¯ä¹Ÿå®Œæˆè¿æ¥çš„å…³é—­ã€‚\n\nä½ å¯ä»¥çœ‹åˆ°ï¼Œæ¯ä¸ªæ–¹å‘éƒ½éœ€è¦ä¸€ä¸ª FIN å’Œä¸€ä¸ª ACKï¼Œå› æ­¤é€šå¸¸è¢«ç§°ä¸ºå››æ¬¡æŒ¥æ‰‹ã€‚\nè¿™é‡Œä¸€ç‚¹éœ€è¦æ³¨æ„æ˜¯ï¼šä¸»åŠ¨å…³é—­è¿æ¥çš„ï¼Œæ‰æœ‰ TIME_WAIT çŠ¶æ€ã€‚\nå…³äºFIN_WAIT_2çŠ¶æ€\n\nè¿™æ˜¯ç¬¬äºŒæ¬¡æŒ¥æ‰‹åï¼Œå®¢æˆ·ç«¯ç­‰å¾…æœåŠ¡ç«¯å‘ FIN çš„çŠ¶æ€ã€‚\nå¦‚æœç”¨ close() å…³é—­ï¼š å— tcp_fin_timeout (é»˜è®¤ 60s) æ§åˆ¶ã€‚è¶…æ—¶æ²¡æ”¶åˆ°ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹ï¼Œå†…æ ¸ç›´æ¥å…³è¿æ¥ã€‚\nå¦‚æœç”¨ shutdown() å…³é—­ï¼š ä¸å— tcp_fin_timeout æ§åˆ¶ã€‚å¦‚æœæœåŠ¡ç«¯ä¸€ç›´ä¸å‘ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹ï¼Œå®¢æˆ·ç«¯ä¼šä¸€ç›´æ­»ç­‰åœ¨ FIN_WAIT_2ï¼Œå¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼ã€‚\n\nä¸ºä»€ä¹ˆæŒ¥æ‰‹éœ€è¦å››æ¬¡\nå†æ¥å›é¡¾ä¸‹å››æ¬¡æŒ¥æ‰‹åŒæ–¹å‘Â FINÂ åŒ…çš„è¿‡ç¨‹ï¼Œå°±èƒ½ç†è§£ä¸ºä»€ä¹ˆéœ€è¦å››æ¬¡äº†ã€‚\n\nå…³é—­è¿æ¥æ—¶ï¼Œå®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€Â FINÂ æ—¶ï¼Œä»…ä»…è¡¨ç¤ºå®¢æˆ·ç«¯ä¸å†å‘é€æ•°æ®äº†ä½†æ˜¯è¿˜èƒ½æ¥æ”¶æ•°æ®ã€‚\næœåŠ¡ç«¯æ”¶åˆ°å®¢æˆ·ç«¯çš„Â FINÂ æŠ¥æ–‡æ—¶ï¼Œå…ˆå›ä¸€ä¸ªÂ ACKÂ åº”ç­”æŠ¥æ–‡ï¼Œè€ŒæœåŠ¡ç«¯å¯èƒ½è¿˜æœ‰æ•°æ®éœ€è¦å¤„ç†å’Œå‘é€ï¼Œç­‰æœåŠ¡ç«¯ä¸å†å‘é€æ•°æ®æ—¶ï¼Œæ‰å‘é€Â FINÂ æŠ¥æ–‡ç»™å®¢æˆ·ç«¯æ¥è¡¨ç¤ºåŒæ„ç°åœ¨å…³é—­è¿æ¥ã€‚\n\nä»ä¸Šé¢è¿‡ç¨‹å¯çŸ¥ï¼ŒæœåŠ¡ç«¯é€šå¸¸éœ€è¦ç­‰å¾…å®Œæˆæ•°æ®çš„å‘é€å’Œå¤„ç†ï¼Œæ‰€ä»¥æœåŠ¡ç«¯çš„Â ACKÂ å’ŒÂ FINÂ ä¸€èˆ¬éƒ½ä¼šåˆ†å¼€å‘é€ï¼Œå› æ­¤æ˜¯éœ€è¦å››æ¬¡æŒ¥æ‰‹ã€‚\næŒ¥æ‰‹ä¸¢å¤±äº†ä¼šå‘ç”Ÿä»€ä¹ˆ\n\nACKæŠ¥æ–‡æ°¸è¿œä¸ä¼šè¢«é‡ä¼ \nè°å‘çš„FIN,è°è´Ÿè´£é‡ä¼ .\n\nå¦‚æœFinæŠ¥æ–‡ä¸¢å¤±äº†,å‘é€æ–¹ä¼šè§¦å‘è¶…æ—¶é‡ä¼ \nå¦‚æœACKæŠ¥æ–‡ä¸¢äº†,FINçš„å‘é€æ–¹ä¼šä»¥ä¸ºè‡ªå·±å‘çš„Finå¯¹æ–¹æ²¡æœ‰æ”¶åˆ°,æ‰€ä»¥è¿˜æ˜¯è‡ªå·±é‡ä¼ \n\n\né‡ä¼ æ¬¡æ•°æ§åˆ¶åœ¨ä¸€å®šæ¬¡æ•°å†…,è¶…è¿‡äº†ä¼šæ”¾å¼ƒ\n\n1.ç¬¬ä¸€æ¬¡finä¸¢å¤±,å®¢æˆ·ç«¯é‡ä¼ \n2.ç¬¬äºŒæ¬¡æœåŠ¡ç«¯å‘ackä¸¢å¤±,å®¢æˆ·ç«¯é‡ä¼ fin\n3.ç¬¬ä¸‰æ¬¡æœåŠ¡ç«¯finä¸¢å¤±,æœåŠ¡ç«¯é‡ä¼ \n4.ç¬¬å››æ¬¡å®¢æˆ·ç«¯å‘ackä¸¢å¤±,æœåŠ¡ç«¯é‡ä¼ fin.å®¢æˆ·ç«¯æ”¶åˆ°é‡ä¼ çš„finä¹‹å,é‡ç½®2MSLå®šæ—¶å™¨å¹¶å†æ¬¡å‘é€ACK\nä¸ºä»€ä¹ˆæ˜¯ 2MSL\nåªæœ‰ä¸»åŠ¨å…³é—­è¿æ¥çš„é‚£ä¸€æ–¹(é€šå¸¸æ˜¯å®¢æˆ·ç«¯)æ‰ä¼šè¿›å…¥TIME_WAIT\n\nMSLæ˜¯æŠ¥æ–‡åœ¨ç½‘ç»œä¸­æœ€é•¿çš„ç”Ÿå­˜æ—¶é—´\nä¸¤å€:å…è®¸æŠ¥æ–‡ä¸€å»ä¸€å›.æ—¢è¦ä¿è¯æœ€åçš„ACKèƒ½å¤Ÿä¼ ç»™å¯¹æ–¹,ä¹Ÿè¦å…è®¸å¯¹æ–¹é‡ä¼ çš„Finèƒ½ä¼ å›æ¥.\nLinux ç¡¬ç¼–ç  MSL = 30ç§’ã€‚,å› æ­¤ä¸¤å€å°±æ˜¯60s,ä¸å¯ä»¥åŠ¨æ€ä¿®æ”¹.å¦‚æœåœ¨ç­‰å¾…æœŸé—´æ”¶åˆ°äº†æœåŠ¡å™¨é‡ä¼ çš„fin,å®šæ—¶å™¨ä¼šé‡ç½®,é‡æ–°è®¡æ—¶\n\nä¸ºä»€ä¹ˆéœ€è¦TIME_WAITçŠ¶æ€\n\né˜²æ­¢å†å²è¿æ¥ä¸­çš„æ•°æ®ï¼Œè¢«åé¢ç›¸åŒå››å…ƒç»„çš„è¿æ¥é”™è¯¯çš„æ¥æ”¶,æ˜¯éšæœºåºåˆ—å·çš„æ›´è¿›ä¸€æ­¥ä¿éšœ.\nä¿è¯ã€Œè¢«åŠ¨å…³é—­è¿æ¥ã€çš„ä¸€æ–¹ï¼Œèƒ½è¢«æ­£ç¡®çš„å…³é—­ï¼›å‡è®¾å®¢æˆ·ç«¯æ²¡æœ‰ TIME_WAIT çŠ¶æ€ï¼Œè€Œæ˜¯åœ¨å‘å®Œæœ€åä¸€æ¬¡å› ACK æŠ¥æ–‡å°±ç›´æ¥è¿›å…¥ CLOSE çŠ¶æ€ï¼Œå¦‚æœè¯¥ ACK æŠ¥æ–‡ä¸¢å¤±äº†ï¼ŒæœåŠ¡ç«¯åˆ™é‡ä¼ çš„ FIN æŠ¥æ–‡ï¼Œè€Œè¿™æ—¶å®¢æˆ·ç«¯å·²ç»è¿›å…¥åˆ°å…³é—­çŠ¶æ€äº†ï¼Œåœ¨æ”¶åˆ°æœåŠ¡ç«¯é‡ä¼ çš„ FIN æŠ¥æ–‡åï¼Œå°±ä¼šå› RST æŠ¥æ–‡,æ¯”è¾ƒä¸ä¼˜é›…\n\nTIME_WAIT è¿‡å¤šæœ‰ä»€ä¹ˆå±å®³ï¼Ÿ\nè¿‡å¤šçš„ TIME-WAIT çŠ¶æ€ä¸»è¦çš„å±å®³æœ‰ä¸¤ç§ï¼š\n\nç¬¬ä¸€æ˜¯å ç”¨ç³»ç»Ÿèµ„æºï¼Œæ¯”å¦‚æ–‡ä»¶æè¿°ç¬¦ã€å†…å­˜èµ„æºã€CPU èµ„æºã€çº¿ç¨‹èµ„æºç­‰ï¼›\nç¬¬äºŒæ˜¯å ç”¨ç«¯å£èµ„æºï¼Œç«¯å£èµ„æºä¹Ÿæ˜¯æœ‰é™çš„ï¼Œä¸€èˆ¬å¯ä»¥å¼€å¯çš„ç«¯å£ä¸ºÂ 32768ï½61000ï¼Œä¹Ÿå¯ä»¥é€šè¿‡Â net.ipv4.ip_local_port_rangeå‚æ•°æŒ‡å®šèŒƒå›´ã€‚\nå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ TIME_WAIT è¿‡å¤šï¼Œé€ æˆçš„å½±å“æ˜¯ä¸åŒçš„ã€‚\nå¦‚æœå®¢æˆ·ç«¯ï¼ˆä¸»åŠ¨å‘èµ·å…³é—­è¿æ¥æ–¹ï¼‰çš„ TIME_WAIT çŠ¶æ€è¿‡å¤šï¼Œå æ»¡äº†æ‰€æœ‰ç«¯å£èµ„æºï¼Œé‚£ä¹ˆå°±æ— æ³•å¯¹ã€Œç›®çš„ IP+ ç›®çš„ PORTã€éƒ½ä¸€æ ·çš„æœåŠ¡ç«¯å‘èµ·è¿æ¥äº†ï¼Œä½†æ˜¯è¢«ä½¿ç”¨çš„ç«¯å£ï¼Œè¿˜æ˜¯å¯ä»¥ç»§ç»­å¯¹å¦å¤–ä¸€ä¸ªæœåŠ¡ç«¯å‘èµ·è¿æ¥çš„ã€‚\nå› æ­¤ï¼Œå®¢æˆ·ç«¯ï¼ˆå‘èµ·è¿æ¥æ–¹ï¼‰éƒ½æ˜¯å’Œã€Œç›®çš„ IP+ ç›®çš„ PORT ã€éƒ½ä¸€æ ·çš„æœåŠ¡ç«¯å»ºç«‹è¿æ¥çš„è¯ï¼Œå½“å®¢æˆ·ç«¯çš„ TIME_WAIT çŠ¶æ€è¿æ¥è¿‡å¤šçš„è¯ï¼Œå°±ä¼šå—ç«¯å£èµ„æºé™åˆ¶ï¼Œå¦‚æœå æ»¡äº†æ‰€æœ‰ç«¯å£èµ„æºï¼Œé‚£ä¹ˆå°±æ— æ³•å†è·Ÿã€Œç›®çš„ IP+ ç›®çš„ PORTã€éƒ½ä¸€æ ·çš„æœåŠ¡ç«¯å»ºç«‹è¿æ¥äº†ã€‚\n\nä¸è¿‡ï¼Œå³ä½¿æ˜¯åœ¨è¿™ç§åœºæ™¯ä¸‹ï¼Œåªè¦è¿æ¥çš„æ˜¯ä¸åŒçš„æœåŠ¡ç«¯ï¼Œç«¯å£æ˜¯å¯ä»¥é‡å¤ä½¿ç”¨çš„ï¼Œæ‰€ä»¥å®¢æˆ·ç«¯è¿˜æ˜¯å¯ä»¥å‘å…¶ä»–æœåŠ¡ç«¯å‘èµ·è¿æ¥çš„ï¼Œè¿™æ˜¯å› ä¸ºå†…æ ¸åœ¨å®šä½ä¸€ä¸ªè¿æ¥çš„æ—¶å€™ï¼Œæ˜¯é€šè¿‡å››å…ƒç»„ï¼ˆæºIPã€æºç«¯å£ã€ç›®çš„IPã€ç›®çš„ç«¯å£ï¼‰ä¿¡æ¯æ¥å®šä½çš„ï¼Œå¹¶ä¸ä¼šå› ä¸ºå®¢æˆ·ç«¯çš„ç«¯å£ä¸€æ ·ï¼Œè€Œå¯¼è‡´è¿æ¥å†²çªã€‚\nå¦‚æœæœåŠ¡ç«¯ï¼ˆä¸»åŠ¨å‘èµ·å…³é—­è¿æ¥æ–¹ï¼‰çš„ TIME_WAIT çŠ¶æ€è¿‡å¤šï¼Œå¹¶ä¸ä¼šå¯¼è‡´ç«¯å£èµ„æºå—é™ï¼Œå› ä¸ºæœåŠ¡ç«¯åªç›‘å¬ä¸€ä¸ªç«¯å£ï¼Œè€Œä¸”ç”±äºä¸€ä¸ªå››å…ƒç»„å”¯ä¸€ç¡®å®šä¸€ä¸ª TCP è¿æ¥ï¼Œå› æ­¤ç†è®ºä¸ŠæœåŠ¡ç«¯å¯ä»¥å»ºç«‹å¾ˆå¤šè¿æ¥ï¼Œä½†æ˜¯ TCP è¿æ¥è¿‡å¤šï¼Œä¼šå ç”¨ç³»ç»Ÿèµ„æºï¼Œæ¯”å¦‚æ–‡ä»¶æè¿°ç¬¦ã€å†…å­˜èµ„æºã€CPU èµ„æºã€çº¿ç¨‹èµ„æºç­‰ã€‚"},"è¯¾ç¨‹ç¬”è®°/è®¡ç®—æœºç½‘ç»œ/æœŸæœ«å¤ä¹ -å¤§é¢˜":{"slug":"è¯¾ç¨‹ç¬”è®°/è®¡ç®—æœºç½‘ç»œ/æœŸæœ«å¤ä¹ -å¤§é¢˜","filePath":"è¯¾ç¨‹ç¬”è®°/è®¡ç®—æœºç½‘ç»œ/æœŸæœ«å¤ä¹ -å¤§é¢˜.md","title":"æœŸæœ«å¤ä¹ -å¤§é¢˜","links":[],"tags":[],"content":"è·ç¦»å‘é‡è·¯ç”±ç®—æ³•(DVç®—æ³•\næ€»è·ç¦» = åˆ°é‚»å±…çš„è·ç¦» + é‚»å±…åˆ°ç›®çš„åœ°çš„è·ç¦»\nè·¯ç”±è¡¨åªè¦æ ¹æ®æ¥æ”¶åˆ°çš„æ–°ä¿¡æ¯,å»é€‰æ‹©ä¸‹ä¸€æ¡æ˜¯å“ªä¸ªè·¯ç”±å™¨çš„æ—¶å€™,ä»£ä»·æœ€å°å°±å¯ä»¥.å¦‚æœä¸æ˜¯é‚»å±…,å°±ä¸è€ƒè™‘.åªè¦ä¿¡ä»»é‚»å±…å‘æ¥çš„ä¿¡æ¯å°±å¯ä»¥\n192.168.10.0/24è¿›ä¸€æ­¥åˆ’åˆ†æˆå››ä¸ªç­‰é•¿çš„å­ç½‘:\nè¿™ä¸ªæ—¶å€™å‰24ä½æ˜¯ç½‘ç»œå·,åå…«ä½æ˜¯ä¸»æœºå·.è¦åˆ†å››ä¸ªå­ç½‘,æˆ‘ä»¬éœ€è¦ä»8ä½ä¸»æœºå·é‡Œé¢åˆ†2ä½å‡ºæ¥ å­ç½‘æ©ç å°±å˜æˆäº†å‰26ä½1\n11000000: 192\næ‰€ä»¥åè¿›åˆ¶æ©ç å°±æ˜¯255.255.255.192\nå°†256ä¸ªåœ°å€å¹³å‡åˆ†æˆ4ä»½çš„è¯,æ¯ä¸ªå­ç½‘éƒ½è¦æœ‰64ä¸ªåœ°å€,ç„¶åéœ€è¦2ä½è¡¨ç¤ºå­ç½‘.ä¹Ÿå°±æ˜¯2çš„å…­æ¬¡æ–¹=64(æ³¨æ„è¿™é‡Œæ˜¯000000111111 ç¡®å®æ˜¯2çš„å…­æ¬¡æ–¹-1+1å“ˆ.)\né’ˆå¯¹ç¬¬å››ä¸ªå­ç½‘è€Œè¨€,ç½‘ç»œåœ°å€æ˜¯192.168.10.192 (ä¹Ÿå°±æ˜¯è¯¥æ®µçš„ç¬¬ä¸€ä¸ªåœ°å€,ä»£è¡¨èº«ä»½)\nå¹¿æ’­åœ°å€æ˜¯192.168.10.255 è¯¥æ®µçš„æœ€åä¸€ä¸ªåœ°å€ ç”¨äºå¹¿æ’­\næå¤´å»å°¾,å°±å¯ä»¥å¾—åˆ°193254 æ˜¯å¯ä»¥ç”¨äºæ ‡å¿—ä¸»æœºçš„\nç½‘ç»œé…ç½®åˆ†æä¸NAT\nOSPFå¼€æ”¾æœ€çŸ­è·¯å¾„ä¼˜å…ˆæ˜¯ä¸€ç§è®©è·¯ç”±å™¨è‡ªåŠ¨è®¡ç®—â€œæ€ä¹ˆèµ°æœ€è¿‘â€çš„åè®®.ä¸æ˜¯é é‚»å±…ä¹‹é—´ä¼ é€’,è€Œæ˜¯æŠŠå…¨ç½‘çš„åœ°å›¾éƒ½ä¸‹è½½ä¸‹æ¥ï¼Œç„¶åç”¨æœ€çŸ­è·¯å¾„ç®—æ³•ï¼ˆDijkstra ç®—æ³•ï¼‰è‡ªå·±ç®—å‡ºæœ€ä¼˜è·¯çº¿ã€‚\nå®ƒä¸çœ‹è·³æ•°ï¼Œå®ƒçœ‹çš„æ˜¯å¸¦å®½ï¼ˆCostï¼Œä»£ä»·ï¼‰ã€‚è·¯è¶Šå®½ã€ç½‘é€Ÿè¶Šå¿«ï¼Œä»£ä»·è¶Šä½ã€‚\n==AD ç®¡ç†è·ç¦»,æ˜¯ä¸€ä¸ªå¯ä¿¡åº¦æŒ‡æ ‡,OSPF çš„é»˜è®¤å¯ä¿¡åº¦æ•°å€¼æ˜¯ 110==\nNAT\nNATç½‘ç»œåœ°å€è½¬æ¢,å› ä¸ºå…¨çƒçš„å…¬ç½‘ IP ä¸å¤Ÿç”¨äº†ï¼Œæ‰€ä»¥å¤§å®¶åœ¨å®¶é‡Œã€å…¬å¸é‡Œéƒ½ç”¨å†…ç½‘ IPï¼Œå‡ºé—¨æ—¶ç»Ÿä¸€ç”±è·¯ç”±å™¨è½¬æ¢æˆå…¬ç½‘ IPã€‚\n\nå†…ç½‘ IPï¼ˆ192.168.x.xï¼‰ï¼š å°±åƒå…¬å¸å†…éƒ¨çš„åˆ†æœºå·ï¼Œåœ¨å¤–é¢æ˜¯æ‰“ä¸é€šçš„ï¼Œä¹Ÿæ²¡æ³•ç›´æ¥ä¸Šç½‘ã€‚\nå…¬ç½‘ IPï¼ˆ203.0.x.xï¼‰ï¼š å°±åƒå…¬å¸çš„æ€»æœºå·ç ï¼Œå…¨çƒå”¯ä¸€ï¼Œå¯ä»¥ä¸Šç½‘ã€‚\nç„¶åè·¯ç”±å™¨è¿˜ä¼šè®°å½•ä¸€ä¸ªNATè½¬æ¢æ¡ç›®è¡¨,ä»¥ä¾¿äºæœåŠ¡å™¨å›åº”çš„æ—¶å€™å¯ä»¥é€è¾¾.\n\nOSPFé€‰routeridçš„é¡ºåºæ˜¯\n1.æ‰‹åŠ¨æŒ‡å®š\n2.loopbackè™šæ‹Ÿæ¥å£åœ°å€ä¸­çš„æœ€å¤§å€¼\n3.ç‰©ç†æ¥å£åœ°å€ä¸­çš„æœ€å¤§å€¼\næºip:ç«¯å£ ç›®çš„åœ°ip:ç«¯å£\nç»è¿‡è·¯ç”±å™¨è½¬æ¢å,å°†æºipæ”¹æˆè·¯ç”±å™¨è‡ªå·±çš„å…¬å…±ip,æºç«¯å£æ”¹æˆåˆ†é…çš„æ–°ç«¯å£,ç›®çš„åœ°ä¸å˜,\nè·¯ç”±å™¨:ipå±‚ è´Ÿè´£æ‰¾è·¯ 3\nswitch èƒ½çœ‹æ‡‚macåœ°å€ æ˜¯æ•°æ®é“¾è·¯å±‚è®¾å¤‡ 2\nhubé›†çº¿å™¨ åªè´Ÿè´£æŠŠç”µæµä¼ ç»™æ‰€æœ‰äººç‰©ç†å±‚è®¾å¤‡ 1\nç½‘ç»œè®¾å¤‡cisco\n\nip route &lt;ç›®æ ‡ç½‘æ®µ&gt; &lt;æ©ç &gt; &lt;ä¸‹ä¸€è·³IPæˆ–å‡ºæ¥å£&gt;\n\nä½œç”¨ï¼š é…ç½®é™æ€è·¯ç”±ã€‚å‘Šè¯‰è·¯ç”±å™¨å»å¾€æŸä¸ªç½‘ç»œè¯¥æ€ä¹ˆèµ°ã€‚\n\n\nredistribute &lt;åè®®&gt; &lt;å‚æ•°&gt; subnets\n\nè·¯ç”±é‡åˆ†å‘ã€‚å°†ä¸€ç§è·¯ç”±åè®®å­¦ä¹ åˆ°çš„è·¯ç”±æ³¨å…¥åˆ°å¦ä¸€ç§åè®®ä¸­ï¼ˆä¾‹å¦‚å°† OSPF çš„è·¯ç”±å¼•å…¥åˆ° BGP ä¸­ï¼‰ã€‚subnetsÂ å…³é”®å­—é€šå¸¸ç”¨äº OSPFï¼Œè¡¨ç¤ºåŒ…å«å­ç½‘ã€‚\n\n\n\n\nospfå’Œbgpåè®®:\n\nOSPF åè®® (å†…éƒ¨ç½‘å…³åè®®)\n\nrouter ospf &lt;è¿›ç¨‹å·&gt;\n\nä½œç”¨ï¼š å¯åŠ¨ OSPF è·¯ç”±è¿›ç¨‹ã€‚\n\n\nnetwork &lt;ç½‘ç»œå·&gt; &lt;åæ©ç &gt; area &lt;åŒºåŸŸå·&gt;\n\nä½œç”¨ï¼š å®£å‘Šç½‘ç»œã€‚å‘Šè¯‰ OSPF åœ¨è¿™ä¸ªæ¥å£ä¸Šè¿è¡Œï¼Œå¹¶å°†å…¶æ‰€å±çš„ç½‘æ®µé€šå‘Šç»™é‚»å±…ã€‚æ³¨æ„è¿™é‡Œé€šå¸¸ç”¨é€šé…ç¬¦æ©ç ï¼ˆåæ©ç ï¼‰ã€‚\n\n\narea &lt;ID&gt; virtual-link &lt;Router-ID&gt;\n\nä½œç”¨ï¼š é…ç½® OSPF è™šé“¾è·¯ã€‚å½“ééª¨å¹²åŒºåŸŸï¼ˆé Area 0ï¼‰æ— æ³•ç›´æ¥ç‰©ç†è¿æ¥åˆ°éª¨å¹²åŒºåŸŸæ—¶ï¼Œé€šè¿‡æ­¤å‘½ä»¤é€»è¾‘è¿æ¥ã€‚\n\n\n\nBGP åè®® (è¾¹ç•Œç½‘å…³åè®®)\n\nrouter bgp &lt;ASå·&gt;\n\nä½œç”¨ï¼š å¯åŠ¨ BGP è·¯ç”±è¿›ç¨‹ã€‚AS æ˜¯è‡ªæ²»ç³»ç»Ÿå·ã€‚\n\n\nnetwork &lt;ç½‘ç»œå·&gt; mask &lt;æ©ç &gt;\n\nä½œç”¨ï¼š åœ¨ BGP ä¸­é€šå‘Šè·¯ç”±ã€‚æ³¨æ„ BGP é€šå¸¸ä½¿ç”¨æ­£æ©ç ã€‚ æ³¨æ„è¿™é‡Œæ˜¯å­ç½‘ï¼ï¼ï¼\n\n\nneighbor &lt;IPåœ°å€&gt; remote-as &lt;ASå·&gt;\n\nä½œç”¨ï¼š æŒ‡å®š BGP é‚»å±…çš„ IP å’Œæ‰€åœ¨çš„è‡ªæ²»ç³»ç»Ÿå·ï¼Œå»ºç«‹å¯¹ç­‰ä½“å…³ç³»ã€‚é€šå¸¸ebgpç”¨ç«¯å£ip ibgpç”¨loopback\n\n\nneighbor &lt;IPåœ°å€&gt; update-source &lt;æ¥å£&gt;\n\nä½œç”¨ï¼š æŒ‡å®šå»ºç«‹ BGP é‚»å±…è¿æ¥æ—¶ä½¿ç”¨çš„æºæ¥å£ã€‚é€šå¸¸åœ¨å»ºç«‹ iBGP é‚»å±…æ—¶ï¼Œå»ºè®®ä½¿ç”¨ Loopback æ¥å£ä½œä¸ºæºï¼Œä»¥ä¿è¯è¿æ¥ç¨³å®šæ€§ã€‚ã€‚å°±æ˜¯è¯´ï¼Œè®¾ç½®ibgpæ˜¯ç›¸äº’çš„\n\n\n\nloopback\n\nè¿™ä¸ªè™šæ‹Ÿæ¥å£éå¸¸çš„ç¨³å®šï¼Œå› æ­¤routeidä¸€èˆ¬ä¹Ÿä¼šé€‰ç”¨è¿™ä¸ª å› ä¸ºå…¶ä»–æ¥å£æœ‰å¯èƒ½å‘ç”Ÿæ”¹å˜é‚£è¦é‡æ–°é€‰routeidå°±ä¸æ–¹ä¾¿äº†ã€‚\nbgpé…ç½®çš„æ—¶å€™å»ºé‚»å±…ä¹Ÿæœ€å¥½ç”¨loopbackå»ºï¼Œ\n\nrouteid\nç”¨æ¥æ ‡è¯†èŠ‚ç‚¹èº«ä»½\nç”¨æ¥é€‰ç­é•¿å‰¯ç­é•¿\nasè·¯ç”±è·³æ•°\n\nospfé»˜è®¤æ˜¯çœ‹å¸¦å®½çš„,å¸¦å®½è¶Šå¤§ï¼Œcostè¶Šå°ï¼Œå°±é€‰è¿™æ¡ã€‚\n\n\nFastEthernet (f0/0, f0/1) çš„å¸¦å®½é€šå¸¸æ˜¯ 100 Mbpsï¼ŒOSPF Cost æ˜¯ 1\nSerial (s2/0) çš„å¸¦å®½ï¼ˆé»˜è®¤ T1 æ ‡å‡†ï¼‰é€šå¸¸æ˜¯ 1.544 Mbpsï¼ŒOSPF Cost æ˜¯ 64\n\né…ç½®é¢˜\näºŒå±‚äº¤æ¢æœºæ˜¯ç”¨æ¥è¿æ¥åŒä¸€ä¸ªå­ç½‘å†…çš„è®¾å¤‡çš„.æ ¸å¿ƒä»»åŠ¡æ˜¯éš”ç¦»ä¸åŒvlan.[è´Ÿè´£æŠŠåŒä¸€ä¸ª VLAN é‡Œçš„ç”µè„‘è¿èµ·æ¥ï¼Œä¸åŒ VLAN ä¹‹é—´æ˜¯ç»ç¼˜çš„ã€‚]\n\naccess å½“ç”µè„‘æ’åˆ°ä¸€ä¸ª Access VLAN 10 çš„å£ä¸Šï¼Œäº¤æ¢æœºå°±ç»™å®ƒæ‰“ä¸Šâ€œæˆ‘æ˜¯ VLAN 10â€çš„æ ‡ç­¾.è¿™æ˜¯è¿›å…¥vlançš„å¤§é—¨,å¦‚æœæ²¡æœ‰access,é‚£æ˜¯çœŸçš„è¿›å…¥ä¸äº†ç½‘ç»œ\ntrunk æ˜¯ä¸åŒäº¤æ¢æœºä¹‹é—´çš„è¿è¾“ç®¡é“ï¼Œå®ƒä¿è¯ VLAN 10 çš„æ•°æ®ä¼ è¿‡å»è¿˜æ˜¯ VLAN 10ï¼Œç»ä¸è®©å®ƒå˜æˆ VLAN 20ã€‚å¦‚æœæ²¡æœ‰å¼€ Trunkï¼Œåªç”¨ä¸€æ ¹ç½‘çº¿è¿æ¥ä¸¤å°äº¤æ¢æœºï¼Œé‚£ä¹ˆè¿™æ¡çº¿ä¸Šåªèƒ½è·‘ 1 ä¸ª VLAN çš„æ•°æ®[é»˜è®¤æ˜¯vlan1]ã€‚å…¶ä»– VLAN çš„æ•°æ®æ ¹æœ¬è¿‡ä¸å»ï¼Œç›´æ¥è¢«ä¸¢å¼ƒã€‚\nè·¯ç”±ï¼ˆè·¯ç”±å™¨/ä¸‰å±‚äº¤æ¢æœºï¼‰ï¼š åªæœ‰å®ƒä»¬æ‰æœ‰èƒ½åŠ›æŠŠ VLAN 10 çš„æ•°æ®æ‹¿å‡ºæ¥ï¼Œä¿®æ”¹æ ‡ç­¾ï¼Œè½¬å‘ç»™ VLAN 20ã€‚è¿™å«â€œä¸‰å±‚è½¬å‘â€ã€‚\n\nvlanä¸»è¦æ˜¯åœ¨äº¤æ¢æœºä¸Šé…,è·¯ç”±å™¨å’ŒæœåŠ¡å™¨ä¹Ÿå¯ä»¥é….\nä¸€èˆ¬é…ç½®trunkçš„æƒ…å†µå°±æ˜¯ ä¸¤å°äº¤æ¢æœºä¹‹é—´,æˆ–è€…ä¸€å°äº¤æ¢æœºè¿ä»¥å°è·¯ç”±å™¨(å•è‡‚è·¯ç”±).æ€»ä¹‹trunkå°±æ˜¯ç”¨äºé€šè¿‡å¤šä¸ªvlançš„çº¿è·¯.\naccesså°±æ˜¯è¿æ¥äº¤æ¢æœºå’Œæ™®é€šç»ˆç«¯çš„,å¯¹ä»–åšä¸€ä¸ªvlançš„æ”¹é€ .\n\nABRä¸area\nABRæ˜¯åœ¨ä¸¤ä¸ªareaä¹‹é—´çš„åŒºåŸŸè¾¹ç•Œè·¯ç”±å™¨ area border router\næ™®é€šçš„è·¯ç”±å™¨åªå±äºä¸€ä¸ªåŒºåŸŸ,è„‘å­é‡Œåªæœ‰ä¸€å¼ åœ°å›¾.ABRå¿…é¡»åŒæ—¶è¿æ¥éª¨å¹²åŒºåŸŸå’Œä¸€ä¸ªæˆ–è€…å¤šä¸ªééª¨å¹²åŒºåŸŸ,\nè„‘å­é‡Œç»´æŠ¤ç€å¤šä¸ªå®Œå…¨éš”ç¦»çš„æ•°æ®åº“LSDB\nå…³é”®ä»»åŠ¡æ˜¯ç”ŸæˆLSA  ABRä¼šé˜…è¯»area1çš„æ‰€æœ‰ç²¾ç¡®çš„æ‹“æ‰‘ä¿¡æ¯,ç„¶åè®¡ç®—å‡ºæ‰€æœ‰ç½‘æ®µçš„è·¯ç”±,ç”ŸæˆNetwork Summary LSA å‘é€ç»™Area0 ,å°±æ˜¯æ‰“åŒ…æ±‡æ€»\nè™šé“¾è·¯: åŸåˆ™ä¸Šæ‰€æœ‰ééª¨å¹²åŒºåŸŸéƒ½è¦è¿æ¥åˆ°éª¨å¹²åŒºåŸŸ,æŠŠéª¨å¹²åŒºåŸŸä½œä¸ºä¸­è½¬,ä¸å…è®¸ééª¨å¹²åŒºåŸŸè‡ªå·±è¿é€š.å¦‚æœarea2åˆ°ä¸äº†area0,é‚£å°±åœ¨area1ä¹‹é—´æ‰“ä¸€ä¸ªè™šæ‹Ÿé“¾è·¯å»è¿æ¥.é…ç½®ä¹‹å,area1ä¸­é—´çš„è·¯ç”±å™¨åªè´Ÿè´£è½¬å‘æ•°æ®åŒ…,è€Œæ„Ÿè§‰ä¸åˆ°è¿™æ¡é“¾è·¯çš„å­˜åœ¨,å¯¹äºarea2æ¥è¯´å°±ç›¸å½“äºç›´è¿äº†area0\n\nè¦åœ¨ä¸­é—´ç©¿è¶ŠåŒºåŸŸçš„ä¸¤ç«¯è·¯ç”±å™¨ä¸Šé…ç½®\n\n\nR1ï¼šè¿æ¥ Area 0 å’Œ Area 1ï¼ˆRouter ID: 1.1.1.1ï¼‰\nR2ï¼šè¿æ¥ Area 1 å’Œ Area 2ï¼ˆRouter ID: 2.2.2.2ï¼‰\nä¸­é—´åŒºåŸŸï¼šArea 1\nç›®æ ‡ï¼šè®© R2 ç©¿è¿‡ Area 1 è¿ä¸Š Area 0ã€‚\n\n\n2. ä¸ºä»€ä¹ˆâ€œç›´è¿â€å¯ä»¥ï¼Œâ€œä¼ è¯â€å°±ä¸è¡Œï¼Ÿ\næˆ‘ä»¬å›åˆ°ä½ çš„é‚£ä¸ªé“¾æ¡æ¨¡å‹ï¼šÂ Area 0 (åŒ—äº¬) &lt;---&gt; ABR1 (ä½ çš„è§’è‰²) &lt;---&gt; Area 1 (æ²³åŒ—) &lt;---&gt; ABR2 &lt;---&gt; Area 2 (å†…è’™)\nä½ æ˜¯Â ABR1ã€‚ä½ è¿æ¥ç€ Area 0 å’Œ Area 1ã€‚\næƒ…å†µ Aï¼šæŠŠ Area 1 (æ²³åŒ—) çš„äº‹å‘Šè¯‰ Area 0 (åŒ—äº¬)\n\nä½ çš„è§†è§’ï¼šå› ä¸ºä½ çš„ä¸€åªè„šå°±åœ¨æ²³åŒ—ï¼ˆArea 1ï¼‰ï¼Œä½ æ‰‹é‡Œæ‹¿ç€çš„æ˜¯æ²³åŒ—çš„åŸå§‹é«˜æ¸…åœ°å›¾ï¼ˆ1ç±»ã€2ç±» LSAï¼‰ã€‚\nåŠ¨ä½œï¼šä½ çœ‹ç€åŸå§‹åœ°å›¾ï¼Œäº²è‡ªå†™äº†ä¸€ä»½ç®€æŠ¥ï¼ˆ3ç±» LSAï¼‰ï¼Œé€’äº¤ç»™ Area 0ã€‚\nç»“è®ºï¼šè¿™æ˜¯å…è®¸çš„ã€‚å› ä¸ºæ˜¯ä½ **â€œäº²çœ¼æ‰€è§ã€äº²è‡ªæ€»ç»“â€**çš„ã€‚\n\næƒ…å†µ Bï¼šæŠŠ Area 2 (å†…è’™) çš„äº‹å‘Šè¯‰ Area 0 (åŒ—äº¬)\n\nä½ çš„è§†è§’ï¼šä½ å¹¶ä¸è¿æ¥å†…è’™ã€‚ä½ æ˜¯å¬Â ABR2Â å‘Šè¯‰ä½ çš„ã€‚ABR2 åœ¨ Area 1 é‡Œå‘äº†ä¸€æ¡ç®€æŠ¥ï¼ˆ3ç±» LSAï¼‰è¯´ï¼šâ€œæˆ‘æœ‰è·¯å»å†…è’™â€ã€‚\nåŠ¨ä½œï¼šè¿™æ—¶å€™ï¼Œä½ ä½œä¸º ABR1ï¼Œåœ¨ Area 1 è¿™ä¸€ä¾§æ”¶åˆ°äº†è¿™æ¡ç®€æŠ¥ã€‚\nOSPF çš„æ­»è§„çŸ©ï¼ˆLSA è½¬æ¢è§„åˆ™ï¼‰ï¼š\n\nABR åªè´Ÿè´£æŠŠâ€œåŸå§‹åœ°å›¾ï¼ˆ1ç±»/2ç±»ï¼‰â€è½¬æ¢æˆâ€œç®€æŠ¥ï¼ˆ3ç±»ï¼‰â€ã€‚Â ABR ç»ä¸è´Ÿè´£æŠŠâ€œåˆ«äººçš„ç®€æŠ¥ï¼ˆ3ç±»ï¼‰â€å†æ¬¡è½¬å‘ç»™ Area 0ã€‚\nè¿™å°±æ˜¯é—®é¢˜çš„å…³é”®ï¼ç®€æŠ¥ï¼ˆ3ç±» LSAï¼‰ä¸èƒ½äºŒæ‰‹è½¬å‘è¿›éª¨å¹²åŒºåŸŸã€‚\n\n\n\nä¸‹ä¸€è·³ï¼ˆNext Hopï¼‰æ°¸è¿œæ˜¯å†™â€œå¯¹æ–¹è·¯ç”±å™¨çš„æ¥å£ IP åœ°å€â€ï¼ˆç«¯å£ IPï¼‰\nIPv6\n\nä»¥è¿™ä¸ªä¸ºä¾‹ï¼Œå‰80ä½æ˜¯ç½‘æ®µå·ï¼Œå48ä½æ˜¯ä¸»æœºå·ã€‚æ€»å…±128ä½ï¼š\n16ç¦æ­¢ï¼Œä¸€å…±8ç»„æ•°å­—ï¼Œæ¯ç»„4ä¸ª16è¿›åˆ¶æ•°ã€‚\n2001 : 0db8 : 0000 : 0000 : 0000 : 0000 : 1428 : 57ab\næ¯ç»„å¼€å¤´çš„Â 0Â å¯ä»¥çœç•¥ï¼Œä½†ä¸­é—´å’Œç»“å°¾çš„ä¸èƒ½çœã€‚\n\n0064Â â†’ ç®€å†™ä¸ºÂ 64\n0db8Â â†’ ç®€å†™ä¸ºÂ db8\n0000Â â†’ ç®€å†™ä¸ºÂ 0\nè§„åˆ™äºŒï¼šè¿ç»­çš„ä¸€ä¸² 0ï¼Œå¯ä»¥ç”¨åŒå†’å·Â ::Â ä»£æ›¿**\nå¦‚æœæœ‰ä¸€è¿ä¸²çš„Â 0000:0000:0000ï¼Œä½ å¯ä»¥ç›´æ¥æŠŠå®ƒä»¬å‹ç¼©æˆä¸€ä¸ªÂ ::ã€‚\næ³¨æ„ï¼šÂ æ•´ä¸ªåœ°å€é‡Œåªèƒ½å‡ºç°ä¸€æ¬¡Â ::ï¼ˆå¦åˆ™è·¯ç”±å™¨ä¸çŸ¥é“ä½ åœ¨ä¸¤ä¸ªÂ ::Â é‡Œåˆ†åˆ«è—äº†å‡ ä¸ª 0ï¼‰ã€‚\n\né»˜è®¤æƒ…å†µä¸‹ï¼ŒBGPæ ¹æ®ä»€ä¹ˆæ¡ä»¶å†³å®šæœ€ä½³è·¯ç”±ï¸–\nåœ¨é»˜è®¤é…ç½®ä¸‹,BGPæœ€æ ¸â¼¼çš„åˆ¤æ–­æ¡ä»¶æ˜¯AS_PATHä¹Ÿå°±æ˜¯ASè·¯å¾„é•¿åº¦,BGPä¼šä¼˜å…ˆé€‰æ‹©ASè·³æ•°æœ€å°‘çš„è·¯å¾„,å¦‚\næœASè·¯å¾„é•¿åº¦ç›¸åŒ,åç»­ä¼šä¾æ¬¡â½è¾ƒå…¶ä»–å±æ€§.\nçœ‹è·¯ç”±è¡¨\n\nè·¯ç”±å™¨ä¼˜å…ˆçº§æ˜¯ç”±ç®¡ç†è·ç¦»ADå†³å®šçš„ã€‚æ•°å€¼è¶Šå°"},"è¯¾ç¨‹ç¬”è®°/è®¡ç®—æœºç½‘ç»œ/æœŸæœ«å¤ä¹ -æ€»çº²":{"slug":"è¯¾ç¨‹ç¬”è®°/è®¡ç®—æœºç½‘ç»œ/æœŸæœ«å¤ä¹ -æ€»çº²","filePath":"è¯¾ç¨‹ç¬”è®°/è®¡ç®—æœºç½‘ç»œ/æœŸæœ«å¤ä¹ -æ€»çº².md","title":"æœŸæœ«å¤ä¹ -æ€»çº²","links":[],"tags":[],"content":"å¤§é¢˜\n\nIPåœ°å€åˆ’åˆ†ã€å­ç½‘æ©ç ä¸è·¯ç”±èšåˆ (CIDR)ï¼š\nÂ Â Â Â â—¦ è€ƒç‚¹ï¼šå­ç½‘åˆ’åˆ†è®¡ç®—ï¼ˆå·²çŸ¥ä¸»æœºæ•°æ±‚æ©ç ï¼‰ CIDRè·¯ç”±èšåˆã€è·¯ç”±è¡¨æœ€é•¿å‰ç¼€åŒ¹é…ï¼ˆNext Hopé€‰æ‹©ï¼‰\nÂ Â Â Â â—¦ éš¾ç‚¹ï¼šå¤šçº§è·¯ç”±è¡¨èšåˆã€å­ç½‘å®¹çº³ä¸»æœºæ•°è®¡ç®—ï¼ˆ2nâˆ’2åŸåˆ™ï¼‰\nTCP æ‹¥å¡æ§åˆ¶ä¸çª—å£ç®¡ç†ï¼š\nÂ Â Â Â â—¦ è€ƒç‚¹ï¼šæ…¢å¯åŠ¨ (Slow Start)ã€æ‹¥å¡é¿å… (Congestion Avoidance)ã€å¿«é‡ä¼ /å¿«æ¢å¤ (Tahoe vs Reno)ã€æ»‘åŠ¨çª—å£å¤§å°è®¡ç®—ï¼ˆæ¥æ”¶çª—å£ä¸æ‹¥å¡çª—å£å–æœ€å°å€¼ï¼‰ã€‚\nÂ Â Â Â â—¦ éš¾ç‚¹ï¼šè¶…æ—¶æˆ–æ”¶åˆ°é‡å¤ACKåé˜ˆå€¼ (ssthresh) å’Œçª—å£å€¼çš„åŠ¨æ€å˜åŒ–æ›²çº¿ã€‚\nè·¯ç”±ç®—æ³•è®¡ç®—ï¼š\nÂ Â Â Â â—¦ è€ƒç‚¹ï¼šè·ç¦»å‘é‡è·¯ç”± (Distance Vector) çš„æ›´æ–°ï¼ˆBellman-Fordå…¬å¼ï¼‰ã€é“¾è·¯çŠ¶æ€è·¯ç”± (Link State/OSPF)ã€‚\nÂ Â Â Â â—¦ éš¾ç‚¹ï¼šDVç®—æ³•ä¸­çš„â€œåæ¶ˆæ¯ä¼ å¾—æ…¢â€é—®é¢˜åŠå…¶æ”¶æ•›è¿‡ç¨‹è®¡ç®—ã€‚\nCSMA/CD ä¸ ä»¥å¤ªç½‘æ€§èƒ½ï¼š\nÂ Â Â Â â—¦ è€ƒç‚¹ï¼šæœ€å°å¸§é•¿è®¡ç®—ï¼ˆLminâ€‹=2Ã—RTTÃ—Bandwidthï¼‰ã€æœ‰æ•ˆæ•°æ®ä¼ è¾“é€Ÿç‡è®¡ç®—ã€äºŒè¿›åˆ¶æŒ‡æ•°é€€é¿ç®—æ³•ã€‚\nÂ Â Â Â â—¦ éš¾ç‚¹ï¼šè€ƒè™‘ä¼ æ’­å»¶è¿Ÿå’Œç¡®è®¤å¸§åçš„æœ‰æ•ˆååé‡è®¡ç®—ã€‚\n\né«˜é¢‘é€‰æ‹©åˆ¤æ–­\n\nç‰©ç†å±‚åŸºç¡€è®¡ç®—ï¼š\nÂ Â Â Â â—¦ è€ƒç‚¹ï¼šå¥ˆå¥æ–¯ç‰¹å‡†åˆ™ (Nyquist) æ— å™ªå£°å¸¦å®½è®¡ç®—ã€é¦™å†œå…¬å¼ (Shannon) æœ‰å™ªå£°ä¿¡é“å®¹é‡ã€åˆ†è´ (dB) è½¬æ¢ã€‚\nÂ Â Â Â â—¦ æ³¨æ„ï¼šè‹¥ä¸¤ä¸ªå…¬å¼éƒ½å¯ç”¨ï¼Œå–è®¡ç®—ç»“æœä¸­è¾ƒå°çš„ä¸€ä¸ªã€‚\næ•°æ®é“¾è·¯å±‚å·®é”™æ§åˆ¶ï¼š\nÂ Â Â Â â—¦ è€ƒç‚¹ï¼šå¾ªç¯å†—ä½™æ ¡éªŒ (CRC) ç¼–ç ä¸æ ¡éªŒè¿‡ç¨‹ã€æµ·æ˜ç  (Hamming Code) çº é”™ä½æ•°è®¡ç®—ã€‚\nTCP è¿æ¥ç®¡ç†ä¸çŠ¶æ€æœºï¼š\nÂ Â Â Â â—¦ è€ƒç‚¹ï¼šä¸‰æ¬¡æ¡æ‰‹ï¼ˆSYN, ACKåºå·å˜åŒ–ï¼‰ã€å››æ¬¡æŒ¥æ‰‹ã€å„é˜¶æ®µçŠ¶æ€åç§°ï¼ˆESTABLISHED, TIME_WAITç­‰ï¼‰ã€‚\nåº”ç”¨å±‚åè®®ç»†èŠ‚ï¼š\nÂ Â Â Â â—¦ è€ƒç‚¹ï¼šHTTP çŠ¶æ€ç ï¼ˆ200, 404, 500ï¼‰ã€Cookiesã€æŒä¹…/éæŒä¹…è¿æ¥ï¼›DNS è®°å½•ç±»å‹ï¼ˆA, MX, CNAMEï¼‰ï¼›SMTP/POP3/IMAP ç«¯å£å·åŠåŠŸèƒ½ã€‚\n\nä½ä¼˜å…ˆçº§\nP3ï¼šä½ä¼˜å…ˆçº§ï¼ˆè®°å¿†æ€§çŸ¥è¯†ï¼ŒåŸºç¡€è¡¥å……ï¼‰\n\nç½‘ç»œåˆ†å±‚æ¨¡å‹ï¼šOSIä¸ƒå±‚ä¸TCP/IPå››å±‚/äº”å±‚æ¨¡å‹ã€å„å±‚PDUåç§°ï¼ˆæ®µã€åŒ…ã€å¸§ã€æ¯”ç‰¹ï¼‰ã€Headersçš„æ·»åŠ /åˆ é™¤æ–¹å‘ã€‚\nç½‘ç»œå®‰å…¨ï¼šå¯¹ç§°å¯†é’¥ vs å…¬é’¥ (RSA)ã€æ•°å­—ç­¾å (Message Digest)ã€CA è¯ä¹¦éªŒè¯é€»è¾‘ã€SSL/TLS æ¡æ‰‹ã€‚\nåè®®è¾…åŠ©å·¥å…·ï¼šARPã€ICMPï¼ˆPing/Tracertï¼‰ã€DHCPã€NAT è½¬æ¢è¡¨ã€‚\n\né¢è¯•å¯¼å‘\n1. TCP/IP åè®®æ ˆï¼ˆé‡ä¸­ä¹‹é‡ï¼‰\n\nä¸‰æ¬¡æ¡æ‰‹ &amp; å››æ¬¡æŒ¥æ‰‹ï¼š\n\nè€ƒç‚¹ï¼š ä¸ºä»€ä¹ˆè¦ä¸‰æ¬¡ï¼Ÿä¸ºä»€ä¹ˆè¦å››æ¬¡ï¼Ÿ\nçŠ¶æ€æœºï¼š TIME_WAIT å’Œ CLOSE_WAIT çŠ¶æ€çš„åŒºåˆ«å’Œäº§ç”ŸåŸå› ã€‚ï¼ˆè¿™æ˜¯åç«¯æ’æŸ¥æœåŠ¡å™¨è¿æ¥æ³„éœ²é—®é¢˜çš„æ ¸å¿ƒï¼‰\nGo å…³è”ï¼š å½“ä½ å†™ defer conn.Close() æ—¶ï¼Œåº•å±‚å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ\n\n\nTCP å¯é æ€§ä¿éšœï¼š\n\nè€ƒç‚¹ï¼š æ»‘åŠ¨çª—å£ï¼ˆæµé‡æ§åˆ¶ï¼‰ã€æ‹¥å¡æ§åˆ¶ï¼ˆæ…¢å¯åŠ¨ã€æ‹¥å¡é¿å…ã€å¿«é‡ä¼ ã€å¿«æ¢å¤ï¼‰ã€‚\né»åŒ…/æ‹†åŒ…é—®é¢˜ï¼š ä¸ºä»€ä¹ˆä¼šå‘ç”Ÿï¼Ÿå¦‚ä½•åœ¨åº”ç”¨å±‚è§£å†³ï¼ˆå¦‚è®¾è®¡ç”± Header+Body ç»„æˆçš„åè®®ï¼‰ï¼Ÿ\n\n\nTCP vs UDPï¼š\n\nåŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿä»€ä¹ˆåœºæ™¯ç”¨ UDPï¼ˆç›´æ’­ã€HTTP/3ã€QUICï¼‰ï¼Ÿ\n\n\n\n2. HTTP åè®®\n\nHTTP ç‰ˆæœ¬æ¼”å˜ï¼š\n\n1.0 vs 1.1ï¼š é•¿è¿æ¥ (Keep-Alive)ã€‚\n1.1 vs 2.0ï¼š å¤šè·¯å¤ç”¨ (Multiplexing)ã€å¤´éƒ¨å‹ç¼©ã€æœåŠ¡ç«¯æ¨é€ã€‚Go çš„ gRPC åŸºäº HTTP/2ï¼Œæ‰€ä»¥ 2.0 çš„ç‰¹æ€§å¿…è€ƒã€‚\nHTTP/3 (QUIC)ï¼š åŸºäº UDP è§£å†³äº† TCP çš„é˜Ÿå¤´é˜»å¡é—®é¢˜ã€‚\n\n\nHTTPSï¼š\n\nTLS/SSL æ¡æ‰‹è¿‡ç¨‹ï¼š å¯¹ç§°åŠ å¯† vs éå¯¹ç§°åŠ å¯†åœ¨æ¡æ‰‹ä¸­æ˜¯å¦‚ä½•é…åˆçš„ï¼ŸCA è¯ä¹¦çš„ä½œç”¨ã€‚\n\n\nGET vs POSTï¼š å¹‚ç­‰æ€§ã€å®‰å…¨æ€§ã€ä¼ å‚æ–¹å¼çš„åŒºåˆ«ã€‚\n\n3. å¸¸è§ç½‘ç»œæ”»å‡»\n\nDDoSã€SYN Floodï¼ˆåŠè¿æ¥é˜Ÿåˆ—ï¼‰ã€XSSã€CSRFã€‚\n"},"è¯¾ç¨‹ç¬”è®°/è®¡ç®—æœºç½‘ç»œ/æœŸæœ«å¤ä¹ -é€‰æ‹©":{"slug":"è¯¾ç¨‹ç¬”è®°/è®¡ç®—æœºç½‘ç»œ/æœŸæœ«å¤ä¹ -é€‰æ‹©","filePath":"è¯¾ç¨‹ç¬”è®°/è®¡ç®—æœºç½‘ç»œ/æœŸæœ«å¤ä¹ -é€‰æ‹©.md","title":"æœŸæœ«å¤ä¹ -é€‰æ‹©","links":[],"tags":[],"content":"chapter1 intro\nOSI\ncentralconcepts\nservices ä¸‹å±‚ä¸ºä¸Šå±‚æä¾›çš„æœåŠ¡\ninterfaces ä¸Šä¸‹å±‚ä¹‹é—´æ²Ÿé€šçš„æ¥å£\nprotocols åŒä¸€å±‚ä¹‹é—´æ²Ÿé€šçš„åè®®\n\nç‰©ç†å±‚ (Physical): æ¯”ç‰¹ (Bits)ã€ç½‘çº¿ã€å…‰çº¤ã€‚ä¼ çš„æ˜¯åŸå§‹çš„æ¯”ç‰¹æµï¼ˆ010101ï¼‰ï¼Œå› ä¸ºç”µç¼†å¯èƒ½ä¼šæœ‰å¹²æ‰°ï¼Œä¼ è¿‡æ¥çš„æ•°æ®å¯èƒ½æ˜¯ä¹±çš„ï¼ˆæœ‰å™ªå£°ï¼‰ã€‚\næ•°æ®é“¾è·¯å±‚ (Data Link): å¸§ (Frames)ã€MAC åœ°å€ã€ç›¸é‚»èŠ‚ç‚¹ä¼ è¾“ã€å·®é”™æ£€æµ‹ã€‚è´Ÿè´£æŠŠè¿™äº›æ¯”ç‰¹æ‰“åŒ…æˆ å¸§ (Frame)ï¼Œå¹¶è¿›è¡Œå·®é”™æ£€æµ‹ï¼ˆæ¯”å¦‚ CRC æ ¡éªŒï¼‰ã€‚å¦‚æœå‘ç°é”™äº†ï¼Œå®ƒå¯èƒ½ä¼šè¦æ±‚é‡ä¼ æˆ–è€…ä¸¢å¼ƒï¼Œä»è€Œç»™ä¸Šå±‚æä¾›ä¸€ä¸ªç›¸å¯¹é è°±çš„é“¾è·¯\nç½‘ç»œå±‚ (Network): åŒ… (Packets)ã€IP åœ°å€ã€è·¯ç”± (Routing)ã€æºåˆ°ç›®çš„ã€‚\nä¼ è¾“å±‚ (Transport): æ®µ (Segments)ã€ç«¯å£å·ã€ç«¯åˆ°ç«¯ (End-to-End)ã€å¯é æ€§ (TCP)ã€‚\nä¼šè¯å±‚ (Session): ä¼šè¯ç®¡ç† (å»ºç«‹/æ–­å¼€è¿æ¥)ã€‚\nè¡¨ç¤ºå±‚ (Presentation): è¯­æ³•ä¸è¯­ä¹‰ (Syntax &amp; Semantics)ã€åŠ å¯†ã€å‹ç¼©ã€æ ¼å¼è½¬æ¢ã€‚\nåº”ç”¨å±‚ (Application): ç”¨æˆ·æ¥å£ã€HTTPã€Emailã€‚\nå¤±è´¥åŸå› ï¼štiming technology implementations politics\nä¸»è¦æ˜¯å¤æ‚æ€§ æ—¶æœºå’Œç”Ÿæ€ å’Œpriceæ²¡å…³ç³»\n\n\nqueuing delay æ•°æ®åŒ…åœ¨è·¯ç”±å™¨é‡Œæ’é˜Ÿç­‰å¾…å¤„ç†çš„æ—¶é—´ï¼Œæ’é˜Ÿå»¶è¿Ÿï¼Œå¹¶ä¸æ˜¯ä¼ è¾“æœºåˆ¶\nstore and forward transmission ç°ä»£åˆ†ç»„äº¤æ¢ç½‘ç»œæœ€æ ¸å¿ƒçš„å·¥ä½œæœºåˆ¶\npacket switching æŠŠæ•°æ®åˆ‡æˆpacketæ¥ä¼ ï¼Œåˆ†ç»„äº¤æ¢ç½‘ç»œé€šå¸¸ä½¿ç”¨å­˜å‚¨è½¬å‘ã€‚\npropagation ä¼ æ’­ ä¿¡å·åœ¨ç”µçº¿ã€å…‰çº¤é‡Œè·‘çš„æ—¶é—´\n\nEncapsulation\næ¯å±‚è¿›è¡Œå°è£…\nchapter2ç‰©ç†å±‚\nå¤šè·¯å¤ç”¨æŠ€æœ¯\nFDM frequency division multiplexing é¢‘åˆ†å¤ç”¨\næ”¶éŸ³æœº simultaneous different frequencieså¤ç”¨ä¸åŒé¢‘ç‡\nTDM æ—¶åˆ†å¤ç”¨ time å¤§å®¶å…±ç”¨å…¨éƒ¨å¸¦å®½ ä½†æ˜¯å¿…é¡»è½®æµè®²\nWDMæ³¢åˆ†æœç”¨ ä¸“æŒ‡å…‰ä¿¡å·åœ¨å…‰çº¤ä¸­ä¼ æ’­ã€‚\nCDM (ç åˆ†å¤ç”¨) ç”¨æ•°å­¦ç¼–ç åŒºåˆ†ï¼Œå¤§å®¶åŒæ—¶åŒé¢‘è¯´è¯ï¼Œä½†åªæœ‰ç‰¹å®šçš„è§£ç å™¨èƒ½å¬æ‡‚ã€‚\nè®¡ç®—channel capacity/maximum data rate\nnyquist æ— å™ªå£° æˆ–è€…ç»™äº†ä¿¡å·çº§æ•°(å¦‚æœæœ‰16çº§ å°±è¦ç”¨4ä½æ¥è¡¨ç¤º)\næ•°æ®ä¼ è¾“ç‡=2B(å¸¦å®½)*log2V\né¦™å†œå®šç†shannon\nC = B \\times \\log_2(1 + S/N) è¿™é‡Œæ˜¯ä¿¡å™ªæ¯”\nMæ˜¯10çš„6æ¬¡æ–¹\n\nåˆ†è´:db=10log10s/n å°±æ˜¯è¯´ å¦‚æœç»™äº†db=30 é‚£ä¹ˆlog10s/nå°±æ˜¯3 s/nå°±æ˜¯ä¸€åƒ\nåˆ†ç»„äº¤æ¢\nç”µè·¯äº¤æ¢ è€å¼ç”µè¯ç½‘ æ‰“ç”µè¯å‰å…ˆæ‹¨å·å»ºç«‹çº¿è·¯\næŠ¥æ–‡äº¤æ¢ ç”µæŠ¥æ—¶ä»£çš„äº§ç‰©,æ•´ä¸ªæŠ¥æ–‡å‘åˆ°ä¸­è½¬ç«™,å­˜ä¸‹æ¥å†å‘ç»™ä¸‹ä¸€ç«™\næ•°æ®é“¾è·¯å±‚åè®®:\n\nHDLC high-level data link control å¹¿åŸŸç½‘ç‚¹å¯¹ç‚¹è¿æ¥ æ•°æ®é“¾è·¯å±‚\nSDLC ä¸€èˆ¬æœ‰DLCçš„éƒ½æ˜¯datalink control\nPPP å±äºæ•°æ®é“¾è·¯å±‚ pointtopoint\n\nç½‘ç»œå±‚:\nIP/ICMP/ARP\næœ€è‘—åçš„å°±æ˜¯pingå‘½ä»¤,æ˜¯è¢«å°è£…åœ¨ipåŒ…é‡Œçš„\nä¿¡é“çš„æ•°æ®ä¼ è¾“é€Ÿç‡ä¹Ÿå°±æ˜¯capacity (æ•°å­—å¸¦å®½å°±æ˜¯datarateä¼ è¾“é€Ÿç‡,æ¨¡æ‹Ÿå¸¦å®½æ˜¯é¢‘å¸¦å®½åº¦hz)\nä¸€ç§’é’Ÿèƒ½å¹¶è¡Œé€šè¿‡å¤šå°‘è¾†è½¦ï¼ˆååé‡/é€Ÿç‡ï¼‰ æ˜¯ç”±è½¦é“æ•°é‡å†³å®šçš„ï¼Œè€Œä¸æ˜¯è½¦é€Ÿå†³å®šçš„ã€‚\nV (Level) æˆ– Modulation rate: è°ƒåˆ¶é€Ÿç‡ï¼ˆæ³¢ç‰¹ç‡ï¼‰ï¼Œå®ƒå†³å®šäº†æ¯ç§’èƒ½å˜å¤šå°‘æ¬¡ï¼Œè¿›è€Œå½±å“èƒ½ä¼ å¤šå°‘ bit\nWhich one can be used as a key component of optical transmission system? å…‰ä¼ è¾“ç³»ç»Ÿçš„å…³é”®ç»„ä»¶\nUDP unshielded twistedpair éå±è”½åŒç»çº¿ æ™®é€šç½‘çº¿ ç”µä¿¡å·\nsemiconductor laser device åŠå¯¼ä½“æ¿€å…‰å™¨æ‰å¯ä»¥å‘é€å…‰æº\nHUB ç½‘ç»œè¿æ¥è®¾å¤‡ ç”µä¿¡å·\nwifi router æ— çº¿ç”µè®¾å¤‡ å‘é€çš„æ˜¯æ— çº¿ç”µæ³¢\nThe Public Switched Telephone Network\nPSTN\nlocal loop æœ¬åœ°å›è·¯ è¿æ¥ä½ å®¶å’Œæœ€è¿‘çš„ç”µè¯å±€ é“œçº¿ (Twisted Pair) æ˜¯æœ‰çº¿çš„\nâ€Toll officeâ€ å’Œ â€œEnd officeâ€ ç«¯å±€å°±æ˜¯ç¦»ä½ æœ€è¿‘çš„ç”µè¯å±€ tollå°±æ˜¯æ±‡æ¥å±€,è¿æ¥ä¸åŒç”µè¯å±€çš„ ä¸­é—´æ˜¯trunkä¸­ç»§çº¿\næœ‰çº¿çš„æŸä¼¤:\nDifferent Fourier components propagating at different speed ä¸åŒé¢‘ç‡ä¼ æ’­é€Ÿåº¦ä¸åŒ,å«åšdistortionå¤±çœŸ\nthermal noise çƒ­å™ªå£°æ‰€æœ‰ç”µå­è®¾å¤‡å’Œç”µçº¿éƒ½æœ‰è¿™ä¸ªé—®é¢˜ åªè¦æœ‰æ¸©åº¦ç”µå­å°±ä¼šäº§ç”Ÿå™ªéŸ³\nCrosstalk between two close wires çº¿é—´ä¸²æ‰° ä¹Ÿæ˜¯åŒç»çº¿æ„Ÿåº”çš„é—®é¢˜\næ— çº¿:\nmultipath fading å¤šå¾„è¡°è½\\é˜´å½±æ•ˆåº”\nè½½æ³¢è®¡ç®—\nT1channelæ˜¯åŒ—ç¾å’Œæ—¥æœ¬ä½¿ç”¨çš„æ•°å­—é€šä¿¡æ ‡å‡† 24å¤ç”¨è·¯æ•°,æ¯è·¯8bit*24è·¯ 192bits æ¯å¸§åŠ ä¸€ä¸ªbitç”¨æ¥åŒæ­¥ 193bits ç„¶åæ¯ç§’è¦ä¼ 8000å¸§,1.544 Mbps\nä¸­å›½ç”¨çš„æ˜¯E1 2.048Mbps\nä¸€è·¯PCMä¿¡å·çš„é€Ÿç‡æ˜¯4kbps ä¹Ÿå«DS0\n2.5 Gbps: å…‰çº¤ç½‘ç»œï¼ˆå¦‚ OC-48ï¼‰çš„é€Ÿç‡çº§åˆ«\nchapter3 æ•°æ®é“¾è·¯å±‚\næ¯”ç‰¹å¡«å……\nHDLC (High-Level Data Link Control - é«˜çº§æ•°æ®é“¾è·¯æ§åˆ¶) åè®®ä¸­çš„é€æ˜ä¼ è¾“æœºåˆ¶\nåœ¨ PPP æ ‡å‡†å¸§ä¸­ï¼š\n\nAddress æ°¸è¿œæ˜¯ 0xFF (è¡¨ç¤ºå¹¿æ’­/æ‰€æœ‰äºº)ã€‚\nControl æ°¸è¿œæ˜¯ 0x03 (è¡¨ç¤ºæ— ç¼–å·å¸§)ã€‚\næ‰€ä»¥è¿™ä¸¤ä¸ªå­—æ®µæ˜¯å¯ä»¥çœç•¥çš„\n\nCRC å¾ªç¯å†—ä½™æ ¡éªŒ\næ³¨æ„æ˜¯å¼‚æˆ–é™¤æ³•!è€Œä¸”æ˜¯é¦–ä½1å°±å¯ä»¥\nVLANçš„æ„å»ºæ–¹æ³•\n\nåŸºäºç«¯å£\nåŸºäºmacåœ°å€\nåŸºäºç½‘ç»œå±‚åè®®,æ¯”å¦‚ï¼šâ€œæ‰€æœ‰å‘ IPv4 åè®®çš„åŒ…å» VLAN 10ï¼Œå‘ IPv6 åè®®çš„åŒ…å» VLAN 20â€ã€‚\n\næµ·æ˜ç \n\nï¼ˆçº é”™åŠå¾„ t=3ï¼‰ï¼š æˆ‘æœ€å¤šåªèƒ½é”™ 3 ä½ï¼Œå†é”™æˆ‘å°±å›ä¸æ¥äº†ã€‚\\rightarrow è¿™å«çº é”™èƒ½åŠ›ï¼Œä¹Ÿå°±æ˜¯â€œå®‰å…¨åŠå¾„â€ã€‚\nä¹¦ä¸Šçš„å®šä¹‰ï¼ˆæœ€å°è·ç¦» d=7ï¼‰ï¼š ä¸ºäº†è®©ä½ é”™ 3 ä½è¿˜èƒ½æ‰¾å›æ¥ï¼Œæ­£ç¡®çš„ç­”æ¡ˆ A å’Œ æ­£ç¡®çš„ç­”æ¡ˆ B ä¹‹é—´ï¼Œå¿…é¡»è‡³å°‘éš”å¼€ 7 æ­¥è¿œã€‚ è¿™é‡Œéœ€è¦+1\nç„¶åèƒ½æ£€é”™çš„ä½æ•°å°±æ˜¯è·ç¦»-1\n\nGBN\nå›é€€N   å…¶ä¸­ N ä»£è¡¨ sending window çš„å¤§å°ï¼Œè€Œè¿™ç§åè®®ä¸­ receiving window çš„å¤§å°å§‹ç»ˆä¸º 1\nå‘é€çª—å£å¿…é¡»æ¯”åºå·æ€»æ•°(2çš„næ¬¡æ–¹)å°‘ 1 è¿™æ ·èƒ½ä¿è¯åºå·ä¸é‡å¤.å› ä¸ºä½ å‘å®Œä¸€è½®çš„ä¸‹ä¸€ä¸ªå‘0 å’Œackä¸¢äº†å¯¼è‡´éœ€è¦é‡ä¼ 0ä¼šé‡å¤.\né€‰æ‹©é‡ä¼ åè®®SR\né€šå¸¸åœ¨é€‰æ‹©é‡ä¼ åè®®ä¸­ï¼Œä¸ºäº†æ•ˆç‡æœ€å¤§åŒ–ï¼Œå‘é€çª—å£å’Œæ¥æ”¶çª—å£çš„å¤§å°æ˜¯ç›¸ç­‰çš„ï¼Œ\næ¥æ”¶çª—å£çš„å¤§å°ä¸èƒ½å¤§äº åºå·æ€»æ•° 2næ¬¡æ–¹/ 2ã€‚\nPiggybacking\nchapter4 ç½‘ç»œå±‚\né€šè¿‡å•ä¸ªæ–°è·¯ç”±å™¨è¿æ¥çš„ä¸»æœº\nhub å•¥éƒ½éš”ç¦»ä¸äº† å†²çªåŸŸç›¸åŒ å¹¿æ’­åŸŸç›¸åŒ\näº¤æ¢æœº éš”ç¦»å†²çª å†²çªåŸŸä¸åŒï¼ˆæ¯ä¸ªç«¯å£ç‹¬ç«‹ï¼‰ï¼ˆå¹¿æ’­åŸŸç›¸åŒï¼ˆèƒ½å¹¿æ’­çš„èŒƒå›´æ˜¯ä¸€æ ·çš„ï¼‰\nè·¯ç”±å™¨ å†²çªåŸŸä¸åŒï¼ˆæ¯ä¸ªç«¯å£ç‹¬ç«‹ï¼‰ å¹¿æ’­åŸŸä¸åŒï¼ˆåªèƒ½åœ¨ä¸€ä¸ªç½‘ç»œå†…å¹¿æ’­ ä¸åŒç½‘ç»œå¹¿æ’­åŒ…å°±ä¼šéš”ç¦»ï¼‰\nå‘é€æ–¹å‘é€äº†å¸§0~8 ç„¶åç»“æŸçš„æ—¶å€™æ”¶åˆ°äº†å¯¹å¸§135çš„ç¡®è®¤ å‡è®¾æ˜¯å›é€€n ä¸”ç¡®è®¤å·è¡¨ç¤ºæœ€åä¸€ä¸ªæ­£ç¡®æ¥å—æ”¶çš„å¸§å·ï¼Œé‚£ä¹ˆé‡ä¼ çš„ä¸‹ä¸€å¸§æ˜¯6 å‘é€678\næ— çº¿ç½‘ç»œä¸ç”¨cdäº†,å› ä¸ºæ— çº¿ä¿¡å·è¡°å¼±å¤§,è‡ªå·±å¬è‡ªå·±çš„å£°éŸ³å¤ªå¤§,ä¼šæ£€æµ‹ä¸åˆ°å†²çª.å› æ­¤ ä¼šå¯¼è‡´éšè”½æˆ˜é—®é¢˜ hidden terminal ACéƒ½å‘ç»™B,ä½†æ˜¯ACäº’ç›¸å¬ä¸è§å°±ä¼šåœ¨Bå¤„æ’è½¦.æš´éœ²æˆ˜é—®é¢˜ Exposed terminal Bå‘ç»™A Cå¬åˆ°äº†ä¸æ•¢å‘ç»™D å…¶å®ä¸å½±å“çš„\nCSMA/CAæ˜¯ç¢°æ’é¿å…. æ—¢ç„¶æ£€æµ‹ä¸åˆ°å†²çªå°±é¿å…å†²çª\nRTS/CTS\nRTS = Request To Send A è¯´ï¼šâ€œæˆ‘è¦å‘äº†ï¼Œé•¿åº¦æ˜¯ Xâ€ (RTS)ã€‚\nCTS = Clear To Send B è¯´ï¼šâ€œå¥½çš„ï¼Œä½ å‘å§ï¼Œé•¿åº¦æ˜¯ Xâ€ (CTS)ã€‚\nå‘¨å›´çš„äººï¼ˆåŒ…æ‹¬éšè”½ç«™ï¼‰å¬åˆ° RTS æˆ– CTSï¼Œéƒ½çŸ¥é“ç”±äºé•¿åº¦ Xï¼Œè¿™æ®µæ—¶é—´ä¸èƒ½è¯´è¯ï¼ˆNAV å€’è®¡æ—¶ï¼‰ã€‚\n\nå¦‚æœ X æ”¶åˆ°äº† A çš„ RTSï¼Œè¯´æ˜ X åœ¨å‘é€æ–¹ A çš„é™„è¿‘ã€‚è™½ç„¶ X å¯èƒ½å¹²æ‰°ä¸åˆ°æ¥æ”¶æ–¹ Bï¼Œä½†ä¸ºäº†è®© A èƒ½é¡ºåˆ©æ”¶åˆ° B å›å¤çš„ CTSï¼ŒX åº”è¯¥é—­å˜´ã€‚è€Œä¸” RTS é‡ŒåŒ…å«äº† NAVï¼ˆç½‘ç»œåˆ†é…çŸ¢é‡(Network Allocation Vectorï¼‰ï¼Œå‘Šè¯‰å‘¨å›´äººâ€œæˆ‘è¦å çº¿å¤šä¹…â€ï¼Œå¬åˆ°çš„äººéƒ½å¾—æ›´æ–° NAV å¹¶ä¿æŒæ²‰é»˜ã€‚\nå¦‚æœ X æ”¶åˆ°äº† RTSï¼Œä½†æ²¡æ”¶åˆ° CTSï¼Œé‚£ä¹ˆ X å¯ä»¥å‘é€æ•°æ®.æœ‰äº‰è®®ä½†ç†è®ºä¸Šå¯è¡Œçš„åœºæ™¯â€¦X å¬åˆ°äº† A çš„ RTSï¼ˆX é è¿‘ Aï¼‰ï¼Œä½†æ²¡å¬åˆ° B çš„ CTSï¼ˆX è¿œç¦» Bï¼‰è¿™æ„å‘³ç€ï¼šX å‘é€æ•°æ®ä¸ä¼šå¹²æ‰°åˆ° B çš„æ¥æ”¶ï¼ˆå› ä¸ºç¦»å¾—è¿œï¼‰ã€‚è™½ç„¶æ ‡å‡†åè®®é€šå¸¸æ¯”è¾ƒä¿å®ˆï¼ˆå¬åˆ° RTS å°±è®¾ NAVï¼‰ï¼Œä½†åœ¨ç†è®ºåˆ†æä¸­ï¼ŒX ç¡®å®å¯ä»¥å‘é€æ•°æ®è€Œä¸äº§ç”Ÿå†²çªã€‚è¿™ä¸ªé€‰é¡¹é€šå¸¸è¢«è®¤ä¸ºæ˜¯æè¿° CSMA/CA åœ¨ç†æƒ³çŠ¶å†µä¸‹è¯•å›¾è§£å†³çš„é—®é¢˜ï¼Œæˆ–è€…è‡³å°‘å®ƒä¸æ˜¯æœ€æ˜æ˜¾çš„é”™è¯¯ã€‚\nå¦‚æœ X æ²¡æ”¶åˆ° RTSï¼Œä½†æ”¶åˆ°äº† CTSï¼Œé‚£ä¹ˆ X ä¸å¯ä»¥å‘é€æ•°æ®- è¯´æ˜ X åœ¨æ¥æ”¶æ–¹ B çš„é™„è¿‘ï¼ˆæ˜¯ B çš„é‚»å±…ï¼‰ã€‚ B é©¬ä¸Šå°±è¦æ¥æ”¶æ•°æ®äº†ã€‚å¦‚æœ X è¿™æ—¶å€™è¯´è¯ï¼Œä¿¡å·ä¼šç›´æ¥è¦†ç›–æ‰ A å‘ç»™ B çš„æ•°æ®ï¼Œå¯¼è‡´ B æ¥æ”¶å¤±è´¥ï¼ˆè¿™å°±æ˜¯éšè”½ç«™å¹²æ‰°ï¼‰ã€‚\n\nVLAN\nå½“äº¤æ¢æœºé…ç½®åŸºäºç«¯å£çš„vlançš„æ—¶å€™\naccessçº¿è·¯ä¸‹ ä¸€ä¸ªç‰©ç†ç«¯å£åœ¨åŒä¸€æ—¶é—´åªèƒ½å±äºä¸€ä¸ªvlan é€šè¿‡è¿™ä¸ªç«¯å£çš„ä¼šè¢«æ‰“ä¸Švlanæ ‡ç­¾æˆ–è€…æ’•æ‰vlanæ ‡ç­¾ ä¸€èˆ¬æ˜¯pcåˆ°äº¤æ¢æœºä¹‹é—´\ntrunkçº¿è·¯å°±æ˜¯å…è®¸å„ç§vlançš„æ ‡ç­¾é€šè¿‡ ä¹Ÿä¸å¯¹vlanåšä¿®æ”¹.ä½†æ˜¯ä»–æœ¬èº«ä¹Ÿæ˜¯åªæœ‰ä¸€ä¸ªvlançš„\näº¤æ¢æœºè½¬å‘è¡¨\nã€åŠ¨ä½œæ‹†è§£ - ç¬¬ 1 å¸§ã€‘ï¼š\n\nSource (æºåœ°å€)ï¼š A1ï¼ˆåœ¨ç«¯å£ 1ï¼‰ã€‚\nDestination (ç›®çš„åœ°å€)ï¼š C1ï¼ˆåœ¨ç«¯å£ 3ï¼‰ã€‚\nSwitchâ€™s Reaction (äº¤æ¢æœºçš„ååº”)ï¼š\n\nLearning (å­¦ä¹ )ï¼š äº¤æ¢æœºæ”¶åˆ°å¸§ï¼Œçœ‹åˆ°æº MAC æ˜¯ A1ï¼Œæ˜¯ä» Port 1 è¿›æ¥çš„ã€‚äºæ˜¯å®ƒåœ¨è½¬å‘è¡¨é‡Œè®°ä¸‹ä¸€ç¬”ï¼šA1 -&gt; Port 1ã€‚\nLookup (æŸ¥è¡¨)ï¼š äº¤æ¢æœºçœ‹ç›®çš„ MAC æ˜¯ C1ã€‚å»æŸ¥è¡¨ï¼Œå‘ç° è¡¨ä¸­æ²¡æœ‰ C1 çš„è®°å½•ï¼ˆUnknown Unicastï¼ŒæœªçŸ¥å•æ’­å¸§ï¼‰ã€‚\nForwarding (è½¬å‘å†³ç­–)ï¼š å› ä¸ºæ‰¾ä¸åˆ°äººï¼Œåªèƒ½ æ³›æ´ª (Flood)\nResult (ç»“æœ)ï¼š å¸§è¢«å¤åˆ¶å¹¶å‘å¾€é™¤æ¥æºå£ï¼ˆPort 1ï¼‰ä»¥å¤–çš„æ‰€æœ‰æ´»åŠ¨ç«¯å£ã€‚å³ Port 2, 3ã€‚\nã€è€ƒè¯•å…³é”®è¯è§£æã€‘ï¼š\n\n\nConfirmation frameï¼š é€šå¸¸æŒ‡ ACK å¸§ï¼Œåæ­£å°±æ˜¯å›ä¿¡ã€‚è¿™æ„å‘³ç€è§’è‰²äº’æ¢äº†ï¼šC å˜æˆäº†å‘é€æ–¹ï¼ŒA å˜æˆäº†æ¥æ”¶æ–¹ã€‚\nã€åŠ¨ä½œæ‹†è§£ - ç¬¬ 2 å¸§ã€‘ï¼š\nSource (æºåœ°å€)ï¼š C1ï¼ˆåœ¨ç«¯å£ 3ï¼‰ã€‚\nDestination (ç›®çš„åœ°å€)ï¼š A1ï¼ˆåœ¨ç«¯å£ 1ï¼‰ã€‚\nSwitchâ€™s Reaction (äº¤æ¢æœºçš„ååº”)ï¼š\n\nLearning (å­¦ä¹ )ï¼š äº¤æ¢æœºæ”¶åˆ°å¸§ï¼Œçœ‹åˆ°æº MAC æ˜¯ C1ï¼Œæ˜¯ä» Port 3 è¿›æ¥çš„ã€‚äºæ˜¯å®ƒåœ¨è¡¨é‡Œè®°ä¸‹ä¸€ç¬”ï¼šC1 -&gt; Port 3ã€‚ï¼ˆæ­¤æ—¶è¡¨é‡Œæœ‰ A, B, C ä¸‰ä¸ªäººäº†ï¼‰ã€‚\nLookup (æŸ¥è¡¨)ï¼š äº¤æ¢æœºçœ‹ç›®çš„ MAC æ˜¯ A1ã€‚å»æŸ¥è¡¨ï¼Œå‘ç° è¡¨ä¸­æœ‰ A1 çš„è®°å½•ï¼\n\nä¸ºä»€ä¹ˆæœ‰ï¼Ÿ å› ä¸ºåœ¨â€œç¬¬äºŒå¥â€é‡Œï¼Œäº¤æ¢æœºåˆšåˆšé€šè¿‡ A å‘æ¥çš„å¸§å­¦ä¼šäº† A åœ¨ Port 1ã€‚\n\n\nForwarding (è½¬å‘å†³ç­–)ï¼š æ—¢ç„¶è®¤è¯†è·¯ï¼Œé‚£å°± å•æ’­ (Unicast)ã€‚\nResult (ç»“æœ)ï¼š å¸§åªä¼šè¢«å‘å¾€ Port 1ã€‚\n\n\n\nchapter5\nWhich is not the private address that will not appear in Internet datagram?â€œ\nprivate address:\n\nClass A: 10.0.0.0 åˆ° 10.255.255.255\nClass B: 172.16.0.0 åˆ° 172.31.255.255 ï¼ˆæ³¨æ„è¿™ä¸ªèŒƒå›´ï¼ï¼‰\nClass C: 192.168.0.0 åˆ° 192.168.255.255\nè¿™äº›èŒƒå›´ä»¥å¤–çš„éƒ½æ˜¯å…¬ç½‘åœ°å€\n\nipv6åœ°å€æ ¼å¼\n\nIPv6 Addressï¼š é•¿ 128 ä½ã€‚é€šå¸¸å†™æˆ 8 ç»„ï¼Œæ¯ç»„ 4 ä¸ªåå…­è¿›åˆ¶æ•°ï¼Œä¸­é—´ç”¨å†’å· : éš”å¼€ã€‚ä¾‹å¦‚ ABCD:EF01:2345:6789:ABCD:EF01:2345:6789ã€‚\nå‹ç¼©è§„åˆ™ (Zero Compression)ï¼š å¦‚æœæœ‰ä¸€ä¸²è¿ç»­çš„ 0ï¼Œå¯ä»¥ç”¨åŒå†’å· :: ä»£æ›¿ï¼Œä½†åªèƒ½å‡ºç°ä¸€æ¬¡ã€‚\næ··åˆè®°æ³•ï¼š IPv6 ä¹Ÿå¯ä»¥å…¼å®¹ IPv4 çš„å†™æ³•ï¼Œæ¯”å¦‚ ::192.168.0.1ï¼Œè¿™å« IPv4-mapped IPv6 addressã€‚\nå‰96ä¸º0 å32ä½æ˜¯ipv4\n\nè·¯ç”±åè®®\nä¸‹åˆ—éƒ½æ˜¯åŠ¨æ€çš„ dynamic routing protocol\nIGP interior gateway protocol å†…éƒ¨ç½‘å…³åè®® åœ¨åŒä¸€ä¸ªè‡ªæ²»ç³»ç»ŸASå†…éƒ¨ä½¿ç”¨çš„åè®® åŒ…æ‹¬\n\n\nrouting information protocol è·¯ç”±ä¿¡æ¯åè®® RIP\n\n\nOSPF\nEGP å¤–éƒ¨ç½‘å…³åè®®\n\n\nè·ç¦»å‘é‡:RIPçš„ç®—æ³•ç±»å‹,é€šè¿‡è·³æ•°è¡¡é‡è·ç¦» æ¯éš”30ç„æŠŠè‡ªå·±çš„æ•´ä¸ªè·¯ç”±è¡¨å‘ç»™é‚»å±…\n\n\nlinkstate OSPFçš„ç®—æ³•ç±»å‹ åªå‘é“¾è·¯çŠ¶æ€ä¿¡æ¯æ¥ç”»åœ°å›¾\n\n\nä¸ºäº†è®©æ•°æ®åŒ…ä»ä¸€ä¸ª å±€åŸŸç½‘ (LAN) ä¼ è¾“åˆ° äº’è”ç½‘ (Internet)ï¼Œéœ€è¦ä¸‹åˆ—å“ªç§è®¾å¤‡ï¼Ÿ\nA. Bridge (ç½‘æ¡¥) / C. Switch (äº¤æ¢æœº) / D. Hub (é›†çº¿å™¨)ï¼š\n\nè¿™ä¸‰ä¸ªéƒ½æ˜¯ Layer 2 (æ•°æ®é“¾è·¯å±‚) æˆ– Layer 1 (ç‰©ç†å±‚) çš„è®¾å¤‡ã€‚\nå®ƒä»¬åªè®¤è¯† MAC åœ°å€ï¼Œåªèƒ½åœ¨åŒä¸€ä¸ªç½‘ç»œå†…éƒ¨å€’è…¾æ•°æ®ã€‚å®ƒä»¬å‡ºä¸äº†â€œæ‘â€ã€‚\n\nrouteræ‰å¯ä»¥è¿æ¥ä¸åŒçš„ç½‘ç»œ\né“¾è·¯çŠ¶æ€è·¯ç”±çš„ç‰¹ç‚¹\nLink-State (é“¾è·¯çŠ¶æ€ï¼Œå¦‚ OSPF)ï¼š\n\næ¯ä¸ªäººéƒ½ç”»ä¸€å¼ å®Œæ•´çš„åœ°å›¾ï¼ˆæ‹“æ‰‘å›¾ï¼‰ã€‚\nè·¯ç”±å™¨ä¹‹é—´äº¤æ¢çš„æ˜¯ LSA (é“¾è·¯çŠ¶æ€é€šå‘Š)ï¼Œå³â€œæˆ‘æ˜¯è°ï¼Œæˆ‘é‚»å±…æ˜¯è°ï¼Œè·¯è´¹å¤šå°‘â€ã€‚\nå…³é”®ç‚¹ï¼š æˆ‘åªå‘Šè¯‰ä½ æˆ‘çš„å±€éƒ¨ä¿¡æ¯ï¼Œä½†æˆ‘ä¼šæŠŠè¿™ä¸ªä¿¡æ¯å‘Šè¯‰å…¨ç½‘æ‰€æœ‰äººï¼ˆæ³›æ´ªï¼‰ã€‚\n\nDistance Vector (è·ç¦»å‘é‡ï¼Œå¦‚ RIP)ï¼š\n\nè°£è¨€è·¯ç”±ï¼š æˆ‘ä¸ç”»åœ°å›¾ï¼Œæˆ‘åªå¬é‚»å±…è¯´â€œå»åŒ—äº¬åªè¦ 3 è·³â€ã€‚\nå…³é”®ç‚¹ï¼š æˆ‘æŠŠæˆ‘çš„æ•´ä¸ªè·¯ç”±è¡¨ï¼ˆæˆ‘çŸ¥é“çš„æ‰€æœ‰è·¯ï¼‰äº¤æ¢ç»™æˆ‘çš„é‚»å±…ã€‚\n\nç¬¬ä¸€æ­¥ï¼šæ‰“æ‹›å‘¼ (Hello)\nåˆšå¼€ï¼Œè·¯ç”±å™¨é€šè¿‡å‘ Hello åŒ… å‘ç°èº«è¾¹çš„ç›´è¿é‚»å±…ã€‚\nç»“æœï¼šæˆ‘çŸ¥é“è°åœ¨æˆ‘éš”å£ï¼Œä»¥åŠæˆ‘å’Œä»–ä¹‹é—´çš„è·¯å†µï¼ˆCost/Metricï¼‰ã€‚\nç¬¬äºŒæ­¥ï¼šå†™æ—¥è®° (LSA - Link State Advertisement)\næ¯ä¸ªè·¯ç”±å™¨å†™ä¸€å¼ â€œå°çº¸æ¡â€ï¼ˆè¿™å°±æ˜¯ é“¾è·¯çŠ¶æ€é€šå‘Š LSAï¼‰ã€‚\nå†…å®¹ï¼šâ€œæˆ‘æ˜¯è·¯ç”±å™¨ Xï¼Œæˆ‘çš„é‚»å±…æœ‰ Y å’Œ Zï¼Œæˆ‘å’Œ Y çš„è·ç¦»æ˜¯ 10ï¼Œå’Œ Z çš„è·ç¦»æ˜¯ 5ã€‚â€\næ³¨æ„ï¼šæˆ‘åªæè¿°æˆ‘è‡ªå·±çš„å±€éƒ¨è§†é‡ã€‚\nç¬¬ä¸‰æ­¥ï¼šæ³›æ´ª (Flooding)\næœ€å…³é”®çš„ä¸€æ­¥ï¼å¤§å®¶æŠŠè‡ªå·±çš„â€œå°çº¸æ¡â€å‘ç»™æ‰€æœ‰äººã€‚\nè·¯ç”±å™¨æ”¶åˆ°åˆ«äººçš„ LSA åï¼Œå…ˆå­˜ä¸€ä»½ï¼Œç„¶åç«‹å³è½¬å‘ç»™å®ƒçš„é‚»å±…ï¼ˆé™¤äº†å‘ç»™å®ƒçš„é‚£ä¸ªï¼‰ã€‚\nç»“æœï¼šä¸€ä¼ åï¼Œåä¼ ç™¾ï¼Œåªè¦ç½‘ç»œæ˜¯é€šçš„ï¼Œæœ€ç»ˆå…¨ç½‘æ‰€æœ‰è·¯ç”±å™¨éƒ½ä¼šæ”¶åˆ°æ‰€æœ‰å…¶ä»–äººå†™çš„çº¸æ¡ã€‚\nç¬¬å››æ­¥ï¼šæ‹¼åœ°å›¾ (LSDB - Link State Database)\næ¯ä¸ªè·¯ç”±å™¨æŠŠæ”¶é›†åˆ°çš„æˆç™¾ä¸Šåƒå¼  LSA æ±‡æ€»åœ¨ä¸€èµ·ï¼Œå½¢æˆä¸€ä¸ª é“¾è·¯çŠ¶æ€æ•°æ®åº“ (LSDB)ã€‚\né‡ç‚¹ï¼šæ­¤æ—¶ï¼Œå…¨ç½‘æ‰€æœ‰è·¯ç”±å™¨çš„ LSDB æ˜¯å®Œå…¨ä¸€æ ·çš„ï¼ˆä¹Ÿå°±æ˜¯å¤§å®¶éƒ½æ‹¥æœ‰äº†åŒä¸€ä»½å®Œæ•´çš„ç½‘ç»œæ‹“æ‰‘å›¾æ•°æ®ï¼‰ã€‚\nç±»æ¯”ï¼šæ¯ä¸ªäººæ‰‹é‡Œéƒ½æ‹¿åˆ°äº†åŒä¸€ä¸ªè¿·å®«çš„å®Œæ•´å›¾çº¸ã€‚\nç¬¬äº”æ­¥ï¼šç®—è·¯å¾„ (Dijkstra / SPF ç®—æ³•)\næœ‰äº†å®Œæ•´åœ°å›¾ï¼ˆLSDBï¼‰ï¼Œæ¯ä¸ªè·¯ç”±å™¨ä»¥è‡ªå·±ä¸ºæ ¹ (Root)ï¼Œç‹¬ç«‹è¿è¡Œ Dijkstra æœ€çŸ­è·¯å¾„ä¼˜å…ˆç®—æ³• (SPF)ã€‚\nè®¡ç®—å‡ºä»â€œæˆ‘â€å‡ºå‘ï¼Œå»å¾€ç½‘ç»œä¸­æ¯ä¸€ä¸ªèŠ‚ç‚¹çš„æœ€çŸ­æ ‘ã€‚\næœ€åä¸€æ­¥ï¼šæŠŠç®—å‡ºæ¥çš„æœ€ä¼˜è·¯å¾„ï¼Œå¡«å…¥è‡ªå·±çš„è·¯ç”±è¡¨ã€‚\nCIDR(Classless Inter-Domain Routing)æ— ç±»åˆ«åŸŸé—´è·¯ç”± æ˜¯ä¸€ç§æ›´çµæ´»çš„ipåœ°å€åˆ†é…å’Œç®¡ç†æ–¹æ³•\nå› ä¸º CIDR å…è®¸æˆ‘ä»¬å°†å¾ˆå¤šé›¶æ•£çš„å°ç½‘æ®µï¼Œèšåˆ (Aggregate) æˆä¸€ä¸ªå¤§ç½‘æ®µå‘Šè¯‰å…¨ä¸–ç•Œã€‚\n\nå®ƒæ¶ˆç­äº† A/B/C ç±»ï¼šä¸å†çœ‹ IP å¼€å¤´æ˜¯å‡ æ¥åˆ¤æ–­ç±»åˆ«ã€‚\nçœ‹æ©ç /æ–œçº¿ï¼šæ©ç é‡Œæœ‰å¤šå°‘ä¸ª 1ï¼ˆæˆ–è€…æ–œçº¿åçš„æ•°å­—æ˜¯å‡ ï¼‰ï¼Œç½‘ç»œå·é•¿åº¦å°±æ˜¯å¤šå°‘ä½ã€‚\nä¸¾ä¾‹ï¼š å¦‚æœä¸é€‚ç”¨ CIDRï¼Œè·¯ç”±å™¨å¯èƒ½éœ€è¦è®°å½• 4 æ¡è·¯ï¼š\n\n\nå» 192.168.0.0 çš„èµ°å·¦è¾¹\nå» 192.168.1.0 çš„èµ°å·¦è¾¹\nå» 192.168.2.0 çš„èµ°å·¦è¾¹\nå» 192.168.3.0 çš„èµ°å·¦è¾¹\næœ‰äº† CIDRï¼Œè·¯ç”±å™¨å¯ä»¥å·æ‡’ï¼ŒæŠŠè¿™ 4 ä¸ª C ç±»åˆå¹¶æˆä¸€æ¡è®°å½•ï¼š\n\n\nâ€œå» 192.168.0.0/22 ï¼ˆæ¶µç›–äº†ä¸Šé¢ 4 ä¸ªï¼‰çš„å…¨éƒ½èµ°å·¦è¾¹ã€‚â€\n\næœ€é•¿å‰ç¼€åŒ¹é…åŸåˆ™ (Longest Prefix Match)\n\nè¿™æ˜¯è·¯ç”±å™¨çš„æ ¸å¿ƒæ³•åˆ™ï¼šå¦‚æœä¸€ä¸ªç›®çš„ IP åŒæ—¶åŒ¹é…äº†è·¯ç”±è¡¨ä¸­çš„å¤šè¡Œï¼Œè·¯ç”±å™¨ä¼šé€‰æ‹©å­ç½‘æ©ç æœ€é•¿ï¼ˆä¹Ÿå°±æ˜¯æ©ç ä¸­ 1 æ›´å¤šã€ç½‘æ®µèŒƒå›´æ›´å°æ›´ç²¾å‡†ï¼‰çš„é‚£ä¸€æ¡è·¯ç”±ã€‚\né»˜è®¤è·¯ç”± 0.0.0.0 çš„æ©ç é•¿åº¦ä¸º 0ï¼Œæ˜¯ä¼˜å…ˆçº§æœ€ä½çš„ä¿åº•é€‰é¡¹ã€‚\n\nARPæ˜¯å·²çŸ¥ipæ‰¾mac RARPæ˜¯åå‘arp å·²çŸ¥macæ‰¾ip\nTracerouteå·¥å…·\nPath (è·¯å¾„) / Routers along the path\nè®¾è®¡ç”¨æ¥æŸ¥æ‰¾ä»ä¸»æœºåˆ°ç›®çš„ IP åœ°å€çš„ è·¯å¾„ä¸Šçš„è·¯ç”±å™¨ (Routers along the path) çš„ï¼ŸTracerouteå·¥å…·\nåˆ©ç”¨çš„æ˜¯IPå¤´é‡Œçš„TTLç”Ÿå­˜æ—¶é—´,å®ƒå…ˆå‘ä¸€ä¸ª TTL=1 çš„åŒ…ï¼Œç¬¬ 1 ä¸ªè·¯ç”±å™¨æ”¶åˆ°å TTL å‡ä¸º 0ï¼Œè·¯ç”±å™¨æŠ¥é”™â€œæˆ‘æ­»äº†â€ï¼Œå‘å›ä¸€ä¸ª ICMP åŒ…ï¼ˆæš´éœ²äº†ç¬¬ 1 ä¸ªè·¯ç”±å™¨çš„ IPï¼‰ã€‚- å†å‘ TTL=2ï¼Œç¬¬ 2 ä¸ªè·¯ç”±å™¨æŠ¥é”™ã€‚\n\nä»¥æ­¤ç±»æ¨ï¼ŒæŠŠæ²¿é€”çš„è·¯ç”±å™¨ä¸€ä¸ªä¸ªâ€œéª—â€å‡ºæ¥ã€‚\n\nNetstate (åº”è¯¥æ˜¯ Netstat)ï¼š ç”¨æ¥æŸ¥çœ‹è‡ªå·±ç”µè„‘ä¸Šçš„ç½‘ç»œè¿æ¥çŠ¶æ€ï¼ˆå¼€äº†å“ªäº›ç«¯å£ï¼‰ã€‚\nIPåè®®ç‰¹æ€§:\nbest effort\nunreliable\nconnectionless\nå°½åŠ›è€Œä¸º ä¸å¯é (tcpè´Ÿè´£)  ,æ— é“¾æ¥(tcpè´Ÿè´£)\nipæœ€å¤§çš„æœ¬äº‹å°±æ˜¯è·¯ç”±\nchapter6\nUDP æ€§æ ¼ï¼š å®ƒæ˜¯ä¸€ä¸ª ä¸å¯é  (Unreliable)ã€æ— è¿æ¥ (Connectionless) çš„åè®®ã€‚\næ€»ä¹‹ä»€ä¹ˆéƒ½ä¸ç”¨ ä»€ä¹ˆéƒ½ä¸ä¿è¯\nTCP\n\nStep 1 (A â†’ B): SYN=1, seq = x (è¿™é‡Œ x=220)ã€‚\n\næ„æ€ï¼šA è¯´â€œæˆ‘æƒ³è¿ä½ ï¼Œæˆ‘çš„èµ·å§‹åºå·æ˜¯ 220â€ã€‚\n\n\nStep 2 (B â†’ A): ï¼ˆæœ¬é¢˜è€ƒç‚¹ï¼ï¼‰\n\nFlags: å¿…é¡»å›åº” SYN=1 (æˆ‘ä¹Ÿæƒ³è¿ä½ ) å’Œ ACK=1 (æˆ‘æ”¶åˆ°ä½ çš„è¯·æ±‚äº†)ã€‚\nack (ç¡®è®¤å·): å¿…é¡»æ˜¯ A çš„åºå· + 1ã€‚\n\nå…¬å¼ï¼šack = x + 1\nè®¡ç®—ï¼š220 + 1 = 221ã€‚\næ„æ€ï¼šâ€œ220 æˆ‘æ”¶åˆ°äº†ï¼Œä¸‹æ¬¡è¯·ç»™æˆ‘å‘ 221â€ã€‚\n\n\nseq (åºå·): B è‡ªå·±çš„èµ·å§‹åºå· yã€‚é€šå¸¸æ˜¯éšæœºçš„ã€‚\n\n\nStep 3 (A â†’ B): ACK=1, seq=x+1, ack=y+1ã€‚\n\nç´¯è®¡ç¡®è®¤\næµé‡æ§åˆ¶:æ»‘åŠ¨çª—å£\n\nTCP å¤´é‡Œæœ‰ä¸€ä¸ªå­—æ®µå« Window Size (RWND, Receive Window)ã€‚\næ¥æ”¶æ–¹åœ¨ç»™å‘é€æ–¹å› ACK çš„æ—¶å€™ï¼Œé¡ºä¾¿åœ¨å¤´é‡Œå¸¦ä¸Šï¼šâ€œæˆ‘çš„ç¼“å­˜åŒºè¿˜èƒ½è£… X ä¸ªå­—èŠ‚â€ã€‚\nå‘é€æ–¹çœ‹åˆ°åï¼Œå°±ä¼šæ§åˆ¶è‡ªå·±ï¼šæœªç¡®è®¤çš„æ•°æ®æ€»é‡ â‡ Xã€‚\nå¦‚æœæ¥æ”¶æ–¹ç¼“å­˜æ»¡äº†ï¼Œå®ƒä¼šå‘ä¸€ä¸ª Window Size = 0 çš„åŒ…ï¼Œå‘é€æ–¹å°±ä¼šæš‚åœå‘é€ï¼Œè¿›å…¥ç­‰å¾…çŠ¶æ€ï¼ˆè¿™å°±å«é›¶çª—å£æ¢æµ‹ï¼‰ã€‚\n\næ‹¥å¡æ§åˆ¶ congesion\næœºåˆ¶ï¼šå‘é€æ–¹è‡ªå·±ç»´æŠ¤ä¸€ä¸ªå˜é‡å« CWND (Congestion Window)ã€‚å‘é€æ–¹å®é™…èƒ½å‘çš„çª—å£å¤§å° = min(RWND, CWND)ï¼ˆå–æ¥æ”¶æ–¹èƒ½åŠ›å’Œç½‘ç»œèƒ½åŠ›çš„æœ€å°å€¼ï¼‰ã€‚\nå››ä¸ªç»å…¸é˜¶æ®µ (Slow Start &amp; Congestion Avoidance)ï¼š\n\næ…¢å¯åŠ¨ (Slow Start)ï¼š\n\nåˆšå¼€å§‹ä¸çŸ¥é“è·¯å†µï¼Œåªå‘ 1 ä¸ªåŒ…ã€‚æ”¶åˆ° ACK åï¼Œå‘ 2 ä¸ªï¼Œå†å‘ 4 ä¸ªï¼Œ8 ä¸ªâ€¦â€¦ æŒ‡æ•°çº§å¢é•¿ã€‚ç°è±¡ï¼šçª—å£ä» 1 å¼€å§‹ï¼ŒæŒ‡æ•°çº§å¢é•¿ (1, 2, 4, 8â€¦)ã€‚\né€»è¾‘ï¼šå¿«é€Ÿè¯•æ¢ç½‘ç»œçš„åº•çº¿ã€‚\n\n\næ‹¥å¡é¿å… (Congestion Avoidance)ï¼š\n\nå½“å¢é•¿åˆ°ä¸€ä¸ªé˜ˆå€¼ï¼ˆssthreshï¼‰åï¼Œæ”¹ä¸ºçº¿æ€§å¢é•¿ï¼ˆæ¯æ¬¡ +1ï¼‰ã€‚\né€»è¾‘ï¼šå°å¿ƒç¿¼ç¿¼åœ°å¢åŠ ï¼Œé˜²æ­¢çªç„¶å µè½¦ã€‚\n\n\nå¿«é‡ä¼  (Fast Retransmit)ï¼š\n\nå¦‚æœå‘é€æ–¹è¿ç»­æ”¶åˆ° 3 ä¸ªé‡å¤çš„ ACKï¼ˆæ¯”å¦‚è¿ç»­ 3 æ¬¡ ACK 200ï¼‰ï¼Œè¯´æ˜ 200 ä¸¢äº†ï¼Œä½†ç½‘ç»œæ²¡æ–­ï¼ˆå› ä¸ºåé¢çš„ ACK è¿˜èƒ½å›æ¥ï¼‰ã€‚\nç«‹å³é‡ä¼  200ï¼Œä¸éœ€è¦ç­‰è¶…æ—¶å®šæ—¶å™¨ã€‚\n\n\nå¿«æ¢å¤ (Fast Recovery)ï¼š\n\nå‘ç”Ÿäº†å¿«é‡ä¼ ï¼Œè¯´æ˜ç½‘ç»œæœ‰ç‚¹å µï¼Œä½†æ²¡æ­»é€ã€‚äºæ˜¯æŠŠå‘é€é€Ÿåº¦å‡åŠï¼ˆè€Œä¸æ˜¯å½’é›¶ï¼‰ï¼Œç„¶åç»§ç»­çº¿æ€§å¢é•¿ã€‚\n\n\n\n\nè®¾å®šé˜ˆå€¼ (ssthresh)ï¼šæ ¹æ®è§„åˆ™ï¼Œé˜ˆå€¼è®¾ä¸ºå½“å‰çª—å£çš„ä¸€åŠã€‚\n\nssthresh = 18 / 2 = 9 KBã€‚\né‡ç½®çª—å£ï¼šå› ä¸ºæ˜¯è¶…æ—¶ï¼ŒCWND ç›´æ¥é‡ç½®ä¸º 1 MSSã€‚\nCWND = 1 KBã€‚\nç„¶åè¿›å…¥é˜¶æ®µï¼šæ…¢å¯åŠ¨ (Slow Start)ã€‚\n\n\nåºåˆ—å·ç©ºé—´æ˜¯åŸºäºå­—èŠ‚çš„ï¼Œè€Œä¸æ˜¯åŸºäºæ®µçš„\nACK åªèƒ½ç¡®è®¤â€œè¿ç»­æ”¶åˆ°çš„æœ€åä¸€ä½â€ã€‚\næ¯”å¦‚100200ä¸¢äº†  200300æ”¶åˆ°äº† é‚£ä¹ˆæ¥ä¸‹æ¥å‘çš„ackåº”è¯¥æ˜¯=100çš„ å› ä¸ºåªèƒ½ç¡®è®¤å‰é¢100 ä¸èƒ½ç¡®è®¤åˆ°300\n\nåŸå› ï¼šTCP æ˜¯ ç‚¹å¯¹ç‚¹ (Point-to-Point) çš„åè®®ã€‚å®ƒå¿…é¡»åœ¨ä¸¤ä¸ªæ˜ç¡®çš„ IP å’Œç«¯å£ä¹‹é—´å»ºç«‹è¿æ¥ã€‚\nå¹¿æ’­ï¼ˆå‘ç»™æ‰€æœ‰äººï¼‰å’Œç»„æ’­ï¼ˆå‘ç»™ä¸€ç»„äººï¼‰æ˜¯ UDP çš„ç‰¹é•¿ï¼ŒTCP åšä¸åˆ°ã€‚\n\n\nchapter7 åº”ç”¨å±‚\nDNS\nDNSè®°å½•æ ¼å¼\nAè®°å½• åŸŸååˆ°ipåœ°å€\nTXTè®°å½• åŸŸååˆ°æ–‡æœ¬å­—ç¬¦ä¸²\nSOAè®°å½• èµ·å§‹æˆæƒæœºæ„ åé¢ä¸€å¤§ä¸²å‚æ•°\nMXè®°å½• mail exchange çš„æ ‡å‡†æ ¼å¼å¿…é¡»åŒ…å«ä¸€ä¸ªä¼˜å…ˆçº§æ•°å­— IN MX 10 é‚®ä»¶æœåŠ¡å™¨åŸŸå\nresolver è§£æå™¨\nclient\nlocal name server æœ¬åœ°åŸŸåæœåŠ¡å™¨: é€šå¸¸ç”±ä½ çš„ ISPï¼ˆç”µä¿¡/ç§»åŠ¨ï¼‰æˆ–è€…å­¦æ ¡ç½‘ç»œä¸­å¿ƒè‡ªåŠ¨åˆ†é…ç»™ä½ ï¼ˆæ¯”å¦‚æµ™å¤§çš„ DNSï¼‰ï¼Œæˆ–è€…ä½ è‡ªå·±æŒ‡å®šçš„ï¼ˆæ¯”å¦‚ Google çš„ 8.8.8.8ï¼‰ã€‚\nroot/TLDserver Top-Level Domain æ ¹æœåŠ¡å™¨å’Œé¡¶çº§åŸŸåæœåŠ¡å™¨\nAuthoritative Name Server (æƒå¨åç§°æœåŠ¡å™¨\n\nç”µè„‘å†…éƒ¨è§£æå™¨å¯¹localnameserverè¯´ æŸ¥è¯¢www.google.com çš„ IP.è¿™æ˜¯recursive query\nç„¶ålocalname serverå¼€å§‹æŸ¥è¯¢,\nè¿™é‡Œæ˜¯è¿­ä»£çš„ è™½ç„¶å¾—çŸ¥äº†ä¿¡æ¯ ä½†ä¸‹ä¸€ä¸ªçº§åˆ«çš„dnsè¿˜æ˜¯éœ€è¦local name serverå»è¯¢é—®\n\næ‰¾æ ¹æœåŠ¡å™¨ ç„¶åä»åé¢å¼€å§‹ä¸€éƒ¨åˆ†ä¸€éƒ¨åˆ†æ‰¾:å…ˆæ‰¾.com\n.comé¡¶çº§åŸŸåæœåŠ¡å™¨ æ‰¾google.com\ngoogle.comçš„æƒå¨æœåŠ¡å™¨:www.google.comçš„ipæ˜¯xxxxxx\n\nç„¶ålocalnameserverå†è¿”å›ç»™client åŒæ—¶è¿™ä¸ªä¼šè¢«è®°åœ¨cacheé‡Œé¢\nåº”ç”¨å±‚åè®®åŠå…¶å¯¹åº”ç«¯å£å·\nç”µå­é‚®ä»¶ç±»:\nSMTP simple mail transfer protocol 25 TCP å‘é‚®ä»¶\nPOP3 post office protocol v3 110 TCP æ”¶é‚®ä»¶ç‰¹ç‚¹æ˜¯â€œä¸‹è½½å¹¶åˆ é™¤â€ï¼ˆé»˜è®¤ï¼‰ï¼Œå¯¹å¤šè®¾å¤‡åŒæ­¥ä¸å‹å¥½ã€‚\nIMAP internet message access protocol 143 TCP æ”¶é‚®ä»¶ç‰¹ç‚¹æ˜¯â€œåŒæ­¥â€ï¼Œé‚®ä»¶ä¿å­˜åœ¨æœåŠ¡å™¨ä¸Šï¼Œæ¯” POP3 æ›´å¼ºã€‚\nè¿œç¨‹è¿æ¥ç±»:\ntelnet telecommunication network 23 TCP è¿œç¨‹ç™»é™†æ˜æ–‡ä¼ è¾“ï¼ˆæä¸å®‰å…¨ï¼‰ï¼Œå¯†ç ä¼šè¢«æˆªè·ã€‚\nSSH (Secure Shell) 22 TCP è¿œç¨‹ç™»å½•ã€‚åŠ å¯†ä¼ è¾“ï¼ˆå®‰å…¨ï¼‰ï¼Œå®ƒæ˜¯ Telnet çš„æ›¿ä»£è€…ã€‚\næ–‡ä»¶ä¼ è¾“ç±»\nFTP file transfer protocol 21/20 TCPä¼ æ–‡ä»¶ã€‚æ³¨æ„å®ƒç”¨ä¸¤ä¸ªç«¯å£ï¼21æ˜¯control ç”¨æ¥ä¼ æŒ‡ä»¤ 20æ˜¯dataä¸“é—¨ä¼ æ–‡ä»¶æ•°æ®\nTFTP trivial FTP 69 UDP ç®€å•æ–‡ä»¶ä¼ è¾“ åªä¼ å°æ–‡ä»¶ä¸ç”¨æ¡æ‰‹\nç½‘é¡µä¸åŸŸå\nHTTP 80çœ‹ç½‘é¡µã€‚æ˜æ–‡ä¼ è¾“ã€‚\nHTTPS 443çœ‹ç½‘é¡µï¼ˆåŠ å¯†ï¼‰ã€‚HTTP + SSL/TLSã€‚\nDNS 53  UDP/TCP æŸ¥ip,åŸŸåè§£æ  æŸ¥IPã€‚åŸŸåè§£æã€‚é€šå¸¸æŸ¥è¯¢ç”¨ UDPï¼Œä¸»å¤‡æœåŠ¡å™¨åŒæ­¥ç”¨ TCPã€‚\nç¬¬ 91 é¢˜ï¼šä¼ è¾“æŠ€æœ¯åˆ†ä¸º Point-to-point (ç‚¹å¯¹ç‚¹) å’Œ Broadcast links (å¹¿æ’­é“¾è·¯)ã€‚\n\nè®°å¿†ç‚¹ï¼šè¿™æ˜¯ç‰©ç†å±‚çš„åˆ†ç±»ï¼Œå¹¿æ’­é“¾è·¯æŒ‡å…±äº«ä»‹è´¨ï¼ˆå¦‚ Wi-Fiã€ä»¥å¤ªç½‘ï¼‰ã€‚\n\n\nARP çš„å½’å±å±‚çº§ï¼šluxq èµ„æ–™æŒ‡å‡ºï¼ŒARP æœ€å¥½è¢«è§†ä¸ºä»‹äºé“¾è·¯å±‚å’Œç½‘ç»œå±‚è¾¹ç•Œçš„åè®®ï¼Œä½†å®ƒä¸ºç½‘ç»œå±‚æä¾›æœåŠ¡ã€‚\nOSI ä¸ TCP/IP çš„å¯¹æ¯”ï¼šOSI å‚è€ƒæ¨¡å‹ç½‘ç»œå±‚æ”¯æŒæ— è¿æ¥å’Œé¢å‘è¿æ¥ï¼Œä½† TCP/IP çš„äº’è”ç½‘å±‚ä»…æ”¯æŒæ— è¿æ¥é€šä¿¡ï¼ˆIPåè®®ï¼‰ã€‚\nSSH ç«¯å£è¯¯åŒºï¼šåŠ¡å¿…è®°ä½ SSH æ˜¯ 22 ç«¯å£ï¼Œä¸è¦å’Œ FTP çš„ 21 æ··æ·†ã€‚\nMIME ç¼–ç ï¼šBase64 ç¼–ç æ˜¯å°†æ¯ 24 ä½ï¼ˆ3å­—èŠ‚ï¼‰åˆ†å‰²ä¸º 4 ä¸ª 6 ä½çš„å•å…ƒï¼Œå¹¶æ˜ å°„ä¸º ASCII å­—ç¬¦ã€‚\nHTTP çŠ¶æ€ç ï¼šé‡ç‚¹è®°ä½ 200 (OK)ã€301 (æ°¸ä¹…é‡å®šå‘)ã€404 (æ‰¾ä¸åˆ°é¡µé¢) å’Œ 500 (æœåŠ¡å™¨å†…éƒ¨é”™è¯¯)ã€‚\n\nkeep track of a user and its related information by the Web server?â€\n\nHTTP åè®®æœ¬èº«æ˜¯ æ— çŠ¶æ€ (Stateless) çš„ã€‚è¿™æ„å‘³ç€ä½ è¯·æ±‚äº†ç¬¬ 1 é¡µï¼Œå†è¯·æ±‚ç¬¬ 2 é¡µï¼ŒæœåŠ¡å™¨æ ¹æœ¬ä¸çŸ¥é“ä½ æ˜¯åŒä¸€ä¸ªäººã€‚\nä¸ºäº†è®°ä½â€œä½ æ˜¯è°â€ï¼ˆæ¯”å¦‚ä¿æŒç™»å½•çŠ¶æ€ã€è´­ç‰©è½¦é‡Œçš„å•†å“ï¼‰ï¼ŒæœåŠ¡å™¨ä¼šå‘ç»™ä½ ä¸€ä¸ªå°çº¸æ¡ï¼Œè®©ä½ ä¸‹æ¬¡è¯·æ±‚æ—¶å¸¦ä¸Šã€‚è¿™ä¸ªå°çº¸æ¡å°±æ˜¯ Cookieã€‚\n\n\nCookie å­˜åœ¨å“ªï¼Ÿï¼šæµè§ˆå™¨ (Client)ã€‚\nHTMLæ ‡ç­¾è¯­ä¹‰\n\n\nHTTPæ˜¯æŒä¹…è¿æ¥\n\næ— çŠ¶æ€ (Stateless)ï¼š æè¿°çš„æ˜¯**â€œè®°å¿†èƒ½åŠ›â€**ï¼ˆåº”ç”¨å±‚é€»è¾‘ï¼‰ã€‚\næŒä¹…è¿æ¥ (Persistent Connection)ï¼š æè¿°çš„æ˜¯**â€œä¼ è¾“é€šé“â€**ï¼ˆä¼ è¾“å±‚/ç‰©ç†è¿æ¥ï¼‰ã€‚\n\ncontent delivery network\n\nchapter8 ç½‘ç»œå®‰å…¨\nç›®æ ‡:ä¿æŠ¤ä»¥ä¸‹çš„æ€§è´¨\n\næœºå¯†æ€§ confidentiality è¢«æˆªè·\nå®Œæ•´æ€§integrity è¢«ç¯¡æ”¹\nè®¤è¯authentication å‡èº«ä»½\n\nå—å¯†ç ï¼š\nAES DESè€æ‰ç‰™çš„å¯¹ç§°åŠ å¯†\nå·¥å…· åŠ å¯†ç®—æ³•\n\nå¯¹ç§°åŠ å¯† symmetric encryption å¿« ä½†æ˜¯æœ‰ç¼ºé™·\n\nåŠ å¯†å’Œè§£å¯†ç”¨åŒä¸€ä¸ªå¯†é’¥,å¸¸è§ç®—æ³•æ˜¯AESAdvanced Encryption Standard:å—å¯†ç  block cipher æŠŠæ•°æ®åˆ‡æˆä¸€å—ä¸€å—åšåŠ å¯†\næ¯ä¸€å—ç‹¬ç«‹åŠ å¯†:ECB è™½ç„¶è§£ä¸å¼€ä½†æ˜¯èƒ½çœ‹åˆ°å›¾æ¡ˆå’Œæ¨¡å¼ï¼šå¦‚æœä¸¤å—ä¸€æ · åŠ å¯†åä¹Ÿä¸€æ ·äº†\ncipher block chaining CBC æŠŠå‰ä¸€å—çš„åŠ å¯†ç»“æœæ··å…¥ä¸‹ä¸€å—åŠ å¯†è¿‡ç¨‹ä¸­\nå› æ­¤:ä¸ºäº†é˜²æ­¢é’ˆå¯¹ ECB çš„æ¨¡å¼åˆ†ææ”»å‡»ï¼ŒAES å¿…é¡»é…åˆ CBC æ¨¡å¼ä½¿ç”¨ã€‚\n\n\néå¯¹ç§°åŠ å¯† public-key cryptography å®‰å…¨ä½†æ˜¯æ…¢ ä¸»è¦çš„ç®—æ³•æ˜¯RSA å”¯ä¸€çš„å®ƒæ˜¯ç›®å‰æœ€æµè¡Œçš„å…¬é’¥åŠ å¯†ç®—æ³•ã€‚\n\nå…¬é’¥ å…¬å¼€ç»™æ‰€æœ‰äºº ç”¨æ¥é” åŠ å¯†  æˆ–è€…éªŒ  éªŒè¯ç­¾å\nç§é’¥ ç”¨æ¥å¼€ è§£å¯†Decrypt æˆ–è€…ç­¾ æ•°å­—ç­¾å\n\n\n\nè¯ä¹¦ä½“ç³»\nåŠè¯ (Issue)ï¼š\n\næ·˜å®æŠŠè‡ªå·±çš„å…¬é’¥äº¤ç»™ CA (æƒå¨æœºæ„)ã€‚\nCA å®¡æ ¸é€šè¿‡åï¼Œç”¨ CA çš„ç§é’¥ åœ¨æ·˜å®çš„å…¬é’¥ä¸Šç›–äº†ä¸ªç« ï¼ˆæ•°å­—ç­¾åï¼‰ï¼Œç”Ÿæˆäº†è¯ä¹¦ã€‚\nä½ çš„æµè§ˆå™¨è®¿é—®æ·˜å®ï¼Œæ·˜å®å‡ºç¤ºè¯ä¹¦ã€‚\næµè§ˆå™¨æ€ä¹ˆçŸ¥é“è¿™ä¸ªè¯ä¹¦ä¸Šçš„ç« æ˜¯çœŸçš„ï¼Ÿ\næµè§ˆå™¨å†…ç½®äº† CA çš„å…¬é’¥ï¼ˆæ“ä½œç³»ç»Ÿè‡ªå¸¦ï¼‰ã€‚\næµè§ˆå™¨ç”¨ CA çš„å…¬é’¥ å»è§£å¯†/éªŒè¯é‚£ä¸ªæ•°å­—ç­¾åã€‚å¦‚æœè§£å¼€äº†ï¼Œè¯´æ˜è¿™ä¸ªç« ç¡®å®æ˜¯ CA ç›–çš„ï¼Œè¯ä¹¦æ˜¯çœŸçš„ã€‚\n\néªŒè¯ç½‘ç«™è¯ä¹¦çš„çœŸä¼ªï¼Œæ˜¯éªŒè¯ CA çš„ç­¾åï¼Œæ‰€ä»¥è¦ç”¨ CA çš„å…¬é’¥ã€‚\næ—¶å»¶ç›¸å…³\ntransmission delay ç½‘å¡æŠŠæ•°æ®æ¨åˆ°çº¿è·¯ä¸Šçš„æ—¶é—´ æ˜¯æ•°æ®é•¿åº¦ã€å¸¦å®½ï¼ˆdatarate\npropagation delay åœ¨ç‰©ç†ä»‹è´¨é‡Œè·‘è¦èŠ±çš„æ—¶é—´\nT=ç‰©ç†è·ç¦»/ä¼ æ’­é€Ÿåº¦ è·Ÿæ•°æ®åŒ…å¤§å°æ— å…³\nnslookup æŸ¥ip\ntracert  trace route\narp æŸ¥macåœ°å€\nnetstat æŸ¥è¿æ¥çŠ¶æ€\né€šä¿¡æ¨¡å¼\nå•æ’­:ä¸€å¯¹ä¸€ unicasting\nå¹¿æ’­ broadcasting\nç»„æ’­/å¤šæ’­ multicasting åœºæ™¯ï¼šæ¯”å¦‚çœ‹â€œIPTV ç½‘ç»œç”µè§†â€æˆ–è€…â€œZoom åˆ†ç»„ä¼šè®®â€ã€‚åªæœ‰åŠ å…¥äº†â€œä½“è‚²é¢‘é“ç»„â€çš„äººèƒ½æ”¶åˆ°ä½“è‚²é¢‘é“çš„è§†é¢‘æµï¼Œä¸çœ‹çš„äººæ”¶ä¸åˆ°ã€‚æ—¢ä¸æ˜¯åªå‘ç»™ä¸€ä¸ªäººï¼Œä¹Ÿä¸æ˜¯å‘ç»™å…¨ç½‘æ‰€æœ‰äººï¼Œè€Œæ˜¯å‘ç»™ç‰¹å®šçš„ä¸€ç¾¤äººï¼ˆå­é›†ï¼‰ã€‚\næ”¯æŒå‘æœºå™¨çš„ä¸€ä¸ªå­é›†subnet\n\nsocket\nprimitiveåŸè¯­\né˜»å¡è°ƒç”¨è€…: accept\nsocket bind listenéƒ½æ˜¯ç¬æ—¶æ“ä½œ\nä»€ä¹ˆæ˜¯åŸºäºudpçš„ RTP real time transport protocol\n"},"è¯¾ç¨‹ç¬”è®°/è®¡ç®—ç†è®º/01-æ­£åˆ™è¯­è¨€ä¸æœ‰é™è‡ªåŠ¨æœº":{"slug":"è¯¾ç¨‹ç¬”è®°/è®¡ç®—ç†è®º/01-æ­£åˆ™è¯­è¨€ä¸æœ‰é™è‡ªåŠ¨æœº","filePath":"è¯¾ç¨‹ç¬”è®°/è®¡ç®—ç†è®º/01 æ­£åˆ™è¯­è¨€ä¸æœ‰é™è‡ªåŠ¨æœº.md","title":"01 æ­£åˆ™è¯­è¨€ä¸æœ‰é™è‡ªåŠ¨æœº","links":[],"tags":[],"content":"ç­‰ä»·é“¾\nDFA=NFA=æ­£åˆ™è¡¨è¾¾å¼=æ­£åˆ™æ–‡æ³•\nèƒ½è¢«DFAæ¥æ”¶çš„å°±æ˜¯æ­£åˆ™è¯­è¨€\nåŸºæœ¬å®šä¹‰\n\n\nå­—æ¯è¡¨(alphabet): æœ‰é™çš„ç¬¦å·é›†åˆ. ä¾‹å¦‚ âˆ‘={0,1}.\n\n\nä¸²(string): ç”±ç¬¦å·ç»„æˆçš„æœ‰é™åºåˆ—. ä¾‹å¦‚ 01001. ä¸²çš„è¿æ¥: â—¦\n\n\nç©ºä¸²: e, ä½¿å¾—we=ew=w,âˆ€w.\n\n\nè¯­è¨€(language): ç”±ä¸²æ„æˆçš„é›†åˆ.\n\n\nKleene é—­åŒ… (Kleene star): Lâˆ— = L0 âˆªL1â€¦\n\nâˆ‘âˆ— å³ä¸ºç”±è¯¥å­—æ¯è¡¨å†…ç¬¦å·ç»„æˆçš„æ‰€æœ‰ä¸²çš„é›†åˆ, å®ƒæ˜¾ç„¶æ˜¯ä¸€ä¸ªè¯­è¨€.\n\n\n\nä¸²å’Œè¯­è¨€å®è´¨ä¸Šéƒ½æ˜¯åœ¨ä¸€ä¸ªå­—æ¯è¡¨ä¸‹è°ˆè®ºçš„, åœ¨ä¸å¼•èµ·æ­§ä¹‰çš„æƒ…å†µä¸‹æˆ‘ä»¬å¯ä»¥ä¸æŒ‡æ˜å­—æ¯è¡¨.å¦‚è¯­è¨€L={a^nÂ·b^n |nâ‰¥1} çš„ç¬¦å·è¡¨ä¸º {a,b}\n\n\næ³¨æ„ç©ºé›† âˆ…, ç©ºä¸² e, ç©ºä¸²æ„æˆçš„è¯­è¨€{e} ä¸‰è€…çš„åŒºåˆ«.\n\n\næœ‰é™è‡ªåŠ¨æœº\nç¡®å®šæœ‰é™è‡ªåŠ¨æœº\ndeterministic finite automata, ç®€ç§° DFAã€‚\nç”±äº”å…ƒç»„(K,âˆ‘,Î´,s,F) æ„æˆ\n\n\nK æ˜¯ç”±çŠ¶æ€æ„æˆçš„æœ‰é™é›†åˆï¼ˆå°±æ˜¯çŠ¶æ€æœºçš„é‚£ä¸ªçŠ¶æ€ï¼‰\n\n\nâˆ‘æ˜¯å­—æ¯è¡¨/å­—ç¬¦é›†.\n\n\nsâˆˆK æ˜¯èµ·å§‹çŠ¶æ€.\n\n\nF âŠ†K æ˜¯æ¥å—çŠ¶æ€çš„é›†åˆï¼ˆæ„Ÿè§‰é€šè¿‡çŠ¶æ€æ›´å‡†ç¡®ï¼Œå³ç»ˆæ­¢ä¸”é€šè¿‡çš„çŠ¶æ€ï¼‰\n\n\nÎ´:KÃ—âˆ‘â†’K ä¸ºçŠ¶æ€è½¬ç§»å‡½æ•°ï¼ˆçŠ¶æ€+è¯»å…¥å­—ç¬¦â†’ä¸‹ä¸€ä¸ªçŠ¶æ€ï¼‰[è¿™é‡Œè¯»å…¥ç©ºå­—ç¬¦æ˜¯ä¸èƒ½è¿›è¡ŒçŠ¶æ€è½¬ç§»çš„]\n\n\næ³¨æ„ Î´ æ˜¯è¾“å…¥ä¸€ä¸ªçŠ¶æ€å’Œä¸€ä¸ªå­—ç¬¦, è¾“å‡ºä¸€ä¸ªæ–°çŠ¶æ€çš„å‡½æ•°. å®ƒä¸ä»…ä¿è¯äº†æ¯ä¸€ä¸ªçŠ¶æ€åœ¨æ¯ä¸€ä¸ªè¯»å–çš„å­—ç¬¦ä¸‹éƒ½ä¼šæœ‰ä¸€ä¸ªæ–°çŠ¶æ€ (å¯èƒ½ä¸åŸçŠ¶æ€ç›¸åŒ), åŒæ—¶å¯ä¿è¯äº†è¿™ä¸ªæ–°çŠ¶æ€æ˜¯å”¯ä¸€çš„. æ‰€è°“ç¡®å®šæ€§å³æŒ‡ä¸‹ä¸€ä¸ªçŠ¶æ€è¢«å½“å‰çŠ¶æ€å’Œè¾“å…¥å”¯ä¸€ç¡®å®š.\n\n\næˆ‘ä»¬æœ‰æ—¶å€™ä¼šæ··ç”¨â€œçŠ¶æ€æœºâ€,â€œæœ‰é™è‡ªåŠ¨æœºâ€, â€œè‡ªåŠ¨æœºâ€ ç­‰è¯æ±‡, å®ƒä»¬çš„æ„ä¹‰éƒ½æ˜¯ç›¸åŒçš„. åŒåœ†çš„æ˜¯ç»ˆæ­¢çŠ¶æ€,è€Œstart æŒ‡å‘çš„çŠ¶æ€ä¸ºèµ·å§‹çŠ¶æ€\n\n\næ ¼å±€\nDFA çš„æ ¼å±€ (configuration) ä¸º (q,w) âˆˆ K Ã—âˆ‘âˆ—\n\nå…ƒç´ å¯¹ï¼Œå‰ä¸€ä¸ªå…ƒç´ æ˜¯çŠ¶æ€ï¼Œåä¸€ä¸ªå…ƒç´ æ˜¯å°šæœªè¢«è¯»å–çš„å­—ç¬¦ä¸²çš„å…¨é›†\næ ¼å±€å°±æ˜¯ç°åœ¨åœ¨ä»€ä¹ˆçŠ¶æ€ã€è¿˜å‰©ä¸‹ä»€ä¹ˆè¾“å…¥æ²¡æœ‰è¯»å–\næˆ‘ä»¬å®šä¹‰æ ¼å±€é—´çš„äºŒå…ƒå…³ç³»M ä¸º:\næˆ‘ä»¬ç§°(q,w) é€šè¿‡ä¸€æ­¥æ¨å¾— (qâ€²,wâ€²). M æè¿°çš„æ˜¯æ¶ˆè€—ä¸€ä¸ªå­—ç¬¦è¿›è¡Œä¸€æ¬¡çŠ¶æ€è½¬ç§»çš„ä¸€æ­¥æ¨å¯¼è¿‡ç¨‹.\nå¯ä»¥æè¿°å¤šæ­¥æ¨å¯¼çš„è¿‡ç¨‹ï¼šåœ¨M è¿™ä¸ªäºŒå…ƒå…³ç³»åŠ ä¸Šä¼ é€’æ€§å°±èƒ½è¾¾åˆ°è¿™ä¸ªç›®çš„,ä¸ºäº†åé¢å™è¿°æ–¹ä¾¿æˆ‘ä»¬å†åŠ ä¸Šè‡ªåæ€§,å³é›¶æ­¥æ¨å¯¼ä¹Ÿç®—æ¨å¯¼.\næˆ‘ä»¬æŠŠåŠ ä¸Šè‡ªåæ€§å’Œä¼ é€’é—­åŒ…çš„äºŒå…ƒå…³ç³»ç§°ä¸ºâˆ—M,âˆ—çš„æ„æ€å’Œå­—ç¬¦ä¸­çš„Kleene æ˜Ÿå·ç±»ä¼¼,ä»£è¡¨é›¶æ­¥æˆ–è€…å¤šæ­¥.\nåœ¨æ ¼å±€å’Œæˆ‘ä»¬å®šä¹‰çš„äºŒå…ƒå…³ç³»çš„è¯­è¨€ä¸‹, æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“çš„å½¢å¼åŒ–æè¿°ä¸€ä¸ªä¸²è¢«è‡ªåŠ¨æœºæ¥å—ä¸å¦. ä¸²wâˆˆâˆ‘âˆ— è¢«M æ¥å—,å½“ä¸”ä»…å½“å­˜åœ¨çŠ¶æ€qâˆˆF ä½¿å¾—(s,w) âˆ— M (q,e). è€Œæ‰€æœ‰è¢«M æ‰€æ¥å—çš„è¯­è¨€,æˆ‘ä»¬è®°ä¸ºL(M).\n\n(s,e)âˆ— M (q,e).\n\néç¡®å®šæœ‰é™è‡ªåŠ¨æœº\n(nondeterministic finite automata, ç®€ç§°NFA), ç”±äº”å…ƒç»„(K,Î£,Î”, s, F) æ„æˆ:\n\nK æ˜¯ç”±çŠ¶æ€æ„æˆçš„æœ‰é™é›†åˆ.\nÎ£æ˜¯å­—æ¯è¡¨/å­—ç¬¦é›†.\nsâˆˆK æ˜¯èµ·å§‹çŠ¶æ€.\nFâŠ†K æ˜¯æ¥å—çŠ¶æ€çš„é›†åˆ.\nÎ”âŠ†KÃ—(Î£âˆª{e}ï¼‰Ã—K ä¸ºçŠ¶æ€è½¬ç§»å…³ç³».ï¼ˆä»å‡½æ•°å˜æˆäº†å…³ç³»/é›†åˆï¼Œè¿™ä¸ªé›†åˆé‡Œæ˜¯ä¸€ä¸ªä¸‰å…ƒç»„ï¼ˆå½“å‰çŠ¶æ€ï¼Œè§¦å‘æ¡ä»¶ï¼Œç›®æ ‡çŠ¶æ€ ï¼‰ï¼‰\n\nè§¦å‘æ¡ä»¶ï¼šå­—æ¯è¡¨æˆ–ç©ºå­—ç¬¦ä¸²\n\n\nè¿™é‡Œçš„Delta ä¸ºçŠ¶æ€é—´çš„å…³ç³», è¿™ä¹Ÿå°±å†³å®šäº†ä¸€ä¸ªçŠ¶æ€åœ¨æŸä¸€å­—ç¬¦/è¾“å…¥ä¸‹å¯ä»¥è½¬ç§»åˆ°å¤šä¸ªçŠ¶æ€, ä¹Ÿè¯´æ˜äº†ä¸æ˜¯æ¯ä¸€ä¸ªçŠ¶æ€éƒ½å¯ä»¥åœ¨ä»»ä¸€è¾“å…¥ä¸‹è¿›è¡Œè½¬ç§»çš„.\nåœ¨ä»‹ç»å®ŒDFA ä¸NFA å, ä¸€ä¸ªè‡ªç„¶çš„é—®é¢˜æ˜¯å®ƒä»¬çš„è®¡ç®—èƒ½åŠ›æ˜¯ä¸€æ ·çš„å—? æ‰€è°“è®¡ç®—èƒ½åŠ›, ç²—ç•¥æ¥è¯´å°±æ˜¯æ¯”è¾ƒèƒ½å¤Ÿæ¥å—çš„è¯­è¨€çš„å¤šå°‘. å½¢å¼ä¸Šæ¥è¯´, ä¸¤ä¸ªFA M1 å’ŒM2 æ˜¯ç­‰ä»·çš„, å½“ä¸”ä»…å½“L(M1) = L(M2). ç›´è§‰ä¸Šæ¥è¯´, NFA çš„è®¡ç®—èƒ½åŠ›ä¼¼ä¹è¦æ¯”DFA ç¨ç¨å¼ºä¸€ç‚¹, æ¯•ç«Ÿå®ƒçœ‹èµ·æ¥å¯ä»¥ä¸ç¡®å®šèƒ½å¤Ÿå¤šä¸€äº›å¯èƒ½, ä½†äº‹å®å´ä¸å¦‚æ­¤.\n\nå®šç†1.1\n\nè¯æ˜ï¼š\n\nå·¦åˆ°å³ï¼šæ˜¾ç„¶ã€‚å› ä¸ºä»»æ„ä¸€ä¸ªDFAéƒ½æ˜¯ä¸€ä¸ªNFAã€‚æ¯ä¸€ä¸ªå‡½æ•°éƒ½å¤©ç„¶æ„æˆä¸€ä¸ªå…³ç³»\n\nDFA ä»ï¼ˆå½“å‰çŠ¶æ€ï¼Œè¯»å…¥ç¬¦å·ï¼‰å¯ä»¥å¾—åˆ°ä¸€ä¸ªå”¯ä¸€è¾“å‡ºï¼ˆä¸‹ä¸€ä¸ªçŠ¶æ€ï¼‰\nNFA æ˜¯ä¸€ä¸ªä¸‰å…ƒç»„\n\n\nå³åˆ°å·¦\nè®©DFAçš„ä¸€ä¸ªçŠ¶æ€ç­‰äºNFAçš„ä¸€ç»„çŠ¶æ€ï¼Œå°±å¯ä»¥ç”¨DFAæ¥æ¨¡æ‹ŸNFAäº†\n\nè¿™ä¸ªEæ˜¯eé—­åŒ… ï¼Œqé€šè¿‡ç©ºå­—ç¬¦ä¸²èƒ½åˆ‡æ¢åˆ°çš„æ‰€æœ‰çŠ¶æ€pï¼Œqä¸pç­‰ä»·ã€‚\n\n\n\næ–°çš„çŠ¶æ€=åŸæ¥çŠ¶æ€çš„æ€»ä¸ªæ•°\nå­—æ¯è¡¨ä¸å˜\nåŸå§‹çŠ¶æ€çš„ç­‰ä»·é›†åˆ\nåªè¦è¿™ä¸ªé›†åˆé‡Œï¼ŒåŒ…å«äº†è‡³å°‘ä¸€ä¸ª NFA çš„åŸæ¥å—çŠ¶æ€ï¼Œå®ƒå°±æ˜¯ DFA çš„æ¥å—çŠ¶æ€ã€‚\nå¯¹äºå½“å‰çŠ¶æ€ç»„Qï¼Œå¯¹äºé‡Œé¢çš„æ¯ä¸€ä¸ªçŠ¶æ€qï¼Œçœ‹çœ‹è¯»å…¥aåå¾—åˆ°çš„çŠ¶æ€ç»„é‡Œçš„æ‰€æœ‰pã€‚æ¯ä¸€ä¸ªpéƒ½è®¡ç®—ä»–çš„eé—­åŒ…ï¼Œå¾—åˆ°ä¸€ä¸ªé›†åˆï¼Œå°±æ˜¯æ–°çš„å·¨å¤§çš„çŠ¶æ€ç»„\n\næ­£åˆ™è¯­è¨€\n\nèƒ½è¢«æ­£åˆ™è¡¨è¾¾å¼è¯†åˆ«çš„ä¸²å…¨ä½“ï¼Œç§°ä¸ºæ­£åˆ™è¯­è¨€\n\nç©ºå’Œå­—ç¬¦\nå¹¶ è¿æ¥ æ˜Ÿ\n\næ­£åˆ™åŸºæœ¬æ€§è´¨\n\n\nSæˆ–Rå’ŒRæˆ–Sç­‰ä»·\nå­—ç¬¦ä¸²æ‹¼æ¥ç»“åˆå¾‹\nå­—ç¬¦ä¸²æ‹¼æ¥åˆ†é…å¾‹\nç©ºé›†åˆçš„0ä¸ªæˆ–å¤šä¸ª ç»“æœæ˜¯ç©ºå­—ç¬¦ä¸²  ç­‰å¼ä¸¤è¾¹éƒ½æ˜¯è¯­è¨€ï¼ˆå­—ç¬¦ä¸²çš„é›†åˆï¼‰ æ˜Ÿå·æ˜¯ä»è¿™ä¸ªé›†åˆé‡Œé€‰0orå¤šä¸ªå­—ç¬¦ä¸²ç„¶åæ‹¼æ¥èµ·æ¥å½¢æˆè¯­è¨€\nå³è¾¹ï¼šRæˆ–è€…Så‡ºç°0æ¬¡orä»»æ„æ¬¡ï¼Œå¯ä»¥äº§ç”Ÿä»»ä½•ç”±Rå’ŒSç»„æˆçš„åºåˆ—\n\nå·¦è¾¹æ˜¯ä»»æ„ä»»æ„æ¬¡ï¼Œæ„ä¼šä¸€ä¸‹\n\n\n\nè‡ªåŠ¨æœºèƒ½å¤Ÿè¯†åˆ«æ­£åˆ™è¯­è¨€\nå®šç†1.2 è‡ªåŠ¨æœºèƒ½æ¥å—çš„è¯­è¨€åœ¨å¹¶ã€è¿æ¥ã€æ˜Ÿã€è¡¥ã€äº¤ä¸‹å°é—­\n\n4. æŠŠåŸæ¥å¯ä»¥æ¥æ”¶å’Œä¸èƒ½æ¥æ”¶åä¸€ä¸‹å°±å¯ä»¥\n5. ç”¨è¡¥é›†å’Œå¹¶é›†ç»“åˆèµ·æ¥\næ¨è®º1.1\n\nå®šç†1.3\n\næ¨è®º1.2\nè‡ªåŠ¨æœºå’Œæ­£åˆ™è¯­è¨€æ˜¯ç­‰ä»·çš„. å…·ä½“æ¥è¯´, ä¸€ä¸ªè¯­è¨€æ˜¯æ­£åˆ™çš„å½“ä¸”ä»…å½“å®ƒèƒ½è¢«æŸä¸ªè‡ªåŠ¨æœºæ¥å—.\nç®—æ³•\næŠŠè‡ªç„¶è¯­è¨€è½¬æ¢æˆDFAè‡ªåŠ¨æœº\n\nå…ˆæŠŠè‡ªç„¶è¯­è¨€è½¬æ¢æˆæ­£åˆ™è¡¨è¾¾å¼\næ ¹æ®è¿™ä¸ªå®šç†çš„å¯å‘ï¼Œå¯ä»¥æŠŠæ­£åˆ™è¡¨è¾¾å¼è½¬æ¢æˆè‡ªåŠ¨æœºã€‚\nå°±æ˜¯æŠŠå…¬å¼çš„æ¯ä¸ªå°é›¶ä»¶ï¼ˆå¦‚ aã€bã€Uã€*ï¼‰éƒ½æ¢æˆå¯¹åº”çš„ NFA å°æœºå™¨ï¼Œç„¶åç”¨ e è½¬ç§»ï¼ˆepsilon è½¬ç§»ï¼Œæˆ–â€œå…è´¹â€è½¬ç§»ï¼‰æŠŠå®ƒä»¬â€œç²˜â€èµ·æ¥ã€‚\n\n\n\næŠŠNFAè½¬æ¢æˆDFA å°±æ˜¯çŠ¶æ€ç»„çš„é‚£ä¸ªå®šç†\næ³¨æ„æŸä¸ªçŠ¶æ€çš„eé—­åŒ…ä¼šåŒ…æ‹¬å®ƒæœ¬èº«\n\néæ­£åˆ™è¯­è¨€\næœ‰é™çŠ¶æ€æœºå®è´¨ä¸Šå¹¶ä¸èƒ½è®°ä½è¿‡å»ç»å†çš„çŠ¶æ€,\nâ€œé¸½ç¬¼åŸç†â€ (Pigeonhole Principle)ï¼š å¦‚æœä½ å–‚ç»™å®ƒä¸€ä¸ªå¾ˆé•¿çš„å­—ç¬¦ä¸²ï¼ˆæ¯”å¦‚é•¿åº¦ m=10ï¼Œæ¯”çŠ¶æ€æ•° n=5 è¦é•¿ï¼‰ï¼Œæœºå™¨åœ¨è¯»å–è¿™ä¸ªå­—ç¬¦ä¸²æ—¶ï¼Œå¿…å®šä¼šç»è¿‡åŒä¸€ä¸ªçŠ¶æ€è‡³å°‘ä¸¤æ¬¡ã€‚\n\nxæ˜¯å­—ç¬¦ä¸²ä¸­è¿›å…¥ç¯ä¹‹å‰çš„éƒ¨åˆ†\nyæ˜¯ç»•ç¯ä¸€åœˆå¯¹åº”çš„å­—ç¬¦ä¸²ï¼Œä¸èƒ½ä¸ºç©º\nzæ˜¯ç¦»å¼€ç¯ä¹‹ååˆ°ç»ˆç‚¹çš„éƒ¨åˆ†\nç„¶åiå°±æ˜¯ç»•äº†å‡ åœˆã€‚\næˆ‘ä»¬ä¿è¯åœ¨è¯»å– n ä¸ªå­—ç¬¦ä¹‹å†…å¿…å®šä¼šæ‰¾åˆ°ç¬¬ä¸€ä¸ªç¯ï¼Œæ‰€ä»¥ x å’Œ y åŠ èµ·æ¥çš„æ€»é•¿åº¦ä¸å¯èƒ½è¶…è¿‡ nã€‚\n\n\nquestion"},"è¯¾ç¨‹ç¬”è®°/è®¡ç®—ç†è®º/02-ä¸Šä¸‹æ–‡æ— å…³æ–‡æ³•ä¸ä¸‹æ¨è‡ªåŠ¨æœº":{"slug":"è¯¾ç¨‹ç¬”è®°/è®¡ç®—ç†è®º/02-ä¸Šä¸‹æ–‡æ— å…³æ–‡æ³•ä¸ä¸‹æ¨è‡ªåŠ¨æœº","filePath":"è¯¾ç¨‹ç¬”è®°/è®¡ç®—ç†è®º/02 ä¸Šä¸‹æ–‡æ— å…³æ–‡æ³•ä¸ä¸‹æ¨è‡ªåŠ¨æœº.md","title":"02 ä¸Šä¸‹æ–‡æ— å…³æ–‡æ³•ä¸ä¸‹æ¨è‡ªåŠ¨æœº","links":[],"tags":[],"content":"CFG\n\n\nä¸²é‡Œçš„ä¸€ä¸ªéç»ˆç»“ç¬¦æ ¹æ®è§„åˆ™è¿›è¡Œæ›¿æ¢,å¯ä»¥ä¸æ›¿æ¢æˆç»ˆç»“ç¬¦\n\nCFL å‡å» Regularï¼Œå‰©ä¸‹çš„è¿˜æ˜¯ CFLã€‚\n\n\nä¸Šä¸‹æ–‡æ— å…³è¯­æ³•çš„æ„é€ \n\nè¯­æ³•æ ‘ä¸ç­‰ä»·ç±»ä¸æœ€å·¦æ¨å¯¼\n\n\næ­§ä¹‰\n\n\n\n\nPDA\n\nï¼ˆï¼ˆ å½“å‰çŠ¶æ€ï¼Œè¯»å…¥å­—ç¬¦ï¼Œä»æ ˆé¡¶å¼¹å‡ºå­—ç¬¦ ï¼‰ï¼Œï¼ˆ è½¬ç§»åˆ°çŠ¶æ€pï¼Œå¾€æ ˆé¡¶å‹å…¥å­—ç¬¦ä¸² ï¼‰ï¼‰æœ€ç»ˆçš„æ¥å—çŠ¶æ€:\n\nåˆ°è¾¾æ¥å—çŠ¶æ€\nä¸è¯»å…¥å…¶ä»–å­—ç¬¦\nå½“å‰æ ˆé¡¶æ²¡æœ‰å…ƒç´ éœ€è¦å¼¹å‡º\n\nä½¿ç”¨ä¾‹:æŠŠéœ€è¦è¢«è®°å¿†çš„å­—ç¬¦å‹å…¥æ ˆå³å¯ ã€‚\n\nè¯»å…¥w è¯»å…¥c ç„¶åè¯»å…¥wçš„åè½¬ï¼Œå› æ­¤éœ€è¦è®°ä½wçš„å†…å®¹ï¼Œæ‰èƒ½åœ¨åé¢è¯»å…¥åè½¬çš„æ—¶å€™ç¡®è®¤\nè¯»å®Œcä¹‹åï¼Œåˆ‡æ¢åˆ°fçŠ¶æ€ï¼Œå°†æ ˆå†…å­—ç¬¦é€ä¸ªå¼¹å‡ºè¿›è¡Œæ ¸å¯¹ã€åœ¨è§„åˆ™ä¸­è®¾å®šäº†ï¼Œå½“è¯»å…¥å­—ç¬¦æ˜¯x æ ˆé¡¶å­—ç¬¦æ˜¯yçš„æ—¶å€™ï¼Œæ‰èƒ½è¿›è¡ŒçŠ¶æ€çš„è½¬ç§»ã€‘\néç¡®å®šæ€§ä¸‹æ¨è‡ªåŠ¨æœº,ä¸€ä¸ªè¾“å…¥ä¸‰å…ƒç»„å¯èƒ½ä¼šå¯¼è‡´ä¸¤ç§å˜åŒ–æ–¹å¼.ä½†æ˜¯åªè¦å­˜åœ¨ä¸€æ¡èƒ½èµ°é€šçš„è·¯ï¼ˆæœ€ç»ˆåœåœ¨æ¥å—æ€ä¸”æ ˆç©ºï¼‰ï¼Œè¿™ä¸ªä¸²å°±è¢«æ¥å—ã€‚\nä¸‹é¢æ˜¯ä¸€ä¸ªå®¹æ˜“æ··æ·†çš„ç‚¹\n\nCFGå’ŒPDAçš„å…³ç³»\n\n\nä¸€å¼€å§‹å°±è½¬ç§»åˆ°ç»ˆæ­¢çŠ¶æ€å¹¶åœ¨æ ˆé¡¶æ”¾ä¸€ä¸ªèµ·å§‹å­—ç¬¦\nå¤„äºçŠ¶æ€qæ—¶,ä¸è¯»å–ä»»ä½•è¾“å…¥ç¬¦å·,å¦‚æœæ ˆé¡¶ç¬¦å·æ˜¯ä¸€ä¸ªéç»ˆç»“ç¬¦A,é‚£ä¹ˆä¸è¯»è¾“å…¥,è€Œæ˜¯é€‰æ‹©ä»»æ„é€‰æ‹©ä¸€æ¡Aåˆ°xçš„è§„åˆ™,æŠŠAä»æ ˆé¡¶å¼¹å‡ºå¹¶ä¸”å°†xå‹å…¥.\nå¤„äºçŠ¶æ€qæ—¶,å¦‚æœæ ˆé¡¶ç¬¦å·æ˜¯ä¸€ä¸ªç»ˆç»“ç¬¦a,é‚£ä¹ˆå¿…é¡»ä»è¾“å…¥ä¸­è¯»å…¥ä¸€ä¸ªç¬¦å·a,åŒ¹é…æˆåŠŸ,å°±æ¶ˆè€—æ‰è¿™ä¸ªa(ä¸å‹å…¥æ ˆä¸­),å¹¶å°†æ ˆé¡¶çš„aå¼¹å‡º.\nç›´åˆ°(q,e,e)å°±ç»“æŸäº†\n\n\n\n\nä»PDAçš„èµ·å§‹çŠ¶æ€så¼€å§‹,æŠŠæ ˆåº•æœ€é¡½å›ºçš„Zæ¶ˆç­æ‰,ç„¶åæŠµè¾¾æœ€ç»ˆçŠ¶æ€fâ€™,å­—ç¬¦å°±è¢«æ¥å—äº†\né‚£ä¹ˆä¸‹ä¸€æ­¥å˜æˆ,åƒæ‰ä¸€ä¸ªå­—ç¬¦a,æŠŠBæ¢æˆäº†C,å½“å‰çš„çŠ¶æ€è·³åˆ°äº†r.é—®é¢˜å˜æˆäº†ä»rå‡ºå‘,æ¶ˆç­c,åˆ°è¾¾p\nåƒæ‰ä¸€ä¸ªå­—ç¬¦a,æŠŠBæ¢æˆäº†C1C2,ä¸ºäº†æ¶ˆç­è¿™ä¸ªä¸œè¥¿,æˆ‘ä»¬éœ€è¦ä»rå‡ºå‘èµ°åˆ°pâ€™,æŠŠc1æ¶ˆç­.ç„¶åä»pâ€™å‡ºå‘èµ°åˆ°p,æŠŠc2æ¶ˆç­\nå¦‚æœä»»åŠ¡æ˜¯ä»qå‡ºå‘æ¶ˆç­ç©ºå­—ç¬¦e,æœ€åå›åˆ°q,é‚£ä¹ˆä»€ä¹ˆéƒ½ä¸éœ€è¦åšç›´æ¥ç”Ÿæˆç©ºä¸²å³å¯.\n\n\nPDAæ„é€ CFG\n\n\nè§£é¢˜è§„èŒƒ\nè¯æ˜CFGå¯ä»¥ç”Ÿæˆæ€æ ·çš„è¯­è¨€\n\næ³µå¼•ç†\n\n\n\næ³µå®šç†\n"},"è¯¾ç¨‹ç¬”è®°/è®¡ç®—ç†è®º/03-å›¾çµæœº":{"slug":"è¯¾ç¨‹ç¬”è®°/è®¡ç®—ç†è®º/03-å›¾çµæœº","filePath":"è¯¾ç¨‹ç¬”è®°/è®¡ç®—ç†è®º/03 å›¾çµæœº.md","title":"03 å›¾çµæœº","links":[],"tags":[],"content":"\næ¥æ”¶çŠ¶æ€,åœæœº.\næ‹’ç»çŠ¶æ€,åœæœº\næ°¸è¿œè·‘ä¸‹å»,ä¸åœæœº,å°±æ˜¯æ­»å¾ªç¯\nè¯­è¨€æ˜¯æ‰€æœ‰èƒ½è¢«æœºå™¨(ç¨‹åº)æ¥å—çš„è¯­è¨€é›†åˆ\nå­˜åœ¨ä¸€ä¸ªå›¾çµæœº,å¯¹äºä»»ä½•è¾“å…¥,è¦ä¹ˆæ¥æ”¶,è¦ä¹ˆæ‹’ç»,ç»å¯¹ä¸ä¼šæ­»å¾ªç¯.é‚£ä¹ˆè¿™ä¸ªå›¾çµæœºå¯ä»¥åˆ¤å®šçš„è¯­è¨€å°±å«åšé€’å½’è¯­è¨€.\nå­˜åœ¨ä¸€ä¸ªå›¾çµæœº,å¯¹äºå±äºè¯­è¨€çš„ä¸²,å¯ä»¥æ¥å—.ä½†æ˜¯å¯¹äºä¸å±äºè¯­è¨€çš„ä¸²,ä»–å¯èƒ½è¿›å…¥æ‹’ç»,ä¹Ÿå¯èƒ½æ­»å¾ªç¯.ä»–åªèƒ½åŠåˆ¤å®š\\è¯†åˆ«,\nä¸€ä¸ªè¯­è¨€ç”±ä»»æ„æ–‡æ³•ç”Ÿæˆ,å½“ä¸”ä»…å½“å®ƒæ˜¯é€’å½’å¯æšä¸¾çš„(RE)\nä»»æ„æ–‡æ³•ç”Ÿæˆé€’å½’å¯æšä¸¾è¯­è¨€,ç„¶åå›¾çµæœºå¯ä»¥è¯†åˆ«çš„æ˜¯é€’å½’å¯æšä¸¾è¯­è¨€.é€’å½’è¯­è¨€æ˜¯REçš„ä¸€ä¸ªæ›´é«˜çº§ æ›´ä¸¥æ ¼çš„å­é›†.\n\nä»»æ„æ–‡æ³•&gt;ä¸Šä¸‹æ–‡æœ‰å…³æ–‡æ³•&gt;ä¸Šä¸‹æ–‡æ— å…³æ–‡æ³•\nä¸Šä¸‹æ–‡æœ‰å…³æ–‡æ³•:æ¨å¯¼å‡ºçš„ç»“æœä¸èƒ½æ¯”åŸæ¥çš„çŸ­.å®é™…ä¸Šä»»æ„æ–‡æ³•åŒ…å«ä¸Šä¸‹æ–‡æœ‰å…³æ–‡æ³•\nåŸå§‹é€’å½’å‡½æ•°\n\n\nä¹˜æ³•åŠ æ³•é™¤æ³•æˆªæ–­å‡æ³• æ¨¡è¿ç®— åˆ¤é›¶ é€»è¾‘å‡½æ•° æ˜¯åŸå§‹é€’å½’å‡½æ•°\nåœæœºé—®é¢˜\n\né€šç”¨å›¾çµæœº UTM\nä¸‰æ¡çº¸å¸¦ï¼Œåˆ†åˆ«æ¨¡æ‹Ÿæ•°æ®ç¨‹åºå’ŒçŠ¶æ€ã€‚\nç¬¬ä¸€æ¡çº¸è¢‹ å­˜æ”¾å›¾çµæœºMçš„ç¼–ç å’Œè¾“å…¥å­—ç¬¦ä¸²w\nç¬¬äºŒæ¡çº¸å¸¦ç©º\nç¬¬ä¸‰æ¡å­˜æ”¾èµ·å§‹çŠ¶æ€sçš„ç¼–ç \nè¿è¡Œ å…ˆæŠŠå›¾çµæœºMçš„ç¼–ç ä»ç¬¬ä¸€æ¡æ‹·è´åˆ°ç¬¬ä¸€æ¡ï¼Œç„¶åæŠŠç¬¬ä¸€æ¡åªç•™ä¸‹è¾“å…¥æ•°æ®w\nè¿™æ—¶å€™tape2å……å½“æŒ‡ä»¤é›†ï¼Œç”¨æ¥æŸ¥è¯¢ï¼Œåœ¨è¿™ä¸ªçŠ¶æ€ä¸‹è¯»åˆ°è¿™ä¸ªå­—ç¬¦åº”è¯¥åšä»€ä¹ˆã€‚tape1å°±å½“åšmemoryäº†ï¼Œç”¨æ¥è¯»å–å’Œä¿®æ”¹æ•°æ®ã€‚tape3å……å½“çŠ¶æ€å¯„å­˜å™¨ï¼Œè®°å½•è¢«æ¨¡æ‹Ÿæœºå™¨å½“å‰æ­£å¤„äºå“ªä¸ªçŠ¶æ€\næ„ä¹‰æ˜¯ å°†ç¨‹åºå’Œæœºå™¨åˆ†ç¦»å¼€æ¥ï¼šåªéœ€è¦æ¢ä¸€ä¸‹tape2ä¸Šçš„æè¿°å°±å¯ä»¥äº†ã€‚è¿™æ˜¯å­˜å‚¨ç¨‹åºè®¡ç®—æœºçš„é›å½¢ã€‚"},"è¯¾ç¨‹ç¬”è®°/è®¡ç®—ç†è®º/04-ä¸å¯åˆ¤å®šæ€§":{"slug":"è¯¾ç¨‹ç¬”è®°/è®¡ç®—ç†è®º/04-ä¸å¯åˆ¤å®šæ€§","filePath":"è¯¾ç¨‹ç¬”è®°/è®¡ç®—ç†è®º/04 ä¸å¯åˆ¤å®šæ€§.md","title":"04 ä¸å¯åˆ¤å®šæ€§","links":[],"tags":[],"content":"å¯åˆ¤å®šæ€§ä¸åˆ¤å®šæ€§é—®é¢˜\nåˆ¤å®š:åœæœº\nè¯†åˆ«:ä¼šåœæœº,ä¹Ÿä¼šæ­»å¾ªç¯.\næœ‰äº›é—®é¢˜æ˜¯ä¸å¯åˆ¤å®šçš„.\nåœæœºé—®é¢˜\nä¸€åˆ‡ä¸å¯åˆ¤å®šçš„æ ¹æº\nç»™å®šä¸€ä¸ªç¨‹åº M å’Œä¸€ä¸ªè¾“å…¥ wï¼Œèƒ½å¦å†™å‡ºä¸€ä¸ªé€šç”¨ç¨‹åºæ¥åˆ¤æ–­ M åœ¨ w ä¸Šæ˜¯ä¼šåœæœºè¿˜æ˜¯ä¼šæ­»å¾ªç¯ï¼Ÿ\nå‡è®¾å­˜åœ¨è¿™æ ·çš„åˆ¤å®šç¨‹åºï¼Œæˆ‘ä»¬å¯ä»¥æ„é€ ä¸€ä¸ªâ€œæ‚–è®ºç¨‹åºâ€ï¼šå¦‚æœåˆ¤å®šç¨‹åºè¯´å®ƒä¼šåœæœºï¼Œå®ƒå°±æ•…æ„è¿›å…¥æ­»å¾ªç¯ï¼›å¦‚æœåˆ¤å®šç¨‹åºè¯´å®ƒä¼šæ­»å¾ªç¯ï¼Œå®ƒå°±ç«‹åˆ»åœæœºã€‚è¿™å¯¼è‡´äº†é€»è¾‘å´©æºƒï¼Œä»è€Œåè¯å‡ºåˆ¤å®šç¨‹åºä¸å­˜åœ¨ã€‚\nè§„çº¦\nè¯æ˜ä¸€ä¸ªæ–°é—®é¢˜ä¸å¯åˆ¤å®šçš„æ–¹æ³•\nå¦‚æœ A å¯åˆ¤å®š \\Rightarrow åœæœºé—®é¢˜å°±å¯åˆ¤å®š \\Rightarrow ä¸å·²çŸ¥çŸ›ç›¾ \\Rightarrow æ‰€ä»¥ A ä¸å¯åˆ¤å®šã€‚\né‡Œæ–¯å®šç†\nä»»ä½•å…³äºé€’å½’å¯æšä¸¾è¯­è¨€çš„éå¹³å‡¡æ€§è´¨éƒ½æ˜¯ä¸å¯åˆ¤å®šçš„\néå¹³å‡¡:æŒ‡ä¸æ˜¯æ‰€æœ‰å›¾çµæœºéƒ½æœ‰,ä¹Ÿä¸æ˜¯æ‰€æœ‰å›¾çµæœºéƒ½æ²¡æœ‰çš„æ€§è´¨.æ¯”å¦‚:è¯­è¨€æ˜¯å¦ä¸ºç©º,æ˜¯å¦åŒ…å«æŸä¸ªä¸²,æ˜¯å¦æ— é™.\nDFA/NFA/æ­£åˆ™è¡¨è¾¾å¼ çš„æ‰€æœ‰åŸºæœ¬é—®é¢˜(æ˜¯å¦æ¥æ”¶ æ˜¯å¦ä¸ºç©º æ˜¯å¦ç›¸ç­‰)éƒ½æ˜¯å¯åˆ¤å®šçš„\nCFG/PDA ç©ºæ€§(æ˜¯å¦ç”Ÿæˆç©ºè¯­è¨€)å¯åˆ¤å®š,ä½†æ˜¯å¦ç”Ÿæˆæ‰€æœ‰ä¸²æ˜¯ä¸å¯åˆ¤å®šçš„\nå›¾çµæœºTM å‡ ä¹æ‰€æœ‰å…³äºè¯­è¨€æ€§è´¨çš„é—®é¢˜éƒ½æ˜¯ä¸å¯åˆ¤å®šçš„.\nè¯æ˜ä¸å¯åˆ¤å®š:å…ˆé‡Œæ–¯å®šç†,å†è§„çº¦æ³•è½¬æ¢ä¸ºåœæœºé—®é¢˜\n"},"è¯¾ç¨‹ç¬”è®°/è®¡ç®—ç†è®º/è®¡ç®—ç†è®º":{"slug":"è¯¾ç¨‹ç¬”è®°/è®¡ç®—ç†è®º/è®¡ç®—ç†è®º","filePath":"è¯¾ç¨‹ç¬”è®°/è®¡ç®—ç†è®º/è®¡ç®—ç†è®º.md","title":"è®¡ç®—ç†è®º","links":[],"tags":[],"content":"åˆ¤æ–­é¢˜\næ­£è§„è¯­è¨€:æ‰€æœ‰æœ‰é™é›†åˆéƒ½æ˜¯æ­£è§„è¯­è¨€,åŒ…æ‹¬ç©ºé›†\\ä»…å«ç©ºä¸²  å…¨é›†ä¹Ÿæ˜¯æ­£è§„è¯­è¨€ ä½†æ˜¯å…¨é›†æ˜¯æ— é™é›†åˆ\n\nRegular \\subset DCFL \\subset CFL \\subset Recursive \\subset RE\n\n\nè§„åˆ™ï¼š\n\né‡Œå±‚çš„ä¸€å®šæ˜¯å¤–å±‚çš„   ï¼ˆæ­£è§„è¯­è¨€ä¸€å®šæ˜¯ CFLï¼‰ã€‚\nå¤–å±‚çš„ä¸ä¸€å®šæ˜¯é‡Œå±‚çš„ï¼ˆCFL ä¸ä¸€å®šæ˜¯æ­£è§„ï¼‰ã€‚\n\n\n\n\n\nä½ çš„é¢˜ç›® (4)ï¼šEvery regular is CFG? â†’ Trueï¼Œå› ä¸º Regular åœ¨ CFL è‚šå­é‡Œã€‚\nä½ çš„é¢˜ç›® (6)ï¼šRE å¿…é¡»æ˜¯æ— é™çš„ï¼Ÿâ†’ Falseï¼Œæœ€é‡Œé¢çš„ Regular å¯ä»¥æ˜¯æœ‰é™çš„ï¼Œé‚£æœ€å¤–é¢çš„ RE å½“ç„¶ä¹Ÿå¯ä»¥æ˜¯æœ‰é™çš„ã€‚\n\n\n\n\nRE åªèƒ½ç¡®è®¤â€œæœ‰â€ï¼ˆå­˜åœ¨æ€§ï¼‰ã€‚\n\n\nç¡®è®¤â€œæ— â€ï¼ˆå…¨ç§°é‡è¯ï¼‰æ˜¯ RE åšä¸åˆ°çš„ã€‚\n\n\næ‰€ä»¥å®ƒä¸æ˜¯ REã€‚\n\n\nAckermann å‡½æ•°ï¼šå®ƒæ˜¯å¯è®¡ç®—çš„ï¼Œä½†å¢é•¿å¤ªå¿«ï¼Œä¸æ˜¯åŸå§‹é€’å½’çš„ï¼ˆé¢˜ç›® 7ï¼‰ã€‚\n\n\na^n b^n c^nï¼šç»å…¸çš„éCFLã€‚\n\n\na^n b^nï¼šç»å…¸çš„ CFLï¼ˆä½†éæ­£è§„ï¼‰\n\n\næ­£è§„è¯­è¨€ä¸ä»…è¦æ±‚æœ‰ä¸€ä¸ªdfaèƒ½æ¥å—å®ƒåŒ…å«çš„æ‰€æœ‰å­—ç¬¦ä¸² è¿˜å¿…é¡»æ‹’ç»æ‰€æœ‰ä¸å±äºè¿™ä¸ªè¯­è¨€çš„å­—ç¬¦ä¸²ã€‚å› æ­¤ï¼Œä»–çš„å­é›†ä¸ä¸€å®šæ­£è§„ï¼Œæ¯”å¦‚è¯´è¦ç¬¦åˆæŸç§ç‰¹å®šæ¡ä»¶çš„ï¼Œå°±æ— æ³•è¢«ç­›æŸ¥ã€‚å› æ­¤å¹¶ç›¸å…³çš„åä¾‹å¯ä»¥ç”¨å…¨é›†ã€‚\n\n\nä»»ä½•é›†åˆå’Œç©ºé›†è¿æ¥ç»“æœéƒ½æ˜¯ç©ºé›†ã€‚å› ä¸ºABæ˜¯ä»Aå’ŒBé‡Œå„æŒ‘é€‰ä¸€ä¸ªæ‹¼åœ¨ä¸€èµ·ã€‚å› æ­¤ï¼Œè¿æ¥ç›¸å…³çš„åä¾‹å¯ä»¥ç”¨ç©ºé›†ã€‚ è¿æ¥ç»“æœæ˜¯ç©ºé›†ï¼ˆæ­£è§„ã€‚\n\n\nä¸Šä¸‹æ–‡æ— å…³æ–‡æ³•ï¼šåˆ©ç”¨æ ˆï¼ æ¯”å¦‚xä¸­çš„æ¯ä¸ªå­—ç¬¦å¯¹åº”yä¸­çš„1åˆ°3ä¸ªå­—ç¬¦ã€‚\n\n\n\n\næ­£åˆ™è¯­è¨€: åœ¨å¹¶äº¤è¡¥è¿æ¥æ˜Ÿå·ä¸‹éƒ½å°é—­\n\nå›¾çµæœºæ˜¯å¯æ•°çš„å› ä¸ºå°±æ˜¯ä»£ç å˜›ã€‚ä½†æ˜¯è¯­è¨€æ˜¯åˆ«å¢…çš„ï¼Œæ‰€æœ‰å¯èƒ½çš„å­—ç¬¦ä¸²é›†åˆçš„ç»„åˆæ–¹å¼æ¯”è‡ªç„¶æ•°è¦å¤§çš„å¤šå¾—å¤šã€‚\n+æ˜¯è‡³å°‘æœ‰ä¸€ä¸ª *æ˜¯å¯ä»¥æœ‰0ä¸ª\nå¯è®¡ç®—å‡½æ•°ï¼Œèƒ½è·‘å‡ºç»“æœçš„ã€‚åŸå§‹primitiveé€’å½’å‡½æ•°ï¼Œåªå…è®¸ç”¨å›ºå®šæ¬¡æ•°çš„forå¾ªç¯å†™çš„ç¨‹åºï¼Œæ¯”å¦‚åŠ æ³•ä¹˜æ³•é˜¶ä¹˜æŒ‡æ•°è¿ç®—ç­‰ã€‚\n**Ackermann Function (é˜¿å…‹æ›¼å‡½æ•°)**æ˜¯å¯è®¡ç®—å‡½æ•°ï¼Œä½†ä¸æ˜¯è¿åŠ¿åœ°æŸœå‡½æ•°ï¼Œå› ä¸ºå¿…é¡»ç”¨æ·±åº¦åµŒå¥—é€’å½’æ‰èƒ½è®¡ç®—\nå¦‚æœAæ˜¯REï¼ŒAçš„è¡¥ä¹Ÿæ˜¯REï¼Œé‚£ä¹ˆè¯´æ˜Aå¯åˆ¤å®šï¼ã€‚å¦åˆ™çš„è¯å°±åªæ˜¯å¯è¯†åˆ«ã€‚\nç¬¦å·ï¼š A \\le B è¯»ä½œï¼š â€œé—®é¢˜ A å½’çº¦åˆ° é—®é¢˜ Bâ€ é€šä¿—ç†è§£ï¼š â€œå¤–åŒ…â€ æˆ–è€… â€œå˜èº«â€ã€‚Aæœ‰ä¸€ç§åŠæ³•èƒ½å˜æˆBï¼Œå› æ­¤ è§£å†³é—®é¢˜Açš„éš¾åº¦ï¼Œä¸è¶…è¿‡è§£å†³é—®é¢˜Bçš„éš¾åº¦ã€‚å½’çº¦æ€§è´¨ï¼šä¸¤è¾¹åŒæ—¶å–åï¼Œå½’çº¦å…³ç³»ä¸å˜ã€‚ å³ï¼š\\bar{H_e} \\le \\bar{(\\bar{L})} \\implies \\bar{H_e} \\le Lã€‚\n\n\næ­£åˆ™è¯­è¨€ (RL) åˆ¤å®šä¸è¯æ˜ (çº¦16-20åˆ†)ï¼šåˆ¤æ–­ç»™å®šè¯­è¨€æ˜¯å¦æ­£åˆ™ï¼Œå¹¶ç»™å‡ºç†ç”±ï¼ˆé€šå¸¸ç”¨æ³µå¼•ç† Pumping Lemma è¯æ˜éæ­£åˆ™ï¼‰ã€‚\nCFG ä¸ PDA åŒæ­¥æ„é€  (çº¦18-20åˆ†)ï¼šä¸ºç‰¹å®šè¯­è¨€ï¼ˆå¦‚ anbmcxyR ç±»ï¼‰è®¾è®¡ä¸Šä¸‹æ–‡æ— å…³æ–‡æ³•å’Œä¸‹æ¨è‡ªåŠ¨æœºã€‚\nåŸå§‹é€’å½’å‡½æ•° (PRF) è¯æ˜ (çº¦10-12åˆ†)ï¼šè¯æ˜ç»™å®šå‡½æ•°æ˜¯ PRFï¼Œé€šå¸¸æ¶‰åŠå¤åˆ (Composition) å’Œé€’å½’ (Recursion) æ“ä½œã€‚\nå›¾çµæœº (TM) æ„é€ ä¸ UTM æ¦‚å¿µ (çº¦10-12åˆ†)ï¼šè®¾è®¡åŸºç¡€ TM å®Œæˆè®¡ç®—ï¼Œæˆ–è€ƒå¯Ÿé€šç”¨å›¾çµæœº (UTM) çš„å¸¦å­åˆ†å·¥ä¸æ„ä¹‰ã€‚\nåˆ¤å®šæ€§ä¸è¿˜åŸ (Reducibility) è¯æ˜ (çº¦18åˆ†)ï¼šåˆ¤æ–­è¯­è¨€å±äº R (é€’å½’)ã€RE (é€’å½’å¯æšä¸¾) è¿˜æ˜¯é REï¼Œå¹¶åˆ©ç”¨å½’çº¦ (Reduction) è¿›è¡Œè¯æ˜ï¼ˆé€šå¸¸è¦æ±‚ä¸ç›´æ¥ä½¿ç”¨ Rice å®šç†ï¼‰\n"}}