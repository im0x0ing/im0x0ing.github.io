<!DOCTYPE html>
<html lang="en" dir="ltr"><head><title>lab7 网络应用协议&amp;Socket编程接口</title><meta charset="utf-8"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com"/><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto Sans SC:wght@400;700&amp;family=Noto Serif SC:ital,wght@0,400;0,500;0,700;0,900;1,400;1,500;1,700;1,900&amp;family=JetBrains Mono:wght@400;600&amp;display=swap"/><link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin="anonymous"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="og:site_name" content="ING wiki"/><meta property="og:title" content="lab7 网络应用协议&amp;Socket编程接口"/><meta property="og:type" content="website"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="lab7 网络应用协议&amp;Socket编程接口"/><meta name="twitter:description" content="基本的网络应用软件 自定义的协议规范 Socket编程接口 客户端 服务端 程序界面：命令行或者最简单的窗体 IP 地址：IPv4 (32 bits) or IPv6 (128 bits) 地址，一台计算机可以拥有一个独立的IP 地址；一个局域网也可以拥有一个独立的IP 地址（对外就好像只有一台计算机）。 MAC 地址(48 bits)：每个网卡的MAC 地址在全世界都是独一无二的。多数现实的情况是，一个局域网往往才能拥有一个独立的IP地址；换句话说，IP 地址只能定位到一个局域网，无法定位到具体的一台计算机。 数据包中除了会附带对方的IP 地址，还会附带对方的MAC 地址，当数据包达到局域网..."/><meta property="og:description" content="基本的网络应用软件 自定义的协议规范 Socket编程接口 客户端 服务端 程序界面：命令行或者最简单的窗体 IP 地址：IPv4 (32 bits) or IPv6 (128 bits) 地址，一台计算机可以拥有一个独立的IP 地址；一个局域网也可以拥有一个独立的IP 地址（对外就好像只有一台计算机）。 MAC 地址(48 bits)：每个网卡的MAC 地址在全世界都是独一无二的。多数现实的情况是，一个局域网往往才能拥有一个独立的IP地址；换句话说，IP 地址只能定位到一个局域网，无法定位到具体的一台计算机。 数据包中除了会附带对方的IP 地址，还会附带对方的MAC 地址，当数据包达到局域网..."/><meta property="og:image:alt" content="基本的网络应用软件 自定义的协议规范 Socket编程接口 客户端 服务端 程序界面：命令行或者最简单的窗体 IP 地址：IPv4 (32 bits) or IPv6 (128 bits) 地址，一台计算机可以拥有一个独立的IP 地址；一个局域网也可以拥有一个独立的IP 地址（对外就好像只有一台计算机）。 MAC 地址(48 bits)：每个网卡的MAC 地址在全世界都是独一无二的。多数现实的情况是，一个局域网往往才能拥有一个独立的IP地址；换句话说，IP 地址只能定位到一个局域网，无法定位到具体的一台计算机。 数据包中除了会附带对方的IP 地址，还会附带对方的MAC 地址，当数据包达到局域网..."/><meta property="twitter:domain" content="im0x0ing.github.io"/><meta property="og:url" content="https://im0x0ing.github.io/课程笔记/计算机网络/lab相关/lab7-网络应用协议-and-Socket编程接口"/><meta property="twitter:url" content="https://im0x0ing.github.io/课程笔记/计算机网络/lab相关/lab7-网络应用协议-and-Socket编程接口"/><link rel="icon" href="../../../static/icon.png"/><meta name="description" content="基本的网络应用软件 自定义的协议规范 Socket编程接口 客户端 服务端 程序界面：命令行或者最简单的窗体 IP 地址：IPv4 (32 bits) or IPv6 (128 bits) 地址，一台计算机可以拥有一个独立的IP 地址；一个局域网也可以拥有一个独立的IP 地址（对外就好像只有一台计算机）。 MAC 地址(48 bits)：每个网卡的MAC 地址在全世界都是独一无二的。多数现实的情况是，一个局域网往往才能拥有一个独立的IP地址；换句话说，IP 地址只能定位到一个局域网，无法定位到具体的一台计算机。 数据包中除了会附带对方的IP 地址，还会附带对方的MAC 地址，当数据包达到局域网..."/><meta name="generator" content="Quartz"/><link href="../../../index.css" rel="stylesheet" type="text/css" data-persist="true"/><style>.expand-button {
  position: absolute;
  display: flex;
  float: right;
  padding: 0.4rem;
  margin: 0.3rem;
  right: 0;
  color: var(--gray);
  border-color: var(--dark);
  background-color: var(--light);
  border: 1px solid;
  border-radius: 5px;
  opacity: 0;
  transition: 0.2s;
}
.expand-button > svg {
  fill: var(--light);
  filter: contrast(0.3);
}
.expand-button:hover {
  cursor: pointer;
  border-color: var(--secondary);
}
.expand-button:focus {
  outline: 0;
}

pre:hover > .expand-button {
  opacity: 1;
  transition: 0.2s;
}

#mermaid-container {
  position: fixed;
  contain: layout;
  z-index: 999;
  left: 0;
  top: 0;
  width: 100vw;
  height: 100vh;
  overflow: hidden;
  display: none;
  backdrop-filter: blur(4px);
  background: rgba(0, 0, 0, 0.5);
}
#mermaid-container.active {
  display: inline-block;
}
#mermaid-container > #mermaid-space {
  border: 1px solid var(--lightgray);
  background-color: var(--light);
  border-radius: 5px;
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  height: 80vh;
  width: 80vw;
  overflow: hidden;
}
#mermaid-container > #mermaid-space > .mermaid-content {
  padding: 2rem;
  position: relative;
  transform-origin: 0 0;
  transition: transform 0.1s ease;
  overflow: visible;
  min-height: 200px;
  min-width: 200px;
}
#mermaid-container > #mermaid-space > .mermaid-content pre {
  margin: 0;
  border: none;
}
#mermaid-container > #mermaid-space > .mermaid-content svg {
  max-width: none;
  height: auto;
}
#mermaid-container > #mermaid-space > .mermaid-controls {
  position: absolute;
  bottom: 20px;
  right: 20px;
  display: flex;
  gap: 8px;
  padding: 8px;
  background: var(--light);
  border: 1px solid var(--lightgray);
  border-radius: 6px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  z-index: 2;
}
#mermaid-container > #mermaid-space > .mermaid-controls .mermaid-control-button {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 32px;
  height: 32px;
  padding: 0;
  border: 1px solid var(--lightgray);
  background: var(--light);
  color: var(--dark);
  border-radius: 4px;
  cursor: pointer;
  font-size: 16px;
  font-family: var(--bodyFont);
  transition: all 0.2s ease;
}
#mermaid-container > #mermaid-space > .mermaid-controls .mermaid-control-button:hover {
  background: var(--lightgray);
}
#mermaid-container > #mermaid-space > .mermaid-controls .mermaid-control-button:active {
  transform: translateY(1px);
}
#mermaid-container > #mermaid-space > .mermaid-controls .mermaid-control-button:nth-child(2) {
  width: auto;
  padding: 0 12px;
  font-size: 14px;
}
/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VSb290IjoiL2hvbWUvcnVubmVyL3dvcmsvaW0weDBpbmctYmxvZy1wcml2YXRlL2ltMHgwaW5nLWJsb2ctcHJpdmF0ZS9xdWFydHovY29tcG9uZW50cy9zdHlsZXMiLCJzb3VyY2VzIjpbIm1lcm1haWQuaW5saW5lLnNjc3MiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7RUFDRTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTs7QUFFQTtFQUNFO0VBQ0E7O0FBR0Y7RUFDRTtFQUNBOztBQUdGO0VBQ0U7OztBQUtGO0VBQ0U7RUFDQTs7O0FBSUo7RUFDRTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBOztBQUVBO0VBQ0U7O0FBR0Y7RUFDRTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTs7QUFFQTtFQUNFO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBOztBQUVBO0VBQ0U7RUFDQTs7QUFHRjtFQUNFO0VBQ0E7O0FBSUo7RUFDRTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBOztBQUVBO0VBQ0U7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTs7QUFFQTtFQUNFOztBQUdGO0VBQ0U7O0FBSUY7RUFDRTtFQUNBO0VBQ0EiLCJzb3VyY2VzQ29udGVudCI6WyIuZXhwYW5kLWJ1dHRvbiB7XG4gIHBvc2l0aW9uOiBhYnNvbHV0ZTtcbiAgZGlzcGxheTogZmxleDtcbiAgZmxvYXQ6IHJpZ2h0O1xuICBwYWRkaW5nOiAwLjRyZW07XG4gIG1hcmdpbjogMC4zcmVtO1xuICByaWdodDogMDsgLy8gTk9URTogcmlnaHQgd2lsbCBiZSBzZXQgaW4gbWVybWFpZC5pbmxpbmUudHNcbiAgY29sb3I6IHZhcigtLWdyYXkpO1xuICBib3JkZXItY29sb3I6IHZhcigtLWRhcmspO1xuICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1saWdodCk7XG4gIGJvcmRlcjogMXB4IHNvbGlkO1xuICBib3JkZXItcmFkaXVzOiA1cHg7XG4gIG9wYWNpdHk6IDA7XG4gIHRyYW5zaXRpb246IDAuMnM7XG5cbiAgJiA+IHN2ZyB7XG4gICAgZmlsbDogdmFyKC0tbGlnaHQpO1xuICAgIGZpbHRlcjogY29udHJhc3QoMC4zKTtcbiAgfVxuXG4gICY6aG92ZXIge1xuICAgIGN1cnNvcjogcG9pbnRlcjtcbiAgICBib3JkZXItY29sb3I6IHZhcigtLXNlY29uZGFyeSk7XG4gIH1cblxuICAmOmZvY3VzIHtcbiAgICBvdXRsaW5lOiAwO1xuICB9XG59XG5cbnByZSB7XG4gICY6aG92ZXIgPiAuZXhwYW5kLWJ1dHRvbiB7XG4gICAgb3BhY2l0eTogMTtcbiAgICB0cmFuc2l0aW9uOiAwLjJzO1xuICB9XG59XG5cbiNtZXJtYWlkLWNvbnRhaW5lciB7XG4gIHBvc2l0aW9uOiBmaXhlZDtcbiAgY29udGFpbjogbGF5b3V0O1xuICB6LWluZGV4OiA5OTk7XG4gIGxlZnQ6IDA7XG4gIHRvcDogMDtcbiAgd2lkdGg6IDEwMHZ3O1xuICBoZWlnaHQ6IDEwMHZoO1xuICBvdmVyZmxvdzogaGlkZGVuO1xuICBkaXNwbGF5OiBub25lO1xuICBiYWNrZHJvcC1maWx0ZXI6IGJsdXIoNHB4KTtcbiAgYmFja2dyb3VuZDogcmdiYSgwLCAwLCAwLCAwLjUpO1xuXG4gICYuYWN0aXZlIHtcbiAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7XG4gIH1cblxuICAmID4gI21lcm1haWQtc3BhY2Uge1xuICAgIGJvcmRlcjogMXB4IHNvbGlkIHZhcigtLWxpZ2h0Z3JheSk7XG4gICAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tbGlnaHQpO1xuICAgIGJvcmRlci1yYWRpdXM6IDVweDtcbiAgICBwb3NpdGlvbjogZml4ZWQ7XG4gICAgdG9wOiA1MCU7XG4gICAgbGVmdDogNTAlO1xuICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlKC01MCUsIC01MCUpO1xuICAgIGhlaWdodDogODB2aDtcbiAgICB3aWR0aDogODB2dztcbiAgICBvdmVyZmxvdzogaGlkZGVuO1xuXG4gICAgJiA+IC5tZXJtYWlkLWNvbnRlbnQge1xuICAgICAgcGFkZGluZzogMnJlbTtcbiAgICAgIHBvc2l0aW9uOiByZWxhdGl2ZTtcbiAgICAgIHRyYW5zZm9ybS1vcmlnaW46IDAgMDtcbiAgICAgIHRyYW5zaXRpb246IHRyYW5zZm9ybSAwLjFzIGVhc2U7XG4gICAgICBvdmVyZmxvdzogdmlzaWJsZTtcbiAgICAgIG1pbi1oZWlnaHQ6IDIwMHB4O1xuICAgICAgbWluLXdpZHRoOiAyMDBweDtcblxuICAgICAgcHJlIHtcbiAgICAgICAgbWFyZ2luOiAwO1xuICAgICAgICBib3JkZXI6IG5vbmU7XG4gICAgICB9XG5cbiAgICAgIHN2ZyB7XG4gICAgICAgIG1heC13aWR0aDogbm9uZTtcbiAgICAgICAgaGVpZ2h0OiBhdXRvO1xuICAgICAgfVxuICAgIH1cblxuICAgICYgPiAubWVybWFpZC1jb250cm9scyB7XG4gICAgICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gICAgICBib3R0b206IDIwcHg7XG4gICAgICByaWdodDogMjBweDtcbiAgICAgIGRpc3BsYXk6IGZsZXg7XG4gICAgICBnYXA6IDhweDtcbiAgICAgIHBhZGRpbmc6IDhweDtcbiAgICAgIGJhY2tncm91bmQ6IHZhcigtLWxpZ2h0KTtcbiAgICAgIGJvcmRlcjogMXB4IHNvbGlkIHZhcigtLWxpZ2h0Z3JheSk7XG4gICAgICBib3JkZXItcmFkaXVzOiA2cHg7XG4gICAgICBib3gtc2hhZG93OiAwIDJweCA0cHggcmdiYSgwLCAwLCAwLCAwLjEpO1xuICAgICAgei1pbmRleDogMjtcblxuICAgICAgLm1lcm1haWQtY29udHJvbC1idXR0b24ge1xuICAgICAgICBkaXNwbGF5OiBmbGV4O1xuICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyO1xuICAgICAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjtcbiAgICAgICAgd2lkdGg6IDMycHg7XG4gICAgICAgIGhlaWdodDogMzJweDtcbiAgICAgICAgcGFkZGluZzogMDtcbiAgICAgICAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tbGlnaHRncmF5KTtcbiAgICAgICAgYmFja2dyb3VuZDogdmFyKC0tbGlnaHQpO1xuICAgICAgICBjb2xvcjogdmFyKC0tZGFyayk7XG4gICAgICAgIGJvcmRlci1yYWRpdXM6IDRweDtcbiAgICAgICAgY3Vyc29yOiBwb2ludGVyO1xuICAgICAgICBmb250LXNpemU6IDE2cHg7XG4gICAgICAgIGZvbnQtZmFtaWx5OiB2YXIoLS1ib2R5Rm9udCk7XG4gICAgICAgIHRyYW5zaXRpb246IGFsbCAwLjJzIGVhc2U7XG5cbiAgICAgICAgJjpob3ZlciB7XG4gICAgICAgICAgYmFja2dyb3VuZDogdmFyKC0tbGlnaHRncmF5KTtcbiAgICAgICAgfVxuXG4gICAgICAgICY6YWN0aXZlIHtcbiAgICAgICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoMXB4KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFN0eWxlIHRoZSByZXNldCBidXR0b24gZGlmZmVyZW50bHlcbiAgICAgICAgJjpudGgtY2hpbGQoMikge1xuICAgICAgICAgIHdpZHRoOiBhdXRvO1xuICAgICAgICAgIHBhZGRpbmc6IDAgMTJweDtcbiAgICAgICAgICBmb250LXNpemU6IDE0cHg7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cbn1cbiJdfQ== */</style><link href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" rel="stylesheet" type="text/css" data-persist="true"/><script src="../../../prescript.js" type="application/javascript" data-persist="true"></script><script type="application/javascript" data-persist="true">const fetchData = fetch("../../../static/contentIndex.json").then(data => data.json())</script><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="https://im0x0ing.github.io/index.xml"/><meta property="og:image:width" content="1200"/><meta property="og:image:height" content="630"/><meta property="og:image" content="https://im0x0ing.github.io/课程笔记/计算机网络/lab相关/lab7-网络应用协议-and-Socket编程接口-og-image.webp"/><meta property="og:image:url" content="https://im0x0ing.github.io/课程笔记/计算机网络/lab相关/lab7-网络应用协议-and-Socket编程接口-og-image.webp"/><meta name="twitter:image" content="https://im0x0ing.github.io/课程笔记/计算机网络/lab相关/lab7-网络应用协议-and-Socket编程接口-og-image.webp"/><meta property="og:image:type" content="image/.webp"/></head><body data-slug="课程笔记/计算机网络/lab相关/lab7-网络应用协议-and-Socket编程接口"><div id="quartz-root" class="page"><div id="quartz-body"><div class="left sidebar"><h2 class="page-title"><a href="../../..">ING wiki</a></h2><div class="spacer mobile-only"></div><div class="flex-component" style="flex-direction: row; flex-wrap: nowrap; gap: 1rem;"><div style="flex-grow: 1; flex-shrink: 1; flex-basis: auto; order: 0; align-self: center; justify-self: center;"><div class="search"><button class="search-button"><svg role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title>Search</title><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"></path><circle cx="8" cy="8" r="7"></circle></g></svg><p>Search</p></button><div class="search-container"><div class="search-space"><input autocomplete="off" class="search-bar" name="search" type="text" aria-label="Search for something" placeholder="Search for something"/><div class="search-layout" data-preview="true"></div></div></div></div></div><div style="flex-grow: 0; flex-shrink: 1; flex-basis: auto; order: 0; align-self: center; justify-self: center;"><button class="darkmode"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" class="dayIcon" x="0px" y="0px" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35" xml:space="preserve" aria-label="Dark mode"><title>Dark mode</title><path d="M6,17.5C6,16.672,5.328,16,4.5,16h-3C0.672,16,0,16.672,0,17.5    S0.672,19,1.5,19h3C5.328,19,6,18.328,6,17.5z M7.5,26c-0.414,0-0.789,0.168-1.061,0.439l-2,2C4.168,28.711,4,29.086,4,29.5    C4,30.328,4.671,31,5.5,31c0.414,0,0.789-0.168,1.06-0.44l2-2C8.832,28.289,9,27.914,9,27.5C9,26.672,8.329,26,7.5,26z M17.5,6    C18.329,6,19,5.328,19,4.5v-3C19,0.672,18.329,0,17.5,0S16,0.672,16,1.5v3C16,5.328,16.671,6,17.5,6z M27.5,9    c0.414,0,0.789-0.168,1.06-0.439l2-2C30.832,6.289,31,5.914,31,5.5C31,4.672,30.329,4,29.5,4c-0.414,0-0.789,0.168-1.061,0.44    l-2,2C26.168,6.711,26,7.086,26,7.5C26,8.328,26.671,9,27.5,9z M6.439,8.561C6.711,8.832,7.086,9,7.5,9C8.328,9,9,8.328,9,7.5    c0-0.414-0.168-0.789-0.439-1.061l-2-2C6.289,4.168,5.914,4,5.5,4C4.672,4,4,4.672,4,5.5c0,0.414,0.168,0.789,0.439,1.06    L6.439,8.561z M33.5,16h-3c-0.828,0-1.5,0.672-1.5,1.5s0.672,1.5,1.5,1.5h3c0.828,0,1.5-0.672,1.5-1.5S34.328,16,33.5,16z     M28.561,26.439C28.289,26.168,27.914,26,27.5,26c-0.828,0-1.5,0.672-1.5,1.5c0,0.414,0.168,0.789,0.439,1.06l2,2    C28.711,30.832,29.086,31,29.5,31c0.828,0,1.5-0.672,1.5-1.5c0-0.414-0.168-0.789-0.439-1.061L28.561,26.439z M17.5,29    c-0.829,0-1.5,0.672-1.5,1.5v3c0,0.828,0.671,1.5,1.5,1.5s1.5-0.672,1.5-1.5v-3C19,29.672,18.329,29,17.5,29z M17.5,7    C11.71,7,7,11.71,7,17.5S11.71,28,17.5,28S28,23.29,28,17.5S23.29,7,17.5,7z M17.5,25c-4.136,0-7.5-3.364-7.5-7.5    c0-4.136,3.364-7.5,7.5-7.5c4.136,0,7.5,3.364,7.5,7.5C25,21.636,21.636,25,17.5,25z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" class="nightIcon" x="0px" y="0px" viewBox="0 0 100 100" style="enable-background:new 0 0 100 100" xml:space="preserve" aria-label="Light mode"><title>Light mode</title><path d="M96.76,66.458c-0.853-0.852-2.15-1.064-3.23-0.534c-6.063,2.991-12.858,4.571-19.655,4.571  C62.022,70.495,50.88,65.88,42.5,57.5C29.043,44.043,25.658,23.536,34.076,6.47c0.532-1.08,0.318-2.379-0.534-3.23  c-0.851-0.852-2.15-1.064-3.23-0.534c-4.918,2.427-9.375,5.619-13.246,9.491c-9.447,9.447-14.65,22.008-14.65,35.369  c0,13.36,5.203,25.921,14.65,35.368s22.008,14.65,35.368,14.65c13.361,0,25.921-5.203,35.369-14.65  c3.872-3.871,7.064-8.328,9.491-13.246C97.826,68.608,97.611,67.309,96.76,66.458z"></path></svg></button></div><div style="flex-grow: 0; flex-shrink: 1; flex-basis: auto; order: 0; align-self: center; justify-self: center;"><button class="readermode"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" class="readerIcon" fill="currentColor" stroke="currentColor" stroke-width="0.2" stroke-linecap="round" stroke-linejoin="round" width="64px" height="64px" viewBox="0 0 24 24" aria-label="Reader mode"><title>Reader mode</title><g transform="translate(-1.8, -1.8) scale(1.15, 1.2)"><path d="M8.9891247,2.5 C10.1384702,2.5 11.2209868,2.96705384 12.0049645,3.76669482 C12.7883914,2.96705384 13.8709081,2.5 15.0202536,2.5 L18.7549359,2.5 C19.1691495,2.5 19.5049359,2.83578644 19.5049359,3.25 L19.5046891,4.004 L21.2546891,4.00457396 C21.6343849,4.00457396 21.9481801,4.28672784 21.9978425,4.6528034 L22.0046891,4.75457396 L22.0046891,20.25 C22.0046891,20.6296958 21.7225353,20.943491 21.3564597,20.9931534 L21.2546891,21 L2.75468914,21 C2.37499337,21 2.06119817,20.7178461 2.01153575,20.3517706 L2.00468914,20.25 L2.00468914,4.75457396 C2.00468914,4.37487819 2.28684302,4.061083 2.65291858,4.01142057 L2.75468914,4.00457396 L4.50368914,4.004 L4.50444233,3.25 C4.50444233,2.87030423 4.78659621,2.55650904 5.15267177,2.50684662 L5.25444233,2.5 L8.9891247,2.5 Z M4.50368914,5.504 L3.50468914,5.504 L3.50468914,19.5 L10.9478955,19.4998273 C10.4513189,18.9207296 9.73864328,18.5588115 8.96709342,18.5065584 L8.77307039,18.5 L5.25444233,18.5 C4.87474657,18.5 4.56095137,18.2178461 4.51128895,17.8517706 L4.50444233,17.75 L4.50368914,5.504 Z M19.5049359,17.75 C19.5049359,18.1642136 19.1691495,18.5 18.7549359,18.5 L15.2363079,18.5 C14.3910149,18.5 13.5994408,18.8724714 13.0614828,19.4998273 L20.5046891,19.5 L20.5046891,5.504 L19.5046891,5.504 L19.5049359,17.75 Z M18.0059359,3.999 L15.0202536,4 L14.8259077,4.00692283 C13.9889509,4.06666544 13.2254227,4.50975805 12.7549359,5.212 L12.7549359,17.777 L12.7782651,17.7601316 C13.4923805,17.2719483 14.3447024,17 15.2363079,17 L18.0059359,16.999 L18.0056891,4.798 L18.0033792,4.75457396 L18.0056891,4.71 L18.0059359,3.999 Z M8.9891247,4 L6.00368914,3.999 L6.00599909,4.75457396 L6.00599909,4.75457396 L6.00368914,4.783 L6.00368914,16.999 L8.77307039,17 C9.57551536,17 10.3461406,17.2202781 11.0128313,17.6202194 L11.2536891,17.776 L11.2536891,5.211 C10.8200889,4.56369974 10.1361548,4.13636104 9.37521067,4.02745763 L9.18347055,4.00692283 L8.9891247,4 Z"></path></g></svg></button></div></div><div class="explorer" data-behavior="link" data-collapsed="collapsed" data-savestate="true" data-data-fns="{&quot;order&quot;:[&quot;filter&quot;,&quot;map&quot;,&quot;sort&quot;],&quot;sortFn&quot;:&quot;(a,b)=>!a.isFolder&amp;&amp;!b.isFolder||a.isFolder&amp;&amp;b.isFolder?a.displayName.localeCompare(b.displayName,void 0,{numeric:!0,sensitivity:\&quot;base\&quot;}):!a.isFolder&amp;&amp;b.isFolder?1:-1&quot;,&quot;filterFn&quot;:&quot;node=>node.slug===\&quot;\&quot;||node.slug.startsWith(\&quot;\\u8BFE\\u7A0B\\u7B14\\u8BB0\&quot;)&quot;,&quot;mapFn&quot;:&quot;node=>node&quot;}"><button type="button" class="explorer-toggle mobile-explorer hide-until-loaded" data-mobile="true" aria-controls="explorer-87"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide-menu"><line x1="4" x2="20" y1="12" y2="12"></line><line x1="4" x2="20" y1="6" y2="6"></line><line x1="4" x2="20" y1="18" y2="18"></line></svg></button><button type="button" class="title-button explorer-toggle desktop-explorer" data-mobile="false" aria-expanded="true"><h2>Explorer</h2><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="fold"><polyline points="6 9 12 15 18 9"></polyline></svg></button><div id="explorer-87" class="explorer-content" aria-expanded="false" role="group"><ul class="explorer-ul overflow" id="list-3"><li class="overflow-end"></li></ul></div><template id="template-file"><li><a href="#"></a></li></template><template id="template-folder"><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div><button class="folder-button"><span class="folder-title"></span></button></div></div><div class="folder-outer"><ul class="content"></ul></div></li></template></div></div><div class="center"><div class="page-header"><header><nav class="my-navbar "><div class="links"><a href="/课程笔记/">课程笔记</a><a href="/技术积累/">技术积累</a><a href="/工具使用/">工具使用</a><a href="/生活杂谈/">生活杂谈</a></div></nav></header><div class="popover-hint"><nav class="breadcrumb-container" aria-label="breadcrumbs"><div class="breadcrumb-element"><a href="../../../">Home</a><p> ❯ </p></div><div class="breadcrumb-element"><a href="../../../课程笔记/">课程笔记</a><p> ❯ </p></div><div class="breadcrumb-element"><a href="../../../课程笔记/计算机网络/">计算机网络</a><p> ❯ </p></div><div class="breadcrumb-element"><a href="../../../课程笔记/计算机网络/lab相关/">lab相关</a><p> ❯ </p></div><div class="breadcrumb-element"><a href>lab7 网络应用协议&amp;Socket编程接口</a></div></nav><h1 class="article-title">lab7 网络应用协议&amp;Socket编程接口</h1><p show-comma="true" class="content-meta"><time datetime="2025-12-09T10:10:00.000Z">Dec 09, 2025</time><span>27 min read</span></p></div></div><article class="popover-hint"><p>基本的网络应用软件</p>
<p>自定义的协议规范<br/>
Socket编程接口</p>
<p>客户端<br/>
服务端<br/>
程序界面：命令行或者最简单的窗体</p>
<ul>
<li><strong>IP 地址</strong>：IPv4 (32 bits) or IPv6 (128 bits) 地址，一台计算机可以拥有一个独立的IP 地址；一个局域网也可以拥有一个独立的IP 地址（对外就好像只有一台计算机）。</li>
<li><strong>MAC 地址(48 bits)</strong>：每个网卡的MAC 地址在全世界都是独一无二的。多数现实的情况是，一个局域网往往才能拥有一个独立的IP地址；换句话说，IP 地址只能定位到一个局域网，无法定位到具体的一台计算机。
<ul>
<li>数据包中除了会附带对方的IP 地址，还会附带对方的MAC 地址，当数据包达到局域网以后，路由器/交换机会根据数据包中的MAC 地址找到对应的计算机，然后把数据包转交给它，这样就完成了数据的传递。</li>
</ul>
</li>
<li><strong>端口号(16 bits)</strong>：一台计算机可以同时提供多种网络服务，例如Web 服务（网站）、FTP 服务（文件传输服务）、SMTP 服务（邮箱服务）等，仅有IP 地址和MAC 地址，计算机虽然可以正确接收到数据包，但是却不知道要将数据包交给哪个网络应用程序来处理。为了区分不同的网络应用程序，计算机会为每个网络程序分配一个独一无二的端口号（Port Number）。端口（Port）是一个虚拟的、逻辑上的概念。可以将某台计算机看成是一个居民楼，而每个网络应用程序是居住在这个楼的居民，为了能把信件投送到家，必须在投送地址上写明房间号。
<ul>
<li>注意一般0-1023端口是分配给一些特定的网络应用服务，如
<ul>
<li>http (TCP) 服务的端口号是80，https(TCP)服务的端口号是443</li>
<li>DNS(UDP)服务的端口号是53</li>
<li>FTP 服务的端口号是21</li>
<li>SMTP 服务的端口号是25 (POP3 101)</li>
</ul>
</li>
<li>我们实验中端口号请选择1024-65535之间的数值（以自己学号的后四位作为服务器端的监听端口号，如果后四位中的第一位为零，则采用1XXXX）。</li>
</ul>
</li>
</ul>
<h2 id="socket">socket<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#socket" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>socket 的原意是“插座”，在计算机通信领域，socket 被翻译为“套接字”，它是计算机之间进行通信的一种约定或一种方式。通过socket 这种约定，一台计算机可以接收其他计算机的数据，也可以向其他计算机发送数据。</p>
<blockquote class="callout note" data-callout="note">
<div class="callout-title">
                  <div class="callout-icon"></div>
                  <div class="callout-title-inner"><p>UNIX/Linux 中的socket 是什么？ </p></div>
                  
                </div>
<div class="callout-content">
<ul>
<li>在UNIX/Linux 系统中，为了统一对各种硬件的操作，简化接口，不同的硬件设备也都被看成一个文件。对这些文件的操作，等同于对磁盘上普通文件的操作。
<ul>
<li>通常用0 来表示标准输入文件（stdin），它对应的硬件设备就是键盘；</li>
<li>通常用1 来表示标准输出文件（stdout），它对应的硬件设备就是显示器。</li>
</ul>
</li>
<li>为了表示和区分已经打开的文件，UNIX/Linux 会给每个文件分配一个ID，这个ID 就是一个整数，被称为文件描述符（File Descriptor）。</li>
<li>网络连接也是一个文件，它也有文件描述符！</li>
<li>我们可以通过socket() 函数来创建一个网络连接，或者说打开一个网络文件，socket() 的返回值就是文件描述符。
<ul>
<li>有了文件描述符，我们就可以使用普通的文件操作函数来传输数据了</li>
<li>用read() 读取从远程计算机传来的数据；</li>
<li>用write() 向远程计算机写入数据。</li>
</ul>
</li>
</ul>
</div>
</blockquote>
<blockquote class="callout note" data-callout="note">
<div class="callout-title">
                  <div class="callout-icon"></div>
                  <div class="callout-title-inner"><p>Window 系统中的socket 是什么？ </p></div>
                  
                </div>
<div class="callout-content">
<ul>
<li>Windows 也有类似“文件描述符”的概念，但通常被称为“文件句柄”。</li>
<li>与UNIX/Linux 不同的是，Windows 会区分socket 和文件，Windows 就把socket 当做一个网络连接来对待，因此需要调用专门针对socket 而设计的数据传输函数，针对普通文件的输入输出函数就无效了。</li>
</ul>
</div>
</blockquote>
<h3 id="socket的种类">socket的种类<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#socket的种类" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<h5 id="流格式套接字sock_stream">流格式套接字（SOCK_STREAM）<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#流格式套接字sock_stream" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h5>
<ul>
<li>数据在传输过程中不会消失；</li>
<li>数据是按照顺序传输的；</li>
<li>数据的发送和接收不是同步的(流格式套接字的内部有一个缓冲区（是一个字符数组），通过socket 传输的数据将保存到这个缓冲区。接收端在收到数据后并不一定立即读取，<span class="text-highlight">只要数据不超过缓冲区的容量，接收端有可能在缓冲区被填满以后一次性地读取，也可能分成好几次读取。</span>)</li>
<li>Example: HTTP (TCP)</li>
</ul>

<h5 id="数据报格式套接字sock_dgram">数据报格式套接字（SOCK_DGRAM）<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#数据报格式套接字sock_dgram" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h5>
<p>计算机只管传输数据，不作数据校验，如果数据在传输中损坏，或者没有到达另一台计算机，是没有办法补救的。也就是说，数据错了就错了，无法重传。</p>
<ul>
<li>强调快速传输而非传输顺序；</li>
<li>传输的数据可能丢失也可能损毁；</li>
<li>限制每次传输的数据大小；</li>
<li>数据的发送和接收是同步的</li>
<li>Example: QQ视频和语音聊天(UDP)</li>
</ul>
<p>我们所说的socket编程，是在传输层的基础上，所以可以使用TCP/UDP 协议。但是实验要求TCP</p>
<h3 id="constructing-message">Constructing Message<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#constructing-message" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<h4 id="byte-ordering">Byte Ordering<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#byte-ordering" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<ul>
<li>Different machines / OS’s use different word orderings
<ul>
<li>Little-endian: lower bytes first<img src="../../../Pasted-image-20250928191411.png" width="auto" height="auto" alt/></li>
<li>Big-endian: higher bytes first<img src="../../../Pasted-image-20250928191407.png" width="auto" height="auto" alt/></li>
</ul>
</li>
</ul>
<p>注意不同类型的主机字节顺序不同（但是网络传输过程中都是大端的顺序）<img src="../../../Pasted-image-20250928191331.png" width="auto" height="auto" alt/>为了可移植性，需要使用四个函数：<br/>
<img src="../../../Pasted-image-20250928191625.png" width="auto" height="auto" alt/><br/>
s：16bits的port numbers<br/>
l：32bits的port numbers</p>
<h4 id="alignment--padding">Alignment &amp; Padding<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#alignment--padding" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<p>对齐和置零<br/>
Alignment：把数据放置在内存中地址等于字节倍数的位置，这样可以提高系统性能<br/>
Padding：填充插入额外字节<br/>
<img src="../../../Pasted-image-20250928192147.png" width="104" height="auto" alt/><img src="../../../Pasted-image-20250928192159.png" width="350" height="auto" alt/><img src="../../../Pasted-image-20250928192220.png" width="350" height="auto" alt/></p>
<h4 id="framing--parsing">Framing &amp; Parsing<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#framing--parsing" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<p>Framing<br/>
Parsing</p>
<h2 id="具体的编程">具体的编程<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#具体的编程" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>Many network applications consists of a pair programs ——a client program and a server program ——residing in two different end systems（web or ftp）</p>
<p>程序执行时会创建一个客户端进程和一个服务器进程，这些进程通过从套接字读取和向套接字写入来相互通信。</p>
<ol>
<li>决定哪种传输层协议 TCP/UDP
<ol>
<li>
<p>TCP是面向链接的，提供一个可靠的字节流信道（TCP是内驻在操作系统里面，我们要写的是网络层的协议）<img src="../../../Pasted-image-20250928192726.png" width="auto" height="auto" alt/></p>
</li>
<li>
<p>UDP是面向无链接的，将独立的数据包从一个端系统发送到另一个端系统，不保证任何交付性</p>
</li>
</ol>
</li>
</ol>
<h5 id="tcp数据报结构">TCP数据报结构<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#tcp数据报结构" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h5>
<p>• 1) 序号：Seq（Sequence Number）序号占32位，用来标识从计算机A发送到计算机B的数据包的序号，计算机发送数据时对此进行标记。<strong>每发一个字节都有一个独立的序号</strong><br/>
• 2) 确认号：Ack（Acknowledge Number）确认号占32位，客户端和服务器端都可以发送，Ack = Seq + 1。<strong>确认被接收</strong><br/>
• 3) 标志位：每个标志位占用1Bit，共有6个，分别为 URG、ACK、PSH、RST、SYN、FIN，具体含义如下：<br/>
– URG 紧急指针（urgent pointer）有效。<br/>
– <span class="text-highlight">ACK 确认序号有效（1 ）。</span><br/>
– PSH 接收方应该尽快将这个报文交给应用层。<br/>
– RST 重置连接。<br/>
– <span class="text-highlight">SYN 建立一个新连接（1 ）。</span><br/>
– FIN 断开一个连接。<br/>
<img src="../../../Pasted-image-20250928192942.png" width="auto" height="auto" alt/></p>

<h4 id="tcp三次握手建立连接">TCP三次握手建立连接<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#tcp三次握手建立连接" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<ol>
<li>数据在传输前要建立连接 （connect() 函数，为了保证ip地址、端口、物理链路正确），传输完毕后还要断开连接。</li>
<li>TCP建立连接时要传输三个数据包，俗称三次握手（Three-wayHandshaking）。可以形象的比喻为下面的对话：
<ul>
<li><span class="orange-comment">[Shake1]</span> 套接字A：“你好，套接字B，我这里有数据要传送给你，建立连接吧。”</li>
<li><span class="orange-comment">[Shake2]</span> 套接字B：“好的，我这边已准备就绪。”</li>
<li><span class="orange-comment">[Shake3]</span> 套接字A：“谢谢你受理我的请求。”</li>
</ul>
</li>
</ol>
<p><strong>建立连接时</strong>需要进行三次握手<br/>
<img src="../../../Pasted-image-20250928193637.png" width="auto" height="auto" alt/></p>
<p><strong>建立链接成功后</strong>进行数据传输<br/>
<img src="../../../Pasted-image-20250928193822.png" width="auto" height="auto" alt/></p>
<p>当数据包在传输的过程中发生丢失的时候，会进行重传。如何发现丢失的呢？<img src="../../../Pasted-image-20250928193948.png" width="auto" height="auto" alt/>RTT：round trip time</p>
<h4 id="tcp四次握手断开连接">TCP四次握手断开连接<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#tcp四次握手断开连接" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<p>建立连接非常重要，它是数据正确传输的前提；断开连接同样重要，它让计算机释放不再使用的资源。如果连接不能正常断开，不仅会造成数据传输错误，还会导致套接字不能关闭，持续占用资源，如果并发量高，服务器压力堪忧。<br/>
建立连接需要三次握手，断开连接需要四次握手，可以形象的比喻为下面的对话：</p>
<ul>
<li>
<p><span class="orange-comment">[Shake 1]</span> 套接字A：“任务处理完毕，我希望断开连接。”</p>
</li>
<li>
<p><span class="orange-comment">[Shake 2]</span> 套接字B：“哦，是吗？请稍等，我准备一下。”</p>
</li>
<li>
<p>等待片刻后……</p>
</li>
<li>
<p><span class="orange-comment">[Shake 3]</span> 套接字B：“我准备好了，可以断开连接了。”</p>
</li>
<li>
<p><span class="orange-comment">[Shake 4]</span> 套接字A：“好的，谢谢合作。”<br/>
<img src="../../../Pasted-image-20250928194839.png" width="auto" height="auto" alt/><br/>
5000和7000没关联<br/>
第二个fin包：seq值+1了，但是ack值没有进行变化。因为客户端在ack和fin包之间没有发出新的数据包给服务器端。在这个包里fin会置1。<br/>
第二个ack包：在上一个fin包的seq基础上7001+1</p>
</li>
<li>
<p>客户端最后一次发送 ACK包后进入 TIME_WAIT 状态，而不是直接进入 CLOSED 状态关闭连接，这是为什么呢？</p>
<ul>
<li>TCP 是<span class="text-highlight">面向连接</span>的传输方式，必须保证数据能够正确到达目标机器，不能丢失或出错，而网络是动态、不稳定的，数据随时可能被会毁坏或丢弃，所以机器A每次向机器B发送数据包后，都要求机器B“确认” ，回传ACK包，告诉机器A我收到了，这样机器A才能知道数据传送成功了。如果机器B没有回传ACK包，机器A会重新发送，直到机器B回传ACK包。</li>
</ul>
</li>
<li>
<p>客户端最后一次向服务器回传ACK包时，有可能会因为网络问题导致服务器收不到，服务器会再次发送 FIN 包，如果这时客户端完全关闭了连接，那么服务器无论如何也收不到ACK包了，所以客户端需要等待片刻、确认对方收到ACK包后才能进入CLOSED状态。那么，要等待多久呢？（就是说经过一段时间没发出有问题的信号，才能确认没问题）</p>
<ul>
<li><span class="text-highlight">数据包在网络中是有生存时间的，超过这个时间还未到达目标主机就会被丢弃，并通知源主机。</span>这称为报文最大生存时间（MSL，Maximum Segment Lifetime）。TIME_WAIT 要等待 2MSL才会进入 CLOSED 状态。ACK 包到达服务器需要 MSL 时间，服务器重传 FIN 包也需要 MSL 时间，2MSL 是数据包往返的最大时间，如果 2MSL 后还未收到服务器重传的 FIN 包，就说明服务器已经收到了 ACK 包。
<ul>
<li>如果fin包也没送到呢？实际上，ack没达到服务器端的话，会通知客户端重发的，也就不会有服务器发送fin包的问题了。</li>
</ul>
</li>
</ul>
</li>
</ul>

<h3 id="linux的socket例子">linux的socket例子<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#linux的socket例子" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p><img src="../../../Pasted-image-20250928200106.png" width="auto" height="auto" alt/><br/>
函数名和我们用的可能有所不同<br/>
socket：开洞<br/>
bind：给门洞安门牌号，才能正常收发邮件<br/>
listen：服务器端使用的<br/>
accept：服务器使用的<br/>
connect：客户端使用的<br/>
send：都有的<br/>
receive：都有的<br/>
close：都有的</p>
<ul>
<li>
<p>在 Linux 下使用 &lt;sys/socket.h> 头文件中 socket() 函数来创建套接字</p>
</li>
<li>
<p>原型为：int socket(int af, int type, int protocol);【因为linux把网络连接当成文件来处理】</p>
<ul>
<li>af为地址族（Address Family），也就是 IP 地址类型。
<ul>
<li>AF_INET表示IPv4 地址 (INET是“Internet”的简写)</li>
<li>AF_INET6表示IPv6地址</li>
<li>AF_UNIX (local channel, similar to pipes)</li>
<li>AF_ISO (ISO protocols)</li>
</ul>
</li>
<li>type 为数据传输方式/套接字类型
<ul>
<li>SOCK_STREAM（流格式套接字/面向连接的套接字 ~ TCP）</li>
<li>SOCK_DGRAM（数据报套接字/无连接的套接字 ~ UDP）</li>
</ul>
</li>
<li>protocol 表示传输协议，常用的有IPPROTO_TCP 和 IPPROTO_UDP，分别表示 TCP 传输协议和 UDP 传输协议。Usually set to 0 (i.e., use default protocol). 有可能多种协议使用同一种数据传输方式，所以在socket编程中，需要同时指明数据传输方式和协议。（ 提供面向连接的服务，但是有多个协议来支撑面向连接的服务)</li>
</ul>
</li>
<li>
<p>像 connect()、accept() 和 bind() 这样的套接字函数需要使用专门定义的地址结构来保存 IP 地址、端口号和协议类型。</p>
</li>
<li>
<p>困难在于你可以使用套接字用不同的协议来编写网络应用程序。例如，我们可以使用 IPv4、IPv6、本地 Unix 等。问题在于：<span class="text-highlight">每种不同的协议都使用不同的地址结构来保存其寻址信息</span>，但它们都使用相同的函数 connect()、accept() 和 bind() 等。</p>
</li>
<li>
<p>因此改成一个通用的地址结构再给这些函数用</p>
</li>
</ul>

<h4 id="struct-sockaddr">struct sockaddr<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#struct-sockaddr" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="c++" data-theme="github-light github-dark"><code data-language="c++" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sockaddr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">sa_family_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sin_family;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> //地址族(Address Family)，也就是地址类型</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">char</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sa_data[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">14</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">];</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> //IP地址和端口号</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre></figure>
<ul>
<li>必须传递给所有需要地址结构的 socket 函数的地址结构。</li>
<li>强制地址转换</li>
</ul>
<h4 id="ipv4-address-structure-struct-sockaddr_in">IPv4 address structure: struct sockaddr_in<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#ipv4-address-structure-struct-sockaddr_in" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="c++" data-theme="github-light github-dark"><code data-language="c++" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sockaddr_in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">sa_family_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sin_family;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> //地址族(Address Family)，也就是地址类型</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">uint16_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sin_port;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> //16位的端口号</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> in_addr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sin_addr;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> //32位IP地址</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">char</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sin_zero[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">];</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> //不使用，一般用0填充</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> in_addr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in_addr_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> s_addr;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> //32位的IP地址</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre></figure>
<p><img src="../../../Pasted-image-20250928201018.png" width="auto" height="auto" alt/></p>
<ul>
<li>sockaddr是一种通用的结构体，可以用来保存多种类型的IP地址和端口号，而 sockaddr_in是专门用来保存 IPv4 地址的结构体。
<ul>
<li>connect(), bind()和accept()函数中第二个参数的类型为 sockaddr</li>
</ul>
</li>
<li>sockaddr和 sockaddr_in的长度相同，都是16字节，sockaddr将IP地址和端口号合并到一起，用一个成员 sa_data表示。要想给 sa_data赋值，必须同时指明IP地址和端口号，例如“127.0.0.1:80”，遗憾的是，没有相关函数将这个字符串转换成需要的形式，也就很难给 sockaddr类型的变量赋值，所以使用 sockaddr_in来代替。这两个结构体的长度相同，强制转换类型时不会丢失字节，也没有多余的字节</li>
</ul>
<h4 id="在服务器端建立一个socket">在服务器端建立一个socket<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#在服务器端建立一个socket" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<ol>
<li>socket（） 创建套接字</li>
<li>bind（）将套接字绑定到一个地址，对于 Internet 上的服务器套接字，地址由主机上的端口号组成。</li>
<li>listen（）调用监听连接</li>
<li>accept（）接受连接。通常是堵塞地，直到有一个客户端与服务器建立连接</li>
<li>发送和接受数据</li>
</ol>
<p>简化版：</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="c++" data-theme="github-light github-dark"><code data-language="c++" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;stdio.h></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;string.h></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;stdlib.h></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;unistd.h></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;arpa/inet.h></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;sys/socket.h></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;netinet/in.h></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(){</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//创建套接字，it just creates interface</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> serv_sock </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> socket</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(AF_INET, SOCK_STREAM, IPPROTO_TCP);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> //如果serv_sock&lt; 0, 则创建失败，最好有检查</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//将套接字和IP、端口绑定</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sockaddr_in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> serv_addr;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> //IPv4地址结构体</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">memset</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">serv_addr, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">sizeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(serv_addr));</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> //每个字节都用0填充</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">serv_addr.sin_family </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AF_INET;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//使用IPv4地址</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">serv_addr.sin_addr.s_addr </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> inet_addr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(“</span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">127.0.0.1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">”);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//服务器IP地址(这里使用的是本机地址，【最好用这个因为可能本机有很多个网卡要多个套接字，这个的话一个套接字就可以】INADDR_ANY)</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">serv_addr.sin_port </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> htons</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1234</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> //端口//可移植性比较好</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">bind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(serv_sock, (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sockaddr</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">serv_addr, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">sizeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(serv_addr));</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> //这里地址强制转换</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//进入监听状态，等待用户发起请求</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(serv_sock, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">20</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> //20表示服务器端可容纳队列长度，可以有20个clients等待连接</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//接收客户端请求</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sockaddr_in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> clnt_addr;</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">socklen_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> clnt_addr_size </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> sizeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(clnt_addr);</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> clnt_sock </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> accept</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(serv_sock, (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sockaddr</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">clnt_addr, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">clnt_addr_size);</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//向客户端发送数据</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">char</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> str[] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> “Hello Client</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;;</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">write(clnt_sock, str, sizeof(str));</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">//关闭套接字</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">close(clnt_sock); close(serv_sock); return 0;</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}</span></span></code></pre></figure>
<p>serv_sock 一直监听<br/>
clnt_sock 用于接收</p>
<p>需要在这个模板上增加做一些创建失败的检查</p>
<h5 id="accept">accept<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#accept" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h5>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="c++" data-theme="github-light github-dark"><code data-language="c++" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> clnt_sock </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> accept</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(serv_sock, (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sockaddr</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">clnt_addr, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">clnt_addr_size);</span></span></code></pre></figure>
<ol>
<li>accept() 返回一个新的套接字文件描述符，用于与客户端进行读写。原有的文件描述符通常用于监听新的传入连接。</li>
<li>它从服务器该套接字的队列中出队下一个连接请求。如果队列为空，该函数将阻塞直到有连接请求到达。</li>
<li>注意该函数的最后一个参数是一个指针。你不是在指定长度，内核会指定并将值返回给你的应用，同样对于 clnt_addr 也是如此。在与客户端建立连接后，必须将客户端的地址提供给你的服务器，否则你如何向客户端发送响应？因此，accept 函数调用会为你填充地址结构和地址结构的长度以供使用。、</li>
<li>当服务器接收到（接受）客户端的连接请求时 ⇒ 它会派生（forks）出自身的副本并让子进程处理该客户端。（确保你记住这些操作系统概念）因此在服务器机器上，监听套接字与已连接套接字是不同的。</li>
</ol>
<h5 id="write-and-read">write() and read()<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#write-and-read" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h5>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="c++" data-theme="github-light github-dark"><code data-language="c++" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">intwrite</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> file_descriptor, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">buf, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">size_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> message_length);</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">intread</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> file_descriptor, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">char</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">buffer, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">size_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> buffer_length);</span></span></code></pre></figure>
<ul>
<li>write() 函数的返回值是写入的字节数，失败时返回 −1</li>
<li>这个函数所做的是将数据从你的应用程序传输到本机内核中的一个<span class="text-highlight">缓冲区</span>，它并不直接通过网络发送数据。TCP 完全控制数据的发送，这在内核内部实现。</li>
<li>read() 函数返回的是读取的字节数，可能小于缓冲区长度。失败时返回 −1。</li>
<li>read() 仅将数据从内核中的<span class="text-highlight">缓冲区</span>传输到你的应用程序，你并不是直接从远程主机读取字节流，而是由 TCP 来控制并为你的应用缓冲数据。</li>
</ul>

<ul>
<li>把ip地址转化为用于网络传输的二进制数值
<ul>
<li>intinet_aton(constchar <em>cp, structin_addr</em>inp);</li>
<li>inet_aton() 转换网络主机地址ip(如192.168.1.10)为二进制数值，并存储在structin_addr结构中，即第二个参数*inp, 函数返回非零值表示cp主机地址有效，返回0表示主机地址无效。</li>
<li>这个转换完后不能用于网络传输，还需要调用htonl函数才能将主机字节顺序转化为网络字节顺序。</li>
</ul>
</li>
<li>将网络传输的二进制数值转化为成点分十进制的ip地址
<ul>
<li>char *inet_ntoa(structin_addrin);</li>
<li>inet_ntoa函数转换网络字节排序的地址为标准的ASCII以点分开的地址,该函数返回指向点分开的字符串地址（如192.168.1.10)的指针，该字符串的空间为静态分配的，这意味着在第二次调用该函数时，上一次调用将会被重写（复盖），所以如果需要保存该串最好复制出来自己管理！</li>
</ul>
</li>
</ul>
<h4 id="在客户端建立一个套接字">在客户端建立一个套接字<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#在客户端建立一个套接字" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<ol>
<li>使用 socket() 系统调用创建一个套接字</li>
<li>使用 connect() 系统调用将套接字连接到服务器地址</li>
<li>发送和接收数据。有多种方法可以实现，但最简单的是使用 read() 和 write() 系统调用。</li>
</ol>
<ul>
<li>注意，客户端需要知道服务器的存在以及服务器的地址，但服务器在连接建立之前无需知道客户端的地址（甚至无需知道客户端的存在）。【 因为accept会自动读入与服务端建立连接的客户端地址信息的】</li>
<li>另请注意，一旦连接建立，双方都可以发送和接收信息。</li>
</ul>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="c++" data-theme="github-light github-dark"><code data-language="c++" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;stdio.h></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;string.h></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;stdlib.h></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;unistd.h></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;arpa/inet.h></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;sys/socket.h></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(){</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//创建套接字</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sock </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> socket</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(AF_INET, SOCK_STREAM, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//向服务器（特定的IP和端口）发起请求</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sockaddr_in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> serv_addr;</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">memset</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">serv_addr, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">sizeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(serv_addr));</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> //每个字节都用0填充</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">serv_addr.sin_family </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AF_INET;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> //使用IPv4地址</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">serv_addr.sin_addr.s_addr </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> inet_addr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(“</span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">127.0.0.1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">”);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//服务器IP地址(这里是本机地址)</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">serv_addr.sin_port </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> htons</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1234</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> //端口</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//connect()函数执行TCP三次握手建立联接</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">connect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(sock, (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sockaddr</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">serv_addr, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">sizeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(serv_addr));</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//读取服务器传回的数据</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">char</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> buffer[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">40</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">];</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">read</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(sock, buffer, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">sizeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(buffer)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">printf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Message form server: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%s\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, buffer);</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//关闭套接字</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">close</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(sock); </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></figure>
<h3 id="windows的socket例子">windows的socket例子<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#windows的socket例子" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="c++" data-theme="github-light github-dark"><code data-language="c++" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//Windows 不把套接字作为普通文件对待，而是返回 SOCKET 类型的句柄。</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">SOCKETsocket</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> af, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> type, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> protocol);</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//Linux下socket函数</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">intsocket</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(intaf, inttype, intprotocol);</span></span></code></pre></figure>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="c++" data-theme="github-light github-dark"><code data-language="c++" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Generic:</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">structSOCKADDR{</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">unsigned</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> short</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sa_family;</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">char</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sa_data[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">14</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">];</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">IPv4 address </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">struct</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">structsockaddr_in{</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">short</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sin_family;</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">unsigned</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> short</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sin_port;</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">structin_addrsin_addr;</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">char</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sin_zero[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">];</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">structin_addr{</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">union</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">struct</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">unsigned</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> char</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> s_b1, s_b2, s_b3, s_b4;} S_un_b;</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">struct</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">unsigned</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> short</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> s_w1, s_w2;} S_un_w;</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">unsigned</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> long</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> S_addr;</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} S_un;</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre></figure>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="c++" data-theme="github-light github-dark"><code data-language="c++" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//include部分</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//Windows 下的 socket 程序依赖 Winsock.dll 或 ws2_32.dll，必须提前加载。</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;stdio.h></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;winsock2.h></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#pragma</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> comment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">lib</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ws2_32.lib&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> //加载 ws2_32.dll</span></span></code></pre></figure>
<p>绿色是与linux不同的部分<br/>
<img src="../../../Pasted-image-20250928203347.png" width="auto" height="auto" alt/><br/>
<img src="../../../Pasted-image-20250928203358.png" width="auto" height="auto" alt/><br/>
<img src="../../../Pasted-image-20250928203421.png" width="auto" height="auto" alt/></p>
<h4 id="全流程回顾">全流程回顾<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#全流程回顾" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<p><img src="../../../Pasted-image-20250928203256.png" width="auto" height="auto" alt/></p>
<ul>
<li>Communication via sockets necessitates existence of the 4-tuple:
<ul>
<li>Local IP address</li>
<li>Local Port#</li>
<li>Foreign IP address</li>
<li>Foreign Port#</li>
</ul>
</li>
<li>Server
<ul>
<li>Passively waits for and responds to clients</li>
<li>Passive socket 被动套接字</li>
</ul>
</li>
<li>Client
<ul>
<li>Initiates the communication</li>
<li>Must know the address and the port of the server</li>
<li>Active socket 主动套接字</li>
</ul>
</li>
</ul>
<ol>
<li>服务器先执行并等待接收</li>
<li>客户端后执行并且向服务器发送第一个网络数据包</li>
<li>建立连接之后，客户端或者服务器都可以发送和接收数据</li>
</ol>
<h3 id="关于实验">关于实验<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#关于实验" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<ol>
<li>每增加一个功能就调试一次</li>
</ol>
<ul>
<li><a href="https://zjucomp.net/docs/Coding/toolchain" class="external">https://zjucomp.net/docs/Coding/toolchain<svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a></li>
<li>不要使用定长的数据报，协议的定界问题要自己思考</li>
<li>实验报告：一些控制相关的 客户端有菜单选项，服务端没有菜单选项的话需要考虑<img src="../../../Pasted-image-20250928204458.png" width="auto" height="auto" alt/></li>
</ul></article><hr/><div class="page-footer"><div class="giscus" data-repo="im0x0ing/im0x0ing.github.io" data-repo-id="R_kgDOQevgrA" data-category="Announcements" data-category-id="DIC_kwDOQevgrM4CzLI8" data-mapping="pathname" data-strict="0" data-reactions-enabled="1" data-input-position="top" data-light-theme="light" data-dark-theme="dark" data-theme-url="https://im0x0ing.github.io/static/giscus" data-lang="zh-CN"></div></div></div><div class="right sidebar"><div class="toc desktop-only"><button type="button" class="toc-header" aria-controls="toc-39" aria-expanded="true"><h3>Table of Contents</h3><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="fold"><polyline points="6 9 12 15 18 9"></polyline></svg></button><div class="toc-depth-control"><span class="depth-label">H3</span><input type="range" class="depth-slider" min="1" max="6" value="2" step="1"/></div><ul id="list-9" class="toc-content overflow"><li class="depth-0"><a href="#socket" data-for="socket">socket</a></li><li class="depth-1"><a href="#socket的种类" data-for="socket的种类">socket的种类</a></li><li class="depth-3"><a href="#流格式套接字sock_stream" data-for="流格式套接字sock_stream">流格式套接字（SOCK_STREAM）</a></li><li class="depth-3"><a href="#数据报格式套接字sock_dgram" data-for="数据报格式套接字sock_dgram">数据报格式套接字（SOCK_DGRAM）</a></li><li class="depth-1"><a href="#constructing-message" data-for="constructing-message">Constructing Message</a></li><li class="depth-2"><a href="#byte-ordering" data-for="byte-ordering">Byte Ordering</a></li><li class="depth-2"><a href="#alignment--padding" data-for="alignment--padding">Alignment &amp; Padding</a></li><li class="depth-2"><a href="#framing--parsing" data-for="framing--parsing">Framing &amp; Parsing</a></li><li class="depth-0"><a href="#具体的编程" data-for="具体的编程">具体的编程</a></li><li class="depth-3"><a href="#tcp数据报结构" data-for="tcp数据报结构">TCP数据报结构</a></li><li class="depth-2"><a href="#tcp三次握手建立连接" data-for="tcp三次握手建立连接">TCP三次握手建立连接</a></li><li class="depth-2"><a href="#tcp四次握手断开连接" data-for="tcp四次握手断开连接">TCP四次握手断开连接</a></li><li class="depth-1"><a href="#linux的socket例子" data-for="linux的socket例子">linux的socket例子</a></li><li class="depth-2"><a href="#struct-sockaddr" data-for="struct-sockaddr">struct sockaddr</a></li><li class="depth-2"><a href="#ipv4-address-structure-struct-sockaddr_in" data-for="ipv4-address-structure-struct-sockaddr_in">IPv4 address structure: struct sockaddr_in</a></li><li class="depth-2"><a href="#在服务器端建立一个socket" data-for="在服务器端建立一个socket">在服务器端建立一个socket</a></li><li class="depth-3"><a href="#accept" data-for="accept">accept</a></li><li class="depth-3"><a href="#write-and-read" data-for="write-and-read">write() and read()</a></li><li class="depth-2"><a href="#在客户端建立一个套接字" data-for="在客户端建立一个套接字">在客户端建立一个套接字</a></li><li class="depth-1"><a href="#windows的socket例子" data-for="windows的socket例子">windows的socket例子</a></li><li class="depth-2"><a href="#全流程回顾" data-for="全流程回顾">全流程回顾</a></li><li class="depth-1"><a href="#关于实验" data-for="关于实验">关于实验</a></li><li class="overflow-end"></li></ul></div><div class="graph"><h3>Graph View</h3><div class="graph-outer"><div class="graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:1,&quot;scale&quot;:1.1,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.3,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1,&quot;showTags&quot;:true,&quot;removeTags&quot;:[],&quot;focusOnHover&quot;:false,&quot;enableRadial&quot;:false}"></div><button class="global-graph-icon" aria-label="Global Graph"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 55 55" fill="currentColor" xml:space="preserve"><path d="M49,0c-3.309,0-6,2.691-6,6c0,1.035,0.263,2.009,0.726,2.86l-9.829,9.829C32.542,17.634,30.846,17,29,17
                s-3.542,0.634-4.898,1.688l-7.669-7.669C16.785,10.424,17,9.74,17,9c0-2.206-1.794-4-4-4S9,6.794,9,9s1.794,4,4,4
                c0.74,0,1.424-0.215,2.019-0.567l7.669,7.669C21.634,21.458,21,23.154,21,25s0.634,3.542,1.688,4.897L10.024,42.562
                C8.958,41.595,7.549,41,6,41c-3.309,0-6,2.691-6,6s2.691,6,6,6s6-2.691,6-6c0-1.035-0.263-2.009-0.726-2.86l12.829-12.829
                c1.106,0.86,2.44,1.436,3.898,1.619v10.16c-2.833,0.478-5,2.942-5,5.91c0,3.309,2.691,6,6,6s6-2.691,6-6c0-2.967-2.167-5.431-5-5.91
                v-10.16c1.458-0.183,2.792-0.759,3.898-1.619l7.669,7.669C41.215,39.576,41,40.26,41,41c0,2.206,1.794,4,4,4s4-1.794,4-4
                s-1.794-4-4-4c-0.74,0-1.424,0.215-2.019,0.567l-7.669-7.669C36.366,28.542,37,26.846,37,25s-0.634-3.542-1.688-4.897l9.665-9.665
                C46.042,11.405,47.451,12,49,12c3.309,0,6-2.691,6-6S52.309,0,49,0z M11,9c0-1.103,0.897-2,2-2s2,0.897,2,2s-0.897,2-2,2
                S11,10.103,11,9z M6,51c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S8.206,51,6,51z M33,49c0,2.206-1.794,4-4,4s-4-1.794-4-4
                s1.794-4,4-4S33,46.794,33,49z M29,31c-3.309,0-6-2.691-6-6s2.691-6,6-6s6,2.691,6,6S32.309,31,29,31z M47,41c0,1.103-0.897,2-2,2
                s-2-0.897-2-2s0.897-2,2-2S47,39.897,47,41z M49,10c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S51.206,10,49,10z"></path></svg></button></div><div class="global-graph-outer"><div class="global-graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:-1,&quot;scale&quot;:0.9,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.2,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1,&quot;showTags&quot;:true,&quot;removeTags&quot;:[],&quot;focusOnHover&quot;:true,&quot;enableRadial&quot;:true}"></div></div></div></div><footer class><p>Created with <a href="https://quartz.jzhao.xyz/">Quartz v4.5.2</a> © 2025</p><ul><li><a href="https://github.com/jackyzha0/quartz">GitHub</a></li><li><a href="https://discord.gg/cRFFHYye7t">Discord Community</a></li></ul></footer></div></div></body><script type="application/javascript" data-persist="true">function n(){let t=this.parentElement;t.classList.toggle("is-collapsed");let e=t.getElementsByClassName("callout-content")[0];if(!e)return;let l=t.classList.contains("is-collapsed");e.style.gridTemplateRows=l?"0fr":"1fr"}function c(){let t=document.getElementsByClassName("callout is-collapsible");for(let e of t){let l=e.getElementsByClassName("callout-title")[0],s=e.getElementsByClassName("callout-content")[0];if(!l||!s)continue;l.addEventListener("click",n),window.addCleanup(()=>l.removeEventListener("click",n));let o=e.classList.contains("is-collapsed");s.style.gridTemplateRows=o?"0fr":"1fr"}}document.addEventListener("nav",c);
</script><script type="module" data-persist="true">function f(i,e){if(!i)return;function r(o){o.target===this&&(o.preventDefault(),o.stopPropagation(),e())}function t(o){o.key.startsWith("Esc")&&(o.preventDefault(),e())}i?.addEventListener("click",r),window.addCleanup(()=>i?.removeEventListener("click",r)),document.addEventListener("keydown",t),window.addCleanup(()=>document.removeEventListener("keydown",t))}function y(i){for(;i.firstChild;)i.removeChild(i.firstChild)}var h=class{constructor(e,r){this.container=e;this.content=r;this.setupEventListeners(),this.setupNavigationControls(),this.resetTransform()}isDragging=!1;startPan={x:0,y:0};currentPan={x:0,y:0};scale=1;MIN_SCALE=.5;MAX_SCALE=3;cleanups=[];setupEventListeners(){let e=this.onMouseDown.bind(this),r=this.onMouseMove.bind(this),t=this.onMouseUp.bind(this),o=this.resetTransform.bind(this);this.container.addEventListener("mousedown",e),document.addEventListener("mousemove",r),document.addEventListener("mouseup",t),window.addEventListener("resize",o),this.cleanups.push(()=>this.container.removeEventListener("mousedown",e),()=>document.removeEventListener("mousemove",r),()=>document.removeEventListener("mouseup",t),()=>window.removeEventListener("resize",o))}cleanup(){for(let e of this.cleanups)e()}setupNavigationControls(){let e=document.createElement("div");e.className="mermaid-controls";let r=this.createButton("+",()=>this.zoom(.1)),t=this.createButton("-",()=>this.zoom(-.1)),o=this.createButton("Reset",()=>this.resetTransform());e.appendChild(t),e.appendChild(o),e.appendChild(r),this.container.appendChild(e)}createButton(e,r){let t=document.createElement("button");return t.textContent=e,t.className="mermaid-control-button",t.addEventListener("click",r),window.addCleanup(()=>t.removeEventListener("click",r)),t}onMouseDown(e){e.button===0&&(this.isDragging=!0,this.startPan={x:e.clientX-this.currentPan.x,y:e.clientY-this.currentPan.y},this.container.style.cursor="grabbing")}onMouseMove(e){this.isDragging&&(e.preventDefault(),this.currentPan={x:e.clientX-this.startPan.x,y:e.clientY-this.startPan.y},this.updateTransform())}onMouseUp(){this.isDragging=!1,this.container.style.cursor="grab"}zoom(e){let r=Math.min(Math.max(this.scale+e,this.MIN_SCALE),this.MAX_SCALE),t=this.content.getBoundingClientRect(),o=t.width/2,n=t.height/2,c=r-this.scale;this.currentPan.x-=o*c,this.currentPan.y-=n*c,this.scale=r,this.updateTransform()}updateTransform(){this.content.style.transform=`translate(${this.currentPan.x}px, ${this.currentPan.y}px) scale(${this.scale})`}resetTransform(){this.scale=1;let e=this.content.querySelector("svg");this.currentPan={x:e.getBoundingClientRect().width/2,y:e.getBoundingClientRect().height/2},this.updateTransform()}},C=["--secondary","--tertiary","--gray","--light","--lightgray","--highlight","--dark","--darkgray","--codeFont"],E;document.addEventListener("nav",async()=>{let e=document.querySelector(".center").querySelectorAll("code.mermaid");if(e.length===0)return;E||=await import("https://cdnjs.cloudflare.com/ajax/libs/mermaid/11.4.0/mermaid.esm.min.mjs");let r=E.default,t=new WeakMap;for(let n of e)t.set(n,n.innerText);async function o(){for(let s of e){s.removeAttribute("data-processed");let a=t.get(s);a&&(s.innerHTML=a)}let n=C.reduce((s,a)=>(s[a]=window.getComputedStyle(document.documentElement).getPropertyValue(a),s),{}),c=document.documentElement.getAttribute("saved-theme")==="dark";r.initialize({startOnLoad:!1,securityLevel:"loose",theme:c?"dark":"base",themeVariables:{fontFamily:n["--codeFont"],primaryColor:n["--light"],primaryTextColor:n["--darkgray"],primaryBorderColor:n["--tertiary"],lineColor:n["--darkgray"],secondaryColor:n["--secondary"],tertiaryColor:n["--tertiary"],clusterBkg:n["--light"],edgeLabelBackground:n["--highlight"]}}),await r.run({nodes:e})}await o(),document.addEventListener("themechange",o),window.addCleanup(()=>document.removeEventListener("themechange",o));for(let n=0;n<e.length;n++){let v=function(){let g=l.querySelector("#mermaid-space"),m=l.querySelector(".mermaid-content");if(!m)return;y(m);let w=c.querySelector("svg").cloneNode(!0);m.appendChild(w),l.classList.add("active"),g.style.cursor="grab",u=new h(g,m)},M=function(){l.classList.remove("active"),u?.cleanup(),u=null},c=e[n],s=c.parentElement,a=s.querySelector(".clipboard-button"),d=s.querySelector(".expand-button"),p=window.getComputedStyle(a),L=a.offsetWidth+parseFloat(p.marginLeft||"0")+parseFloat(p.marginRight||"0");d.style.right=`calc(${L}px + 0.3rem)`,s.prepend(d);let l=s.querySelector("#mermaid-container");if(!l)return;let u=null;d.addEventListener("click",v),f(l,M),window.addCleanup(()=>{u?.cleanup(),d.removeEventListener("click",v)})}});
</script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/copy-tex.min.js" type="application/javascript" data-persist="true"></script><script src="../../../postscript.js" type="module" data-persist="true"></script></html>