<!DOCTYPE html>
<html lang="en" dir="ltr"><head><title>进程与内存流程总览</title><meta charset="utf-8"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com"/><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto Sans SC:wght@400;700&amp;family=Noto Serif SC:ital,wght@0,400;0,500;0,700;0,900;1,400;1,500;1,700;1,900&amp;family=JetBrains Mono:wght@400;600&amp;display=swap"/><link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin="anonymous"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="og:site_name" content="ING wiki"/><meta property="og:title" content="进程与内存流程总览"/><meta property="og:type" content="website"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="进程与内存流程总览"/><meta name="twitter:description" content="进程与内存流程总览 本文档从系统上电开始，完整梳理操作系统如何启动、创建第一个用户进程、管理内存，以及如何进行进程切换的整个流程。 一、系统启动：从硬件到内核 1.1 上电与引导 计算机上电后，CPU首先执行存储在**ROM（只读存储器）**中的引导加载器（bootstrap loader）。这个程序是开机后执行的第一个软件，位置固定且已知。 引导加载器的任务： 进行硬件自检（POST） 定位磁盘上的操作系统内核镜像 将内核加载到**主内存（RAM）**中 切换CPU模式为内核态，开始执行内核代码 1.2 内核初始化 内核被加载到内存后，开始初始化工作： 初始化中断系统 设置中断向量表（int..."/><meta property="og:description" content="进程与内存流程总览 本文档从系统上电开始，完整梳理操作系统如何启动、创建第一个用户进程、管理内存，以及如何进行进程切换的整个流程。 一、系统启动：从硬件到内核 1.1 上电与引导 计算机上电后，CPU首先执行存储在**ROM（只读存储器）**中的引导加载器（bootstrap loader）。这个程序是开机后执行的第一个软件，位置固定且已知。 引导加载器的任务： 进行硬件自检（POST） 定位磁盘上的操作系统内核镜像 将内核加载到**主内存（RAM）**中 切换CPU模式为内核态，开始执行内核代码 1.2 内核初始化 内核被加载到内存后，开始初始化工作： 初始化中断系统 设置中断向量表（int..."/><meta property="og:image:alt" content="进程与内存流程总览 本文档从系统上电开始，完整梳理操作系统如何启动、创建第一个用户进程、管理内存，以及如何进行进程切换的整个流程。 一、系统启动：从硬件到内核 1.1 上电与引导 计算机上电后，CPU首先执行存储在**ROM（只读存储器）**中的引导加载器（bootstrap loader）。这个程序是开机后执行的第一个软件，位置固定且已知。 引导加载器的任务： 进行硬件自检（POST） 定位磁盘上的操作系统内核镜像 将内核加载到**主内存（RAM）**中 切换CPU模式为内核态，开始执行内核代码 1.2 内核初始化 内核被加载到内存后，开始初始化工作： 初始化中断系统 设置中断向量表（int..."/><meta property="twitter:domain" content="im0x0ing.github.io"/><meta property="og:url" content="https://im0x0ing.github.io/课程笔记/操作系统/进程与内存流程总览"/><meta property="twitter:url" content="https://im0x0ing.github.io/课程笔记/操作系统/进程与内存流程总览"/><link rel="icon" href="../../static/icon.png"/><meta name="description" content="进程与内存流程总览 本文档从系统上电开始，完整梳理操作系统如何启动、创建第一个用户进程、管理内存，以及如何进行进程切换的整个流程。 一、系统启动：从硬件到内核 1.1 上电与引导 计算机上电后，CPU首先执行存储在**ROM（只读存储器）**中的引导加载器（bootstrap loader）。这个程序是开机后执行的第一个软件，位置固定且已知。 引导加载器的任务： 进行硬件自检（POST） 定位磁盘上的操作系统内核镜像 将内核加载到**主内存（RAM）**中 切换CPU模式为内核态，开始执行内核代码 1.2 内核初始化 内核被加载到内存后，开始初始化工作： 初始化中断系统 设置中断向量表（int..."/><meta name="generator" content="Quartz"/><link href="../../index.css" rel="stylesheet" type="text/css" data-persist="true"/><style>.expand-button {
  position: absolute;
  display: flex;
  float: right;
  padding: 0.4rem;
  margin: 0.3rem;
  right: 0;
  color: var(--gray);
  border-color: var(--dark);
  background-color: var(--light);
  border: 1px solid;
  border-radius: 5px;
  opacity: 0;
  transition: 0.2s;
}
.expand-button > svg {
  fill: var(--light);
  filter: contrast(0.3);
}
.expand-button:hover {
  cursor: pointer;
  border-color: var(--secondary);
}
.expand-button:focus {
  outline: 0;
}

pre:hover > .expand-button {
  opacity: 1;
  transition: 0.2s;
}

#mermaid-container {
  position: fixed;
  contain: layout;
  z-index: 999;
  left: 0;
  top: 0;
  width: 100vw;
  height: 100vh;
  overflow: hidden;
  display: none;
  backdrop-filter: blur(4px);
  background: rgba(0, 0, 0, 0.5);
}
#mermaid-container.active {
  display: inline-block;
}
#mermaid-container > #mermaid-space {
  border: 1px solid var(--lightgray);
  background-color: var(--light);
  border-radius: 5px;
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  height: 80vh;
  width: 80vw;
  overflow: hidden;
}
#mermaid-container > #mermaid-space > .mermaid-content {
  padding: 2rem;
  position: relative;
  transform-origin: 0 0;
  transition: transform 0.1s ease;
  overflow: visible;
  min-height: 200px;
  min-width: 200px;
}
#mermaid-container > #mermaid-space > .mermaid-content pre {
  margin: 0;
  border: none;
}
#mermaid-container > #mermaid-space > .mermaid-content svg {
  max-width: none;
  height: auto;
}
#mermaid-container > #mermaid-space > .mermaid-controls {
  position: absolute;
  bottom: 20px;
  right: 20px;
  display: flex;
  gap: 8px;
  padding: 8px;
  background: var(--light);
  border: 1px solid var(--lightgray);
  border-radius: 6px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  z-index: 2;
}
#mermaid-container > #mermaid-space > .mermaid-controls .mermaid-control-button {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 32px;
  height: 32px;
  padding: 0;
  border: 1px solid var(--lightgray);
  background: var(--light);
  color: var(--dark);
  border-radius: 4px;
  cursor: pointer;
  font-size: 16px;
  font-family: var(--bodyFont);
  transition: all 0.2s ease;
}
#mermaid-container > #mermaid-space > .mermaid-controls .mermaid-control-button:hover {
  background: var(--lightgray);
}
#mermaid-container > #mermaid-space > .mermaid-controls .mermaid-control-button:active {
  transform: translateY(1px);
}
#mermaid-container > #mermaid-space > .mermaid-controls .mermaid-control-button:nth-child(2) {
  width: auto;
  padding: 0 12px;
  font-size: 14px;
}
/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VSb290IjoiL2hvbWUvcnVubmVyL3dvcmsvaW0weDBpbmctYmxvZy1wcml2YXRlL2ltMHgwaW5nLWJsb2ctcHJpdmF0ZS9xdWFydHovY29tcG9uZW50cy9zdHlsZXMiLCJzb3VyY2VzIjpbIm1lcm1haWQuaW5saW5lLnNjc3MiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7RUFDRTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTs7QUFFQTtFQUNFO0VBQ0E7O0FBR0Y7RUFDRTtFQUNBOztBQUdGO0VBQ0U7OztBQUtGO0VBQ0U7RUFDQTs7O0FBSUo7RUFDRTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBOztBQUVBO0VBQ0U7O0FBR0Y7RUFDRTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTs7QUFFQTtFQUNFO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBOztBQUVBO0VBQ0U7RUFDQTs7QUFHRjtFQUNFO0VBQ0E7O0FBSUo7RUFDRTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBOztBQUVBO0VBQ0U7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTs7QUFFQTtFQUNFOztBQUdGO0VBQ0U7O0FBSUY7RUFDRTtFQUNBO0VBQ0EiLCJzb3VyY2VzQ29udGVudCI6WyIuZXhwYW5kLWJ1dHRvbiB7XG4gIHBvc2l0aW9uOiBhYnNvbHV0ZTtcbiAgZGlzcGxheTogZmxleDtcbiAgZmxvYXQ6IHJpZ2h0O1xuICBwYWRkaW5nOiAwLjRyZW07XG4gIG1hcmdpbjogMC4zcmVtO1xuICByaWdodDogMDsgLy8gTk9URTogcmlnaHQgd2lsbCBiZSBzZXQgaW4gbWVybWFpZC5pbmxpbmUudHNcbiAgY29sb3I6IHZhcigtLWdyYXkpO1xuICBib3JkZXItY29sb3I6IHZhcigtLWRhcmspO1xuICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1saWdodCk7XG4gIGJvcmRlcjogMXB4IHNvbGlkO1xuICBib3JkZXItcmFkaXVzOiA1cHg7XG4gIG9wYWNpdHk6IDA7XG4gIHRyYW5zaXRpb246IDAuMnM7XG5cbiAgJiA+IHN2ZyB7XG4gICAgZmlsbDogdmFyKC0tbGlnaHQpO1xuICAgIGZpbHRlcjogY29udHJhc3QoMC4zKTtcbiAgfVxuXG4gICY6aG92ZXIge1xuICAgIGN1cnNvcjogcG9pbnRlcjtcbiAgICBib3JkZXItY29sb3I6IHZhcigtLXNlY29uZGFyeSk7XG4gIH1cblxuICAmOmZvY3VzIHtcbiAgICBvdXRsaW5lOiAwO1xuICB9XG59XG5cbnByZSB7XG4gICY6aG92ZXIgPiAuZXhwYW5kLWJ1dHRvbiB7XG4gICAgb3BhY2l0eTogMTtcbiAgICB0cmFuc2l0aW9uOiAwLjJzO1xuICB9XG59XG5cbiNtZXJtYWlkLWNvbnRhaW5lciB7XG4gIHBvc2l0aW9uOiBmaXhlZDtcbiAgY29udGFpbjogbGF5b3V0O1xuICB6LWluZGV4OiA5OTk7XG4gIGxlZnQ6IDA7XG4gIHRvcDogMDtcbiAgd2lkdGg6IDEwMHZ3O1xuICBoZWlnaHQ6IDEwMHZoO1xuICBvdmVyZmxvdzogaGlkZGVuO1xuICBkaXNwbGF5OiBub25lO1xuICBiYWNrZHJvcC1maWx0ZXI6IGJsdXIoNHB4KTtcbiAgYmFja2dyb3VuZDogcmdiYSgwLCAwLCAwLCAwLjUpO1xuXG4gICYuYWN0aXZlIHtcbiAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7XG4gIH1cblxuICAmID4gI21lcm1haWQtc3BhY2Uge1xuICAgIGJvcmRlcjogMXB4IHNvbGlkIHZhcigtLWxpZ2h0Z3JheSk7XG4gICAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tbGlnaHQpO1xuICAgIGJvcmRlci1yYWRpdXM6IDVweDtcbiAgICBwb3NpdGlvbjogZml4ZWQ7XG4gICAgdG9wOiA1MCU7XG4gICAgbGVmdDogNTAlO1xuICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlKC01MCUsIC01MCUpO1xuICAgIGhlaWdodDogODB2aDtcbiAgICB3aWR0aDogODB2dztcbiAgICBvdmVyZmxvdzogaGlkZGVuO1xuXG4gICAgJiA+IC5tZXJtYWlkLWNvbnRlbnQge1xuICAgICAgcGFkZGluZzogMnJlbTtcbiAgICAgIHBvc2l0aW9uOiByZWxhdGl2ZTtcbiAgICAgIHRyYW5zZm9ybS1vcmlnaW46IDAgMDtcbiAgICAgIHRyYW5zaXRpb246IHRyYW5zZm9ybSAwLjFzIGVhc2U7XG4gICAgICBvdmVyZmxvdzogdmlzaWJsZTtcbiAgICAgIG1pbi1oZWlnaHQ6IDIwMHB4O1xuICAgICAgbWluLXdpZHRoOiAyMDBweDtcblxuICAgICAgcHJlIHtcbiAgICAgICAgbWFyZ2luOiAwO1xuICAgICAgICBib3JkZXI6IG5vbmU7XG4gICAgICB9XG5cbiAgICAgIHN2ZyB7XG4gICAgICAgIG1heC13aWR0aDogbm9uZTtcbiAgICAgICAgaGVpZ2h0OiBhdXRvO1xuICAgICAgfVxuICAgIH1cblxuICAgICYgPiAubWVybWFpZC1jb250cm9scyB7XG4gICAgICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gICAgICBib3R0b206IDIwcHg7XG4gICAgICByaWdodDogMjBweDtcbiAgICAgIGRpc3BsYXk6IGZsZXg7XG4gICAgICBnYXA6IDhweDtcbiAgICAgIHBhZGRpbmc6IDhweDtcbiAgICAgIGJhY2tncm91bmQ6IHZhcigtLWxpZ2h0KTtcbiAgICAgIGJvcmRlcjogMXB4IHNvbGlkIHZhcigtLWxpZ2h0Z3JheSk7XG4gICAgICBib3JkZXItcmFkaXVzOiA2cHg7XG4gICAgICBib3gtc2hhZG93OiAwIDJweCA0cHggcmdiYSgwLCAwLCAwLCAwLjEpO1xuICAgICAgei1pbmRleDogMjtcblxuICAgICAgLm1lcm1haWQtY29udHJvbC1idXR0b24ge1xuICAgICAgICBkaXNwbGF5OiBmbGV4O1xuICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyO1xuICAgICAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjtcbiAgICAgICAgd2lkdGg6IDMycHg7XG4gICAgICAgIGhlaWdodDogMzJweDtcbiAgICAgICAgcGFkZGluZzogMDtcbiAgICAgICAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tbGlnaHRncmF5KTtcbiAgICAgICAgYmFja2dyb3VuZDogdmFyKC0tbGlnaHQpO1xuICAgICAgICBjb2xvcjogdmFyKC0tZGFyayk7XG4gICAgICAgIGJvcmRlci1yYWRpdXM6IDRweDtcbiAgICAgICAgY3Vyc29yOiBwb2ludGVyO1xuICAgICAgICBmb250LXNpemU6IDE2cHg7XG4gICAgICAgIGZvbnQtZmFtaWx5OiB2YXIoLS1ib2R5Rm9udCk7XG4gICAgICAgIHRyYW5zaXRpb246IGFsbCAwLjJzIGVhc2U7XG5cbiAgICAgICAgJjpob3ZlciB7XG4gICAgICAgICAgYmFja2dyb3VuZDogdmFyKC0tbGlnaHRncmF5KTtcbiAgICAgICAgfVxuXG4gICAgICAgICY6YWN0aXZlIHtcbiAgICAgICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoMXB4KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFN0eWxlIHRoZSByZXNldCBidXR0b24gZGlmZmVyZW50bHlcbiAgICAgICAgJjpudGgtY2hpbGQoMikge1xuICAgICAgICAgIHdpZHRoOiBhdXRvO1xuICAgICAgICAgIHBhZGRpbmc6IDAgMTJweDtcbiAgICAgICAgICBmb250LXNpemU6IDE0cHg7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cbn1cbiJdfQ== */</style><link href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" rel="stylesheet" type="text/css" data-persist="true"/><script src="../../prescript.js" type="application/javascript" data-persist="true"></script><script type="application/javascript" data-persist="true">const fetchData = fetch("../../static/contentIndex.json").then(data => data.json())</script><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="https://im0x0ing.github.io/index.xml"/><meta property="og:image:width" content="1200"/><meta property="og:image:height" content="630"/><meta property="og:image" content="https://im0x0ing.github.io/课程笔记/操作系统/进程与内存流程总览-og-image.webp"/><meta property="og:image:url" content="https://im0x0ing.github.io/课程笔记/操作系统/进程与内存流程总览-og-image.webp"/><meta name="twitter:image" content="https://im0x0ing.github.io/课程笔记/操作系统/进程与内存流程总览-og-image.webp"/><meta property="og:image:type" content="image/.webp"/></head><body data-slug="课程笔记/操作系统/进程与内存流程总览"><div id="quartz-root" class="page"><div id="quartz-body"><div class="left sidebar"><h2 class="page-title"><a href="../..">ING wiki</a></h2><div class="spacer mobile-only"></div><div class="flex-component" style="flex-direction: row; flex-wrap: nowrap; gap: 1rem;"><div style="flex-grow: 1; flex-shrink: 1; flex-basis: auto; order: 0; align-self: center; justify-self: center;"><div class="search"><button class="search-button"><svg role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title>Search</title><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"></path><circle cx="8" cy="8" r="7"></circle></g></svg><p>Search</p></button><div class="search-container"><div class="search-space"><input autocomplete="off" class="search-bar" name="search" type="text" aria-label="Search for something" placeholder="Search for something"/><div class="search-layout" data-preview="true"></div></div></div></div></div><div style="flex-grow: 0; flex-shrink: 1; flex-basis: auto; order: 0; align-self: center; justify-self: center;"><button class="darkmode"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" class="dayIcon" x="0px" y="0px" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35" xml:space="preserve" aria-label="Dark mode"><title>Dark mode</title><path d="M6,17.5C6,16.672,5.328,16,4.5,16h-3C0.672,16,0,16.672,0,17.5    S0.672,19,1.5,19h3C5.328,19,6,18.328,6,17.5z M7.5,26c-0.414,0-0.789,0.168-1.061,0.439l-2,2C4.168,28.711,4,29.086,4,29.5    C4,30.328,4.671,31,5.5,31c0.414,0,0.789-0.168,1.06-0.44l2-2C8.832,28.289,9,27.914,9,27.5C9,26.672,8.329,26,7.5,26z M17.5,6    C18.329,6,19,5.328,19,4.5v-3C19,0.672,18.329,0,17.5,0S16,0.672,16,1.5v3C16,5.328,16.671,6,17.5,6z M27.5,9    c0.414,0,0.789-0.168,1.06-0.439l2-2C30.832,6.289,31,5.914,31,5.5C31,4.672,30.329,4,29.5,4c-0.414,0-0.789,0.168-1.061,0.44    l-2,2C26.168,6.711,26,7.086,26,7.5C26,8.328,26.671,9,27.5,9z M6.439,8.561C6.711,8.832,7.086,9,7.5,9C8.328,9,9,8.328,9,7.5    c0-0.414-0.168-0.789-0.439-1.061l-2-2C6.289,4.168,5.914,4,5.5,4C4.672,4,4,4.672,4,5.5c0,0.414,0.168,0.789,0.439,1.06    L6.439,8.561z M33.5,16h-3c-0.828,0-1.5,0.672-1.5,1.5s0.672,1.5,1.5,1.5h3c0.828,0,1.5-0.672,1.5-1.5S34.328,16,33.5,16z     M28.561,26.439C28.289,26.168,27.914,26,27.5,26c-0.828,0-1.5,0.672-1.5,1.5c0,0.414,0.168,0.789,0.439,1.06l2,2    C28.711,30.832,29.086,31,29.5,31c0.828,0,1.5-0.672,1.5-1.5c0-0.414-0.168-0.789-0.439-1.061L28.561,26.439z M17.5,29    c-0.829,0-1.5,0.672-1.5,1.5v3c0,0.828,0.671,1.5,1.5,1.5s1.5-0.672,1.5-1.5v-3C19,29.672,18.329,29,17.5,29z M17.5,7    C11.71,7,7,11.71,7,17.5S11.71,28,17.5,28S28,23.29,28,17.5S23.29,7,17.5,7z M17.5,25c-4.136,0-7.5-3.364-7.5-7.5    c0-4.136,3.364-7.5,7.5-7.5c4.136,0,7.5,3.364,7.5,7.5C25,21.636,21.636,25,17.5,25z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" class="nightIcon" x="0px" y="0px" viewBox="0 0 100 100" style="enable-background:new 0 0 100 100" xml:space="preserve" aria-label="Light mode"><title>Light mode</title><path d="M96.76,66.458c-0.853-0.852-2.15-1.064-3.23-0.534c-6.063,2.991-12.858,4.571-19.655,4.571  C62.022,70.495,50.88,65.88,42.5,57.5C29.043,44.043,25.658,23.536,34.076,6.47c0.532-1.08,0.318-2.379-0.534-3.23  c-0.851-0.852-2.15-1.064-3.23-0.534c-4.918,2.427-9.375,5.619-13.246,9.491c-9.447,9.447-14.65,22.008-14.65,35.369  c0,13.36,5.203,25.921,14.65,35.368s22.008,14.65,35.368,14.65c13.361,0,25.921-5.203,35.369-14.65  c3.872-3.871,7.064-8.328,9.491-13.246C97.826,68.608,97.611,67.309,96.76,66.458z"></path></svg></button></div><div style="flex-grow: 0; flex-shrink: 1; flex-basis: auto; order: 0; align-self: center; justify-self: center;"><button class="readermode"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" class="readerIcon" fill="currentColor" stroke="currentColor" stroke-width="0.2" stroke-linecap="round" stroke-linejoin="round" width="64px" height="64px" viewBox="0 0 24 24" aria-label="Reader mode"><title>Reader mode</title><g transform="translate(-1.8, -1.8) scale(1.15, 1.2)"><path d="M8.9891247,2.5 C10.1384702,2.5 11.2209868,2.96705384 12.0049645,3.76669482 C12.7883914,2.96705384 13.8709081,2.5 15.0202536,2.5 L18.7549359,2.5 C19.1691495,2.5 19.5049359,2.83578644 19.5049359,3.25 L19.5046891,4.004 L21.2546891,4.00457396 C21.6343849,4.00457396 21.9481801,4.28672784 21.9978425,4.6528034 L22.0046891,4.75457396 L22.0046891,20.25 C22.0046891,20.6296958 21.7225353,20.943491 21.3564597,20.9931534 L21.2546891,21 L2.75468914,21 C2.37499337,21 2.06119817,20.7178461 2.01153575,20.3517706 L2.00468914,20.25 L2.00468914,4.75457396 C2.00468914,4.37487819 2.28684302,4.061083 2.65291858,4.01142057 L2.75468914,4.00457396 L4.50368914,4.004 L4.50444233,3.25 C4.50444233,2.87030423 4.78659621,2.55650904 5.15267177,2.50684662 L5.25444233,2.5 L8.9891247,2.5 Z M4.50368914,5.504 L3.50468914,5.504 L3.50468914,19.5 L10.9478955,19.4998273 C10.4513189,18.9207296 9.73864328,18.5588115 8.96709342,18.5065584 L8.77307039,18.5 L5.25444233,18.5 C4.87474657,18.5 4.56095137,18.2178461 4.51128895,17.8517706 L4.50444233,17.75 L4.50368914,5.504 Z M19.5049359,17.75 C19.5049359,18.1642136 19.1691495,18.5 18.7549359,18.5 L15.2363079,18.5 C14.3910149,18.5 13.5994408,18.8724714 13.0614828,19.4998273 L20.5046891,19.5 L20.5046891,5.504 L19.5046891,5.504 L19.5049359,17.75 Z M18.0059359,3.999 L15.0202536,4 L14.8259077,4.00692283 C13.9889509,4.06666544 13.2254227,4.50975805 12.7549359,5.212 L12.7549359,17.777 L12.7782651,17.7601316 C13.4923805,17.2719483 14.3447024,17 15.2363079,17 L18.0059359,16.999 L18.0056891,4.798 L18.0033792,4.75457396 L18.0056891,4.71 L18.0059359,3.999 Z M8.9891247,4 L6.00368914,3.999 L6.00599909,4.75457396 L6.00599909,4.75457396 L6.00368914,4.783 L6.00368914,16.999 L8.77307039,17 C9.57551536,17 10.3461406,17.2202781 11.0128313,17.6202194 L11.2536891,17.776 L11.2536891,5.211 C10.8200889,4.56369974 10.1361548,4.13636104 9.37521067,4.02745763 L9.18347055,4.00692283 L8.9891247,4 Z"></path></g></svg></button></div></div><div class="explorer" data-behavior="link" data-collapsed="collapsed" data-savestate="true" data-data-fns="{&quot;order&quot;:[&quot;filter&quot;,&quot;map&quot;,&quot;sort&quot;],&quot;sortFn&quot;:&quot;(a,b)=>!a.isFolder&amp;&amp;!b.isFolder||a.isFolder&amp;&amp;b.isFolder?a.displayName.localeCompare(b.displayName,void 0,{numeric:!0,sensitivity:\&quot;base\&quot;}):!a.isFolder&amp;&amp;b.isFolder?1:-1&quot;,&quot;filterFn&quot;:&quot;node=>node.slug===\&quot;\&quot;||node.slug.startsWith(\&quot;\\u8BFE\\u7A0B\\u7B14\\u8BB0\&quot;)&quot;,&quot;mapFn&quot;:&quot;node=>node&quot;}"><button type="button" class="explorer-toggle mobile-explorer hide-until-loaded" data-mobile="true" aria-controls="explorer-99"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide-menu"><line x1="4" x2="20" y1="12" y2="12"></line><line x1="4" x2="20" y1="6" y2="6"></line><line x1="4" x2="20" y1="18" y2="18"></line></svg></button><button type="button" class="title-button explorer-toggle desktop-explorer" data-mobile="false" aria-expanded="true"><h2>Explorer</h2><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="fold"><polyline points="6 9 12 15 18 9"></polyline></svg></button><div id="explorer-99" class="explorer-content" aria-expanded="false" role="group"><ul class="explorer-ul overflow" id="list-3"><li class="overflow-end"></li></ul></div><template id="template-file"><li><a href="#"></a></li></template><template id="template-folder"><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div><button class="folder-button"><span class="folder-title"></span></button></div></div><div class="folder-outer"><ul class="content"></ul></div></li></template></div></div><div class="center"><div class="page-header"><header><nav class="my-navbar "><div class="links"><a href="/课程笔记/">课程笔记</a><a href="/技术积累/">技术积累</a><a href="/工具使用/">工具使用</a><a href="/生活杂谈/">生活杂谈</a></div></nav></header><div class="popover-hint"><nav class="breadcrumb-container" aria-label="breadcrumbs"><div class="breadcrumb-element"><a href="../../">Home</a><p> ❯ </p></div><div class="breadcrumb-element"><a href="../../课程笔记/">课程笔记</a><p> ❯ </p></div><div class="breadcrumb-element"><a href="../../课程笔记/操作系统/">操作系统</a><p> ❯ </p></div><div class="breadcrumb-element"><a href>进程与内存流程总览</a></div></nav><h1 class="article-title">进程与内存流程总览</h1><p show-comma="true" class="content-meta"><time datetime="2025-12-15T08:28:53.000Z">Dec 15, 2025</time><span>20 min read</span></p></div></div><article class="popover-hint"><h1 id="进程与内存流程总览">进程与内存流程总览<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#进程与内存流程总览" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h1>
<p>本文档从系统上电开始，完整梳理操作系统如何启动、创建第一个用户进程、管理内存，以及如何进行进程切换的整个流程。</p>
<h2 id="一系统启动从硬件到内核">一、系统启动：从硬件到内核<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#一系统启动从硬件到内核" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<h3 id="11-上电与引导">1.1 上电与引导<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#11-上电与引导" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>计算机上电后，CPU首先执行存储在**ROM（只读存储器）**中的<a href="../../课程笔记/操作系统/01-introduction#引导" class="internal alias" data-slug="课程笔记/操作系统/01-introduction">引导加载器（bootstrap loader）</a>。这个程序是开机后执行的第一个软件，位置固定且已知。</p>
<p>引导加载器的任务：</p>
<ol>
<li>进行硬件自检（POST）</li>
<li>定位磁盘上的操作系统内核镜像</li>
<li>将内核加载到**主内存（RAM）**中</li>
<li>切换CPU模式为内核态，开始执行内核代码</li>
</ol>
<h3 id="12-内核初始化">1.2 内核初始化<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#12-内核初始化" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>内核被加载到内存后，开始初始化工作：</p>
<ol>
<li><strong>初始化中断系统</strong>
<ul>
<li>设置<a href="../../课程笔记/操作系统/01-introduction#中断interrupts" class="internal alias" data-slug="课程笔记/操作系统/01-introduction">中断向量表（interrupt vector table）</a>，建立中断号到中断处理程序的映射</li>
<li>配置<a href="../../课程笔记/操作系统/01-introduction#中断interrupts" class="internal alias" data-slug="课程笔记/操作系统/01-introduction">中断请求线（interrupt-request line）</a></li>
<li>初始化<a href="../../课程笔记/操作系统/01-introduction#计时器-timer" class="internal alias" data-slug="课程笔记/操作系统/01-introduction">计时器（timer）</a>，用于时间片管理</li>
</ul>
</li>
<li><strong>初始化内存管理</strong>
<ul>
<li>建立物理内存的<a href="../../课程笔记/操作系统/04.1-主存#分页paging" class="internal alias" data-slug="课程笔记/操作系统/04.1-主存">帧表（frame table）</a>，记录每个物理帧的使用情况</li>
<li>初始化内核的<a href="../../课程笔记/操作系统/04.1-主存#分页paging" class="internal alias" data-slug="课程笔记/操作系统/04.1-主存">页表</a>结构</li>
<li>设置<a href="../../课程笔记/操作系统/04.1-主存#内存保护机制protection" class="internal alias" data-slug="课程笔记/操作系统/04.1-主存">内存保护机制</a>（base和limit寄存器，或页表保护位）</li>
</ul>
</li>
<li><strong>初始化进程管理</strong>
<ul>
<li>创建初始的内核数据结构</li>
<li>准备<a href="../../课程笔记/操作系统/02.2-调度#就绪队列ready-queue和等待队列wait-queue" class="internal alias" data-slug="课程笔记/操作系统/02.2-调度">就绪队列（ready queue）</a>和<a href="../../课程笔记/操作系统/02.2-调度#就绪队列ready-queue和等待队列wait-queue" class="internal alias" data-slug="课程笔记/操作系统/02.2-调度">等待队列（wait queue）</a></li>
</ul>
</li>
</ol>
<h2 id="二第一个用户进程的创建">二、第一个用户进程的创建<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#二第一个用户进程的创建" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<h3 id="21-内核态到用户态的转换">2.1 内核态到用户态的转换<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#21-内核态到用户态的转换" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>内核初始化完成后，需要创建第一个用户进程。在Linux系统中，这个进程通常是<code>init</code>（旧版）或<code>systemd</code>（新版），其进程ID（PID）为1。</p>
<p>创建第一个用户进程的步骤：</p>
<ol>
<li><strong>分配<a href="../../课程笔记/操作系统/02.1-进程#process-control-blockpcb" class="internal alias" data-slug="课程笔记/操作系统/02.1-进程">进程控制块（PCB）</a></strong>
<ul>
<li>操作系统为每个进程维护一个PCB，包含进程状态、程序计数器、CPU寄存器、内存管理信息等</li>
<li>第一个进程的PCB被初始化为初始状态</li>
</ul>
</li>
<li><strong>建立<a href="../../课程笔记/操作系统/02.1-进程#进程的形式" class="internal alias" data-slug="课程笔记/操作系统/02.1-进程">虚拟地址空间</a></strong>
<ul>
<li>每个进程拥有独立的虚拟地址空间</li>
<li><a href="../../课程笔记/操作系统/04.2-virtual-memory#kernel-addresses--userspace-addresses" class="internal alias" data-slug="课程笔记/操作系统/04.2-virtual-memory">虚拟地址空间</a>分为两部分：
<ul>
<li><strong>用户部分</strong>：包含text（代码）、data（全局变量）、heap（堆）、stack（栈）</li>
<li><strong>内核部分</strong>：存储PCB等内核数据结构</li>
</ul>
</li>
</ul>
</li>
<li><strong>建立<a href="../../课程笔记/操作系统/04.1-主存#分页paging" class="internal alias" data-slug="课程笔记/操作系统/04.1-主存">页表</a>映射</strong>
<ul>
<li>为进程创建页表，建立虚拟地址到物理地址的映射</li>
<li>初始时，只有必要的页面被映射到物理内存</li>
<li>页表基地址存储在<a href="../../课程笔记/操作系统/04.1-主存#page-table-in-memory--ptbr" class="internal alias" data-slug="课程笔记/操作系统/04.1-主存">PTBR（Page-Table Base Register）</a>中</li>
</ul>
</li>
<li><strong>加载可执行文件</strong>
<ul>
<li>通过<a href="../../课程笔记/操作系统/01-introduction#链接器和装载器" class="internal alias" data-slug="课程笔记/操作系统/01-introduction">加载器（loader）</a>将可执行文件从磁盘加载到内存</li>
<li>可执行文件经历了编译（.c → .o）、链接（.o → .exe）、加载的过程</li>
<li>加载器将逻辑地址通过<a href="../../课程笔记/操作系统/04.1-主存#address-binding" class="internal alias" data-slug="课程笔记/操作系统/04.1-主存">地址绑定（Address Binding）</a>转换为物理地址</li>
</ul>
</li>
<li><strong>切换到用户态</strong>
<ul>
<li>通过<a href="../../课程笔记/操作系统/02.2-调度#调度的过程上下文切换" class="internal alias" data-slug="课程笔记/操作系统/02.2-调度">上下文切换（context switch）</a>，将CPU从内核态切换到用户态</li>
<li>设置CPU的mode bit为1（用户态）</li>
<li>跳转到用户程序的入口点开始执行</li>
</ul>
</li>
</ol>
<h3 id="22-地址绑定过程">2.2 地址绑定过程<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#22-地址绑定过程" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>程序从源代码到内存中的完整过程：</p>
<ol>
<li><strong>编译阶段</strong>：编译器将符号地址转换为可重定位地址（relocatable address）</li>
<li><strong>链接阶段</strong>：链接器将多个目标文件合并，生成可执行文件，地址相对于整个程序</li>
<li><strong>加载阶段</strong>：<a href="../../课程笔记/操作系统/01-introduction#链接器和装载器" class="internal alias" data-slug="课程笔记/操作系统/01-introduction">加载器</a>将可执行文件加载到内存，完成<a href="../../课程笔记/操作系统/04.1-主存#address-binding" class="internal alias" data-slug="课程笔记/操作系统/04.1-主存">地址绑定</a>，得到绝对地址</li>
</ol>
<h2 id="三内存管理机制">三、内存管理机制<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#三内存管理机制" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<h3 id="31-虚拟内存的基本原理">3.1 虚拟内存的基本原理<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#31-虚拟内存的基本原理" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>每个进程拥有独立的<a href="../../课程笔记/操作系统/02.1-进程#进程的形式" class="internal alias" data-slug="课程笔记/操作系统/02.1-进程">虚拟地址空间</a>，CPU使用虚拟地址，由<a href="../../课程笔记/操作系统/04.1-主存#segmentation--logical-address--mmu" class="internal alias" data-slug="课程笔记/操作系统/04.1-主存">MMU（内存管理单元）</a>自动转换为物理地址。</p>
<p><strong><a href="../../课程笔记/操作系统/04.2-virtual-memory#地址空间与异常" class="internal alias" data-slug="课程笔记/操作系统/04.2-virtual-memory">虚拟地址空间</a>的结构</strong>：</p>
<ul>
<li>用户空间（User Portion）：0 ~ 3GB（32位系统）</li>
<li>内核空间（Kernel Portion）：3GB ~ 4GB（32位系统）</li>
<li>所有进程的内核空间映射到同一块物理内存</li>
</ul>
<h3 id="32-分页机制">3.2 分页机制<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#32-分页机制" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>现代操作系统使用<a href="../../课程笔记/操作系统/04.1-主存#分页paging" class="internal alias" data-slug="课程笔记/操作系统/04.1-主存">分页（Paging）</a>机制管理内存：</p>
<ol>
<li><strong>物理内存分帧</strong>：将物理内存切分为等大小的<a href="../../课程笔记/操作系统/04.1-主存#分页paging" class="internal alias" data-slug="课程笔记/操作系统/04.1-主存">帧（frame）</a>，通常为4KB</li>
<li><strong>虚拟内存分页</strong>：将虚拟地址空间切分为等大小的<a href="../../课程笔记/操作系统/04.1-主存#分页paging" class="internal alias" data-slug="课程笔记/操作系统/04.1-主存">页（page）</a>，大小与帧相同</li>
<li><strong>页表映射</strong>：通过<a href="../../课程笔记/操作系统/04.1-主存#分页paging" class="internal alias" data-slug="课程笔记/操作系统/04.1-主存">页表</a>建立页到帧的映射关系</li>
</ol>
<p><strong>地址转换过程</strong>：</p>
<ul>
<li>CPU生成逻辑地址（page number + offset）</li>
<li><a href="../../课程笔记/操作系统/04.1-主存#segmentation--logical-address--mmu" class="internal alias" data-slug="课程笔记/操作系统/04.1-主存">MMU</a>根据页表将page number转换为frame number</li>
<li>物理地址 = frame number + offset</li>
</ul>
<h3 id="33-页表的硬件实现">3.3 页表的硬件实现<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#33-页表的硬件实现" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p><a href="../../课程笔记/操作系统/04.1-主存#分页paging" class="internal alias" data-slug="课程笔记/操作系统/04.1-主存">页表</a>存储在内存中，通过<a href="../../课程笔记/操作系统/04.1-主存#page-table-in-memory--ptbr" class="internal alias" data-slug="课程笔记/操作系统/04.1-主存">PTBR</a>指向页表基地址。为了加速地址转换，使用<a href="../../课程笔记/操作系统/04.1-主存#tlb" class="internal alias" data-slug="课程笔记/操作系统/04.1-主存">TLB（Translation Look-aside Buffer）</a>作为页表的高速缓存：</p>
<ol>
<li>CPU访问虚拟地址时，首先查询TLB</li>
<li>如果TLB命中，直接获得物理地址（一次内存访问）</li>
<li>如果TLB未命中，访问内存中的页表（两次内存访问），并将结果存入TLB</li>
</ol>
<h3 id="34-按需分页demand-paging">3.4 按需分页（Demand Paging）<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#34-按需分页demand-paging" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>操作系统采用<a href="../../课程笔记/操作系统/04.2-virtual-memory#lazy-allocation--demand-paging" class="internal alias" data-slug="课程笔记/操作系统/04.2-virtual-memory">延迟分配（Lazy Allocation）</a>策略：</p>
<ol>
<li>进程申请内存时，操作系统只扩大虚拟地址空间，不立即分配物理内存</li>
<li>当进程首次访问该虚拟地址时，触发<a href="../../课程笔记/操作系统/04.2-virtual-memory#地址空间与异常" class="internal alias" data-slug="课程笔记/操作系统/04.2-virtual-memory">缺页中断（page fault）</a></li>
<li>操作系统处理缺页中断：
<ul>
<li>从空闲帧列表中找到空闲的物理帧</li>
<li>将页面映射到该物理帧</li>
<li>更新页表项</li>
<li>重新执行被中断的指令</li>
</ul>
</li>
</ol>
<h3 id="35-页面置换">3.5 页面置换<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#35-页面置换" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>当物理内存不足时，需要将某些页面换出到磁盘（backing store）：</p>
<ol>
<li><strong>选择victim frame</strong>：使用<a href="../../课程笔记/操作系统/04.2-virtual-memory#page-replacement" class="internal alias" data-slug="课程笔记/操作系统/04.2-virtual-memory">页面置换算法</a>（如LRU）选择要换出的页面</li>
<li><strong>写回磁盘</strong>：如果页面被修改过（dirty bit=1），将其写回磁盘</li>
<li><strong>调入新页面</strong>：将需要的页面从磁盘调入到victim frame</li>
<li><strong>更新页表</strong>：将页表项的有效位设置为无效，记录页面在磁盘的位置</li>
</ol>
<p>当再次访问被换出的页面时，会触发<a href="../../课程笔记/操作系统/04.2-virtual-memory#地址空间与异常" class="internal alias" data-slug="课程笔记/操作系统/04.2-virtual-memory">page fault</a>，操作系统将其重新调入内存。</p>
<h2 id="四进程的创建与执行">四、进程的创建与执行<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#四进程的创建与执行" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<h3 id="41-进程创建fork">4.1 进程创建（fork）<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#41-进程创建fork" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>进程通过<code>fork()</code><a href="../../课程笔记/操作系统/01-introduction#系统调用" class="internal alias" data-slug="课程笔记/操作系统/01-introduction">系统调用</a>创建子进程：</p>
<ol>
<li><strong>系统调用</strong>：用户程序调用<code>fork()</code>，触发软中断（trap），切换到内核态</li>
<li><strong>创建子进程</strong>：
<ul>
<li>分配新的<a href="../../课程笔记/操作系统/02.1-进程#process-control-blockpcb" class="internal alias" data-slug="课程笔记/操作系统/02.1-进程">PCB</a></li>
<li>复制父进程的地址空间（使用<a href="../../课程笔记/操作系统/04.2-virtual-memory#copy-on-write" class="internal alias" data-slug="课程笔记/操作系统/04.2-virtual-memory">Copy-on-Write（COW）</a>优化）</li>
<li>子进程获得新的PID，PPID指向父进程</li>
</ul>
</li>
<li><strong>返回用户态</strong>：
<ul>
<li>父进程：<code>fork()</code>返回子进程的PID</li>
<li>子进程：<code>fork()</code>返回0</li>
<li>两个进程从<code>fork()</code>的下一行代码继续执行</li>
</ul>
</li>
</ol>
<p><strong><a href="../../课程笔记/操作系统/04.2-virtual-memory#copy-on-write" class="internal alias" data-slug="课程笔记/操作系统/04.2-virtual-memory">Copy-on-Write（COW）机制</a></strong>：</p>
<ul>
<li>父子进程最初共享同一份物理页</li>
<li>当任一进程尝试写入共享页时，才真正复制该页</li>
<li>节省内存，提高fork效率</li>
</ul>
<h3 id="42-进程执行exec">4.2 进程执行（exec）<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#42-进程执行exec" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p><code>exec()</code><a href="../../课程笔记/操作系统/01-introduction#系统调用" class="internal alias" data-slug="课程笔记/操作系统/01-introduction">系统调用</a>用新程序覆盖当前进程的地址空间：</p>
<ol>
<li>加载新的可执行文件到内存</li>
<li>建立新的<a href="../../课程笔记/操作系统/04.1-主存#分页paging" class="internal alias" data-slug="课程笔记/操作系统/04.1-主存">页表</a>映射</li>
<li>重置程序计数器，从新程序的入口点开始执行</li>
</ol>
<p>通常的用法是<code>fork()</code>后立即调用<code>exec()</code>，创建新进程并执行新程序。</p>
<h2 id="五进程调度与切换">五、进程调度与切换<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#五进程调度与切换" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<h3 id="51-进程状态">5.1 进程状态<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#51-进程状态" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>进程在运行过程中会经历以下<a href="../../课程笔记/操作系统/02.2-调度#进程状态state" class="internal alias" data-slug="课程笔记/操作系统/02.2-调度">进程状态</a>：</p>
<ul>
<li><strong>New</strong>：进程正在创建</li>
<li><strong>Ready</strong>：进程已准备好，等待CPU资源</li>
<li><strong>Running</strong>：进程正在使用CPU执行</li>
<li><strong>Waiting</strong>：进程等待某个事件（如I/O完成）</li>
<li><strong>Terminated</strong>：进程已结束</li>
</ul>
<p>状态转换规则：</p>
<ul>
<li>Running → Ready：时间片用完或被抢占</li>
<li>Running → Waiting：主动等待（如系统调用、I/O请求）</li>
<li>Waiting → Ready：等待的事件发生</li>
<li>Ready → Running：被调度器选中，获得CPU</li>
</ul>
<h3 id="52-调度时机">5.2 调度时机<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#52-调度时机" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p><strong><a href="../../课程笔记/操作系统/02.2-调度#调度的时机" class="internal alias" data-slug="课程笔记/操作系统/02.2-调度">非抢占式调度</a></strong>：进程主动释放CPU（进入waiting状态或终止）</p>
<p><strong><a href="../../课程笔记/操作系统/02.2-调度#调度的时机" class="internal alias" data-slug="课程笔记/操作系统/02.2-调度">抢占式调度</a></strong>：</p>
<ul>
<li>时间片用完（<a href="../../课程笔记/操作系统/01-introduction#计时器-timer" class="internal alias" data-slug="课程笔记/操作系统/01-introduction">timer中断</a>）</li>
<li>更高优先级的进程变为ready状态</li>
<li>当前进程被中断打断</li>
</ul>
<h3 id="53-上下文切换的完整过程">5.3 上下文切换的完整过程<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#53-上下文切换的完整过程" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>当调度器决定切换到另一个进程时，执行<a href="../../课程笔记/操作系统/02.2-调度#调度的过程上下文切换" class="internal alias" data-slug="课程笔记/操作系统/02.2-调度">上下文切换</a>：</p>
<ol>
<li>
<p><strong>保存当前进程的上下文</strong>：</p>
<ul>
<li>保存CPU寄存器（PC、通用寄存器等）到当前进程的<a href="../../课程笔记/操作系统/02.1-进程#process-control-blockpcb" class="internal alias" data-slug="课程笔记/操作系统/02.1-进程">PCB</a></li>
<li>保存进程状态</li>
<li>保存内存管理信息（页表指针等）</li>
</ul>
</li>
<li>
<p><strong>更新进程状态</strong>：</p>
<ul>
<li>将当前进程从running状态改为ready状态（或被抢占）或waiting状态</li>
<li>将当前进程的PCB移入相应的队列</li>
</ul>
</li>
<li>
<p><strong>选择下一个进程</strong>：</p>
<ul>
<li>调度器从<a href="../../课程笔记/操作系统/02.2-调度#就绪队列ready-queue和等待队列wait-queue" class="internal alias" data-slug="课程笔记/操作系统/02.2-调度">ready queue</a>中选择下一个要运行的进程</li>
<li>根据调度算法（如RR、优先级调度等）进行选择</li>
</ul>
</li>
<li>
<p><strong>恢复下一个进程的上下文</strong>：</p>
<ul>
<li>加载新进程的PCB中的寄存器值</li>
<li>更新<a href="../../课程笔记/操作系统/04.1-主存#page-table-in-memory--ptbr" class="internal alias" data-slug="课程笔记/操作系统/04.1-主存">PTBR</a>指向新进程的页表</li>
<li>如果使用<a href="../../课程笔记/操作系统/04.1-主存#tlb" class="internal alias" data-slug="课程笔记/操作系统/04.1-主存">TLB</a>，需要flush TLB或使用<a href="../../课程笔记/操作系统/04.1-主存#tlb-with-asid" class="internal alias" data-slug="课程笔记/操作系统/04.1-主存">ASID</a></li>
<li>更新进程状态为running</li>
</ul>
</li>
<li>
<p><strong>切换到用户态</strong>：</p>
<ul>
<li>设置CPU的mode bit为用户态</li>
<li>跳转到新进程的PC指向的指令继续执行</li>
</ul>
</li>
</ol>
<p><strong>上下文切换的开销</strong>：</p>
<ul>
<li>需要保存和恢复大量寄存器</li>
<li>需要切换页表（可能flush TLB）</li>
<li>需要更新各种内核数据结构</li>
<li>典型的context switch时间约为10μs</li>
</ul>
<h3 id="54-中断驱动的调度">5.4 中断驱动的调度<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#54-中断驱动的调度" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>现代操作系统是<a href="../../课程笔记/操作系统/01-introduction#中断interrupts" class="internal alias" data-slug="课程笔记/操作系统/01-introduction">中断驱动</a>的：</p>
<ol>
<li>
<p><strong><a href="../../课程笔记/操作系统/01-introduction#计时器-timer" class="internal alias" data-slug="课程笔记/操作系统/01-introduction">Timer中断</a></strong>：</p>
<ul>
<li>计时器定期产生中断（如每10ms）</li>
<li>中断处理程序检查当前进程的时间片是否用完</li>
<li>如果用完，触发调度，将当前进程切换为ready状态</li>
</ul>
</li>
<li>
<p><strong>I/O中断</strong>：</p>
<ul>
<li>当I/O操作完成时，设备控制器发起<a href="../../课程笔记/操作系统/01-introduction#中断interrupts" class="internal alias" data-slug="课程笔记/操作系统/01-introduction">中断</a></li>
<li>中断处理程序唤醒等待该I/O的进程</li>
<li>将进程从waiting状态切换为ready状态</li>
</ul>
</li>
<li>
<p><strong><a href="../../课程笔记/操作系统/01-introduction#系统调用" class="internal alias" data-slug="课程笔记/操作系统/01-introduction">系统调用</a></strong>：</p>
<ul>
<li>用户程序调用系统调用，触发软中断</li>
<li>切换到内核态执行系统调用</li>
<li>如果系统调用需要等待（如read），进程进入waiting状态</li>
</ul>
</li>
</ol>
<h2 id="六内存与进程的协同工作">六、内存与进程的协同工作<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#六内存与进程的协同工作" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<h3 id="61-进程切换时的内存管理">6.1 进程切换时的内存管理<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#61-进程切换时的内存管理" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>进程切换时，内存管理相关的操作：</p>
<ol>
<li>
<p><strong>页表切换</strong>：</p>
<ul>
<li>更新<a href="../../课程笔记/操作系统/04.1-主存#page-table-in-memory--ptbr" class="internal alias" data-slug="课程笔记/操作系统/04.1-主存">PTBR</a>指向新进程的<a href="../../课程笔记/操作系统/04.1-主存#分页paging" class="internal alias" data-slug="课程笔记/操作系统/04.1-主存">页表</a></li>
<li>不同进程的虚拟地址空间被隔离</li>
</ul>
</li>
<li>
<p><strong><a href="../../课程笔记/操作系统/04.1-主存#tlb" class="internal alias" data-slug="课程笔记/操作系统/04.1-主存">TLB</a>管理</strong>：</p>
<ul>
<li>方法1：flush TLB（清空所有TLB条目）</li>
<li>方法2：使用<a href="../../课程笔记/操作系统/04.1-主存#tlb-with-asid" class="internal alias" data-slug="课程笔记/操作系统/04.1-主存">ASID（Address-Space Identifier）</a>，TLB同时匹配page number和ASID</li>
</ul>
</li>
<li>
<p><strong><a href="../../课程笔记/操作系统/04.1-主存#内存保护机制protection" class="internal alias" data-slug="课程笔记/操作系统/04.1-主存">内存保护</a></strong>：</p>
<ul>
<li>每个进程只能访问自己的虚拟地址空间</li>
<li>通过页表的保护位（valid-invalid bit、读写权限位）实现</li>
</ul>
</li>
</ol>
<h3 id="62-缺页中断的处理流程">6.2 缺页中断的处理流程<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#62-缺页中断的处理流程" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>当进程访问的虚拟地址对应的页面不在物理内存中时：</p>
<ol>
<li><strong>触发<a href="../../课程笔记/操作系统/04.2-virtual-memory#地址空间与异常" class="internal alias" data-slug="课程笔记/操作系统/04.2-virtual-memory">page fault</a></strong>：
<ul>
<li><a href="../../课程笔记/操作系统/04.1-主存#segmentation--logical-address--mmu" class="internal alias" data-slug="课程笔记/操作系统/04.1-主存">MMU</a>在页表中查找，发现valid bit为invalid</li>
<li>CPU触发page fault异常，切换到内核态</li>
</ul>
</li>
<li><strong>检查页面合法性</strong>：
<ul>
<li>检查虚拟地址是否在进程的合法地址空间内</li>
<li>检查访问权限（读/写/执行）</li>
</ul>
</li>
<li><strong>分配物理帧</strong>：
<ul>
<li>如果有空闲帧，直接使用</li>
<li>如果没有空闲帧，执行<a href="../../课程笔记/操作系统/04.2-virtual-memory#page-replacement" class="internal alias" data-slug="课程笔记/操作系统/04.2-virtual-memory">页面置换算法</a>选择victim frame</li>
</ul>
</li>
<li><strong>从磁盘调入页面</strong>：
<ul>
<li>如果页面在磁盘上（被swap out），从backing store读取</li>
<li>如果页面是首次访问（<a href="../../课程笔记/操作系统/04.2-virtual-memory#lazy-allocation--demand-paging" class="internal alias" data-slug="课程笔记/操作系统/04.2-virtual-memory">lazy allocation</a>），分配新的零页</li>
</ul>
</li>
<li><strong>更新页表</strong>：
<ul>
<li>建立虚拟页到物理帧的映射</li>
<li>设置valid bit为有效</li>
<li>更新<a href="../../课程笔记/操作系统/04.1-主存#tlb" class="internal alias" data-slug="课程笔记/操作系统/04.1-主存">TLB</a></li>
</ul>
</li>
<li><strong>重新执行指令</strong>：
<ul>
<li>返回到用户态</li>
<li>重新执行触发page fault的指令</li>
</ul>
</li>
</ol>
<h3 id="63-进程间内存共享">6.3 进程间内存共享<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#63-进程间内存共享" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>多个进程可以共享同一块物理内存：</p>
<ol>
<li><strong><a href="../../课程笔记/操作系统/04.1-主存#shared-pages" class="internal alias" data-slug="课程笔记/操作系统/04.1-主存">共享代码</a></strong>：
<ul>
<li>多个进程执行同一程序时，可以共享text段</li>
<li>页表中不同的虚拟页映射到同一物理帧</li>
<li>代码必须是可重入的（reentrant code）</li>
</ul>
</li>
<li><strong><a href="../../课程笔记/操作系统/02.1-进程#进程间通信" class="internal alias" data-slug="课程笔记/操作系统/02.1-进程">共享内存（IPC）</a></strong>：
<ul>
<li>通过系统调用建立共享内存区域</li>
<li>多个进程的虚拟地址空间映射到同一物理内存</li>
<li>需要同步机制（如信号量）保护共享数据</li>
</ul>
</li>
</ol>
<h2 id="七完整流程示例从fork到exec到调度">七、完整流程示例：从fork到exec到调度<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#七完整流程示例从fork到exec到调度" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<h3 id="71-创建新进程并执行新程序">7.1 创建新进程并执行新程序<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#71-创建新进程并执行新程序" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<ol>
<li>
<p><strong>父进程调用fork()</strong>：</p>
<ul>
<li>触发<a href="../../课程笔记/操作系统/01-introduction#系统调用" class="internal alias" data-slug="课程笔记/操作系统/01-introduction">系统调用</a>，切换到内核态</li>
<li>内核创建子进程的<a href="../../课程笔记/操作系统/02.1-进程#process-control-blockpcb" class="internal alias" data-slug="课程笔记/操作系统/02.1-进程">PCB</a></li>
<li>使用<a href="../../课程笔记/操作系统/04.2-virtual-memory#copy-on-write" class="internal alias" data-slug="课程笔记/操作系统/04.2-virtual-memory">COW机制</a>共享父进程的地址空间</li>
<li>返回用户态，父子进程并发执行</li>
</ul>
</li>
<li>
<p><strong>子进程调用exec()</strong>：</p>
<ul>
<li>触发系统调用，切换到内核态</li>
<li>内核加载新的可执行文件</li>
<li>建立新的<a href="../../课程笔记/操作系统/04.1-主存#分页paging" class="internal alias" data-slug="课程笔记/操作系统/04.1-主存">页表</a>映射</li>
<li>覆盖原有的地址空间</li>
<li>返回用户态，从新程序的入口点开始执行</li>
</ul>
</li>
</ol>
<h3 id="72-进程切换的完整场景">7.2 进程切换的完整场景<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#72-进程切换的完整场景" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>假设进程A正在运行，时间片用完：</p>
<ol>
<li><strong><a href="../../课程笔记/操作系统/01-introduction#计时器-timer" class="internal alias" data-slug="课程笔记/操作系统/01-introduction">Timer中断</a></strong>：
<ul>
<li>硬件计时器产生<a href="../../课程笔记/操作系统/01-introduction#中断interrupts" class="internal alias" data-slug="课程笔记/操作系统/01-introduction">中断</a></li>
<li>CPU保存当前指令的上下文，跳转到中断处理程序</li>
</ul>
</li>
<li><strong>中断处理</strong>：
<ul>
<li>内核的中断处理程序执行</li>
<li>检查发现进程A的时间片已用完</li>
<li>将进程A的状态改为ready，移入<a href="../../课程笔记/操作系统/02.2-调度#就绪队列ready-queue和等待队列wait-queue" class="internal alias" data-slug="课程笔记/操作系统/02.2-调度">ready queue</a></li>
</ul>
</li>
<li><strong>调度决策</strong>：
<ul>
<li>调度器从ready queue中选择进程B（根据调度算法）</li>
<li>进程B可能是：
<ul>
<li>之前被抢占的进程</li>
<li>等待I/O完成的进程</li>
<li>新创建的进程</li>
</ul>
</li>
</ul>
</li>
<li><strong><a href="../../课程笔记/操作系统/02.2-调度#调度的过程上下文切换" class="internal alias" data-slug="课程笔记/操作系统/02.2-调度">上下文切换</a></strong>：
<ul>
<li>保存进程A的寄存器到<a href="../../课程笔记/操作系统/02.1-进程#process-control-blockpcb" class="internal alias" data-slug="课程笔记/操作系统/02.1-进程">PCB</a></li>
<li>加载进程B的寄存器从PCB</li>
<li>切换页表（更新<a href="../../课程笔记/操作系统/04.1-主存#page-table-in-memory--ptbr" class="internal alias" data-slug="课程笔记/操作系统/04.1-主存">PTBR</a>）</li>
<li>Flush <a href="../../课程笔记/操作系统/04.1-主存#tlb" class="internal alias" data-slug="课程笔记/操作系统/04.1-主存">TLB</a>或使用<a href="../../课程笔记/操作系统/04.1-主存#tlb-with-asid" class="internal alias" data-slug="课程笔记/操作系统/04.1-主存">ASID</a></li>
</ul>
</li>
<li><strong>恢复执行</strong>：
<ul>
<li>切换到用户态</li>
<li>跳转到进程B的PC指向的指令</li>
<li>进程B开始执行</li>
</ul>
</li>
</ol>
<h3 id="73-内存不足时的处理">7.3 内存不足时的处理<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#73-内存不足时的处理" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>当系统内存不足，新进程需要内存时：</p>
<ol>
<li>
<p><strong>触发<a href="../../课程笔记/操作系统/04.2-virtual-memory#地址空间与异常" class="internal alias" data-slug="课程笔记/操作系统/04.2-virtual-memory">page fault</a></strong>：</p>
<ul>
<li>进程访问未映射的虚拟地址</li>
<li><a href="../../课程笔记/操作系统/04.1-主存#segmentation--logical-address--mmu" class="internal alias" data-slug="课程笔记/操作系统/04.1-主存">MMU</a>发现页表项无效</li>
</ul>
</li>
<li>
<p><strong>检查空闲帧</strong>：</p>
<ul>
<li>如果没有空闲帧，执行<a href="../../课程笔记/操作系统/04.2-virtual-memory#page-replacement" class="internal alias" data-slug="课程笔记/操作系统/04.2-virtual-memory">页面置换</a></li>
</ul>
</li>
<li>
<p><strong>页面置换</strong>：</p>
<ul>
<li>使用LRU等算法选择victim frame</li>
<li>如果victim page被修改，写回磁盘</li>
<li>将victim page的页表项标记为无效</li>
</ul>
</li>
<li>
<p><strong>调入新页面</strong>：</p>
<ul>
<li>从磁盘读取需要的页面到victim frame</li>
<li>更新<a href="../../课程笔记/操作系统/04.1-主存#分页paging" class="internal alias" data-slug="课程笔记/操作系统/04.1-主存">页表</a>，建立映射</li>
<li>更新<a href="../../课程笔记/操作系统/04.1-主存#tlb" class="internal alias" data-slug="课程笔记/操作系统/04.1-主存">TLB</a></li>
</ul>
</li>
<li>
<p><strong>继续执行</strong>：</p>
<ul>
<li>重新执行触发page fault的指令</li>
<li>进程继续正常运行</li>
</ul>
</li>
</ol>
<h2 id="八总结关键机制的联系">八、总结：关键机制的联系<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#八总结关键机制的联系" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<h3 id="81-进程与内存的紧密关系">8.1 进程与内存的紧密关系<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#81-进程与内存的紧密关系" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<ul>
<li><strong>进程是资源分配的单位</strong>：每个进程拥有独立的<a href="../../课程笔记/操作系统/02.1-进程#进程的形式" class="internal alias" data-slug="课程笔记/操作系统/02.1-进程">虚拟地址空间</a></li>
<li><strong>内存是进程运行的基础</strong>：进程的代码、数据、堆栈都存储在内存中</li>
<li><strong><a href="../../课程笔记/操作系统/04.1-主存#分页paging" class="internal alias" data-slug="课程笔记/操作系统/04.1-主存">页表</a>是进程的”身份证”</strong>：通过页表实现虚拟地址到物理地址的映射</li>
<li><strong><a href="../../课程笔记/操作系统/02.1-进程#process-control-blockpcb" class="internal alias" data-slug="课程笔记/操作系统/02.1-进程">PCB</a>是进程的”档案”</strong>：记录进程的所有信息，包括内存管理信息</li>
</ul>
<h3 id="82-中断驱动的系统">8.2 中断驱动的系统<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#82-中断驱动的系统" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<ul>
<li><strong>硬件中断</strong>：<a href="../../课程笔记/操作系统/01-introduction#计时器-timer" class="internal alias" data-slug="课程笔记/操作系统/01-introduction">Timer</a>、I/O设备等硬件产生<a href="../../课程笔记/操作系统/01-introduction#中断interrupts" class="internal alias" data-slug="课程笔记/操作系统/01-introduction">中断</a>，触发调度</li>
<li><strong>软中断</strong>：<a href="../../课程笔记/操作系统/01-introduction#系统调用" class="internal alias" data-slug="课程笔记/操作系统/01-introduction">系统调用</a>、异常等软件事件触发中断，进入内核态</li>
<li><strong>中断处理</strong>：内核处理中断，可能改变进程状态，触发调度</li>
</ul>
<h3 id="83-虚拟内存的优势">8.3 虚拟内存的优势<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#83-虚拟内存的优势" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<ul>
<li><strong>隔离性</strong>：每个进程拥有独立的<a href="../../课程笔记/操作系统/02.1-进程#进程的形式" class="internal alias" data-slug="课程笔记/操作系统/02.1-进程">虚拟地址空间</a>，互不干扰</li>
<li><strong>灵活性</strong>：进程可以使用比物理内存更大的虚拟地址空间</li>
<li><strong>效率</strong>：通过<a href="../../课程笔记/操作系统/04.2-virtual-memory#lazy-allocation--demand-paging" class="internal alias" data-slug="课程笔记/操作系统/04.2-virtual-memory">按需分页</a>和<a href="../../课程笔记/操作系统/04.2-virtual-memory#page-replacement" class="internal alias" data-slug="课程笔记/操作系统/04.2-virtual-memory">页面置换</a>，提高内存利用率</li>
<li><strong>共享性</strong>：多个进程可以共享同一块物理内存（代码、数据）</li>
</ul>
<h3 id="84-进程切换的本质">8.4 进程切换的本质<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#84-进程切换的本质" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>进程切换本质上是：</p>
<ol>
<li><strong>保存当前执行环境</strong>：寄存器、状态、内存映射</li>
<li><strong>恢复另一个执行环境</strong>：加载另一个进程的上下文</li>
<li><strong>继续执行</strong>：从另一个进程的断点继续<br/>
这一切都依赖于：</li>
</ol>
<ul>
<li><strong><a href="../../课程笔记/操作系统/01-introduction#中断interrupts" class="internal alias" data-slug="课程笔记/操作系统/01-introduction">中断机制</a></strong>：提供切换的时机</li>
<li><strong>内存管理</strong>：保证进程间的隔离和正确映射</li>
<li><strong>调度算法</strong>：决定切换哪个进程</li>
</ul>
<hr/>
<h2 id="相关概念索引">相关概念索引<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#相关概念索引" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<ul>
<li><a href="../../课程笔记/操作系统/01-introduction" class="internal alias" data-slug="课程笔记/操作系统/01-introduction">01 introduction</a> - 操作系统概述、中断、特权模式</li>
<li><a href="../../课程笔记/操作系统/02.1-进程" class="internal alias" data-slug="课程笔记/操作系统/02.1-进程">02.1 进程</a> - 进程概念、PCB、进程创建与终止</li>
<li><a href="../../课程笔记/操作系统/02.2-调度" class="internal alias" data-slug="课程笔记/操作系统/02.2-调度">02.2 调度</a> - 进程状态、调度算法、上下文切换</li>
<li><a href="../../课程笔记/操作系统/04.1-主存" class="internal alias" data-slug="课程笔记/操作系统/04.1-主存">04.1 主存</a> - 内存分配、分页、页表、TLB</li>
<li><a href="../../课程笔记/操作系统/04.2-virtual-memory" class="internal alias" data-slug="课程笔记/操作系统/04.2-virtual-memory">04.2 virtual memory</a> - 虚拟内存、按需分页、页面置换</li>
</ul></article><hr/><div class="page-footer"><div class="giscus" data-repo="im0x0ing/im0x0ing.github.io" data-repo-id="R_kgDOQevgrA" data-category="Announcements" data-category-id="DIC_kwDOQevgrM4CzLI8" data-mapping="pathname" data-strict="0" data-reactions-enabled="1" data-input-position="top" data-light-theme="light" data-dark-theme="dark" data-theme-url="https://im0x0ing.github.io/static/giscus" data-lang="zh-CN"></div></div></div><div class="right sidebar"><div class="toc desktop-only"><button type="button" class="toc-header" aria-controls="toc-44" aria-expanded="true"><h3>Table of Contents</h3><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="fold"><polyline points="6 9 12 15 18 9"></polyline></svg></button><div class="toc-depth-control"><span class="depth-label">H3</span><input type="range" class="depth-slider" min="1" max="6" value="2" step="1"/></div><ul id="list-9" class="toc-content overflow"><li class="depth-0"><a href="#进程与内存流程总览" data-for="进程与内存流程总览">进程与内存流程总览</a></li><li class="depth-1"><a href="#一系统启动从硬件到内核" data-for="一系统启动从硬件到内核">一、系统启动：从硬件到内核</a></li><li class="depth-2"><a href="#11-上电与引导" data-for="11-上电与引导">1.1 上电与引导</a></li><li class="depth-2"><a href="#12-内核初始化" data-for="12-内核初始化">1.2 内核初始化</a></li><li class="depth-1"><a href="#二第一个用户进程的创建" data-for="二第一个用户进程的创建">二、第一个用户进程的创建</a></li><li class="depth-2"><a href="#21-内核态到用户态的转换" data-for="21-内核态到用户态的转换">2.1 内核态到用户态的转换</a></li><li class="depth-2"><a href="#22-地址绑定过程" data-for="22-地址绑定过程">2.2 地址绑定过程</a></li><li class="depth-1"><a href="#三内存管理机制" data-for="三内存管理机制">三、内存管理机制</a></li><li class="depth-2"><a href="#31-虚拟内存的基本原理" data-for="31-虚拟内存的基本原理">3.1 虚拟内存的基本原理</a></li><li class="depth-2"><a href="#32-分页机制" data-for="32-分页机制">3.2 分页机制</a></li><li class="depth-2"><a href="#33-页表的硬件实现" data-for="33-页表的硬件实现">3.3 页表的硬件实现</a></li><li class="depth-2"><a href="#34-按需分页demand-paging" data-for="34-按需分页demand-paging">3.4 按需分页（Demand Paging）</a></li><li class="depth-2"><a href="#35-页面置换" data-for="35-页面置换">3.5 页面置换</a></li><li class="depth-1"><a href="#四进程的创建与执行" data-for="四进程的创建与执行">四、进程的创建与执行</a></li><li class="depth-2"><a href="#41-进程创建fork" data-for="41-进程创建fork">4.1 进程创建（fork）</a></li><li class="depth-2"><a href="#42-进程执行exec" data-for="42-进程执行exec">4.2 进程执行（exec）</a></li><li class="depth-1"><a href="#五进程调度与切换" data-for="五进程调度与切换">五、进程调度与切换</a></li><li class="depth-2"><a href="#51-进程状态" data-for="51-进程状态">5.1 进程状态</a></li><li class="depth-2"><a href="#52-调度时机" data-for="52-调度时机">5.2 调度时机</a></li><li class="depth-2"><a href="#53-上下文切换的完整过程" data-for="53-上下文切换的完整过程">5.3 上下文切换的完整过程</a></li><li class="depth-2"><a href="#54-中断驱动的调度" data-for="54-中断驱动的调度">5.4 中断驱动的调度</a></li><li class="depth-1"><a href="#六内存与进程的协同工作" data-for="六内存与进程的协同工作">六、内存与进程的协同工作</a></li><li class="depth-2"><a href="#61-进程切换时的内存管理" data-for="61-进程切换时的内存管理">6.1 进程切换时的内存管理</a></li><li class="depth-2"><a href="#62-缺页中断的处理流程" data-for="62-缺页中断的处理流程">6.2 缺页中断的处理流程</a></li><li class="depth-2"><a href="#63-进程间内存共享" data-for="63-进程间内存共享">6.3 进程间内存共享</a></li><li class="depth-1"><a href="#七完整流程示例从fork到exec到调度" data-for="七完整流程示例从fork到exec到调度">七、完整流程示例：从fork到exec到调度</a></li><li class="depth-2"><a href="#71-创建新进程并执行新程序" data-for="71-创建新进程并执行新程序">7.1 创建新进程并执行新程序</a></li><li class="depth-2"><a href="#72-进程切换的完整场景" data-for="72-进程切换的完整场景">7.2 进程切换的完整场景</a></li><li class="depth-2"><a href="#73-内存不足时的处理" data-for="73-内存不足时的处理">7.3 内存不足时的处理</a></li><li class="depth-1"><a href="#八总结关键机制的联系" data-for="八总结关键机制的联系">八、总结：关键机制的联系</a></li><li class="depth-2"><a href="#81-进程与内存的紧密关系" data-for="81-进程与内存的紧密关系">8.1 进程与内存的紧密关系</a></li><li class="depth-2"><a href="#82-中断驱动的系统" data-for="82-中断驱动的系统">8.2 中断驱动的系统</a></li><li class="depth-2"><a href="#83-虚拟内存的优势" data-for="83-虚拟内存的优势">8.3 虚拟内存的优势</a></li><li class="depth-2"><a href="#84-进程切换的本质" data-for="84-进程切换的本质">8.4 进程切换的本质</a></li><li class="depth-1"><a href="#相关概念索引" data-for="相关概念索引">相关概念索引</a></li><li class="overflow-end"></li></ul></div><div class="graph"><h3>Graph View</h3><div class="graph-outer"><div class="graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:1,&quot;scale&quot;:1.1,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.3,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1,&quot;showTags&quot;:true,&quot;removeTags&quot;:[],&quot;focusOnHover&quot;:false,&quot;enableRadial&quot;:false}"></div><button class="global-graph-icon" aria-label="Global Graph"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 55 55" fill="currentColor" xml:space="preserve"><path d="M49,0c-3.309,0-6,2.691-6,6c0,1.035,0.263,2.009,0.726,2.86l-9.829,9.829C32.542,17.634,30.846,17,29,17
                s-3.542,0.634-4.898,1.688l-7.669-7.669C16.785,10.424,17,9.74,17,9c0-2.206-1.794-4-4-4S9,6.794,9,9s1.794,4,4,4
                c0.74,0,1.424-0.215,2.019-0.567l7.669,7.669C21.634,21.458,21,23.154,21,25s0.634,3.542,1.688,4.897L10.024,42.562
                C8.958,41.595,7.549,41,6,41c-3.309,0-6,2.691-6,6s2.691,6,6,6s6-2.691,6-6c0-1.035-0.263-2.009-0.726-2.86l12.829-12.829
                c1.106,0.86,2.44,1.436,3.898,1.619v10.16c-2.833,0.478-5,2.942-5,5.91c0,3.309,2.691,6,6,6s6-2.691,6-6c0-2.967-2.167-5.431-5-5.91
                v-10.16c1.458-0.183,2.792-0.759,3.898-1.619l7.669,7.669C41.215,39.576,41,40.26,41,41c0,2.206,1.794,4,4,4s4-1.794,4-4
                s-1.794-4-4-4c-0.74,0-1.424,0.215-2.019,0.567l-7.669-7.669C36.366,28.542,37,26.846,37,25s-0.634-3.542-1.688-4.897l9.665-9.665
                C46.042,11.405,47.451,12,49,12c3.309,0,6-2.691,6-6S52.309,0,49,0z M11,9c0-1.103,0.897-2,2-2s2,0.897,2,2s-0.897,2-2,2
                S11,10.103,11,9z M6,51c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S8.206,51,6,51z M33,49c0,2.206-1.794,4-4,4s-4-1.794-4-4
                s1.794-4,4-4S33,46.794,33,49z M29,31c-3.309,0-6-2.691-6-6s2.691-6,6-6s6,2.691,6,6S32.309,31,29,31z M47,41c0,1.103-0.897,2-2,2
                s-2-0.897-2-2s0.897-2,2-2S47,39.897,47,41z M49,10c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S51.206,10,49,10z"></path></svg></button></div><div class="global-graph-outer"><div class="global-graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:-1,&quot;scale&quot;:0.9,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.2,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1,&quot;showTags&quot;:true,&quot;removeTags&quot;:[],&quot;focusOnHover&quot;:true,&quot;enableRadial&quot;:true}"></div></div></div></div><footer class><p>Created with <a href="https://quartz.jzhao.xyz/">Quartz v4.5.2</a> © 2025</p><ul><li><a href="https://github.com/jackyzha0/quartz">GitHub</a></li><li><a href="https://discord.gg/cRFFHYye7t">Discord Community</a></li></ul></footer></div></div></body><script type="application/javascript" data-persist="true">function n(){let t=this.parentElement;t.classList.toggle("is-collapsed");let e=t.getElementsByClassName("callout-content")[0];if(!e)return;let l=t.classList.contains("is-collapsed");e.style.gridTemplateRows=l?"0fr":"1fr"}function c(){let t=document.getElementsByClassName("callout is-collapsible");for(let e of t){let l=e.getElementsByClassName("callout-title")[0],s=e.getElementsByClassName("callout-content")[0];if(!l||!s)continue;l.addEventListener("click",n),window.addCleanup(()=>l.removeEventListener("click",n));let o=e.classList.contains("is-collapsed");s.style.gridTemplateRows=o?"0fr":"1fr"}}document.addEventListener("nav",c);
</script><script type="module" data-persist="true">function f(i,e){if(!i)return;function r(o){o.target===this&&(o.preventDefault(),o.stopPropagation(),e())}function t(o){o.key.startsWith("Esc")&&(o.preventDefault(),e())}i?.addEventListener("click",r),window.addCleanup(()=>i?.removeEventListener("click",r)),document.addEventListener("keydown",t),window.addCleanup(()=>document.removeEventListener("keydown",t))}function y(i){for(;i.firstChild;)i.removeChild(i.firstChild)}var h=class{constructor(e,r){this.container=e;this.content=r;this.setupEventListeners(),this.setupNavigationControls(),this.resetTransform()}isDragging=!1;startPan={x:0,y:0};currentPan={x:0,y:0};scale=1;MIN_SCALE=.5;MAX_SCALE=3;cleanups=[];setupEventListeners(){let e=this.onMouseDown.bind(this),r=this.onMouseMove.bind(this),t=this.onMouseUp.bind(this),o=this.resetTransform.bind(this);this.container.addEventListener("mousedown",e),document.addEventListener("mousemove",r),document.addEventListener("mouseup",t),window.addEventListener("resize",o),this.cleanups.push(()=>this.container.removeEventListener("mousedown",e),()=>document.removeEventListener("mousemove",r),()=>document.removeEventListener("mouseup",t),()=>window.removeEventListener("resize",o))}cleanup(){for(let e of this.cleanups)e()}setupNavigationControls(){let e=document.createElement("div");e.className="mermaid-controls";let r=this.createButton("+",()=>this.zoom(.1)),t=this.createButton("-",()=>this.zoom(-.1)),o=this.createButton("Reset",()=>this.resetTransform());e.appendChild(t),e.appendChild(o),e.appendChild(r),this.container.appendChild(e)}createButton(e,r){let t=document.createElement("button");return t.textContent=e,t.className="mermaid-control-button",t.addEventListener("click",r),window.addCleanup(()=>t.removeEventListener("click",r)),t}onMouseDown(e){e.button===0&&(this.isDragging=!0,this.startPan={x:e.clientX-this.currentPan.x,y:e.clientY-this.currentPan.y},this.container.style.cursor="grabbing")}onMouseMove(e){this.isDragging&&(e.preventDefault(),this.currentPan={x:e.clientX-this.startPan.x,y:e.clientY-this.startPan.y},this.updateTransform())}onMouseUp(){this.isDragging=!1,this.container.style.cursor="grab"}zoom(e){let r=Math.min(Math.max(this.scale+e,this.MIN_SCALE),this.MAX_SCALE),t=this.content.getBoundingClientRect(),o=t.width/2,n=t.height/2,c=r-this.scale;this.currentPan.x-=o*c,this.currentPan.y-=n*c,this.scale=r,this.updateTransform()}updateTransform(){this.content.style.transform=`translate(${this.currentPan.x}px, ${this.currentPan.y}px) scale(${this.scale})`}resetTransform(){this.scale=1;let e=this.content.querySelector("svg");this.currentPan={x:e.getBoundingClientRect().width/2,y:e.getBoundingClientRect().height/2},this.updateTransform()}},C=["--secondary","--tertiary","--gray","--light","--lightgray","--highlight","--dark","--darkgray","--codeFont"],E;document.addEventListener("nav",async()=>{let e=document.querySelector(".center").querySelectorAll("code.mermaid");if(e.length===0)return;E||=await import("https://cdnjs.cloudflare.com/ajax/libs/mermaid/11.4.0/mermaid.esm.min.mjs");let r=E.default,t=new WeakMap;for(let n of e)t.set(n,n.innerText);async function o(){for(let s of e){s.removeAttribute("data-processed");let a=t.get(s);a&&(s.innerHTML=a)}let n=C.reduce((s,a)=>(s[a]=window.getComputedStyle(document.documentElement).getPropertyValue(a),s),{}),c=document.documentElement.getAttribute("saved-theme")==="dark";r.initialize({startOnLoad:!1,securityLevel:"loose",theme:c?"dark":"base",themeVariables:{fontFamily:n["--codeFont"],primaryColor:n["--light"],primaryTextColor:n["--darkgray"],primaryBorderColor:n["--tertiary"],lineColor:n["--darkgray"],secondaryColor:n["--secondary"],tertiaryColor:n["--tertiary"],clusterBkg:n["--light"],edgeLabelBackground:n["--highlight"]}}),await r.run({nodes:e})}await o(),document.addEventListener("themechange",o),window.addCleanup(()=>document.removeEventListener("themechange",o));for(let n=0;n<e.length;n++){let v=function(){let g=l.querySelector("#mermaid-space"),m=l.querySelector(".mermaid-content");if(!m)return;y(m);let w=c.querySelector("svg").cloneNode(!0);m.appendChild(w),l.classList.add("active"),g.style.cursor="grab",u=new h(g,m)},M=function(){l.classList.remove("active"),u?.cleanup(),u=null},c=e[n],s=c.parentElement,a=s.querySelector(".clipboard-button"),d=s.querySelector(".expand-button"),p=window.getComputedStyle(a),L=a.offsetWidth+parseFloat(p.marginLeft||"0")+parseFloat(p.marginRight||"0");d.style.right=`calc(${L}px + 0.3rem)`,s.prepend(d);let l=s.querySelector("#mermaid-container");if(!l)return;let u=null;d.addEventListener("click",v),f(l,M),window.addCleanup(()=>{u?.cleanup(),d.removeEventListener("click",v)})}});
</script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/copy-tex.min.js" type="application/javascript" data-persist="true"></script><script src="../../postscript.js" type="module" data-persist="true"></script></html>